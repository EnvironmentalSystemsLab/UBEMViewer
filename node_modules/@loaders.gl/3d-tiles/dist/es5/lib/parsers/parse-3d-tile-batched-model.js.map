{"version":3,"file":"parse-3d-tile-batched-model.js","names":["_math","require","_tile3dFeatureTable","_interopRequireDefault","_parse3dTileHeader","_parse3dTileTables","_parse3dTileGltfView","parseBatchedModel3DTile","_x","_x2","_x3","_x4","_x5","_parseBatchedModel3DTile","apply","arguments","_asyncToGenerator2","default","_regenerator","mark","_callee","tile","arrayBuffer","byteOffset","options","context","_tile$gltf","extensions","wrap","_callee$","_context","prev","next","parseBatchedModel","extractGLTF","GLTF_FORMAT","EMBEDDED","gltf","CESIUM_RTC","rtcCenter","center","abrupt","stop","parse3DTileHeaderSync","parse3DTileTablesHeaderSync","parse3DTileTablesSync","parse3DTileGLTFViewSync","featureTable","Tile3DFeatureTable","featureTableJson","featureTableBinary","getGlobalProperty","GL","FLOAT"],"sources":["../../../../src/lib/parsers/parse-3d-tile-batched-model.ts"],"sourcesContent":["// This file is derived from the Cesium code base under Apache 2 license\n// See LICENSE.md and https://github.com/AnalyticalGraphicsInc/cesium/blob/master/LICENSE.md\n\nimport {GL} from '@loaders.gl/math'; // math.gl/geometry;\nimport Tile3DFeatureTable from '../classes/tile-3d-feature-table';\n// import Tile3DBatchTable from '../classes/tile-3d-batch-table';\n\nimport {parse3DTileHeaderSync} from './helpers/parse-3d-tile-header';\nimport {parse3DTileTablesHeaderSync, parse3DTileTablesSync} from './helpers/parse-3d-tile-tables';\nimport {parse3DTileGLTFViewSync, extractGLTF, GLTF_FORMAT} from './helpers/parse-3d-tile-gltf-view';\n\nexport async function parseBatchedModel3DTile(tile, arrayBuffer, byteOffset, options, context) {\n  byteOffset = parseBatchedModel(tile, arrayBuffer, byteOffset, options, context);\n  await extractGLTF(tile, GLTF_FORMAT.EMBEDDED, options, context);\n\n  const extensions = tile?.gltf?.extensions;\n  if (extensions && extensions.CESIUM_RTC) {\n    tile.rtcCenter = extensions.CESIUM_RTC.center;\n  }\n\n  return byteOffset;\n}\n\nfunction parseBatchedModel(tile, arrayBuffer, byteOffset, options, context) {\n  byteOffset = parse3DTileHeaderSync(tile, arrayBuffer, byteOffset);\n\n  byteOffset = parse3DTileTablesHeaderSync(tile, arrayBuffer, byteOffset);\n  byteOffset = parse3DTileTablesSync(tile, arrayBuffer, byteOffset, options);\n\n  byteOffset = parse3DTileGLTFViewSync(tile, arrayBuffer, byteOffset, options);\n\n  const featureTable = new Tile3DFeatureTable(tile.featureTableJson, tile.featureTableBinary);\n  tile.rtcCenter = featureTable.getGlobalProperty('RTC_CENTER', GL.FLOAT, 3);\n\n  return byteOffset;\n}\n"],"mappings":";;;;;;;;;AAGA,IAAAA,KAAA,GAAAC,OAAA;AACA,IAAAC,mBAAA,GAAAC,sBAAA,CAAAF,OAAA;AAGA,IAAAG,kBAAA,GAAAH,OAAA;AACA,IAAAI,kBAAA,GAAAJ,OAAA;AACA,IAAAK,oBAAA,GAAAL,OAAA;AAAoG,SAE9EM,uBAAuBA,CAAAC,EAAA,EAAAC,GAAA,EAAAC,GAAA,EAAAC,GAAA,EAAAC,GAAA;EAAA,OAAAC,wBAAA,CAAAC,KAAA,OAAAC,SAAA;AAAA;AAAA,SAAAF,yBAAA;EAAAA,wBAAA,OAAAG,kBAAA,CAAAC,OAAA,EAAAC,YAAA,CAAAD,OAAA,CAAAE,IAAA,CAAtC,SAAAC,QAAuCC,IAAI,EAAEC,WAAW,EAAEC,UAAU,EAAEC,OAAO,EAAEC,OAAO;IAAA,IAAAC,UAAA;IAAA,IAAAC,UAAA;IAAA,OAAAT,YAAA,CAAAD,OAAA,CAAAW,IAAA,UAAAC,SAAAC,QAAA;MAAA,kBAAAA,QAAA,CAAAC,IAAA,GAAAD,QAAA,CAAAE,IAAA;QAAA;UAC3FT,UAAU,GAAGU,iBAAiB,CAACZ,IAAI,EAAEC,WAAW,EAAEC,UAAU,EAAEC,OAAO,EAAEC,OAAO,CAAC;UAACK,QAAA,CAAAE,IAAA;UAAA,OAC1E,IAAAE,gCAAW,EAACb,IAAI,EAAEc,gCAAW,CAACC,QAAQ,EAAEZ,OAAO,EAAEC,OAAO,CAAC;QAAA;UAEzDE,UAAU,GAAGN,IAAI,aAAJA,IAAI,wBAAAK,UAAA,GAAJL,IAAI,CAAEgB,IAAI,cAAAX,UAAA,uBAAVA,UAAA,CAAYC,UAAU;UACzC,IAAIA,UAAU,IAAIA,UAAU,CAACW,UAAU,EAAE;YACvCjB,IAAI,CAACkB,SAAS,GAAGZ,UAAU,CAACW,UAAU,CAACE,MAAM;UAC/C;UAAC,OAAAV,QAAA,CAAAW,MAAA,WAEMlB,UAAU;QAAA;QAAA;UAAA,OAAAO,QAAA,CAAAY,IAAA;MAAA;IAAA,GAAAtB,OAAA;EAAA,CAClB;EAAA,OAAAP,wBAAA,CAAAC,KAAA,OAAAC,SAAA;AAAA;AAED,SAASkB,iBAAiBA,CAACZ,IAAI,EAAEC,WAAW,EAAEC,UAAU,EAAEC,OAAO,EAAEC,OAAO,EAAE;EAC1EF,UAAU,GAAG,IAAAoB,wCAAqB,EAACtB,IAAI,EAAEC,WAAW,EAAEC,UAAU,CAAC;EAEjEA,UAAU,GAAG,IAAAqB,8CAA2B,EAACvB,IAAI,EAAEC,WAAW,EAAEC,UAAU,CAAC;EACvEA,UAAU,GAAG,IAAAsB,wCAAqB,EAACxB,IAAI,EAAEC,WAAW,EAAEC,UAAU,EAAEC,OAAO,CAAC;EAE1ED,UAAU,GAAG,IAAAuB,4CAAuB,EAACzB,IAAI,EAAEC,WAAW,EAAEC,UAAU,EAAEC,OAAO,CAAC;EAE5E,IAAMuB,YAAY,GAAG,IAAIC,2BAAkB,CAAC3B,IAAI,CAAC4B,gBAAgB,EAAE5B,IAAI,CAAC6B,kBAAkB,CAAC;EAC3F7B,IAAI,CAACkB,SAAS,GAAGQ,YAAY,CAACI,iBAAiB,CAAC,YAAY,EAAEC,QAAE,CAACC,KAAK,EAAE,CAAC,CAAC;EAE1E,OAAO9B,UAAU;AACnB"}