{"version":3,"file":"ion.js","names":["_core","require","_loaderUtils","ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","_defineProperty2","default","getOwnPropertyDescriptors","defineProperties","defineProperty","_createForOfIteratorHelper","o","allowArrayLike","it","Symbol","iterator","Array","isArray","_unsupportedIterableToArray","F","s","n","done","value","e","_e","f","TypeError","normalCompletion","didErr","err","call","step","next","_e2","return","minLen","_arrayLikeToArray","prototype","toString","slice","constructor","name","from","test","arr","len","arr2","CESIUM_ION_URL","getIonTilesetMetadata","_x","_x2","_getIonTilesetMetadata","_asyncToGenerator2","_regenerator","mark","_callee","accessToken","assetId","assets","_iterator","_step","item","ionAssetMetadata","type","url","wrap","_callee$","_context","prev","getIonAssets","sent","items","id","getIonAssetMetadata","assert","headers","Authorization","concat","abrupt","stop","_x3","_getIonAssets","_callee2","response","_callee2$","_context2","fetchFile","fetch","ok","Error","statusText","json","_x4","_x5","_getIonAssetMetadata","_callee3","metadata","tilesetInfo","_callee3$","_context3"],"sources":["../../../../src/lib/ion/ion.ts"],"sourcesContent":["// Minimal support to load tilsets from the Cesium ION services\n\nimport {fetchFile} from '@loaders.gl/core';\nimport {assert} from '@loaders.gl/loader-utils';\n\nconst CESIUM_ION_URL = 'https://api.cesium.com/v1/assets';\n\n// Returns `{url, headers, type, attributions}` for an ion tileset\nexport async function getIonTilesetMetadata(accessToken, assetId) {\n  // Step 1, if no asset id, look for first 3DTILES asset associated with this token.\n  if (!assetId) {\n    const assets = await getIonAssets(accessToken);\n    for (const item of assets.items) {\n      if (item.type === '3DTILES') {\n        assetId = item.id;\n      }\n    }\n  }\n\n  // Step 2: Query metdatadata for this asset.\n  const ionAssetMetadata = await getIonAssetMetadata(accessToken, assetId);\n  const {type, url} = ionAssetMetadata;\n  assert(type === '3DTILES' && url);\n\n  // Prepare a headers object for fetch\n  ionAssetMetadata.headers = {\n    Authorization: `Bearer ${ionAssetMetadata.accessToken}`\n  };\n  return ionAssetMetadata;\n}\n\n// Return a list of all assets associated with accessToken\nexport async function getIonAssets(accessToken) {\n  assert(accessToken);\n  const url = CESIUM_ION_URL;\n  const headers = {Authorization: `Bearer ${accessToken}`};\n  const response = await fetchFile(url, {fetch: {headers}});\n  if (!response.ok) {\n    throw new Error(response.statusText);\n  }\n  return await response.json();\n}\n\n// Return metadata for a specific asset associated with token\nexport async function getIonAssetMetadata(accessToken, assetId) {\n  assert(accessToken, assetId);\n  const headers = {Authorization: `Bearer ${accessToken}`};\n\n  const url = `${CESIUM_ION_URL}/${assetId}`;\n  // https://cesium.com/docs/rest-api/#operation/getAsset\n  // Retrieves metadata information about a specific asset.\n  let response = await fetchFile(`${url}`, {fetch: {headers}});\n  if (!response.ok) {\n    throw new Error(response.statusText);\n  }\n  let metadata = await response.json();\n\n  // https://cesium.com/docs/rest-api/#operation/getAssetEndpoint\n  // Retrieves information and credentials that allow you to access the tiled asset data for visualization and analysis.\n  response = await fetchFile(`${url}/endpoint`, {fetch: {headers}});\n  if (!response.ok) {\n    throw new Error(response.statusText);\n  }\n  const tilesetInfo = await response.json();\n\n  // extract dataset description\n  metadata = {\n    ...metadata,\n    ...tilesetInfo\n  };\n\n  return metadata;\n}\n"],"mappings":"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"}