{"version":3,"file":"tile-3d-batch-table.js","names":["_loaderUtils","require","_tile3dAccessorUtils","_tile3dBatchTableHierarchy","defined","x","undefined","clone","y","IGNORED_PROPERTY_FIELDS","HIERARCHY","extensions","extras","Tile3DBatchTableParser","json","binary","featureCount","_this$json","options","arguments","length","_classCallCheck2","default","_defineProperty2","assert","_extensions","_properties","propertyName","_binaryProperties","_initializeBinaryProperties","_hierarchy","initializeHierarchy","_createClass2","key","value","getExtension","extensionName","memorySizeInBytes","isClass","batchId","className","_checkBatchId","result","traverseHierarchy","hierarchy","instanceIndex","classId","classIds","instanceClass","classes","name","isExactClass","getExactClassName","hasProperty","_hasPropertyInHierarchy","getPropertyNames","results","_results","propertyNames","Object","keys","push","apply","_getPropertyNamesInHierarchy","getProperty","binaryProperty","_getBinaryProperty","propertyValues","hierarchyProperty","_getHierarchyProperty","setProperty","_setBinaryProperty","_setHierarchyProperty","Array","valid","Error","index","unpack","typedArray","pack","binaryProperties","property","_initializeBinaryProperty","tile3DAccessor","concat","type","accessor","createTypedArrayFromAccessor","buffer","byteOffset","values","componentCount","size","unpacker","packer","instances","hasOwnProperty","indexOf","_this","indexInClass","classIndexes","batchTable","_this2","exports"],"sources":["../../../../src/lib/classes/tile-3d-batch-table.ts"],"sourcesContent":["// This file is derived from the Cesium code base under Apache 2 license\n// See LICENSE.md and https://github.com/AnalyticalGraphicsInc/cesium/blob/master/LICENSE.md\n\nimport {assert} from '@loaders.gl/loader-utils';\n\nimport {createTypedArrayFromAccessor} from './helpers/tile-3d-accessor-utils';\nimport {initializeHierarchy, traverseHierarchy} from './tile-3d-batch-table-hierarchy';\n\nfunction defined(x) {\n  return x !== undefined && x !== null;\n}\n\nconst clone = (x, y) => x;\n\n// These top level fields in the batch table json are not properties\nconst IGNORED_PROPERTY_FIELDS = {\n  HIERARCHY: true, // Deprecated HIERARCHY property\n  extensions: true,\n  extras: true\n};\n\n// The size of this array equals the maximum instance count among all loaded tiles, which has the potential to be large.\nexport default class Tile3DBatchTableParser {\n  json;\n  binary;\n  featureCount;\n  _extensions;\n  // Copy all top-level property fields from the json object, ignoring special fields\n  _properties;\n  _binaryProperties;\n  // TODO: hierarchy support is only partially implemented and not tested\n  _hierarchy;\n\n  constructor(json, binary, featureCount, options = {}) {\n    assert(featureCount >= 0);\n    this.json = json || {};\n    this.binary = binary;\n    this.featureCount = featureCount;\n\n    this._extensions = this.json?.extensions || {};\n\n    // Copy all top-level property fields from the json object, ignoring special fields\n    this._properties = {};\n    for (const propertyName in this.json) {\n      if (!IGNORED_PROPERTY_FIELDS[propertyName]) {\n        this._properties[propertyName] = this.json[propertyName];\n      }\n    }\n\n    this._binaryProperties = this._initializeBinaryProperties();\n\n    // TODO: hierarchy support is only partially implemented and not tested\n    if (options['3DTILES_batch_table_hierarchy']) {\n      this._hierarchy = initializeHierarchy(this, this.json, this.binary);\n    }\n  }\n\n  getExtension(extensionName) {\n    return this.json && this.json.extensions && this.json.extensions[extensionName];\n  }\n\n  memorySizeInBytes(): number {\n    return 0;\n  }\n\n  isClass(batchId, className: string): boolean {\n    this._checkBatchId(batchId);\n    assert(typeof className === 'string', className);\n\n    // extension: 3DTILES_batch_table_hierarchy\n    if (this._hierarchy) {\n      // PERFORMANCE_IDEA : cache results in the ancestor classes\n      //   to speed up this check if this area becomes a hotspot\n      // PERFORMANCE_IDEA : treat class names as integers for faster comparisons\n      const result = traverseHierarchy(this._hierarchy, batchId, (hierarchy, instanceIndex) => {\n        const classId = hierarchy.classIds[instanceIndex];\n        const instanceClass = hierarchy.classes[classId];\n        return instanceClass.name === className;\n      });\n      return defined(result);\n    }\n\n    return false;\n  }\n\n  isExactClass(batchId, className) {\n    assert(typeof className === 'string', className);\n\n    return this.getExactClassName(batchId) === className;\n  }\n\n  getExactClassName(batchId) {\n    this._checkBatchId(batchId);\n\n    // extension: 3DTILES_batch_table_hierarchy\n    if (this._hierarchy) {\n      const classId = this._hierarchy.classIds[batchId];\n      const instanceClass = this._hierarchy.classes[classId];\n      return instanceClass.name;\n    }\n\n    return undefined;\n  }\n\n  hasProperty(batchId, name) {\n    this._checkBatchId(batchId);\n    assert(typeof name === 'string', name);\n\n    return defined(this._properties[name]) || this._hasPropertyInHierarchy(batchId, name);\n  }\n\n  getPropertyNames(batchId, results) {\n    this._checkBatchId(batchId);\n\n    results = defined(results) ? results : [];\n    results.length = 0;\n\n    const propertyNames = Object.keys(this._properties);\n    results.push(...propertyNames);\n\n    if (this._hierarchy) {\n      this._getPropertyNamesInHierarchy(batchId, results);\n    }\n\n    return results;\n  }\n\n  getProperty(batchId, name) {\n    this._checkBatchId(batchId);\n    assert(typeof name === 'string', name);\n\n    if (this._binaryProperties) {\n      const binaryProperty = this._binaryProperties[name];\n      if (defined(binaryProperty)) {\n        return this._getBinaryProperty(binaryProperty, batchId);\n      }\n    }\n\n    const propertyValues = this._properties[name];\n    if (defined(propertyValues)) {\n      return clone(propertyValues[batchId], true);\n    }\n\n    // EXTENSION: 3DTILES_batch_table_hierarchy\n    if (this._hierarchy) {\n      const hierarchyProperty = this._getHierarchyProperty(batchId, name);\n      if (defined(hierarchyProperty)) {\n        return hierarchyProperty;\n      }\n    }\n\n    return undefined;\n  }\n\n  setProperty(batchId, name, value) {\n    const featureCount = this.featureCount;\n\n    this._checkBatchId(batchId);\n    assert(typeof name === 'string', name);\n\n    if (this._binaryProperties) {\n      const binaryProperty = this._binaryProperties[name];\n      if (binaryProperty) {\n        this._setBinaryProperty(binaryProperty, batchId, value);\n        return;\n      }\n    }\n\n    // EXTENSION: 3DTILES_batch_table_hierarchy\n    if (this._hierarchy) {\n      if (this._setHierarchyProperty(this, batchId, name, value)) {\n        return;\n      }\n    }\n\n    let propertyValues = this._properties[name];\n    if (!defined(propertyValues)) {\n      // Property does not exist. Create it.\n      this._properties[name] = new Array(featureCount);\n      propertyValues = this._properties[name];\n    }\n\n    propertyValues[batchId] = clone(value, true);\n  }\n\n  // PRIVATE METHODS\n\n  _checkBatchId(batchId) {\n    const valid = batchId >= 0 && batchId < this.featureCount;\n    if (!valid) {\n      throw new Error('batchId not in range [0, featureCount - 1].');\n    }\n  }\n\n  _getBinaryProperty(binaryProperty, index) {\n    return binaryProperty.unpack(binaryProperty.typedArray, index);\n  }\n\n  _setBinaryProperty(binaryProperty, index, value) {\n    binaryProperty.pack(value, binaryProperty.typedArray, index);\n  }\n\n  _initializeBinaryProperties() {\n    let binaryProperties: Record<string, any> | null = null;\n    for (const name in this._properties) {\n      const property = this._properties[name];\n      const binaryProperty = this._initializeBinaryProperty(name, property);\n      // Store any information needed to access the binary data, including the typed array,\n      // componentCount (e.g. a VEC4 would be 4), and the type used to pack and unpack (e.g. Cartesian4).\n      if (binaryProperty) {\n        binaryProperties = binaryProperties || {};\n        binaryProperties[name] = binaryProperty;\n      }\n    }\n    return binaryProperties;\n  }\n\n  _initializeBinaryProperty(name, property) {\n    if ('byteOffset' in property) {\n      // This is a binary property\n      const tile3DAccessor = property;\n\n      assert(this.binary, `Property ${name} requires a batch table binary.`);\n      assert(tile3DAccessor.type, `Property ${name} requires a type.`);\n\n      const accessor = createTypedArrayFromAccessor(\n        tile3DAccessor,\n        this.binary.buffer,\n        this.binary.byteOffset | 0,\n        this.featureCount\n      );\n\n      // Store any information needed to access the binary data, including the typed array,\n      // componentCount (e.g. a VEC4 would be 4), and the type used to pack and unpack (e.g. Cartesian4).\n      return {\n        typedArray: accessor.values,\n        componentCount: accessor.size,\n        unpack: accessor.unpacker,\n        pack: accessor.packer\n      };\n    }\n\n    return null;\n  }\n\n  //  EXTENSION SUPPORT: 3DTILES_batch_table_hierarchy\n\n  _hasPropertyInHierarchy(batchId, name) {\n    if (!this._hierarchy) {\n      return false;\n    }\n\n    const result = traverseHierarchy(this._hierarchy, batchId, (hierarchy, instanceIndex) => {\n      const classId = hierarchy.classIds[instanceIndex];\n      const instances = hierarchy.classes[classId].instances;\n      return defined(instances[name]);\n    });\n\n    return defined(result);\n  }\n\n  _getPropertyNamesInHierarchy(batchId, results) {\n    traverseHierarchy(this._hierarchy, batchId, (hierarchy, instanceIndex) => {\n      const classId = hierarchy.classIds[instanceIndex];\n      const instances = hierarchy.classes[classId].instances;\n      for (const name in instances) {\n        if (instances.hasOwnProperty(name)) {\n          if (results.indexOf(name) === -1) {\n            results.push(name);\n          }\n        }\n      }\n    });\n  }\n\n  _getHierarchyProperty(batchId, name) {\n    return traverseHierarchy(this._hierarchy, batchId, (hierarchy, instanceIndex) => {\n      const classId = hierarchy.classIds[instanceIndex];\n      const instanceClass = hierarchy.classes[classId];\n      const indexInClass = hierarchy.classIndexes[instanceIndex];\n      const propertyValues = instanceClass.instances[name];\n      if (defined(propertyValues)) {\n        if (defined(propertyValues.typedArray)) {\n          return this._getBinaryProperty(propertyValues, indexInClass);\n        }\n        return clone(propertyValues[indexInClass], true);\n      }\n      return null;\n    });\n  }\n\n  _setHierarchyProperty(batchTable, batchId, name, value) {\n    const result = traverseHierarchy(this._hierarchy, batchId, (hierarchy, instanceIndex) => {\n      const classId = hierarchy.classIds[instanceIndex];\n      const instanceClass = hierarchy.classes[classId];\n      const indexInClass = hierarchy.classIndexes[instanceIndex];\n      const propertyValues = instanceClass.instances[name];\n      if (defined(propertyValues)) {\n        assert(instanceIndex === batchId, `Inherited property \"${name}\" is read-only.`);\n        if (defined(propertyValues.typedArray)) {\n          this._setBinaryProperty(propertyValues, indexInClass, value);\n        } else {\n          propertyValues[indexInClass] = clone(value, true);\n        }\n        return true;\n      }\n      return false;\n    });\n    return defined(result);\n  }\n}\n"],"mappings":"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"}