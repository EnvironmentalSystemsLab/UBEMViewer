{"version":3,"file":"decode-quantized-mesh.js","names":["QUANTIZED_MESH_HEADER","Map","Float64Array","BYTES_PER_ELEMENT","Float32Array","decodeZigZag","value","decodeHeader","dataView","position","header","_iterator","_createForOfIteratorHelper","_step","s","n","done","_step$value","_slicedToArray2","default","key","bytesCount","getter","getFloat64","getFloat32","call","err","e","f","headerEndPosition","decodeVertexData","elementsPerVertex","vertexCount","getUint32","vertexData","Uint16Array","Uint32Array","bytesPerArrayElement","elementArrayLength","uArrayStartPosition","vArrayStartPosition","heightArrayStartPosition","u","v","height","i","getUint16","vertexDataEndPosition","decodeIndex","buffer","indicesCount","bytesPerIndex","encoded","arguments","length","undefined","indices","highest","code","decodeTriangleIndices","triangleCount","triangleIndicesCount","triangleIndices","triangleIndicesEndPosition","decodeEdgeIndices","westVertexCount","westIndices","southVertexCount","southIndices","eastVertexCount","eastIndices","northVertexCount","northIndices","edgeIndicesEndPosition","decodeVertexNormalsExtension","extensionDataView","Uint8Array","byteOffset","byteLength","decodeWaterMaskExtension","slice","decodeExtensions","indicesEndPosition","extensions","extensionsEndPosition","extensionId","getUint8","extensionLength","extensionView","DataView","vertexNormals","waterMask","DECODING_STEPS","vertices","edgeIndices","exports","DEFAULT_OPTIONS","maxDecodingStep","decode","data","userOptions","options","Object","assign","view","_decodeHeader","_decodeVertexData","_decodeTriangleIndice","_decodeEdgeIndices","_decodeExtensions"],"sources":["../../../src/lib/decode-quantized-mesh.ts"],"sourcesContent":["// Copyright (C) 2018-2019 HERE Europe B.V.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\n\nconst QUANTIZED_MESH_HEADER = new Map([\n  ['centerX', Float64Array.BYTES_PER_ELEMENT],\n  ['centerY', Float64Array.BYTES_PER_ELEMENT],\n  ['centerZ', Float64Array.BYTES_PER_ELEMENT],\n\n  ['minHeight', Float32Array.BYTES_PER_ELEMENT],\n  ['maxHeight', Float32Array.BYTES_PER_ELEMENT],\n\n  ['boundingSphereCenterX', Float64Array.BYTES_PER_ELEMENT],\n  ['boundingSphereCenterY', Float64Array.BYTES_PER_ELEMENT],\n  ['boundingSphereCenterZ', Float64Array.BYTES_PER_ELEMENT],\n  ['boundingSphereRadius', Float64Array.BYTES_PER_ELEMENT],\n\n  ['horizonOcclusionPointX', Float64Array.BYTES_PER_ELEMENT],\n  ['horizonOcclusionPointY', Float64Array.BYTES_PER_ELEMENT],\n  ['horizonOcclusionPointZ', Float64Array.BYTES_PER_ELEMENT]\n]);\n\nfunction decodeZigZag(value) {\n  return (value >> 1) ^ -(value & 1);\n}\n\nfunction decodeHeader(dataView) {\n  let position = 0;\n  const header = {};\n\n  for (const [key, bytesCount] of QUANTIZED_MESH_HEADER) {\n    const getter = bytesCount === 8 ? dataView.getFloat64 : dataView.getFloat32;\n\n    header[key] = getter.call(dataView, position, true);\n    position += bytesCount;\n  }\n\n  return {header, headerEndPosition: position};\n}\n\nfunction decodeVertexData(dataView, headerEndPosition) {\n  let position = headerEndPosition;\n  const elementsPerVertex = 3;\n  const vertexCount = dataView.getUint32(position, true);\n  const vertexData = new Uint16Array(vertexCount * elementsPerVertex);\n\n  position += Uint32Array.BYTES_PER_ELEMENT;\n\n  const bytesPerArrayElement = Uint16Array.BYTES_PER_ELEMENT;\n  const elementArrayLength = vertexCount * bytesPerArrayElement;\n  const uArrayStartPosition = position;\n  const vArrayStartPosition = uArrayStartPosition + elementArrayLength;\n  const heightArrayStartPosition = vArrayStartPosition + elementArrayLength;\n\n  let u = 0;\n  let v = 0;\n  let height = 0;\n\n  for (let i = 0; i < vertexCount; i++) {\n    u += decodeZigZag(dataView.getUint16(uArrayStartPosition + bytesPerArrayElement * i, true));\n    v += decodeZigZag(dataView.getUint16(vArrayStartPosition + bytesPerArrayElement * i, true));\n    height += decodeZigZag(\n      dataView.getUint16(heightArrayStartPosition + bytesPerArrayElement * i, true)\n    );\n\n    vertexData[i] = u;\n    vertexData[i + vertexCount] = v;\n    vertexData[i + vertexCount * 2] = height;\n  }\n\n  position += elementArrayLength * 3;\n\n  return {vertexData, vertexDataEndPosition: position};\n}\n\nfunction decodeIndex(buffer, position, indicesCount, bytesPerIndex, encoded = true) {\n  let indices;\n\n  if (bytesPerIndex === 2) {\n    indices = new Uint16Array(buffer, position, indicesCount);\n  } else {\n    indices = new Uint32Array(buffer, position, indicesCount);\n  }\n\n  if (!encoded) {\n    return indices;\n  }\n\n  let highest = 0;\n\n  for (let i = 0; i < indices.length; ++i) {\n    const code = indices[i];\n\n    indices[i] = highest - code;\n\n    if (code === 0) {\n      ++highest;\n    }\n  }\n\n  return indices;\n}\n\nfunction decodeTriangleIndices(dataView, vertexData, vertexDataEndPosition) {\n  let position = vertexDataEndPosition;\n  const elementsPerVertex = 3;\n  const vertexCount = vertexData.length / elementsPerVertex;\n  const bytesPerIndex =\n    vertexCount > 65536 ? Uint32Array.BYTES_PER_ELEMENT : Uint16Array.BYTES_PER_ELEMENT;\n\n  if (position % bytesPerIndex !== 0) {\n    position += bytesPerIndex - (position % bytesPerIndex);\n  }\n\n  const triangleCount = dataView.getUint32(position, true);\n  position += Uint32Array.BYTES_PER_ELEMENT;\n\n  const triangleIndicesCount = triangleCount * 3;\n  const triangleIndices = decodeIndex(\n    dataView.buffer,\n    position,\n    triangleIndicesCount,\n    bytesPerIndex\n  );\n  position += triangleIndicesCount * bytesPerIndex;\n\n  return {\n    triangleIndicesEndPosition: position,\n    triangleIndices\n  };\n}\n\nfunction decodeEdgeIndices(dataView, vertexData, triangleIndicesEndPosition) {\n  let position = triangleIndicesEndPosition;\n  const elementsPerVertex = 3;\n  const vertexCount = vertexData.length / elementsPerVertex;\n  const bytesPerIndex =\n    vertexCount > 65536 ? Uint32Array.BYTES_PER_ELEMENT : Uint16Array.BYTES_PER_ELEMENT;\n\n  const westVertexCount = dataView.getUint32(position, true);\n  position += Uint32Array.BYTES_PER_ELEMENT;\n\n  const westIndices = decodeIndex(dataView.buffer, position, westVertexCount, bytesPerIndex, false);\n  position += westVertexCount * bytesPerIndex;\n\n  const southVertexCount = dataView.getUint32(position, true);\n  position += Uint32Array.BYTES_PER_ELEMENT;\n\n  const southIndices = decodeIndex(\n    dataView.buffer,\n    position,\n    southVertexCount,\n    bytesPerIndex,\n    false\n  );\n  position += southVertexCount * bytesPerIndex;\n\n  const eastVertexCount = dataView.getUint32(position, true);\n  position += Uint32Array.BYTES_PER_ELEMENT;\n\n  const eastIndices = decodeIndex(dataView.buffer, position, eastVertexCount, bytesPerIndex, false);\n  position += eastVertexCount * bytesPerIndex;\n\n  const northVertexCount = dataView.getUint32(position, true);\n  position += Uint32Array.BYTES_PER_ELEMENT;\n\n  const northIndices = decodeIndex(\n    dataView.buffer,\n    position,\n    northVertexCount,\n    bytesPerIndex,\n    false\n  );\n  position += northVertexCount * bytesPerIndex;\n\n  return {\n    edgeIndicesEndPosition: position,\n    westIndices,\n    southIndices,\n    eastIndices,\n    northIndices\n  };\n}\n\nfunction decodeVertexNormalsExtension(extensionDataView) {\n  return new Uint8Array(\n    extensionDataView.buffer,\n    extensionDataView.byteOffset,\n    extensionDataView.byteLength\n  );\n}\n\nfunction decodeWaterMaskExtension(extensionDataView) {\n  return extensionDataView.buffer.slice(\n    extensionDataView.byteOffset,\n    extensionDataView.byteOffset + extensionDataView.byteLength\n  );\n}\n\ntype Extensions = {\n  vertexNormals?: any;\n  waterMask?: any;\n};\n\nfunction decodeExtensions(dataView, indicesEndPosition) {\n  const extensions: Extensions = {};\n\n  if (dataView.byteLength <= indicesEndPosition) {\n    return {extensions, extensionsEndPosition: indicesEndPosition};\n  }\n\n  let position = indicesEndPosition;\n\n  while (position < dataView.byteLength) {\n    const extensionId = dataView.getUint8(position, true);\n    position += Uint8Array.BYTES_PER_ELEMENT;\n\n    const extensionLength = dataView.getUint32(position, true);\n    position += Uint32Array.BYTES_PER_ELEMENT;\n\n    const extensionView = new DataView(dataView.buffer, position, extensionLength);\n\n    switch (extensionId) {\n      case 1: {\n        extensions.vertexNormals = decodeVertexNormalsExtension(extensionView);\n\n        break;\n      }\n      case 2: {\n        extensions.waterMask = decodeWaterMaskExtension(extensionView);\n\n        break;\n      }\n      default: {\n        // console.warn(`Unknown extension with id ${extensionId}`)\n      }\n    }\n\n    position += extensionLength;\n  }\n\n  return {extensions, extensionsEndPosition: position};\n}\n\nexport const DECODING_STEPS = {\n  header: 0,\n  vertices: 1,\n  triangleIndices: 2,\n  edgeIndices: 3,\n  extensions: 4\n};\n\nconst DEFAULT_OPTIONS = {\n  maxDecodingStep: DECODING_STEPS.extensions\n};\n\nexport default function decode(data, userOptions) {\n  const options = Object.assign({}, DEFAULT_OPTIONS, userOptions);\n  const view = new DataView(data);\n  const {header, headerEndPosition} = decodeHeader(view);\n\n  if (options.maxDecodingStep < DECODING_STEPS.vertices) {\n    return {header};\n  }\n\n  const {vertexData, vertexDataEndPosition} = decodeVertexData(view, headerEndPosition);\n\n  if (options.maxDecodingStep < DECODING_STEPS.triangleIndices) {\n    return {header, vertexData};\n  }\n\n  const {triangleIndices, triangleIndicesEndPosition} = decodeTriangleIndices(\n    view,\n    vertexData,\n    vertexDataEndPosition\n  );\n\n  if (options.maxDecodingStep < DECODING_STEPS.edgeIndices) {\n    return {header, vertexData, triangleIndices};\n  }\n\n  const {westIndices, southIndices, eastIndices, northIndices, edgeIndicesEndPosition} =\n    decodeEdgeIndices(view, vertexData, triangleIndicesEndPosition);\n\n  if (options.maxDecodingStep < DECODING_STEPS.extensions) {\n    return {\n      header,\n      vertexData,\n      triangleIndices,\n      westIndices,\n      northIndices,\n      eastIndices,\n      southIndices\n    };\n  }\n\n  const {extensions} = decodeExtensions(view, edgeIndicesEndPosition);\n\n  return {\n    header,\n    vertexData,\n    triangleIndices,\n    westIndices,\n    northIndices,\n    eastIndices,\n    southIndices,\n    extensions\n  };\n}\n"],"mappings":"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"}