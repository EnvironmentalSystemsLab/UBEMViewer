{"version":3,"file":"i3s-pending-tiles-register.js","names":["I3SPendingTilesRegister","constructor","_defineProperty","Map","register","viewportId","frameNumber","viewportMap","frameNumberMap","get","oldCount","set","deregister","isZero","_this$frameNumberMap$","count"],"sources":["../../../../src/tileset/format-i3s/i3s-pending-tiles-register.ts"],"sourcesContent":["/**\n * Counter to register pending tile headers for the particular frameNumber\n * Until all tiles are loaded we won't call `onTraversalEnd` callback\n */\nexport class I3SPendingTilesRegister {\n  private frameNumberMap: Map<string, Map<number, number>> = new Map();\n\n  /**\n   * Register a new pending tile header for the particular frameNumber\n   * @param viewportId\n   * @param frameNumber\n   */\n  register(viewportId: string, frameNumber: number) {\n    const viewportMap = this.frameNumberMap.get(viewportId) || new Map();\n    const oldCount = viewportMap.get(frameNumber) || 0;\n    viewportMap.set(frameNumber, oldCount + 1);\n    this.frameNumberMap.set(viewportId, viewportMap);\n  }\n\n  /**\n   * Deregister a pending tile header for the particular frameNumber\n   * @param viewportId\n   * @param frameNumber\n   */\n  deregister(viewportId: string, frameNumber: number) {\n    const viewportMap = this.frameNumberMap.get(viewportId);\n    if (!viewportMap) {\n      return;\n    }\n    const oldCount = viewportMap.get(frameNumber) || 1;\n    viewportMap.set(frameNumber, oldCount - 1);\n  }\n\n  /**\n   * Check is there are no pending tile headers registered for the particular frameNumber\n   * @param viewportId\n   * @param frameNumber\n   * @returns\n   */\n  isZero(viewportId: string, frameNumber: number) {\n    const count = this.frameNumberMap.get(viewportId)?.get(frameNumber) || 0;\n    return count === 0;\n  }\n}\n"],"mappings":";AAIA,OAAO,MAAMA,uBAAuB,CAAC;EAAAC,YAAA;IAAAC,eAAA,yBACwB,IAAIC,GAAG,CAAC,CAAC;EAAA;EAOpEC,QAAQA,CAACC,UAAkB,EAAEC,WAAmB,EAAE;IAChD,MAAMC,WAAW,GAAG,IAAI,CAACC,cAAc,CAACC,GAAG,CAACJ,UAAU,CAAC,IAAI,IAAIF,GAAG,CAAC,CAAC;IACpE,MAAMO,QAAQ,GAAGH,WAAW,CAACE,GAAG,CAACH,WAAW,CAAC,IAAI,CAAC;IAClDC,WAAW,CAACI,GAAG,CAACL,WAAW,EAAEI,QAAQ,GAAG,CAAC,CAAC;IAC1C,IAAI,CAACF,cAAc,CAACG,GAAG,CAACN,UAAU,EAAEE,WAAW,CAAC;EAClD;EAOAK,UAAUA,CAACP,UAAkB,EAAEC,WAAmB,EAAE;IAClD,MAAMC,WAAW,GAAG,IAAI,CAACC,cAAc,CAACC,GAAG,CAACJ,UAAU,CAAC;IACvD,IAAI,CAACE,WAAW,EAAE;MAChB;IACF;IACA,MAAMG,QAAQ,GAAGH,WAAW,CAACE,GAAG,CAACH,WAAW,CAAC,IAAI,CAAC;IAClDC,WAAW,CAACI,GAAG,CAACL,WAAW,EAAEI,QAAQ,GAAG,CAAC,CAAC;EAC5C;EAQAG,MAAMA,CAACR,UAAkB,EAAEC,WAAmB,EAAE;IAAA,IAAAQ,qBAAA;IAC9C,MAAMC,KAAK,GAAG,EAAAD,qBAAA,OAAI,CAACN,cAAc,CAACC,GAAG,CAACJ,UAAU,CAAC,cAAAS,qBAAA,uBAAnCA,qBAAA,CAAqCL,GAAG,CAACH,WAAW,CAAC,KAAI,CAAC;IACxE,OAAOS,KAAK,KAAK,CAAC;EACpB;AACF"}