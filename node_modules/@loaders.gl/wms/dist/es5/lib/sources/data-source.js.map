{"version":3,"file":"data-source.js","names":["DataSource","props","_classCallCheck2","default","_defineProperty2","_objectSpread","loadOptions","fetch","getFetchFunction","_createClass2","key","value","setProps","Object","assign","setNeedsRefresh","_needsRefresh","getNeedsRefresh","clear","arguments","length","undefined","needsRefresh","exports","options","fetchFunction","url","fetchOptions"],"sources":["../../../../src/lib/sources/data-source.ts"],"sourcesContent":["// loaders.gl, MIT license\n\nimport type {LoaderOptions} from '@loaders.gl/loader-utils';\n\nexport type DataSourceProps = {\n  /** LoaderOptions provide an option to override `fetch`. Will also be passed to any sub loaders */\n  loadOptions?: LoaderOptions;\n};\n\n/** base class of all data sources */\nexport abstract class DataSource<PropsT extends DataSourceProps> {\n  /** A resolved fetch function extracted from loadOptions prop */\n  fetch: (url: string, options?: RequestInit) => Promise<Response>;\n  /** The actual load options, if calling a loaders.gl loader */\n  loadOptions: LoaderOptions;\n  _needsRefresh: boolean = true;\n\n  props: PropsT;\n\n  constructor(props: PropsT) {\n    this.props = {...props};\n    this.loadOptions = {...props.loadOptions};\n    this.fetch = getFetchFunction(this.loadOptions);\n  }\n\n  setProps(props: PropsT) {\n    this.props = Object.assign(this.props, props);\n    // TODO - add a shallow compare to avoid setting refresh if no change?\n    this.setNeedsRefresh();\n  }\n\n  /** Mark this data source as needing a refresh (redraw) */\n  setNeedsRefresh(): void {\n    this._needsRefresh = true;\n  }\n\n  /**\n   * Does this data source need refreshing?\n   * @note The specifics of the refresh mechanism depends on type of data source\n   */\n  getNeedsRefresh(clear: boolean = true) {\n    const needsRefresh = this._needsRefresh;\n    if (clear) {\n      this._needsRefresh = false;\n    }\n    return needsRefresh;\n  }\n}\n\n/**\n * Gets the current fetch function from options\n * @todo - move to loader-utils module\n * @todo - use in core module counterpart\n * @param options\n * @param context\n */\nexport function getFetchFunction(options?: LoaderOptions) {\n  const fetchFunction = options?.fetch;\n\n  // options.fetch can be a function\n  if (fetchFunction && typeof fetchFunction === 'function') {\n    return (url: string, fetchOptions?: RequestInit) => fetchFunction(url, fetchOptions);\n  }\n\n  // options.fetch can be an options object, use global fetch with those options\n  const fetchOptions = options?.fetch;\n  if (fetchOptions && typeof fetchOptions !== 'function') {\n    return (url) => fetch(url, fetchOptions);\n  }\n\n  // else return the global fetch function\n  return (url) => fetch(url);\n}\n"],"mappings":";;;;;;;;;;;;;IAUsBA,UAAU;EAS9B,SAAAA,WAAYC,KAAa,EAAE;IAAA,IAAAC,gBAAA,CAAAC,OAAA,QAAAH,UAAA;IAAA,IAAAI,gBAAA,CAAAD,OAAA;IAAA,IAAAC,gBAAA,CAAAD,OAAA;IAAA,IAAAC,gBAAA,CAAAD,OAAA,yBAJF,IAAI;IAAA,IAAAC,gBAAA,CAAAD,OAAA;IAK3B,IAAI,CAACF,KAAK,GAAAI,aAAA,KAAOJ,KAAK,CAAC;IACvB,IAAI,CAACK,WAAW,GAAAD,aAAA,KAAOJ,KAAK,CAACK,WAAW,CAAC;IACzC,IAAI,CAACC,KAAK,GAAGC,gBAAgB,CAAC,IAAI,CAACF,WAAW,CAAC;EACjD;EAAC,IAAAG,aAAA,CAAAN,OAAA,EAAAH,UAAA;IAAAU,GAAA;IAAAC,KAAA,EAED,SAAAC,SAASX,KAAa,EAAE;MACtB,IAAI,CAACA,KAAK,GAAGY,MAAM,CAACC,MAAM,CAAC,IAAI,CAACb,KAAK,EAAEA,KAAK,CAAC;MAE7C,IAAI,CAACc,eAAe,CAAC,CAAC;IACxB;EAAC;IAAAL,GAAA;IAAAC,KAAA,EAGD,SAAAI,gBAAA,EAAwB;MACtB,IAAI,CAACC,aAAa,GAAG,IAAI;IAC3B;EAAC;IAAAN,GAAA;IAAAC,KAAA,EAMD,SAAAM,gBAAA,EAAuC;MAAA,IAAvBC,KAAc,GAAAC,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAG,IAAI;MACnC,IAAMG,YAAY,GAAG,IAAI,CAACN,aAAa;MACvC,IAAIE,KAAK,EAAE;QACT,IAAI,CAACF,aAAa,GAAG,KAAK;MAC5B;MACA,OAAOM,YAAY;IACrB;EAAC;EAAA,OAAAtB,UAAA;AAAA;AAAAuB,OAAA,CAAAvB,UAAA,GAAAA,UAAA;AAUI,SAASQ,gBAAgBA,CAACgB,OAAuB,EAAE;EACxD,IAAMC,aAAa,GAAGD,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEjB,KAAK;EAGpC,IAAIkB,aAAa,IAAI,OAAOA,aAAa,KAAK,UAAU,EAAE;IACxD,OAAO,UAACC,GAAW,EAAEC,YAA0B;MAAA,OAAKF,aAAa,CAACC,GAAG,EAAEC,YAAY,CAAC;IAAA;EACtF;EAGA,IAAMA,YAAY,GAAGH,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEjB,KAAK;EACnC,IAAIoB,YAAY,IAAI,OAAOA,YAAY,KAAK,UAAU,EAAE;IACtD,OAAO,UAACD,GAAG;MAAA,OAAKnB,KAAK,CAACmB,GAAG,EAAEC,YAAY,CAAC;IAAA;EAC1C;EAGA,OAAO,UAACD,GAAG;IAAA,OAAKnB,KAAK,CAACmB,GAAG,CAAC;EAAA;AAC5B"}