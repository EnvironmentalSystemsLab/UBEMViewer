{"version":3,"file":"geojson-tiler.js","names":["_convert","require","_clip","_wrap","_transform","_tile","ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","_defineProperty2","default","getOwnPropertyDescriptors","defineProperties","defineProperty","DEFAULT_OPTIONS","maxZoom","indexMaxZoom","indexMaxPoints","tolerance","extent","buffer","lineMetrics","promoteId","undefined","generateId","debug","GeoJSONTiler","data","options","_classCallCheck2","console","time","Error","features","convert","timeEnd","log","wrap","splitTile","tiles","numFeatures","numPoints","total","JSON","stringify","stats","_createClass2","value","getTile","z","x","y","_this$options","z2","id","toID","transformTile","z0","x0","y0","parent","cz","cx","cy","stack","pop","tile","createTile","tileCoords","numSimplified","concat","zoomSteps","k1","k2","k3","k4","tl","bl","tr","br","left","clip","minX","maxX","right","minY","maxY","exports"],"sources":["../../../../src/lib/geojson-tiler/geojson-tiler.ts"],"sourcesContent":["// loaders.gl, MIT license\n// Forked from https://github.com/mapbox/geojson-vt under compatible ISC license\n\n/* eslint-disable no-console, no-continue */\n\nimport type {GeoJSONTile, GeoJSONTileFeature} from './tile';\n\nimport {convert} from './convert'; // GeoJSON conversion and preprocessing\nimport {clip} from './clip'; // stripe clipping algorithm\nimport {wrap} from './wrap'; // date line processing\nimport {transformTile} from './transform'; // coordinate transformation\nimport {createTile} from './tile'; // final simplified tile generation\n\n/** Options to configure tiling */\nexport type GeoJSONTilerOptions = {\n  maxZoom?: number /** max zoom to preserve detail on */;\n  indexMaxZoom?: number /** max zoom in the tile index */;\n  indexMaxPoints?: number /** max number of points per tile in the tile index */;\n  tolerance?: number /** simplification tolerance (higher means simpler) */;\n  extent?: number /** tile extent */;\n  buffer?: number /** tile buffer on each side */;\n  lineMetrics?: boolean /** whether to calculate line metrics */;\n  promoteId?: string /** name of a feature property to be promoted to feature.id */;\n  generateId?: boolean /** whether to generate feature ids. Cannot be used with promoteId */;\n  debug?: number /** logging level (0, 1 or 2) */;\n};\n\nconst DEFAULT_OPTIONS: Required<GeoJSONTilerOptions> = {\n  maxZoom: 14, // max zoom to preserve detail on\n  indexMaxZoom: 5, // max zoom in the tile index\n  indexMaxPoints: 100000, // max number of points per tile in the tile index\n  tolerance: 3, // simplification tolerance (higher means simpler)\n  extent: 4096, // tile extent\n  buffer: 64, // tile buffer on each side\n  lineMetrics: false, // whether to calculate line metrics\n  // @ts-expect-error Ensures all these required params have defaults\n  promoteId: undefined, // name of a feature property to be promoted to feature.id\n  generateId: false, // whether to generate feature ids. Cannot be used with promoteId\n  debug: 0 // logging level (0, 1 or 2)\n};\n\nexport class GeoJSONTiler {\n  options: Required<GeoJSONTilerOptions>;\n\n  // tiles and tileCoords are part of the public API\n  tiles: Record<string, GeoJSONTile> = {};\n  tileCoords: {x: number; y: number; z: number}[] = [];\n\n  stats: Record<string, number> = {};\n  total: number = 0;\n\n  constructor(data, options?: GeoJSONTilerOptions) {\n    this.options = {...DEFAULT_OPTIONS, ...options};\n    options = this.options;\n\n    const debug = options.debug;\n\n    if (debug) console.time('preprocess data');\n\n    if (this.options.maxZoom < 0 || this.options.maxZoom > 24) {\n      throw new Error('maxZoom should be in the 0-24 range');\n    }\n    if (options.promoteId && this.options.generateId) {\n      throw new Error('promoteId and generateId cannot be used together.');\n    }\n\n    // projects and adds simplification info\n    let features = convert(data, options);\n\n    if (debug) {\n      console.timeEnd('preprocess data');\n      console.log(\n        'index: maxZoom: %d, maxPoints: %d',\n        options.indexMaxZoom,\n        options.indexMaxPoints\n      );\n      console.time('generate tiles');\n    }\n\n    // wraps features (ie extreme west and extreme east)\n    features = wrap(features, this.options);\n\n    // start slicing from the top tile down\n    if (features.length) {\n      this.splitTile(features, 0, 0, 0);\n    }\n\n    if (debug) {\n      if (features.length) {\n        console.log('features: %d, points: %d', this.tiles[0].numFeatures, this.tiles[0].numPoints);\n      }\n      console.timeEnd('generate tiles');\n      console.log('tiles generated:', this.total, JSON.stringify(this.stats));\n    }\n  }\n\n  /**\n   * Get a tile at the specified index\n   * @param z\n   * @param x\n   * @param y\n   * @returns\n   */\n  // eslint-disable-next-line complexity, max-statements\n  getTile(z: number, x: number, y: number): GeoJSONTile | null {\n    // z = +z;\n    // x = +x;\n    // y = +y;\n\n    const {extent, debug} = this.options;\n\n    if (z < 0 || z > 24) {\n      return null;\n    }\n\n    const z2 = 1 << z;\n    x = (x + z2) & (z2 - 1); // wrap tile x coordinate\n\n    const id = toID(z, x, y);\n    if (this.tiles[id]) {\n      return transformTile(this.tiles[id], extent);\n    }\n\n    if (debug > 1) console.log('drilling down to z%d-%d-%d', z, x, y);\n\n    let z0 = z;\n    let x0 = x;\n    let y0 = y;\n    let parent;\n\n    while (!parent && z0 > 0) {\n      z0--;\n      x0 = x0 >> 1;\n      y0 = y0 >> 1;\n      parent = this.tiles[toID(z0, x0, y0)];\n    }\n\n    if (!parent || !parent.source) {\n      return null;\n    }\n\n    // if we found a parent tile containing the original geometry, we can drill down from it\n    if (debug > 1) {\n      console.log('found parent tile z%d-%d-%d', z0, x0, y0);\n      console.time('drilling down');\n    }\n    this.splitTile(parent.source, z0, x0, y0, z, x, y);\n    if (debug > 1) {\n      console.timeEnd('drilling down');\n    }\n\n    return this.tiles[id] ? transformTile(this.tiles[id], extent) : null;\n  }\n\n  /**\n   * splits features from a parent tile to sub-tiles.\n   * @param z, x, and y are the coordinates of the parent tile\n   * @param cz, cx, and cy are the coordinates of the target tile\n   *\n   * If no target tile is specified, splitting stops when we reach the maximum\n   * zoom or the number of points is low as specified in the options.\n   */\n  // eslint-disable-next-line max-params, max-statements, complexity\n  splitTile(\n    features: GeoJSONTileFeature[],\n    z: number,\n    x: number,\n    y: number,\n    cz?: number,\n    cx?: number,\n    cy?: number\n  ): void {\n    const stack: any[] = [features, z, x, y];\n    const options = this.options;\n    const debug = options.debug;\n\n    // avoid recursion by using a processing queue\n    while (stack.length) {\n      y = stack.pop();\n      x = stack.pop();\n      z = stack.pop();\n      features = stack.pop();\n\n      const z2 = 1 << z;\n      const id = toID(z, x, y);\n      let tile = this.tiles[id];\n\n      if (!tile) {\n        if (debug > 1) {\n          console.time('creation');\n        }\n\n        tile = this.tiles[id] = createTile(features, z, x, y, options);\n        this.tileCoords.push({z, x, y});\n\n        if (debug) {\n          if (debug > 1) {\n            console.log(\n              'tile z%d-%d-%d (features: %d, points: %d, simplified: %d)',\n              z,\n              x,\n              y,\n              tile.numFeatures,\n              tile.numPoints,\n              tile.numSimplified\n            );\n            console.timeEnd('creation');\n          }\n          const key = `z${z}`;\n          this.stats[key] = (this.stats[key] || 0) + 1;\n          this.total++;\n        }\n      }\n\n      // save reference to original geometry in tile so that we can drill down later if we stop now\n      tile.source = features;\n\n      // if it's the first-pass tiling\n      if (cz === undefined) {\n        // stop tiling if we reached max zoom, or if the tile is too simple\n        if (z === options.indexMaxZoom || tile.numPoints <= options.indexMaxPoints) continue;\n        // if a drilldown to a specific tile\n      } else if (z === options.maxZoom || z === cz) {\n        // stop tiling if we reached base zoom or our target tile zoom\n        continue;\n      } else if (cz !== undefined) {\n        // stop tiling if it's not an ancestor of the target tile\n        const zoomSteps = cz - z;\n        // @ts-expect-error TODO fix the types of cx cy\n        if (x !== cx >> zoomSteps || y !== cy >> zoomSteps) continue;\n      }\n\n      // if we slice further down, no need to keep source geometry\n      tile.source = null;\n\n      if (features.length === 0) continue;\n\n      if (debug > 1) console.time('clipping');\n\n      // values we'll use for clipping\n      const k1 = (0.5 * options.buffer) / options.extent;\n      const k2 = 0.5 - k1;\n      const k3 = 0.5 + k1;\n      const k4 = 1 + k1;\n\n      let tl: GeoJSONTileFeature[] | null = null;\n      let bl: GeoJSONTileFeature[] | null = null;\n      let tr: GeoJSONTileFeature[] | null = null;\n      let br: GeoJSONTileFeature[] | null = null;\n\n      let left = clip(features, z2, x - k1, x + k3, 0, tile.minX, tile.maxX, options);\n      let right = clip(features, z2, x + k2, x + k4, 0, tile.minX, tile.maxX, options);\n\n      // @ts-expect-error - unclear why this is needed?\n      features = null;\n\n      if (left) {\n        tl = clip(left, z2, y - k1, y + k3, 1, tile.minY, tile.maxY, options);\n        bl = clip(left, z2, y + k2, y + k4, 1, tile.minY, tile.maxY, options);\n        left = null;\n      }\n\n      if (right) {\n        tr = clip(right, z2, y - k1, y + k3, 1, tile.minY, tile.maxY, options);\n        br = clip(right, z2, y + k2, y + k4, 1, tile.minY, tile.maxY, options);\n        right = null;\n      }\n\n      if (debug > 1) console.timeEnd('clipping');\n\n      stack.push(tl || [], z + 1, x * 2, y * 2);\n      stack.push(bl || [], z + 1, x * 2, y * 2 + 1);\n      stack.push(tr || [], z + 1, x * 2 + 1, y * 2);\n      stack.push(br || [], z + 1, x * 2 + 1, y * 2 + 1);\n    }\n  }\n}\n\nfunction toID(z, x, y) {\n  return ((1 << z) * y + x) * 32 + z;\n}\n"],"mappings":"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"}