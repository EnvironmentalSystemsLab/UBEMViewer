{"version":3,"file":"extract-geometry-info.js","names":["extractGeometryInfo","features","pointPositionsCount","pointFeaturesCount","linePositionsCount","linePathsCount","lineFeaturesCount","polygonPositionsCount","polygonObjectsCount","polygonRingsCount","polygonFeaturesCount","coordLengths","Set","_iterator","_createForOfIteratorHelper","_step","s","n","done","feature","value","geometry","type","add","coordinates","length","_iterator2","_step2","point","err","e","f","_iterator3","_step3","coord","_iterator4","_step4","line","_iterator5","_step5","flattened","flat","_iterator6","_step6","_iterator7","_step7","polygon","_iterator8","_step8","Error","concat","coordLength","size","Math","max","apply","_toConsumableArray2","default"],"sources":["../../../src/lib/extract-geometry-info.ts"],"sourcesContent":["import {Feature, GeojsonGeometryInfo} from '@loaders.gl/schema';\n\n/**\n *  Initial scan over GeoJSON features\n *  Counts number of coordinates of each geometry type and\n *  keeps track of the max coordinate dimensions\n */\n// eslint-disable-next-line complexity, max-statements\nexport function extractGeometryInfo(features: Feature[]): GeojsonGeometryInfo {\n  // Counts the number of _positions_, so [x, y, z] counts as one\n  let pointPositionsCount = 0;\n  let pointFeaturesCount = 0;\n  let linePositionsCount = 0;\n  let linePathsCount = 0;\n  let lineFeaturesCount = 0;\n  let polygonPositionsCount = 0;\n  let polygonObjectsCount = 0;\n  let polygonRingsCount = 0;\n  let polygonFeaturesCount = 0;\n  const coordLengths = new Set<number>();\n\n  for (const feature of features) {\n    const geometry = feature.geometry;\n    switch (geometry.type) {\n      case 'Point':\n        pointFeaturesCount++;\n        pointPositionsCount++;\n        coordLengths.add(geometry.coordinates.length);\n        break;\n      case 'MultiPoint':\n        pointFeaturesCount++;\n        pointPositionsCount += geometry.coordinates.length;\n        for (const point of geometry.coordinates) {\n          coordLengths.add(point.length);\n        }\n        break;\n      case 'LineString':\n        lineFeaturesCount++;\n        linePositionsCount += geometry.coordinates.length;\n        linePathsCount++;\n\n        for (const coord of geometry.coordinates) {\n          coordLengths.add(coord.length);\n        }\n        break;\n      case 'MultiLineString':\n        lineFeaturesCount++;\n        for (const line of geometry.coordinates) {\n          linePositionsCount += line.length;\n          linePathsCount++;\n\n          // eslint-disable-next-line max-depth\n          for (const coord of line) {\n            coordLengths.add(coord.length);\n          }\n        }\n        break;\n      case 'Polygon':\n        polygonFeaturesCount++;\n        polygonObjectsCount++;\n        polygonRingsCount += geometry.coordinates.length;\n        const flattened = geometry.coordinates.flat();\n        polygonPositionsCount += flattened.length;\n\n        for (const coord of flattened) {\n          coordLengths.add(coord.length);\n        }\n        break;\n      case 'MultiPolygon':\n        polygonFeaturesCount++;\n        for (const polygon of geometry.coordinates) {\n          polygonObjectsCount++;\n          polygonRingsCount += polygon.length;\n          const flattened = polygon.flat();\n          polygonPositionsCount += flattened.length;\n\n          // eslint-disable-next-line max-depth\n          for (const coord of flattened) {\n            coordLengths.add(coord.length);\n          }\n        }\n        break;\n      default:\n        throw new Error(`Unsupported geometry type: ${geometry.type}`);\n    }\n  }\n\n  return {\n    coordLength: coordLengths.size > 0 ? Math.max(...coordLengths) : 2,\n\n    pointPositionsCount,\n    pointFeaturesCount,\n    linePositionsCount,\n    linePathsCount,\n    lineFeaturesCount,\n    polygonPositionsCount,\n    polygonObjectsCount,\n    polygonRingsCount,\n    polygonFeaturesCount\n  };\n}\n"],"mappings":"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"}