(function webpackUniversalModuleDefinition(root, factory) {
  if (typeof exports === 'object' && typeof module === 'object')
    module.exports = factory();
  else if (typeof define === 'function' && define.amd) define([], factory);
        else if (typeof exports === 'object') exports['deck'] = factory();
  else root['deck'] = factory();})(globalThis, function () {
"use strict";var __exports__=(()=>{var Ice=Object.create;var fv=Object.defineProperty;var Rce=Object.getOwnPropertyDescriptor;var Lce=Object.getOwnPropertyNames;var kce=Object.getPrototypeOf,Bce=Object.prototype.hasOwnProperty;var QI=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(r,e)=>(typeof require<"u"?require:r)[e]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+t+'" is not supported')});var Te=(t,r)=>()=>(r||t((r={exports:{}}).exports,r),r.exports),un=(t,r)=>{for(var e in r)fv(t,e,{get:r[e],enumerable:!0})},eR=(t,r,e,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let i of Lce(r))!Bce.call(t,i)&&i!==e&&fv(t,i,{get:()=>r[i],enumerable:!(n=Rce(r,i))||n.enumerable});return t};var h=(t,r,e)=>(e=t!=null?Ice(kce(t)):{},eR(r||!t||!t.__esModule?fv(e,"default",{value:t,enumerable:!0}):e,t)),Fce=t=>eR(fv({},"__esModule",{value:!0}),t);var rR=Te((NDe,tR)=>{function Dce(t){if(Array.isArray(t))return t}tR.exports=Dce});var iR=Te((jDe,nR)=>{function Nce(t,r){if(Symbol.iterator in Object(t)||Object.prototype.toString.call(t)==="[object Arguments]"){var e=[],n=!0,i=!1,a=void 0;try{for(var o=t[Symbol.iterator](),s;!(n=(s=o.next()).done)&&(e.push(s.value),!(r&&e.length===r));n=!0);}catch(u){i=!0,a=u}finally{try{!n&&o.return!=null&&o.return()}finally{if(i)throw a}}return e}}nR.exports=Nce});var oR=Te((UDe,aR)=>{function jce(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}aR.exports=jce});var me=Te((GDe,sR)=>{var Uce=rR(),Gce=iR(),zce=oR();function Vce(t,r){return Uce(t)||Gce(t,r)||zce()}sR.exports=Vce});var ye=Te((zDe,lR)=>{function uR(t,r,e,n,i,a,o){try{var s=t[a](o),u=s.value}catch(l){e(l);return}s.done?r(u):Promise.resolve(u).then(n,i)}function Hce(t){return function(){var r=this,e=arguments;return new Promise(function(n,i){var a=t.apply(r,e);function o(u){uR(a,n,i,o,s,"next",u)}function s(u){uR(a,n,i,o,s,"throw",u)}o(void 0)})}}lR.exports=Hce});var L=Te((VDe,fR)=>{function Wce(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}fR.exports=Wce});var N=Te((HDe,pR)=>{function cR(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function $ce(t,r,e){return r&&cR(t.prototype,r),e&&cR(t,e),t}pR.exports=$ce});var be=Te((WDe,hR)=>{function Xce(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}hR.exports=Xce});var q=Te(($De,d1)=>{function h1(t){return d1.exports=h1=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},h1(t)}d1.exports=h1});var vR=Te((XDe,dR)=>{var qce=q();function Yce(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&(t=qce(t),t!==null););return t}dR.exports=Yce});var Ee=Te((qDe,pv)=>{var Kce=vR();function cv(t,r,e){return typeof Reflect<"u"&&Reflect.get?pv.exports=cv=Reflect.get:pv.exports=cv=function(i,a,o){var s=Kce(i,a);if(s){var u=Object.getOwnPropertyDescriptor(s,a);return u.get?u.get.call(o):u.value}},cv(t,r,e||t)}pv.exports=cv});var g1=Te((YDe,m1)=>{function v1(t,r){return m1.exports=v1=Object.setPrototypeOf||function(n,i){return n.__proto__=i,n},v1(t,r)}m1.exports=v1});var Y=Te((KDe,mR)=>{var Zce=g1();function Jce(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&Zce(t,r)}mR.exports=Jce});var ze=Te((ZDe,dv)=>{function hv(t){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?dv.exports=hv=function(e){return typeof e}:dv.exports=hv=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},hv(t)}dv.exports=hv});var K=Te((JDe,gR)=>{var Qce=ze(),epe=be();function tpe(t,r){return r&&(Qce(r)==="object"||typeof r=="function")?r:epe(t)}gR.exports=tpe});var B=Te((QDe,yR)=>{function rpe(t,r,e){return r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e,t}yR.exports=rpe});var bR=Te((eNe,y1)=>{var _R=function(t){"use strict";var r=Object.prototype,e=r.hasOwnProperty,n,i=typeof Symbol=="function"?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(k,G,U,$){var H=G&&G.prototype instanceof m?G:m,Q=Object.create(H.prototype),ie=new R($||[]);return Q._invoke=O(k,U,ie),Q}t.wrap=u;function l(k,G,U){try{return{type:"normal",arg:k.call(G,U)}}catch($){return{type:"throw",arg:$}}}var f="suspendedStart",c="suspendedYield",p="executing",d="completed",v={};function m(){}function g(){}function y(){}var _={};_[a]=function(){return this};var b=Object.getPrototypeOf,x=b&&b(b(V([])));x&&x!==r&&e.call(x,a)&&(_=x);var A=y.prototype=m.prototype=Object.create(_);g.prototype=A.constructor=y,y.constructor=g,y[s]=g.displayName="GeneratorFunction";function S(k){["next","throw","return"].forEach(function(G){k[G]=function(U){return this._invoke(G,U)}})}t.isGeneratorFunction=function(k){var G=typeof k=="function"&&k.constructor;return G?G===g||(G.displayName||G.name)==="GeneratorFunction":!1},t.mark=function(k){return Object.setPrototypeOf?Object.setPrototypeOf(k,y):(k.__proto__=y,s in k||(k[s]="GeneratorFunction")),k.prototype=Object.create(A),k},t.awrap=function(k){return{__await:k}};function P(k){function G(H,Q,ie,fe){var Ae=l(k[H],k,Q);if(Ae.type==="throw")fe(Ae.arg);else{var Oe=Ae.arg,Xe=Oe.value;return Xe&&typeof Xe=="object"&&e.call(Xe,"__await")?Promise.resolve(Xe.__await).then(function(ge){G("next",ge,ie,fe)},function(ge){G("throw",ge,ie,fe)}):Promise.resolve(Xe).then(function(ge){Oe.value=ge,ie(Oe)},function(ge){return G("throw",ge,ie,fe)})}}var U;function $(H,Q){function ie(){return new Promise(function(fe,Ae){G(H,Q,fe,Ae)})}return U=U?U.then(ie,ie):ie()}this._invoke=$}S(P.prototype),P.prototype[o]=function(){return this},t.AsyncIterator=P,t.async=function(k,G,U,$){var H=new P(u(k,G,U,$));return t.isGeneratorFunction(G)?H:H.next().then(function(Q){return Q.done?Q.value:H.next()})};function O(k,G,U){var $=f;return function(Q,ie){if($===p)throw new Error("Generator is already running");if($===d){if(Q==="throw")throw ie;return z()}for(U.method=Q,U.arg=ie;;){var fe=U.delegate;if(fe){var Ae=C(fe,U);if(Ae){if(Ae===v)continue;return Ae}}if(U.method==="next")U.sent=U._sent=U.arg;else if(U.method==="throw"){if($===f)throw $=d,U.arg;U.dispatchException(U.arg)}else U.method==="return"&&U.abrupt("return",U.arg);$=p;var Oe=l(k,G,U);if(Oe.type==="normal"){if($=U.done?d:c,Oe.arg===v)continue;return{value:Oe.arg,done:U.done}}else Oe.type==="throw"&&($=d,U.method="throw",U.arg=Oe.arg)}}}function C(k,G){var U=k.iterator[G.method];if(U===n){if(G.delegate=null,G.method==="throw"){if(k.iterator.return&&(G.method="return",G.arg=n,C(k,G),G.method==="throw"))return v;G.method="throw",G.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var $=l(U,k.iterator,G.arg);if($.type==="throw")return G.method="throw",G.arg=$.arg,G.delegate=null,v;var H=$.arg;if(!H)return G.method="throw",G.arg=new TypeError("iterator result is not an object"),G.delegate=null,v;if(H.done)G[k.resultName]=H.value,G.next=k.nextLoc,G.method!=="return"&&(G.method="next",G.arg=n);else return H;return G.delegate=null,v}S(A),A[s]="Generator",A[a]=function(){return this},A.toString=function(){return"[object Generator]"};function T(k){var G={tryLoc:k[0]};1 in k&&(G.catchLoc=k[1]),2 in k&&(G.finallyLoc=k[2],G.afterLoc=k[3]),this.tryEntries.push(G)}function I(k){var G=k.completion||{};G.type="normal",delete G.arg,k.completion=G}function R(k){this.tryEntries=[{tryLoc:"root"}],k.forEach(T,this),this.reset(!0)}t.keys=function(k){var G=[];for(var U in k)G.push(U);return G.reverse(),function $(){for(;G.length;){var H=G.pop();if(H in k)return $.value=H,$.done=!1,$}return $.done=!0,$}};function V(k){if(k){var G=k[a];if(G)return G.call(k);if(typeof k.next=="function")return k;if(!isNaN(k.length)){var U=-1,$=function H(){for(;++U<k.length;)if(e.call(k,U))return H.value=k[U],H.done=!1,H;return H.value=n,H.done=!0,H};return $.next=$}}return{next:z}}t.values=V;function z(){return{value:n,done:!0}}return R.prototype={constructor:R,reset:function(k){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(I),!k)for(var G in this)G.charAt(0)==="t"&&e.call(this,G)&&!isNaN(+G.slice(1))&&(this[G]=n)},stop:function(){this.done=!0;var k=this.tryEntries[0],G=k.completion;if(G.type==="throw")throw G.arg;return this.rval},dispatchException:function(k){if(this.done)throw k;var G=this;function U(Ae,Oe){return Q.type="throw",Q.arg=k,G.next=Ae,Oe&&(G.method="next",G.arg=n),!!Oe}for(var $=this.tryEntries.length-1;$>=0;--$){var H=this.tryEntries[$],Q=H.completion;if(H.tryLoc==="root")return U("end");if(H.tryLoc<=this.prev){var ie=e.call(H,"catchLoc"),fe=e.call(H,"finallyLoc");if(ie&&fe){if(this.prev<H.catchLoc)return U(H.catchLoc,!0);if(this.prev<H.finallyLoc)return U(H.finallyLoc)}else if(ie){if(this.prev<H.catchLoc)return U(H.catchLoc,!0)}else if(fe){if(this.prev<H.finallyLoc)return U(H.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(k,G){for(var U=this.tryEntries.length-1;U>=0;--U){var $=this.tryEntries[U];if($.tryLoc<=this.prev&&e.call($,"finallyLoc")&&this.prev<$.finallyLoc){var H=$;break}}H&&(k==="break"||k==="continue")&&H.tryLoc<=G&&G<=H.finallyLoc&&(H=null);var Q=H?H.completion:{};return Q.type=k,Q.arg=G,H?(this.method="next",this.next=H.finallyLoc,v):this.complete(Q)},complete:function(k,G){if(k.type==="throw")throw k.arg;return k.type==="break"||k.type==="continue"?this.next=k.arg:k.type==="return"?(this.rval=this.arg=k.arg,this.method="return",this.next="end"):k.type==="normal"&&G&&(this.next=G),v},finish:function(k){for(var G=this.tryEntries.length-1;G>=0;--G){var U=this.tryEntries[G];if(U.finallyLoc===k)return this.complete(U.completion,U.afterLoc),I(U),v}},catch:function(k){for(var G=this.tryEntries.length-1;G>=0;--G){var U=this.tryEntries[G];if(U.tryLoc===k){var $=U.completion;if($.type==="throw"){var H=$.arg;I(U)}return H}}throw new Error("illegal catch attempt")},delegateYield:function(k,G,U){return this.delegate={iterator:V(k),resultName:G,nextLoc:U},this.method==="next"&&(this.arg=n),v}},t}(typeof y1=="object"?y1.exports:{});try{regeneratorRuntime=_R}catch{Function("r","regeneratorRuntime = r")(_R)}});var ve=Te((tNe,xR)=>{xR.exports=bR()});var mv=Te((NNe,rL)=>{function dpe(t){var r;if(typeof Symbol<"u"&&(Symbol.asyncIterator&&(r=t[Symbol.asyncIterator],r!=null)||Symbol.iterator&&(r=t[Symbol.iterator],r!=null)))return r.call(t);throw new TypeError("Object is not async iterable")}rL.exports=dpe});var nL=Te(()=>{});var U1=Te((lje,uL)=>{function xpe(t){this.wrapped=t}uL.exports=xpe});var G1=Te((fje,lL)=>{var Ape=U1();function Spe(t){return new Ape(t)}lL.exports=Spe});var cL=Te((cje,fL)=>{var Tpe=U1();function Fc(t){var r,e;function n(o,s){return new Promise(function(u,l){var f={key:o,arg:s,resolve:u,reject:l,next:null};e?e=e.next=f:(r=e=f,i(o,s))})}function i(o,s){try{var u=t[o](s),l=u.value,f=l instanceof Tpe;Promise.resolve(f?l.wrapped:l).then(function(c){if(f){i(o==="return"?"return":"next",c);return}a(u.done?"return":"normal",c)},function(c){i("throw",c)})}catch(c){a("throw",c)}}function a(o,s){switch(o){case"return":r.resolve({value:s,done:!0});break;case"throw":r.reject(s);break;default:r.resolve({value:s,done:!1});break}r=r.next,r?i(r.key,r.arg):e=null}this._invoke=n,typeof t.return!="function"&&(this.return=void 0)}typeof Symbol=="function"&&Symbol.asyncIterator&&(Fc.prototype[Symbol.asyncIterator]=function(){return this});Fc.prototype.next=function(t){return this._invoke("next",t)};Fc.prototype.throw=function(t){return this._invoke("throw",t)};Fc.prototype.return=function(t){return this._invoke("return",t)};fL.exports=Fc});var z1=Te((pje,pL)=>{var wpe=cL();function Ppe(t){return function(){return new wpe(t.apply(this,arguments))}}pL.exports=Ppe});var nk=Te((sUe,rk)=>{function fhe(t){if(Array.isArray(t)){for(var r=0,e=new Array(t.length);r<t.length;r++)e[r]=t[r];return e}}rk.exports=fhe});var ak=Te((uUe,ik)=>{function che(t){if(Symbol.iterator in Object(t)||Object.prototype.toString.call(t)==="[object Arguments]")return Array.from(t)}ik.exports=che});var sk=Te((lUe,ok)=>{function phe(){throw new TypeError("Invalid attempt to spread non-iterable instance")}ok.exports=phe});var Zt=Te((fUe,uk)=>{var hhe=nk(),dhe=ak(),vhe=sk();function mhe(t){return hhe(t)||dhe(t)||vhe()}uk.exports=mhe});var qB=Te((dVe,Wv)=>{var hve=g1();function dve(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function Hv(t,r,e){return dve()?Wv.exports=Hv=Reflect.construct:Wv.exports=Hv=function(i,a,o){var s=[null];s.push.apply(s,a);var u=Function.bind.apply(i,s),l=new u;return o&&hve(l,o.prototype),l},Hv.apply(null,arguments)}Wv.exports=Hv});var qG=Te((LJe,Ng)=>{(function(t,r,e,n){"use strict";var i=["","webkit","Moz","MS","ms","o"],a=r.createElement("div"),o="function",s=Math.round,u=Math.abs,l=Date.now;function f(E,M,F){return setTimeout(_(E,F),M)}function c(E,M,F){return Array.isArray(E)?(p(E,F[M],F),!0):!1}function p(E,M,F){var X;if(E)if(E.forEach)E.forEach(M,F);else if(E.length!==n)for(X=0;X<E.length;)M.call(F,E[X],X,E),X++;else for(X in E)E.hasOwnProperty(X)&&M.call(F,E[X],X,E)}function d(E,M,F){var X="DEPRECATED METHOD: "+M+`
`+F+` AT 
`;return function(){var ee=new Error("get-stack-trace"),de=ee&&ee.stack?ee.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Ge=t.console&&(t.console.warn||t.console.log);return Ge&&Ge.call(t.console,X,de),E.apply(this,arguments)}}var v;typeof Object.assign!="function"?v=function(M){if(M===n||M===null)throw new TypeError("Cannot convert undefined or null to object");for(var F=Object(M),X=1;X<arguments.length;X++){var ee=arguments[X];if(ee!==n&&ee!==null)for(var de in ee)ee.hasOwnProperty(de)&&(F[de]=ee[de])}return F}:v=Object.assign;var m=d(function(M,F,X){for(var ee=Object.keys(F),de=0;de<ee.length;)(!X||X&&M[ee[de]]===n)&&(M[ee[de]]=F[ee[de]]),de++;return M},"extend","Use `assign`."),g=d(function(M,F){return m(M,F,!0)},"merge","Use `assign`.");function y(E,M,F){var X=M.prototype,ee;ee=E.prototype=Object.create(X),ee.constructor=E,ee._super=X,F&&v(ee,F)}function _(E,M){return function(){return E.apply(M,arguments)}}function b(E,M){return typeof E==o?E.apply(M&&M[0]||n,M):E}function x(E,M){return E===n?M:E}function A(E,M,F){p(C(M),function(X){E.addEventListener(X,F,!1)})}function S(E,M,F){p(C(M),function(X){E.removeEventListener(X,F,!1)})}function P(E,M){for(;E;){if(E==M)return!0;E=E.parentNode}return!1}function O(E,M){return E.indexOf(M)>-1}function C(E){return E.trim().split(/\s+/g)}function T(E,M,F){if(E.indexOf&&!F)return E.indexOf(M);for(var X=0;X<E.length;){if(F&&E[X][F]==M||!F&&E[X]===M)return X;X++}return-1}function I(E){return Array.prototype.slice.call(E,0)}function R(E,M,F){for(var X=[],ee=[],de=0;de<E.length;){var Ge=M?E[de][M]:E[de];T(ee,Ge)<0&&X.push(E[de]),ee[de]=Ge,de++}return F&&(M?X=X.sort(function(yr,Rr){return yr[M]>Rr[M]}):X=X.sort()),X}function V(E,M){for(var F,X,ee=M[0].toUpperCase()+M.slice(1),de=0;de<i.length;){if(F=i[de],X=F?F+ee:M,X in E)return X;de++}return n}var z=1;function k(){return z++}function G(E){var M=E.ownerDocument||E;return M.defaultView||M.parentWindow||t}var U=/mobile|tablet|ip(ad|hone|od)|android/i,$="ontouchstart"in t,H=V(t,"PointerEvent")!==n,Q=$&&U.test(navigator.userAgent),ie="touch",fe="pen",Ae="mouse",Oe="kinect",Xe=25,ge=1,qe=2,Ie=4,Et=8,Wn=1,sn=2,no=4,zt=8,fr=16,et=sn|no,$n=zt|fr,Xn=et|$n,qn=["x","y"],Hu=["clientX","clientY"];function $r(E,M){var F=this;this.manager=E,this.callback=M,this.element=E.element,this.target=E.options.inputTarget,this.domHandler=function(X){b(E.options.enable,[E])&&F.handler(X)},this.init()}$r.prototype={handler:function(){},init:function(){this.evEl&&A(this.element,this.evEl,this.domHandler),this.evTarget&&A(this.target,this.evTarget,this.domHandler),this.evWin&&A(G(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&S(this.element,this.evEl,this.domHandler),this.evTarget&&S(this.target,this.evTarget,this.domHandler),this.evWin&&S(G(this.element),this.evWin,this.domHandler)}};function wc(E){var M,F=E.options.inputClass;return F?M=F:H?M=i1:Q?M=iv:$?M=a1:M=nv,new M(E,e1)}function e1(E,M,F){var X=F.pointers.length,ee=F.changedPointers.length,de=M&ge&&X-ee===0,Ge=M&(Ie|Et)&&X-ee===0;F.isFirst=!!de,F.isFinal=!!Ge,de&&(E.session={}),F.eventType=M,t1(E,F),E.emit("hammer.input",F),E.recognize(F),E.session.prevInput=F}function t1(E,M){var F=E.session,X=M.pointers,ee=X.length;F.firstInput||(F.firstInput=tv(M)),ee>1&&!F.firstMultiple?F.firstMultiple=tv(M):ee===1&&(F.firstMultiple=!1);var de=F.firstInput,Ge=F.firstMultiple,cr=Ge?Ge.center:de.center,yr=M.center=rv(X);M.timeStamp=l(),M.deltaTime=M.timeStamp-de.timeStamp,M.angle=is(cr,yr),M.distance=oa(cr,yr),r1(F,M),M.offsetDirection=ns(M.deltaX,M.deltaY);var Rr=rs(M.deltaTime,M.deltaX,M.deltaY);M.overallVelocityX=Rr.x,M.overallVelocityY=Rr.y,M.overallVelocity=u(Rr.x)>u(Rr.y)?Rr.x:Rr.y,M.scale=Ge?fce(Ge.pointers,X):1,M.rotation=Ge?lce(Ge.pointers,X):0,M.maxPointers=F.prevInput?M.pointers.length>F.prevInput.maxPointers?M.pointers.length:F.prevInput.maxPointers:M.pointers.length,n1(F,M);var wi=E.element;P(M.srcEvent.target,wi)&&(wi=M.srcEvent.target),M.target=wi}function r1(E,M){var F=M.center,X=E.offsetDelta||{},ee=E.prevDelta||{},de=E.prevInput||{};(M.eventType===ge||de.eventType===Ie)&&(ee=E.prevDelta={x:de.deltaX||0,y:de.deltaY||0},X=E.offsetDelta={x:F.x,y:F.y}),M.deltaX=ee.x+(F.x-X.x),M.deltaY=ee.y+(F.y-X.y)}function n1(E,M){var F=E.lastInterval||M,X=M.timeStamp-F.timeStamp,ee,de,Ge,cr;if(M.eventType!=Et&&(X>Xe||F.velocity===n)){var yr=M.deltaX-F.deltaX,Rr=M.deltaY-F.deltaY,wi=rs(X,yr,Rr);de=wi.x,Ge=wi.y,ee=u(wi.x)>u(wi.y)?wi.x:wi.y,cr=ns(yr,Rr),E.lastInterval=M}else ee=F.velocity,de=F.velocityX,Ge=F.velocityY,cr=F.direction;M.velocity=ee,M.velocityX=de,M.velocityY=Ge,M.direction=cr}function tv(E){for(var M=[],F=0;F<E.pointers.length;)M[F]={clientX:s(E.pointers[F].clientX),clientY:s(E.pointers[F].clientY)},F++;return{timeStamp:l(),pointers:M,center:rv(M),deltaX:E.deltaX,deltaY:E.deltaY}}function rv(E){var M=E.length;if(M===1)return{x:s(E[0].clientX),y:s(E[0].clientY)};for(var F=0,X=0,ee=0;ee<M;)F+=E[ee].clientX,X+=E[ee].clientY,ee++;return{x:s(F/M),y:s(X/M)}}function rs(E,M,F){return{x:M/E||0,y:F/E||0}}function ns(E,M){return E===M?Wn:u(E)>=u(M)?E<0?sn:no:M<0?zt:fr}function oa(E,M,F){F||(F=qn);var X=M[F[0]]-E[F[0]],ee=M[F[1]]-E[F[1]];return Math.sqrt(X*X+ee*ee)}function is(E,M,F){F||(F=qn);var X=M[F[0]]-E[F[0]],ee=M[F[1]]-E[F[1]];return Math.atan2(ee,X)*180/Math.PI}function lce(E,M){return is(M[1],M[0],Hu)+is(E[1],E[0],Hu)}function fce(E,M){return oa(M[0],M[1],Hu)/oa(E[0],E[1],Hu)}var cce={mousedown:ge,mousemove:qe,mouseup:Ie},pce="mousedown",hce="mousemove mouseup";function nv(){this.evEl=pce,this.evWin=hce,this.pressed=!1,$r.apply(this,arguments)}y(nv,$r,{handler:function(M){var F=cce[M.type];F&ge&&M.button===0&&(this.pressed=!0),F&qe&&M.which!==1&&(F=Ie),this.pressed&&(F&Ie&&(this.pressed=!1),this.callback(this.manager,F,{pointers:[M],changedPointers:[M],pointerType:Ae,srcEvent:M}))}});var dce={pointerdown:ge,pointermove:qe,pointerup:Ie,pointercancel:Et,pointerout:Et},vce={2:ie,3:fe,4:Ae,5:Oe},UI="pointerdown",GI="pointermove pointerup pointercancel";t.MSPointerEvent&&!t.PointerEvent&&(UI="MSPointerDown",GI="MSPointerMove MSPointerUp MSPointerCancel");function i1(){this.evEl=UI,this.evWin=GI,$r.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}y(i1,$r,{handler:function(M){var F=this.store,X=!1,ee=M.type.toLowerCase().replace("ms",""),de=dce[ee],Ge=vce[M.pointerType]||M.pointerType,cr=Ge==ie,yr=T(F,M.pointerId,"pointerId");de&ge&&(M.button===0||cr)?yr<0&&(F.push(M),yr=F.length-1):de&(Ie|Et)&&(X=!0),!(yr<0)&&(F[yr]=M,this.callback(this.manager,de,{pointers:F,changedPointers:[M],pointerType:Ge,srcEvent:M}),X&&F.splice(yr,1))}});var mce={touchstart:ge,touchmove:qe,touchend:Ie,touchcancel:Et},gce="touchstart",yce="touchstart touchmove touchend touchcancel";function zI(){this.evTarget=gce,this.evWin=yce,this.started=!1,$r.apply(this,arguments)}y(zI,$r,{handler:function(M){var F=mce[M.type];if(F===ge&&(this.started=!0),!!this.started){var X=_ce.call(this,M,F);F&(Ie|Et)&&X[0].length-X[1].length===0&&(this.started=!1),this.callback(this.manager,F,{pointers:X[0],changedPointers:X[1],pointerType:ie,srcEvent:M})}}});function _ce(E,M){var F=I(E.touches),X=I(E.changedTouches);return M&(Ie|Et)&&(F=R(F.concat(X),"identifier",!0)),[F,X]}var bce={touchstart:ge,touchmove:qe,touchend:Ie,touchcancel:Et},xce="touchstart touchmove touchend touchcancel";function iv(){this.evTarget=xce,this.targetIds={},$r.apply(this,arguments)}y(iv,$r,{handler:function(M){var F=bce[M.type],X=Ace.call(this,M,F);X&&this.callback(this.manager,F,{pointers:X[0],changedPointers:X[1],pointerType:ie,srcEvent:M})}});function Ace(E,M){var F=I(E.touches),X=this.targetIds;if(M&(ge|qe)&&F.length===1)return X[F[0].identifier]=!0,[F,F];var ee,de,Ge=I(E.changedTouches),cr=[],yr=this.target;if(de=F.filter(function(Rr){return P(Rr.target,yr)}),M===ge)for(ee=0;ee<de.length;)X[de[ee].identifier]=!0,ee++;for(ee=0;ee<Ge.length;)X[Ge[ee].identifier]&&cr.push(Ge[ee]),M&(Ie|Et)&&delete X[Ge[ee].identifier],ee++;if(cr.length)return[R(de.concat(cr),"identifier",!0),cr]}var Sce=2500,VI=25;function a1(){$r.apply(this,arguments);var E=_(this.handler,this);this.touch=new iv(this.manager,E),this.mouse=new nv(this.manager,E),this.primaryTouch=null,this.lastTouches=[]}y(a1,$r,{handler:function(M,F,X){var ee=X.pointerType==ie,de=X.pointerType==Ae;if(!(de&&X.sourceCapabilities&&X.sourceCapabilities.firesTouchEvents)){if(ee)Tce.call(this,F,X);else if(de&&wce.call(this,X))return;this.callback(M,F,X)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Tce(E,M){E&ge?(this.primaryTouch=M.changedPointers[0].identifier,HI.call(this,M)):E&(Ie|Et)&&HI.call(this,M)}function HI(E){var M=E.changedPointers[0];if(M.identifier===this.primaryTouch){var F={x:M.clientX,y:M.clientY};this.lastTouches.push(F);var X=this.lastTouches,ee=function(){var de=X.indexOf(F);de>-1&&X.splice(de,1)};setTimeout(ee,Sce)}}function wce(E){for(var M=E.srcEvent.clientX,F=E.srcEvent.clientY,X=0;X<this.lastTouches.length;X++){var ee=this.lastTouches[X],de=Math.abs(M-ee.x),Ge=Math.abs(F-ee.y);if(de<=VI&&Ge<=VI)return!0}return!1}var WI=V(a.style,"touchAction"),$I=WI!==n,XI="compute",qI="auto",o1="manipulation",as="none",Pc="pan-x",Oc="pan-y",av=Oce();function s1(E,M){this.manager=E,this.set(M)}s1.prototype={set:function(E){E==XI&&(E=this.compute()),$I&&this.manager.element.style&&av[E]&&(this.manager.element.style[WI]=E),this.actions=E.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var E=[];return p(this.manager.recognizers,function(M){b(M.options.enable,[M])&&(E=E.concat(M.getTouchAction()))}),Pce(E.join(" "))},preventDefaults:function(E){var M=E.srcEvent,F=E.offsetDirection;if(this.manager.session.prevented){M.preventDefault();return}var X=this.actions,ee=O(X,as)&&!av[as],de=O(X,Oc)&&!av[Oc],Ge=O(X,Pc)&&!av[Pc];if(ee){var cr=E.pointers.length===1,yr=E.distance<2,Rr=E.deltaTime<250;if(cr&&yr&&Rr)return}if(!(Ge&&de)&&(ee||de&&F&et||Ge&&F&$n))return this.preventSrc(M)},preventSrc:function(E){this.manager.session.prevented=!0,E.preventDefault()}};function Pce(E){if(O(E,as))return as;var M=O(E,Pc),F=O(E,Oc);return M&&F?as:M||F?M?Pc:Oc:O(E,o1)?o1:qI}function Oce(){if(!$I)return!1;var E={},M=t.CSS&&t.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(F){E[F]=M?t.CSS.supports("touch-action",F):!0}),E}var ov=1,gn=2,Wu=4,io=8,sa=io,Ec=16,Ti=32;function ua(E){this.options=v({},this.defaults,E||{}),this.id=k(),this.manager=null,this.options.enable=x(this.options.enable,!0),this.state=ov,this.simultaneous={},this.requireFail=[]}ua.prototype={defaults:{},set:function(E){return v(this.options,E),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(E){if(c(E,"recognizeWith",this))return this;var M=this.simultaneous;return E=sv(E,this),M[E.id]||(M[E.id]=E,E.recognizeWith(this)),this},dropRecognizeWith:function(E){return c(E,"dropRecognizeWith",this)?this:(E=sv(E,this),delete this.simultaneous[E.id],this)},requireFailure:function(E){if(c(E,"requireFailure",this))return this;var M=this.requireFail;return E=sv(E,this),T(M,E)===-1&&(M.push(E),E.requireFailure(this)),this},dropRequireFailure:function(E){if(c(E,"dropRequireFailure",this))return this;E=sv(E,this);var M=T(this.requireFail,E);return M>-1&&this.requireFail.splice(M,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(E){return!!this.simultaneous[E.id]},emit:function(E){var M=this,F=this.state;function X(ee){M.manager.emit(ee,E)}F<io&&X(M.options.event+YI(F)),X(M.options.event),E.additionalEvent&&X(E.additionalEvent),F>=io&&X(M.options.event+YI(F))},tryEmit:function(E){if(this.canEmit())return this.emit(E);this.state=Ti},canEmit:function(){for(var E=0;E<this.requireFail.length;){if(!(this.requireFail[E].state&(Ti|ov)))return!1;E++}return!0},recognize:function(E){var M=v({},E);if(!b(this.options.enable,[this,M])){this.reset(),this.state=Ti;return}this.state&(sa|Ec|Ti)&&(this.state=ov),this.state=this.process(M),this.state&(gn|Wu|io|Ec)&&this.tryEmit(M)},process:function(E){},getTouchAction:function(){},reset:function(){}};function YI(E){return E&Ec?"cancel":E&io?"end":E&Wu?"move":E&gn?"start":""}function KI(E){return E==fr?"down":E==zt?"up":E==sn?"left":E==no?"right":""}function sv(E,M){var F=M.manager;return F?F.get(E):E}function Yn(){ua.apply(this,arguments)}y(Yn,ua,{defaults:{pointers:1},attrTest:function(E){var M=this.options.pointers;return M===0||E.pointers.length===M},process:function(E){var M=this.state,F=E.eventType,X=M&(gn|Wu),ee=this.attrTest(E);return X&&(F&Et||!ee)?M|Ec:X||ee?F&Ie?M|io:M&gn?M|Wu:gn:Ti}});function uv(){Yn.apply(this,arguments),this.pX=null,this.pY=null}y(uv,Yn,{defaults:{event:"pan",threshold:10,pointers:1,direction:Xn},getTouchAction:function(){var E=this.options.direction,M=[];return E&et&&M.push(Oc),E&$n&&M.push(Pc),M},directionTest:function(E){var M=this.options,F=!0,X=E.distance,ee=E.direction,de=E.deltaX,Ge=E.deltaY;return ee&M.direction||(M.direction&et?(ee=de===0?Wn:de<0?sn:no,F=de!=this.pX,X=Math.abs(E.deltaX)):(ee=Ge===0?Wn:Ge<0?zt:fr,F=Ge!=this.pY,X=Math.abs(E.deltaY))),E.direction=ee,F&&X>M.threshold&&ee&M.direction},attrTest:function(E){return Yn.prototype.attrTest.call(this,E)&&(this.state&gn||!(this.state&gn)&&this.directionTest(E))},emit:function(E){this.pX=E.deltaX,this.pY=E.deltaY;var M=KI(E.direction);M&&(E.additionalEvent=this.options.event+M),this._super.emit.call(this,E)}});function u1(){Yn.apply(this,arguments)}y(u1,Yn,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[as]},attrTest:function(E){return this._super.attrTest.call(this,E)&&(Math.abs(E.scale-1)>this.options.threshold||this.state&gn)},emit:function(E){if(E.scale!==1){var M=E.scale<1?"in":"out";E.additionalEvent=this.options.event+M}this._super.emit.call(this,E)}});function l1(){ua.apply(this,arguments),this._timer=null,this._input=null}y(l1,ua,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[qI]},process:function(E){var M=this.options,F=E.pointers.length===M.pointers,X=E.distance<M.threshold,ee=E.deltaTime>M.time;if(this._input=E,!X||!F||E.eventType&(Ie|Et)&&!ee)this.reset();else if(E.eventType&ge)this.reset(),this._timer=f(function(){this.state=sa,this.tryEmit()},M.time,this);else if(E.eventType&Ie)return sa;return Ti},reset:function(){clearTimeout(this._timer)},emit:function(E){this.state===sa&&(E&&E.eventType&Ie?this.manager.emit(this.options.event+"up",E):(this._input.timeStamp=l(),this.manager.emit(this.options.event,this._input)))}});function f1(){Yn.apply(this,arguments)}y(f1,Yn,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[as]},attrTest:function(E){return this._super.attrTest.call(this,E)&&(Math.abs(E.rotation)>this.options.threshold||this.state&gn)}});function c1(){Yn.apply(this,arguments)}y(c1,Yn,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:et|$n,pointers:1},getTouchAction:function(){return uv.prototype.getTouchAction.call(this)},attrTest:function(E){var M=this.options.direction,F;return M&(et|$n)?F=E.overallVelocity:M&et?F=E.overallVelocityX:M&$n&&(F=E.overallVelocityY),this._super.attrTest.call(this,E)&&M&E.offsetDirection&&E.distance>this.options.threshold&&E.maxPointers==this.options.pointers&&u(F)>this.options.velocity&&E.eventType&Ie},emit:function(E){var M=KI(E.offsetDirection);M&&this.manager.emit(this.options.event+M,E),this.manager.emit(this.options.event,E)}});function lv(){ua.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}y(lv,ua,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[o1]},process:function(E){var M=this.options,F=E.pointers.length===M.pointers,X=E.distance<M.threshold,ee=E.deltaTime<M.time;if(this.reset(),E.eventType&ge&&this.count===0)return this.failTimeout();if(X&&ee&&F){if(E.eventType!=Ie)return this.failTimeout();var de=this.pTime?E.timeStamp-this.pTime<M.interval:!0,Ge=!this.pCenter||oa(this.pCenter,E.center)<M.posThreshold;this.pTime=E.timeStamp,this.pCenter=E.center,!Ge||!de?this.count=1:this.count+=1,this._input=E;var cr=this.count%M.taps;if(cr===0)return this.hasRequireFailures()?(this._timer=f(function(){this.state=sa,this.tryEmit()},M.interval,this),gn):sa}return Ti},failTimeout:function(){return this._timer=f(function(){this.state=Ti},this.options.interval,this),Ti},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==sa&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function la(E,M){return M=M||{},M.recognizers=x(M.recognizers,la.defaults.preset),new p1(E,M)}la.VERSION="2.0.7",la.defaults={domEvents:!1,touchAction:XI,enable:!0,inputTarget:null,inputClass:null,preset:[[f1,{enable:!1}],[u1,{enable:!1},["rotate"]],[c1,{direction:et}],[uv,{direction:et},["swipe"]],[lv],[lv,{event:"doubletap",taps:2},["tap"]],[l1]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Ece=1,ZI=2;function p1(E,M){this.options=v({},la.defaults,M||{}),this.options.inputTarget=this.options.inputTarget||E,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=E,this.input=wc(this),this.touchAction=new s1(this,this.options.touchAction),JI(this,!0),p(this.options.recognizers,function(F){var X=this.add(new F[0](F[1]));F[2]&&X.recognizeWith(F[2]),F[3]&&X.requireFailure(F[3])},this)}p1.prototype={set:function(E){return v(this.options,E),E.touchAction&&this.touchAction.update(),E.inputTarget&&(this.input.destroy(),this.input.target=E.inputTarget,this.input.init()),this},stop:function(E){this.session.stopped=E?ZI:Ece},recognize:function(E){var M=this.session;if(!M.stopped){this.touchAction.preventDefaults(E);var F,X=this.recognizers,ee=M.curRecognizer;(!ee||ee&&ee.state&sa)&&(ee=M.curRecognizer=null);for(var de=0;de<X.length;)F=X[de],M.stopped!==ZI&&(!ee||F==ee||F.canRecognizeWith(ee))?F.recognize(E):F.reset(),!ee&&F.state&(gn|Wu|io)&&(ee=M.curRecognizer=F),de++}},get:function(E){if(E instanceof ua)return E;for(var M=this.recognizers,F=0;F<M.length;F++)if(M[F].options.event==E)return M[F];return null},add:function(E){if(c(E,"add",this))return this;var M=this.get(E.options.event);return M&&this.remove(M),this.recognizers.push(E),E.manager=this,this.touchAction.update(),E},remove:function(E){if(c(E,"remove",this))return this;if(E=this.get(E),E){var M=this.recognizers,F=T(M,E);F!==-1&&(M.splice(F,1),this.touchAction.update())}return this},on:function(E,M){if(E!==n&&M!==n){var F=this.handlers;return p(C(E),function(X){F[X]=F[X]||[],F[X].push(M)}),this}},off:function(E,M){if(E!==n){var F=this.handlers;return p(C(E),function(X){M?F[X]&&F[X].splice(T(F[X],M),1):delete F[X]}),this}},emit:function(E,M){this.options.domEvents&&Cce(E,M);var F=this.handlers[E]&&this.handlers[E].slice();if(!(!F||!F.length)){M.type=E,M.preventDefault=function(){M.srcEvent.preventDefault()};for(var X=0;X<F.length;)F[X](M),X++}},destroy:function(){this.element&&JI(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function JI(E,M){var F=E.element;if(F.style){var X;p(E.options.cssProps,function(ee,de){X=V(F.style,de),M?(E.oldCssProps[X]=F.style[X],F.style[X]=ee):F.style[X]=E.oldCssProps[X]||""}),M||(E.oldCssProps={})}}function Cce(E,M){var F=r.createEvent("Event");F.initEvent(E,!0,!0),F.gesture=M,M.target.dispatchEvent(F)}v(la,{INPUT_START:ge,INPUT_MOVE:qe,INPUT_END:Ie,INPUT_CANCEL:Et,STATE_POSSIBLE:ov,STATE_BEGAN:gn,STATE_CHANGED:Wu,STATE_ENDED:io,STATE_RECOGNIZED:sa,STATE_CANCELLED:Ec,STATE_FAILED:Ti,DIRECTION_NONE:Wn,DIRECTION_LEFT:sn,DIRECTION_RIGHT:no,DIRECTION_UP:zt,DIRECTION_DOWN:fr,DIRECTION_HORIZONTAL:et,DIRECTION_VERTICAL:$n,DIRECTION_ALL:Xn,Manager:p1,Input:$r,TouchAction:s1,TouchInput:iv,MouseInput:nv,PointerEventInput:i1,TouchMouseInput:a1,SingleTouchInput:zI,Recognizer:ua,AttrRecognizer:Yn,Tap:lv,Pan:uv,Swipe:c1,Pinch:u1,Rotate:f1,Press:l1,on:A,off:S,each:p,merge:g,extend:m,assign:v,inherit:y,bindFn:_,prefixed:V});var Mce=typeof t<"u"?t:typeof self<"u"?self:{};Mce.Hammer=la,n==="function"&&define.amd?define(function(){return la}):typeof Ng<"u"&&Ng.exports?Ng.exports=la:t[e]=la})(window,document,"Hammer")});var XW=Te((Lat,mP)=>{"use strict";mP.exports=Fy;mP.exports.default=Fy;function Fy(t,r,e){e=e||2;var n=r&&r.length,i=n?r[0]*e:t.length,a=HW(t,0,i,e,!0),o=[];if(!a||a.next===a.prev)return o;var s,u,l,f,c,p,d;if(n&&(a=wTe(t,r,a,e)),t.length>80*e){s=l=t[0],u=f=t[1];for(var v=e;v<i;v+=e)c=t[v],p=t[v+1],c<s&&(s=c),p<u&&(u=p),c>l&&(l=c),p>f&&(f=p);d=Math.max(l-s,f-u),d=d!==0?32767/d:0}return Ch(a,o,e,s,u,d,0),o}function HW(t,r,e,n,i){var a,o;if(i===vP(t,r,e,n)>0)for(a=r;a<e;a+=n)o=VW(a,t[a],t[a+1],o);else for(a=e-n;a>=r;a-=n)o=VW(a,t[a],t[a+1],o);return o&&Dy(o,o.next)&&(Ih(o),o=o.next),o}function Zs(t,r){if(!t)return t;r||(r=t);var e=t,n;do if(n=!1,!e.steiner&&(Dy(e,e.next)||Dt(e.prev,e,e.next)===0)){if(Ih(e),e=r=e.prev,e===e.next)break;n=!0}else e=e.next;while(n||e!==r);return r}function Ch(t,r,e,n,i,a,o){if(t){!o&&a&&MTe(t,n,i,a);for(var s=t,u,l;t.prev!==t.next;){if(u=t.prev,l=t.next,a?ATe(t,n,i,a):xTe(t)){r.push(u.i/e|0),r.push(t.i/e|0),r.push(l.i/e|0),Ih(t),t=l.next,s=l.next;continue}if(t=l,t===s){o?o===1?(t=STe(Zs(t),r,e),Ch(t,r,e,n,i,a,2)):o===2&&TTe(t,r,e,n,i,a):Ch(Zs(t),r,e,n,i,a,1);break}}}}function xTe(t){var r=t.prev,e=t,n=t.next;if(Dt(r,e,n)>=0)return!1;for(var i=r.x,a=e.x,o=n.x,s=r.y,u=e.y,l=n.y,f=i<a?i<o?i:o:a<o?a:o,c=s<u?s<l?s:l:u<l?u:l,p=i>a?i>o?i:o:a>o?a:o,d=s>u?s>l?s:l:u>l?u:l,v=n.next;v!==r;){if(v.x>=f&&v.x<=p&&v.y>=c&&v.y<=d&&cf(i,s,a,u,o,l,v.x,v.y)&&Dt(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function ATe(t,r,e,n){var i=t.prev,a=t,o=t.next;if(Dt(i,a,o)>=0)return!1;for(var s=i.x,u=a.x,l=o.x,f=i.y,c=a.y,p=o.y,d=s<u?s<l?s:l:u<l?u:l,v=f<c?f<p?f:p:c<p?c:p,m=s>u?s>l?s:l:u>l?u:l,g=f>c?f>p?f:p:c>p?c:p,y=hP(d,v,r,e,n),_=hP(m,g,r,e,n),b=t.prevZ,x=t.nextZ;b&&b.z>=y&&x&&x.z<=_;){if(b.x>=d&&b.x<=m&&b.y>=v&&b.y<=g&&b!==i&&b!==o&&cf(s,f,u,c,l,p,b.x,b.y)&&Dt(b.prev,b,b.next)>=0||(b=b.prevZ,x.x>=d&&x.x<=m&&x.y>=v&&x.y<=g&&x!==i&&x!==o&&cf(s,f,u,c,l,p,x.x,x.y)&&Dt(x.prev,x,x.next)>=0))return!1;x=x.nextZ}for(;b&&b.z>=y;){if(b.x>=d&&b.x<=m&&b.y>=v&&b.y<=g&&b!==i&&b!==o&&cf(s,f,u,c,l,p,b.x,b.y)&&Dt(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;x&&x.z<=_;){if(x.x>=d&&x.x<=m&&x.y>=v&&x.y<=g&&x!==i&&x!==o&&cf(s,f,u,c,l,p,x.x,x.y)&&Dt(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function STe(t,r,e){var n=t;do{var i=n.prev,a=n.next.next;!Dy(i,a)&&WW(i,n,n.next,a)&&Mh(i,a)&&Mh(a,i)&&(r.push(i.i/e|0),r.push(n.i/e|0),r.push(a.i/e|0),Ih(n),Ih(n.next),n=t=a),n=n.next}while(n!==t);return Zs(n)}function TTe(t,r,e,n,i,a){var o=t;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&LTe(o,s)){var u=$W(o,s);o=Zs(o,o.next),u=Zs(u,u.next),Ch(o,r,e,n,i,a,0),Ch(u,r,e,n,i,a,0);return}s=s.next}o=o.next}while(o!==t)}function wTe(t,r,e,n){var i=[],a,o,s,u,l;for(a=0,o=r.length;a<o;a++)s=r[a]*n,u=a<o-1?r[a+1]*n:t.length,l=HW(t,s,u,n,!1),l===l.next&&(l.steiner=!0),i.push(RTe(l));for(i.sort(PTe),a=0;a<i.length;a++)e=OTe(i[a],e);return e}function PTe(t,r){return t.x-r.x}function OTe(t,r){var e=ETe(t,r);if(!e)return r;var n=$W(e,t);return Zs(n,n.next),Zs(e,e.next)}function ETe(t,r){var e=r,n=t.x,i=t.y,a=-1/0,o;do{if(i<=e.y&&i>=e.next.y&&e.next.y!==e.y){var s=e.x+(i-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(s<=n&&s>a&&(a=s,o=e.x<e.next.x?e:e.next,s===n))return o}e=e.next}while(e!==r);if(!o)return null;var u=o,l=o.x,f=o.y,c=1/0,p;e=o;do n>=e.x&&e.x>=l&&n!==e.x&&cf(i<f?n:a,i,l,f,i<f?a:n,i,e.x,e.y)&&(p=Math.abs(i-e.y)/(n-e.x),Mh(e,t)&&(p<c||p===c&&(e.x>o.x||e.x===o.x&&CTe(o,e)))&&(o=e,c=p)),e=e.next;while(e!==u);return o}function CTe(t,r){return Dt(t.prev,t,r.prev)<0&&Dt(r.next,t,t.next)<0}function MTe(t,r,e,n){var i=t;do i.z===0&&(i.z=hP(i.x,i.y,r,e,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,ITe(i)}function ITe(t){var r,e,n,i,a,o,s,u,l=1;do{for(e=t,t=null,a=null,o=0;e;){for(o++,n=e,s=0,r=0;r<l&&(s++,n=n.nextZ,!!n);r++);for(u=l;s>0||u>0&&n;)s!==0&&(u===0||!n||e.z<=n.z)?(i=e,e=e.nextZ,s--):(i=n,n=n.nextZ,u--),a?a.nextZ=i:t=i,i.prevZ=a,a=i;e=n}a.nextZ=null,l*=2}while(o>1);return t}function hP(t,r,e,n,i){return t=(t-e)*i|0,r=(r-n)*i|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,t|r<<1}function RTe(t){var r=t,e=t;do(r.x<e.x||r.x===e.x&&r.y<e.y)&&(e=r),r=r.next;while(r!==t);return e}function cf(t,r,e,n,i,a,o,s){return(i-o)*(r-s)>=(t-o)*(a-s)&&(t-o)*(n-s)>=(e-o)*(r-s)&&(e-o)*(a-s)>=(i-o)*(n-s)}function LTe(t,r){return t.next.i!==r.i&&t.prev.i!==r.i&&!kTe(t,r)&&(Mh(t,r)&&Mh(r,t)&&BTe(t,r)&&(Dt(t.prev,t,r.prev)||Dt(t,r.prev,r))||Dy(t,r)&&Dt(t.prev,t,t.next)>0&&Dt(r.prev,r,r.next)>0)}function Dt(t,r,e){return(r.y-t.y)*(e.x-r.x)-(r.x-t.x)*(e.y-r.y)}function Dy(t,r){return t.x===r.x&&t.y===r.y}function WW(t,r,e,n){var i=By(Dt(t,r,e)),a=By(Dt(t,r,n)),o=By(Dt(e,n,t)),s=By(Dt(e,n,r));return!!(i!==a&&o!==s||i===0&&ky(t,e,r)||a===0&&ky(t,n,r)||o===0&&ky(e,t,n)||s===0&&ky(e,r,n))}function ky(t,r,e){return r.x<=Math.max(t.x,e.x)&&r.x>=Math.min(t.x,e.x)&&r.y<=Math.max(t.y,e.y)&&r.y>=Math.min(t.y,e.y)}function By(t){return t>0?1:t<0?-1:0}function kTe(t,r){var e=t;do{if(e.i!==t.i&&e.next.i!==t.i&&e.i!==r.i&&e.next.i!==r.i&&WW(e,e.next,t,r))return!0;e=e.next}while(e!==t);return!1}function Mh(t,r){return Dt(t.prev,t,t.next)<0?Dt(t,r,t.next)>=0&&Dt(t,t.prev,r)>=0:Dt(t,r,t.prev)<0||Dt(t,t.next,r)<0}function BTe(t,r){var e=t,n=!1,i=(t.x+r.x)/2,a=(t.y+r.y)/2;do e.y>a!=e.next.y>a&&e.next.y!==e.y&&i<(e.next.x-e.x)*(a-e.y)/(e.next.y-e.y)+e.x&&(n=!n),e=e.next;while(e!==t);return n}function $W(t,r){var e=new dP(t.i,t.x,t.y),n=new dP(r.i,r.x,r.y),i=t.next,a=r.prev;return t.next=r,r.prev=t,e.next=i,i.prev=e,n.next=e,e.prev=n,a.next=n,n.prev=a,n}function VW(t,r,e,n){var i=new dP(t,r,e);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function Ih(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function dP(t,r,e){this.i=t,this.x=r,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Fy.deviation=function(t,r,e,n){var i=r&&r.length,a=i?r[0]*e:t.length,o=Math.abs(vP(t,0,a,e));if(i)for(var s=0,u=r.length;s<u;s++){var l=r[s]*e,f=s<u-1?r[s+1]*e:t.length;o-=Math.abs(vP(t,l,f,e))}var c=0;for(s=0;s<n.length;s+=3){var p=n[s]*e,d=n[s+1]*e,v=n[s+2]*e;c+=Math.abs((t[p]-t[v])*(t[d+1]-t[p+1])-(t[p]-t[d])*(t[v+1]-t[p+1]))}return o===0&&c===0?0:Math.abs((c-o)/o)};function vP(t,r,e,n){for(var i=0,a=r,o=e-n;a<e;a+=n)i+=(t[o]-t[a])*(t[a+1]+t[o+1]),o=a;return i}Fy.flatten=function(t){for(var r=t[0][0].length,e={vertices:[],holes:[],dimensions:r},n=0,i=0;i<t.length;i++){for(var a=0;a<t[i].length;a++)for(var o=0;o<r;o++)e.vertices.push(t[i][a][o]);i>0&&(n+=t[i-1].length,e.holes.push(n))}return e}});var M7=Te((not,C7)=>{function twe(t,r){if(t==null)return{};var e={},n=Object.keys(t),i,a;for(a=0;a<n.length;a++)i=n[a],!(r.indexOf(i)>=0)&&(e[i]=t[i]);return e}C7.exports=twe});var Hy=Te((iot,I7)=>{var rwe=M7();function nwe(t,r){if(t==null)return{};var e=rwe(t,r),n,i;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(i=0;i<a.length;i++)n=a[i],!(r.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(t,n)&&(e[n]=t[n])}return e}I7.exports=nwe});var MP=Te(La=>{"use strict";var W$=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",Dwe=W$+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",$$="["+W$+"]["+Dwe+"]*",Nwe=new RegExp("^"+$$+"$"),jwe=function(r,e){for(var n=[],i=e.exec(r);i;){var a=[];a.startIndex=e.lastIndex-i[0].length;for(var o=i.length,s=0;s<o;s++)a.push(i[s]);n.push(a),i=e.exec(r)}return n},Uwe=function(r){var e=Nwe.exec(r);return!(e===null||typeof e>"u")};La.isExist=function(t){return typeof t<"u"};La.isEmptyObject=function(t){return Object.keys(t).length===0};La.merge=function(t,r,e){if(r)for(var n=Object.keys(r),i=n.length,a=0;a<i;a++)e==="strict"?t[n[a]]=[r[n[a]]]:t[n[a]]=r[n[a]]};La.getValue=function(t){return La.isExist(t)?t:""};La.isName=Uwe;La.getAllMatches=jwe;La.nameRegexp=$$});var RP=Te(Z$=>{"use strict";var IP=MP(),Gwe={allowBooleanAttributes:!1,unpairedTags:[]};Z$.validate=function(t,r){r=Object.assign({},Gwe,r);var e=[],n=!1,i=!1;t[0]==="\uFEFF"&&(t=t.substr(1));for(var a=0;a<t.length;a++)if(t[a]==="<"&&t[a+1]==="?"){if(a+=2,a=q$(t,a),a.err)return a}else if(t[a]==="<"){var o=a;if(a++,t[a]==="!"){a=Y$(t,a);continue}else{var s=!1;t[a]==="/"&&(s=!0,a++);for(var u="";a<t.length&&t[a]!==">"&&t[a]!==" "&&t[a]!=="	"&&t[a]!==`
`&&t[a]!=="\r";a++)u+=t[a];if(u=u.trim(),u[u.length-1]==="/"&&(u=u.substring(0,u.length-1),a--),!Ywe(u)){var l=void 0;return u.trim().length===0?l="Invalid space after '<'.":l="Tag '"+u+"' is an invalid name.",tr("InvalidTag",l,Qr(t,a))}var f=Hwe(t,a);if(f===!1)return tr("InvalidAttr","Attributes for '"+u+"' have open quote.",Qr(t,a));var c=f.value;if(a=f.index,c[c.length-1]==="/"){var p=a-c.length;c=c.substring(0,c.length-1);var d=K$(c,r);if(d===!0)n=!0;else return tr(d.err.code,d.err.msg,Qr(t,p+d.err.line))}else if(s)if(f.tagClosed){if(c.trim().length>0)return tr("InvalidTag","Closing tag '"+u+"' can't have attributes or invalid starting.",Qr(t,o));var v=e.pop();if(u!==v.tagName){var m=Qr(t,v.tagStartPos);return tr("InvalidTag","Expected closing tag '"+v.tagName+"' (opened in line "+m.line+", col "+m.col+") instead of closing tag '"+u+"'.",Qr(t,o))}e.length==0&&(i=!0)}else return tr("InvalidTag","Closing tag '"+u+"' doesn't have proper closing.",Qr(t,a));else{var g=K$(c,r);if(g!==!0)return tr(g.err.code,g.err.msg,Qr(t,a-c.length+g.err.line));if(i===!0)return tr("InvalidXml","Multiple possible root nodes found.",Qr(t,a));r.unpairedTags.indexOf(u)!==-1||e.push({tagName:u,tagStartPos:o}),n=!0}for(a++;a<t.length;a++)if(t[a]==="<")if(t[a+1]==="!"){a++,a=Y$(t,a);continue}else if(t[a+1]==="?"){if(a=q$(t,++a),a.err)return a}else break;else if(t[a]==="&"){var y=Xwe(t,a);if(y==-1)return tr("InvalidChar","char '&' is not expected.",Qr(t,a));a=y}else if(i===!0&&!X$(t[a]))return tr("InvalidXml","Extra text at the end",Qr(t,a));t[a]==="<"&&a--}}else{if(X$(t[a]))continue;return tr("InvalidChar","char '"+t[a]+"' is not expected.",Qr(t,a))}if(n){if(e.length==1)return tr("InvalidTag","Unclosed tag '"+e[0].tagName+"'.",Qr(t,e[0].tagStartPos));if(e.length>0)return tr("InvalidXml","Invalid '"+JSON.stringify(e.map(function(_){return _.tagName}),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return tr("InvalidXml","Start tag expected.",1);return!0};function X$(t){return t===" "||t==="	"||t===`
`||t==="\r"}function q$(t,r){for(var e=r;r<t.length;r++)if(t[r]=="?"||t[r]==" "){var n=t.substr(e,r-e);if(r>5&&n==="xml")return tr("InvalidXml","XML declaration allowed only at the start of the document.",Qr(t,r));if(t[r]=="?"&&t[r+1]==">"){r++;break}else continue}return r}function Y$(t,r){if(t.length>r+5&&t[r+1]==="-"&&t[r+2]==="-"){for(r+=3;r<t.length;r++)if(t[r]==="-"&&t[r+1]==="-"&&t[r+2]===">"){r+=2;break}}else if(t.length>r+8&&t[r+1]==="D"&&t[r+2]==="O"&&t[r+3]==="C"&&t[r+4]==="T"&&t[r+5]==="Y"&&t[r+6]==="P"&&t[r+7]==="E"){var e=1;for(r+=8;r<t.length;r++)if(t[r]==="<")e++;else if(t[r]===">"&&(e--,e===0))break}else if(t.length>r+9&&t[r+1]==="["&&t[r+2]==="C"&&t[r+3]==="D"&&t[r+4]==="A"&&t[r+5]==="T"&&t[r+6]==="A"&&t[r+7]==="["){for(r+=8;r<t.length;r++)if(t[r]==="]"&&t[r+1]==="]"&&t[r+2]===">"){r+=2;break}}return r}var zwe='"',Vwe="'";function Hwe(t,r){for(var e="",n="",i=!1;r<t.length;r++){if(t[r]===zwe||t[r]===Vwe)n===""?n=t[r]:n!==t[r]||(n="");else if(t[r]===">"&&n===""){i=!0;break}e+=t[r]}return n!==""?!1:{value:e,index:r,tagClosed:i}}var Wwe=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function K$(t,r){for(var e=IP.getAllMatches(t,Wwe),n={},i=0;i<e.length;i++){if(e[i][1].length===0)return tr("InvalidAttr","Attribute '"+e[i][2]+"' has no space in starting.",Hh(e[i]));if(e[i][3]!==void 0&&e[i][4]===void 0)return tr("InvalidAttr","Attribute '"+e[i][2]+"' is without value.",Hh(e[i]));if(e[i][3]===void 0&&!r.allowBooleanAttributes)return tr("InvalidAttr","boolean attribute '"+e[i][2]+"' is not allowed.",Hh(e[i]));var a=e[i][2];if(!qwe(a))return tr("InvalidAttr","Attribute '"+a+"' is an invalid name.",Hh(e[i]));if(!n.hasOwnProperty(a))n[a]=1;else return tr("InvalidAttr","Attribute '"+a+"' is repeated.",Hh(e[i]))}return!0}function $we(t,r){var e=/\d/;for(t[r]==="x"&&(r++,e=/[\da-fA-F]/);r<t.length;r++){if(t[r]===";")return r;if(!t[r].match(e))break}return-1}function Xwe(t,r){if(r++,t[r]===";")return-1;if(t[r]==="#")return r++,$we(t,r);for(var e=0;r<t.length;r++,e++)if(!(t[r].match(/\w/)&&e<20)){if(t[r]===";")break;return-1}return r}function tr(t,r,e){return{err:{code:t,msg:r,line:e.line||e,col:e.col}}}function qwe(t){return IP.isName(t)}function Ywe(t){return IP.isName(t)}function Qr(t,r){var e=t.substring(0,r).split(/\r?\n/);return{line:e.length,col:e[e.length-1].length+1}}function Hh(t){return t.startIndex+t[1].length}});var Q$=Te(LP=>{var J$={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(r,e){return e},attributeValueProcessor:function(r,e){return e},stopNodes:[],alwaysCreateTextNode:!1,isArray:function(){return!1},commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(r,e,n){return r}},Kwe=function(r){return Object.assign({},J$,r)};LP.buildOptions=Kwe;LP.defaultOptions=J$});var nX=Te((vst,rX)=>{"use strict";var Wh=h(B()),eX=h(L()),tX=h(N()),Zwe=function(){function t(r){(0,eX.default)(this,t),this.tagname=r,this.child=[],this[":@"]={}}return(0,tX.default)(t,[{key:"add",value:function(e,n){e==="__proto__"&&(e="#__proto__"),this.child.push((0,Wh.default)({},e,n))}},{key:"addChild",value:function(e){if(e.tagname==="__proto__"&&(e.tagname="#__proto__"),e[":@"]&&Object.keys(e[":@"]).length>0){var n;this.child.push((n={},(0,Wh.default)(n,e.tagname,e.child),(0,Wh.default)(n,":@",e[":@"]),n))}else this.child.push((0,Wh.default)({},e.tagname,e.child))}}]),t}();rX.exports=Zwe});var oX=Te((mst,aX)=>{var iX=h(me());function Jwe(t,r){var e={};if(t[r+3]==="O"&&t[r+4]==="C"&&t[r+5]==="T"&&t[r+6]==="Y"&&t[r+7]==="P"&&t[r+8]==="E"){r=r+9;for(var n=1,i=!1,a=!1,o="";r<t.length;r++)if(t[r]==="<"&&!a){if(i&&tPe(t,r)){r+=7;var s=Qwe(t,r+1),u=(0,iX.default)(s,3);entityName=u[0],val=u[1],r=u[2],val.indexOf("&")===-1&&(e[entityName]={regx:RegExp("&".concat(entityName,";"),"g"),val})}else if(i&&rPe(t,r))r+=8;else if(i&&nPe(t,r))r+=8;else if(i&&iPe(t,r))r+=9;else if(ePe)a=!0;else throw new Error("Invalid DOCTYPE");n++,o=""}else if(t[r]===">"){if(a?t[r-1]==="-"&&t[r-2]==="-"&&(a=!1,n--):n--,n===0)break}else t[r]==="["?i=!0:o+=t[r];if(n!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:e,i:r}}function Qwe(t,r){for(var e="";r<t.length&&t[r]!=="'"&&t[r]!=='"';r++)e+=t[r];if(e=e.trim(),e.indexOf(" ")!==-1)throw new Error("External entites are not supported");for(var n=t[r++],i="";r<t.length&&t[r]!==n;r++)i+=t[r];return[e,i,r]}function ePe(t,r){return t[r+1]==="!"&&t[r+2]==="-"&&t[r+3]==="-"}function tPe(t,r){return t[r+1]==="!"&&t[r+2]==="E"&&t[r+3]==="N"&&t[r+4]==="T"&&t[r+5]==="I"&&t[r+6]==="T"&&t[r+7]==="Y"}function rPe(t,r){return t[r+1]==="!"&&t[r+2]==="E"&&t[r+3]==="L"&&t[r+4]==="E"&&t[r+5]==="M"&&t[r+6]==="E"&&t[r+7]==="N"&&t[r+8]==="T"}function nPe(t,r){return t[r+1]==="!"&&t[r+2]==="A"&&t[r+3]==="T"&&t[r+4]==="T"&&t[r+5]==="L"&&t[r+6]==="I"&&t[r+7]==="S"&&t[r+8]==="T"}function iPe(t,r){return t[r+1]==="!"&&t[r+2]==="N"&&t[r+3]==="O"&&t[r+4]==="T"&&t[r+5]==="A"&&t[r+6]==="T"&&t[r+7]==="I"&&t[r+8]==="O"&&t[r+9]==="N"}aX.exports=Jwe});var uX=Te((gst,sX)=>{var aPe=/^[-+]?0x[a-fA-F0-9]+$/,oPe=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt);!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);var sPe={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function uPe(t,r={}){if(r=Object.assign({},sPe,r),!t||typeof t!="string")return t;let e=t.trim();if(r.skipLike!==void 0&&r.skipLike.test(e))return t;if(r.hex&&aPe.test(e))return Number.parseInt(e,16);{let n=oPe.exec(e);if(n){let i=n[1],a=n[2],o=lPe(n[3]),s=n[4]||n[6];if(!r.leadingZeros&&a.length>0&&i&&e[2]!==".")return t;if(!r.leadingZeros&&a.length>0&&!i&&e[1]!==".")return t;{let u=Number(e),l=""+u;return l.search(/[eE]/)!==-1||s?r.eNotation?u:t:e.indexOf(".")!==-1?l==="0"&&o===""||l===o||i&&l==="-"+o?u:t:a?o===l||i+o===l?u:t:e===l||e===i+l?u:t}}else return t}}function lPe(t){return t&&t.indexOf(".")!==-1&&(t=t.replace(/0+$/,""),t==="."?t="0":t[0]==="."?t="0"+t:t[t.length-1]==="."&&(t=t.substr(0,t.length-1))),t}sX.exports=uPe});var cX=Te((_st,fX)=>{"use strict";var kP=h(B()),Xh=h(ze()),lX=h(L()),DP=MP(),$h=nX(),fPe=oX(),cPe=uX(),yst="<((!\\[CDATA\\[([\\s\\S]*?)(]]>))|((NAME:)?(NAME))([^>]*)>|((\\/)(NAME)\\s*>))([^<]*)".replace(/NAME/g,DP.nameRegexp),pPe=function t(r){(0,lX.default)(this,t),this.options=r,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"\xA2"},pound:{regex:/&(pound|#163);/g,val:"\xA3"},yen:{regex:/&(yen|#165);/g,val:"\xA5"},euro:{regex:/&(euro|#8364);/g,val:"\u20AC"},copyright:{regex:/&(copy|#169);/g,val:"\xA9"},reg:{regex:/&(reg|#174);/g,val:"\xAE"},inr:{regex:/&(inr|#8377);/g,val:"\u20B9"}},this.addExternalEntities=hPe,this.parseXml=yPe,this.parseTextData=dPe,this.resolveNameSpace=vPe,this.buildAttributesMap=gPe,this.isItStopNode=APe,this.replaceEntitiesValue=bPe,this.readStopNodeData=TPe,this.saveTextToParentTag=xPe,this.addChild=_Pe};function hPe(t){for(var r=Object.keys(t),e=0;e<r.length;e++){var n=r[e];this.lastEntities[n]={regex:new RegExp("&"+n+";","g"),val:t[n]}}}function dPe(t,r,e,n,i,a,o){if(t!==void 0&&(this.options.trimValues&&!n&&(t=t.trim()),t.length>0)){o||(t=this.replaceEntitiesValue(t));var s=this.options.tagValueProcessor(r,t,e,i,a);if(s==null)return t;if((0,Xh.default)(s)!==(0,Xh.default)(t)||s!==t)return s;if(this.options.trimValues)return FP(t,this.options.parseTagValue,this.options.numberParseOptions);var u=t.trim();return u===t?FP(t,this.options.parseTagValue,this.options.numberParseOptions):t}}function vPe(t){if(this.options.removeNSPrefix){var r=t.split(":"),e=t.charAt(0)==="/"?"/":"";if(r[0]==="xmlns")return"";r.length===2&&(t=e+r[1])}return t}var mPe=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function gPe(t,r,e){if(!this.options.ignoreAttributes&&typeof t=="string"){for(var n=DP.getAllMatches(t,mPe),i=n.length,a={},o=0;o<i;o++){var s=this.resolveNameSpace(n[o][1]),u=n[o][4],l=this.options.attributeNamePrefix+s;if(s.length)if(this.options.transformAttributeName&&(l=this.options.transformAttributeName(l)),l==="__proto__"&&(l="#__proto__"),u!==void 0){this.options.trimValues&&(u=u.trim()),u=this.replaceEntitiesValue(u);var f=this.options.attributeValueProcessor(s,u,r);f==null?a[l]=u:(0,Xh.default)(f)!==(0,Xh.default)(u)||f!==u?a[l]=f:a[l]=FP(u,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(a[l]=!0)}if(!Object.keys(a).length)return;if(this.options.attributesGroupName){var c={};return c[this.options.attributesGroupName]=a,c}return a}}var yPe=function(r){r=r.replace(/\r\n?/g,`
`);for(var e=new $h("!xml"),n=e,i="",a="",o=0;o<r.length;o++){var s=r[o];if(s==="<")if(r[o+1]==="/"){var u=ru(r,">",o,"Closing Tag is not closed."),l=r.substring(o+2,u).trim();if(this.options.removeNSPrefix){var f=l.indexOf(":");f!==-1&&(l=l.substr(f+1))}this.options.transformTagName&&(l=this.options.transformTagName(l)),n&&(i=this.saveTextToParentTag(i,n,a));var c=a.substring(a.lastIndexOf(".")+1);if(l&&this.options.unpairedTags.indexOf(l)!==-1)throw new Error("Unpaired tag can not be used as closing tag: </".concat(l,">"));var p=0;c&&this.options.unpairedTags.indexOf(c)!==-1?(p=a.lastIndexOf(".",a.lastIndexOf(".")-1),this.tagsNodeStack.pop()):p=a.lastIndexOf("."),a=a.substring(0,p),n=this.tagsNodeStack.pop(),i="",o=u}else if(r[o+1]==="?"){var d=BP(r,o,!1,"?>");if(!d)throw new Error("Pi Tag is not closed.");if(i=this.saveTextToParentTag(i,n,a),!(this.options.ignoreDeclaration&&d.tagName==="?xml"||this.options.ignorePiTags)){var v=new $h(d.tagName);v.add(this.options.textNodeName,""),d.tagName!==d.tagExp&&d.attrExpPresent&&(v[":@"]=this.buildAttributesMap(d.tagExp,a,d.tagName)),this.addChild(n,v,a)}o=d.closeIndex+1}else if(r.substr(o+1,3)==="!--"){var m=ru(r,"-->",o+4,"Comment is not closed.");if(this.options.commentPropName){var g=r.substring(o+4,m-2);i=this.saveTextToParentTag(i,n,a),n.add(this.options.commentPropName,[(0,kP.default)({},this.options.textNodeName,g)])}o=m}else if(r.substr(o+1,2)==="!D"){var y=fPe(r,o);this.docTypeEntities=y.entities,o=y.i}else if(r.substr(o+1,2)==="!["){var _=ru(r,"]]>",o,"CDATA is not closed.")-2,b=r.substring(o+9,_);if(i=this.saveTextToParentTag(i,n,a),this.options.cdataPropName)n.add(this.options.cdataPropName,[(0,kP.default)({},this.options.textNodeName,b)]);else{var x=this.parseTextData(b,n.tagname,a,!0,!1,!0);x==null&&(x=""),n.add(this.options.textNodeName,x)}o=_+2}else{var A=BP(r,o,this.options.removeNSPrefix),S=A.tagName,P=A.tagExp,O=A.attrExpPresent,C=A.closeIndex;this.options.transformTagName&&(S=this.options.transformTagName(S)),n&&i&&n.tagname!=="!xml"&&(i=this.saveTextToParentTag(i,n,a,!1));var T=n;if(T&&this.options.unpairedTags.indexOf(T.tagname)!==-1&&(n=this.tagsNodeStack.pop(),a=a.substring(0,a.lastIndexOf("."))),S!==e.tagname&&(a+=a?"."+S:S),this.isItStopNode(this.options.stopNodes,a,S)){var I="";if(P.length>0&&P.lastIndexOf("/")===P.length-1)o=A.closeIndex;else if(this.options.unpairedTags.indexOf(S)!==-1)o=A.closeIndex;else{var R=this.readStopNodeData(r,S,C+1);if(!R)throw new Error("Unexpected end of ".concat(S));o=R.i,I=R.tagContent}var V=new $h(S);S!==P&&O&&(V[":@"]=this.buildAttributesMap(P,a,S)),I&&(I=this.parseTextData(I,S,a,!0,O,!0,!0)),a=a.substr(0,a.lastIndexOf(".")),V.add(this.options.textNodeName,I),this.addChild(n,V,a)}else{if(P.length>0&&P.lastIndexOf("/")===P.length-1){S[S.length-1]==="/"?(S=S.substr(0,S.length-1),P=S):P=P.substr(0,P.length-1),this.options.transformTagName&&(S=this.options.transformTagName(S));var z=new $h(S);S!==P&&O&&(z[":@"]=this.buildAttributesMap(P,a,S)),this.addChild(n,z,a),a=a.substr(0,a.lastIndexOf("."))}else{var k=new $h(S);this.tagsNodeStack.push(n),S!==P&&O&&(k[":@"]=this.buildAttributesMap(P,a,S)),this.addChild(n,k,a),n=k}i="",o=C}}else i+=r[o]}return e.child};function _Pe(t,r,e){var n=this.options.updateTag(r.tagname,e,r[":@"]);n===!1||(typeof n=="string"&&(r.tagname=n),t.addChild(r))}var bPe=function(r){if(this.options.processEntities){for(var e in this.docTypeEntities){var n=this.docTypeEntities[e];r=r.replace(n.regx,n.val)}for(var i in this.lastEntities){var a=this.lastEntities[i];r=r.replace(a.regex,a.val)}if(this.options.htmlEntities)for(var o in this.htmlEntities){var s=this.htmlEntities[o];r=r.replace(s.regex,s.val)}r=r.replace(this.ampEntity.regex,this.ampEntity.val)}return r};function xPe(t,r,e,n){return t&&(n===void 0&&(n=Object.keys(r.child).length===0),t=this.parseTextData(t,r.tagname,e,!1,r[":@"]?Object.keys(r[":@"]).length!==0:!1,n),t!==void 0&&t!==""&&r.add(this.options.textNodeName,t),t=""),t}function APe(t,r,e){var n="*."+e;for(var i in t){var a=t[i];if(n===a||r===a)return!0}return!1}function SPe(t,r){for(var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:">",n,i="",a=r;a<t.length;a++){var o=t[a];if(n)o===n&&(n="");else if(o==='"'||o==="'")n=o;else if(o===e[0])if(e[1]){if(t[a+1]===e[1])return{data:i,index:a}}else return{data:i,index:a};else o==="	"&&(o=" ");i+=o}}function ru(t,r,e,n){var i=t.indexOf(r,e);if(i===-1)throw new Error(n);return i+r.length-1}function BP(t,r,e){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:">",i=SPe(t,r+1,n);if(i){var a=i.data,o=i.index,s=a.search(/\s/),u=a,l=!0;if(s!==-1&&(u=a.substr(0,s).replace(/\s\s*$/,""),a=a.substr(s+1)),e){var f=u.indexOf(":");f!==-1&&(u=u.substr(f+1),l=u!==i.data.substr(f+1))}return{tagName:u,tagExp:a,closeIndex:o,attrExpPresent:l}}}function TPe(t,r,e){for(var n=e,i=1;e<t.length;e++)if(t[e]==="<")if(t[e+1]==="/"){var a=ru(t,">",e,"".concat(r," is not closed")),o=t.substring(e+2,a).trim();if(o===r&&(i--,i===0))return{tagContent:t.substring(n,e),i:a};e=a}else if(t[e+1]==="?"){var s=ru(t,"?>",e+1,"StopNode is not closed.");e=s}else if(t.substr(e+1,3)==="!--"){var u=ru(t,"-->",e+3,"StopNode is not closed.");e=u}else if(t.substr(e+1,2)==="!["){var l=ru(t,"]]>",e,"StopNode is not closed.")-2;e=l}else{var f=BP(t,e,">");if(f){var c=f&&f.tagName;c===r&&f.tagExp[f.tagExp.length-1]!=="/"&&i++,e=f.closeIndex}}}function FP(t,r,e){if(r&&typeof t=="string"){var n=t.trim();return n==="true"?!0:n==="false"?!1:cPe(t,e)}else return DP.isExist(t)?t:""}fX.exports=pPe});var dX=Te(hX=>{"use strict";function wPe(t,r){return pX(t,r)}function pX(t,r,e){for(var n,i={},a=0;a<t.length;a++){var o=t[a],s=PPe(o),u="";if(e===void 0?u=s:u=e+"."+s,s===r.textNodeName)n===void 0?n=o[s]:n+=""+o[s];else{if(s===void 0)continue;if(o[s]){var l=pX(o[s],r,u),f=EPe(l,r);o[":@"]?OPe(l,o[":@"],u,r):Object.keys(l).length===1&&l[r.textNodeName]!==void 0&&!r.alwaysCreateTextNode?l=l[r.textNodeName]:Object.keys(l).length===0&&(r.alwaysCreateTextNode?l[r.textNodeName]="":l=""),i[s]!==void 0&&i.hasOwnProperty(s)?(Array.isArray(i[s])||(i[s]=[i[s]]),i[s].push(l)):r.isArray(s,u,f)?i[s]=[l]:i[s]=l}}}return typeof n=="string"?n.length>0&&(i[r.textNodeName]=n):n!==void 0&&(i[r.textNodeName]=n),i}function PPe(t){for(var r=Object.keys(t),e=0;e<r.length;e++){var n=r[e];if(n!==":@")return n}}function OPe(t,r,e,n){if(r)for(var i=Object.keys(r),a=i.length,o=0;o<a;o++){var s=i[o];n.isArray(s,e+"."+s,!0,!0)?t[s]=[r[s]]:t[s]=r[s]}}function EPe(t,r){var e=r.textNodeName,n=Object.keys(t).length;return!!(n===0||n===1&&(t[e]||typeof t[e]=="boolean"||t[e]===0))}hX.prettify=wPe});var yX=Te((xst,gX)=>{var vX=h(L()),mX=h(N()),CPe=Q$(),MPe=CPe.buildOptions,IPe=cX(),RPe=dX(),LPe=RPe.prettify,kPe=RP(),BPe=function(){function t(r){(0,vX.default)(this,t),this.externalEntities={},this.options=MPe(r)}return(0,mX.default)(t,[{key:"parse",value:function(e,n){if(typeof e!="string")if(e.toString)e=e.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(n){n===!0&&(n={});var i=kPe.validate(e,n);if(i!==!0)throw Error("".concat(i.err.msg,":").concat(i.err.line,":").concat(i.err.col))}var a=new IPe(this.options);a.addExternalEntities(this.externalEntities);var o=a.parseXml(e);return this.options.preserveOrder||o===void 0?o:LPe(o,this.options)}},{key:"addEntity",value:function(e,n){if(n.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(e.indexOf("&")!==-1||e.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(n==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[e]=n}}]),t}();gX.exports=BPe});var SX=Te((Ast,AX)=>{var FPe=`
`;function DPe(t,r){var e="";return r.format&&r.indentBy.length>0&&(e=FPe),bX(t,r,"",e)}function bX(t,r,e,n){for(var i="",a=!1,o=0;o<t.length;o++){var s=t[o],u=NPe(s),l="";if(e.length===0?l=u:l="".concat(e,".").concat(u),u===r.textNodeName){var f=s[u];jPe(l,r)||(f=r.tagValueProcessor(u,f),f=xX(f,r)),a&&(i+=n),i+=f,a=!1;continue}else if(u===r.cdataPropName){a&&(i+=n),i+="<![CDATA[".concat(s[u][0][r.textNodeName],"]]>"),a=!1;continue}else if(u===r.commentPropName){i+=n+"<!--".concat(s[u][0][r.textNodeName],"-->"),a=!0;continue}else if(u[0]==="?"){var c=_X(s[":@"],r),p=u==="?xml"?"":n,d=s[u][0][r.textNodeName];d=d.length!==0?" "+d:"",i+=p+"<".concat(u).concat(d).concat(c,"?>"),a=!0;continue}var v=n;v!==""&&(v+=r.indentBy);var m=_X(s[":@"],r),g=n+"<".concat(u).concat(m),y=bX(s[u],r,l,v);r.unpairedTags.indexOf(u)!==-1?r.suppressUnpairedNode?i+=g+">":i+=g+"/>":(!y||y.length===0)&&r.suppressEmptyNode?i+=g+"/>":y&&y.endsWith(">")?i+=g+">".concat(y).concat(n,"</").concat(u,">"):(i+=g+">",y&&n!==""&&(y.includes("/>")||y.includes("</"))?i+=n+r.indentBy+y+n:i+=y,i+="</".concat(u,">")),a=!0}return i}function NPe(t){for(var r=Object.keys(t),e=0;e<r.length;e++){var n=r[e];if(n!==":@")return n}}function _X(t,r){var e="";if(t&&!r.ignoreAttributes)for(var n in t){var i=r.attributeValueProcessor(n,t[n]);i=xX(i,r),i===!0&&r.suppressBooleanAttributes?e+=" ".concat(n.substr(r.attributeNamePrefix.length)):e+=" ".concat(n.substr(r.attributeNamePrefix.length),'="').concat(i,'"')}return e}function jPe(t,r){t=t.substr(0,t.length-r.textNodeName.length-1);var e=t.substr(t.lastIndexOf(".")+1);for(var n in r.stopNodes)if(r.stopNodes[n]===t||r.stopNodes[n]==="*."+e)return!0;return!1}function xX(t,r){if(t&&t.length>0&&r.processEntities)for(var e=0;e<r.entities.length;e++){var n=r.entities[e];t=t.replace(n.regex,n.val)}return t}AX.exports=DPe});var PX=Te((Sst,wX)=>{"use strict";var NP=h(ze()),TX=h(B()),UPe=SX(),GPe={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(r,e){return e},attributeValueProcessor:function(r,e){return e},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function Bo(t){this.options=Object.assign({},GPe,t),this.options.ignoreAttributes||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=HPe),this.processTextOrObjNode=zPe,this.options.format?(this.indentate=VPe,this.tagEndChar=`>
`,this.newLine=`
`):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}Bo.prototype.build=function(t){return this.options.preserveOrder?UPe(t,this.options):(Array.isArray(t)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(t=(0,TX.default)({},this.options.arrayNodeName,t)),this.j2x(t,0).val)};Bo.prototype.j2x=function(t,r){var e="",n="";for(var i in t)if(!(typeof t[i]>"u"))if(t[i]===null)i[0]==="?"?n+=this.indentate(r)+"<"+i+"?"+this.tagEndChar:n+=this.indentate(r)+"<"+i+"/"+this.tagEndChar;else if(t[i]instanceof Date)n+=this.buildTextValNode(t[i],i,"",r);else if((0,NP.default)(t[i])!=="object"){var a=this.isAttribute(i);if(a)e+=this.buildAttrPairStr(a,""+t[i]);else if(i===this.options.textNodeName){var o=this.options.tagValueProcessor(i,""+t[i]);n+=this.replaceEntitiesValue(o)}else n+=this.buildTextValNode(t[i],i,"",r)}else if(Array.isArray(t[i])){for(var s=t[i].length,u="",l=0;l<s;l++){var f=t[i][l];typeof f>"u"||(f===null?i[0]==="?"?n+=this.indentate(r)+"<"+i+"?"+this.tagEndChar:n+=this.indentate(r)+"<"+i+"/"+this.tagEndChar:(0,NP.default)(f)==="object"?this.options.oneListGroup?u+=this.j2x(f,r+1).val:u+=this.processTextOrObjNode(f,i,r):u+=this.buildTextValNode(f,i,"",r))}this.options.oneListGroup&&(u=this.buildObjectNode(u,i,"",r)),n+=u}else if(this.options.attributesGroupName&&i===this.options.attributesGroupName)for(var c=Object.keys(t[i]),p=c.length,d=0;d<p;d++)e+=this.buildAttrPairStr(c[d],""+t[i][c[d]]);else n+=this.processTextOrObjNode(t[i],i,r);return{attrStr:e,val:n}};Bo.prototype.buildAttrPairStr=function(t,r){return r=this.options.attributeValueProcessor(t,""+r),r=this.replaceEntitiesValue(r),this.options.suppressBooleanAttributes&&r==="true"?" "+t:" "+t+'="'+r+'"'};function zPe(t,r,e){var n=this.j2x(t,e+1);return t[this.options.textNodeName]!==void 0&&Object.keys(t).length===1?this.buildTextValNode(t[this.options.textNodeName],r,n.attrStr,e):this.buildObjectNode(n.val,r,n.attrStr,e)}Bo.prototype.buildObjectNode=function(t,r,e,n){if(t==="")return r[0]==="?"?this.indentate(n)+"<"+r+e+"?"+this.tagEndChar:this.indentate(n)+"<"+r+e+this.closeTag(r)+this.tagEndChar;var i="</"+r+this.tagEndChar,a="";return r[0]==="?"&&(a="?",i=""),e&&t.indexOf("<")===-1?this.indentate(n)+"<"+r+e+a+">"+t+i:this.options.commentPropName!==!1&&r===this.options.commentPropName&&a.length===0?this.indentate(n)+"<!--".concat(t,"-->")+this.newLine:this.indentate(n)+"<"+r+e+a+this.tagEndChar+t+this.indentate(n)+i};Bo.prototype.closeTag=function(t){var r="";return this.options.unpairedTags.indexOf(t)!==-1?this.options.suppressUnpairedNode||(r="/"):this.options.suppressEmptyNode?r="/":r="></".concat(t),r};Bo.prototype.buildTextValNode=function(t,r,e,n){if(this.options.cdataPropName!==!1&&r===this.options.cdataPropName)return this.indentate(n)+"<![CDATA[".concat(t,"]]>")+this.newLine;if(this.options.commentPropName!==!1&&r===this.options.commentPropName)return this.indentate(n)+"<!--".concat(t,"-->")+this.newLine;if(r[0]==="?")return this.indentate(n)+"<"+r+e+"?"+this.tagEndChar;var i=this.options.tagValueProcessor(r,t);return i=this.replaceEntitiesValue(i),i===""?this.indentate(n)+"<"+r+e+this.closeTag(r)+this.tagEndChar:this.indentate(n)+"<"+r+e+">"+i+"</"+r+this.tagEndChar};Bo.prototype.replaceEntitiesValue=function(t){if(t&&t.length>0&&this.options.processEntities)for(var r=0;r<this.options.entities.length;r++){var e=this.options.entities[r];t=t.replace(e.regex,e.val)}return t};function VPe(t){return this.options.indentBy.repeat(t)}function HPe(t){return t.startsWith(this.options.attributeNamePrefix)?t.substr(this.attrPrefixLen):!1}wX.exports=Bo});var EX=Te((Tst,OX)=>{"use strict";var WPe=RP(),$Pe=yX(),XPe=PX();OX.exports={XMLParser:$Pe,XMLValidator:WPe,XMLBuilder:XPe}});var fO=Te((Kq,rd)=>{(function(t,r){typeof define=="function"&&define.amd?define([],r):typeof QI=="function"&&typeof rd=="object"&&rd&&rd.exports?rd.exports=r():(t.dcodeIO=t.dcodeIO||{}).Long=r()})(Kq,function(){"use strict";function t(C,T,I){this.low=C|0,this.high=T|0,this.unsigned=!!I}t.prototype.__isLong__,Object.defineProperty(t.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1});function r(C){return(C&&C.__isLong__)===!0}t.isLong=r;var e={},n={};function i(C,T){var I,R,V;return T?(C>>>=0,(V=0<=C&&C<256)&&(R=n[C],R)?R:(I=o(C,(C|0)<0?-1:0,!0),V&&(n[C]=I),I)):(C|=0,(V=-128<=C&&C<128)&&(R=e[C],R)?R:(I=o(C,C<0?-1:0,!1),V&&(e[C]=I),I))}t.fromInt=i;function a(C,T){if(isNaN(C)||!isFinite(C))return T?y:g;if(T){if(C<0)return y;if(C>=d)return S}else{if(C<=-v)return P;if(C+1>=v)return A}return C<0?a(-C,T).neg():o(C%p|0,C/p|0,T)}t.fromNumber=a;function o(C,T,I){return new t(C,T,I)}t.fromBits=o;var s=Math.pow;function u(C,T,I){if(C.length===0)throw Error("empty string");if(C==="NaN"||C==="Infinity"||C==="+Infinity"||C==="-Infinity")return g;if(typeof T=="number"?(I=T,T=!1):T=!!T,I=I||10,I<2||36<I)throw RangeError("radix");var R;if((R=C.indexOf("-"))>0)throw Error("interior hyphen");if(R===0)return u(C.substring(1),T,I).neg();for(var V=a(s(I,8)),z=g,k=0;k<C.length;k+=8){var G=Math.min(8,C.length-k),U=parseInt(C.substring(k,k+G),I);if(G<8){var $=a(s(I,G));z=z.mul($).add(a(U))}else z=z.mul(V),z=z.add(a(U))}return z.unsigned=T,z}t.fromString=u;function l(C){return C instanceof t?C:typeof C=="number"?a(C):typeof C=="string"?u(C):o(C.low,C.high,C.unsigned)}t.fromValue=l;var f=1<<16,c=1<<24,p=f*f,d=p*p,v=d/2,m=i(c),g=i(0);t.ZERO=g;var y=i(0,!0);t.UZERO=y;var _=i(1);t.ONE=_;var b=i(1,!0);t.UONE=b;var x=i(-1);t.NEG_ONE=x;var A=o(-1,2147483647,!1);t.MAX_VALUE=A;var S=o(-1,-1,!0);t.MAX_UNSIGNED_VALUE=S;var P=o(0,-2147483648,!1);t.MIN_VALUE=P;var O=t.prototype;return O.toInt=function(){return this.unsigned?this.low>>>0:this.low},O.toNumber=function(){return this.unsigned?(this.high>>>0)*p+(this.low>>>0):this.high*p+(this.low>>>0)},O.toString=function(T){if(T=T||10,T<2||36<T)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(P)){var I=a(T),R=this.div(I),V=R.mul(I).sub(this);return R.toString(T)+V.toInt().toString(T)}else return"-"+this.neg().toString(T);for(var z=a(s(T,6),this.unsigned),k=this,G="";;){var U=k.div(z),$=k.sub(U.mul(z)).toInt()>>>0,H=$.toString(T);if(k=U,k.isZero())return H+G;for(;H.length<6;)H="0"+H;G=""+H+G}},O.getHighBits=function(){return this.high},O.getHighBitsUnsigned=function(){return this.high>>>0},O.getLowBits=function(){return this.low},O.getLowBitsUnsigned=function(){return this.low>>>0},O.getNumBitsAbs=function(){if(this.isNegative())return this.eq(P)?64:this.neg().getNumBitsAbs();for(var T=this.high!=0?this.high:this.low,I=31;I>0&&!(T&1<<I);I--);return this.high!=0?I+33:I+1},O.isZero=function(){return this.high===0&&this.low===0},O.isNegative=function(){return!this.unsigned&&this.high<0},O.isPositive=function(){return this.unsigned||this.high>=0},O.isOdd=function(){return(this.low&1)===1},O.isEven=function(){return(this.low&1)===0},O.equals=function(T){return r(T)||(T=l(T)),this.unsigned!==T.unsigned&&this.high>>>31===1&&T.high>>>31===1?!1:this.high===T.high&&this.low===T.low},O.eq=O.equals,O.notEquals=function(T){return!this.eq(T)},O.neq=O.notEquals,O.lessThan=function(T){return this.comp(T)<0},O.lt=O.lessThan,O.lessThanOrEqual=function(T){return this.comp(T)<=0},O.lte=O.lessThanOrEqual,O.greaterThan=function(T){return this.comp(T)>0},O.gt=O.greaterThan,O.greaterThanOrEqual=function(T){return this.comp(T)>=0},O.gte=O.greaterThanOrEqual,O.compare=function(T){if(r(T)||(T=l(T)),this.eq(T))return 0;var I=this.isNegative(),R=T.isNegative();return I&&!R?-1:!I&&R?1:this.unsigned?T.high>>>0>this.high>>>0||T.high===this.high&&T.low>>>0>this.low>>>0?-1:1:this.sub(T).isNegative()?-1:1},O.comp=O.compare,O.negate=function(){return!this.unsigned&&this.eq(P)?P:this.not().add(_)},O.neg=O.negate,O.add=function(T){r(T)||(T=l(T));var I=this.high>>>16,R=this.high&65535,V=this.low>>>16,z=this.low&65535,k=T.high>>>16,G=T.high&65535,U=T.low>>>16,$=T.low&65535,H=0,Q=0,ie=0,fe=0;return fe+=z+$,ie+=fe>>>16,fe&=65535,ie+=V+U,Q+=ie>>>16,ie&=65535,Q+=R+G,H+=Q>>>16,Q&=65535,H+=I+k,H&=65535,o(ie<<16|fe,H<<16|Q,this.unsigned)},O.subtract=function(T){return r(T)||(T=l(T)),this.add(T.neg())},O.sub=O.subtract,O.multiply=function(T){if(this.isZero()||(r(T)||(T=l(T)),T.isZero()))return g;if(this.eq(P))return T.isOdd()?P:g;if(T.eq(P))return this.isOdd()?P:g;if(this.isNegative())return T.isNegative()?this.neg().mul(T.neg()):this.neg().mul(T).neg();if(T.isNegative())return this.mul(T.neg()).neg();if(this.lt(m)&&T.lt(m))return a(this.toNumber()*T.toNumber(),this.unsigned);var I=this.high>>>16,R=this.high&65535,V=this.low>>>16,z=this.low&65535,k=T.high>>>16,G=T.high&65535,U=T.low>>>16,$=T.low&65535,H=0,Q=0,ie=0,fe=0;return fe+=z*$,ie+=fe>>>16,fe&=65535,ie+=V*$,Q+=ie>>>16,ie&=65535,ie+=z*U,Q+=ie>>>16,ie&=65535,Q+=R*$,H+=Q>>>16,Q&=65535,Q+=V*U,H+=Q>>>16,Q&=65535,Q+=z*G,H+=Q>>>16,Q&=65535,H+=I*$+R*U+V*G+z*k,H&=65535,o(ie<<16|fe,H<<16|Q,this.unsigned)},O.mul=O.multiply,O.divide=function(T){if(r(T)||(T=l(T)),T.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?y:g;var I,R,V;if(this.unsigned){if(T.unsigned||(T=T.toUnsigned()),T.gt(this))return y;if(T.gt(this.shru(1)))return b;V=y}else{if(this.eq(P)){if(T.eq(_)||T.eq(x))return P;if(T.eq(P))return _;var z=this.shr(1);return I=z.div(T).shl(1),I.eq(g)?T.isNegative()?_:x:(R=this.sub(T.mul(I)),V=I.add(R.div(T)),V)}else if(T.eq(P))return this.unsigned?y:g;if(this.isNegative())return T.isNegative()?this.neg().div(T.neg()):this.neg().div(T).neg();if(T.isNegative())return this.div(T.neg()).neg();V=g}for(R=this;R.gte(T);){I=Math.max(1,Math.floor(R.toNumber()/T.toNumber()));for(var k=Math.ceil(Math.log(I)/Math.LN2),G=k<=48?1:s(2,k-48),U=a(I),$=U.mul(T);$.isNegative()||$.gt(R);)I-=G,U=a(I,this.unsigned),$=U.mul(T);U.isZero()&&(U=_),V=V.add(U),R=R.sub($)}return V},O.div=O.divide,O.modulo=function(T){return r(T)||(T=l(T)),this.sub(this.div(T).mul(T))},O.mod=O.modulo,O.not=function(){return o(~this.low,~this.high,this.unsigned)},O.and=function(T){return r(T)||(T=l(T)),o(this.low&T.low,this.high&T.high,this.unsigned)},O.or=function(T){return r(T)||(T=l(T)),o(this.low|T.low,this.high|T.high,this.unsigned)},O.xor=function(T){return r(T)||(T=l(T)),o(this.low^T.low,this.high^T.high,this.unsigned)},O.shiftLeft=function(T){return r(T)&&(T=T.toInt()),(T&=63)===0?this:T<32?o(this.low<<T,this.high<<T|this.low>>>32-T,this.unsigned):o(0,this.low<<T-32,this.unsigned)},O.shl=O.shiftLeft,O.shiftRight=function(T){return r(T)&&(T=T.toInt()),(T&=63)===0?this:T<32?o(this.low>>>T|this.high<<32-T,this.high>>T,this.unsigned):o(this.high>>T-32,this.high>=0?0:-1,this.unsigned)},O.shr=O.shiftRight,O.shiftRightUnsigned=function(T){if(r(T)&&(T=T.toInt()),T&=63,T===0)return this;var I=this.high;if(T<32){var R=this.low;return o(R>>>T|I<<32-T,I>>>T,this.unsigned)}else return T===32?o(I,0,this.unsigned):o(I>>>T-32,0,this.unsigned)},O.shru=O.shiftRightUnsigned,O.toSigned=function(){return this.unsigned?o(this.low,this.high,!1):this},O.toUnsigned=function(){return this.unsigned?this:o(this.low,this.high,!0)},O.toBytes=function(C){return C?this.toBytesLE():this.toBytesBE()},O.toBytesLE=function(){var C=this.high,T=this.low;return[T&255,T>>>8&255,T>>>16&255,T>>>24&255,C&255,C>>>8&255,C>>>16&255,C>>>24&255]},O.toBytesBE=function(){var C=this.high,T=this.low;return[C>>>24&255,C>>>16&255,C>>>8&255,C&255,T>>>24&255,T>>>16&255,T>>>8&255,T&255]},t})});var E0=Te((pct,oK)=>{oK.exports=globalThis.h3||{}});var Vae=Te(D2=>{D2.read=function(t,r,e,n,i){var a,o,s=i*8-n-1,u=(1<<s)-1,l=u>>1,f=-7,c=e?i-1:0,p=e?-1:1,d=t[r+c];for(c+=p,a=d&(1<<-f)-1,d>>=-f,f+=s;f>0;a=a*256+t[r+c],c+=p,f-=8);for(o=a&(1<<-f)-1,a>>=-f,f+=n;f>0;o=o*256+t[r+c],c+=p,f-=8);if(a===0)a=1-l;else{if(a===u)return o?NaN:(d?-1:1)*(1/0);o=o+Math.pow(2,n),a=a-l}return(d?-1:1)*o*Math.pow(2,a-n)};D2.write=function(t,r,e,n,i,a){var o,s,u,l=a*8-i-1,f=(1<<l)-1,c=f>>1,p=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:a-1,v=n?1:-1,m=r<0||r===0&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(s=isNaN(r)?1:0,o=f):(o=Math.floor(Math.log(r)/Math.LN2),r*(u=Math.pow(2,-o))<1&&(o--,u*=2),o+c>=1?r+=p/u:r+=p*Math.pow(2,1-c),r*u>=2&&(o++,u/=2),o+c>=f?(s=0,o=f):o+c>=1?(s=(r*u-1)*Math.pow(2,i),o=o+c):(s=r*Math.pow(2,c-1)*Math.pow(2,i),o=0));i>=8;t[e+d]=s&255,d+=v,s/=256,i-=8);for(o=o<<i|s,l+=i;l>0;t[e+d]=o&255,d+=v,o/=256,l-=8);t[e+d-v]|=m*128}});var Yae=Te((hxt,qae)=>{"use strict";qae.exports=ut;var pb=Vae();function ut(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}ut.Varint=0;ut.Fixed64=1;ut.Bytes=2;ut.Fixed32=5;var N2=(1<<16)*(1<<16),Hae=1/N2,pBe=12,Xae=typeof TextDecoder>"u"?null:new TextDecoder("utf8");ut.prototype={destroy:function(){this.buf=null},readFields:function(t,r,e){for(e=e||this.length;this.pos<e;){var n=this.readVarint(),i=n>>3,a=this.pos;this.type=n&7,t(i,r,this),this.pos===a&&this.skip(n)}return r},readMessage:function(t,r){return this.readFields(t,r,this.readVarint()+this.pos)},readFixed32:function(){var t=hb(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=$ae(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=hb(this.buf,this.pos)+hb(this.buf,this.pos+4)*N2;return this.pos+=8,t},readSFixed64:function(){var t=hb(this.buf,this.pos)+$ae(this.buf,this.pos+4)*N2;return this.pos+=8,t},readFloat:function(){var t=pb.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=pb.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var r=this.buf,e,n;return n=r[this.pos++],e=n&127,n<128||(n=r[this.pos++],e|=(n&127)<<7,n<128)||(n=r[this.pos++],e|=(n&127)<<14,n<128)||(n=r[this.pos++],e|=(n&127)<<21,n<128)?e:(n=r[this.pos],e|=(n&15)<<28,hBe(e,t,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2===1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,r=this.pos;return this.pos=t,t-r>=pBe&&Xae?OBe(this.buf,r,t):PBe(this.buf,r,t)},readBytes:function(){var t=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,t);return this.pos=t,r},readPackedVarint:function(t,r){if(this.type!==ut.Bytes)return t.push(this.readVarint(r));var e=ro(this);for(t=t||[];this.pos<e;)t.push(this.readVarint(r));return t},readPackedSVarint:function(t){if(this.type!==ut.Bytes)return t.push(this.readSVarint());var r=ro(this);for(t=t||[];this.pos<r;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==ut.Bytes)return t.push(this.readBoolean());var r=ro(this);for(t=t||[];this.pos<r;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==ut.Bytes)return t.push(this.readFloat());var r=ro(this);for(t=t||[];this.pos<r;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==ut.Bytes)return t.push(this.readDouble());var r=ro(this);for(t=t||[];this.pos<r;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==ut.Bytes)return t.push(this.readFixed32());var r=ro(this);for(t=t||[];this.pos<r;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==ut.Bytes)return t.push(this.readSFixed32());var r=ro(this);for(t=t||[];this.pos<r;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==ut.Bytes)return t.push(this.readFixed64());var r=ro(this);for(t=t||[];this.pos<r;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==ut.Bytes)return t.push(this.readSFixed64());var r=ro(this);for(t=t||[];this.pos<r;)t.push(this.readSFixed64());return t},skip:function(t){var r=t&7;if(r===ut.Varint)for(;this.buf[this.pos++]>127;);else if(r===ut.Bytes)this.pos=this.readVarint()+this.pos;else if(r===ut.Fixed32)this.pos+=4;else if(r===ut.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+r)},writeTag:function(t,r){this.writeVarint(t<<3|r)},realloc:function(t){for(var r=this.length||16;r<this.pos+t;)r*=2;if(r!==this.length){var e=new Uint8Array(r);e.set(this.buf),this.buf=e,this.length=r}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Kf(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Kf(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Kf(this.buf,t&-1,this.pos),Kf(this.buf,Math.floor(t*Hae),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Kf(this.buf,t&-1,this.pos),Kf(this.buf,Math.floor(t*Hae),this.pos+4),this.pos+=8},writeVarint:function(t){if(t=+t||0,t>268435455||t<0){dBe(t,this);return}this.realloc(4),this.buf[this.pos++]=t&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=t>>>7&127)))},writeSVarint:function(t){this.writeVarint(t<0?-t*2-1:t*2)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(t.length*4),this.pos++;var r=this.pos;this.pos=EBe(this.buf,t,this.pos);var e=this.pos-r;e>=128&&Wae(r,e,this),this.pos=r-1,this.writeVarint(e),this.pos+=e},writeFloat:function(t){this.realloc(4),pb.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),pb.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var r=t.length;this.writeVarint(r),this.realloc(r);for(var e=0;e<r;e++)this.buf[this.pos++]=t[e]},writeRawMessage:function(t,r){this.pos++;var e=this.pos;t(r,this);var n=this.pos-e;n>=128&&Wae(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeMessage:function(t,r,e){this.writeTag(t,ut.Bytes),this.writeRawMessage(r,e)},writePackedVarint:function(t,r){r.length&&this.writeMessage(t,gBe,r)},writePackedSVarint:function(t,r){r.length&&this.writeMessage(t,yBe,r)},writePackedBoolean:function(t,r){r.length&&this.writeMessage(t,xBe,r)},writePackedFloat:function(t,r){r.length&&this.writeMessage(t,_Be,r)},writePackedDouble:function(t,r){r.length&&this.writeMessage(t,bBe,r)},writePackedFixed32:function(t,r){r.length&&this.writeMessage(t,ABe,r)},writePackedSFixed32:function(t,r){r.length&&this.writeMessage(t,SBe,r)},writePackedFixed64:function(t,r){r.length&&this.writeMessage(t,TBe,r)},writePackedSFixed64:function(t,r){r.length&&this.writeMessage(t,wBe,r)},writeBytesField:function(t,r){this.writeTag(t,ut.Bytes),this.writeBytes(r)},writeFixed32Field:function(t,r){this.writeTag(t,ut.Fixed32),this.writeFixed32(r)},writeSFixed32Field:function(t,r){this.writeTag(t,ut.Fixed32),this.writeSFixed32(r)},writeFixed64Field:function(t,r){this.writeTag(t,ut.Fixed64),this.writeFixed64(r)},writeSFixed64Field:function(t,r){this.writeTag(t,ut.Fixed64),this.writeSFixed64(r)},writeVarintField:function(t,r){this.writeTag(t,ut.Varint),this.writeVarint(r)},writeSVarintField:function(t,r){this.writeTag(t,ut.Varint),this.writeSVarint(r)},writeStringField:function(t,r){this.writeTag(t,ut.Bytes),this.writeString(r)},writeFloatField:function(t,r){this.writeTag(t,ut.Fixed32),this.writeFloat(r)},writeDoubleField:function(t,r){this.writeTag(t,ut.Fixed64),this.writeDouble(r)},writeBooleanField:function(t,r){this.writeVarintField(t,Boolean(r))}};function hBe(t,r,e){var n=e.buf,i,a;if(a=n[e.pos++],i=(a&112)>>4,a<128||(a=n[e.pos++],i|=(a&127)<<3,a<128)||(a=n[e.pos++],i|=(a&127)<<10,a<128)||(a=n[e.pos++],i|=(a&127)<<17,a<128)||(a=n[e.pos++],i|=(a&127)<<24,a<128)||(a=n[e.pos++],i|=(a&1)<<31,a<128))return Yf(t,i,r);throw new Error("Expected varint not more than 10 bytes")}function ro(t){return t.type===ut.Bytes?t.readVarint()+t.pos:t.pos+1}function Yf(t,r,e){return e?r*4294967296+(t>>>0):(r>>>0)*4294967296+(t>>>0)}function dBe(t,r){var e,n;if(t>=0?(e=t%4294967296|0,n=t/4294967296|0):(e=~(-t%4294967296),n=~(-t/4294967296),e^4294967295?e=e+1|0:(e=0,n=n+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),vBe(e,n,r),mBe(n,r)}function vBe(t,r,e){e.buf[e.pos++]=t&127|128,t>>>=7,e.buf[e.pos++]=t&127|128,t>>>=7,e.buf[e.pos++]=t&127|128,t>>>=7,e.buf[e.pos++]=t&127|128,t>>>=7,e.buf[e.pos]=t&127}function mBe(t,r){var e=(t&7)<<4;r.buf[r.pos++]|=e|((t>>>=3)?128:0),t&&(r.buf[r.pos++]=t&127|((t>>>=7)?128:0),t&&(r.buf[r.pos++]=t&127|((t>>>=7)?128:0),t&&(r.buf[r.pos++]=t&127|((t>>>=7)?128:0),t&&(r.buf[r.pos++]=t&127|((t>>>=7)?128:0),t&&(r.buf[r.pos++]=t&127)))))}function Wae(t,r,e){var n=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(Math.LN2*7));e.realloc(n);for(var i=e.pos-1;i>=t;i--)e.buf[i+n]=e.buf[i]}function gBe(t,r){for(var e=0;e<t.length;e++)r.writeVarint(t[e])}function yBe(t,r){for(var e=0;e<t.length;e++)r.writeSVarint(t[e])}function _Be(t,r){for(var e=0;e<t.length;e++)r.writeFloat(t[e])}function bBe(t,r){for(var e=0;e<t.length;e++)r.writeDouble(t[e])}function xBe(t,r){for(var e=0;e<t.length;e++)r.writeBoolean(t[e])}function ABe(t,r){for(var e=0;e<t.length;e++)r.writeFixed32(t[e])}function SBe(t,r){for(var e=0;e<t.length;e++)r.writeSFixed32(t[e])}function TBe(t,r){for(var e=0;e<t.length;e++)r.writeFixed64(t[e])}function wBe(t,r){for(var e=0;e<t.length;e++)r.writeSFixed64(t[e])}function hb(t,r){return(t[r]|t[r+1]<<8|t[r+2]<<16)+t[r+3]*16777216}function Kf(t,r,e){t[e]=r,t[e+1]=r>>>8,t[e+2]=r>>>16,t[e+3]=r>>>24}function $ae(t,r){return(t[r]|t[r+1]<<8|t[r+2]<<16)+(t[r+3]<<24)}function PBe(t,r,e){for(var n="",i=r;i<e;){var a=t[i],o=null,s=a>239?4:a>223?3:a>191?2:1;if(i+s>e)break;var u,l,f;s===1?a<128&&(o=a):s===2?(u=t[i+1],(u&192)===128&&(o=(a&31)<<6|u&63,o<=127&&(o=null))):s===3?(u=t[i+1],l=t[i+2],(u&192)===128&&(l&192)===128&&(o=(a&15)<<12|(u&63)<<6|l&63,(o<=2047||o>=55296&&o<=57343)&&(o=null))):s===4&&(u=t[i+1],l=t[i+2],f=t[i+3],(u&192)===128&&(l&192)===128&&(f&192)===128&&(o=(a&15)<<18|(u&63)<<12|(l&63)<<6|f&63,(o<=65535||o>=1114112)&&(o=null))),o===null?(o=65533,s=1):o>65535&&(o-=65536,n+=String.fromCharCode(o>>>10&1023|55296),o=56320|o&1023),n+=String.fromCharCode(o),i+=s}return n}function OBe(t,r,e){return Xae.decode(t.subarray(r,e))}function EBe(t,r,e){for(var n=0,i,a;n<r.length;n++){if(i=r.charCodeAt(n),i>55295&&i<57344)if(a)if(i<56320){t[e++]=239,t[e++]=191,t[e++]=189,a=i;continue}else i=a-55296<<10|i-56320|65536,a=null;else{i>56319||n+1===r.length?(t[e++]=239,t[e++]=191,t[e++]=189):a=i;continue}else a&&(t[e++]=239,t[e++]=191,t[e++]=189,a=null);i<128?t[e++]=i:(i<2048?t[e++]=i>>6|192:(i<65536?t[e++]=i>>12|224:(t[e++]=i>>18|240,t[e++]=i>>12&63|128),t[e++]=i>>6&63|128),t[e++]=i&63|128)}return e}});var ise=Te((EAt,nse)=>{"use strict";var y3e="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";nse.exports=y3e});var use=Te((CAt,sse)=>{"use strict";var _3e=ise();function ase(){}function ose(){}ose.resetWarningCache=ase;sse.exports=function(){function t(n,i,a,o,s,u){if(u!==_3e){var l=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw l.name="Invariant Violation",l}}t.isRequired=t;function r(){return t}var e={array:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:r,element:t,elementType:t,instanceOf:r,node:t,objectOf:r,oneOf:r,oneOfType:r,shape:r,exact:r,checkPropTypes:ose,resetWarningCache:ase};return e.PropTypes=e,e}});var fse=Te((RAt,lse)=>{lse.exports=use()();var MAt,IAt});var FDe={};un(FDe,{AGGREGATION_OPERATION:()=>gt,AmbientLight:()=>ig,ArcLayer:()=>tf,AttributeManager:()=>Eo,BitmapLayer:()=>rf,BrushingExtension:()=>$_,COORDINATE_SYSTEM:()=>ue,CPUGridLayer:()=>Fu,ClipExtension:()=>Hf,CollisionFilterExtension:()=>rb,ColumnLayer:()=>Wi,CompositeLayer:()=>Ot,ContourLayer:()=>zb,Controller:()=>Ln,DataFilterExtension:()=>Y_,Deck:()=>dn,DeckGL:()=>bse,DeckRenderer:()=>Bg,DirectionalLight:()=>Is,FillStyleExtension:()=>Q_,FirstPersonController:()=>py,FirstPersonView:()=>Ow,FirstPersonViewport:()=>ly,FlyToInterpolator:()=>AH,Fp64Extension:()=>d2,GPUGridLayer:()=>ju,GeoJsonLayer:()=>Ra,GeohashLayer:()=>_b,GoogleMapsOverlay:()=>$fe,GreatCircleLayer:()=>f0,GridCellLayer:()=>ff,GridLayer:()=>Xb,H3ClusterLayer:()=>M0,H3HexagonLayer:()=>ja,HeatmapLayer:()=>Yb,HexagonLayer:()=>Db,IconLayer:()=>Co,Layer:()=>He,LayerExtension:()=>Gt,LayerManager:()=>Og,LightingEffect:()=>Fp,LineLayer:()=>af,LinearInterpolator:()=>Zr,MVTLayer:()=>yb,MapController:()=>Lg,MapView:()=>Vs,MapboxLayer:()=>Jb,MapboxOverlay:()=>uce,MaskExtension:()=>nb,OPERATION:()=>mB,OrbitController:()=>dy,OrbitView:()=>Lw,OrbitViewport:()=>sy,OrthographicController:()=>vy,OrthographicView:()=>jw,OrthographicViewport:()=>Ql,PathLayer:()=>$i,PathStyleExtension:()=>Z_,PointCloudLayer:()=>of,PointLight:()=>xg,PolygonLayer:()=>qi,PostProcessEffect:()=>o6,QuadkeyLayer:()=>v0,S2Layer:()=>h0,ScatterplotLayer:()=>sf,ScenegraphLayer:()=>Cf,ScreenGridLayer:()=>kb,SimpleMeshLayer:()=>Ga,SolidPolygonLayer:()=>Xi,TRANSITION_EVENTS:()=>Vp,TerrainLayer:()=>W_,Tesselator:()=>ef,TextLayer:()=>mf,Tile3DLayer:()=>D_,TileLayer:()=>Na,TransitionInterpolator:()=>jl,TripsLayer:()=>O0,UNIT:()=>St,VERSION:()=>Bv,View:()=>Rn,Viewport:()=>Ar,WebMercatorViewport:()=>Kr,_AggregationLayer:()=>xi,_BinSorter:()=>nc,_CPUAggregator:()=>sc,_CameraLight:()=>UU,_GPUGridAggregator:()=>Ir,_GeoCellLayer:()=>Dn,_GlobeController:()=>_y,_GlobeView:()=>Hw,_GlobeViewport:()=>Jl,_LayersPass:()=>Xr,_MultiIconLayer:()=>df,_PickLayersPass:()=>So,_SunLight:()=>YU,_TerrainExtension:()=>ub,_TextBackgroundLayer:()=>vf,_Tile2DHeader:()=>nd,_Tileset2D:()=>ld,_WMSLayer:()=>l0,_compareProps:()=>Xl,_count:()=>ey,_deepEqual:()=>Lt,_fillArray:()=>Pg,_flatten:()=>jr,_getURLFromTemplate:()=>Qi,_memoize:()=>qr,_mergeShaders:()=>Ea,_registerLoggers:()=>kv,assert:()=>rt,createIterable:()=>Ut,fp64LowPart:()=>oi,gouraudLighting:()=>pn,log:()=>J,phongLighting:()=>ya,picking:()=>st,project:()=>Qt,project32:()=>Je,project64:()=>K_,shadow:()=>Ns});var oO=h(me()),s0=h(ye()),Fq=h(L()),Dq=h(N()),Nq=h(be()),jq=h(Ee()),Uq=h(Y()),Gq=h(K()),u0=h(q()),td=h(B()),ou=h(ve());var vB=h(B());var IL=h(ye()),rx=h(ve());function Ne(t,r){if(!t)throw new Error(r||"loader assertion failed.")}var SR=h(ze()),Pi={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document},npe=Pi.self||Pi.window||Pi.global||{},ipe=Pi.window||Pi.self||Pi.global||{},ape=Pi.global||Pi.self||Pi.window||{},ope=Pi.document||{};var fa=Boolean((typeof process>"u"?"undefined":(0,SR.default)(process))!=="object"||String(process)!=="[object process]"||process.browser);var AR=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version),spe=AR&&parseFloat(AR[1])||0;var wR=h(ze()),PR=h(me()),OR=h(B());function TR(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function upe(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?TR(Object(e),!0).forEach(function(n){(0,OR.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):TR(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function _1(t,r){for(var e=upe({},t),n=0,i=Object.entries(r);n<i.length;n++){var a=(0,PR.default)(i[n],2),o=a[0],s=a[1];s&&(0,wR.default)(s)==="object"?(e[o]=e[o]||{},Object.assign(e[o],r[o])):e[o]=r[o]}return e}var ER="3.4.2";function pr(t,r){if(!t)throw new Error(r||"loaders.gl assertion failed.")}var MR=h(ze()),Oi={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document},sNe=Oi.self||Oi.window||Oi.global||{},uNe=Oi.window||Oi.self||Oi.global||{},IR=Oi.global||Oi.self||Oi.window||{},lNe=Oi.document||{};var Lr=(typeof process>"u"?"undefined":(0,MR.default)(process))!=="object"||String(process)!=="[object process]"||process.browser,Cc=typeof importScripts=="function",RR=typeof window<"u"&&typeof window.orientation<"u",CR=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version),fNe=CR&&parseFloat(CR[1])||0;var LR=h(L()),kR=h(N());function w(t,r,e){return r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e,t}var BR=function(){function t(r,e){var n=this;(0,LR.default)(this,t),w(this,"name",void 0),w(this,"workerThread",void 0),w(this,"isRunning",!0),w(this,"result",void 0),w(this,"_resolve",function(){}),w(this,"_reject",function(){}),this.name=r,this.workerThread=e,this.result=new Promise(function(i,a){n._resolve=i,n._reject=a})}return(0,kR.default)(t,[{key:"postMessage",value:function(e,n){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:n})}},{key:"done",value:function(e){pr(this.isRunning),this.isRunning=!1,this._resolve(e)}},{key:"error",value:function(e){pr(this.isRunning),this.isRunning=!1,this._reject(e)}}]),t}();var zR=h(L()),VR=h(N());var FR=h(L()),DR=h(N()),vv=function(){function t(){(0,FR.default)(this,t)}return(0,DR.default)(t,[{key:"terminate",value:function(){}}]),t}();var b1=new Map;function NR(t){pr(t.source&&!t.url||!t.source&&t.url);var r=b1.get(t.source||t.url);return r||(t.url&&(r=lpe(t.url),b1.set(t.url,r)),t.source&&(r=jR(t.source),b1.set(t.source,r))),pr(r),r}function lpe(t){if(!t.startsWith("http"))return t;var r=fpe(t);return jR(r)}function jR(t){var r=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(r)}function fpe(t){return`try {
  importScripts('`.concat(t,`');
} catch (error) {
  console.error(error);
  throw error;
}`)}var GR=h(ze());function x1(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,e=arguments.length>2?arguments[2]:void 0,n=e||new Set;if(t){if(UR(t))n.add(t);else if(UR(t.buffer))n.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(r&&(0,GR.default)(t)==="object")for(var i in t)x1(t[i],r,n)}}return e===void 0?Array.from(n):[]}function UR(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}var A1=function(){},Mc=function(){function t(r){(0,zR.default)(this,t),w(this,"name",void 0),w(this,"source",void 0),w(this,"url",void 0),w(this,"terminated",!1),w(this,"worker",void 0),w(this,"onMessage",void 0),w(this,"onError",void 0),w(this,"_loadableURL","");var e=r.name,n=r.source,i=r.url;pr(n||i),this.name=e,this.source=n,this.url=i,this.onMessage=A1,this.onError=function(a){return console.log(a)},this.worker=Lr?this._createBrowserWorker():this._createNodeWorker()}return(0,VR.default)(t,[{key:"destroy",value:function(){this.onMessage=A1,this.onError=A1,this.worker.terminate(),this.terminated=!0}},{key:"isRunning",get:function(){return Boolean(this.onMessage)}},{key:"postMessage",value:function(e,n){n=n||x1(e),this.worker.postMessage(e,n)}},{key:"_getErrorFromErrorEvent",value:function(e){var n="Failed to load ";return n+="worker ".concat(this.name," from ").concat(this.url,". "),e.message&&(n+="".concat(e.message," in ")),e.lineno&&(n+=":".concat(e.lineno,":").concat(e.colno)),new Error(n)}},{key:"_createBrowserWorker",value:function(){var e=this;this._loadableURL=NR({source:this.source,url:this.url});var n=new Worker(this._loadableURL,{name:this.name});return n.onmessage=function(i){i.data?e.onMessage(i.data):e.onError(new Error("No data received"))},n.onerror=function(i){e.onError(e._getErrorFromErrorEvent(i)),e.terminated=!0},n.onmessageerror=function(i){return console.error(i)},n}},{key:"_createNodeWorker",value:function(){var e=this,n;if(this.url){var i=this.url.includes(":/")||this.url.startsWith("/"),a=i?this.url:"./".concat(this.url);n=new vv(a,{eval:!1})}else if(this.source)n=new vv(this.source,{eval:!0});else throw new Error("no worker");return n.on("message",function(o){e.onMessage(o)}),n.on("error",function(o){e.onError(o)}),n.on("exit",function(o){}),n}}],[{key:"isSupported",value:function(){return typeof Worker<"u"&&Lr||typeof vv<"u"&&!Lr}}]),t}();var QR=h(B()),eL=h(L()),tL=h(N());var S1=h(ye()),$R=h(B()),XR=h(L()),qR=h(N()),Ic=h(ve());function HR(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function WR(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?HR(Object(e),!0).forEach(function(n){(0,$R.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):HR(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var YR=function(){function t(r){(0,XR.default)(this,t),w(this,"name","unnamed"),w(this,"source",void 0),w(this,"url",void 0),w(this,"maxConcurrency",1),w(this,"maxMobileConcurrency",1),w(this,"onDebug",function(){}),w(this,"reuseWorkers",!0),w(this,"props",{}),w(this,"jobQueue",[]),w(this,"idleQueue",[]),w(this,"count",0),w(this,"isDestroyed",!1),this.source=r.source,this.url=r.url,this.setProps(r)}return(0,qR.default)(t,[{key:"destroy",value:function(){this.idleQueue.forEach(function(e){return e.destroy()}),this.isDestroyed=!0}},{key:"setProps",value:function(e){this.props=WR(WR({},this.props),e),e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}},{key:"startJob",value:function(){var r=(0,S1.default)(Ic.default.mark(function n(i){var a=this,o,s,u,l=arguments;return Ic.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return o=l.length>1&&l[1]!==void 0?l[1]:function(p,d,v){return p.done(v)},s=l.length>2&&l[2]!==void 0?l[2]:function(p,d){return p.error(d)},u=new Promise(function(p){return a.jobQueue.push({name:i,onMessage:o,onError:s,onStart:p}),a}),this._startQueuedJob(),c.next=6,u;case 6:return c.abrupt("return",c.sent);case 7:case"end":return c.stop()}},n,this)}));function e(n){return r.apply(this,arguments)}return e}()},{key:"_startQueuedJob",value:function(){var r=(0,S1.default)(Ic.default.mark(function n(){var i,a,o;return Ic.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(this.jobQueue.length){u.next=2;break}return u.abrupt("return");case 2:if(i=this._getAvailableWorker(),i){u.next=5;break}return u.abrupt("return");case 5:if(a=this.jobQueue.shift(),!a){u.next=18;break}return this.onDebug({message:"Starting job",name:a.name,workerThread:i,backlog:this.jobQueue.length}),o=new BR(a.name,i),i.onMessage=function(l){return a.onMessage(o,l.type,l.payload)},i.onError=function(l){return a.onError(o,l)},a.onStart(o),u.prev=12,u.next=15,o.result;case 15:return u.prev=15,this.returnWorkerToQueue(i),u.finish(15);case 18:case"end":return u.stop()}},n,this,[[12,,15,18]])}));function e(){return r.apply(this,arguments)}return e}()},{key:"returnWorkerToQueue",value:function(e){var n=this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency();n?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}},{key:"_getAvailableWorker",value:function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;var e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new Mc({name:e,source:this.source,url:this.url})}return null}},{key:"_getMaxConcurrency",value:function(){return RR?this.maxMobileConcurrency:this.maxConcurrency}}],[{key:"isSupported",value:function(){return Mc.isSupported()}}]),t}();function KR(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=cpe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function cpe(t,r){if(t){if(typeof t=="string")return ZR(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return ZR(t,r)}}function ZR(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function JR(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function T1(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?JR(Object(e),!0).forEach(function(n){(0,QR.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):JR(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var ppe={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:function(){}},Rc=function(){function t(r){(0,eL.default)(this,t),w(this,"props",void 0),w(this,"workerPools",new Map),this.props=T1({},ppe),this.setProps(r),this.workerPools=new Map}return(0,tL.default)(t,[{key:"destroy",value:function(){var e=KR(this.workerPools.values()),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;i.destroy()}}catch(a){e.e(a)}finally{e.f()}this.workerPools=new Map}},{key:"setProps",value:function(e){this.props=T1(T1({},this.props),e);var n=KR(this.workerPools.values()),i;try{for(n.s();!(i=n.n()).done;){var a=i.value;a.setProps(this._getWorkerPoolProps())}}catch(o){n.e(o)}finally{n.f()}}},{key:"getWorkerPool",value:function(e){var n=e.name,i=e.source,a=e.url,o=this.workerPools.get(n);return o||(o=new YR({name:n,source:i,url:a}),o.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,o)),o}},{key:"_getWorkerPoolProps",value:function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}],[{key:"isSupported",value:function(){return Mc.isSupported()}},{key:"getWorkerFarm",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t._workerFarm=t._workerFarm||new t({}),t._workerFarm.setProps(e),t._workerFarm}}]),t}();w(Rc,"_workerFarm",void 0);var hpe="latest";function w1(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=r[t.id]||{},n="".concat(t.id,"-worker.js"),i=e.workerUrl;if(!i&&t.id==="compression"&&(i=r.workerUrl),r._workerType==="test"&&(i="modules/".concat(t.module,"/dist/").concat(n)),!i){var a=t.version;a==="latest"&&(a=hpe);var o=a?"@".concat(a):"";i="https://unpkg.com/@loaders.gl/".concat(t.module).concat(o,"/dist/").concat(n)}return pr(i),i}function P1(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ER;pr(t,"no worker provided");var e=t.version;return!(!r||!e)}var M1=h(ye()),Lc=h(ve());var os=h(nL());var vpe="3.4.2",O1={};function Ei(t){return E1.apply(this,arguments)}function E1(){return E1=(0,M1.default)(Lc.default.mark(function t(r){var e,n,i=arguments;return Lc.default.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return e=i.length>1&&i[1]!==void 0?i[1]:null,n=i.length>2&&i[2]!==void 0?i[2]:{},e&&(r=iL(r,e,n)),O1[r]=O1[r]||mpe(r),o.next=6,O1[r];case 6:return o.abrupt("return",o.sent);case 7:case"end":return o.stop()}},t)})),E1.apply(this,arguments)}function iL(t,r,e){if(t.startsWith("http"))return t;var n=e.modules||{};return n[t]?n[t]:Lr?e.CDN?(pr(e.CDN.startsWith("http")),"".concat(e.CDN,"/").concat(r,"@").concat(vpe,"/dist/libs/").concat(t)):Cc?"../src/libs/".concat(t):"modules/".concat(r,"/src/libs/").concat(t):"modules/".concat(r,"/dist/libs/").concat(t)}function mpe(t){return C1.apply(this,arguments)}function C1(){return C1=(0,M1.default)(Lc.default.mark(function t(r){var e,n,i;return Lc.default.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(!r.endsWith("wasm")){o.next=7;break}return o.next=3,fetch(r);case 3:return e=o.sent,o.next=6,e.arrayBuffer();case 6:return o.abrupt("return",o.sent);case 7:if(Lr){o.next=20;break}if(o.prev=8,o.t0=os&&os.requireFromFile,!o.t0){o.next=14;break}return o.next=13,os.requireFromFile(r);case 13:o.t0=o.sent;case 14:return o.abrupt("return",o.t0);case 17:return o.prev=17,o.t1=o.catch(8),o.abrupt("return",null);case 20:if(!Cc){o.next=22;break}return o.abrupt("return",importScripts(r));case 22:return o.next=24,fetch(r);case 24:return n=o.sent,o.next=27,n.text();case 27:return i=o.sent,o.abrupt("return",gpe(i,r));case 29:case"end":return o.stop()}},t,null,[[8,17]])})),C1.apply(this,arguments)}function gpe(t,r){if(!Lr)return os.requireFromString&&os.requireFromString(t,r);if(Cc)return eval.call(IR,t),null;var e=document.createElement("script");e.id=r;try{e.appendChild(document.createTextNode(t))}catch{e.text=t}return document.body.appendChild(e),null}var L1=h(ye()),kc=h(ve());function k1(t,r){return!Rc.isSupported()||!Lr&&!(r!=null&&r._nodeWorkers)?!1:t.worker&&r?.worker}function B1(t,r,e,n,i){return I1.apply(this,arguments)}function I1(){return I1=(0,L1.default)(kc.default.mark(function t(r,e,n,i,a){var o,s,u,l,f,c;return kc.default.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return o=r.id,s=w1(r,n),u=Rc.getWorkerFarm(n),l=u.getWorkerPool({name:o,url:s}),n=JSON.parse(JSON.stringify(n)),i=JSON.parse(JSON.stringify(i||{})),d.next=8,l.startJob("process-on-worker",ype.bind(null,a));case 8:return f=d.sent,f.postMessage("process",{input:e,options:n,context:i}),d.next=12,f.result;case 12:return c=d.sent,d.next=15,c.result;case 15:return d.abrupt("return",d.sent);case 16:case"end":return d.stop()}},t)})),I1.apply(this,arguments)}function ype(t,r,e,n){return R1.apply(this,arguments)}function R1(){return R1=(0,L1.default)(kc.default.mark(function t(r,e,n,i){var a,o,s,u,l;return kc.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:c.t0=n,c.next=c.t0==="done"?3:c.t0==="error"?5:c.t0==="process"?7:20;break;case 3:return e.done(i),c.abrupt("break",21);case 5:return e.error(new Error(i.error)),c.abrupt("break",21);case 7:return a=i.id,o=i.input,s=i.options,c.prev=8,c.next=11,r(o,s);case 11:u=c.sent,e.postMessage("done",{id:a,result:u}),c.next=19;break;case 15:c.prev=15,c.t1=c.catch(8),l=c.t1 instanceof Error?c.t1.message:"unknown error",e.postMessage("error",{id:a,error:l});case 19:return c.abrupt("break",21);case 20:console.warn("parse-with-worker unknown message ".concat(n));case 21:case"end":return c.stop()}},t,null,[[8,15]])})),R1.apply(this,arguments)}function oL(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;if(typeof t=="string")return t.slice(0,r);if(ArrayBuffer.isView(t))return aL(t.buffer,t.byteOffset,r);if(t instanceof ArrayBuffer){var e=0;return aL(t,e,r)}return""}function aL(t,r,e){if(t.byteLength<=r+e)return"";for(var n=new DataView(t),i="",a=0;a<e;a++)i+=String.fromCharCode(n.getUint8(r+a));return i}function F1(t){try{return JSON.parse(t)}catch{throw new Error('Failed to parse JSON from data starting with "'.concat(oL(t),'"'))}}function _pe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=bpe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function bpe(t,r){if(t){if(typeof t=="string")return sL(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return sL(t,r)}}function sL(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function D1(t,r,e){if(e=e||t.byteLength,t.byteLength<e||r.byteLength<e)return!1;for(var n=new Uint8Array(t),i=new Uint8Array(r),a=0;a<n.length;++a)if(n[a]!==i[a])return!1;return!0}function N1(){for(var t=arguments.length,r=new Array(t),e=0;e<t;e++)r[e]=arguments[e];var n=r.map(function(f){return f instanceof ArrayBuffer?new Uint8Array(f):f}),i=n.reduce(function(f,c){return f+c.byteLength},0),a=new Uint8Array(i),o=0,s=_pe(n),u;try{for(s.s();!(u=s.n()).done;){var l=u.value;a.set(l,o),o+=l.byteLength}}catch(f){s.e(f)}finally{s.f()}return a.buffer}function Bc(){for(var t=arguments.length,r=new Array(t),e=0;e<t;e++)r[e]=arguments[e];var n=r,i=n&&n.length>1&&n[0].constructor||null;if(!i)throw new Error('"concatenateTypedArrays" - incorrect quantity of arguments or arguments have incompatible data types');for(var a=n.reduce(function(c,p){return c+p.length},0),o=new i(a),s=0,u=0,l=n;u<l.length;u++){var f=l[u];o.set(f,s),s+=f.length}return o}function ss(t,r,e){var n=e!==void 0?new Uint8Array(t).subarray(r,r+e):new Uint8Array(t).subarray(r),i=new Uint8Array(n);return i.buffer}function ao(t,r){return Ne(t>=0),Ne(r>0),t+(r-1)&~(r-1)}function j1(t,r,e){var n;if(t instanceof ArrayBuffer)n=new Uint8Array(t);else{var i=t.byteOffset,a=t.byteLength;n=new Uint8Array(t.buffer||t.arrayBuffer,i,a)}return r.set(n,e),e+ao(n.byteLength,4)}var hL=h(ye()),dL=h(mv()),V1=h(ve());function W1(t){return H1.apply(this,arguments)}function H1(){return H1=(0,hL.default)(V1.default.mark(function t(r){var e,n,i,a,o,s,u;return V1.default.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:e=[],n=!1,i=!1,f.prev=3,o=(0,dL.default)(r);case 5:return f.next=7,o.next();case 7:if(!(n=!(s=f.sent).done)){f.next=13;break}u=s.value,e.push(u);case 10:n=!1,f.next=5;break;case 13:f.next=19;break;case 15:f.prev=15,f.t0=f.catch(3),i=!0,a=f.t0;case 19:if(f.prev=19,f.prev=20,!(n&&o.return!=null)){f.next=24;break}return f.next=24,o.return();case 24:if(f.prev=24,!i){f.next=27;break}throw a;case 27:return f.finish(24);case 28:return f.finish(19);case 29:return f.abrupt("return",N1.apply(void 0,e));case 30:case"end":return f.stop()}},t,null,[[3,15,19,29],[20,,24,28]])})),H1.apply(this,arguments)}var gL=h(B()),yL=h(L()),_L=h(N());function Dc(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){let r=process.hrtime();t=r[0]*1e3+r[1]/1e6}else t=Date.now();return t}var us=class{constructor(r,e){w(this,"name",void 0),w(this,"type",void 0),w(this,"sampleSize",1),w(this,"time",0),w(this,"count",0),w(this,"samples",0),w(this,"lastTiming",0),w(this,"lastSampleTime",0),w(this,"lastSampleCount",0),w(this,"_count",0),w(this,"_time",0),w(this,"_samples",0),w(this,"_startTime",0),w(this,"_timerPending",!1),this.name=r,this.type=e,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(r){return this.sampleSize=r,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(r){return this._count+=r,this._samples++,this._checkSampling(),this}subtractCount(r){return this._count-=r,this._samples++,this._checkSampling(),this}addTime(r){return this._time+=r,this.lastTiming=r,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=Dc(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(Dc()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}};var $u=class{constructor(r){w(this,"id",void 0),w(this,"stats",{}),this.id=r.id,this.stats={},this._initializeStats(r.stats),Object.seal(this)}get(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:r,type:e})}get size(){return Object.keys(this.stats).length}reset(){for(let r of Object.values(this.stats))r.reset();return this}forEach(r){for(let e of Object.values(this.stats))r(e)}getTable(){let r={};return this.forEach(e=>{r[e.name]={time:e.time||0,count:e.count||0,average:e.getAverageTime()||0,hz:e.getHz()||0}}),r}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(e=>this._getOrCreate(e))}_getOrCreate(r){let{name:e,type:n}=r,i=this.stats[e];return i||(r instanceof us?i=r:i=new us(e,n),this.stats[e]=i),i}};function vL(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function mL(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?vL(Object(e),!0).forEach(function(n){(0,gL.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):vL(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var Ope="Queued Requests",Epe="Active Requests",Cpe="Cancelled Requests",Mpe="Queued Requests Ever",Ipe="Active Requests Ever",Rpe={id:"request-scheduler",throttleRequests:!0,maxRequests:6},Nc=function(){function t(){(0,yL.default)(this,t);var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};w(this,"props",void 0),w(this,"stats",void 0),w(this,"activeRequestCount",0),w(this,"requestQueue",[]),w(this,"requestMap",new Map),w(this,"deferredUpdate",null),this.props=mL(mL({},Rpe),r),this.stats=new $u({id:this.props.id}),this.stats.get(Ope),this.stats.get(Epe),this.stats.get(Cpe),this.stats.get(Mpe),this.stats.get(Ipe)}return(0,_L.default)(t,[{key:"scheduleRequest",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(){return 0};if(!this.props.throttleRequests)return Promise.resolve({done:function(){}});if(this.requestMap.has(e))return this.requestMap.get(e);var i={handle:e,priority:0,getPriority:n},a=new Promise(function(o){return i.resolve=o,i});return this.requestQueue.push(i),this.requestMap.set(e,a),this._issueNewRequests(),a}},{key:"_issueRequest",value:function(e){var n=this,i=e.handle,a=e.resolve,o=!1,s=function(){o||(o=!0,n.requestMap.delete(i),n.activeRequestCount--,n._issueNewRequests())};return this.activeRequestCount++,a?a({done:s}):Promise.resolve({done:s})}},{key:"_issueNewRequests",value:function(){var e=this;this.deferredUpdate||(this.deferredUpdate=setTimeout(function(){return e._issueNewRequestsAsync()},0))}},{key:"_issueNewRequestsAsync",value:function(){this.deferredUpdate=null;var e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(e!==0){this._updateAllRequests();for(var n=0;n<e;++n){var i=this.requestQueue.shift();i&&this._issueRequest(i)}}}},{key:"_updateAllRequests",value:function(){for(var e=this.requestQueue,n=0;n<e.length;++n){var i=e[n];this._updateRequest(i)||(e.splice(n,1),this.requestMap.delete(i.handle),n--)}e.sort(function(a,o){return a.priority-o.priority})}},{key:"_updateRequest",value:function(e){return e.priority=e.getPriority(e.handle),e.priority<0?(e.resolve(null),!1):!0}}]),t}();var Lpe="",bL={};function $1(t){for(var r in bL)if(t.startsWith(r)){var e=bL[r];t=t.replace(r,e)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t="".concat(Lpe).concat(t)),t}var X1=h(ze());function xL(t){return t&&(0,X1.default)(t)==="object"&&t.isBuffer}function gv(t){if(xL(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){var r=t,e=new TextEncoder().encode(r);return e.buffer}if(t&&(0,X1.default)(t)==="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}var Kn={};un(Kn,{dirname:()=>Bpe,filename:()=>kpe,join:()=>Fpe,resolve:()=>Dpe});function AL(){var t;if(typeof process<"u"&&typeof process.cwd<"u")return process.cwd();var r=(t=window.location)===null||t===void 0?void 0:t.pathname;return r?.slice(0,r.lastIndexOf("/")+1)||""}function kpe(t){var r=t?t.lastIndexOf("/"):-1;return r>=0?t.substr(r+1):""}function Bpe(t){var r=t?t.lastIndexOf("/"):-1;return r>=0?t.substr(0,r):""}function Fpe(){for(var t=arguments.length,r=new Array(t),e=0;e<t;e++)r[e]=arguments[e];var n="/";return r=r.map(function(i,a){return a&&(i=i.replace(new RegExp("^".concat(n)),"")),a!==r.length-1&&(i=i.replace(new RegExp("".concat(n,"$")),"")),i}),r.join(n)}function Dpe(){for(var t=[],r=0;r<arguments.length;r++)t[r]=r<0||arguments.length<=r?void 0:arguments[r];for(var e="",n=!1,i,a=t.length-1;a>=-1&&!n;a--){var o=void 0;a>=0?o=t[a]:(i===void 0&&(i=AL()),o=i),o.length!==0&&(e="".concat(o,"/").concat(e),n=o.charCodeAt(0)===jc)}return e=Npe(e,!n),n?"/".concat(e):e.length>0?e:"."}var jc=47,q1=46;function Npe(t,r){for(var e="",n=-1,i=0,a,o=!1,s=0;s<=t.length;++s){if(s<t.length)a=t.charCodeAt(s);else{if(a===jc)break;a=jc}if(a===jc){if(!(n===s-1||i===1))if(n!==s-1&&i===2){if(e.length<2||!o||e.charCodeAt(e.length-1)!==q1||e.charCodeAt(e.length-2)!==q1){if(e.length>2){for(var u=e.length-1,l=u;l>=0&&e.charCodeAt(l)!==jc;--l);if(l!==u){e=l===-1?"":e.slice(0,l),n=s,i=0,o=!1;continue}}else if(e.length===2||e.length===1){e="",n=s,i=0,o=!1;continue}}r&&(e.length>0?e+="/..":e="..",o=!0)}else{var f=t.slice(n+1,s);e.length>0?e+="/".concat(f):e=f,o=!1}n=s,i=0}else a===q1&&i!==-1?++i:i=-1}return e}var zc=h(ye()),ca=h(ve());var Y1=h(ze()),jpe=function(r){return typeof r=="boolean"},Uc=function(r){return typeof r=="function"},ls=function(r){return r!==null&&(0,Y1.default)(r)==="object"},K1=function(r){return ls(r)&&r.constructor==={}.constructor};var SL=function(r){return r&&typeof r[Symbol.iterator]=="function"},TL=function(r){return r&&typeof r[Symbol.asyncIterator]=="function"};var yn=function(r){return typeof Response<"u"&&r instanceof Response||r&&r.arrayBuffer&&r.text&&r.json};var _n=function(r){return typeof Blob<"u"&&r instanceof Blob},wL=function(r){return r&&(0,Y1.default)(r)==="object"&&r.isBuffer};var Upe=function(r){return typeof ReadableStream<"u"&&r instanceof ReadableStream||ls(r)&&Uc(r.tee)&&Uc(r.cancel)&&Uc(r.getReader)};var Gpe=function(r){return ls(r)&&Uc(r.read)&&Uc(r.pipe)&&jpe(r.readable)},yv=function(r){return Upe(r)||Gpe(r)};var zpe=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,Vpe=/^([-\w.]+\/[-\w.+]+)/;function PL(t){var r=Vpe.exec(t);return r?r[1]:t}function Z1(t){var r=zpe.exec(t);return r?r[1]:""}var OL=/\?.*/;function EL(t){var r=t.match(OL);return r&&r[0]}function Xu(t){return t.replace(OL,"")}function fs(t){if(yn(t)){var r=t;return r.url}if(_n(t)){var e=t;return e.name||""}return typeof t=="string"?t:""}function Gc(t){if(yn(t)){var r=t,e=r.headers.get("content-type")||"",n=Xu(r.url);return PL(e)||Z1(n)}if(_n(t)){var i=t;return i.type||""}return typeof t=="string"?Z1(t):""}function CL(t){if(yn(t)){var r=t;return r.headers["content-length"]||-1}if(_n(t)){var e=t;return e.size}return typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}function _v(t){return J1.apply(this,arguments)}function J1(){return J1=(0,zc.default)(ca.default.mark(function t(r){var e,n,i,a,o,s;return ca.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!yn(r)){l.next=2;break}return l.abrupt("return",r);case 2:return e={},n=CL(r),n>=0&&(e["content-length"]=String(n)),i=fs(r),a=Gc(r),a&&(e["content-type"]=a),l.next=10,Wpe(r);case 10:return o=l.sent,o&&(e["x-first-bytes"]=o),typeof r=="string"&&(r=new TextEncoder().encode(r)),s=new Response(r,{headers:e}),Object.defineProperty(s,"url",{value:i}),l.abrupt("return",s);case 16:case"end":return l.stop()}},t)})),J1.apply(this,arguments)}function ML(t){return Q1.apply(this,arguments)}function Q1(){return Q1=(0,zc.default)(ca.default.mark(function t(r){var e;return ca.default.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(r.ok){i.next=5;break}return i.next=3,Hpe(r);case 3:throw e=i.sent,new Error(e);case 5:case"end":return i.stop()}},t)})),Q1.apply(this,arguments)}function Hpe(t){return ex.apply(this,arguments)}function ex(){return ex=(0,zc.default)(ca.default.mark(function t(r){var e,n,i;return ca.default.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(e="Failed to fetch resource ".concat(r.url," (").concat(r.status,"): "),o.prev=1,n=r.headers.get("Content-Type"),i=r.statusText,!n.includes("application/json")){o.next=11;break}return o.t0=i,o.t1=" ",o.next=9,r.text();case 9:o.t2=o.sent,i=o.t0+=o.t1.concat.call(o.t1,o.t2);case 11:e+=i,e=e.length>60?"".concat(e.slice(0,60),"..."):e,o.next=17;break;case 15:o.prev=15,o.t3=o.catch(1);case 17:return o.abrupt("return",e);case 18:case"end":return o.stop()}},t,null,[[1,15]])})),ex.apply(this,arguments)}function Wpe(t){return tx.apply(this,arguments)}function tx(){return tx=(0,zc.default)(ca.default.mark(function t(r){var e,n,i,a;return ca.default.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(e=5,typeof r!="string"){s.next=3;break}return s.abrupt("return","data:,".concat(r.slice(0,e)));case 3:if(!(r instanceof Blob)){s.next=8;break}return n=r.slice(0,5),s.next=7,new Promise(function(u){var l=new FileReader;l.onload=function(f){var c;return u(f==null||(c=f.target)===null||c===void 0?void 0:c.result)},l.readAsDataURL(n)});case 7:return s.abrupt("return",s.sent);case 8:if(!(r instanceof ArrayBuffer)){s.next=12;break}return i=r.slice(0,e),a=$pe(i),s.abrupt("return","data:base64,".concat(a));case 12:return s.abrupt("return",null);case 13:case"end":return s.stop()}},t)})),tx.apply(this,arguments)}function $pe(t){for(var r="",e=new Uint8Array(t),n=0;n<e.byteLength;n++)r+=String.fromCharCode(e[n]);return btoa(r)}function qu(t,r){return nx.apply(this,arguments)}function nx(){return nx=(0,IL.default)(rx.default.mark(function t(r,e){var n;return rx.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(typeof r!="string"){a.next=7;break}return r=$1(r),n=e,e!=null&&e.fetch&&typeof e?.fetch!="function"&&(n=e.fetch),a.next=6,fetch(r,n);case 6:return a.abrupt("return",a.sent);case 7:return a.next=9,_v(r);case 9:return a.abrupt("return",a.sent);case 10:case"end":return a.stop()}},t)})),nx.apply(this,arguments)}var qL=h(B());var ax=h(L()),ox=h(N());function ix(t){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&Boolean(process.versions.electron))return!0;let r=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,e=t||r;return!!(e&&e.indexOf("Electron")>=0)}function Zn(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||ix()}var Xpe=globalThis.self||globalThis.window||globalThis.global,Yu=globalThis.window||globalThis.self||globalThis.global,qpe=globalThis.document||{},cs=globalThis.process||{},Ype=globalThis.console,h4e=globalThis.navigator||{};var bv=typeof __VERSION__<"u"?__VERSION__:"untranspiled source",m4e=Zn();function Kpe(t){try{let r=window[t],e="__storage_test__";return r.setItem(e,e),r.removeItem(e),r}catch{return null}}var xv=class{constructor(r,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";w(this,"storage",void 0),w(this,"id",void 0),w(this,"config",void 0),this.storage=Kpe(n),this.id=r,this.config=e,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(r){if(Object.assign(this.config,r),this.storage){let e=JSON.stringify(this.config);this.storage.setItem(this.id,e)}}_loadConfiguration(){let r={};if(this.storage){let e=this.storage.getItem(this.id);r=e?JSON.parse(e):{}}return Object.assign(this.config,r),this}};function RL(t){let r;return t<10?r="".concat(t.toFixed(2),"ms"):t<100?r="".concat(t.toFixed(1),"ms"):t<1e3?r="".concat(t.toFixed(0),"ms"):r="".concat((t/1e3).toFixed(2),"s"),r}function LL(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8,e=Math.max(r-t.length,0);return"".concat(" ".repeat(e)).concat(t)}function Av(t,r,e){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600,i=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>n&&(e=Math.min(e,n/t.width));let a=t.width*e,o=t.height*e,s=["font-size:1px;","padding:".concat(Math.floor(o/2),"px ").concat(Math.floor(a/2),"px;"),"line-height:".concat(o,"px;"),"background:url(".concat(i,");"),"background-size:".concat(a,"px ").concat(o,"px;"),"color:transparent;"].join("");return["".concat(r," %c+"),s]}var Sv;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Sv||(Sv={}));var Zpe=10;function kL(t){return typeof t!="string"?t:(t=t.toUpperCase(),Sv[t]||Sv.WHITE)}function BL(t,r,e){if(!Zn&&typeof t=="string"){if(r){let n=kL(r);t="\x1B[".concat(n,"m").concat(t,"\x1B[39m")}if(e){let n=kL(e);t="\x1B[".concat(n+Zpe,"m").concat(t,"\x1B[49m")}}return t}function FL(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"],e=Object.getPrototypeOf(t),n=Object.getOwnPropertyNames(e),i=t;for(let a of n){let o=i[a];typeof o=="function"&&(r.find(s=>a===s)||(i[a]=o.bind(t)))}}function Ku(t,r){if(!t)throw new Error(r||"Assertion failed")}function ps(){let t;if(Zn()&&Yu.performance){var r,e;t=Yu===null||Yu===void 0||(r=Yu.performance)===null||r===void 0||(e=r.now)===null||e===void 0?void 0:e.call(r)}else if("hrtime"in cs){var n;let i=cs===null||cs===void 0||(n=cs.hrtime)===null||n===void 0?void 0:n.call(cs);t=i[0]*1e3+i[1]/1e6}else t=Date.now();return t}var Zu={debug:Zn()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},Jpe={enabled:!0,level:0};function bn(){}var DL={},NL={once:!0},Ci=class{constructor(){let{id:r}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};w(this,"id",void 0),w(this,"VERSION",bv),w(this,"_startTs",ps()),w(this,"_deltaTs",ps()),w(this,"_storage",void 0),w(this,"userData",{}),w(this,"LOG_THROTTLE_TIMEOUT",0),this.id=r,this.userData={},this._storage=new xv("__probe-".concat(this.id,"__"),Jpe),this.timeStamp("".concat(this.id," started")),FL(this),Object.seal(this)}set level(r){this.setLevel(r)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((ps()-this._startTs).toPrecision(10))}getDelta(){return Number((ps()-this._deltaTs).toPrecision(10))}set priority(r){this.level=r}get priority(){return this.level}getPriority(){return this.level}enable(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:r}),this}setLevel(r){return this._storage.setConfiguration({level:r}),this}get(r){return this._storage.config[r]}set(r,e){this._storage.setConfiguration({[r]:e})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(r,e){Ku(r,e)}warn(r){return this._getLogFunction(0,r,Zu.warn,arguments,NL)}error(r){return this._getLogFunction(0,r,Zu.error,arguments)}deprecated(r,e){return this.warn("`".concat(r,"` is deprecated and will be removed in a later version. Use `").concat(e,"` instead"))}removed(r,e){return this.error("`".concat(r,"` has been removed. Use `").concat(e,"` instead"))}probe(r,e){return this._getLogFunction(r,e,Zu.log,arguments,{time:!0,once:!0})}log(r,e){return this._getLogFunction(r,e,Zu.debug,arguments)}info(r,e){return this._getLogFunction(r,e,console.info,arguments)}once(r,e){return this._getLogFunction(r,e,Zu.debug||Zu.info,arguments,NL)}table(r,e,n){return e?this._getLogFunction(r,e,console.table||bn,n&&[n],{tag:rhe(e)}):bn}image(r){let{logLevel:e,priority:n,image:i,message:a="",scale:o=1}=r;return this._shouldLog(e||n)?Zn()?the({image:i,message:a,scale:o}):ehe({image:i,message:a,scale:o}):bn}time(r,e){return this._getLogFunction(r,e,console.time?console.time:console.info)}timeEnd(r,e){return this._getLogFunction(r,e,console.timeEnd?console.timeEnd:console.info)}timeStamp(r,e){return this._getLogFunction(r,e,console.timeStamp||bn)}group(r,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1},i=jL({logLevel:r,message:e,opts:n}),{collapsed:a}=n;return i.method=(a?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(r,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(r,e,Object.assign({},n,{collapsed:!0}))}groupEnd(r){return this._getLogFunction(r,"",console.groupEnd||bn)}withGroup(r,e,n){this.group(r,e)();try{n()}finally{this.groupEnd(r)()}}trace(){console.trace&&console.trace()}_shouldLog(r){return this.isEnabled()&&this.getLevel()>=UL(r)}_getLogFunction(r,e,n,i,a){if(this._shouldLog(r)){a=jL({logLevel:r,message:e,args:i,opts:a}),n=n||a.method,Ku(n),a.total=this.getTotal(),a.delta=this.getDelta(),this._deltaTs=ps();let o=a.tag||a.message;if(a.once&&o)if(!DL[o])DL[o]=ps();else return bn;return e=Qpe(this.id,a.message,a),n.bind(console,e,...a.args)}return bn}};w(Ci,"VERSION",bv);function UL(t){if(!t)return 0;let r;switch(typeof t){case"number":r=t;break;case"object":r=t.logLevel||t.priority||0;break;default:return 0}return Ku(Number.isFinite(r)&&r>=0),r}function jL(t){let{logLevel:r,message:e}=t;t.logLevel=UL(r);let n=t.args?Array.from(t.args):[];for(;n.length&&n.shift()!==e;);switch(typeof r){case"string":case"function":e!==void 0&&n.unshift(e),t.message=r;break;case"object":Object.assign(t,r);break;default:}typeof t.message=="function"&&(t.message=t.message());let i=typeof t.message;return Ku(i==="string"||i==="object"),Object.assign(t,{args:n},t.opts)}function Qpe(t,r,e){if(typeof r=="string"){let n=e.time?LL(RL(e.total)):"";r=e.time?"".concat(t,": ").concat(n,"  ").concat(r):"".concat(t,": ").concat(r),r=BL(r,e.color,e.background)}return r}function ehe(t){let{image:r,message:e="",scale:n=1}=t;return console.warn("removed"),bn}function the(t){let{image:r,message:e="",scale:n=1}=t;if(typeof r=="string"){let a=new Image;return a.onload=()=>{let o=Av(a,e,n);console.log(...o)},a.src=r,bn}let i=r.nodeName||"";if(i.toLowerCase()==="img")return console.log(...Av(r,e,n)),bn;if(i.toLowerCase()==="canvas"){let a=new Image;return a.onload=()=>console.log(...Av(a,e,n)),a.src=r.toDataURL(),bn}return bn}function rhe(t){for(let r in t)for(let e in t[r])return e||"untitled";return"empty"}var V4e=new Ci({id:"@probe.gl/log"});var sx=new Ci({id:"loaders.gl"}),GL=function(){function t(){(0,ax.default)(this,t)}return(0,ox.default)(t,[{key:"log",value:function(){return function(){}}},{key:"info",value:function(){return function(){}}},{key:"warn",value:function(){return function(){}}},{key:"error",value:function(){return function(){}}}]),t}(),zL=function(){function t(){(0,ax.default)(this,t),w(this,"console",void 0),this.console=console}return(0,ox.default)(t,[{key:"log",value:function(){for(var e,n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=this.console.log).bind.apply(e,[this.console].concat(i))}},{key:"info",value:function(){for(var e,n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=this.console.info).bind.apply(e,[this.console].concat(i))}},{key:"warn",value:function(){for(var e,n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=this.console.warn).bind.apply(e,[this.console].concat(i))}},{key:"error",value:function(){for(var e,n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=this.console.error).bind.apply(e,[this.console].concat(i))}}]),t}();var ux={fetch:null,mimeType:void 0,nothrow:!1,log:new zL,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:fa,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},VL={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function YL(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=nhe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function nhe(t,r){if(t){if(typeof t=="string")return HL(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return HL(t,r)}}function HL(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function WL(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Tv(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?WL(Object(e),!0).forEach(function(n){(0,qL.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):WL(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function lx(){globalThis.loaders=globalThis.loaders||{};var t=globalThis.loaders;return t._state=t._state||{},t._state}var fx=function(){var r=lx();return r.globalOptions=r.globalOptions||Tv({},ux),r.globalOptions};function KL(t,r,e,n){return e=e||[],e=Array.isArray(e)?e:[e],ihe(t,e),ohe(r,t,n)}function ihe(t,r){$L(t,null,ux,VL,r);var e=YL(r),n;try{for(e.s();!(n=e.n()).done;){var i=n.value,a=t&&t[i.id]||{},o=i.options&&i.options[i.id]||{},s=i.deprecatedOptions&&i.deprecatedOptions[i.id]||{};$L(a,i.id,o,s,r)}}catch(u){e.e(u)}finally{e.f()}}function $L(t,r,e,n,i){var a=r||"Top level",o=r?"".concat(r,"."):"";for(var s in t){var u=!r&&ls(t[s]),l=s==="baseUri"&&!r,f=s==="workerUrl"&&r;if(!(s in e)&&!l&&!f){if(s in n)sx.warn("".concat(a," loader option '").concat(o).concat(s,"' no longer supported, use '").concat(n[s],"'"))();else if(!u){var c=ahe(s,i);sx.warn("".concat(a," loader option '").concat(o).concat(s,"' not recognized. ").concat(c))()}}}}function ahe(t,r){var e=t.toLowerCase(),n="",i=YL(r),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;for(var s in o.options){if(t===s)return"Did you mean '".concat(o.id,".").concat(s,"'?");var u=s.toLowerCase(),l=e.startsWith(u)||u.startsWith(e);l&&(n=n||"Did you mean '".concat(o.id,".").concat(s,"'?"))}}}catch(f){i.e(f)}finally{i.f()}return n}function ohe(t,r,e){var n=t.options||{},i=Tv({},n);return she(i,e),i.log===null&&(i.log=new GL),XL(i,fx()),XL(i,r),i}function XL(t,r){for(var e in r)if(e in r){var n=r[e];K1(n)&&K1(t[e])?t[e]=Tv(Tv({},t[e]),r[e]):t[e]=r[e]}}function she(t,r){r&&!("baseUri"in t)&&(t.baseUri=r)}var JL=h(B());function ZL(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function wv(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?ZL(Object(e),!0).forEach(function(n){(0,JL.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):ZL(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function Vc(t){var r;if(!t)return!1;Array.isArray(t)&&(t=t[0]);var e=Array.isArray((r=t)===null||r===void 0?void 0:r.extensions);return e}function Hc(t){var r,e;Ne(t,"null loader"),Ne(Vc(t),"invalid loader");var n;return Array.isArray(t)&&(n=t[1],t=t[0],t=wv(wv({},t),{},{options:wv(wv({},t.options),n)})),((r=t)!==null&&r!==void 0&&r.parseTextSync||(e=t)!==null&&e!==void 0&&e.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}function uhe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=lhe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function lhe(t,r){if(t){if(typeof t=="string")return QL(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return QL(t,r)}}function QL(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var ek=function(){var r=lx();return r.loaderRegistry=r.loaderRegistry||[],r.loaderRegistry};function Wc(t){var r=ek();t=Array.isArray(t)?t:[t];var e=uhe(t),n;try{var i=function(){var o=n.value,s=Hc(o);r.find(function(u){return s===u})||r.unshift(s)};for(e.s();!(n=e.n()).done;)i()}catch(a){e.e(a)}finally{e.f()}}function tk(){return ek()}var vk=h(B()),mk=h(ze()),gk=h(Zt()),yk=h(ye()),px=h(ve());var lk=new Ci({id:"loaders.gl"});function fk(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function ck(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?fk(Object(e),!0).forEach(function(n){(0,vk.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):fk(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function $c(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=ghe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function ghe(t,r){if(t){if(typeof t=="string")return pk(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return pk(t,r)}}function pk(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var yhe=/\.([^.]+)$/;function _k(t){return hx.apply(this,arguments)}function hx(){return hx=(0,yk.default)(px.default.mark(function t(r){var e,n,i,a,o=arguments;return px.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(e=o.length>1&&o[1]!==void 0?o[1]:[],n=o.length>2?o[2]:void 0,i=o.length>3?o[3]:void 0,bk(r)){u.next=5;break}return u.abrupt("return",null);case 5:if(a=hk(r,e,ck(ck({},n),{},{nothrow:!0}),i),!a){u.next=8;break}return u.abrupt("return",a);case 8:if(!_n(r)){u.next=13;break}return u.next=11,r.slice(0,10).arrayBuffer();case 11:r=u.sent,a=hk(r,e,n,i);case 13:if(!(!a&&!(n!=null&&n.nothrow))){u.next=15;break}throw new Error(xk(r));case 15:return u.abrupt("return",a);case 16:case"end":return u.stop()}},t)})),hx.apply(this,arguments)}function hk(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],e=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;if(!bk(t))return null;if(r&&!Array.isArray(r))return Hc(r);var i=[];if(r&&(i=i.concat(r)),!(e!=null&&e.ignoreRegisteredLoaders)){var a;(a=i).push.apply(a,(0,gk.default)(tk()))}bhe(i);var o=_he(t,i,e,n);if(!o&&!(e!=null&&e.nothrow))throw new Error(xk(t));return o}function _he(t,r,e,n){var i=fs(t),a=Gc(t),o=Xu(i)||n?.url,s=null,u="";if(e!=null&&e.mimeType&&(s=cx(r,e?.mimeType),u="match forced by supplied MIME type ".concat(e?.mimeType)),s=s||xhe(r,o),u=u||(s?"matched url ".concat(o):""),s=s||cx(r,a),u=u||(s?"matched MIME type ".concat(a):""),s=s||She(r,t),u=u||(s?"matched initial data ".concat(Ak(t)):""),s=s||cx(r,e?.fallbackMimeType),u=u||(s?"matched fallback MIME type ".concat(a):""),u){var l;lk.log(1,"selectLoader selected ".concat((l=s)===null||l===void 0?void 0:l.name,": ").concat(u,"."))}return s}function bk(t){return!(t instanceof Response&&t.status===204)}function xk(t){var r=fs(t),e=Gc(t),n="No valid loader found (";n+=r?"".concat(Kn.filename(r),", "):"no url provided, ",n+="MIME type: ".concat(e?'"'.concat(e,'"'):"not provided",", ");var i=t?Ak(t):"";return n+=i?' first bytes: "'.concat(i,'"'):"first bytes: not available",n+=")",n}function bhe(t){var r=$c(t),e;try{for(r.s();!(e=r.n()).done;){var n=e.value;Hc(n)}}catch(i){r.e(i)}finally{r.f()}}function xhe(t,r){var e=r&&yhe.exec(r),n=e&&e[1];return n?Ahe(t,n):null}function Ahe(t,r){r=r.toLowerCase();var e=$c(t),n;try{for(e.s();!(n=e.n()).done;){var i=n.value,a=$c(i.extensions),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;if(s.toLowerCase()===r)return i}}catch(u){a.e(u)}finally{a.f()}}}catch(u){e.e(u)}finally{e.f()}return null}function cx(t,r){var e=$c(t),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;if(i.mimeTypes&&i.mimeTypes.includes(r)||r==="application/x.".concat(i.id))return i}}catch(a){e.e(a)}finally{e.f()}return null}function She(t,r){if(!r)return null;var e=$c(t),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;if(typeof r=="string"){if(The(r,i))return i}else if(ArrayBuffer.isView(r)){if(dk(r.buffer,r.byteOffset,i))return i}else if(r instanceof ArrayBuffer){var a=0;if(dk(r,a,i))return i}}}catch(o){e.e(o)}finally{e.f()}return null}function The(t,r){if(r.testText)return r.testText(t);var e=Array.isArray(r.tests)?r.tests:[r.tests];return e.some(function(n){return t.startsWith(n)})}function dk(t,r,e){var n=Array.isArray(e.tests)?e.tests:[e.tests];return n.some(function(i){return whe(t,r,e,i)})}function whe(t,r,e,n){if(n instanceof ArrayBuffer)return D1(n,t,n.byteLength);switch((0,mk.default)(n)){case"function":return n(t,e);case"string":var i=dx(t,r,n.length);return n===i;default:return!1}}function Ak(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;if(typeof t=="string")return t.slice(0,r);if(ArrayBuffer.isView(t))return dx(t.buffer,t.byteOffset,r);if(t instanceof ArrayBuffer){var e=0;return dx(t,e,r)}return""}function dx(t,r,e){if(t.byteLength<r+e)return"";for(var n=new DataView(t),i="",a=0;a<e;a++)i+=String.fromCharCode(n.getUint8(r+a));return i}var Fk=h(ze()),Cx=h(ye()),qc=h(ve());var Ck=h(ye()),Tx=h(ve());var vx=h(ve()),Phe=vx.default.mark(mx),Ohe=256*1024;function mx(t,r){var e,n,i,a,o;return vx.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:e=r?.chunkSize||Ohe,n=0,i=new TextEncoder;case 3:if(!(n<t.length)){u.next=11;break}return a=Math.min(t.length-n,e),o=t.slice(n,n+a),n+=a,u.next=9,i.encode(o);case 9:u.next=3;break;case 11:case"end":return u.stop()}},Phe)}var gx=h(ve()),Ehe=256*1024;function Sk(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return gx.default.mark(function e(){var n,i,a,o,s,u,l;return gx.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:n=r.chunkSize,i=n===void 0?Ehe:n,a=0;case 2:if(!(a<t.byteLength)){c.next=13;break}return o=Math.min(t.byteLength-a,i),s=new ArrayBuffer(o),u=new Uint8Array(t,a,o),l=new Uint8Array(s),l.set(u),a+=o,c.next=11,s;case 11:c.next=2;break;case 13:case"end":return c.stop()}},e)})()}var Tk=h(G1()),wk=h(z1()),yx=h(ve()),Che=1024*1024;function Pk(t,r){return _x.apply(this,arguments)}function _x(){return _x=(0,wk.default)(yx.default.mark(function t(r,e){var n,i,a,o;return yx.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:n=e?.chunkSize||Che,i=0;case 2:if(!(i<r.size)){u.next=12;break}return a=i+n,u.next=6,(0,Tk.default)(r.slice(i,a).arrayBuffer());case 6:return o=u.sent,i=a,u.next=10,o;case 10:u.next=2;break;case 12:case"end":return u.stop()}},t)})),_x.apply(this,arguments)}var Ok=h(mv()),Pv=h(G1()),Ax=h(z1()),Xc=h(ve());function Sx(t,r){return fa?Mhe(t,r):Ihe(t,r)}function Mhe(t,r){return bx.apply(this,arguments)}function bx(){return bx=(0,Ax.default)(Xc.default.mark(function t(r,e){var n,i,a,o,s,u;return Xc.default.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:n=r.getReader(),f.prev=1;case 2:return a=i||n.read(),e!=null&&e._streamReadAhead&&(i=n.read()),f.next=7,(0,Pv.default)(a);case 7:if(o=f.sent,s=o.done,u=o.value,!s){f.next=12;break}return f.abrupt("return");case 12:return f.next=14,gv(u);case 14:f.next=2;break;case 16:f.next=21;break;case 18:f.prev=18,f.t0=f.catch(1),n.releaseLock();case 21:case"end":return f.stop()}},t,null,[[1,18]])})),bx.apply(this,arguments)}function Ihe(t,r){return xx.apply(this,arguments)}function xx(){return xx=(0,Ax.default)(Xc.default.mark(function t(r,e){var n,i,a,o,s,u;return Xc.default.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:n=!1,i=!1,f.prev=2,o=(0,Ok.default)(r);case 4:return f.next=6,(0,Pv.default)(o.next());case 6:if(!(n=!(s=f.sent).done)){f.next=13;break}return u=s.value,f.next=10,gv(u);case 10:n=!1,f.next=4;break;case 13:f.next=19;break;case 15:f.prev=15,f.t0=f.catch(2),i=!0,a=f.t0;case 19:if(f.prev=19,f.prev=20,!(n&&o.return!=null)){f.next=24;break}return f.next=24,(0,Pv.default)(o.return());case 24:if(f.prev=24,!i){f.next=27;break}throw a;case 27:return f.finish(24);case 28:return f.finish(19);case 29:case"end":return f.stop()}},t,null,[[2,15,19,29],[20,,24,28]])})),xx.apply(this,arguments)}function Ek(t,r){if(typeof t=="string")return mx(t,r);if(t instanceof ArrayBuffer)return Sk(t,r);if(_n(t))return Pk(t,r);if(yv(t))return Sx(t,r);if(yn(t)){var e=t;return Sx(e.body,r)}throw new Error("makeIterator")}var Mk="Cannot convert supplied data type";function Rhe(t,r,e){if(r.text&&typeof t=="string")return t;if(wL(t)&&(t=t.buffer),t instanceof ArrayBuffer){var n=t;if(r.text&&!r.binary){var i=new TextDecoder("utf8");return i.decode(n)}return n}if(ArrayBuffer.isView(t)){if(r.text&&!r.binary){var a=new TextDecoder("utf8");return a.decode(t)}var o=t.buffer,s=t.byteLength||t.length;return(t.byteOffset!==0||s!==o.byteLength)&&(o=o.slice(t.byteOffset,t.byteOffset+s)),o}throw new Error(Mk)}function Ik(t,r,e){return wx.apply(this,arguments)}function wx(){return wx=(0,Ck.default)(Tx.default.mark(function t(r,e,n){var i,a;return Tx.default.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(i=r instanceof ArrayBuffer||ArrayBuffer.isView(r),!(typeof r=="string"||i)){s.next=3;break}return s.abrupt("return",Rhe(r,e,n));case 3:if(!_n(r)){s.next=7;break}return s.next=6,_v(r);case 6:r=s.sent;case 7:if(!yn(r)){s.next=21;break}return a=r,s.next=11,ML(a);case 11:if(!e.binary){s.next=17;break}return s.next=14,a.arrayBuffer();case 14:s.t0=s.sent,s.next=20;break;case 17:return s.next=19,a.text();case 19:s.t0=s.sent;case 20:return s.abrupt("return",s.t0);case 21:if(yv(r)&&(r=Ek(r,n)),!(SL(r)||TL(r))){s.next=24;break}return s.abrupt("return",W1(r));case 24:throw new Error(Mk);case 25:case"end":return s.stop()}},t)})),wx.apply(this,arguments)}var Px=h(Zt()),Lk=h(B());function Ov(t,r){var e=fx(),n=t||e;return typeof n.fetch=="function"?n.fetch:ls(n.fetch)?function(i){return qu(i,n)}:r!=null&&r.fetch?r?.fetch:qu}function Rk(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Lhe(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Rk(Object(e),!0).forEach(function(n){(0,Lk.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Rk(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function kk(t,r,e){if(e)return e;var n=Lhe({fetch:Ov(r,t)},t);if(n.url){var i=Xu(n.url);n.baseUrl=i,n.queryString=EL(n.url),n.filename=Kn.filename(i),n.baseUrl=Kn.dirname(i)}return Array.isArray(n.loaders)||(n.loaders=null),n}function Bk(t,r){if(!r&&t&&!Array.isArray(t))return t;var e;if(t&&(e=Array.isArray(t)?t:[t]),r&&r.loaders){var n=Array.isArray(r.loaders)?r.loaders:[r.loaders];e=e?[].concat((0,Px.default)(e),(0,Px.default)(n)):n}return e&&e.length?e:null}function hs(t,r,e,n){return Ox.apply(this,arguments)}function Ox(){return Ox=(0,Cx.default)(qc.default.mark(function t(r,e,n,i){var a,o,s,u;return qc.default.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return pr(!i||(0,Fk.default)(i)==="object"),e&&!Array.isArray(e)&&!Vc(e)&&(i=void 0,n=e,e=void 0),f.next=4,r;case 4:return r=f.sent,n=n||{},a=fs(r),o=e,s=Bk(o,i),f.next=11,_k(r,s,n);case 11:if(u=f.sent,u){f.next=14;break}return f.abrupt("return",null);case 14:return n=KL(n,u,s,a),i=kk({url:a,parse:hs,loaders:s},n,i||null),f.next=18,khe(u,r,n,i);case 18:return f.abrupt("return",f.sent);case 19:case"end":return f.stop()}},t)})),Ox.apply(this,arguments)}function khe(t,r,e,n){return Ex.apply(this,arguments)}function Ex(){return Ex=(0,Cx.default)(qc.default.mark(function t(r,e,n,i){var a,o,s,u,l,f,c,p;return qc.default.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return P1(r),yn(e)&&(a=e,o=a.ok,s=a.redirected,u=a.status,l=a.statusText,f=a.type,c=a.url,p=Object.fromEntries(a.headers.entries()),i.response={headers:p,ok:o,redirected:s,status:u,statusText:l,type:f,url:c}),v.next=4,Ik(e,r,n);case 4:if(e=v.sent,!(r.parseTextSync&&typeof e=="string")){v.next=8;break}return n.dataType="text",v.abrupt("return",r.parseTextSync(e,n,i,r));case 8:if(!k1(r,n)){v.next=12;break}return v.next=11,B1(r,e,n,i,hs);case 11:return v.abrupt("return",v.sent);case 12:if(!(r.parseText&&typeof e=="string")){v.next=16;break}return v.next=15,r.parseText(e,n,i,r);case 15:return v.abrupt("return",v.sent);case 16:if(!r.parse){v.next=20;break}return v.next=19,r.parse(e,n,i,r);case 19:return v.abrupt("return",v.sent);case 20:throw pr(!r.parseSync),new Error("".concat(r.id," loader - no parser found and worker is disabled"));case 22:case"end":return v.stop()}},t)})),Ex.apply(this,arguments)}var Dk=h(ye()),Mx=h(ve());function Jt(t,r,e,n){return Ix.apply(this,arguments)}function Ix(){return Ix=(0,Dk.default)(Mx.default.mark(function t(r,e,n,i){var a,o;return Mx.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(!Array.isArray(e)&&!Vc(e)&&(i=void 0,n=e,e=void 0),a=Ov(n),o=r,typeof r!="string"){u.next=7;break}return u.next=6,a(r);case 6:o=u.sent;case 7:if(!_n(r)){u.next=11;break}return u.next=10,a(r);case 10:o=u.sent;case 11:return u.next=13,hs(o,e,n);case 13:return u.abrupt("return",u.sent);case 14:case"end":return u.stop()}},t)})),Ix.apply(this,arguments)}var Nk="3.4.2";var Xk=h(ye()),Xx=h(ve());var Bhe=globalThis._parseImageNode,Rx=typeof Image<"u",Lx=typeof ImageBitmap<"u",Fhe=Boolean(Bhe),kx=fa?!0:Fhe;function jk(t){switch(t){case"auto":return Lx||Rx||kx;case"imagebitmap":return Lx;case"image":return Rx;case"data":return kx;default:throw new Error("@loaders.gl/images: image ".concat(t," not supported in this environment"))}}function Uk(){if(Lx)return"imagebitmap";if(Rx)return"image";if(kx)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}var Gk=h(ze());function Dhe(t){var r=Nhe(t);if(!r)throw new Error("Not an image");return r}function zk(t){switch(Dhe(t)){case"data":return t;case"image":case"imagebitmap":var r=document.createElement("canvas"),e=r.getContext("2d");if(!e)throw new Error("getImageData");return r.width=t.width,r.height=t.height,e.drawImage(t,0,0),e.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function Nhe(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&(0,Gk.default)(t)==="object"&&t.data&&t.width&&t.height?"data":null}var Nx=h(ye()),Yc=h(ve());var jhe=/^data:image\/svg\+xml/,Uhe=/\.svg((\?|#).*)?$/;function Ev(t){return t&&(jhe.test(t)||Uhe.test(t))}function Vk(t,r){if(Ev(r)){var e=new TextDecoder,n=e.decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(n=unescape(encodeURIComponent(n)))}catch(a){throw new Error(a.message)}var i="data:image/svg+xml;base64,".concat(btoa(n));return i}return Bx(t,r)}function Bx(t,r){if(Ev(r))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}function Kc(t,r,e){return Fx.apply(this,arguments)}function Fx(){return Fx=(0,Nx.default)(Yc.default.mark(function t(r,e,n){var i,a,o;return Yc.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return i=Vk(r,n),a=self.URL||self.webkitURL,o=typeof i!="string"&&a.createObjectURL(i),u.prev=3,u.next=6,Ghe(o||i,e);case 6:return u.abrupt("return",u.sent);case 7:return u.prev=7,o&&a.revokeObjectURL(o),u.finish(7);case 10:case"end":return u.stop()}},t,null,[[3,,7,10]])})),Fx.apply(this,arguments)}function Ghe(t,r){return Dx.apply(this,arguments)}function Dx(){return Dx=(0,Nx.default)(Yc.default.mark(function t(r,e){var n;return Yc.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(n=new Image,n.src=r,!(e.image&&e.image.decode&&n.decode)){a.next=6;break}return a.next=5,n.decode();case 5:return a.abrupt("return",n);case 6:return a.next=8,new Promise(function(o,s){try{n.onload=function(){return o(n)},n.onerror=function(u){return s(new Error("Could not load image ".concat(r,": ").concat(u)))}}catch(u){s(u)}});case 8:return a.abrupt("return",a.sent);case 9:case"end":return a.stop()}},t)})),Dx.apply(this,arguments)}var Gx=h(ye()),Zc=h(ve());var zhe={},Hk=!0;function zx(t,r,e){return jx.apply(this,arguments)}function jx(){return jx=(0,Gx.default)(Zc.default.mark(function t(r,e,n){var i,a,o;return Zc.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(!Ev(n)){u.next=7;break}return u.next=3,Kc(r,e,n);case 3:a=u.sent,i=a,u.next=8;break;case 7:i=Bx(r,n);case 8:return o=e&&e.imagebitmap,u.next=11,Vhe(i,o);case 11:return u.abrupt("return",u.sent);case 12:case"end":return u.stop()}},t)})),jx.apply(this,arguments)}function Vhe(t){return Ux.apply(this,arguments)}function Ux(){return Ux=(0,Gx.default)(Zc.default.mark(function t(r){var e,n=arguments;return Zc.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(e=n.length>1&&n[1]!==void 0?n[1]:null,(Hhe(e)||!Hk)&&(e=null),!e){a.next=13;break}return a.prev=3,a.next=6,createImageBitmap(r,e);case 6:return a.abrupt("return",a.sent);case 9:a.prev=9,a.t0=a.catch(3),console.warn(a.t0),Hk=!1;case 13:return a.next=15,createImageBitmap(r);case 15:return a.abrupt("return",a.sent);case 16:case"end":return a.stop()}},t,null,[[3,9]])})),Ux.apply(this,arguments)}function Hhe(t){for(var r in t||zhe)return!1;return!0}var $k=h(ye()),Hx=h(ve());var Vx=h(Zt());function Wk(t){return!qhe(t,"ftyp",4)||!(t[8]&96)?null:Whe(t)}function Whe(t){var r=$he(t,8,12).replace("\0"," ").trim();switch(r){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function $he(t,r,e){return String.fromCharCode.apply(String,(0,Vx.default)(t.slice(r,e)))}function Xhe(t){return(0,Vx.default)(t).map(function(r){return r.charCodeAt(0)})}function qhe(t,r){for(var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=Xhe(r),i=0;i<n.length;++i)if(n[i]!==t[i+e])return!1;return!0}var Mi=!1,Jc=!0;function ds(t){var r=Qc(t);return Khe(r)||Qhe(r)||Zhe(r)||Jhe(r)||Yhe(r)}function Yhe(t){var r=new Uint8Array(t instanceof DataView?t.buffer:t),e=Wk(r);return e?{mimeType:e.mimeType,width:0,height:0}:null}function Khe(t){var r=Qc(t),e=r.byteLength>=24&&r.getUint32(0,Mi)===2303741511;return e?{mimeType:"image/png",width:r.getUint32(16,Mi),height:r.getUint32(20,Mi)}:null}function Zhe(t){var r=Qc(t),e=r.byteLength>=10&&r.getUint32(0,Mi)===1195984440;return e?{mimeType:"image/gif",width:r.getUint16(6,Jc),height:r.getUint16(8,Jc)}:null}function Jhe(t){var r=Qc(t),e=r.byteLength>=14&&r.getUint16(0,Mi)===16973&&r.getUint32(2,Jc)===r.byteLength;return e?{mimeType:"image/bmp",width:r.getUint32(18,Jc),height:r.getUint32(22,Jc)}:null}function Qhe(t){var r=Qc(t),e=r.byteLength>=3&&r.getUint16(0,Mi)===65496&&r.getUint8(2)===255;if(!e)return null;for(var n=ede(),i=n.tableMarkers,a=n.sofMarkers,o=2;o+9<r.byteLength;){var s=r.getUint16(o,Mi);if(a.has(s))return{mimeType:"image/jpeg",height:r.getUint16(o+5,Mi),width:r.getUint16(o+7,Mi)};if(!i.has(s))return null;o+=2,o+=r.getUint16(o,Mi)}return null}function ede(){for(var t=new Set([65499,65476,65484,65501,65534]),r=65504;r<65520;++r)t.add(r);var e=new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502]);return{tableMarkers:t,sofMarkers:e}}function Qc(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}function $x(t,r){return Wx.apply(this,arguments)}function Wx(){return Wx=(0,$k.default)(Hx.default.mark(function t(r,e){var n,i,a;return Hx.default.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return n=ds(r)||{},i=n.mimeType,a=globalThis._parseImageNode,Ne(a),s.next=5,a(r,i);case 5:return s.abrupt("return",s.sent);case 6:case"end":return s.stop()}},t)})),Wx.apply(this,arguments)}function Yx(t,r,e){return qx.apply(this,arguments)}function qx(){return qx=(0,Xk.default)(Xx.default.mark(function t(r,e,n){var i,a,o,s,u,l;return Xx.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:e=e||{},i=e.image||{},a=i.type||"auto",o=n||{},s=o.url,u=tde(a),c.t0=u,c.next=c.t0==="imagebitmap"?8:c.t0==="image"?12:c.t0==="data"?16:20;break;case 8:return c.next=10,zx(r,e,s);case 10:return l=c.sent,c.abrupt("break",21);case 12:return c.next=14,Kc(r,e,s);case 14:return l=c.sent,c.abrupt("break",21);case 16:return c.next=18,$x(r,e);case 18:return l=c.sent,c.abrupt("break",21);case 20:Ne(!1);case 21:return a==="data"&&(l=zk(l)),c.abrupt("return",l);case 23:case"end":return c.stop()}},t)})),qx.apply(this,arguments)}function tde(t){switch(t){case"auto":case"data":return Uk();default:return jk(t),t}}var rde=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],nde=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],ide={image:{type:"auto",decode:!0}},Jn={id:"image",module:"images",name:"Images",version:Nk,mimeTypes:nde,extensions:rde,parse:Yx,tests:[function(t){return Boolean(ds(new DataView(t)))}],options:ide};var ade=h(ye()),ode=h(ve());var Kx={};function Zx(t){if(Kx[t]===void 0){var r=fa?ude(t):sde(t);Kx[t]=r}return Kx[t]}function sde(t){var r=["image/png","image/jpeg","image/gif"],e=globalThis._parseImageNode,n=globalThis._imageFormatsNode,i=n===void 0?r:n;return Boolean(e)&&i.includes(t)}function ude(t){switch(t){case"image/avif":case"image/webp":return lde(t);default:return!0}}function lde(t){try{var r=document.createElement("canvas"),e=r.toDataURL(t);return e.indexOf("data:".concat(t))===0}catch{return!1}}var Lv=h(ze()),tp=h(Zt()),uB=h(B()),lB=h(L()),fB=h(N());var qk=h(ze());var Cv=h(ze());function ep(t){if(typeof window<"u"&&(0,Cv.default)(window.process)==="object"&&window.process.type==="renderer"||typeof process<"u"&&(0,Cv.default)(process.versions)==="object"&&Boolean(process.versions.electron))return!0;var r=(typeof navigator>"u"?"undefined":(0,Cv.default)(navigator))==="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,e=t||r;return!!(e&&e.indexOf("Electron")>=0)}function nr(){var t=(typeof process>"u"?"undefined":(0,qk.default)(process))==="object"&&String(process)==="[object process]"&&!process.browser;return!t||ep()}var Yk=h(ze()),oo={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document,process:(typeof process>"u"?"undefined":(0,Yk.default)(process))==="object"&&process};var fde=oo.self||oo.window||oo.global,Ju=oo.window||oo.self||oo.global,cde=oo.document||{},vs=oo.process||{};var Mv="8.9.19",K6e=nr();var Jx=globalThis;function Qu(t){if(!t&&!nr())return"Node";if(ep(t))return"Electron";var r=typeof navigator<"u"?navigator:{},e=t||r.userAgent||"";if(e.indexOf("Edge")>-1)return"Edge";var n=e.indexOf("MSIE ")!==-1,i=e.indexOf("Trident/")!==-1;return n||i?"IE":Jx.chrome?"Chrome":Jx.safari?"Safari":Jx.mozInnerScreenX?"Firefox":"Unknown"}var Kk=h(L()),Zk=h(N());function pde(t){try{var r=window[t],e="__storage_test__";return r.setItem(e,e),r.removeItem(e),r}catch{return null}}var Jk=function(){function t(r){(0,Kk.default)(this,t);var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";w(this,"storage",void 0),w(this,"id",void 0),w(this,"config",{}),this.storage=pde(n),this.id=r,this.config={},Object.assign(this.config,e),this._loadConfiguration()}return(0,Zk.default)(t,[{key:"getConfiguration",value:function(){return this.config}},{key:"setConfiguration",value:function(e){return this.config={},this.updateConfiguration(e)}},{key:"updateConfiguration",value:function(e){if(Object.assign(this.config,e),this.storage){var n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}return this}},{key:"_loadConfiguration",value:function(){var e={};if(this.storage){var n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}}]),t}();function Qk(t){var r;return t<10?r="".concat(t.toFixed(2),"ms"):t<100?r="".concat(t.toFixed(1),"ms"):t<1e3?r="".concat(t.toFixed(0),"ms"):r="".concat((t/1e3).toFixed(2),"s"),r}function eB(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8,e=Math.max(r-t.length,0);return"".concat(" ".repeat(e)).concat(t)}function Iv(t,r,e){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600,i=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>n&&(e=Math.min(e,n/t.width));var a=t.width*e,o=t.height*e,s=["font-size:1px;","padding:".concat(Math.floor(o/2),"px ").concat(Math.floor(a/2),"px;"),"line-height:".concat(o,"px;"),"background:url(".concat(i,");"),"background-size:".concat(a,"px ").concat(o,"px;"),"color:transparent;"].join("");return["".concat(r," %c+"),s]}var Rv;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Rv||(Rv={}));function tB(t){return typeof t=="string"?Rv[t.toUpperCase()]||Rv.WHITE:t}function rB(t,r,e){return!nr&&typeof t=="string"&&(r&&(r=tB(r),t="\x1B[".concat(r,"m").concat(t,"\x1B[39m")),e&&(r=tB(e),t="\x1B[".concat(e+10,"m").concat(t,"\x1B[49m"))),t}function hde(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=dde(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function dde(t,r){if(t){if(typeof t=="string")return nB(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return nB(t,r)}}function nB(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function iB(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"],e=Object.getPrototypeOf(t),n=Object.getOwnPropertyNames(e),i=hde(n),a;try{var o=function(){var u=a.value;typeof t[u]=="function"&&(r.find(function(l){return u===l})||(t[u]=t[u].bind(t)))};for(i.s();!(a=i.n()).done;)o()}catch(s){i.e(s)}finally{i.f()}}function el(t,r){if(!t)throw new Error(r||"Assertion failed")}function ms(){var t;if(nr&&"performance"in Ju){var r,e;t=Ju===null||Ju===void 0||(r=Ju.performance)===null||r===void 0||(e=r.now)===null||e===void 0?void 0:e.call(r)}else if("hrtime"in vs){var n,i=vs===null||vs===void 0||(n=vs.hrtime)===null||n===void 0?void 0:n.call(vs);t=i[0]*1e3+i[1]/1e6}else t=Date.now();return t}var tl={debug:nr&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},vde={enabled:!0,level:0};function xn(){}var aB={},oB={once:!0},so=function(){function t(){(0,lB.default)(this,t);var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""},e=r.id;w(this,"id",void 0),w(this,"VERSION",Mv),w(this,"_startTs",ms()),w(this,"_deltaTs",ms()),w(this,"_storage",void 0),w(this,"userData",{}),w(this,"LOG_THROTTLE_TIMEOUT",0),this.id=e,this._storage=new Jk("__probe-".concat(this.id,"__"),vde),this.userData={},this.timeStamp("".concat(this.id," started")),iB(this),Object.seal(this)}return(0,fB.default)(t,[{key:"level",get:function(){return this.getLevel()},set:function(e){this.setLevel(e)}},{key:"isEnabled",value:function(){return this._storage.config.enabled}},{key:"getLevel",value:function(){return this._storage.config.level}},{key:"getTotal",value:function(){return Number((ms()-this._startTs).toPrecision(10))}},{key:"getDelta",value:function(){return Number((ms()-this._deltaTs).toPrecision(10))}},{key:"priority",get:function(){return this.level},set:function(e){this.level=e}},{key:"getPriority",value:function(){return this.level}},{key:"enable",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.updateConfiguration({enabled:e}),this}},{key:"setLevel",value:function(e){return this._storage.updateConfiguration({level:e}),this}},{key:"get",value:function(e){return this._storage.config[e]}},{key:"set",value:function(e,n){this._storage.updateConfiguration((0,uB.default)({},e,n))}},{key:"settings",value:function(){console.table?console.table(this._storage.config):console.log(this._storage.config)}},{key:"assert",value:function(e,n){el(e,n)}},{key:"warn",value:function(e){return this._getLogFunction(0,e,tl.warn,arguments,oB)}},{key:"error",value:function(e){return this._getLogFunction(0,e,tl.error,arguments)}},{key:"deprecated",value:function(e,n){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(n,"` instead"))}},{key:"removed",value:function(e,n){return this.error("`".concat(e,"` has been removed. Use `").concat(n,"` instead"))}},{key:"probe",value:function(e,n){return this._getLogFunction(e,n,tl.log,arguments,{time:!0,once:!0})}},{key:"log",value:function(e,n){return this._getLogFunction(e,n,tl.debug,arguments)}},{key:"info",value:function(e,n){return this._getLogFunction(e,n,console.info,arguments)}},{key:"once",value:function(e,n){for(var i=arguments.length,a=new Array(i>2?i-2:0),o=2;o<i;o++)a[o-2]=arguments[o];return this._getLogFunction(e,n,tl.debug||tl.info,arguments,oB)}},{key:"table",value:function(e,n,i){return n?this._getLogFunction(e,n,console.table||xn,i&&[i],{tag:_de(n)}):xn}},{key:"image",value:function(e){var n=e.logLevel,i=e.priority,a=e.image,o=e.message,s=o===void 0?"":o,u=e.scale,l=u===void 0?1:u;return this._shouldLog(n||i)?nr?yde({image:a,message:s,scale:l}):gde({image:a,message:s,scale:l}):xn}},{key:"time",value:function(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}},{key:"timeEnd",value:function(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}},{key:"timeStamp",value:function(e,n){return this._getLogFunction(e,n,console.timeStamp||xn)}},{key:"group",value:function(e,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1},a=sB({logLevel:e,message:n,opts:i}),o=i.collapsed;return a.method=(o?console.groupCollapsed:console.group)||console.info,this._getLogFunction(a)}},{key:"groupCollapsed",value:function(e,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,n,Object.assign({},i,{collapsed:!0}))}},{key:"groupEnd",value:function(e){return this._getLogFunction(e,"",console.groupEnd||xn)}},{key:"withGroup",value:function(e,n,i){this.group(e,n)();try{i()}finally{this.groupEnd(e)()}}},{key:"trace",value:function(){console.trace&&console.trace()}},{key:"_shouldLog",value:function(e){return this.isEnabled()&&this.getLevel()>=cB(e)}},{key:"_getLogFunction",value:function(e,n,i,a,o){if(this._shouldLog(e)){var s;o=sB({logLevel:e,message:n,args:a,opts:o}),i=i||o.method,el(i),o.total=this.getTotal(),o.delta=this.getDelta(),this._deltaTs=ms();var u=o.tag||o.message;if(o.once)if(!aB[u])aB[u]=ms();else return xn;return n=mde(this.id,o.message,o),(s=i).bind.apply(s,[console,n].concat((0,tp.default)(o.args)))}return xn}}]),t}();w(so,"VERSION",Mv);function cB(t){if(!t)return 0;var r;switch((0,Lv.default)(t)){case"number":r=t;break;case"object":r=t.logLevel||t.priority||0;break;default:return 0}return el(Number.isFinite(r)&&r>=0),r}function sB(t){var r=t.logLevel,e=t.message;t.logLevel=cB(r);for(var n=t.args?Array.from(t.args):[];n.length&&n.shift()!==e;);switch((0,Lv.default)(r)){case"string":case"function":e!==void 0&&n.unshift(e),t.message=r;break;case"object":Object.assign(t,r);break;default:}typeof t.message=="function"&&(t.message=t.message());var i=(0,Lv.default)(t.message);return el(i==="string"||i==="object"),Object.assign(t,{args:n},t.opts)}function mde(t,r,e){if(typeof r=="string"){var n=e.time?eB(Qk(e.total)):"";r=e.time?"".concat(t,": ").concat(n,"  ").concat(r):"".concat(t,": ").concat(r),r=rB(r,e.color,e.background)}return r}function gde(t){var r=t.image,e=t.message,n=e===void 0?"":e,i=t.scale,a=i===void 0?1:i,o=null;try{o=module.require("asciify-image")}catch{}return o?function(){return o(r,{fit:"box",width:"".concat(Math.round(80*a),"%")}).then(function(s){return console.log(s)})}:xn}function yde(t){var r=t.image,e=t.message,n=e===void 0?"":e,i=t.scale,a=i===void 0?1:i;if(typeof r=="string"){var o=new Image;return o.onload=function(){var f,c=Iv(o,n,a);(f=console).log.apply(f,(0,tp.default)(c))},o.src=r,xn}var s=r.nodeName||"";if(s.toLowerCase()==="img"){var u;return(u=console).log.apply(u,(0,tp.default)(Iv(r,n,a))),xn}if(s.toLowerCase()==="canvas"){var l=new Image;return l.onload=function(){var f;return(f=console).log.apply(f,(0,tp.default)(Iv(l,n,a)))},l.src=r.toDataURL(),xn}return xn}function _de(t){for(var r in t)for(var e in t[r])return e||"untitled";return"empty"}var CGe=new so({id:"@probe.gl/log"});var J=new so({id:"deck"});var Qx={};function kv(t){Qx=t}function Nt(t,r,e,n){J.level>0&&Qx[t]&&Qx[t].call(null,r,e,n)}function bde(t){var r=t[0],e=t[t.length-1];return r==="{"&&e==="}"||r==="["&&e==="]"}var pB={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:bde,parseTextSync:JSON.parse};function hB(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function dB(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?hB(Object(e),!0).forEach(function(n){(0,vB.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):hB(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function xde(){var t="8.9.19",r=globalThis.deck&&globalThis.deck.VERSION;if(r&&r!==t)throw new Error("deck.gl - multiple versions detected: ".concat(r," vs ").concat(t));return r||(J.log(1,"deck.gl ".concat(t))(),globalThis.deck=dB(dB({},globalThis.deck),{},{VERSION:t,version:t,log:J,_registerLoggers:kv}),Wc([pB,[Jn,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}var Bv=xde();var ue={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(ue,"IDENTITY",{get:function(){return J.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0}});var Sr={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},St={common:0,meters:1,pixels:2},eA={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},mB={DRAW:"draw",MASK:"mask",TERRAIN:"terrain"};var cU=h(L()),pU=h(N()),hn=h(B());var ne=new so({id:"luma.gl"});function Vt(t,r){if(!t)throw new Error(r||"luma.gl: assertion failed.")}var Ade="Invalid WebGLRenderingContext";var Sde="Requires WebGL2";function pa(t){return typeof WebGLRenderingContext<"u"&&t instanceof WebGLRenderingContext||typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:Boolean(t&&Number.isFinite(t._version))}function ce(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:Boolean(t&&t._version===2)}function tA(t){return ce(t)?t:null}function ha(t){return Vt(pa(t),Ade),t}function yt(t){return Vt(ce(t),Sde),t}var rp={};function Tde(t){globalThis.console&&globalThis.console.error&&globalThis.console.error(t)}function wde(t){globalThis.console&&globalThis.console.log&&globalThis.console.log(t)}function Pde(t,r){rp[t]=!0,r!==void 0&&Tde(r)}function Ode(t){var r=t.getError;t.getError=function(){var n;do n=r.apply(t),n!==0&&(rp[n]=!0);while(n!==0);for(n in rp)if(rp[n])return delete rp[n],parseInt(n,10);return 0}}var np=function t(r){var e=r.gl;this.ext=r,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(r.maxVertexAttribs);for(var n=0;n<this.attribs.length;n++){var i=new t.VertexAttrib(e);this.attribs[n]=i}this.maxAttrib=0};np.VertexAttrib=function(r){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()};np.VertexAttrib.prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};var gs=function(r){var e=this;this.gl=r,Ode(r);var n=this.original={getParameter:r.getParameter,enableVertexAttribArray:r.enableVertexAttribArray,disableVertexAttribArray:r.disableVertexAttribArray,bindBuffer:r.bindBuffer,getVertexAttrib:r.getVertexAttrib,vertexAttribPointer:r.vertexAttribPointer};r.getParameter=function(a){return a===e.VERTEX_ARRAY_BINDING_OES?e.currentVertexArrayObject===e.defaultVertexArrayObject?null:e.currentVertexArrayObject:n.getParameter.apply(this,arguments)},r.enableVertexAttribArray=function(a){var o=e.currentVertexArrayObject;o.maxAttrib=Math.max(o.maxAttrib,a);var s=o.attribs[a];return s.enabled=!0,n.enableVertexAttribArray.apply(this,arguments)},r.disableVertexAttribArray=function(a){var o=e.currentVertexArrayObject;o.maxAttrib=Math.max(o.maxAttrib,a);var s=o.attribs[a];return s.enabled=!1,n.disableVertexAttribArray.apply(this,arguments)},r.bindBuffer=function(a,o){switch(a){case 34962:e.currentArrayBuffer=o;break;case 34963:e.currentVertexArrayObject.elementArrayBuffer=o;break;default:}return n.bindBuffer.apply(this,arguments)},r.getVertexAttrib=function(a,o){var s=e.currentVertexArrayObject,u=s.attribs[a];switch(o){case 34975:return u.buffer;case 34338:return u.enabled;case 34339:return u.size;case 34340:return u.stride;case 34341:return u.type;case 34922:return u.normalized;default:return n.getVertexAttrib.apply(this,arguments)}},r.vertexAttribPointer=function(a,o,s,u,l,f){var c=e.currentVertexArrayObject;c.maxAttrib=Math.max(c.maxAttrib,a);var p=c.attribs[a];return p.buffer=e.currentArrayBuffer,p.size=o,p.type=s,p.normalized=u,p.stride=l,p.offset=f,p.recache(),n.vertexAttribPointer.apply(this,arguments)},r.instrumentExtension&&r.instrumentExtension(this,"OES_vertex_array_object"),r.canvas&&r.canvas.addEventListener("webglcontextrestored",function(){wde("OESVertexArrayObject emulation library context restored"),e.reset_()},!0),this.reset_()};gs.prototype.VERTEX_ARRAY_BINDING_OES=34229;gs.prototype.reset_=function(){var r=this.vertexArrayObjects!==void 0;if(r)for(var e=0;e<this.vertexArrayObjects.length;++e)this.vertexArrayObjects.isAlive=!1;var n=this.gl;this.maxVertexAttribs=n.getParameter(34921),this.defaultVertexArrayObject=new np(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)};gs.prototype.createVertexArrayOES=function(){var r=new np(this);return this.vertexArrayObjects.push(r),r};gs.prototype.deleteVertexArrayOES=function(r){r.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(r),1),this.currentVertexArrayObject===r&&this.bindVertexArrayOES(null)};gs.prototype.isVertexArrayOES=function(r){return!!(r&&r instanceof np&&r.hasBeenBound&&r.ext===this)};gs.prototype.bindVertexArrayOES=function(r){var e=this.gl;if(r&&!r.isAlive){Pde(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");return}var n=this.original,i=this.currentVertexArrayObject;this.currentVertexArrayObject=r||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;var a=this.currentVertexArrayObject;if(i!==a){(!i||a.elementArrayBuffer!==i.elementArrayBuffer)&&n.bindBuffer.call(e,34963,a.elementArrayBuffer);for(var o=this.currentArrayBuffer,s=Math.max(i?i.maxAttrib:0,a.maxAttrib),u=0;u<=s;u++){var l=a.attribs[u],f=i?i.attribs[u]:null;if((!i||l.enabled!==f.enabled)&&(l.enabled?n.enableVertexAttribArray.call(e,u):n.disableVertexAttribArray.call(e,u)),l.enabled){var c=!1;(!i||l.buffer!==f.buffer)&&(o!==l.buffer&&(n.bindBuffer.call(e,34962,l.buffer),o=l.buffer),c=!0),(c||l.cached!==f.cached)&&n.vertexAttribPointer.call(e,u,l.size,l.type,l.normalized,l.stride,l.offset)}}this.currentArrayBuffer!==o&&n.bindBuffer.call(e,34962,this.currentArrayBuffer)}};function gB(t){if(typeof t.createVertexArray!="function"){var r=t.getSupportedExtensions;t.getSupportedExtensions=function(){var i=r.call(this)||[];return i.indexOf("OES_vertex_array_object")<0&&i.push("OES_vertex_array_object"),i};var e=t.getExtension;t.getExtension=function(i){var a=e.call(this,i);return a||(i!=="OES_vertex_array_object"?null:(t.__OESVertexArrayObject||(this.__OESVertexArrayObject=new gs(this)),this.__OESVertexArrayObject))}}}var ip=h(B());var Ue=h(B());var je,yB="OES_element_index",_B="WEBGL_draw_buffers",Ede="EXT_disjoint_timer_query",Cde="EXT_disjoint_timer_query_webgl2",Mde="EXT_texture_filter_anisotropic",bB="WEBGL_debug_renderer_info",Ide=35723,Rde=4352,Lde=36795,kde=34047,Bde=37445,Fde=37446,_t=function(r){return ce(r)?void 0:0},Dde=(je={},(0,Ue.default)(je,3074,function(r){return ce(r)?void 0:36064}),(0,Ue.default)(je,Ide,function(t){return ce(t)?void 0:Rde}),(0,Ue.default)(je,35977,_t),(0,Ue.default)(je,32937,_t),(0,Ue.default)(je,Lde,function(t,r){var e=ce(t)?t.getExtension(Cde):t.getExtension(Ede);return e&&e.GPU_DISJOINT_EXT?r(e.GPU_DISJOINT_EXT):0}),(0,Ue.default)(je,Bde,function(t,r){var e=t.getExtension(bB);return r(e&&e.UNMASKED_VENDOR_WEBGL||7936)}),(0,Ue.default)(je,Fde,function(t,r){var e=t.getExtension(bB);return r(e&&e.UNMASKED_RENDERER_WEBGL||7937)}),(0,Ue.default)(je,kde,function(t,r){var e=t.luma.extensions[Mde];return e?r(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1}),(0,Ue.default)(je,32883,_t),(0,Ue.default)(je,35071,_t),(0,Ue.default)(je,37447,_t),(0,Ue.default)(je,36063,function(r,e){if(!ce(r)){var n=r.getExtension(_B);return n?e(n.MAX_COLOR_ATTACHMENTS_WEBGL):0}}),(0,Ue.default)(je,35379,_t),(0,Ue.default)(je,35374,_t),(0,Ue.default)(je,35377,_t),(0,Ue.default)(je,34852,function(r){if(!ce(r)){var e=r.getExtension(_B);return e?e.MAX_DRAW_BUFFERS_WEBGL:0}}),(0,Ue.default)(je,36203,function(r){return r.getExtension(yB)?2147483647:65535}),(0,Ue.default)(je,33001,function(r){return r.getExtension(yB)?16777216:65535}),(0,Ue.default)(je,33e3,function(r){return 16777216}),(0,Ue.default)(je,37157,_t),(0,Ue.default)(je,35373,_t),(0,Ue.default)(je,35657,_t),(0,Ue.default)(je,36183,_t),(0,Ue.default)(je,37137,_t),(0,Ue.default)(je,34045,_t),(0,Ue.default)(je,35978,_t),(0,Ue.default)(je,35979,_t),(0,Ue.default)(je,35968,_t),(0,Ue.default)(je,35376,_t),(0,Ue.default)(je,35375,_t),(0,Ue.default)(je,35659,_t),(0,Ue.default)(je,37154,_t),(0,Ue.default)(je,35371,_t),(0,Ue.default)(je,35658,_t),(0,Ue.default)(je,35076,_t),(0,Ue.default)(je,35077,_t),(0,Ue.default)(je,35380,_t),je);function xB(t,r,e){var n=Dde[e],i=typeof n=="function"?n(t,r,e):n,a=i!==void 0?i:r(e);return a}var rl,Nde="OES_vertex_array_object",AB="ANGLE_instanced_arrays",jde="WEBGL_draw_buffers",Ude="EXT_disjoint_timer_query",Gde="EXT_texture_filter_anisotropic",zde="VertexArray requires WebGL2 or OES_vertex_array_object extension";function Vde(t,r){return{webgl2:ce(t),ext:t.getExtension(r)}}var rA=(rl={},(0,ip.default)(rl,Nde,{meta:{suffix:"OES"},createVertexArray:function(){Vt(!1,zde)},deleteVertexArray:function(){},bindVertexArray:function(){},isVertexArray:function(){return!1}}),(0,ip.default)(rl,AB,{meta:{suffix:"ANGLE"},vertexAttribDivisor:function(r,e){Vt(e===0,"WebGL instanced rendering not supported")},drawElementsInstanced:function(){},drawArraysInstanced:function(){}}),(0,ip.default)(rl,jde,{meta:{suffix:"WEBGL"},drawBuffers:function(){Vt(!1)}}),(0,ip.default)(rl,Ude,{meta:{suffix:"EXT"},createQuery:function(){Vt(!1)},deleteQuery:function(){Vt(!1)},beginQuery:function(){Vt(!1)},endQuery:function(){},getQuery:function(r,e){return this.getQueryObject(r,e)},getQueryParameter:function(r,e){return this.getQueryObject(r,e)},getQueryObject:function(){}}),rl),Fv={readBuffer:function(r,e,n){ce(r)&&e(n)},getVertexAttrib:function(r,e,n,i){var a=Vde(r,AB),o=a.webgl2,s=a.ext,u;switch(i){case 35069:u=o?void 0:!1;break;case 35070:u=!o&&!s?0:void 0;break;default:}return u!==void 0?u:e(n,i)},getProgramParameter:function(r,e,n,i){if(!ce(r))switch(i){case 35967:return 35981;case 35971:return 0;case 35382:return 0;default:}return e(n,i)},getInternalformatParameter:function(r,e,n,i,a){if(!ce(r))switch(a){case 32937:return new Int32Array([0]);default:}return r.getInternalformatParameter(n,i,a)},getTexParameter:function(r,e,n,i){switch(i){case 34046:var a=r.luma.extensions,o=a[Gde];i=o&&o.TEXTURE_MAX_ANISOTROPY_EXT||34046;break;default:}return e(n,i)},getParameter:xB,hint:function(r,e,n,i){return e(n,i)}};function TB(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=Hde(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function Hde(t,r){if(t){if(typeof t=="string")return SB(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return SB(t,r)}}function SB(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function wB(t){t.luma=t.luma||{};var r=t.luma;return r.polyfilled||(gB(t),Wde(t),Xde(t,rA),$de(t,{target:r,target2:t}),r.polyfilled=!0),t}globalThis.polyfillContext=wB;function Wde(t){t.luma.extensions={};var r=t.getSupportedExtensions()||[],e=TB(r),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;t.luma[i]=t.getExtension(i)}}catch(a){e.e(a)}finally{e.f()}}function $de(t,r){var e=r.target,n=r.target2;Object.keys(Fv).forEach(function(i){if(typeof Fv[i]=="function"){var a=t[i]?t[i].bind(t):function(){},o=Fv[i].bind(null,t,a);e[i]=o,n[i]=o}})}function Xde(t,r){var e=TB(Object.getOwnPropertyNames(r)),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;i!=="overrides"&&qde(t,{extension:i,target:t.luma,target2:t})}}catch(a){e.e(a)}finally{e.f()}}function qde(t,r){var e=r.extension,n=r.target,i=r.target2,a=rA[e];Vt(a);for(var o=a.meta,s=o===void 0?{}:o,u=s.suffix,l=u===void 0?"":u,f=t.getExtension(e),c=function(){var m=d[p],g="".concat(m).concat(l),y=null;m==="meta"||typeof t[m]=="function"||(f&&typeof f[g]=="function"?y=function(){return f[g].apply(f,arguments)}:typeof a[m]=="function"&&(y=a[m].bind(n))),y&&(n[m]=y,i[m]=y)},p=0,d=Object.keys(a);p<d.length;p++)c()}var Dv=h(me()),Rt=h(Zt()),D=h(B());var _e,te,An,op=(_e={},(0,D.default)(_e,3042,!1),(0,D.default)(_e,32773,new Float32Array([0,0,0,0])),(0,D.default)(_e,32777,32774),(0,D.default)(_e,34877,32774),(0,D.default)(_e,32969,1),(0,D.default)(_e,32968,0),(0,D.default)(_e,32971,1),(0,D.default)(_e,32970,0),(0,D.default)(_e,3106,new Float32Array([0,0,0,0])),(0,D.default)(_e,3107,[!0,!0,!0,!0]),(0,D.default)(_e,2884,!1),(0,D.default)(_e,2885,1029),(0,D.default)(_e,2929,!1),(0,D.default)(_e,2931,1),(0,D.default)(_e,2932,513),(0,D.default)(_e,2928,new Float32Array([0,1])),(0,D.default)(_e,2930,!0),(0,D.default)(_e,3024,!0),(0,D.default)(_e,36006,null),(0,D.default)(_e,2886,2305),(0,D.default)(_e,33170,4352),(0,D.default)(_e,2849,1),(0,D.default)(_e,32823,!1),(0,D.default)(_e,32824,0),(0,D.default)(_e,10752,0),(0,D.default)(_e,32938,1),(0,D.default)(_e,32939,!1),(0,D.default)(_e,3089,!1),(0,D.default)(_e,3088,new Int32Array([0,0,1024,1024])),(0,D.default)(_e,2960,!1),(0,D.default)(_e,2961,0),(0,D.default)(_e,2968,4294967295),(0,D.default)(_e,36005,4294967295),(0,D.default)(_e,2962,519),(0,D.default)(_e,2967,0),(0,D.default)(_e,2963,4294967295),(0,D.default)(_e,34816,519),(0,D.default)(_e,36003,0),(0,D.default)(_e,36004,4294967295),(0,D.default)(_e,2964,7680),(0,D.default)(_e,2965,7680),(0,D.default)(_e,2966,7680),(0,D.default)(_e,34817,7680),(0,D.default)(_e,34818,7680),(0,D.default)(_e,34819,7680),(0,D.default)(_e,2978,[0,0,1024,1024]),(0,D.default)(_e,3333,4),(0,D.default)(_e,3317,4),(0,D.default)(_e,37440,!1),(0,D.default)(_e,37441,!1),(0,D.default)(_e,37443,37444),(0,D.default)(_e,35723,4352),(0,D.default)(_e,36010,null),(0,D.default)(_e,35977,!1),(0,D.default)(_e,3330,0),(0,D.default)(_e,3332,0),(0,D.default)(_e,3331,0),(0,D.default)(_e,3314,0),(0,D.default)(_e,32878,0),(0,D.default)(_e,3316,0),(0,D.default)(_e,3315,0),(0,D.default)(_e,32877,0),_e),uo=function(r,e,n){return e?r.enable(n):r.disable(n)},PB=function(r,e,n){return r.hint(n,e)},ln=function(r,e,n){return r.pixelStorei(n,e)},Yde=function(r,e){var n=ce(r)?36009:36160;return r.bindFramebuffer(n,e)},Kde=function(r,e){return r.bindFramebuffer(36008,e)};function ap(t){return Array.isArray(t)||ArrayBuffer.isView(t)}var OB=(te={},(0,D.default)(te,3042,uo),(0,D.default)(te,32773,function(r,e){return r.blendColor.apply(r,(0,Rt.default)(e))}),(0,D.default)(te,32777,"blendEquation"),(0,D.default)(te,34877,"blendEquation"),(0,D.default)(te,32969,"blendFunc"),(0,D.default)(te,32968,"blendFunc"),(0,D.default)(te,32971,"blendFunc"),(0,D.default)(te,32970,"blendFunc"),(0,D.default)(te,3106,function(r,e){return r.clearColor.apply(r,(0,Rt.default)(e))}),(0,D.default)(te,3107,function(r,e){return r.colorMask.apply(r,(0,Rt.default)(e))}),(0,D.default)(te,2884,uo),(0,D.default)(te,2885,function(r,e){return r.cullFace(e)}),(0,D.default)(te,2929,uo),(0,D.default)(te,2931,function(r,e){return r.clearDepth(e)}),(0,D.default)(te,2932,function(r,e){return r.depthFunc(e)}),(0,D.default)(te,2928,function(r,e){return r.depthRange.apply(r,(0,Rt.default)(e))}),(0,D.default)(te,2930,function(r,e){return r.depthMask(e)}),(0,D.default)(te,3024,uo),(0,D.default)(te,35723,PB),(0,D.default)(te,36006,Yde),(0,D.default)(te,2886,function(r,e){return r.frontFace(e)}),(0,D.default)(te,33170,PB),(0,D.default)(te,2849,function(r,e){return r.lineWidth(e)}),(0,D.default)(te,32823,uo),(0,D.default)(te,32824,"polygonOffset"),(0,D.default)(te,10752,"polygonOffset"),(0,D.default)(te,35977,uo),(0,D.default)(te,32938,"sampleCoverage"),(0,D.default)(te,32939,"sampleCoverage"),(0,D.default)(te,3089,uo),(0,D.default)(te,3088,function(r,e){return r.scissor.apply(r,(0,Rt.default)(e))}),(0,D.default)(te,2960,uo),(0,D.default)(te,2961,function(r,e){return r.clearStencil(e)}),(0,D.default)(te,2968,function(r,e){return r.stencilMaskSeparate(1028,e)}),(0,D.default)(te,36005,function(r,e){return r.stencilMaskSeparate(1029,e)}),(0,D.default)(te,2962,"stencilFuncFront"),(0,D.default)(te,2967,"stencilFuncFront"),(0,D.default)(te,2963,"stencilFuncFront"),(0,D.default)(te,34816,"stencilFuncBack"),(0,D.default)(te,36003,"stencilFuncBack"),(0,D.default)(te,36004,"stencilFuncBack"),(0,D.default)(te,2964,"stencilOpFront"),(0,D.default)(te,2965,"stencilOpFront"),(0,D.default)(te,2966,"stencilOpFront"),(0,D.default)(te,34817,"stencilOpBack"),(0,D.default)(te,34818,"stencilOpBack"),(0,D.default)(te,34819,"stencilOpBack"),(0,D.default)(te,2978,function(r,e){return r.viewport.apply(r,(0,Rt.default)(e))}),(0,D.default)(te,3333,ln),(0,D.default)(te,3317,ln),(0,D.default)(te,37440,ln),(0,D.default)(te,37441,ln),(0,D.default)(te,37443,ln),(0,D.default)(te,3330,ln),(0,D.default)(te,3332,ln),(0,D.default)(te,3331,ln),(0,D.default)(te,36010,Kde),(0,D.default)(te,3314,ln),(0,D.default)(te,32878,ln),(0,D.default)(te,3316,ln),(0,D.default)(te,3315,ln),(0,D.default)(te,32877,ln),(0,D.default)(te,"framebuffer",function(r,e){var n=e&&"handle"in e?e.handle:e;return r.bindFramebuffer(36160,n)}),(0,D.default)(te,"blend",function(r,e){return e?r.enable(3042):r.disable(3042)}),(0,D.default)(te,"blendColor",function(r,e){return r.blendColor.apply(r,(0,Rt.default)(e))}),(0,D.default)(te,"blendEquation",function(r,e){e=ap(e)?e:[e,e],r.blendEquationSeparate.apply(r,(0,Rt.default)(e))}),(0,D.default)(te,"blendFunc",function(r,e){e=ap(e)&&e.length===2?[].concat((0,Rt.default)(e),(0,Rt.default)(e)):e,r.blendFuncSeparate.apply(r,(0,Rt.default)(e))}),(0,D.default)(te,"clearColor",function(r,e){return r.clearColor.apply(r,(0,Rt.default)(e))}),(0,D.default)(te,"clearDepth",function(r,e){return r.clearDepth(e)}),(0,D.default)(te,"clearStencil",function(r,e){return r.clearStencil(e)}),(0,D.default)(te,"colorMask",function(r,e){return r.colorMask.apply(r,(0,Rt.default)(e))}),(0,D.default)(te,"cull",function(r,e){return e?r.enable(2884):r.disable(2884)}),(0,D.default)(te,"cullFace",function(r,e){return r.cullFace(e)}),(0,D.default)(te,"depthTest",function(r,e){return e?r.enable(2929):r.disable(2929)}),(0,D.default)(te,"depthFunc",function(r,e){return r.depthFunc(e)}),(0,D.default)(te,"depthMask",function(r,e){return r.depthMask(e)}),(0,D.default)(te,"depthRange",function(r,e){return r.depthRange.apply(r,(0,Rt.default)(e))}),(0,D.default)(te,"dither",function(r,e){return e?r.enable(3024):r.disable(3024)}),(0,D.default)(te,"derivativeHint",function(r,e){r.hint(35723,e)}),(0,D.default)(te,"frontFace",function(r,e){return r.frontFace(e)}),(0,D.default)(te,"mipmapHint",function(r,e){return r.hint(33170,e)}),(0,D.default)(te,"lineWidth",function(r,e){return r.lineWidth(e)}),(0,D.default)(te,"polygonOffsetFill",function(r,e){return e?r.enable(32823):r.disable(32823)}),(0,D.default)(te,"polygonOffset",function(r,e){return r.polygonOffset.apply(r,(0,Rt.default)(e))}),(0,D.default)(te,"sampleCoverage",function(r,e){return r.sampleCoverage.apply(r,(0,Rt.default)(e))}),(0,D.default)(te,"scissorTest",function(r,e){return e?r.enable(3089):r.disable(3089)}),(0,D.default)(te,"scissor",function(r,e){return r.scissor.apply(r,(0,Rt.default)(e))}),(0,D.default)(te,"stencilTest",function(r,e){return e?r.enable(2960):r.disable(2960)}),(0,D.default)(te,"stencilMask",function(r,e){e=ap(e)?e:[e,e];var n=e,i=(0,Dv.default)(n,2),a=i[0],o=i[1];r.stencilMaskSeparate(1028,a),r.stencilMaskSeparate(1029,o)}),(0,D.default)(te,"stencilFunc",function(r,e){e=ap(e)&&e.length===3?[].concat((0,Rt.default)(e),(0,Rt.default)(e)):e;var n=e,i=(0,Dv.default)(n,6),a=i[0],o=i[1],s=i[2],u=i[3],l=i[4],f=i[5];r.stencilFuncSeparate(1028,a,o,s),r.stencilFuncSeparate(1029,u,l,f)}),(0,D.default)(te,"stencilOp",function(r,e){e=ap(e)&&e.length===3?[].concat((0,Rt.default)(e),(0,Rt.default)(e)):e;var n=e,i=(0,Dv.default)(n,6),a=i[0],o=i[1],s=i[2],u=i[3],l=i[4],f=i[5];r.stencilOpSeparate(1028,a,o,s),r.stencilOpSeparate(1029,u,l,f)}),(0,D.default)(te,"viewport",function(r,e){return r.viewport.apply(r,(0,Rt.default)(e))}),te);function jt(t,r,e){return r[t]!==void 0?r[t]:e[t]}var EB={blendEquation:function(r,e,n){return r.blendEquationSeparate(jt(32777,e,n),jt(34877,e,n))},blendFunc:function(r,e,n){return r.blendFuncSeparate(jt(32969,e,n),jt(32968,e,n),jt(32971,e,n),jt(32970,e,n))},polygonOffset:function(r,e,n){return r.polygonOffset(jt(32824,e,n),jt(10752,e,n))},sampleCoverage:function(r,e,n){return r.sampleCoverage(jt(32938,e,n),jt(32939,e,n))},stencilFuncFront:function(r,e,n){return r.stencilFuncSeparate(1028,jt(2962,e,n),jt(2967,e,n),jt(2963,e,n))},stencilFuncBack:function(r,e,n){return r.stencilFuncSeparate(1029,jt(34816,e,n),jt(36003,e,n),jt(36004,e,n))},stencilOpFront:function(r,e,n){return r.stencilOpSeparate(1028,jt(2964,e,n),jt(2965,e,n),jt(2966,e,n))},stencilOpBack:function(r,e,n){return r.stencilOpSeparate(1029,jt(34817,e,n),jt(34818,e,n),jt(34819,e,n))}},nA={enable:function(r,e){return r((0,D.default)({},e,!0))},disable:function(r,e){return r((0,D.default)({},e,!1))},pixelStorei:function(r,e,n){return r((0,D.default)({},e,n))},hint:function(r,e,n){return r((0,D.default)({},e,n))},bindFramebuffer:function(r,e,n){var i;switch(e){case 36160:return r((i={},(0,D.default)(i,36006,n),(0,D.default)(i,36010,n),i));case 36009:return r((0,D.default)({},36006,n));case 36008:return r((0,D.default)({},36010,n));default:return null}},blendColor:function(r,e,n,i,a){return r((0,D.default)({},32773,new Float32Array([e,n,i,a])))},blendEquation:function(r,e){var n;return r((n={},(0,D.default)(n,32777,e),(0,D.default)(n,34877,e),n))},blendEquationSeparate:function(r,e,n){var i;return r((i={},(0,D.default)(i,32777,e),(0,D.default)(i,34877,n),i))},blendFunc:function(r,e,n){var i;return r((i={},(0,D.default)(i,32969,e),(0,D.default)(i,32968,n),(0,D.default)(i,32971,e),(0,D.default)(i,32970,n),i))},blendFuncSeparate:function(r,e,n,i,a){var o;return r((o={},(0,D.default)(o,32969,e),(0,D.default)(o,32968,n),(0,D.default)(o,32971,i),(0,D.default)(o,32970,a),o))},clearColor:function(r,e,n,i,a){return r((0,D.default)({},3106,new Float32Array([e,n,i,a])))},clearDepth:function(r,e){return r((0,D.default)({},2931,e))},clearStencil:function(r,e){return r((0,D.default)({},2961,e))},colorMask:function(r,e,n,i,a){return r((0,D.default)({},3107,[e,n,i,a]))},cullFace:function(r,e){return r((0,D.default)({},2885,e))},depthFunc:function(r,e){return r((0,D.default)({},2932,e))},depthRange:function(r,e,n){return r((0,D.default)({},2928,new Float32Array([e,n])))},depthMask:function(r,e){return r((0,D.default)({},2930,e))},frontFace:function(r,e){return r((0,D.default)({},2886,e))},lineWidth:function(r,e){return r((0,D.default)({},2849,e))},polygonOffset:function(r,e,n){var i;return r((i={},(0,D.default)(i,32824,e),(0,D.default)(i,10752,n),i))},sampleCoverage:function(r,e,n){var i;return r((i={},(0,D.default)(i,32938,e),(0,D.default)(i,32939,n),i))},scissor:function(r,e,n,i,a){return r((0,D.default)({},3088,new Int32Array([e,n,i,a])))},stencilMask:function(r,e){var n;return r((n={},(0,D.default)(n,2968,e),(0,D.default)(n,36005,e),n))},stencilMaskSeparate:function(r,e,n){return r((0,D.default)({},e===1028?2968:36005,n))},stencilFunc:function(r,e,n,i){var a;return r((a={},(0,D.default)(a,2962,e),(0,D.default)(a,2967,n),(0,D.default)(a,2963,i),(0,D.default)(a,34816,e),(0,D.default)(a,36003,n),(0,D.default)(a,36004,i),a))},stencilFuncSeparate:function(r,e,n,i,a){var o;return r((o={},(0,D.default)(o,e===1028?2962:34816,n),(0,D.default)(o,e===1028?2967:36003,i),(0,D.default)(o,e===1028?2963:36004,a),o))},stencilOp:function(r,e,n,i){var a;return r((a={},(0,D.default)(a,2964,e),(0,D.default)(a,2965,n),(0,D.default)(a,2966,i),(0,D.default)(a,34817,e),(0,D.default)(a,34818,n),(0,D.default)(a,34819,i),a))},stencilOpSeparate:function(r,e,n,i,a){var o;return r((o={},(0,D.default)(o,e===1028?2964:34817,n),(0,D.default)(o,e===1028?2965:34818,i),(0,D.default)(o,e===1028?2966:34819,a),o))},viewport:function(r,e,n,i,a){return r((0,D.default)({},2978,[e,n,i,a]))}},Ii=function(r,e){return r.isEnabled(e)},iA=(An={},(0,D.default)(An,3042,Ii),(0,D.default)(An,2884,Ii),(0,D.default)(An,2929,Ii),(0,D.default)(An,3024,Ii),(0,D.default)(An,32823,Ii),(0,D.default)(An,32926,Ii),(0,D.default)(An,32928,Ii),(0,D.default)(An,3089,Ii),(0,D.default)(An,2960,Ii),(0,D.default)(An,35977,Ii),An);var IB=h(L()),RB=h(N());function aA(t){for(var r in t)return!1;return!0}function CB(t,r){if(t===r)return!0;var e=Array.isArray(t)||ArrayBuffer.isView(t),n=Array.isArray(r)||ArrayBuffer.isView(r);if(e&&n&&t.length===r.length){for(var i=0;i<t.length;++i)if(t[i]!==r[i])return!1;return!0}return!1}function MB(t,r){var e=t[r].bind(t);t[r]=function(){var i=arguments.length<=0?void 0:arguments[0];return i in t.state.cache&&t.state.enable?t.state.cache[i]:e.apply(void 0,arguments)},Object.defineProperty(t[r],"name",{value:"".concat(r,"-from-cache"),configurable:!1})}function Zde(t,r,e){var n=t[r].bind(t);t[r]=function(){for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];var u=e.apply(void 0,[t.state._updateCache].concat(o)),l=u.valueChanged,f=u.oldValue;return l&&n.apply(void 0,o),f},Object.defineProperty(t[r],"name",{value:"".concat(r,"-to-cache"),configurable:!1})}function Jde(t){var r=t.useProgram.bind(t);t.useProgram=function(n){t.state.program!==n&&(r(n),t.state.program=n)}}var Qde=function(){function t(r){(0,IB.default)(this,t);var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=e.copyState,i=n===void 0?!1:n,a=e.log,o=a===void 0?function(){}:a;this.gl=r,this.program=null,this.stateStack=[],this.enable=!0,this.cache=i?Ri(r):Object.assign({},op),this.log=o,this._updateCache=this._updateCache.bind(this),Object.seal(this)}return(0,RB.default)(t,[{key:"push",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.stateStack.push({})}},{key:"pop",value:function(){Vt(this.stateStack.length>0);var e=this.stateStack[this.stateStack.length-1];Ht(this.gl,e),this.stateStack.pop()}},{key:"_updateCache",value:function(e){var n=!1,i,a=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(var o in e){Vt(o!==void 0);var s=e[o],u=this.cache[o];CB(s,u)||(n=!0,i=u,a&&!(o in a)&&(a[o]=u),this.cache[o]=s)}return{valueChanged:n,oldValue:i}}}]),t}();function Nv(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=r.enable,n=e===void 0?!0:e,i=r.copyState;if(Vt(i!==void 0),!t.state){var a=globalThis.polyfillContext;a&&a(t),t.state=new Qde(t,{copyState:i}),Jde(t);for(var o in nA){var s=nA[o];Zde(t,o,s)}MB(t,"getParameter"),MB(t,"isEnabled")}return t.state.enable=n,t}function oA(t){t.state||Nv(t,{copyState:!1}),t.state.push()}function jv(t){Vt(t.state),t.state.pop()}function eve(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=tve(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function tve(t,r){if(t){if(typeof t=="string")return LB(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return LB(t,r)}}function LB(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function Ht(t,r){if(Vt(pa(t),"setParameters requires a WebGL context"),!aA(r)){var e={};for(var n in r){var i=Number(n),a=OB[n];a&&(typeof a=="string"?e[a]=!0:a(t,r[n],i))}var o=t.state&&t.state.cache;if(o)for(var s in e){var u=EB[s];u(t,r,o)}}}function Ri(t,r){if(r=r||op,typeof r=="number"){var e=r,n=iA[e];return n?n(t,e):t.getParameter(e)}var i=Array.isArray(r)?r:Object.keys(r),a={},o=eve(i),s;try{for(o.s();!(s=o.n()).done;){var u=s.value,l=iA[u];a[u]=l?l(t,Number(u)):t.getParameter(Number(u))}}catch(f){o.e(f)}finally{o.f()}return a}function Uv(t){Ht(t,op)}function Le(t,r,e){if(aA(r))return e(t);var n=r.nocatch,i=n===void 0?!0:n;oA(t),Ht(t,r);var a;if(i)a=e(t),jv(t);else try{a=e(t)}finally{jv(t)}return a}function _r(t){var r=t.luma;if(t.canvas&&r){var e=r.canvasSizeInfo,n="clientWidth"in e?e.clientWidth:t.canvas.clientWidth;return n?t.drawingBufferWidth/n:1}return 1}function nl(t,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,n=_r(t),i=t.drawingBufferWidth,a=t.drawingBufferHeight;return rve(r,n,i,a,e)}function FB(t){var r=typeof window>"u"?1:window.devicePixelRatio||1;return Number.isFinite(t)?t<=0?1:t:t?r:1}function rve(t,r,e,n,i){var a=kB(t[0],r,e),o=BB(t[1],r,n,i),s=kB(t[0]+1,r,e),u=s===e-1?s:s-1;s=BB(t[1]+1,r,n,i);var l;return i?(s=s===0?s:s+1,l=o,o=s):l=s===n-1?s:s-1,{x:a,y:o,width:Math.max(u-a+1,1),height:Math.max(l-o+1,1)}}function kB(t,r,e){var n=Math.min(Math.round(t*r),e-1);return n}function BB(t,r,e,n){return n?Math.max(0,e-1-Math.round(t*r)):Math.min(Math.round(t*r),e-1)}var sA=nr(),nve=sA&&typeof document<"u",DB={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function il(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Vt(sA,`createGLContext only available in the browser.
Create your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils`),t=Object.assign({},DB,t);var r=t,e=r.width,n=r.height;function i(l){if(t.throwOnError)throw new Error(l);return console.error(l),null}t.onError=i;var a,o=t,s=o.canvas,u=ave({canvas:s,width:e,height:n,onError:i});return a=ive(u,t),a?(a=da(a,t),ove(a),a):null}function da(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!t||t._instrumented)return t;t._version=t._version||sve(t),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{},r=Object.assign({},DB,r);var e=r,n=e.manageState,i=e.debug;return n&&Nv(t,{copyState:!1,log:function(){for(var o=arguments.length,s=new Array(o),u=0;u<o;u++)s[u]=arguments[u];return ne.log.apply(ne,[1].concat(s))()}}),sA&&i&&(globalThis.makeDebugContext?(t=globalThis.makeDebugContext(t,r),ne.level=Math.max(ne.level,1)):ne.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),t._instrumented=!0,t}function NB(t){var r=t.getParameter(7936),e=t.getParameter(7937),n=t.getExtension("WEBGL_debug_renderer_info"),i=n&&t.getParameter(n.UNMASKED_VENDOR_WEBGL||7936),a=n&&t.getParameter(n.UNMASKED_RENDERER_WEBGL||7937);return{vendor:i||r,renderer:a||e,vendorMasked:r,rendererMasked:e,version:t.getParameter(7938),shadingLanguageVersion:t.getParameter(35724)}}function uA(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t.canvas){var e=FB(r.useDevicePixels);uve(t,e,r);return}var n=t.getExtension("STACKGL_resize_drawingbuffer");n&&"width"in r&&"height"in r&&n.resize(r.width,r.height)}function ive(t,r){var e=r.onError,n=null,i=function(c){return n=c.statusMessage||n};t.addEventListener("webglcontextcreationerror",i,!1);var a=r.webgl1,o=a===void 0?!0:a,s=r.webgl2,u=s===void 0?!0:s,l=null;return u&&(l=l||t.getContext("webgl2",r),l=l||t.getContext("experimental-webgl2",r)),o&&(l=l||t.getContext("webgl",r),l=l||t.getContext("experimental-webgl",r)),t.removeEventListener("webglcontextcreationerror",i,!1),l?(r.onContextLost&&t.addEventListener("webglcontextlost",r.onContextLost,!1),r.onContextRestored&&t.addEventListener("webglcontextrestored",r.onContextRestored,!1),l):e("Failed to create ".concat(u&&!o?"WebGL2":"WebGL"," context: ").concat(n||"Unknown error"))}function ave(t){var r=t.canvas,e=t.width,n=e===void 0?800:e,i=t.height,a=i===void 0?600:i,o=t.onError,s;if(typeof r=="string"){var u=nve&&document.readyState==="complete";u||o("createGLContext called on canvas '".concat(r,"' before page was loaded")),s=document.getElementById(r)}else r?s=r:(s=document.createElement("canvas"),s.id="lumagl-canvas",s.style.width=Number.isFinite(n)?"".concat(n,"px"):"100%",s.style.height=Number.isFinite(a)?"".concat(a,"px"):"100%",document.body.insertBefore(s,document.body.firstChild));return s}function ove(t){var r=ce(t)?"WebGL2":"WebGL1",e=NB(t),n=e?"(".concat(e.vendor,",").concat(e.renderer,")"):"",i=t.debug?" debug":"";ne.info(1,"".concat(r).concat(i," context ").concat(n))()}function sve(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?2:1}function uve(t,r,e){var n="width"in e?e.width:t.canvas.clientWidth,i="height"in e?e.height:t.canvas.clientHeight;(!n||!i)&&(ne.log(1,"Canvas clientWidth/clientHeight is 0")(),r=1,n=t.canvas.width||1,i=t.canvas.height||1),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{};var a=t.luma.canvasSizeInfo;if(a.clientWidth!==n||a.clientHeight!==i||a.devicePixelRatio!==r){var o=r,s=Math.floor(n*o),u=Math.floor(i*o);t.canvas.width=s,t.canvas.height=u,(t.drawingBufferWidth!==s||t.drawingBufferHeight!==u)&&(ne.warn("Device pixel ratio clamped")(),o=Math.min(t.drawingBufferWidth/n,t.drawingBufferHeight/i),t.canvas.width=Math.floor(n*o),t.canvas.height=Math.floor(i*o)),Object.assign(t.luma.canvasSizeInfo,{clientWidth:n,clientHeight:i,devicePixelRatio:r})}}var VB=h(L()),HB=h(N());var GB=h(L()),zB=h(N());var jB=h(L()),UB=h(N());function sp(){var t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){var r=process.hrtime();t=r[0]*1e3+r[1]/1e6}else t=Date.now();return t}var Gv=function(){function t(r,e){(0,jB.default)(this,t),w(this,"name",void 0),w(this,"type",void 0),w(this,"sampleSize",1),w(this,"time",void 0),w(this,"count",void 0),w(this,"samples",void 0),w(this,"lastTiming",void 0),w(this,"lastSampleTime",void 0),w(this,"lastSampleCount",void 0),w(this,"_count",0),w(this,"_time",0),w(this,"_samples",0),w(this,"_startTime",0),w(this,"_timerPending",!1),this.name=r,this.type=e,this.reset()}return(0,UB.default)(t,[{key:"setSampleSize",value:function(e){return this.sampleSize=e,this}},{key:"incrementCount",value:function(){return this.addCount(1),this}},{key:"decrementCount",value:function(){return this.subtractCount(1),this}},{key:"addCount",value:function(e){return this._count+=e,this._samples++,this._checkSampling(),this}},{key:"subtractCount",value:function(e){return this._count-=e,this._samples++,this._checkSampling(),this}},{key:"addTime",value:function(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}},{key:"timeStart",value:function(){return this._startTime=sp(),this._timerPending=!0,this}},{key:"timeEnd",value:function(){return this._timerPending?(this.addTime(sp()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}},{key:"getSampleAverageCount",value:function(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}},{key:"getSampleAverageTime",value:function(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}},{key:"getSampleHz",value:function(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}},{key:"getAverageCount",value:function(){return this.samples>0?this.count/this.samples:0}},{key:"getAverageTime",value:function(){return this.samples>0?this.time/this.samples:0}},{key:"getHz",value:function(){return this.time>0?this.samples/(this.time/1e3):0}},{key:"reset",value:function(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}},{key:"_checkSampling",value:function(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}]),t}();var ys=function(){function t(r){(0,GB.default)(this,t),w(this,"id",void 0),w(this,"stats",{}),this.id=r.id,this.stats={},this._initializeStats(r.stats),Object.seal(this)}return(0,zB.default)(t,[{key:"get",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:n})}},{key:"size",get:function(){return Object.keys(this.stats).length}},{key:"reset",value:function(){for(var e in this.stats)this.stats[e].reset();return this}},{key:"forEach",value:function(e){for(var n in this.stats)e(this.stats[n])}},{key:"getTable",value:function(){var e={};return this.forEach(function(n){e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}},{key:"_initializeStats",value:function(){var e=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];n.forEach(function(i){return e._getOrCreate(i)})}},{key:"_getOrCreate",value:function(e){if(!e||!e.name)return null;var n=e.name,i=e.type;return this.stats[n]||(e instanceof Gv?this.stats[n]=e:this.stats[n]=new Gv(n,i)),this.stats[n]}}]),t}();var up="8.5.20",lve="set luma.log.level=1 (or higher) to trace rendering",fve=function(){function t(){(0,VB.default)(this,t),this.stats=new Map}return(0,HB.default)(t,[{key:"get",value:function(e){return this.stats.has(e)||this.stats.set(e,new ys({id:e})),this.stats.get(e)}}]),t}(),Sn=new fve;if(globalThis.luma&&globalThis.luma.VERSION!==up)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(globalThis.luma.VERSION," vs ").concat(up));globalThis.luma||(nr()&&ne.log(1,"luma.gl ".concat(up," - ").concat(lve))(),globalThis.luma=globalThis.luma||{VERSION:up,version:up,log:ne,stats:Sn,globals:{modules:{},nodeIO:{}}});var Zze=globalThis.luma;function lA(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function fA(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}var iF=h(B());var g3=h(L()),y3=h(N()),_3=h(be()),b3=h(Y()),x3=h(K()),vA=h(q());var c3=h(me()),p3=h(L()),h3=h(N()),d3=h(Y()),v3=h(K()),dA=h(q());var $B=h(L()),XB=h(N());function Z(t,r){if(!t)throw new Error(r||"luma.gl: assertion failed.")}function zv(t,r){if(typeof r!="string")return r;var e=Number(r);if(!isNaN(e))return e;r=r.replace(/^.*\./,"");var n=t[r];return Z(n!==void 0,"Accessing undefined constant GL.".concat(r)),n}function Tn(t,r){r=Number(r);for(var e in t)if(t[e]===r)return"GL.".concat(e);return String(r)}var cA={};function Ye(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"id";cA[t]=cA[t]||1;var r=cA[t]++;return"".concat(t,"-").concat(r)}function pA(t){return Z(typeof t=="number","Input must be a number"),t&&(t&t-1)===0}function Li(t){var r=!0;for(var e in t){r=!1;break}return r}function Vv(t,r,e,n){var i="See luma.gl ".concat(e," Upgrade Guide at https://luma.gl/docs/upgrade-guide"),a=Object.getPrototypeOf(t);n.forEach(function(o){a.methodName||(a[o]=function(){throw ne.removed("Calling removed method ".concat(r,".").concat(o,": "),i)(),new Error(o)})})}function cve(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=pve(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function pve(t,r){if(t){if(typeof t=="string")return WB(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return WB(t,r)}}function WB(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var al="Resource subclass must define virtual methods",hr=function(t){function r(e){(0,$B.default)(this,r);var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};ha(e);var i=n.id,a=n.userData,o=a===void 0?{}:a;this.gl=e,this.gl2=e,this.id=i||Ye(this[Symbol.toStringTag]),this.userData=o,this._bound=!1,this._handle=n.handle,this._handle===void 0&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}return(0,XB.default)(r,[{key:t,get:function(){return"Resource"}},{key:"toString",value:function(){return"".concat(this[Symbol.toStringTag]||this.constructor.name,"(").concat(this.id,")")}},{key:"handle",get:function(){return this._handle}},{key:"delete",value:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.deleteChildren,a=i===void 0?!1:i,o=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,o&&a&&o.filter(Boolean).forEach(function(s){return s.delete()}),this}},{key:"bind",value:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.handle;if(typeof n!="function")return this._bindHandle(n),this;var i;return this._bound?i=n():(this._bindHandle(this.handle),this._bound=!0,i=n(),this._bound=!1,this._bindHandle(null)),i}},{key:"unbind",value:function(){this.bind(null)}},{key:"getParameter",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};n=zv(this.gl,n),Z(n);var a=this.constructor.PARAMETERS||{},o=a[n];if(o){var s=ce(this.gl),u=(!("webgl2"in o)||s)&&(!("extension"in o)||this.gl.getExtension(o.extension));if(!u){var l=o.webgl1,f="webgl2"in o?o.webgl2:o.webgl1,c=s?f:l;return c}}return this._getParameter(n,i)}},{key:"getParameters",value:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.parameters,a=n.keys,o=this.constructor.PARAMETERS||{},s=ce(this.gl),u={},l=i||Object.keys(o),f=cve(l),c;try{for(f.s();!(c=f.n()).done;){var p=c.value,d=o[p],v=d&&(!("webgl2"in d)||s)&&(!("extension"in d)||this.gl.getExtension(d.extension));if(v){var m=a?Tn(this.gl,p):p;u[m]=this.getParameter(p,n),a&&d.type==="GLenum"&&(u[m]=Tn(this.gl,u[m]))}}}catch(g){f.e(g)}finally{f.f()}return u}},{key:"setParameter",value:function(n,i){n=zv(this.gl,n),Z(n);var a=this.constructor.PARAMETERS||{},o=a[n];if(o){var s=ce(this.gl),u=(!("webgl2"in o)||s)&&(!("extension"in o)||this.gl.getExtension(o.extension));if(!u)throw new Error("Parameter not available on this platform");o.type==="GLenum"&&(i=zv(i))}return this._setParameter(n,i),this}},{key:"setParameters",value:function(n){for(var i in n)this.setParameter(i,n[i]);return this}},{key:"stubRemovedMethods",value:function(n,i,a){return Vv(this,n,i,a)}},{key:"initialize",value:function(n){}},{key:"_createHandle",value:function(){throw new Error(al)}},{key:"_deleteHandle",value:function(){throw new Error(al)}},{key:"_bindHandle",value:function(n){throw new Error(al)}},{key:"_getOptsFromHandle",value:function(){throw new Error(al)}},{key:"_getParameter",value:function(n,i){throw new Error(al)}},{key:"_setParameter",value:function(n,i){throw new Error(al)}},{key:"_context",value:function(){return this.gl.luma=this.gl.luma||{},this.gl.luma}},{key:"_addStats",value:function(){var n=this[Symbol.toStringTag],i=Sn.get("Resource Counts");i.get("Resources Created").incrementCount(),i.get("".concat(n,"s Created")).incrementCount(),i.get("".concat(n,"s Active")).incrementCount()}},{key:"_removeStats",value:function(){var n=this[Symbol.toStringTag],i=Sn.get("Resource Counts");i.get("".concat(n,"s Active")).decrementCount()}},{key:"_trackAllocatedMemory",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag];this._trackAllocatedMemoryForContext(n,i),this._trackAllocatedMemoryForContext(n,i,this.gl.canvas&&this.gl.canvas.id),this.byteLength=n}},{key:"_trackAllocatedMemoryForContext",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag],a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"",o=Sn.get("Memory Usage".concat(a));o.get("GPU Memory").addCount(n),o.get("".concat(i," Memory")).addCount(n)}},{key:"_trackDeallocatedMemory",value:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag];this._trackDeallocatedMemoryForContext(n),this._trackDeallocatedMemoryForContext(n,this.gl.canvas&&this.gl.canvas.id),this.byteLength=0}},{key:"_trackDeallocatedMemoryForContext",value:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag],i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",a=Sn.get("Memory Usage".concat(i));a.get("GPU Memory").subtractCount(this.byteLength),a.get("".concat(n," Memory")).subtractCount(this.byteLength)}}]),r}(Symbol.toStringTag);var t3=h(L()),r3=h(N()),n3=h(be()),i3=h(Y()),a3=h(K()),hA=h(q());var ZB=h(qB()),JB=h(L()),QB=h(N());var vve="Failed to deduce GL constant from typed array";function lp(t){var r=ArrayBuffer.isView(t)?t.constructor:t;switch(r){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(vve)}}function lo(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=r.clamped,n=e===void 0?!0:e;switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return n?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function YB(t){var r=t.data,e=t.width,n=t.height,i=t.bytesPerPixel,a=i===void 0?4:i,o=t.temp,s=e*a;o=o||new Uint8Array(s);for(var u=0;u<n/2;++u){var l=u*s,f=(n-u-1)*s;o.set(r.subarray(l,l+s)),r.copyWithin(l,f,f+s),r.set(o,f)}}function KB(t){for(var r=t.data,e=t.width,n=t.height,i=Math.round(e/2),a=Math.round(n/2),o=new Uint8Array(i*a*4),s=0;s<a;s++)for(var u=0;u<i;u++)for(var l=0;l<4;l++)o[(s*i+u)*4+l]=r[(s*2*e+u*2)*4+l];return{data:o,width:i,height:a}}function fp(t,r,e){var n=e.removedProps,i=n===void 0?{}:n,a=e.deprecatedProps,o=a===void 0?{}:a,s=e.replacedProps,u=s===void 0?{}:s;for(var l in i)if(l in r){var f=i[l],c=f?"".concat(t,".").concat(i[l]):"N/A";ne.removed("".concat(t,".").concat(l),c)()}for(var p in o)if(p in r){var d=o[p];ne.deprecated("".concat(t,".").concat(p),"".concat(t,".").concat(d))()}var v=null;for(var m in u)if(m in r){var g=u[m];ne.deprecated("".concat(t,".").concat(m),"".concat(t,".").concat(g))(),v=v||Object.assign({},r),v[g]=r[m],delete v[m]}return v||r}var mve={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},gve={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}},kr=function(){function t(){var r=this;(0,JB.default)(this,t);for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];n.forEach(function(a){return r._assign(a)}),Object.freeze(this)}return(0,QB.default)(t,[{key:"toString",value:function(){return JSON.stringify(this)}},{key:"BYTES_PER_ELEMENT",get:function(){return t.getBytesPerElement(this)}},{key:"BYTES_PER_VERTEX",get:function(){return t.getBytesPerVertex(this)}},{key:"_assign",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e=fp("Accessor",e,gve),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this}}],[{key:"getBytesPerElement",value:function(e){var n=lo(e.type||5126);return n.BYTES_PER_ELEMENT}},{key:"getBytesPerVertex",value:function(e){Z(e.size);var n=lo(e.type||5126);return n.BYTES_PER_ELEMENT*e.size}},{key:"resolve",value:function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return(0,ZB.default)(t,[mve].concat(n))}}]),t}();function yve(t){var r=_ve();return function(){var n=(0,hA.default)(t),i;if(r){var a=(0,hA.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,a3.default)(this,i)}}function _ve(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var e3=10,o3={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},bve={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:o3},xve={removedProps:o3},xe=function(t,r){(0,i3.default)(n,t);var e=yve(n);function n(i){var a;(0,t3.default)(this,n);var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return a=e.call(this,i,o),a.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),a.target=o.target||(a.gl.webgl2?36662:34962),a.initialize(o),Object.seal((0,n3.default)(a)),a}return(0,r3.default)(n,[{key:r,get:function(){return"Buffer"}},{key:"getElementCount",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/kr.getBytesPerElement(a))}},{key:"getVertexCount",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/kr.getBytesPerVertex(a))}},{key:"initialize",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ArrayBuffer.isView(a)&&(a={data:a}),Number.isFinite(a)&&(a={byteLength:a}),a=fp("Buffer",a,bve),this.usage=a.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},a,a.accessor)),a.data?this._setData(a.data,a.offset,a.byteLength):this._setByteLength(a.byteLength||0),this}},{key:"setProps",value:function(a){return a=fp("Buffer",a,xve),"accessor"in a&&this.setAccessor(a.accessor),this}},{key:"setAccessor",value:function(a){return a=Object.assign({},a),delete a.buffer,this.accessor=new kr(a),this}},{key:"reallocate",value:function(a){return a>this.byteLength?(this._setByteLength(a),!0):(this.bytesUsed=a,!1)}},{key:"setData",value:function(a){return this.initialize(a)}},{key:"subData",value:function(a){ArrayBuffer.isView(a)&&(a={data:a});var o=a,s=o.data,u=o.offset,l=u===void 0?0:u,f=o.srcOffset,c=f===void 0?0:f,p=a.byteLength||a.length;Z(s);var d=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(d,this.handle),c!==0||p!==void 0?(yt(this.gl),this.gl.bufferSubData(this.target,l,s,c,p)):this.gl.bufferSubData(d,l,s),this.gl.bindBuffer(d,null),this.debugData=null,this._inferType(s),this}},{key:"copyData",value:function(a){var o=a.sourceBuffer,s=a.readOffset,u=s===void 0?0:s,l=a.writeOffset,f=l===void 0?0:l,c=a.size,p=this.gl;return yt(p),p.bindBuffer(36662,o.handle),p.bindBuffer(36663,this.handle),p.copyBufferSubData(36662,36663,u,f,c),p.bindBuffer(36662,null),p.bindBuffer(36663,null),this.debugData=null,this}},{key:"getData",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=a.dstData,s=o===void 0?null:o,u=a.srcByteOffset,l=u===void 0?0:u,f=a.dstOffset,c=f===void 0?0:f,p=a.length,d=p===void 0?0:p;yt(this.gl);var v=lo(this.accessor.type||5126,{clamped:!1}),m=this._getAvailableElementCount(l),g=c,y,_;s?(_=s.length,y=_-g):(y=Math.min(m,d||m),_=g+y);var b=Math.min(m,y);return d=d||b,Z(d<=b),s=s||new v(_),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,l,s,c,d),this.gl.bindBuffer(36662,null),s}},{key:"bind",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=a.target,s=o===void 0?this.target:o,u=a.index,l=u===void 0?this.accessor&&this.accessor.index:u,f=a.offset,c=f===void 0?0:f,p=a.size;return s===35345||s===35982?p!==void 0?this.gl.bindBufferRange(s,l,this.handle,c,p):(Z(c===0),this.gl.bindBufferBase(s,l,this.handle)):this.gl.bindBuffer(s,this.handle),this}},{key:"unbind",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=a.target,s=o===void 0?this.target:o,u=a.index,l=u===void 0?this.accessor&&this.accessor.index:u,f=s===35345||s===35982;return f?this.gl.bindBufferBase(s,l,null):this.gl.bindBuffer(s,null),this}},{key:"getDebugData",value:function(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(e3,this.byteLength)}),{data:this.debugData,changed:!0})}},{key:"invalidateDebugData",value:function(){this.debugData=null}},{key:"_setData",value:function(a){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:a.byteLength+o;Z(ArrayBuffer.isView(a)),this._trackDeallocatedMemory();var u=this._getTarget();this.gl.bindBuffer(u,this.handle),this.gl.bufferData(u,s,this.usage),this.gl.bufferSubData(u,o,a),this.gl.bindBuffer(u,null),this.debugData=a.slice(0,e3),this.bytesUsed=s,this._trackAllocatedMemory(s);var l=lp(a);return Z(l),this.setAccessor(new kr(this.accessor,{type:l})),this}},{key:"_setByteLength",value:function(a){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.usage;Z(a>=0),this._trackDeallocatedMemory();var s=a;a===0&&(s=new Float32Array(0));var u=this._getTarget();return this.gl.bindBuffer(u,this.handle),this.gl.bufferData(u,s,o),this.gl.bindBuffer(u,null),this.usage=o,this.debugData=null,this.bytesUsed=a,this._trackAllocatedMemory(a),this}},{key:"_getTarget",value:function(){return this.gl.webgl2?36663:this.target}},{key:"_getAvailableElementCount",value:function(a){var o=lo(this.accessor.type||5126,{clamped:!1}),s=a/o.BYTES_PER_ELEMENT;return this.getElementCount()-s}},{key:"_inferType",value:function(a){this.accessor.type||this.setAccessor(new kr(this.accessor,{type:lp(a)}))}},{key:"_createHandle",value:function(){return this.gl.createBuffer()}},{key:"_deleteHandle",value:function(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}},{key:"_getParameter",value:function(a){this.gl.bindBuffer(this.target,this.handle);var o=this.gl.getBufferParameter(this.target,a);return this.gl.bindBuffer(this.target,null),o}},{key:"type",get:function(){return ne.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}},{key:"bytes",get:function(){return ne.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}},{key:"setByteLength",value:function(a){return ne.deprecated("setByteLength","reallocate")(),this.reallocate(a)}},{key:"updateAccessor",value:function(a){return ne.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new kr(this.accessor,a),this}}]),n}(hr,Symbol.toStringTag);var ot=h(B());var Qn,Br,ki,$v=(Qn={},(0,ot.default)(Qn,6407,{dataFormat:6407,types:[5121,33635]}),(0,ot.default)(Qn,6408,{dataFormat:6408,types:[5121,32819,32820]}),(0,ot.default)(Qn,6406,{dataFormat:6406,types:[5121]}),(0,ot.default)(Qn,6409,{dataFormat:6409,types:[5121]}),(0,ot.default)(Qn,6410,{dataFormat:6410,types:[5121]}),(0,ot.default)(Qn,33326,{dataFormat:6403,types:[5126],gl2:!0}),(0,ot.default)(Qn,33328,{dataFormat:33319,types:[5126],gl2:!0}),(0,ot.default)(Qn,34837,{dataFormat:6407,types:[5126],gl2:!0}),(0,ot.default)(Qn,34836,{dataFormat:6408,types:[5126],gl2:!0}),Qn),Xv=(Br={},(0,ot.default)(Br,6403,1),(0,ot.default)(Br,36244,1),(0,ot.default)(Br,33319,2),(0,ot.default)(Br,33320,2),(0,ot.default)(Br,6407,3),(0,ot.default)(Br,36248,3),(0,ot.default)(Br,6408,4),(0,ot.default)(Br,36249,4),(0,ot.default)(Br,6402,1),(0,ot.default)(Br,34041,1),(0,ot.default)(Br,6406,1),(0,ot.default)(Br,6409,1),(0,ot.default)(Br,6410,2),Br),qv=(ki={},(0,ot.default)(ki,5126,4),(0,ot.default)(ki,5125,4),(0,ot.default)(ki,5124,4),(0,ot.default)(ki,5123,2),(0,ot.default)(ki,5122,2),(0,ot.default)(ki,5131,2),(0,ot.default)(ki,5120,1),(0,ot.default)(ki,5121,1),ki);function s3(t,r){var e=$v[r];if(!e)return!1;if(e.gl1===void 0&&e.gl2===void 0)return!0;var n=ce(t)&&e.gl2||e.gl1;return typeof n=="string"?t.getExtension(n):n}function u3(t,r){var e=$v[r];switch(e&&e.types[0]){case 5126:return t.getExtension("OES_texture_float_linear");case 5131:return t.getExtension("OES_texture_half_float_linear");default:return!0}}function Ave(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=Sve(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function Sve(t,r){if(t){if(typeof t=="string")return l3(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return l3(t,r)}}function l3(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function Tve(t){var r=wve();return function(){var n=(0,dA.default)(t),i;if(r){var a=(0,dA.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,v3.default)(this,i)}}function wve(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Pve=[9729,9728],f3=globalThis.WebGLBuffer||function(){},fn=function(t,r){(0,d3.default)(n,t);var e=Tve(n);function n(i,a){var o;(0,p3.default)(this,n);var s=a.id,u=s===void 0?Ye("texture"):s,l=a.handle,f=a.target;return o=e.call(this,i,{id:u,handle:l}),o.target=f,o.textureUnit=void 0,o.loaded=!1,o.width=void 0,o.height=void 0,o.depth=void 0,o.format=void 0,o.type=void 0,o.dataFormat=void 0,o.border=void 0,o.textureUnit=void 0,o.mipmaps=void 0,o}return(0,h3.default)(n,[{key:r,get:function(){return"Texture"}},{key:"toString",value:function(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}},{key:"initialize",value:function(){var a=this,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=o.data;if(s instanceof Promise)return s.then(function($){return a.initialize(Object.assign({},o,{pixels:$,data:$}))}),this;var u=typeof HTMLVideoElement<"u"&&s instanceof HTMLVideoElement;if(u&&s.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,s.addEventListener("loadeddata",function(){return a.initialize(o)}),this;var l=o.pixels,f=l===void 0?null:l,c=o.format,p=c===void 0?6408:c,d=o.border,v=d===void 0?0:d,m=o.recreate,g=m===void 0?!1:m,y=o.parameters,_=y===void 0?{}:y,b=o.pixelStore,x=b===void 0?{}:b,A=o.textureUnit,S=A===void 0?void 0:A;s||(s=f);var P=o.width,O=o.height,C=o.dataFormat,T=o.type,I=o.compressed,R=I===void 0?!1:I,V=o.mipmaps,z=V===void 0?!0:V,k=o.depth,G=k===void 0?0:k,U=this._deduceParameters({format:p,type:T,dataFormat:C,compressed:R,data:s,width:P,height:O});return P=U.width,O=U.height,R=U.compressed,C=U.dataFormat,T=U.type,this.width=P,this.height=O,this.depth=G,this.format=p,this.type=T,this.dataFormat=C,this.border=v,this.textureUnit=S,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),z&&this._isNPOT()&&(ne.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),z=!1,this._updateForNPOT(_)),this.mipmaps=z,this.setImageData({data:s,width:P,height:O,depth:G,format:p,type:T,dataFormat:C,border:v,mipmaps:z,parameters:x,compressed:R}),z&&this.generateMipmap(),this.setParameters(_),g&&(this.data=s),u&&(this._video={video:s,parameters:_,lastTime:s.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?s.currentTime:-1}),this}},{key:"update",value:function(){if(this._video){var a=this._video,o=a.video,s=a.parameters,u=a.lastTime;if(u===o.currentTime||o.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:o,parameters:s}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=o.currentTime}}},{key:"resize",value:function(a){var o=a.height,s=a.width,u=a.mipmaps,l=u===void 0?!1:u;return s!==this.width||o!==this.height?this.initialize({width:s,height:o,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:l}):this}},{key:"generateMipmap",value:function(){var a=this,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isNPOT()?(ne.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),Le(this.gl,o,function(){a.gl.generateMipmap(a.target)}),this.gl.bindTexture(this.target,null),this)}},{key:"setImageData",value:function(a){this._trackDeallocatedMemory("Texture");var o=a.target,s=o===void 0?this.target:o,u=a.pixels,l=u===void 0?null:u,f=a.level,c=f===void 0?0:f,p=a.format,d=p===void 0?this.format:p,v=a.border,m=v===void 0?this.border:v,g=a.offset,y=g===void 0?0:g,_=a.parameters,b=_===void 0?{}:_,x=a.data,A=x===void 0?null:x,S=a.type,P=S===void 0?this.type:S,O=a.width,C=O===void 0?this.width:O,T=a.height,I=T===void 0?this.height:T,R=a.dataFormat,V=R===void 0?this.dataFormat:R,z=a.compressed,k=z===void 0?!1:z;A||(A=l);var G=this._deduceParameters({format:d,type:P,dataFormat:V,compressed:k,data:A,width:C,height:I});P=G.type,V=G.dataFormat,k=G.compressed,C=G.width,I=G.height;var U=this.gl;U.bindTexture(this.target,this.handle);var $=null,H=this._getDataType({data:A,compressed:k});A=H.data,$=H.dataType;var Q,ie=0;if(Le(this.gl,b,function(){switch($){case"null":U.texImage2D(s,c,d,C,I,m,V,P,A);break;case"typed-array":U.texImage2D(s,c,d,C,I,m,V,P,A,y);break;case"buffer":Q=yt(U),Q.bindBuffer(35052,A.handle||A),Q.texImage2D(s,c,d,C,I,m,V,P,y),Q.bindBuffer(35052,null);break;case"browser-object":ce(U)?U.texImage2D(s,c,d,C,I,m,V,P,A):U.texImage2D(s,c,d,V,P,A);break;case"compressed":var Oe=Ave(A.entries()),Xe;try{for(Oe.s();!(Xe=Oe.n()).done;){var ge=(0,c3.default)(Xe.value,2),qe=ge[0],Ie=ge[1];U.compressedTexImage2D(s,qe,Ie.format,Ie.width,Ie.height,m,Ie.data),ie+=Ie.levelSize}}catch(Et){Oe.e(Et)}finally{Oe.f()}break;default:Z(!1,"Unknown image data type")}}),$==="compressed")this._trackAllocatedMemory(ie,"Texture");else if(A&&A.byteLength)this._trackAllocatedMemory(A.byteLength,"Texture");else{var fe=Xv[this.dataFormat]||4,Ae=qv[this.type]||1;this._trackAllocatedMemory(this.width*this.height*fe*Ae,"Texture")}return this.loaded=!0,this}},{key:"setSubImageData",value:function(a){var o=this,s=a.target,u=s===void 0?this.target:s,l=a.pixels,f=l===void 0?null:l,c=a.data,p=c===void 0?null:c,d=a.x,v=d===void 0?0:d,m=a.y,g=m===void 0?0:m,y=a.width,_=y===void 0?this.width:y,b=a.height,x=b===void 0?this.height:b,A=a.level,S=A===void 0?0:A,P=a.format,O=P===void 0?this.format:P,C=a.type,T=C===void 0?this.type:C,I=a.dataFormat,R=I===void 0?this.dataFormat:I,V=a.compressed,z=V===void 0?!1:V,k=a.offset,G=k===void 0?0:k,U=a.border,$=U===void 0?this.border:U,H=a.parameters,Q=H===void 0?{}:H,ie=this._deduceParameters({format:O,type:T,dataFormat:R,compressed:z,data:p,width:_,height:x});if(T=ie.type,R=ie.dataFormat,z=ie.compressed,_=ie.width,x=ie.height,Z(this.depth===0,"texSubImage not supported for 3D textures"),p||(p=f),p&&p.data){var fe=p;p=fe.data,_=fe.shape[0],x=fe.shape[1]}p instanceof xe&&(p=p.handle),this.gl.bindTexture(this.target,this.handle),Le(this.gl,Q,function(){if(z)o.gl.compressedTexSubImage2D(u,S,v,g,_,x,O,p);else if(p===null)o.gl.texSubImage2D(u,S,v,g,_,x,R,T,null);else if(ArrayBuffer.isView(p))o.gl.texSubImage2D(u,S,v,g,_,x,R,T,p,G);else if(p instanceof f3){var Ae=yt(o.gl);Ae.bindBuffer(35052,p),Ae.texSubImage2D(u,S,v,g,_,x,R,T,G),Ae.bindBuffer(35052,null)}else if(ce(o.gl)){var Oe=yt(o.gl);Oe.texSubImage2D(u,S,v,g,_,x,R,T,p)}else o.gl.texSubImage2D(u,S,v,g,R,T,p)}),this.gl.bindTexture(this.target,null)}},{key:"copyFramebuffer",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ne.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}},{key:"getActiveUnit",value:function(){return this.gl.getParameter(34016)-33984}},{key:"bind",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit,o=this.gl;return a!==void 0&&(this.textureUnit=a,o.activeTexture(33984+a)),o.bindTexture(this.target,this.handle),a}},{key:"unbind",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit,o=this.gl;return a!==void 0&&(this.textureUnit=a,o.activeTexture(33984+a)),o.bindTexture(this.target,null),a}},{key:"_getDataType",value:function(a){var o=a.data,s=a.compressed,u=s===void 0?!1:s;return u?{data:o,dataType:"compressed"}:o===null?{data:o,dataType:"null"}:ArrayBuffer.isView(o)?{data:o,dataType:"typed-array"}:o instanceof xe?{data:o.handle,dataType:"buffer"}:o instanceof f3?{data:o,dataType:"buffer"}:{data:o,dataType:"browser-object"}}},{key:"_deduceParameters",value:function(a){var o=a.format,s=a.data,u=a.width,l=a.height,f=a.dataFormat,c=a.type,p=a.compressed,d=$v[o];f=f||d&&d.dataFormat,c=c||d&&d.types[0],p=p||d&&d.compressed;var v=this._deduceImageSize(s,u,l);return u=v.width,l=v.height,{dataFormat:f,type:c,compressed:p,width:u,height:l,format:o,data:s}}},{key:"_deduceImageSize",value:function(a,o,s){var u;return typeof ImageData<"u"&&a instanceof ImageData?u={width:a.width,height:a.height}:typeof HTMLImageElement<"u"&&a instanceof HTMLImageElement?u={width:a.naturalWidth,height:a.naturalHeight}:typeof HTMLCanvasElement<"u"&&a instanceof HTMLCanvasElement?u={width:a.width,height:a.height}:typeof ImageBitmap<"u"&&a instanceof ImageBitmap?u={width:a.width,height:a.height}:typeof HTMLVideoElement<"u"&&a instanceof HTMLVideoElement?u={width:a.videoWidth,height:a.videoHeight}:a?u={width:o,height:s}:u={width:o>=0?o:1,height:s>=0?s:1},Z(u,"Could not deduced texture size"),Z(o===void 0||u.width===o,"Deduced texture width does not match supplied width"),Z(s===void 0||u.height===s,"Deduced texture height does not match supplied height"),u}},{key:"_createHandle",value:function(){return this.gl.createTexture()}},{key:"_deleteHandle",value:function(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}},{key:"_getParameter",value:function(a){switch(a){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);var o=this.gl.getTexParameter(this.target,a);return this.gl.bindTexture(this.target,null),o}}},{key:"_setParameter",value:function(a,o){switch(this.gl.bindTexture(this.target,this.handle),o=this._getNPOTParam(a,o),a){case 33082:case 33083:this.gl.texParameterf(this.handle,a,o);break;case 4096:case 4097:Z(!1);break;default:this.gl.texParameteri(this.target,a,o);break}return this.gl.bindTexture(this.target,null),this}},{key:"_isNPOT",value:function(){return ce(this.gl)||!this.width||!this.height?!1:!pA(this.width)||!pA(this.height)}},{key:"_updateForNPOT",value:function(a){a[this.gl.TEXTURE_MIN_FILTER]===void 0&&(a[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),a[this.gl.TEXTURE_WRAP_S]===void 0&&(a[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),a[this.gl.TEXTURE_WRAP_T]===void 0&&(a[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}},{key:"_getNPOTParam",value:function(a,o){if(this._isNPOT())switch(a){case 10241:Pve.indexOf(o)===-1&&(o=9729);break;case 10242:case 10243:o!==33071&&(o=33071);break;default:break}return o}}],[{key:"isSupported",value:function(a){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=o.format,u=o.linearFiltering,l=!0;return s&&(l=l&&s3(a,s),l=l&&(!u||u3(a,s))),l}}]),n}(hr,Symbol.toStringTag);var Ove="";function m3(t,r){return Z(typeof t=="string"),t=Ove+t,new Promise(function(e,n){try{var i=new Image;i.onload=function(){return e(i)},i.onerror=function(){return n(new Error("Could not load image ".concat(t,".")))},i.crossOrigin=r&&r.crossOrigin||"anonymous",i.src=t}catch(a){n(a)}})}function Eve(t){var r=Cve();return function(){var n=(0,vA.default)(t),i;if(r){var a=(0,vA.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,x3.default)(this,i)}}function Cve(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var we=function(t,r){(0,b3.default)(n,t);var e=Eve(n);function n(i){var a;(0,g3.default)(this,n);var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return ha(i),(o instanceof Promise||typeof o=="string")&&(o={data:o}),typeof o.data=="string"&&(o=Object.assign({},o,{data:m3(o.data)})),a=e.call(this,i,Object.assign({},o,{target:3553})),a.initialize(o),Object.seal((0,_3.default)(a)),a}return(0,y3.default)(n,[{key:r,get:function(){return"Texture2D"}}],[{key:"isSupported",value:function(a,o){return fn.isSupported(a,o)}}]),n}(fn,Symbol.toStringTag);var A3=h(ye()),S3=h(L()),T3=h(N()),w3=h(be()),P3=h(Y()),O3=h(K()),mA=h(q()),gA=h(ve());function Mve(t){var r=Ive();return function(){var n=(0,mA.default)(t),i;if(r){var a=(0,mA.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,O3.default)(this,i)}}function Ive(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var yA=[34069,34070,34071,34072,34073,34074],_s=function(t,r){(0,P3.default)(n,t);var e=Mve(n);function n(i){var a;(0,S3.default)(this,n);var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return ha(i),a=e.call(this,i,Object.assign({},o,{target:34067})),a.initialize(o),Object.seal((0,w3.default)(a)),a}return(0,T3.default)(n,[{key:r,get:function(){return"TextureCube"}},{key:"initialize",value:function(){var a=this,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=o.mipmaps,u=s===void 0?!0:s,l=o.parameters,f=l===void 0?{}:l;return this.opts=o,this.setCubeMapImageData(o).then(function(){a.loaded=!0,u&&a.generateMipmap(o),a.setParameters(f)}),this}},{key:"subImage",value:function(a){var o=a.face,s=a.data,u=a.x,l=u===void 0?0:u,f=a.y,c=f===void 0?0:f,p=a.mipmapLevel,d=p===void 0?0:p;return this._subImage({target:o,data:s,x:l,y:c,mipmapLevel:d})}},{key:"setCubeMapImageData",value:function(){var i=(0,A3.default)(gA.default.mark(function o(s){var u=this,l,f,c,p,d,v,m,g,y,_,b,x,A;return gA.default.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return l=s.width,f=s.height,c=s.pixels,p=s.data,d=s.border,v=d===void 0?0:d,m=s.format,g=m===void 0?6408:m,y=s.type,_=y===void 0?5121:y,b=this.gl,x=c||p,P.next=5,Promise.all(yA.map(function(O){var C=x[O];return Promise.all(Array.isArray(C)?C:[C])}));case 5:A=P.sent,this.bind(),yA.forEach(function(O,C){A[C].length>1&&u.opts.mipmaps!==!1&&ne.warn("".concat(u.id," has mipmap and multiple LODs."))(),A[C].forEach(function(T,I){l&&f?b.texImage2D(O,I,g,l,f,v,g,_,T):b.texImage2D(O,I,g,g,_,T)})}),this.unbind();case 9:case"end":return P.stop()}},o,this)}));function a(o){return i.apply(this,arguments)}return a}()},{key:"setImageDataForFace",value:function(a){var o=this,s=a.face,u=a.width,l=a.height,f=a.pixels,c=a.data,p=a.border,d=p===void 0?0:p,v=a.format,m=v===void 0?6408:v,g=a.type,y=g===void 0?5121:g,_=this.gl,b=f||c;return this.bind(),b instanceof Promise?b.then(function(x){return o.setImageDataForFace(Object.assign({},a,{face:s,data:x,pixels:x}))}):this.width||this.height?_.texImage2D(s,0,m,u,l,d,m,y,b):_.texImage2D(s,0,m,m,y,b),this}}]),n}(fn,Symbol.toStringTag);_s.FACES=yA;var E3=h(L()),C3=h(N()),M3=h(be()),I3=h(Y()),R3=h(K()),_A=h(q());function Rve(t){var r=Lve();return function(){var n=(0,_A.default)(t),i;if(r){var a=(0,_A.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,R3.default)(this,i)}}function Lve(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ol=function(t,r){(0,I3.default)(n,t);var e=Rve(n);function n(i){var a;(0,E3.default)(this,n);var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return yt(i),o=Object.assign({depth:1},o,{target:32879,unpackFlipY:!1}),a=e.call(this,i,o),a.initialize(o),Object.seal((0,M3.default)(a)),a}return(0,C3.default)(n,[{key:r,get:function(){return"Texture3D"}},{key:"setImageData",value:function(a){var o=this,s=a.level,u=s===void 0?0:s,l=a.dataFormat,f=l===void 0?6408:l,c=a.width,p=a.height,d=a.depth,v=d===void 0?1:d,m=a.border,g=m===void 0?0:m,y=a.format,_=a.type,b=_===void 0?5121:_,x=a.offset,A=x===void 0?0:x,S=a.data,P=a.parameters,O=P===void 0?{}:P;if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),Le(this.gl,O,function(){ArrayBuffer.isView(S)&&o.gl.texImage3D(o.target,u,f,c,p,v,g,y,b,S),S instanceof xe&&(o.gl.bindBuffer(35052,S.handle),o.gl.texImage3D(o.target,u,f,c,p,v,g,y,b,A))}),S&&S.byteLength)this._trackAllocatedMemory(S.byteLength,"Texture");else{var C=Xv[this.dataFormat]||4,T=qv[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*C*T,"Texture")}return this.loaded=!0,this}}],[{key:"isSupported",value:function(a){return ce(a)}}]),n}(fn,Symbol.toStringTag);var cp=h(B()),Z3=h(me()),J3=h(L()),Q3=h(N()),eF=h(be()),tF=h(Ee()),rF=h(Y()),nF=h(K()),Zv=h(q());var L3=h(L()),k3=h(N()),B3=h(be()),F3=h(Y()),D3=h(K()),xA=h(q());var De=h(B()),Be,bs="EXT_color_buffer_float",bA=(Be={},(0,De.default)(Be,33189,{bpp:2}),(0,De.default)(Be,33190,{gl2:!0,bpp:3}),(0,De.default)(Be,36012,{gl2:!0,bpp:4}),(0,De.default)(Be,36168,{bpp:1}),(0,De.default)(Be,34041,{bpp:4}),(0,De.default)(Be,35056,{gl2:!0,bpp:4}),(0,De.default)(Be,36013,{gl2:!0,bpp:5}),(0,De.default)(Be,32854,{bpp:2}),(0,De.default)(Be,36194,{bpp:2}),(0,De.default)(Be,32855,{bpp:2}),(0,De.default)(Be,33321,{gl2:!0,bpp:1}),(0,De.default)(Be,33330,{gl2:!0,bpp:1}),(0,De.default)(Be,33329,{gl2:!0,bpp:1}),(0,De.default)(Be,33332,{gl2:!0,bpp:2}),(0,De.default)(Be,33331,{gl2:!0,bpp:2}),(0,De.default)(Be,33334,{gl2:!0,bpp:4}),(0,De.default)(Be,33333,{gl2:!0,bpp:4}),(0,De.default)(Be,33323,{gl2:!0,bpp:2}),(0,De.default)(Be,33336,{gl2:!0,bpp:2}),(0,De.default)(Be,33335,{gl2:!0,bpp:2}),(0,De.default)(Be,33338,{gl2:!0,bpp:4}),(0,De.default)(Be,33337,{gl2:!0,bpp:4}),(0,De.default)(Be,33340,{gl2:!0,bpp:8}),(0,De.default)(Be,33339,{gl2:!0,bpp:8}),(0,De.default)(Be,32849,{gl2:!0,bpp:3}),(0,De.default)(Be,32856,{gl2:!0,bpp:4}),(0,De.default)(Be,32857,{gl2:!0,bpp:4}),(0,De.default)(Be,36220,{gl2:!0,bpp:4}),(0,De.default)(Be,36238,{gl2:!0,bpp:4}),(0,De.default)(Be,36975,{gl2:!0,bpp:4}),(0,De.default)(Be,36214,{gl2:!0,bpp:8}),(0,De.default)(Be,36232,{gl2:!0,bpp:8}),(0,De.default)(Be,36226,{gl2:!0,bpp:16}),(0,De.default)(Be,36208,{gl2:!0,bpp:16}),(0,De.default)(Be,33325,{gl2:bs,bpp:2}),(0,De.default)(Be,33327,{gl2:bs,bpp:4}),(0,De.default)(Be,34842,{gl2:bs,bpp:8}),(0,De.default)(Be,33326,{gl2:bs,bpp:4}),(0,De.default)(Be,33328,{gl2:bs,bpp:8}),(0,De.default)(Be,34836,{gl2:bs,bpp:16}),(0,De.default)(Be,35898,{gl2:bs,bpp:4}),Be);function kve(t){var r=Bve();return function(){var n=(0,xA.default)(t),i;if(r){var a=(0,xA.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,D3.default)(this,i)}}function Bve(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Fve(t,r,e){var n=e[r];if(!n)return!1;var i=ce(t)&&n.gl2||n.gl1;return typeof i=="string"?t.getExtension(i):i}var Fr=function(t,r){(0,F3.default)(n,t);var e=kve(n);function n(i){var a;(0,L3.default)(this,n);var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return a=e.call(this,i,o),a.initialize(o),Object.seal((0,B3.default)(a)),a}return(0,k3.default)(n,[{key:r,get:function(){return"Renderbuffer"}},{key:"initialize",value:function(a){var o=a.format,s=a.width,u=s===void 0?1:s,l=a.height,f=l===void 0?1:l,c=a.samples,p=c===void 0?0:c;return Z(o,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),p!==0&&ce(this.gl)?this.gl.renderbufferStorageMultisample(36161,p,o,u,f):this.gl.renderbufferStorage(36161,o,u,f),this.format=o,this.width=u,this.height=f,this.samples=p,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*bA[this.format].bpp),this}},{key:"resize",value:function(a){var o=a.width,s=a.height;return o!==this.width||s!==this.height?this.initialize({width:o,height:s,format:this.format,samples:this.samples}):this}},{key:"_createHandle",value:function(){return this.gl.createRenderbuffer()}},{key:"_deleteHandle",value:function(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}},{key:"_bindHandle",value:function(a){this.gl.bindRenderbuffer(36161,a)}},{key:"_syncHandle",value:function(a){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}},{key:"_getParameter",value:function(a){this.gl.bindRenderbuffer(36161,this.handle);var o=this.gl.getRenderbufferParameter(36161,a);return o}}],[{key:"isSupported",value:function(a){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{format:null},s=o.format;return!s||Fve(a,s,bA)}},{key:"getSamplesForFormat",value:function(a,o){var s=o.format;return a.getInternalformatParameter(36161,s,32937)}}]),n}(hr,Symbol.toStringTag);var z3=h(me());var Dve=256,Nve=1024,jve=16384,N3=6144,j3=6145,U3=6146,G3=34041,V3="clear: bad arguments";function wn(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=r.framebuffer,n=e===void 0?null:e,i=r.color,a=i===void 0?null:i,o=r.depth,s=o===void 0?null:o,u=r.stencil,l=u===void 0?null:u,f={};n&&(f.framebuffer=n);var c=0;a&&(c|=jve,a!==!0&&(f.clearColor=a)),s&&(c|=Dve,s!==!0&&(f.clearDepth=s)),l&&(c|=Nve,s!==!0&&(f.clearStencil=s)),Z(c!==0,V3),Le(t,f,function(){t.clear(c)})}function AA(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=r.framebuffer,n=e===void 0?null:e,i=r.buffer,a=i===void 0?N3:i,o=r.drawBuffer,s=o===void 0?0:o,u=r.value,l=u===void 0?[0,0,0,0]:u;yt(t),Le(t,{framebuffer:n},function(){switch(a){case N3:switch(l.constructor){case Int32Array:t.clearBufferiv(a,s,l);break;case Uint32Array:t.clearBufferuiv(a,s,l);break;case Float32Array:default:t.clearBufferfv(a,s,l)}break;case j3:t.clearBufferfv(j3,0,[l]);break;case U3:t.clearBufferiv(U3,0,[l]);break;case G3:var f=(0,z3.default)(l,2),c=f[0],p=f[1];t.clearBufferfi(G3,0,c,p);break;default:Z(!1,V3)}})}function SA(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return Z(!1),0}}function H3(t){switch(t){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return Z(!1),0}}function ei(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=r.sourceX,n=e===void 0?0:e,i=r.sourceY,a=i===void 0?0:i,o=r.sourceFormat,s=o===void 0?6408:o,u=r.sourceAttachment,l=u===void 0?36064:u,f=r.target,c=f===void 0?null:f,p=r.sourceWidth,d=r.sourceHeight,v=r.sourceType,m=TA(t),g=m.framebuffer,y=m.deleteFramebuffer;Z(g);var _=g.gl,b=g.handle,x=g.attachments;p=p||g.width,d=d||g.height,l===36064&&b===null&&(l=1028),Z(x[l]),v=v||x[l].type,c=Uve(c,v,s,p,d),v=v||lp(c);var A=_.bindFramebuffer(36160,b);return _.readPixels(n,a,p,d,s,v,c),_.bindFramebuffer(36160,A||null),y&&g.delete(),c}function va(t,r){var e=r.sourceX,n=e===void 0?0:e,i=r.sourceY,a=i===void 0?0:i,o=r.sourceFormat,s=o===void 0?6408:o,u=r.target,l=u===void 0?null:u,f=r.targetByteOffset,c=f===void 0?0:f,p=r.sourceWidth,d=r.sourceHeight,v=r.sourceType,m=TA(t),g=m.framebuffer,y=m.deleteFramebuffer;Z(g),p=p||g.width,d=d||g.height;var _=yt(g.gl);if(v=v||(l?l.type:5121),!l){var b=SA(s),x=H3(v),A=c+p*d*b*x;l=new xe(_,{byteLength:A,accessor:{type:v,size:b}})}return l.bind({target:35051}),Le(_,{framebuffer:g},function(){_.readPixels(n,a,p,d,s,v,c)}),l.unbind({target:35051}),y&&g.delete(),l}function Yv(t){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=r.sourceAttachment,n=e===void 0?36064:e,i=r.targetMaxHeight,a=i===void 0?Number.MAX_SAFE_INTEGER:i,o=ei(t,{sourceAttachment:n}),s=t.width,u=t.height;u>a;){var l=KB({data:o,width:s,height:u});o=l.data,s=l.width,u=l.height}YB({data:o,width:s,height:u});var f=document.createElement("canvas");f.width=s,f.height=u;var c=f.getContext("2d"),p=c.createImageData(s,u);return p.data.set(o),c.putImageData(p,0,0),f.toDataURL()}function sl(t,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=e.sourceX,i=n===void 0?0:n,a=e.sourceY,o=a===void 0?0:a,s=e.targetMipmaplevel,u=s===void 0?0:s,l=e.targetInternalFormat,f=l===void 0?6408:l,c=e.targetX,p=e.targetY,d=e.targetZ,v=e.width,m=e.height,g=TA(t),y=g.framebuffer,_=g.deleteFramebuffer;Z(y);var b=y.gl,x=y.handle,A=typeof c<"u"||typeof p<"u"||typeof d<"u";c=c||0,p=p||0,d=d||0;var S=b.bindFramebuffer(36160,x);Z(r);var P=null;if(r instanceof fn&&(P=r,v=Number.isFinite(v)?v:P.width,m=Number.isFinite(m)?m:P.height,P.bind(0),r=P.target),!A)b.copyTexImage2D(r,u,f,i,o,v,m,0);else switch(r){case 3553:case 34067:b.copyTexSubImage2D(r,u,c,p,i,o,v,m);break;case 35866:case 32879:var O=yt(b);O.copyTexSubImage3D(r,u,c,p,d,i,o,v,m);break;default:}return P&&P.unbind(),b.bindFramebuffer(36160,S||null),_&&y.delete(),P}function TA(t){return t instanceof Re?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:W3(t),deleteFramebuffer:!0}}function Uve(t,r,e,n,i){if(t)return t;r=r||5121;var a=lo(r,{clamped:!1}),o=SA(e);return new a(n*i*o)}var Mt=h(B());var Ct,Se={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};function Gve(t){var r=new we(t,{format:6408,type:5126,dataFormat:6408}),e=new Re(t,{id:"test-framebuffer",check:!1,attachments:(0,Mt.default)({},36064,r)}),n=e.getStatus();return r.delete(),e.delete(),n===36053}var wA=(Ct={},(0,Mt.default)(Ct,Se.WEBGL2,[!1,!0]),(0,Mt.default)(Ct,Se.VERTEX_ARRAY_OBJECT,["OES_vertex_array_object",!0]),(0,Mt.default)(Ct,Se.TIMER_QUERY,["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"]),(0,Mt.default)(Ct,Se.INSTANCED_RENDERING,["ANGLE_instanced_arrays",!0]),(0,Mt.default)(Ct,Se.MULTIPLE_RENDER_TARGETS,["WEBGL_draw_buffers",!0]),(0,Mt.default)(Ct,Se.ELEMENT_INDEX_UINT32,["OES_element_index_uint",!0]),(0,Mt.default)(Ct,Se.BLEND_EQUATION_MINMAX,["EXT_blend_minmax",!0]),(0,Mt.default)(Ct,Se.FLOAT_BLEND,["EXT_float_blend"]),(0,Mt.default)(Ct,Se.COLOR_ENCODING_SRGB,["EXT_sRGB",!0]),(0,Mt.default)(Ct,Se.TEXTURE_DEPTH,["WEBGL_depth_texture",!0]),(0,Mt.default)(Ct,Se.TEXTURE_FLOAT,["OES_texture_float",!0]),(0,Mt.default)(Ct,Se.TEXTURE_HALF_FLOAT,["OES_texture_half_float",!0]),(0,Mt.default)(Ct,Se.TEXTURE_FILTER_LINEAR_FLOAT,["OES_texture_float_linear"]),(0,Mt.default)(Ct,Se.TEXTURE_FILTER_LINEAR_HALF_FLOAT,["OES_texture_half_float_linear"]),(0,Mt.default)(Ct,Se.TEXTURE_FILTER_ANISOTROPIC,["EXT_texture_filter_anisotropic"]),(0,Mt.default)(Ct,Se.COLOR_ATTACHMENT_RGBA32F,[Gve,"EXT_color_buffer_float"]),(0,Mt.default)(Ct,Se.COLOR_ATTACHMENT_FLOAT,[!1,"EXT_color_buffer_float"]),(0,Mt.default)(Ct,Se.COLOR_ATTACHMENT_HALF_FLOAT,["EXT_color_buffer_half_float"]),(0,Mt.default)(Ct,Se.GLSL_FRAG_DATA,["WEBGL_draw_buffers",!0]),(0,Mt.default)(Ct,Se.GLSL_FRAG_DEPTH,["EXT_frag_depth",!0]),(0,Mt.default)(Ct,Se.GLSL_DERIVATIVES,["OES_standard_derivatives",!0]),(0,Mt.default)(Ct,Se.GLSL_TEXTURE_LOD,["EXT_shader_texture_lod",!0]),Ct);function zve(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=Vve(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function Vve(t,r){if(t){if(typeof t=="string")return $3(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return $3(t,r)}}function $3(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var Hve=2;function ti(t,r){return dr(t,r)}function dr(t,r){return r=Array.isArray(r)?r:[r],r.every(function(e){return X3(t,e)})}function Kv(t){t.luma=t.luma||{},t.luma.caps=t.luma.caps||{};for(var r in wA)t.luma.caps[r]===void 0&&(t.luma.caps[r]=X3(t,r));return t.luma.caps}function X3(t,r){return t.luma=t.luma||{},t.luma.caps=t.luma.caps||{},t.luma.caps[r]===void 0&&(t.luma.caps[r]=Wve(t,r)),t.luma.caps[r]||ne.log(Hve,"Feature: ".concat(r," not supported"))(),t.luma.caps[r]}function Wve(t,r){var e=wA[r];Z(e,r);var n,i=ce(t)&&e[1]||e[0];if(typeof i=="function")n=i(t);else if(Array.isArray(i)){n=!0;var a=zve(i),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;n=n&&Boolean(t.getExtension(s))}}catch(u){a.e(u)}finally{a.f()}}else typeof i=="string"?n=Boolean(t.getExtension(i)):typeof i=="boolean"?n=i:Z(!1);return n}function q3(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=$ve(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function $ve(t,r){if(t){if(typeof t=="string")return Y3(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Y3(t,r)}}function Y3(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function Xve(t){var r=qve();return function(){var n=(0,Zv.default)(t),i;if(r){var a=(0,Zv.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,nF.default)(this,i)}}function qve(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var K3="Multiple render targets not supported",Re=function(t,r){(0,rF.default)(n,t);var e=Xve(n);function n(i){var a;(0,J3.default)(this,n);var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return a=e.call(this,i,o),a.width=null,a.height=null,a.attachments={},a.readBuffer=36064,a.drawBuffers=[36064],a.ownResources=[],a.initialize(o),Object.seal((0,eF.default)(a)),a}return(0,Q3.default)(n,[{key:r,get:function(){return"Framebuffer"}},{key:"MAX_COLOR_ATTACHMENTS",get:function(){var a=yt(this.gl);return a.getParameter(a.MAX_COLOR_ATTACHMENTS)}},{key:"MAX_DRAW_BUFFERS",get:function(){var a=yt(this.gl);return a.getParameter(a.MAX_DRAW_BUFFERS)}},{key:"color",get:function(){return this.attachments[36064]||null}},{key:"texture",get:function(){return this.attachments[36064]||null}},{key:"depth",get:function(){return this.attachments[36096]||this.attachments[33306]||null}},{key:"stencil",get:function(){return this.attachments[36128]||this.attachments[33306]||null}},{key:"initialize",value:function(a){var o=a.width,s=o===void 0?1:o,u=a.height,l=u===void 0?1:u,f=a.attachments,c=f===void 0?null:f,p=a.color,d=p===void 0?!0:p,v=a.depth,m=v===void 0?!0:v,g=a.stencil,y=g===void 0?!1:g,_=a.check,b=_===void 0?!0:_,x=a.readBuffer,A=x===void 0?void 0:x,S=a.drawBuffers,P=S===void 0?void 0:S;if(Z(s>=0&&l>=0,"Width and height need to be integers"),this.width=s,this.height=l,c)for(var O in c){var C=c[O],T=Array.isArray(C)?C[0]:C;T.resize({width:s,height:l})}else c=this._createDefaultAttachments(d,m,y,s,l);this.update({clearAttachments:!0,attachments:c,readBuffer:A,drawBuffers:P}),c&&b&&this.checkStatus()}},{key:"delete",value:function(){var a=q3(this.ownResources),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;s.delete()}}catch(u){a.e(u)}finally{a.f()}return(0,tF.default)((0,Zv.default)(n.prototype),"delete",this).call(this),this}},{key:"update",value:function(a){var o=a.attachments,s=o===void 0?{}:o,u=a.readBuffer,l=a.drawBuffers,f=a.clearAttachments,c=f===void 0?!1:f,p=a.resizeAttachments,d=p===void 0?!0:p;this.attach(s,{clearAttachments:c,resizeAttachments:d});var v=this.gl,m=v.bindFramebuffer(36160,this.handle);return u&&this._setReadBuffer(u),l&&this._setDrawBuffers(l),v.bindFramebuffer(36160,m||null),this}},{key:"resize",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=a.width,s=a.height;if(this.handle===null)return Z(o===void 0&&s===void 0),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;o===void 0&&(o=this.gl.drawingBufferWidth),s===void 0&&(s=this.gl.drawingBufferHeight),o!==this.width&&s!==this.height&&ne.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(o,"x").concat(s))();for(var u in this.attachments)this.attachments[u].resize({width:o,height:s});return this.width=o,this.height=s,this}},{key:"attach",value:function(a){var o=this,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},u=s.clearAttachments,l=u===void 0?!1:u,f=s.resizeAttachments,c=f===void 0?!0:f,p={};l&&Object.keys(this.attachments).forEach(function(O){p[O]=null}),Object.assign(p,a);var d=this.gl.bindFramebuffer(36160,this.handle);for(var v in p){Z(v!==void 0,"Misspelled framebuffer binding point?");var m=Number(v),g=p[m],y=g;if(!y)this._unattach(m);else if(y instanceof Fr)this._attachRenderbuffer({attachment:m,renderbuffer:y});else if(Array.isArray(g)){var _=(0,Z3.default)(g,3),b=_[0],x=_[1],A=x===void 0?0:x,S=_[2],P=S===void 0?0:S;y=b,this._attachTexture({attachment:m,texture:b,layer:A,level:P})}else this._attachTexture({attachment:m,texture:y,layer:0,level:0});c&&y&&y.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,d||null),Object.assign(this.attachments,a),Object.keys(this.attachments).filter(function(O){return!o.attachments[O]}).forEach(function(O){delete o.attachments[O]})}},{key:"checkStatus",value:function(){var a=this.gl,o=this.getStatus();if(o!==36053)throw new Error(Kve(o));return this}},{key:"getStatus",value:function(){var a=this.gl,o=a.bindFramebuffer(36160,this.handle),s=a.checkFramebufferStatus(36160);return a.bindFramebuffer(36160,o||null),s}},{key:"clear",value:function(){var a=this,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=o.color,u=o.depth,l=o.stencil,f=o.drawBuffers,c=f===void 0?[]:f,p=this.gl.bindFramebuffer(36160,this.handle);return(s||u||l)&&wn(this.gl,{color:s,depth:u,stencil:l}),c.forEach(function(d,v){AA(a.gl,{drawBuffer:v,value:d})}),this.gl.bindFramebuffer(36160,p||null),this}},{key:"readPixels",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ne.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}},{key:"readPixelsToBuffer",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ne.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}},{key:"copyToDataUrl",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ne.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}},{key:"copyToImage",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ne.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}},{key:"copyToTexture",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ne.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}},{key:"blit",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ne.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}},{key:"invalidate",value:function(a){var o=a.attachments,s=o===void 0?[]:o,u=a.x,l=u===void 0?0:u,f=a.y,c=f===void 0?0:f,p=a.width,d=a.height,v=yt(this.gl),m=v.bindFramebuffer(36008,this.handle),g=l===0&&c===0&&p===void 0&&d===void 0;return g?v.invalidateFramebuffer(36008,s):v.invalidateFramebuffer(36008,s,l,c,p,d),v.bindFramebuffer(36008,m),this}},{key:"getAttachmentParameter",value:function(a,o,s){var u=this._getAttachmentParameterFallback(o);return u===null&&(this.gl.bindFramebuffer(36160,this.handle),u=this.gl.getFramebufferAttachmentParameter(36160,a,o),this.gl.bindFramebuffer(36160,null)),s&&u>1e3&&(u=Tn(this.gl,u)),u}},{key:"getAttachmentParameters",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:36064,o=arguments.length>1?arguments[1]:void 0,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[],u={},l=q3(s),f;try{for(l.s();!(f=l.n()).done;){var c=f.value,p=o?Tn(this.gl,c):c;u[p]=this.getAttachmentParameter(a,c,o)}}catch(d){l.e(d)}finally{l.f()}return u}},{key:"getParameters",value:function(){for(var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,o=Object.keys(this.attachments),s={},u=0,l=o;u<l.length;u++){var f=l[u],c=Number(f),p=a?Tn(this.gl,c):c;s[p]=this.getAttachmentParameters(c,a)}return s}},{key:"show",value:function(){return typeof window<"u"&&window.open(Yv(this),"luma-debug-texture"),this}},{key:"log",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(a>ne.level||typeof window>"u")return this;o=o||"Framebuffer ".concat(this.id);var s=Yv(this,{targetMaxHeight:100});return ne.image({logLevel:a,message:o,image:s},o)(),this}},{key:"bind",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=a.target,s=o===void 0?36160:o;return this.gl.bindFramebuffer(s,this.handle),this}},{key:"unbind",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=a.target,s=o===void 0?36160:o;return this.gl.bindFramebuffer(s,null),this}},{key:"_createDefaultAttachments",value:function(a,o,s,u,l){var f=null;if(a){var c;f=f||{},f[36064]=new we(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:u,height:l,mipmaps:!1,parameters:(c={},(0,cp.default)(c,10241,9729),(0,cp.default)(c,10240,9729),(0,cp.default)(c,10242,33071),(0,cp.default)(c,10243,33071),c)}),this.ownResources.push(f[36064])}return o&&s?(f=f||{},f[33306]=new Fr(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:u,height:111}),this.ownResources.push(f[33306])):o?(f=f||{},f[36096]=new Fr(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:u,height:l}),this.ownResources.push(f[36096])):s&&Z(!1),f}},{key:"_unattach",value:function(a){var o=this.attachments[a];o&&(o instanceof Fr?this.gl.framebufferRenderbuffer(36160,a,36161,null):this.gl.framebufferTexture2D(36160,a,3553,null,0),delete this.attachments[a])}},{key:"_attachRenderbuffer",value:function(a){var o=a.attachment,s=o===void 0?36064:o,u=a.renderbuffer,l=this.gl;l.framebufferRenderbuffer(36160,s,36161,u.handle),this.attachments[s]=u}},{key:"_attachTexture",value:function(a){var o=a.attachment,s=o===void 0?36064:o,u=a.texture,l=a.layer,f=a.level,c=this.gl;switch(c.bindTexture(u.target,u.handle),u.target){case 35866:case 32879:var p=yt(c);p.framebufferTextureLayer(36160,s,u.target,f,l);break;case 34067:var d=Yve(l);c.framebufferTexture2D(36160,s,d,u.handle,f);break;case 3553:c.framebufferTexture2D(36160,s,3553,u.handle,f);break;default:Z(!1,"Illegal texture type")}c.bindTexture(u.target,null),this.attachments[s]=u}},{key:"_setReadBuffer",value:function(a){var o=tA(this.gl);o?o.readBuffer(a):Z(a===36064||a===1029,K3),this.readBuffer=a}},{key:"_setDrawBuffers",value:function(a){var o=this.gl,s=yt(o);if(s)s.drawBuffers(a);else{var u=o.getExtension("WEBGL_draw_buffers");u?u.drawBuffersWEBGL(a):Z(a.length===1&&(a[0]===36064||a[0]===1029),K3)}this.drawBuffers=a}},{key:"_getAttachmentParameterFallback",value:function(a){var o=Kv(this.gl);switch(a){case 36052:return o.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return o.WEBGL2?null:8;case 33297:return o.WEBGL2?null:5125;case 33296:return!o.WEBGL2&&!o.EXT_sRGB?9729:null;default:return null}}},{key:"_createHandle",value:function(){return this.gl.createFramebuffer()}},{key:"_deleteHandle",value:function(){this.gl.deleteFramebuffer(this.handle)}},{key:"_bindHandle",value:function(a){return this.gl.bindFramebuffer(36160,a)}}],[{key:"isSupported",value:function(a){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=o.colorBufferFloat,u=o.colorBufferHalfFloat,l=!0;return s&&(l=Boolean(a.getExtension("EXT_color_buffer_float")||a.getExtension("WEBGL_color_buffer_float")||a.getExtension("OES_texture_float"))),u&&(l=l&&Boolean(a.getExtension("EXT_color_buffer_float")||a.getExtension("EXT_color_buffer_half_float"))),l}},{key:"getDefaultFramebuffer",value:function(a){return a.luma=a.luma||{},a.luma.defaultFramebuffer=a.luma.defaultFramebuffer||new n(a,{id:"default-framebuffer",handle:null,attachments:{}}),a.luma.defaultFramebuffer}}]),n}(hr,Symbol.toStringTag);function Yve(t){return t<34069?t+34069:t}function Kve(t){var r=Re.STATUS||{};return r[t]||"Framebuffer error ".concat(t)}var Zve=[36049,36048,33296,33298,33299,33300,33301,33302,33303];Re.ATTACHMENT_PARAMETERS=Zve;function ul(t,r){Z(t instanceof we||t instanceof _s||t instanceof ol);var e=t.constructor,n=t.gl,i=t.width,a=t.height,o=t.format,s=t.type,u=t.dataFormat,l=t.border,f=t.mipmaps,c=Object.assign({width:i,height:a,format:o,type:s,dataFormat:u,border:l,mipmaps:f},r);return new e(n,c)}function W3(t,r){var e=t.gl,n=t.width,i=t.height,a=t.id,o=new Re(e,Object.assign({},r,{id:"framebuffer-for-".concat(a),width:n,height:i,attachments:(0,iF.default)({},36064,t)}));return o}var Jv=h(L()),Qv=h(N()),em=h(Y()),sF=h(K()),EA=h(q());function fo(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"unnamed",e=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/,n=t.match(e);return n?n[1]:r}var Jve=35632,Qve=35633;function PA(t){switch(t){case Jve:return"fragment";case Qve:return"vertex";default:return"unknown type"}}function OA(t,r,e,n){for(var i=t.split(/\r?\n/),a={},o={},s=n||fo(r)||"(unnamed)",u="".concat(PA(e)," shader ").concat(s),l=0;l<i.length;l++){var f=i[l];if(!(f.length<=1)){var c=f.split(":"),p=c[0],d=parseInt(c[2],10);if(isNaN(d))throw new Error("GLSL compilation error in ".concat(u,": ").concat(t));p!=="WARNING"?a[d]=f:o[d]=f}}var v=eme(r);return{shaderName:u,errors:aF(a,v),warnings:aF(o,v)}}function aF(t,r){for(var e="",n=0;n<r.length;n++){var i=r[n];if(!(!t[n+3]&&!t[n+2]&&!t[n+1])&&(e+="".concat(i,`
`),t[n+1])){var a=t[n+1],o=a.split(":",3),s=o[0],u=parseInt(o[1],10)||0,l=a.substring(o.join(":").length+1).trim();e+=oF("^^^ ".concat(s,": ").concat(l,`

`),u)}}return e}function eme(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:": ",n=t.split(/\r?\n/),i=String(n.length+r-1).length;return n.map(function(a,o){var s=String(o+r),u=s.length,l=oF(s,i-u);return l+e+a})}function oF(t,r){for(var e="",n=0;n<r;++n)e+=" ";return"".concat(e).concat(t)}function ll(t){var r=100,e=t.match(/[^\s]+/g);if(e.length>=2&&e[0]==="#version"){var n=parseInt(e[1],10);Number.isFinite(n)&&(r=n)}return r}function CA(t){var r=tme();return function(){var n=(0,EA.default)(t),i;if(r){var a=(0,EA.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,sF.default)(this,i)}}function tme(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var rme="Shader: GLSL source code must be a JavaScript string",uF=function(t,r){(0,em.default)(n,t);var e=CA(n);function n(i,a){var o;(0,Jv.default)(this,n),ha(i),Z(typeof a.source=="string",rme);var s=fo(a.source,null)||a.id||Ye("unnamed ".concat(n.getTypeName(a.shaderType)));return o=e.call(this,i,{id:s}),o.shaderType=a.shaderType,o.source=a.source,o.initialize(a),o}return(0,Qv.default)(n,[{key:r,get:function(){return"Shader"}},{key:"initialize",value:function(a){var o=a.source,s=fo(o,null);s&&(this.id=Ye(s)),this._compile(o)}},{key:"getParameter",value:function(a){return this.gl.getShaderParameter(this.handle,a)}},{key:"toString",value:function(){return"".concat(n.getTypeName(this.shaderType),":").concat(this.id)}},{key:"getName",value:function(){return fo(this.source)||"unnamed-shader"}},{key:"getSource",value:function(){return this.gl.getShaderSource(this.handle)}},{key:"getTranslatedSource",value:function(){var a=this.gl.getExtension("WEBGL_debug_shaders");return a?a.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}},{key:"_compile",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.source;a.startsWith("#version ")||(a=`#version 100
`.concat(a)),this.source=a,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle);var o=this.getParameter(35713);if(!o){var s=this.gl.getShaderInfoLog(this.handle),u=OA(s,this.source,this.shaderType,this.id),l=u.shaderName,f=u.errors,c=u.warnings;throw ne.error("GLSL compilation errors in ".concat(l,`
`).concat(f))(),ne.warn("GLSL compilation warnings in ".concat(l,`
`).concat(c))(),new Error("GLSL compilation errors in ".concat(l))}}},{key:"_deleteHandle",value:function(){this.gl.deleteShader(this.handle)}},{key:"_getOptsFromHandle",value:function(){return{type:this.getParameter(35663),source:this.getSource()}}}],[{key:"getTypeName",value:function(a){switch(a){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return Z(!1),"unknown"}}}]),n}(hr,Symbol.toStringTag),pp=function(t,r){(0,em.default)(n,t);var e=CA(n);function n(i,a){return(0,Jv.default)(this,n),typeof a=="string"&&(a={source:a}),e.call(this,i,Object.assign({},a,{shaderType:35633}))}return(0,Qv.default)(n,[{key:r,get:function(){return"VertexShader"}},{key:"_createHandle",value:function(){return this.gl.createShader(35633)}}]),n}(uF,Symbol.toStringTag),hp=function(t,r){(0,em.default)(n,t);var e=CA(n);function n(i,a){return(0,Jv.default)(this,n),typeof a=="string"&&(a={source:a}),e.call(this,i,Object.assign({},a,{shaderType:35632}))}return(0,Qv.default)(n,[{key:r,get:function(){return"FragmentShader"}},{key:"_createHandle",value:function(){return this.gl.createShader(35632)}}]),n}(uF,Symbol.toStringTag);var bF=h(L()),xF=h(N()),AF=h(be()),SF=h(Ee()),TF=h(Y()),wF=h(K()),am=h(q());var Fe=h(B());var ke,nme=(ke={},(0,Fe.default)(ke,5126,Tt.bind(null,"uniform1fv",cn,1,Tr)),(0,Fe.default)(ke,35664,Tt.bind(null,"uniform2fv",cn,2,Tr)),(0,Fe.default)(ke,35665,Tt.bind(null,"uniform3fv",cn,3,Tr)),(0,Fe.default)(ke,35666,Tt.bind(null,"uniform4fv",cn,4,Tr)),(0,Fe.default)(ke,5124,Tt.bind(null,"uniform1iv",co,1,Tr)),(0,Fe.default)(ke,35667,Tt.bind(null,"uniform2iv",co,2,Tr)),(0,Fe.default)(ke,35668,Tt.bind(null,"uniform3iv",co,3,Tr)),(0,Fe.default)(ke,35669,Tt.bind(null,"uniform4iv",co,4,Tr)),(0,Fe.default)(ke,35670,Tt.bind(null,"uniform1iv",co,1,Tr)),(0,Fe.default)(ke,35671,Tt.bind(null,"uniform2iv",co,2,Tr)),(0,Fe.default)(ke,35672,Tt.bind(null,"uniform3iv",co,3,Tr)),(0,Fe.default)(ke,35673,Tt.bind(null,"uniform4iv",co,4,Tr)),(0,Fe.default)(ke,35674,Tt.bind(null,"uniformMatrix2fv",cn,4,ma)),(0,Fe.default)(ke,35675,Tt.bind(null,"uniformMatrix3fv",cn,9,ma)),(0,Fe.default)(ke,35676,Tt.bind(null,"uniformMatrix4fv",cn,16,ma)),(0,Fe.default)(ke,35678,br),(0,Fe.default)(ke,35680,br),(0,Fe.default)(ke,5125,Tt.bind(null,"uniform1uiv",tm,1,Tr)),(0,Fe.default)(ke,36294,Tt.bind(null,"uniform2uiv",tm,2,Tr)),(0,Fe.default)(ke,36295,Tt.bind(null,"uniform3uiv",tm,3,Tr)),(0,Fe.default)(ke,36296,Tt.bind(null,"uniform4uiv",tm,4,Tr)),(0,Fe.default)(ke,35685,Tt.bind(null,"uniformMatrix2x3fv",cn,6,ma)),(0,Fe.default)(ke,35686,Tt.bind(null,"uniformMatrix2x4fv",cn,8,ma)),(0,Fe.default)(ke,35687,Tt.bind(null,"uniformMatrix3x2fv",cn,6,ma)),(0,Fe.default)(ke,35688,Tt.bind(null,"uniformMatrix3x4fv",cn,12,ma)),(0,Fe.default)(ke,35689,Tt.bind(null,"uniformMatrix4x2fv",cn,8,ma)),(0,Fe.default)(ke,35690,Tt.bind(null,"uniformMatrix4x3fv",cn,12,ma)),(0,Fe.default)(ke,35678,br),(0,Fe.default)(ke,35680,br),(0,Fe.default)(ke,35679,br),(0,Fe.default)(ke,35682,br),(0,Fe.default)(ke,36289,br),(0,Fe.default)(ke,36292,br),(0,Fe.default)(ke,36293,br),(0,Fe.default)(ke,36298,br),(0,Fe.default)(ke,36299,br),(0,Fe.default)(ke,36300,br),(0,Fe.default)(ke,36303,br),(0,Fe.default)(ke,36306,br),(0,Fe.default)(ke,36307,br),(0,Fe.default)(ke,36308,br),(0,Fe.default)(ke,36311,br),ke),ime={},ame={},ome={},lF=[0];function MA(t,r,e,n){r===1&&typeof t=="boolean"&&(t=t?1:0),Number.isFinite(t)&&(lF[0]=t,t=lF);var i=t.length;if(i%r&&ne.warn("Uniform size should be multiples of ".concat(r),t)(),t instanceof e)return t;var a=n[i];a||(a=new e(i),n[i]=a);for(var o=0;o<i;o++)a[o]=t[o];return a}function cn(t,r){return MA(t,r,Float32Array,ime)}function co(t,r){return MA(t,r,Int32Array,ame)}function tm(t,r){return MA(t,r,Uint32Array,ome)}function IA(t,r,e){var n=nme[e.type];if(!n)throw new Error("Unknown GLSL uniform type ".concat(e.type));return n().bind(null,t,r)}function fF(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};var r=/([^[]*)(\[[0-9]+\])?/,e=t.match(r);if(!e||e.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(t));return{name:e[1],length:e[2]||1,isArray:Boolean(e[2])}}function cF(t,r,e){for(var n in t){var i=t[n],a=!e||Boolean(e[n]);if(a&&!sme(i))throw r=r?"".concat(r," "):"",console.error("".concat(r," Bad uniform ").concat(n),i),new Error("".concat(r," Bad uniform ").concat(n))}return!0}function sme(t){return Array.isArray(t)||ArrayBuffer.isView(t)?ume(t):isFinite(t)||t===!0||t===!1||t instanceof fn||t instanceof Fr?!0:t instanceof Re?Boolean(t.texture):!1}function pF(t,r,e){if(Array.isArray(e)||ArrayBuffer.isView(e))if(t[r])for(var n=t[r],i=0,a=e.length;i<a;++i)n[i]=e[i];else t[r]=e.slice();else t[r]=e}function ume(t){if(t.length===0)return!1;for(var r=Math.min(t.length,16),e=0;e<r;++e)if(!Number.isFinite(t[e]))return!1;return!0}function br(){var t=null;return function(r,e,n){var i=t!==n;return i&&(r.uniform1i(e,n),t=n),i}}function Tt(t,r,e,n){var i=null,a=null;return function(o,s,u){var l=r(u,e),f=l.length,c=!1;if(i===null)i=new Float32Array(f),a=f,c=!0;else{Z(a===f,"Uniform length cannot change.");for(var p=0;p<f;++p)if(l[p]!==i[p]){c=!0;break}}return c&&(n(o,t,s,l),i.set(l)),c}}function Tr(t,r,e,n){t[r](e,n)}function ma(t,r,e,n){t[r](e,!1,n)}var vF=h(L()),mF=h(N());var LA=h(me()),bt=h(B());var ht,lme=5120,fme=5121,cme=5122,pme=5123,hF=0,rm=1,hme=2,dme=3,nm=4,vme=5,mme=6,ir=5126,gme=35664,yme=35665,_me=35666,dp=5124,bme=35667,xme=35668,Ame=35669,vp=5125,Sme=36294,Tme=36295,wme=36296,Pme=35670,Ome=35671,Eme=35672,Cme=35673,Mme=35674,Ime=35675,Rme=35676,Lme=35685,kme=35686,Bme=35687,Fme=35688,Dme=35689,Nme=35690,RA=(ht={},(0,bt.default)(ht,ir,[ir,1,"float"]),(0,bt.default)(ht,gme,[ir,2,"vec2"]),(0,bt.default)(ht,yme,[ir,3,"vec3"]),(0,bt.default)(ht,_me,[ir,4,"vec4"]),(0,bt.default)(ht,dp,[dp,1,"int"]),(0,bt.default)(ht,bme,[dp,2,"ivec2"]),(0,bt.default)(ht,xme,[dp,3,"ivec3"]),(0,bt.default)(ht,Ame,[dp,4,"ivec4"]),(0,bt.default)(ht,vp,[vp,1,"uint"]),(0,bt.default)(ht,Sme,[vp,2,"uvec2"]),(0,bt.default)(ht,Tme,[vp,3,"uvec3"]),(0,bt.default)(ht,wme,[vp,4,"uvec4"]),(0,bt.default)(ht,Pme,[ir,1,"bool"]),(0,bt.default)(ht,Ome,[ir,2,"bvec2"]),(0,bt.default)(ht,Eme,[ir,3,"bvec3"]),(0,bt.default)(ht,Cme,[ir,4,"bvec4"]),(0,bt.default)(ht,Mme,[ir,8,"mat2"]),(0,bt.default)(ht,Lme,[ir,8,"mat2x3"]),(0,bt.default)(ht,kme,[ir,8,"mat2x4"]),(0,bt.default)(ht,Ime,[ir,12,"mat3"]),(0,bt.default)(ht,Bme,[ir,12,"mat3x2"]),(0,bt.default)(ht,Fme,[ir,12,"mat3x4"]),(0,bt.default)(ht,Rme,[ir,16,"mat4"]),(0,bt.default)(ht,Dme,[ir,16,"mat4x2"]),(0,bt.default)(ht,Nme,[ir,16,"mat4x3"]),ht);function dF(t){switch(t){case hF:return hF;case rm:return rm;case dme:return rm;case hme:return rm;case nm:return nm;case vme:return nm;case mme:return nm;default:return Z(!1),0}}function kA(t){var r=RA[t];if(!r)return null;var e=(0,LA.default)(r,2),n=e[0],i=e[1];return{type:n,components:i}}function im(t,r){switch(t){case lme:case fme:case cme:case pme:t=ir;break;default:}for(var e in RA){var n=(0,LA.default)(RA[e],3),i=n[0],a=n[1],o=n[2];if(i===t&&a===r)return{glType:e,name:o}}return null}var gF=function(){function t(r){(0,vF.default)(this,t),this.id=r.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(r),this._readVaryingsFromProgram(r)}return(0,mF.default)(t,[{key:"getAttributeInfo",value:function(e){var n=Number(e);return Number.isFinite(n)?this.attributeInfosByLocation[n]:this.attributeInfosByName[e]||null}},{key:"getAttributeLocation",value:function(e){var n=this.getAttributeInfo(e);return n?n.location:-1}},{key:"getAttributeAccessor",value:function(e){var n=this.getAttributeInfo(e);return n?n.accessor:null}},{key:"getVaryingInfo",value:function(e){var n=Number(e);return Number.isFinite(n)?this.varyingInfos[n]:this.varyingInfosByName[e]||null}},{key:"getVaryingIndex",value:function(e){var n=this.getVaryingInfo();return n?n.location:-1}},{key:"getVaryingAccessor",value:function(e){var n=this.getVaryingInfo();return n?n.accessor:null}},{key:"_readAttributesFromProgram",value:function(e){for(var n=e.gl,i=n.getProgramParameter(e.handle,35721),a=0;a<i;a++){var o=n.getActiveAttrib(e.handle,a),s=o.name,u=o.type,l=o.size,f=n.getAttribLocation(e.handle,s);f>=0&&this._addAttribute(f,s,u,l)}this.attributeInfos.sort(function(c,p){return c.location-p.location})}},{key:"_readVaryingsFromProgram",value:function(e){var n=e.gl;if(ce(n)){for(var i=n.getProgramParameter(e.handle,35971),a=0;a<i;a++){var o=n.getTransformFeedbackVarying(e.handle,a),s=o.name,u=o.type,l=o.size;this._addVarying(a,s,u,l)}this.varyingInfos.sort(function(f,c){return f.location-c.location})}}},{key:"_addAttribute",value:function(e,n,i,a){var o=kA(i),s=o.type,u=o.components,l={type:s,size:a*u};this._inferProperties(e,n,l);var f={location:e,name:n,accessor:new kr(l)};this.attributeInfos.push(f),this.attributeInfosByLocation[e]=f,this.attributeInfosByName[f.name]=f}},{key:"_inferProperties",value:function(e,n,i){/instance/i.test(n)&&(i.divisor=1)}},{key:"_addVarying",value:function(e,n,i,a){var o=kA(i),s=o.type,u=o.components,l=new kr({type:s,size:a*u}),f={location:e,name:n,accessor:l};this.varyingInfos.push(f),this.varyingInfosByName[f.name]=f}}]),t}();function jme(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=Ume(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function Ume(t,r){if(t){if(typeof t=="string")return yF(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return yF(t,r)}}function yF(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function Gme(t){var r=zme();return function(){var n=(0,am.default)(t),i;if(r){var a=(0,am.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,wF.default)(this,i)}}function zme(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var _F=4,Vme=35981,Hme=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"],po=function(t,r){(0,TF.default)(n,t);var e=Gme(n);function n(i){var a;(0,bF.default)(this,n);var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return a=e.call(this,i,o),a.stubRemovedMethods("Program","v6.0",Hme),a._isCached=!1,a.initialize(o),Object.seal((0,AF.default)(a)),a._setId(o.id),a}return(0,xF.default)(n,[{key:r,get:function(){return"Program"}},{key:"initialize",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=a.hash,s=a.vs,u=a.fs,l=a.varyings,f=a.bufferMode,c=f===void 0?Vme:f;return this.hash=o||"",this.vs=typeof s=="string"?new pp(this.gl,{id:"".concat(a.id,"-vs"),source:s}):s,this.fs=typeof u=="string"?new hp(this.gl,{id:"".concat(a.id,"-fs"),source:u}):u,Z(this.vs instanceof pp),Z(this.fs instanceof hp),this.uniforms={},this._textureUniforms={},l&&l.length>0&&(yt(this.gl),this.varyings=l,this.gl2.transformFeedbackVaryings(this.handle,l,c)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new gF(this),this.setProps(a)}},{key:"delete",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isCached?this:(0,SF.default)((0,am.default)(n.prototype),"delete",this).call(this,a)}},{key:"setProps",value:function(a){return"uniforms"in a&&this.setUniforms(a.uniforms),this}},{key:"draw",value:function(a){var o=this,s=a.logPriority,u=a.drawMode,l=u===void 0?4:u,f=a.vertexCount,c=a.offset,p=c===void 0?0:c,d=a.start,v=a.end,m=a.isIndexed,g=m===void 0?!1:m,y=a.indexType,_=y===void 0?5123:y,b=a.instanceCount,x=b===void 0?0:b,A=a.isInstanced,S=A===void 0?x>0:A,P=a.vertexArray,O=P===void 0?null:P,C=a.transformFeedback,T=a.framebuffer,I=a.parameters,R=I===void 0?{}:I,V=a.uniforms,z=a.samplers;if((V||z)&&(ne.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(V||{})),ne.priority>=s){var k=T?T.id:"default",G="mode=".concat(Tn(this.gl,l)," verts=").concat(f," ")+"instances=".concat(x," indexType=").concat(Tn(this.gl,_)," ")+"isInstanced=".concat(S," isIndexed=").concat(g," ")+"Framebuffer=".concat(k);ne.log(s,G)()}return Z(O),this.gl.useProgram(this.handle),!this._areTexturesRenderable()||f===0||S&&x===0?!1:(O.bindForDraw(f,x,function(){if(T!==void 0&&(R=Object.assign({},R,{framebuffer:T})),C){var U=dF(l);C.begin(U)}o._bindTextures(),Le(o.gl,R,function(){g&&S?o.gl2.drawElementsInstanced(l,f,_,p,x):g&&ce(o.gl)&&!isNaN(d)&&!isNaN(v)?o.gl2.drawRangeElements(l,d,v,f,_,p):g?o.gl.drawElements(l,f,_,p):S?o.gl2.drawArraysInstanced(l,p,f,x):o.gl.drawArrays(l,p,f)}),C&&C.end()}),!0)}},{key:"setUniforms",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};ne.priority>=2&&cF(a,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(var o in a){var s=a[o],u=this._uniformSetters[o];if(u){var l=s,f=!1;if(l instanceof Re&&(l=l.texture),l instanceof fn)if(f=this.uniforms[o]!==s,f){u.textureIndex===void 0&&(u.textureIndex=this._textureIndexCounter++);var c=l,p=u.textureIndex;c.bind(p),l=p,this._textureUniforms[o]=c}else l=u.textureIndex;else this._textureUniforms[o]&&delete this._textureUniforms[o];(u(l)||f)&&pF(this.uniforms,o,s)}}return this}},{key:"_areTexturesRenderable",value:function(){var a=!0;for(var o in this._textureUniforms){var s=this._textureUniforms[o];s.update(),a=a&&s.loaded}return a}},{key:"_bindTextures",value:function(){for(var a in this._textureUniforms){var o=this._uniformSetters[a].textureIndex;this._textureUniforms[a].bind(o)}}},{key:"_createHandle",value:function(){return this.gl.createProgram()}},{key:"_deleteHandle",value:function(){this.gl.deleteProgram(this.handle)}},{key:"_getOptionsFromHandle",value:function(a){var o=this.gl.getAttachedShaders(a),s={},u=jme(o),l;try{for(u.s();!(l=u.n()).done;){var f=l.value,c=this.gl.getShaderParameter(this.handle,35663);switch(c){case 35633:s.vs=new pp({handle:f});break;case 35632:s.fs=new hp({handle:f});break;default:}}}catch(p){u.e(p)}finally{u.f()}return s}},{key:"_getParameter",value:function(a){return this.gl.getProgramParameter(this.handle,a)}},{key:"_setId",value:function(a){if(!a){var o=this._getName();this.id=Ye(o)}}},{key:"_getName",value:function(){var a=this.vs.getName()||this.fs.getName();return a=a.replace(/shader/i,""),a=a?"".concat(a,"-program"):"program",a}},{key:"_compileAndLink",value:function(){var a=this.gl;if(a.attachShader(this.handle,this.vs.handle),a.attachShader(this.handle,this.fs.handle),ne.time(_F,"linkProgram for ".concat(this._getName()))(),a.linkProgram(this.handle),ne.timeEnd(_F,"linkProgram for ".concat(this._getName()))(),a.debug||ne.level>0){var o=a.getProgramParameter(this.handle,35714);if(!o)throw new Error("Error linking: ".concat(a.getProgramInfoLog(this.handle)));a.validateProgram(this.handle);var s=a.getProgramParameter(this.handle,35715);if(!s)throw new Error("Error validating: ".concat(a.getProgramInfoLog(this.handle)))}}},{key:"_readUniformLocationsFromLinkedProgram",value:function(){var a=this.gl;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(var o=0;o<this._uniformCount;o++){var s=this.gl.getActiveUniform(this.handle,o),u=fF(s.name),l=u.name,f=a.getUniformLocation(this.handle,l);if(this._uniformSetters[l]=IA(a,f,s),s.size>1)for(var c=0;c<s.size;c++)f=a.getUniformLocation(this.handle,"".concat(l,"[").concat(c,"]")),this._uniformSetters["".concat(l,"[").concat(c,"]")]=IA(a,f,s)}this._textureIndexCounter=0}},{key:"getActiveUniforms",value:function(a,o){return this.gl2.getActiveUniforms(this.handle,a,o)}},{key:"getUniformBlockIndex",value:function(a){return this.gl2.getUniformBlockIndex(this.handle,a)}},{key:"getActiveUniformBlockParameter",value:function(a,o){return this.gl2.getActiveUniformBlockParameter(this.handle,a,o)}},{key:"uniformBlockBinding",value:function(a,o){this.gl2.uniformBlockBinding(this.handle,a,o)}}]),n}(hr,Symbol.toStringTag);var OF=h(L()),EF=h(N()),CF=h(be()),MF=h(Y()),IF=h(K()),BA=h(q());function Wme(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=$me(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function $me(t,r){if(t){if(typeof t=="string")return PF(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return PF(t,r)}}function PF(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function Xme(t){var r=qme();return function(){var n=(0,BA.default)(t),i;if(r){var a=(0,BA.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,IF.default)(this,i)}}function qme(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Yme=34918,Kme=34919,Zme=35007,Jme=36795,Qme=35976,ege=35887,tge=36202,om=function(t,r){(0,MF.default)(n,t);var e=Xme(n);function n(i){var a;(0,OF.default)(this,n);var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return a=e.call(this,i,o),a.target=null,a._queryPending=!1,a._pollingPromise=null,Object.seal((0,CF.default)(a)),a}return(0,EF.default)(n,[{key:r,get:function(){return"Query"}},{key:"beginTimeElapsedQuery",value:function(){return this.begin(Zme)}},{key:"beginOcclusionQuery",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=a.conservative,s=o===void 0?!1:o;return this.begin(s?tge:ege)}},{key:"beginTransformFeedbackQuery",value:function(){return this.begin(Qme)}},{key:"begin",value:function(a){return this._queryPending?this:(this.target=a,this.gl2.beginQuery(this.target,this.handle),this)}},{key:"end",value:function(){return this._queryPending?this:(this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this)}},{key:"isResultAvailable",value:function(){if(!this._queryPending)return!1;var a=this.gl2.getQueryParameter(this.handle,Kme);return a&&(this._queryPending=!1),a}},{key:"isTimerDisjoint",value:function(){return this.gl2.getParameter(Jme)}},{key:"getResult",value:function(){return this.gl2.getQueryParameter(this.handle,Yme)}},{key:"getTimerMilliseconds",value:function(){return this.getResult()/1e6}},{key:"createPoll",value:function(){var a=this,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;var s=0;return this._pollingPromise=new Promise(function(u,l){var f=function c(){a.isResultAvailable()?(u(a.getResult()),a._pollingPromise=null):s++>o?(l("Timed out"),a._pollingPromise=null):requestAnimationFrame(c)};requestAnimationFrame(f)}),this._pollingPromise}},{key:"_createHandle",value:function(){return n.isSupported(this.gl)?this.gl2.createQuery():null}},{key:"_deleteHandle",value:function(){this.gl2.deleteQuery(this.handle)}}],[{key:"isSupported",value:function(a){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],s=ce(a),u=dr(a,Se.TIMER_QUERY),l=s||u,f=Wme(o),c;try{for(f.s();!(c=f.n()).done;){var p=c.value;switch(p){case"queries":l=l&&s;break;case"timers":l=l&&u;break;default:Z(!1)}}}catch(d){f.e(d)}finally{f.f()}return l}}]),n}(hr,Symbol.toStringTag);var RF=h(L()),LF=h(N()),kF=h(be()),BF=h(Y()),FF=h(K()),FA=h(q());function rge(t){var r=nge();return function(){var n=(0,FA.default)(t),i;if(r){var a=(0,FA.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,FF.default)(this,i)}}function nge(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ho=function(t,r){(0,BF.default)(n,t);var e=rge(n);function n(i){var a;(0,RF.default)(this,n);var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return yt(i),a=e.call(this,i,o),a.initialize(o),a.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal((0,kF.default)(a)),a}return(0,LF.default)(n,[{key:r,get:function(){return"TransformFeedback"}},{key:"initialize",value:function(){var a=this,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,Li(this.buffers)||this.bind(function(){return a._unbindBuffers()}),this.setProps(o),this}},{key:"setProps",value:function(a){"program"in a&&(this.configuration=a.program&&a.program.configuration),"configuration"in a&&(this.configuration=a.configuration),"bindOnUse"in a&&(a=a.bindOnUse),"buffers"in a&&this.setBuffers(a.buffers)}},{key:"setBuffers",value:function(){var a=this,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.bind(function(){for(var s in o)a.setBuffer(s,o[s])}),this}},{key:"setBuffer",value:function(a,o){var s=this._getVaryingIndex(a),u=this._getBufferParams(o),l=u.buffer,f=u.byteSize,c=u.byteOffset;return s<0?(this.unused[a]=l,ne.warn("".concat(this.id," unused varying buffer ").concat(a))(),this):(this.buffers[s]=o,this.bindOnUse||this._bindBuffer(s,l,c,f),this)}},{key:"begin",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(a),this}},{key:"end",value:function(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}},{key:"_getBufferParams",value:function(a){var o,s,u;return a instanceof xe?u=a:(u=a.buffer,s=a.byteSize,o=a.byteOffset),(o!==void 0||s!==void 0)&&(o=o||0,s=s||u.byteLength-o),{buffer:u,byteOffset:o,byteSize:s}}},{key:"_getVaryingInfo",value:function(a){return this.configuration&&this.configuration.getVaryingInfo(a)}},{key:"_getVaryingIndex",value:function(a){if(this.configuration)return this.configuration.getVaryingInfo(a).location;var o=Number(a);return Number.isFinite(o)?o:-1}},{key:"_bindBuffers",value:function(){if(this.bindOnUse)for(var a in this.buffers){var o=this._getBufferParams(this.buffers[a]),s=o.buffer,u=o.byteSize,l=o.byteOffset;this._bindBuffer(a,s,l,u)}}},{key:"_unbindBuffers",value:function(){if(this.bindOnUse)for(var a in this.buffers)this._bindBuffer(a,null)}},{key:"_bindBuffer",value:function(a,o){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,u=arguments.length>3?arguments[3]:void 0,l=o&&o.handle;return!l||u===void 0?this.gl.bindBufferBase(35982,a,l):this.gl.bindBufferRange(35982,a,l,s,u),this}},{key:"_createHandle",value:function(){return this.gl.createTransformFeedback()}},{key:"_deleteHandle",value:function(){this.gl.deleteTransformFeedback(this.handle)}},{key:"_bindHandle",value:function(a){this.gl.bindTransformFeedback(36386,this.handle)}}],[{key:"isSupported",value:function(a){return ce(a)}}]),n}(hr,Symbol.toStringTag);var jF=h(L()),UF=h(N()),GF=h(be()),zF=h(Ee()),VF=h(Y()),HF=h(K()),um=h(q());var sm=null;function ige(t){return(!sm||sm.byteLength<t)&&(sm=new ArrayBuffer(t)),sm}function DF(t,r){var e=ige(t.BYTES_PER_ELEMENT*r);return new t(e,0,r)}function NF(t){for(var r=t.target,e=t.source,n=t.start,i=n===void 0?0:n,a=t.count,o=a===void 0?1:a,s=e.length,u=o*s,l=0,f=i;l<s;l++)r[f++]=e[l];for(;l<u;)l<u-l?(r.copyWithin(i+l,i,i+l),l*=2):(r.copyWithin(i+l,i,i+u-l),l=u);return r}function age(t){var r=oge();return function(){var n=(0,um.default)(t),i;if(r){var a=(0,um.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,HF.default)(this,i)}}function oge(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var sge="elements must be GL.ELEMENT_ARRAY_BUFFER",lm=function(t,r){(0,VF.default)(n,t);var e=age(n);function n(i){var a;(0,jF.default)(this,n);var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=o.id||o.program&&o.program.id;return a=e.call(this,i,Object.assign({},o,{id:s})),a.buffer=null,a.bufferValue=null,a.isDefaultArray=o.isDefaultArray||!1,a.gl2=i,a.initialize(o),Object.seal((0,GF.default)(a)),a}return(0,UF.default)(n,[{key:r,get:function(){return"VertexArrayObject"}},{key:"delete",value:function(){return(0,zF.default)((0,um.default)(n.prototype),"delete",this).call(this),this.buffer&&this.buffer.delete(),this}},{key:"MAX_ATTRIBUTES",get:function(){return n.getMaxAttributes(this.gl)}},{key:"initialize",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.setProps(a)}},{key:"setProps",value:function(a){return this}},{key:"setElementBuffer",value:function(){var a=this,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Z(!o||o.target===34963,sge),this.bind(function(){a.gl.bindBuffer(34963,o?o.handle:null)}),this}},{key:"setBuffer",value:function(a,o,s){if(o.target===34963)return this.setElementBuffer(o,s);var u=s.size,l=s.type,f=s.stride,c=s.offset,p=s.normalized,d=s.integer,v=s.divisor,m=this.gl,g=this.gl2;return a=Number(a),this.bind(function(){m.bindBuffer(34962,o.handle),d?(Z(ce(m)),g.vertexAttribIPointer(a,u,l,f,c)):m.vertexAttribPointer(a,u,l,p,f,c),m.enableVertexAttribArray(a),g.vertexAttribDivisor(a,v||0)}),this}},{key:"enable",value:function(a){var o=this,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,u=!s&&a===0&&!n.isSupported(this.gl,{constantAttributeZero:!0});return u||(a=Number(a),this.bind(function(){return s?o.gl.enableVertexAttribArray(a):o.gl.disableVertexAttribArray(a)})),this}},{key:"getConstantBuffer",value:function(a,o){var s=this._normalizeConstantArrayValue(o),u=s.byteLength*a,l=s.length*a,f=!this.buffer;if(this.buffer=this.buffer||new xe(this.gl,u),f=f||this.buffer.reallocate(u),f=f||!this._compareConstantArrayValues(s,this.bufferValue),f){var c=DF(o.constructor,l);NF({target:c,source:s,start:0,count:l}),this.buffer.subData(c),this.bufferValue=o}return this.buffer}},{key:"_normalizeConstantArrayValue",value:function(a){return Array.isArray(a)?new Float32Array(a):a}},{key:"_compareConstantArrayValues",value:function(a,o){if(!a||!o||a.length!==o.length||a.constructor!==o.constructor)return!1;for(var s=0;s<a.length;++s)if(a[s]!==o[s])return!1;return!0}},{key:"_createHandle",value:function(){var a=this.gl;return a.createVertexArray()}},{key:"_deleteHandle",value:function(a){return this.gl2.deleteVertexArray(a),[this.elements]}},{key:"_bindHandle",value:function(a){this.gl2.bindVertexArray(a)}},{key:"_getParameter",value:function(a,o){var s=this,u=o.location;return Z(Number.isFinite(u)),this.bind(function(){switch(a){case 34373:return s.gl.getVertexAttribOffset(u,a);default:return s.gl.getVertexAttrib(u,a)}})}}],[{key:"isSupported",value:function(a){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return o.constantAttributeZero?ce(a)||Qu()==="Chrome":!0}},{key:"getDefaultArray",value:function(a){return a.luma=a.luma||{},a.luma.defaultVertexArray||(a.luma.defaultVertexArray=new n(a,{handle:null,isDefaultArray:!0})),a.luma.defaultVertexArray}},{key:"getMaxAttributes",value:function(a){return n.MAX_ATTRIBUTES=n.MAX_ATTRIBUTES||a.getParameter(34921),n.MAX_ATTRIBUTES}},{key:"setConstant",value:function(a,o,s){switch(s.constructor){case Float32Array:n._setConstantFloatArray(a,o,s);break;case Int32Array:n._setConstantIntArray(a,o,s);break;case Uint32Array:n._setConstantUintArray(a,o,s);break;default:Z(!1)}}},{key:"_setConstantFloatArray",value:function(a,o,s){switch(s.length){case 1:a.vertexAttrib1fv(o,s);break;case 2:a.vertexAttrib2fv(o,s);break;case 3:a.vertexAttrib3fv(o,s);break;case 4:a.vertexAttrib4fv(o,s);break;default:Z(!1)}}},{key:"_setConstantIntArray",value:function(a,o,s){switch(Z(ce(a)),s.length){case 1:a.vertexAttribI1iv(o,s);break;case 2:a.vertexAttribI2iv(o,s);break;case 3:a.vertexAttribI3iv(o,s);break;case 4:a.vertexAttribI4iv(o,s);break;default:Z(!1)}}},{key:"_setConstantUintArray",value:function(a,o,s){switch(Z(ce(a)),s.length){case 1:a.vertexAttribI1uiv(o,s);break;case 2:a.vertexAttribI2uiv(o,s);break;case 3:a.vertexAttribI3uiv(o,s);break;case 4:a.vertexAttribI4uiv(o,s);break;default:Z(!1)}}}]),n}(hr,Symbol.toStringTag);var WF=h(L()),$F=h(N());var uge="VertexArray: attributes must be Buffers or constants (i.e. typed array)",lge=/^(.+)__LOCATION_([0-9]+)$/,fge=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"],DA=function(){function t(r){(0,WF.default)(this,t);var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=e.id||e.program&&e.program.id;this.id=n,this.gl=r,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new lm(r),Vv(this,"VertexArray","v6.0",fge),this.initialize(e),Object.seal(this)}return(0,$F.default)(t,[{key:"delete",value:function(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}},{key:"initialize",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(e)}},{key:"reset",value:function(){this.elements=null,this.elementsAccessor=null;var e=this.vertexArrayObject.MAX_ATTRIBUTES;return this.values=new Array(e).fill(null),this.accessors=new Array(e).fill(null),this.unused={},this.drawParams=null,this}},{key:"setProps",value:function(e){return"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"attributes"in e&&this.setAttributes(e.attributes),"elements"in e&&this.setElementBuffer(e.elements),"bindOnUse"in e&&(e=e.bindOnUse),this}},{key:"clearDrawParams",value:function(){this.drawParams=null}},{key:"getDrawParams",value:function(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}},{key:"setAttributes",value:function(e){var n=this;return Object.assign(this.attributes,e),this.vertexArrayObject.bind(function(){for(var i in e){var a=e[i];n._setAttribute(i,a)}n.gl.bindBuffer(34962,null)}),this}},{key:"setElementBuffer",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.elements=e,this.elementsAccessor=n,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(e,n),this}},{key:"setBuffer",value:function(e,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(n.target===34963)return this.setElementBuffer(n,i);var a=this._resolveLocationAndAccessor(e,n,n.accessor,i),o=a.location,s=a.accessor;return o>=0&&(this.values[o]=n,this.accessors[o]=s,this.clearDrawParams(),this.vertexArrayObject.setBuffer(o,n,s)),this}},{key:"setConstant",value:function(e,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=this._resolveLocationAndAccessor(e,n,Object.assign({size:n.length},i)),o=a.location,s=a.accessor;return o>=0&&(n=this.vertexArrayObject._normalizeConstantArrayValue(n),this.values[o]=n,this.accessors[o]=s,this.clearDrawParams(),this.vertexArrayObject.enable(o,!1)),this}},{key:"unbindBuffers",value:function(){var e=this;return this.vertexArrayObject.bind(function(){e.elements&&e.vertexArrayObject.setElementBuffer(null),e.buffer=e.buffer||new xe(e.gl,{accessor:{size:4}});for(var n=0;n<e.vertexArrayObject.MAX_ATTRIBUTES;n++)e.values[n]instanceof xe&&(e.gl.disableVertexAttribArray(n),e.gl.bindBuffer(34962,e.buffer.handle),e.gl.vertexAttribPointer(n,1,5126,!1,0,0))}),this}},{key:"bindBuffers",value:function(){var e=this;return this.vertexArrayObject.bind(function(){e.elements&&e.setElementBuffer(e.elements);for(var n=0;n<e.vertexArrayObject.MAX_ATTRIBUTES;n++){var i=e.values[n];i instanceof xe&&e.setBuffer(n,i)}}),this}},{key:"bindForDraw",value:function(e,n,i){var a=this,o;return this.vertexArrayObject.bind(function(){a._setConstantAttributes(e,n),o=i()}),o}},{key:"_resolveLocationAndAccessor",value:function(e,n,i,a){var o=this,s={location:-1,accessor:null},u=this._getAttributeIndex(e),l=u.location,f=u.name;if(!Number.isFinite(l)||l<0)return this.unused[e]=n,ne.once(3,function(){return"unused value ".concat(e," in ").concat(o.id)})(),s;var c=this._getAttributeInfo(f||l);if(!c)return s;var p=this.accessors[l]||{},d=kr.resolve(c.accessor,p,i,a),v=d.size,m=d.type;return Z(Number.isFinite(v)&&Number.isFinite(m)),{location:l,accessor:d}}},{key:"_getAttributeInfo",value:function(e){return this.configuration&&this.configuration.getAttributeInfo(e)}},{key:"_getAttributeIndex",value:function(e){var n=Number(e);if(Number.isFinite(n))return{location:n};var i=lge.exec(e),a=i?i[1]:e,o=i?Number(i[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(a)+o,name:a}:{location:-1}}},{key:"_setAttribute",value:function(e,n){if(n instanceof xe)this.setBuffer(e,n);else if(Array.isArray(n)&&n.length&&n[0]instanceof xe){var i=n[0],a=n[1];this.setBuffer(e,i,a)}else if(ArrayBuffer.isView(n)||Array.isArray(n)){var o=n;this.setConstant(e,o)}else if(n.buffer instanceof xe){var s=n;this.setBuffer(e,s.buffer,s)}else throw new Error(uge)}},{key:"_setConstantAttributes",value:function(e,n){var i=Math.max(e|0,n|0),a=this.values[0];ArrayBuffer.isView(a)&&this._setConstantAttributeZero(a,i);for(var o=1;o<this.vertexArrayObject.MAX_ATTRIBUTES;o++)a=this.values[o],ArrayBuffer.isView(a)&&this._setConstantAttribute(o,a)}},{key:"_setConstantAttributeZero",value:function(e,n){if(lm.isSupported(this.gl,{constantAttributeZero:!0})){this._setConstantAttribute(0,e);return}var i=this.vertexArrayObject.getConstantBuffer(n,e);this.vertexArrayObject.setBuffer(0,i,this.accessors[0])}},{key:"_setConstantAttribute",value:function(e,n){lm.setConstant(this.gl,e,n)}},{key:"_updateDrawParams",value:function(){for(var e={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0},n=0;n<this.vertexArrayObject.MAX_ATTRIBUTES;n++)this._updateDrawParamsForLocation(e,n);return this.elements&&(e.elementCount=this.elements.getElementCount(this.elements.accessor),e.isIndexed=!0,e.indexType=this.elementsAccessor.type||this.elements.accessor.type,e.indexOffset=this.elementsAccessor.offset||0),e.indexCount===1/0&&(e.indexCount=0),e.vertexCount===1/0&&(e.vertexCount=0),e.instanceCount===1/0&&(e.instanceCount=0),e}},{key:"_updateDrawParamsForLocation",value:function(e,n){var i=this.values[n],a=this.accessors[n];if(i){var o=a.divisor,s=o>0;if(e.isInstanced=e.isInstanced||s,i instanceof xe){var u=i;if(s){var l=u.getVertexCount(a);e.instanceCount=Math.min(e.instanceCount,l)}else{var f=u.getVertexCount(a);e.vertexCount=Math.min(e.vertexCount,f)}}}}},{key:"setElements",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return ne.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(e,n)}}]),t}();var fm=h(B());function cge(t,r){for(var e=r.maxElts,n=e===void 0?16:e,i=r.size,a=i===void 0?1:i,o="[",s=0;s<t.length&&s<n;++s)s>0&&(o+=",".concat(s%a===0?" ":"")),o+=xs(t[s],r);var u=t.length>n?"...":"]";return"".concat(o).concat(u)}function xs(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=1e-16,n=r.isInteger,i=n===void 0?!1:n;if(Array.isArray(t)||ArrayBuffer.isView(t))return cge(t,r);if(!Number.isFinite(t))return String(t);if(Math.abs(t)<e)return i?"0":"0.";if(i||Math.abs(t)>100&&Math.abs(t)<1e4)return t.toFixed(0);var a=t.toPrecision(2),o=a.indexOf(".0");return o===a.length-2?a.slice(0,-1):a}function NA(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=pge(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function pge(t,r){if(t){if(typeof t=="string")return XF(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return XF(t,r)}}function XF(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function cm(t){var r=t.header,e=r===void 0?"Uniforms":r,n=t.program,i=t.uniforms,a=t.undefinedOnly,o=a===void 0?!1:a;Z(n);var s=".*_.*",u=".*Matrix",l=n._uniformSetters,f={},c=Object.keys(l).sort(),p=0,d=NA(c),v;try{for(d.s();!(v=d.n()).done;){var m=v.value;!m.match(s)&&!m.match(u)&&jA({table:f,header:e,uniforms:i,uniformName:m,undefinedOnly:o})&&p++}}catch(T){d.e(T)}finally{d.f()}var g=NA(c),y;try{for(g.s();!(y=g.n()).done;){var _=y.value;_.match(u)&&jA({table:f,header:e,uniforms:i,uniformName:_,undefinedOnly:o})&&p++}}catch(T){g.e(T)}finally{g.f()}var b=NA(c),x;try{for(b.s();!(x=b.n()).done;){var A=x.value;f[A]||jA({table:f,header:e,uniforms:i,uniformName:A,undefinedOnly:o})&&p++}}catch(T){b.e(T)}finally{b.f()}var S=0,P={};if(!o)for(var O in i){var C=i[O];f[O]||(S++,P[O]=(0,fm.default)({Type:"NOT USED: ".concat(C)},e,xs(C)))}return{table:f,count:p,unusedTable:P,unusedCount:S}}function jA(t){var r=t.table,e=t.header,n=t.uniforms,i=t.uniformName,a=t.undefinedOnly,o=n[i],s=hge(o);if(!a||!s){var u;return r[i]=(u={},(0,fm.default)(u,e,s?xs(o):"N/A"),(0,fm.default)(u,"Uniform Type",s?o:"NOT PROVIDED"),u),!0}return!1}function hge(t){return t!=null}var As=h(B());function UA(t){var r=t.vertexArray,e=t.header,n=e===void 0?"Attributes":e;if(!r.configuration)return{};var i={};r.elements&&(i.ELEMENT_ARRAY_BUFFER=qF(r,r.elements,null,n));var a=r.values;for(var o in a){var s=r._getAttributeInfo(o);if(s){var u="".concat(o,": ").concat(s.name),l=r.accessors[s.location];l&&(u="".concat(o,": ").concat(dge(s.name,l))),i[u]=qF(r,a[o],l,n)}}return i}function qF(t,r,e,n){var i,a=t.gl;if(!r){var o;return o={},(0,As.default)(o,n,"null"),(0,As.default)(o,"Format ","N/A"),o}var s="NOT PROVIDED",u=1,l=0,f=0,c,p,d;if(e&&(s=e.type,u=e.size,s=String(s).replace("Array",""),c=s.indexOf("nt")!==-1),r instanceof xe){var v,m=r,g=m.getDebugData(),y=g.data,_=g.changed;p=_?"*":"",d=y,f=m.byteLength,l=f/y.BYTES_PER_ELEMENT/u;var b;if(e){var x=e.divisor>0;b="".concat(x?"I ":"P "," ").concat(l," (x").concat(u,"=").concat(f," bytes ").concat(Tn(a,s),")")}else c=!0,b="".concat(f," bytes");return v={},(0,As.default)(v,n,"".concat(p).concat(xs(d,{size:u,isInteger:c}))),(0,As.default)(v,"Format ",b),v}return d=r,u=r.length,s=String(r.constructor.name).replace("Array",""),c=s.indexOf("nt")!==-1,i={},(0,As.default)(i,n,"".concat(xs(d,{size:u,isInteger:c})," (constant)")),(0,As.default)(i,"Format ","".concat(u,"x").concat(s," (constant)")),i}function dge(t,r){var e=r.type,n=r.size,i=im(e,n);return i?"".concat(t," (").concat(i.name,")"):t}var GA=h(B());function YF(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=vge(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function vge(t,r){if(t){if(typeof t=="string")return KF(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return KF(t,r)}}function KF(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function zA(t){var r={},e="Accessors for ".concat(t.id),n=YF(t.attributeInfos),i;try{for(n.s();!(i=n.n()).done;){var a=i.value;if(a){var o=ZF(a);r["in ".concat(o)]=(0,GA.default)({},e,JSON.stringify(a.accessor))}}}catch(c){n.e(c)}finally{n.f()}var s=YF(t.varyingInfos),u;try{for(s.s();!(u=s.n()).done;){var l=u.value;if(l){var f=ZF(l);r["out ".concat(f)]=(0,GA.default)({},e,JSON.stringify(l.accessor))}}}catch(c){s.e(c)}finally{s.f()}return r}function ZF(t){var r=t.accessor,e=r.type,n=r.size,i=im(e,n);return i?"".concat(i.name," ").concat(t.name):t.name}var QF=h(ze()),eD=h(ye()),tD=h(L()),rD=h(N()),VA=h(ve());var JF=nr()&&typeof document<"u",mge=0,pm=function(){function t(){(0,tD.default)(this,t);var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=r.onCreateContext,n=e===void 0?function(V){return il(V)}:e,i=r.onAddHTML,a=i===void 0?null:i,o=r.onInitialize,s=o===void 0?function(){}:o,u=r.onRender,l=u===void 0?function(){}:u,f=r.onFinalize,c=f===void 0?function(){}:f,p=r.onError,d=r.gl,v=d===void 0?null:d,m=r.glOptions,g=m===void 0?{}:m,y=r.debug,_=y===void 0?!1:y,b=r.createFramebuffer,x=b===void 0?!1:b,A=r.autoResizeViewport,S=A===void 0?!0:A,P=r.autoResizeDrawingBuffer,O=P===void 0?!0:P,C=r.stats,T=C===void 0?Sn.get("animation-loop-".concat(mge++)):C,I=r.useDevicePixels,R=I===void 0?!0:I;"useDevicePixelRatio"in r&&(ne.deprecated("useDevicePixelRatio","useDevicePixels")(),R=r.useDevicePixelRatio),this.props={onCreateContext:n,onAddHTML:a,onInitialize:s,onRender:l,onFinalize:c,onError:p,gl:v,glOptions:g,debug:_,createFramebuffer:x},this.gl=v,this.needsRedraw=null,this.timeline=null,this.stats=T,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:S,autoResizeDrawingBuffer:O,useDevicePixels:R}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}return(0,rD.default)(t,[{key:"delete",value:function(){this.stop(),this._setDisplay(null)}},{key:"setNeedsRedraw",value:function(e){return Z(typeof e=="string"),this.needsRedraw=this.needsRedraw||e,this}},{key:"setProps",value:function(e){return"autoResizeViewport"in e&&(this.autoResizeViewport=e.autoResizeViewport),"autoResizeDrawingBuffer"in e&&(this.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer),"useDevicePixels"in e&&(this.useDevicePixels=e.useDevicePixels),this}},{key:"start",value:function(){var e=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._running)return this;this._running=!0;var i=this._getPageLoadPromise().then(function(){return!e._running||e._initialized?null:(e._createWebGLContext(n),e._createFramebuffer(),e._startEventHandling(),e._initializeCallbackData(),e._updateCallbackData(),e._resizeCanvasDrawingBuffer(),e._resizeViewport(),e._gpuTimeQuery=om.isSupported(e.gl,["timers"])?new om(e.gl):null,e._initialized=!0,e.onInitialize(e.animationProps))}).then(function(a){e._running&&(e._addCallbackData(a||{}),a!==!1&&e._startLoop())});return this.props.onError&&i.catch(this.props.onError),this}},{key:"redraw",value:function(){return this.isContextLost()?this:(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this)}},{key:"stop",value:function(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}},{key:"attachTimeline",value:function(e){return this.timeline=e,this.timeline}},{key:"detachTimeline",value:function(){this.timeline=null}},{key:"waitForRender",value:function(){var e=this;return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(function(n){e._resolveNextFrame=n})),this._nextFramePromise}},{key:"toDataURL",value:function(){var r=(0,eD.default)(VA.default.mark(function n(){return VA.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return this.setNeedsRedraw("toDataURL"),a.next=3,this.waitForRender();case 3:return a.abrupt("return",this.gl.canvas.toDataURL());case 4:case"end":return a.stop()}},n,this)}));function e(){return r.apply(this,arguments)}return e}()},{key:"isContextLost",value:function(){return this.gl.isContextLost()}},{key:"onCreateContext",value:function(){var e;return(e=this.props).onCreateContext.apply(e,arguments)}},{key:"onInitialize",value:function(){var e;return(e=this.props).onInitialize.apply(e,arguments)}},{key:"onRender",value:function(){var e;return(e=this.props).onRender.apply(e,arguments)}},{key:"onFinalize",value:function(){var e;return(e=this.props).onFinalize.apply(e,arguments)}},{key:"getHTMLControlValue",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,i=document.getElementById(e);return i?Number(i.value):n}},{key:"setViewParameters",value:function(){return ne.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}},{key:"_startLoop",value:function(){var e=this,n=function i(){e._running&&(e.redraw(),e._animationFrameId=e._requestAnimationFrame(i))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(n)}},{key:"_getPageLoadPromise",value:function(){return this._pageLoadPromise||(this._pageLoadPromise=JF?new Promise(function(e,n){if(JF&&document.readyState==="complete"){e(document);return}window.addEventListener("load",function(){e(document)})}):Promise.resolve({})),this._pageLoadPromise}},{key:"_setDisplay",value:function(e){this.display&&(this.display.delete(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}},{key:"_cancelAnimationFrame",value:function(e){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(e):fA(e)}},{key:"_requestAnimationFrame",value:function(e){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(e):lA(e)}},{key:"_renderFrame",value:function(){if(this.display){var e;(e=this.display)._renderFrame.apply(e,arguments);return}this.onRender.apply(this,arguments)}},{key:"_clearNeedsRedraw",value:function(){this.needsRedraw=null}},{key:"_setupFrame",value:function(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}},{key:"_initializeCallbackData",value:function(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}},{key:"_updateCallbackData",value:function(){var e=this._getSizeAndAspect(),n=e.width,i=e.height,a=e.aspect;(n!==this.animationProps.width||i!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),a!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=n,this.animationProps.height=i,this.animationProps.aspect=a,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}},{key:"_finalizeCallbackData",value:function(){this.onFinalize(this.animationProps)}},{key:"_addCallbackData",value:function(e){(0,QF.default)(e)==="object"&&e!==null&&(this.animationProps=Object.assign({},this.animationProps,e))}},{key:"_createWebGLContext",value:function(e){if(this.offScreen=e.canvas&&typeof OffscreenCanvas<"u"&&e.canvas instanceof OffscreenCanvas,e=Object.assign({},e,this.props.glOptions),this.gl=this.props.gl?da(this.props.gl,e):this.onCreateContext(e),!pa(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");Uv(this.gl),this._createInfoDiv()}},{key:"_createInfoDiv",value:function(){if(this.gl.canvas&&this.props.onAddHTML){var e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";var n=document.createElement("div");n.style.position="absolute",n.style.left="10px",n.style.bottom="10px",n.style.width="300px",n.style.background="white",e.appendChild(this.gl.canvas),e.appendChild(n);var i=this.props.onAddHTML(n);i&&(n.innerHTML=i)}}},{key:"_getSizeAndAspect",value:function(){var e=this.gl.drawingBufferWidth,n=this.gl.drawingBufferHeight,i=1,a=this.gl.canvas;return a&&a.clientHeight?i=a.clientWidth/a.clientHeight:e>0&&n>0&&(i=e/n),{width:e,height:n,aspect:i}}},{key:"_resizeViewport",value:function(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}},{key:"_resizeCanvasDrawingBuffer",value:function(){this.autoResizeDrawingBuffer&&uA(this.gl,{useDevicePixels:this.useDevicePixels})}},{key:"_createFramebuffer",value:function(){this.props.createFramebuffer&&(this.framebuffer=new Re(this.gl))}},{key:"_resizeFramebuffer",value:function(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}},{key:"_beginTimers",value:function(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}},{key:"_endTimers",value:function(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}},{key:"_startEventHandling",value:function(){var e=this.gl.canvas;e&&(e.addEventListener("mousemove",this._onMousemove),e.addEventListener("mouseleave",this._onMouseleave))}},{key:"_onMousemove",value:function(e){this.animationProps._mousePosition=[e.offsetX,e.offsetY]}},{key:"_onMouseleave",value:function(e){this.animationProps._mousePosition=null}}]),t}();var ej=h(B()),tj=h(L()),rj=h(N());var qN=h(L()),YN=h(N());var PD=h(me()),eS=h(B());var Ss="vs",mp="fs";var oD=h(L()),sD=h(N());function Wt(t,r){if(!t)throw new Error(r||"shadertools: assertion failed.")}var iD=h(ze()),HA={number:{validate:function(r,e){return Number.isFinite(r)&&(!("max"in e)||r<=e.max)&&(!("min"in e)||r>=e.min)}},array:{validate:function(r,e){return Array.isArray(r)||ArrayBuffer.isView(r)}}};function aD(t){var r={};for(var e in t){var n=t[e],i=gge(n);r[e]=i}return r}function gge(t){var r=nD(t);return r==="object"?t?"type"in t?Object.assign({},t,HA[t.type]):"value"in t?(r=nD(t.value),Object.assign({type:r},t,HA[r])):{type:"object",value:t}:{type:"object",value:null}:Object.assign({type:r,value:t},HA[r])}function nD(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":(0,iD.default)(t)}var yge="vs",_ge="fs",hm=function(){function t(r){(0,oD.default)(this,t);var e=r.name,n=r.vs,i=r.fs,a=r.dependencies,o=a===void 0?[]:a,s=r.uniforms,u=r.getUniforms,l=r.deprecations,f=l===void 0?[]:l,c=r.defines,p=c===void 0?{}:c,d=r.inject,v=d===void 0?{}:d,m=r.vertexShader,g=r.fragmentShader;Wt(typeof e=="string"),this.name=e,this.vs=n||m,this.fs=i||g,this.getModuleUniforms=u,this.dependencies=o,this.deprecations=this._parseDeprecationDefinitions(f),this.defines=p,this.injections=bge(v),s&&(this.uniforms=aD(s))}return(0,sD.default)(t,[{key:"getModuleSource",value:function(e){var n;switch(e){case yge:n=this.vs||"";break;case _ge:n=this.fs||"";break;default:Wt(!1)}return"#define MODULE_".concat(this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),`
`).concat(n,"// END MODULE_").concat(this.name,`

`)}},{key:"getUniforms",value:function(e,n){return this.getModuleUniforms?this.getModuleUniforms(e,n):this.uniforms?this._defaultGetUniforms(e):{}}},{key:"getDefines",value:function(){return this.defines}},{key:"checkDeprecations",value:function(e,n){this.deprecations.forEach(function(i){i.regex.test(e)&&(i.deprecated?n.deprecated(i.old,i.new)():n.removed(i.old,i.new)())})}},{key:"_parseDeprecationDefinitions",value:function(e){return e.forEach(function(n){switch(n.type){case"function":n.regex=new RegExp("\\b".concat(n.old,"\\("));break;default:n.regex=new RegExp("".concat(n.type," ").concat(n.old,";"))}}),e}},{key:"_defaultGetUniforms",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n={},i=this.uniforms;for(var a in i){var o=i[a];a in e&&!o.private?(o.validate&&Wt(o.validate(e[a],o),"".concat(this.name,": invalid ").concat(a)),n[a]=e[a]):n[a]=o.value}return n}}]),t}();function dm(t){if(!t.normalized&&(t.normalized=!0,t.uniforms&&!t.getUniforms)){var r=new hm(t);t.getUniforms=r.getUniforms.bind(r)}return t}function bge(t){var r={vs:{},fs:{}};for(var e in t){var n=t[e],i=e.slice(0,2);typeof n=="string"&&(n={order:0,injection:n}),r[i][e]=n}return r}function uD(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=xge(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function xge(t,r){if(t){if(typeof t=="string")return lD(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return lD(t,r)}}function lD(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function fD(t){return Age(pD(t))}function Age(t){var r={},e={};return cD({modules:t,level:0,moduleMap:r,moduleDepth:e}),Object.keys(e).sort(function(n,i){return e[i]-e[n]}).map(function(n){return r[n]})}function cD(t){var r=t.modules,e=t.level,n=t.moduleMap,i=t.moduleDepth;if(e>=5)throw new Error("Possible loop in shader dependency graph");var a=uD(r),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;n[s.name]=s,(i[s.name]===void 0||i[s.name]<e)&&(i[s.name]=e)}}catch(c){a.e(c)}finally{a.f()}var u=uD(r),l;try{for(u.s();!(l=u.n()).done;){var f=l.value;f.dependencies&&cD({modules:f.dependencies,level:e+1,moduleMap:n,moduleDepth:i})}}catch(c){u.e(c)}finally{u.f()}}function pD(t,r){return t.map(function(e){return e instanceof hm||(Wt(typeof e!="string","Shader module use by name is deprecated. Import shader module '".concat(e,"' and use it directly.")),Wt(e.name,"shader module has no name"),e=new hm(e),e.dependencies=pD(e.dependencies)),e})}function WA(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=typeof window<"u"?window.navigator||{}:{},e=t.userAgent||r.userAgent||"",n=e.indexOf("MSIE ")!==-1,i=e.indexOf("Trident/")!==-1;return n||i}var Sge=7936,Tge=7937,wge=7938,Pge=35724,XA={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},vo={};Object.keys(XA).forEach(function(t){vo[t]=t});function Oge(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:Boolean(t&&t._version===2)}function hD(t){var r=t.getExtension("WEBGL_debug_renderer_info"),e=t.getParameter(r&&r.UNMASKED_VENDOR_WEBGL||Sge),n=t.getParameter(r&&r.UNMASKED_RENDERER_WEBGL||Tge),i=Ege(e,n),a={gpuVendor:i,vendor:e,renderer:n,version:t.getParameter(wge),shadingLanguageVersion:t.getParameter(Pge)};return a}function Ege(t,r){return t.match(/NVIDIA/i)||r.match(/NVIDIA/i)?"NVIDIA":t.match(/INTEL/i)||r.match(/INTEL/i)?"INTEL":t.match(/AMD/i)||r.match(/AMD/i)||t.match(/ATI/i)||r.match(/ATI/i)?"AMD":"UNKNOWN GPU"}var $A={};function qA(t,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=XA[r];if(Wt(n,r),!WA(e))return!0;if(r in $A)return $A[r];var i=n[0],a=e.behavior||"enable",o="#extension GL_".concat(i," : ").concat(a,`
void main(void) {}`),s=t.createShader(35633);t.shaderSource(s,o),t.compileShader(s);var u=t.getShaderParameter(s,35713);return t.deleteShader(s),$A[r]=u,u}function Cge(t,r){var e=XA[r];Wt(e,r);var n=Oge(t)&&e[1]||e[0],i=typeof n=="string"?Boolean(t.getExtension(n)):n;return Wt(i===!1||i===!0),i}function gp(t,r){return r=Array.isArray(r)?r:[r],r.every(function(e){return Cge(t,e)})}function dD(t){var r=hD(t);switch(r.gpuVendor.toLowerCase()){case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function vD(t,r,e){var n=`#if (__VERSION__ > 120)

# define FEATURE_GLSL_DERIVATIVES
# define FEATURE_GLSL_DRAW_BUFFERS
# define FEATURE_GLSL_FRAG_DEPTH
# define FEATURE_GLSL_TEXTURE_LOD

// DEPRECATED FLAGS, remove in v9
# define FRAG_DEPTH
# define DERIVATIVES
# define DRAW_BUFFERS
# define TEXTURE_LOD

#endif // __VERSION
`;return gp(t,vo.GLSL_FRAG_DEPTH)&&(n+=`
// FRAG_DEPTH => gl_FragDepth is available
#ifdef GL_EXT_frag_depth
#extension GL_EXT_frag_depth : enable
# define FEATURE_GLSL_FRAG_DEPTH
# define FRAG_DEPTH
# define gl_FragDepth gl_FragDepthEXT
#endif
`),gp(t,vo.GLSL_DERIVATIVES)&&qA(t,vo.GLSL_DERIVATIVES)&&(n+=`
// DERIVATIVES => dxdF, dxdY and fwidth are available
#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
# define FEATURE_GLSL_DERIVATIVES
# define DERIVATIVES
#endif
`),gp(t,vo.GLSL_FRAG_DATA)&&qA(t,vo.GLSL_FRAG_DATA,{behavior:"require"})&&(n+=`
// DRAW_BUFFERS => gl_FragData[] is available
#ifdef GL_EXT_draw_buffers
#extension GL_EXT_draw_buffers : require
#define FEATURE_GLSL_DRAW_BUFFERS
#define DRAW_BUFFERS
#endif
`),gp(t,vo.GLSL_TEXTURE_LOD)&&(n+=`// TEXTURE_LOD => texture2DLod etc are available
#ifdef GL_EXT_shader_texture_lod
#extension GL_EXT_shader_texture_lod : enable

# define FEATURE_GLSL_TEXTURE_LOD
# define TEXTURE_LOD

#endif
`),n}var KA=h(B());var mD=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,gD=`#ifdef MODULE_MATERIAL
  gl_FragColor = material_filterColor(gl_FragColor);
#endif

#ifdef MODULE_LIGHTING
  gl_FragColor = lighting_filterColor(gl_FragColor);
#endif

#ifdef MODULE_FOG
  gl_FragColor = fog_filterColor(gl_FragColor);
#endif

#ifdef MODULE_PICKING
  gl_FragColor = picking_filterHighlightColor(gl_FragColor);
  gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`;var vm,Mge=(vm={},(0,KA.default)(vm,Ss,mD),(0,KA.default)(vm,mp,gD),vm),yp="__LUMA_INJECT_DECLARATIONS__",yD=/void\s+main\s*\([^)]*\)\s*\{\n?/,_D=/}\n?[^{}]*$/,YA=[];function mm(t,r,e){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,i=r===Ss,a=function(u){var l=e[u];l.sort(function(d,v){return d.order-v.order}),YA.length=l.length;for(var f=0,c=l.length;f<c;++f)YA[f]=l[f].injection;var p="".concat(YA.join(`
`),`
`);switch(u){case"vs:#decl":i&&(t=t.replace(yp,p));break;case"vs:#main-start":i&&(t=t.replace(yD,function(d){return d+p}));break;case"vs:#main-end":i&&(t=t.replace(_D,function(d){return p+d}));break;case"fs:#decl":i||(t=t.replace(yp,p));break;case"fs:#main-start":i||(t=t.replace(yD,function(d){return d+p}));break;case"fs:#main-end":i||(t=t.replace(_D,function(d){return p+d}));break;default:t=t.replace(u,function(d){return d+p})}};for(var o in e)a(o);return t=t.replace(yp,""),n&&(t=t.replace(/\}\s*$/,function(s){return s+Mge[r]})),t}function fl(t){var r={};return Wt(Array.isArray(t)&&t.length>1),t.forEach(function(e){for(var n in e)r[n]=r[n]?"".concat(r[n],`
`).concat(e[n]):e[n]}),r}var xD=h(me());function Ige(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=Rge(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function Rge(t,r){if(t){if(typeof t=="string")return bD(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return bD(t,r)}}function bD(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function cl(t){return new RegExp("\\b".concat(t,"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)"),"g")}var AD=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],Lge=[].concat(AD,[[cl("attribute"),"in $1"],[cl("varying"),"out $1"]]),kge=[].concat(AD,[[cl("varying"),"in $1"]]),SD=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],Bge=[].concat(SD,[[cl("in"),"attribute $1"],[cl("out"),"varying $1"]]),Fge=[].concat(SD,[[cl("in"),"varying $1"]]),ZA="gl_FragColor",JA=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,Dge=/void\s+main\s*\([^)]*\)\s*\{\n?/;function QA(t,r,e){switch(r){case 300:return e?gm(t,Lge):Nge(t);case 100:return e?gm(t,Bge):jge(t);default:throw new Error("unknown GLSL version ".concat(r))}}function gm(t,r){var e=Ige(r),n;try{for(e.s();!(n=e.n()).done;){var i=(0,xD.default)(n.value,2),a=i[0],o=i[1];t=t.replace(a,o)}}catch(s){e.e(s)}finally{e.f()}return t}function Nge(t){t=gm(t,kge);var r=t.match(JA);if(r){var e=r[1];t=t.replace(new RegExp("\\b".concat(ZA,"\\b"),"g"),e)}else{var n="fragmentColor";t=t.replace(Dge,function(i){return"out vec4 ".concat(n,`;
`).concat(i)}).replace(new RegExp("\\b".concat(ZA,"\\b"),"g"),n)}return t}function jge(t){t=gm(t,Fge);var r=t.match(JA);if(r){var e=r[1];t=t.replace(JA,"").replace(new RegExp("\\b".concat(e,"\\b"),"g"),ZA)}return t}var ym;function tS(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=Uge(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function Uge(t,r){if(t){if(typeof t=="string")return TD(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return TD(t,r)}}function TD(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var Gge=`

`.concat(yp,`

`),OD=(ym={},(0,eS.default)(ym,Ss,"vertex"),(0,eS.default)(ym,mp,"fragment"),ym),zge=`precision highp float;

`;function rS(t,r){var e=r.vs,n=r.fs,i=fD(r.modules||[]);return{gl:t,vs:wD(t,Object.assign({},r,{source:e,type:Ss,modules:i})),fs:wD(t,Object.assign({},r,{source:n,type:mp,modules:i})),getUniforms:Vge(i)}}function wD(t,r){var e=r.id,n=r.source,i=r.type,a=r.modules,o=r.defines,s=o===void 0?{}:o,u=r.hookFunctions,l=u===void 0?[]:u,f=r.inject,c=f===void 0?{}:f,p=r.transpileToGLSL100,d=p===void 0?!1:p,v=r.prologue,m=v===void 0?!0:v,g=r.log;Wt(typeof n=="string","shader source must be a string");var y=i===Ss,_=n.split(`
`),b=100,x="",A=n;_[0].indexOf("#version ")===0?(b=300,x=_[0],A=_.slice(1).join(`
`)):x="#version ".concat(b);var S={};a.forEach(function(ge){Object.assign(S,ge.getDefines())}),Object.assign(S,s);var P=m?"".concat(x,`
`).concat(Wge({id:e,source:n,type:i}),`
`).concat(Hge({type:i}),`
`).concat(dD(t),`
`).concat(vD(t,b,!y),`
`).concat($ge(S),`
`).concat(y?"":zge,`
`):"".concat(x,`
`),O=qge(l),C={},T={},I={};for(var R in c){var V=typeof c[R]=="string"?{injection:c[R],order:0}:c[R],z=R.match(/^(v|f)s:(#)?([\w-]+)$/);if(z){var k=z[2],G=z[3];k?G==="decl"?T[R]=[V]:I[R]=[V]:C[R]=[V]}else I[R]=[V]}var U=tS(a),$;try{for(U.s();!($=U.n()).done;){var H=$.value;g&&H.checkDeprecations(A,g);var Q=H.getModuleSource(i,b);P+=Q;var ie=H.injections[i];for(var fe in ie){var Ae=fe.match(/^(v|f)s:#([\w-]+)$/);if(Ae){var Oe=Ae[2],Xe=Oe==="decl"?T:I;Xe[fe]=Xe[fe]||[],Xe[fe].push(ie[fe])}else C[fe]=C[fe]||[],C[fe].push(ie[fe])}}}catch(ge){U.e(ge)}finally{U.f()}return P+=Gge,P=mm(P,i,T),P+=Xge(O[i],C),P+=A,P=mm(P,i,I),P=QA(P,d?100:b,y),P}function Vge(t){return function(e){var n={},i=tS(t),a;try{for(i.s();!(a=i.n()).done;){var o=a.value,s=o.getUniforms(e,n);Object.assign(n,s)}}catch(u){i.e(u)}finally{i.f()}return n}}function Hge(t){var r=t.type;return`
#define SHADER_TYPE_`.concat(OD[r].toUpperCase(),`
`)}function Wge(t){var r=t.id,e=t.source,n=t.type,i=r&&typeof r=="string"&&e.indexOf("SHADER_NAME")===-1;return i?`
#define SHADER_NAME `.concat(r,"_").concat(OD[n],`

`):""}function $ge(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=0,e="";for(var n in t){r===0&&(e+=`
// APPLICATION DEFINES
`),r++;var i=t[n];(i||Number.isFinite(i))&&(e+="#define ".concat(n.toUpperCase()," ").concat(t[n],`
`))}return r===0&&(e+=`
`),e}function Xge(t,r){var e="";for(var n in t){var i=t[n];if(e+="void ".concat(i.signature,` {
`),i.header&&(e+="  ".concat(i.header)),r[n]){var a=r[n];a.sort(function(l,f){return l.order-f.order});var o=tS(a),s;try{for(o.s();!(s=o.n()).done;){var u=s.value;e+="  ".concat(u.injection,`
`)}}catch(l){o.e(l)}finally{o.f()}}i.footer&&(e+="  ".concat(i.footer)),e+=`}
`}return e}function qge(t){var r={vs:{},fs:{}};return t.forEach(function(e){var n;typeof e!="string"?(n=e,e=n.hook):n={},e=e.trim();var i=e.split(":"),a=(0,PD.default)(i,2),o=a[0],s=a[1],u=e.replace(/\(.+/,"");r[o][u]=Object.assign(n,{signature:s})}),r}var ED=h(me());var Yge="void main() {gl_FragColor = vec4(0);}",CD=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,Kge=`#version 300 es
`.concat(CD);function _m(t,r){r=Array.isArray(r)?r:[r];var e=t.replace(/^\s+/,"").split(/\s+/),n=(0,ED.default)(e,3),i=n[0],a=n[1],o=n[2];if(!r.includes(i)||!a||!o)return null;var s=o.split(";")[0];return{qualifier:i,type:a,name:s}}function _p(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=t.version,e=r===void 0?100:r,n=t.input,i=t.inputType,a=t.output;if(!n)return e===300?Kge:e>300?"#version ".concat(e,`
`).concat(CD):Yge;var o=MD(n,i);return e>=300?"#version ".concat(e," ").concat(e===300?"es":"",`
in `).concat(i," ").concat(n,`;
out vec4 `).concat(a,`;
void main() {
  `).concat(a," = ").concat(o,`;
}`):"varying ".concat(i," ").concat(n,`;
void main() {
  gl_FragColor = `).concat(o,`;
}`)}function nS(t){switch(t){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return Wt(!1),null}}function iS(t){switch(t){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return Wt(!1),null}}function MD(t,r){switch(r){case"float":return"vec4(".concat(t,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(t,", 0.0, 1.0)");case"vec3":return"vec4(".concat(t,", 1.0)");case"vec4":return t;default:return Wt(!1),null}}var Zge=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,bm={name:"fp32",vs:Zge,fs:null};function xm(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=Math.fround(t),i=t-n;return r[e]=n,r[e+1]=i,r}function aS(t){return t-Math.fround(t)}function oS(t){for(var r=new Float32Array(32),e=0;e<4;++e)for(var n=0;n<4;++n){var i=e*4+n;xm(t[n*4+e],r,i*2)}return r}var ID=`uniform float ONE;
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * ONE - (t - a);
  float a_lo = a * ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * ONE;
  float err = b - (sum - a) * ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * ONE - a) * ONE;
  float err = (a - (s - v) * ONE) * ONE * ONE * ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * ONE - a) * ONE;
  float err = (a - (s - v) * ONE) * ONE * ONE * ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * ONE + 2.0 * a_fp64.x *
    a_fp64.y * ONE * ONE) + a_fp64.y * a_fp64.y * ONE * ONE * ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`;var RD=`const vec2 E_FP64 = vec2(2.7182817459106445e+00, 8.254840366817007e-08);
const vec2 LOG2_FP64 = vec2(0.6931471824645996e+00, -1.9046542121259336e-09);
const vec2 PI_FP64 = vec2(3.1415927410125732, -8.742278012618954e-8);
const vec2 TWO_PI_FP64 = vec2(6.2831854820251465, -1.7484556025237907e-7);
const vec2 PI_2_FP64 = vec2(1.5707963705062866, -4.371139006309477e-8);
const vec2 PI_4_FP64 = vec2(0.7853981852531433, -2.1855695031547384e-8);
const vec2 PI_16_FP64 = vec2(0.19634954631328583, -5.463923757886846e-9);
const vec2 PI_16_2_FP64 = vec2(0.39269909262657166, -1.0927847515773692e-8);
const vec2 PI_16_3_FP64 = vec2(0.5890486240386963, -1.4906100798128818e-9);
const vec2 PI_180_FP64 = vec2(0.01745329238474369, 1.3519960498364902e-10);

const vec2 SIN_TABLE_0_FP64 = vec2(0.19509032368659973, -1.6704714833615242e-9);
const vec2 SIN_TABLE_1_FP64 = vec2(0.3826834261417389, 6.22335089017767e-9);
const vec2 SIN_TABLE_2_FP64 = vec2(0.5555702447891235, -1.1769521357507529e-8);
const vec2 SIN_TABLE_3_FP64 = vec2(0.7071067690849304, 1.2101617041793133e-8);

const vec2 COS_TABLE_0_FP64 = vec2(0.9807852506637573, 2.9739473106360492e-8);
const vec2 COS_TABLE_1_FP64 = vec2(0.9238795042037964, 2.8307490351764386e-8);
const vec2 COS_TABLE_2_FP64 = vec2(0.8314695954322815, 1.6870263741530778e-8);
const vec2 COS_TABLE_3_FP64 = vec2(0.7071067690849304, 1.2101617152815436e-8);

const vec2 INVERSE_FACTORIAL_3_FP64 = vec2(1.666666716337204e-01, -4.967053879312289e-09);
const vec2 INVERSE_FACTORIAL_4_FP64 = vec2(4.16666679084301e-02, -1.2417634698280722e-09);
const vec2 INVERSE_FACTORIAL_5_FP64 = vec2(8.333333767950535e-03, -4.34617203337595e-10);
const vec2 INVERSE_FACTORIAL_6_FP64 = vec2(1.3888889225199819e-03, -3.3631094437103215e-11);
const vec2 INVERSE_FACTORIAL_7_FP64 = vec2(1.9841270113829523e-04,  -2.725596874933456e-12);
const vec2 INVERSE_FACTORIAL_8_FP64 = vec2(2.4801587642286904e-05, -3.406996025904184e-13);
const vec2 INVERSE_FACTORIAL_9_FP64 = vec2(2.75573188446287533e-06, 3.7935713937038186e-14);
const vec2 INVERSE_FACTORIAL_10_FP64 = vec2(2.755731998149713e-07, -7.575112367869873e-15);

float nint(float d) {
    if (d == floor(d)) return d;
    return floor(d + 0.5);
}

vec2 nint_fp64(vec2 a) {
    float hi = nint(a.x);
    float lo;
    vec2 tmp;
    if (hi == a.x) {
        lo = nint(a.y);
        tmp = quickTwoSum(hi, lo);
    } else {
        lo = 0.0;
        if (abs(hi - a.x) == 0.5 && a.y < 0.0) {
            hi -= 1.0;
        }
        tmp = vec2(hi, lo);
    }
    return tmp;
}

vec2 exp_fp64(vec2 a) {

  const int k_power = 4;
  const float k = 16.0;

  const float inv_k = 1.0 / k;

  if (a.x <= -88.0) return vec2(0.0, 0.0);
  if (a.x >= 88.0) return vec2(1.0 / 0.0, 1.0 / 0.0);
  if (a.x == 0.0 && a.y == 0.0) return vec2(1.0, 0.0);
  if (a.x == 1.0 && a.y == 0.0) return E_FP64;

  float m = floor(a.x / LOG2_FP64.x + 0.5);
  vec2 r = sub_fp64(a, mul_fp64(LOG2_FP64, vec2(m, 0.0))) * inv_k;
  vec2 s, t, p;

  p = mul_fp64(r, r);
  s = sum_fp64(r, p * 0.5);
  p = mul_fp64(p, r);
  t = mul_fp64(p, INVERSE_FACTORIAL_3_FP64);

  s = sum_fp64(s, t);
  p = mul_fp64(p, r);
  t = mul_fp64(p, INVERSE_FACTORIAL_4_FP64);

  s = sum_fp64(s, t);
  p = mul_fp64(p, r);
  t = mul_fp64(p, INVERSE_FACTORIAL_5_FP64);






  s = sum_fp64(s, t);
  for (int i = 0; i < k_power; i++) {
    s = sum_fp64(s * 2.0, mul_fp64(s, s));
  }

#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)
  s = sum_fp64(s, vec2(ONE, 0.0));
#else
  s = sum_fp64(s, vec2(1.0, 0.0));
#endif

  return s * pow(2.0, m);
}

vec2 log_fp64(vec2 a)
{
  if (a.x == 1.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x <= 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);
  vec2 x = vec2(log(a.x), 0.0);
  vec2 s;
#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)
  s = vec2(ONE, 0.0);
#else
  s = vec2(1.0, 0.0);
#endif

  x = sub_fp64(sum_fp64(x, mul_fp64(a, exp_fp64(-x))), s);
  return x;
}

vec2 sin_taylor_fp64(vec2 a) {
  vec2 r, s, t, x;

  if (a.x == 0.0 && a.y == 0.0) {
    return vec2(0.0, 0.0);
  }

  x = -mul_fp64(a, a);
  s = a;
  r = a;

  r = mul_fp64(r, x);
  t = mul_fp64(r, INVERSE_FACTORIAL_3_FP64);
  s = sum_fp64(s, t);

  r = mul_fp64(r, x);
  t = mul_fp64(r, INVERSE_FACTORIAL_5_FP64);
  s = sum_fp64(s, t);






  return s;
}

vec2 cos_taylor_fp64(vec2 a) {
  vec2 r, s, t, x;

  if (a.x == 0.0 && a.y == 0.0) {
    return vec2(1.0, 0.0);
  }

  x = -mul_fp64(a, a);
  r = x;
  s = sum_fp64(vec2(1.0, 0.0), r * 0.5);

  r = mul_fp64(r, x);
  t = mul_fp64(r, INVERSE_FACTORIAL_4_FP64);
  s = sum_fp64(s, t);

  r = mul_fp64(r, x);
  t = mul_fp64(r, INVERSE_FACTORIAL_6_FP64);
  s = sum_fp64(s, t);






  return s;
}

void sincos_taylor_fp64(vec2 a, out vec2 sin_t, out vec2 cos_t) {
  if (a.x == 0.0 && a.y == 0.0) {
    sin_t = vec2(0.0, 0.0);
    cos_t = vec2(1.0, 0.0);
  }

  sin_t = sin_taylor_fp64(a);
  cos_t = sqrt_fp64(sub_fp64(vec2(1.0, 0.0), mul_fp64(sin_t, sin_t)));
}

vec2 sin_fp64(vec2 a) {
    if (a.x == 0.0 && a.y == 0.0) {
        return vec2(0.0, 0.0);
    }
    vec2 z = nint_fp64(div_fp64(a, TWO_PI_FP64));
    vec2 r = sub_fp64(a, mul_fp64(TWO_PI_FP64, z));

    vec2 t;
    float q = floor(r.x / PI_2_FP64.x + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return vec2(0.0 / 0.0, 0.0 / 0.0);
    }

    t = sub_fp64(r, mul_fp64(PI_2_FP64, vec2(q, 0.0)));

    q = floor(t.x / PI_16_FP64.x + 0.5);
    int k = int(q);

    if (k == 0) {
        if (j == 0) {
            return sin_taylor_fp64(t);
        } else if (j == 1) {
            return cos_taylor_fp64(t);
        } else if (j == -1) {
            return -cos_taylor_fp64(t);
        } else {
            return -sin_taylor_fp64(t);
        }
    }

    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return vec2(0.0 / 0.0, 0.0 / 0.0);
    } else {
        t = sub_fp64(t, mul_fp64(PI_16_FP64, vec2(q, 0.0)));
    }

    vec2 u = vec2(0.0, 0.0);
    vec2 v = vec2(0.0, 0.0);

#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)
    if (abs(float(abs_k) - 1.0) < 0.5) {
        u = COS_TABLE_0_FP64;
        v = SIN_TABLE_0_FP64;
    } else if (abs(float(abs_k) - 2.0) < 0.5) {
        u = COS_TABLE_1_FP64;
        v = SIN_TABLE_1_FP64;
    } else if (abs(float(abs_k) - 3.0) < 0.5) {
        u = COS_TABLE_2_FP64;
        v = SIN_TABLE_2_FP64;
    } else if (abs(float(abs_k) - 4.0) < 0.5) {
        u = COS_TABLE_3_FP64;
        v = SIN_TABLE_3_FP64;
    }
#else
    if (abs_k == 1) {
        u = COS_TABLE_0_FP64;
        v = SIN_TABLE_0_FP64;
    } else if (abs_k == 2) {
        u = COS_TABLE_1_FP64;
        v = SIN_TABLE_1_FP64;
    } else if (abs_k == 3) {
        u = COS_TABLE_2_FP64;
        v = SIN_TABLE_2_FP64;
    } else if (abs_k == 4) {
        u = COS_TABLE_3_FP64;
        v = SIN_TABLE_3_FP64;
    }
#endif

    vec2 sin_t, cos_t;
    sincos_taylor_fp64(t, sin_t, cos_t);



    vec2 result = vec2(0.0, 0.0);
    if (j == 0) {
        if (k > 0) {
            result = sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));
        } else {
            result = sub_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));
        }
    } else if (j == 1) {
        if (k > 0) {
            result = sub_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));
        } else {
            result = sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));
        }
    } else if (j == -1) {
        if (k > 0) {
            result = sub_fp64(mul_fp64(v, sin_t), mul_fp64(u, cos_t));
        } else {
            result = -sum_fp64(mul_fp64(v, sin_t), mul_fp64(u, cos_t));
        }
    } else {
        if (k > 0) {
            result = -sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));
        } else {
            result = sub_fp64(mul_fp64(v, cos_t), mul_fp64(u, sin_t));
        }
    }

    return result;
}

vec2 cos_fp64(vec2 a) {
    if (a.x == 0.0 && a.y == 0.0) {
        return vec2(1.0, 0.0);
    }
    vec2 z = nint_fp64(div_fp64(a, TWO_PI_FP64));
    vec2 r = sub_fp64(a, mul_fp64(TWO_PI_FP64, z));

    vec2 t;
    float q = floor(r.x / PI_2_FP64.x + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return vec2(0.0 / 0.0, 0.0 / 0.0);
    }

    t = sub_fp64(r, mul_fp64(PI_2_FP64, vec2(q, 0.0)));

    q = floor(t.x / PI_16_FP64.x + 0.5);
    int k = int(q);

    if (k == 0) {
        if (j == 0) {
            return cos_taylor_fp64(t);
        } else if (j == 1) {
            return -sin_taylor_fp64(t);
        } else if (j == -1) {
            return sin_taylor_fp64(t);
        } else {
            return -cos_taylor_fp64(t);
        }
    }

    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return vec2(0.0 / 0.0, 0.0 / 0.0);
    } else {
        t = sub_fp64(t, mul_fp64(PI_16_FP64, vec2(q, 0.0)));
    }

    vec2 u = vec2(0.0, 0.0);
    vec2 v = vec2(0.0, 0.0);

#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)
    if (abs(float(abs_k) - 1.0) < 0.5) {
        u = COS_TABLE_0_FP64;
        v = SIN_TABLE_0_FP64;
    } else if (abs(float(abs_k) - 2.0) < 0.5) {
        u = COS_TABLE_1_FP64;
        v = SIN_TABLE_1_FP64;
    } else if (abs(float(abs_k) - 3.0) < 0.5) {
        u = COS_TABLE_2_FP64;
        v = SIN_TABLE_2_FP64;
    } else if (abs(float(abs_k) - 4.0) < 0.5) {
        u = COS_TABLE_3_FP64;
        v = SIN_TABLE_3_FP64;
    }
#else
    if (abs_k == 1) {
        u = COS_TABLE_0_FP64;
        v = SIN_TABLE_0_FP64;
    } else if (abs_k == 2) {
        u = COS_TABLE_1_FP64;
        v = SIN_TABLE_1_FP64;
    } else if (abs_k == 3) {
        u = COS_TABLE_2_FP64;
        v = SIN_TABLE_2_FP64;
    } else if (abs_k == 4) {
        u = COS_TABLE_3_FP64;
        v = SIN_TABLE_3_FP64;
    }
#endif

    vec2 sin_t, cos_t;
    sincos_taylor_fp64(t, sin_t, cos_t);

    vec2 result = vec2(0.0, 0.0);
    if (j == 0) {
        if (k > 0) {
            result = sub_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));
        } else {
            result = sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));
        }
    } else if (j == 1) {
        if (k > 0) {
            result = -sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));
        } else {
            result = sub_fp64(mul_fp64(v, cos_t), mul_fp64(u, sin_t));
        }
    } else if (j == -1) {
        if (k > 0) {
            result = sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));
        } else {
            result = sub_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));
        }
    } else {
        if (k > 0) {
            result = sub_fp64(mul_fp64(v, sin_t), mul_fp64(u, cos_t));
        } else {
            result = -sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));
        }
    }

    return result;
}

vec2 tan_fp64(vec2 a) {
    vec2 sin_a;
    vec2 cos_a;

    if (a.x == 0.0 && a.y == 0.0) {
        return vec2(0.0, 0.0);
    }
    vec2 z = nint_fp64(div_fp64(a, TWO_PI_FP64));
    vec2 r = sub_fp64(a, mul_fp64(TWO_PI_FP64, z));

    vec2 t;
    float q = floor(r.x / PI_2_FP64.x + 0.5);
    int j = int(q);


    if (j < -2 || j > 2) {
        return vec2(0.0 / 0.0, 0.0 / 0.0);
    }

    t = sub_fp64(r, mul_fp64(PI_2_FP64, vec2(q, 0.0)));

    q = floor(t.x / PI_16_FP64.x + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return vec2(0.0 / 0.0, 0.0 / 0.0);
    } else {
        t = sub_fp64(t, mul_fp64(PI_16_FP64, vec2(q, 0.0)));
    }


    vec2 u = vec2(0.0, 0.0);
    vec2 v = vec2(0.0, 0.0);

    vec2 sin_t, cos_t;
    vec2 s, c;
    sincos_taylor_fp64(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0_FP64;
            v = SIN_TABLE_0_FP64;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1_FP64;
            v = SIN_TABLE_1_FP64;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2_FP64;
            v = SIN_TABLE_2_FP64;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3_FP64;
            v = SIN_TABLE_3_FP64;
        }
#else
        if (abs_k == 1) {
            u = COS_TABLE_0_FP64;
            v = SIN_TABLE_0_FP64;
        } else if (abs_k == 2) {
            u = COS_TABLE_1_FP64;
            v = SIN_TABLE_1_FP64;
        } else if (abs_k == 3) {
            u = COS_TABLE_2_FP64;
            v = SIN_TABLE_2_FP64;
        } else if (abs_k == 4) {
            u = COS_TABLE_3_FP64;
            v = SIN_TABLE_3_FP64;
        }
#endif
        if (k > 0) {
            s = sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));
            c = sub_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));
        } else {
            s = sub_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));
            c = sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return div_fp64(sin_a, cos_a);
}

vec2 radians_fp64(vec2 degree) {
  return mul_fp64(degree, PI_180_FP64);
}

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void vec2_sum_fp64(vec2 a[2], vec2 b[2], out vec2 out_val[2]) {
    out_val[0] = sum_fp64(a[0], b[0]);
    out_val[1] = sum_fp64(a[1], b[1]);
}

void vec2_sub_fp64(vec2 a[2], vec2 b[2], out vec2 out_val[2]) {
    out_val[0] = sub_fp64(a[0], b[0]);
    out_val[1] = sub_fp64(a[1], b[1]);
}

void vec2_mul_fp64(vec2 a[2], vec2 b[2], out vec2 out_val[2]) {
    out_val[0] = mul_fp64(a[0], b[0]);
    out_val[1] = mul_fp64(a[1], b[1]);
}

void vec2_div_fp64(vec2 a[2], vec2 b[2], out vec2 out_val[2]) {
    out_val[0] = div_fp64(a[0], b[0]);
    out_val[1] = div_fp64(a[1], b[1]);
}

void vec2_mix_fp64(vec2 x[2], vec2 y[2], float a, out vec2 out_val[2]) {
  vec2 range[2];
  vec2_sub_fp64(y, x, range);
  vec2 portion[2];
  portion[0] = range[0] * a;
  portion[1] = range[1] * a;
  vec2_sum_fp64(x, portion, out_val);
}

vec2 vec2_length_fp64(vec2 x[2]) {
  return sqrt_fp64(sum_fp64(mul_fp64(x[0], x[0]), mul_fp64(x[1], x[1])));
}

void vec2_normalize_fp64(vec2 x[2], out vec2 out_val[2]) {
  vec2 length = vec2_length_fp64(x);
  vec2 length_vec2[2];
  length_vec2[0] = length;
  length_vec2[1] = length;

  vec2_div_fp64(x, length_vec2, out_val);
}

vec2 vec2_distance_fp64(vec2 x[2], vec2 y[2]) {
  vec2 diff[2];
  vec2_sub_fp64(x, y, diff);
  return vec2_length_fp64(diff);
}

vec2 vec2_dot_fp64(vec2 a[2], vec2 b[2]) {
  vec2 v[2];

  v[0] = mul_fp64(a[0], b[0]);
  v[1] = mul_fp64(a[1], b[1]);

  return sum_fp64(v[0], v[1]);
}
void vec3_sub_fp64(vec2 a[3], vec2 b[3], out vec2 out_val[3]) {
  for (int i = 0; i < 3; i++) {
    out_val[i] = sum_fp64(a[i], b[i]);
  }
}

void vec3_sum_fp64(vec2 a[3], vec2 b[3], out vec2 out_val[3]) {
  for (int i = 0; i < 3; i++) {
    out_val[i] = sum_fp64(a[i], b[i]);
  }
}

vec2 vec3_length_fp64(vec2 x[3]) {
  return sqrt_fp64(sum_fp64(sum_fp64(mul_fp64(x[0], x[0]), mul_fp64(x[1], x[1])),
    mul_fp64(x[2], x[2])));
}

vec2 vec3_distance_fp64(vec2 x[3], vec2 y[3]) {
  vec2 diff[3];
  vec3_sub_fp64(x, y, diff);
  return vec3_length_fp64(diff);
}
void vec4_fp64(vec4 a, out vec2 out_val[4]) {
  out_val[0].x = a[0];
  out_val[0].y = 0.0;

  out_val[1].x = a[1];
  out_val[1].y = 0.0;

  out_val[2].x = a[2];
  out_val[2].y = 0.0;

  out_val[3].x = a[3];
  out_val[3].y = 0.0;
}

void vec4_scalar_mul_fp64(vec2 a[4], vec2 b, out vec2 out_val[4]) {
  out_val[0] = mul_fp64(a[0], b);
  out_val[1] = mul_fp64(a[1], b);
  out_val[2] = mul_fp64(a[2], b);
  out_val[3] = mul_fp64(a[3], b);
}

void vec4_sum_fp64(vec2 a[4], vec2 b[4], out vec2 out_val[4]) {
  for (int i = 0; i < 4; i++) {
    out_val[i] = sum_fp64(a[i], b[i]);
  }
}

void vec4_dot_fp64(vec2 a[4], vec2 b[4], out vec2 out_val) {
  vec2 v[4];

  v[0] = mul_fp64(a[0], b[0]);
  v[1] = mul_fp64(a[1], b[1]);
  v[2] = mul_fp64(a[2], b[2]);
  v[3] = mul_fp64(a[3], b[3]);

  out_val = sum_fp64(sum_fp64(v[0], v[1]), sum_fp64(v[2], v[3]));
}

void mat4_vec4_mul_fp64(vec2 b[16], vec2 a[4], out vec2 out_val[4]) {
  vec2 tmp[4];

  for (int i = 0; i < 4; i++)
  {
    for (int j = 0; j < 4; j++)
    {
      tmp[j] = b[j + i * 4];
    }
    vec4_dot_fp64(a, tmp, out_val[i]);
  }
}
`;var Jge={ONE:1};function Qge(){return Jge}var Ts={name:"fp64-arithmetic",vs:ID,fs:null,getUniforms:Qge,fp64ify:xm,fp64LowPart:aS,fp64ifyMatrix4:oS},pl={name:"fp64",vs:RD,fs:null,dependencies:[Ts],fp64ify:xm,fp64LowPart:aS,fp64ifyMatrix4:oS};function $t(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function LD(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Xt(t,r,e){return r&&LD(t.prototype,r),e&&LD(t,e),t}function bp(t,r){return bp=Object.setPrototypeOf||function(n,i){return n.__proto__=i,n},bp(t,r)}function ar(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&bp(t,r)}function ws(t){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?ws=function(e){return typeof e}:ws=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ws(t)}function sS(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function or(t,r){if(r&&(ws(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return sS(t)}function lt(t){return lt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},lt(t)}function Ke(t,r){if(!t)throw new Error("math.gl assertion ".concat(r))}var eye=1/Math.PI*180,tye=1/180*Math.PI,ft={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function xp(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=r.precision,n=e===void 0?ft.precision:e;return t=rye(t),"".concat(parseFloat(t.toPrecision(n)))}function Dr(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function uS(t){return Ps(t)}function lS(t){return vr(t)}function Ps(t,r){return fS(t,function(e){return e*tye},r)}function vr(t,r){return fS(t,function(e){return e*eye},r)}function We(t,r,e){return fS(t,function(n){return Math.max(r,Math.min(e,n))})}function sr(t,r,e){return Dr(t)?t.map(function(n,i){return sr(n,r[i],e)}):e*r+(1-e)*t}function tt(t,r,e){var n=ft.EPSILON;e&&(ft.EPSILON=e);try{if(t===r)return!0;if(Dr(t)&&Dr(r)){if(t.length!==r.length)return!1;for(var i=0;i<t.length;++i)if(!tt(t[i],r[i]))return!1;return!0}return t&&t.equals?t.equals(r):r&&r.equals?r.equals(t):typeof t=="number"&&typeof r=="number"?Math.abs(t-r)<=ft.EPSILON*Math.max(1,Math.abs(t),Math.abs(r)):!1}finally{ft.EPSILON=n}}function rye(t){return Math.round(t/ft.EPSILON)*ft.EPSILON}function nye(t){return t.clone?t.clone():new Array(t.length)}function fS(t,r,e){if(Dr(t)){var n=t;e=e||nye(n);for(var i=0;i<e.length&&i<n.length;++i)e[i]=r(t[i],i,e);return e}return r(t)}function iye(t){var r=aye();return function(){var n=lt(t),i;if(r){var a=lt(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return or(this,i)}}function aye(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function oye(t){function r(){var e=Reflect.construct(t,Array.from(arguments));return Object.setPrototypeOf(e,Object.getPrototypeOf(this)),e}return r.prototype=Object.create(t.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(r,t):r.__proto__=t,r}var hl=function(t){ar(e,t);var r=iye(e);function e(){return $t(this,e),r.apply(this,arguments)}return Xt(e,[{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"fromArray",value:function(i){for(var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,o=0;o<this.ELEMENTS;++o)this[o]=i[o+a];return this.check()}},{key:"toArray",value:function(){for(var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,o=0;o<this.ELEMENTS;++o)i[a+o]=this[o];return i}},{key:"from",value:function(i){return Array.isArray(i)?this.copy(i):this.fromObject(i)}},{key:"to",value:function(i){return i===this?this:Dr(i)?this.toArray(i):this.toObject(i)}},{key:"toTarget",value:function(i){return i?this.to(i):this}},{key:"toFloat32Array",value:function(){return new Float32Array(this)}},{key:"toString",value:function(){return this.formatString(ft)}},{key:"formatString",value:function(i){for(var a="",o=0;o<this.ELEMENTS;++o)a+=(o>0?", ":"")+xp(this[o],i);return"".concat(i.printTypes?this.constructor.name:"","[").concat(a,"]")}},{key:"equals",value:function(i){if(!i||this.length!==i.length)return!1;for(var a=0;a<this.ELEMENTS;++a)if(!tt(this[a],i[a]))return!1;return!0}},{key:"exactEquals",value:function(i){if(!i||this.length!==i.length)return!1;for(var a=0;a<this.ELEMENTS;++a)if(this[a]!==i[a])return!1;return!0}},{key:"negate",value:function(){for(var i=0;i<this.ELEMENTS;++i)this[i]=-this[i];return this.check()}},{key:"lerp",value:function(i,a,o){if(o===void 0)return this.lerp(this,i,a);for(var s=0;s<this.ELEMENTS;++s){var u=i[s];this[s]=u+o*(a[s]-u)}return this.check()}},{key:"min",value:function(i){for(var a=0;a<this.ELEMENTS;++a)this[a]=Math.min(i[a],this[a]);return this.check()}},{key:"max",value:function(i){for(var a=0;a<this.ELEMENTS;++a)this[a]=Math.max(i[a],this[a]);return this.check()}},{key:"clamp",value:function(i,a){for(var o=0;o<this.ELEMENTS;++o)this[o]=Math.min(Math.max(this[o],i[o]),a[o]);return this.check()}},{key:"add",value:function(){for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];for(var s=0,u=a;s<u.length;s++)for(var l=u[s],f=0;f<this.ELEMENTS;++f)this[f]+=l[f];return this.check()}},{key:"subtract",value:function(){for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];for(var s=0,u=a;s<u.length;s++)for(var l=u[s],f=0;f<this.ELEMENTS;++f)this[f]-=l[f];return this.check()}},{key:"scale",value:function(i){if(typeof i=="number")for(var a=0;a<this.ELEMENTS;++a)this[a]*=i;else for(var o=0;o<this.ELEMENTS&&o<i.length;++o)this[o]*=i[o];return this.check()}},{key:"multiplyByScalar",value:function(i){for(var a=0;a<this.ELEMENTS;++a)this[a]*=i;return this.check()}},{key:"check",value:function(){if(ft.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}},{key:"validate",value:function(){for(var i=this.length===this.ELEMENTS,a=0;a<this.ELEMENTS;++a)i=i&&Number.isFinite(this[a]);return i}},{key:"sub",value:function(i){return this.subtract(i)}},{key:"setScalar",value:function(i){for(var a=0;a<this.ELEMENTS;++a)this[a]=i;return this.check()}},{key:"addScalar",value:function(i){for(var a=0;a<this.ELEMENTS;++a)this[a]+=i;return this.check()}},{key:"subScalar",value:function(i){return this.addScalar(-i)}},{key:"multiplyScalar",value:function(i){for(var a=0;a<this.ELEMENTS;++a)this[a]*=i;return this.check()}},{key:"divideScalar",value:function(i){return this.multiplyByScalar(1/i)}},{key:"clampScalar",value:function(i,a){for(var o=0;o<this.ELEMENTS;++o)this[o]=Math.min(Math.max(this[o],i),a);return this.check()}},{key:"elements",get:function(){return this}}]),e}(oye(Array));function sye(t,r){if(t.length!==r)return!1;for(var e=0;e<t.length;++e)if(!Number.isFinite(t[e]))return!1;return!0}function Ve(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function mo(t,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";if(ft.debug&&!sye(t,r))throw new Error("math.gl: ".concat(e," some fields set to invalid numbers'"));return t}function uye(t){var r=lye();return function(){var n=lt(t),i;if(r){var a=lt(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return or(this,i)}}function lye(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var dl=function(t){ar(e,t);var r=uye(e);function e(){return $t(this,e),r.apply(this,arguments)}return Xt(e,[{key:"x",get:function(){return this[0]},set:function(i){this[0]=Ve(i)}},{key:"y",get:function(){return this[1]},set:function(i){this[1]=Ve(i)}},{key:"len",value:function(){return Math.sqrt(this.lengthSquared())}},{key:"magnitude",value:function(){return this.len()}},{key:"lengthSquared",value:function(){for(var i=0,a=0;a<this.ELEMENTS;++a)i+=this[a]*this[a];return i}},{key:"magnitudeSquared",value:function(){return this.lengthSquared()}},{key:"distance",value:function(i){return Math.sqrt(this.distanceSquared(i))}},{key:"distanceSquared",value:function(i){for(var a=0,o=0;o<this.ELEMENTS;++o){var s=this[o]-i[o];a+=s*s}return Ve(a)}},{key:"dot",value:function(i){for(var a=0,o=0;o<this.ELEMENTS;++o)a+=this[o]*i[o];return Ve(a)}},{key:"normalize",value:function(){var i=this.magnitude();if(i!==0)for(var a=0;a<this.ELEMENTS;++a)this[a]/=i;return this.check()}},{key:"multiply",value:function(){for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];for(var s=0,u=a;s<u.length;s++)for(var l=u[s],f=0;f<this.ELEMENTS;++f)this[f]*=l[f];return this.check()}},{key:"divide",value:function(){for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];for(var s=0,u=a;s<u.length;s++)for(var l=u[s],f=0;f<this.ELEMENTS;++f)this[f]/=l[f];return this.check()}},{key:"lengthSq",value:function(){return this.lengthSquared()}},{key:"distanceTo",value:function(i){return this.distance(i)}},{key:"distanceToSquared",value:function(i){return this.distanceSquared(i)}},{key:"getComponent",value:function(i){return Ke(i>=0&&i<this.ELEMENTS,"index is out of range"),Ve(this[i])}},{key:"setComponent",value:function(i,a){return Ke(i>=0&&i<this.ELEMENTS,"index is out of range"),this[i]=a,this.check()}},{key:"addVectors",value:function(i,a){return this.copy(i).add(a)}},{key:"subVectors",value:function(i,a){return this.copy(i).subtract(a)}},{key:"multiplyVectors",value:function(i,a){return this.copy(i).multiply(a)}},{key:"addScaledVector",value:function(i,a){return this.add(new this.constructor(i).multiplyScalar(a))}}]),e}(hl);var dt=1e-6,xr=typeof Float32Array<"u"?Float32Array:Array;var fWe=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,r=arguments.length;r--;)t+=arguments[r]*arguments[r];return Math.sqrt(t)});function fye(){var t=new xr(2);return xr!=Float32Array&&(t[0]=0,t[1]=0),t}function Ap(t,r,e){return t[0]=r[0]+e[0],t[1]=r[1]+e[1],t}function cye(t,r,e){return t[0]=r[0]-e[0],t[1]=r[1]-e[1],t}function kD(t,r,e){return t[0]=r[0]*e,t[1]=r[1]*e,t}function BD(t){var r=t[0],e=t[1];return Math.hypot(r,e)}function FD(t,r){return t[0]=-r[0],t[1]=-r[1],t}function Am(t,r,e,n){var i=r[0],a=r[1];return t[0]=i+n*(e[0]-i),t[1]=a+n*(e[1]-a),t}function DD(t,r,e){var n=r[0],i=r[1];return t[0]=e[0]*n+e[2]*i,t[1]=e[1]*n+e[3]*i,t}function ND(t,r,e){var n=r[0],i=r[1];return t[0]=e[0]*n+e[2]*i+e[4],t[1]=e[1]*n+e[3]*i+e[5],t}function Sm(t,r,e){var n=r[0],i=r[1];return t[0]=e[0]*n+e[3]*i+e[6],t[1]=e[1]*n+e[4]*i+e[7],t}function Tm(t,r,e){var n=r[0],i=r[1];return t[0]=e[0]*n+e[4]*i+e[12],t[1]=e[1]*n+e[5]*i+e[13],t}var jD=cye;var cWe=function(){var t=fye();return function(r,e,n,i,a,o){var s,u;for(e||(e=2),n||(n=0),i?u=Math.min(i*e+n,r.length):u=r.length,s=n;s<u;s+=e)t[0]=r[s],t[1]=r[s+1],a(t,t,o),r[s]=t[0],r[s+1]=t[1];return r}}();function wm(t,r,e){var n=r[0],i=r[1],a=e[3]*n+e[7]*i||1;return t[0]=(e[0]*n+e[4]*i)/a,t[1]=(e[1]*n+e[5]*i)/a,t}function Pm(t,r,e){var n=r[0],i=r[1],a=r[2],o=e[3]*n+e[7]*i+e[11]*a||1;return t[0]=(e[0]*n+e[4]*i+e[8]*a)/o,t[1]=(e[1]*n+e[5]*i+e[9]*a)/o,t[2]=(e[2]*n+e[6]*i+e[10]*a)/o,t}function UD(t,r,e){var n=r[0],i=r[1];return t[0]=e[0]*n+e[2]*i,t[1]=e[1]*n+e[3]*i,t[2]=r[2],t}function GD(t,r,e){var n=r[0],i=r[1];return t[0]=e[0]*n+e[2]*i,t[1]=e[1]*n+e[3]*i,t[2]=r[2],t[3]=r[3],t}function Om(t,r,e){var n=r[0],i=r[1],a=r[2];return t[0]=e[0]*n+e[3]*i+e[6]*a,t[1]=e[1]*n+e[4]*i+e[7]*a,t[2]=e[2]*n+e[5]*i+e[8]*a,t[3]=r[3],t}function pye(t){var r=hye();return function(){var n=lt(t),i;if(r){var a=lt(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return or(this,i)}}function hye(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ri=function(t){ar(e,t);var r=pye(e);function e(){var n,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return $t(this,e),n=r.call(this,2),Dr(i)&&arguments.length===1?n.copy(i):(ft.debug&&(Ve(i),Ve(a)),n[0]=i,n[1]=a),n}return Xt(e,[{key:"set",value:function(i,a){return this[0]=i,this[1]=a,this.check()}},{key:"copy",value:function(i){return this[0]=i[0],this[1]=i[1],this.check()}},{key:"fromObject",value:function(i){return ft.debug&&(Ve(i.x),Ve(i.y)),this[0]=i.x,this[1]=i.y,this.check()}},{key:"toObject",value:function(i){return i.x=this[0],i.y=this[1],i}},{key:"ELEMENTS",get:function(){return 2}},{key:"horizontalAngle",value:function(){return Math.atan2(this.y,this.x)}},{key:"verticalAngle",value:function(){return Math.atan2(this.x,this.y)}},{key:"transform",value:function(i){return this.transformAsPoint(i)}},{key:"transformAsPoint",value:function(i){return Tm(this,this,i),this.check()}},{key:"transformAsVector",value:function(i){return wm(this,this,i),this.check()}},{key:"transformByMatrix3",value:function(i){return Sm(this,this,i),this.check()}},{key:"transformByMatrix2x3",value:function(i){return ND(this,this,i),this.check()}},{key:"transformByMatrix2",value:function(i){return DD(this,this,i),this.check()}}]),e}(dl);function pS(){var t=new xr(3);return xr!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Sp(t){var r=t[0],e=t[1],n=t[2];return Math.hypot(r,e,n)}function hS(t,r,e){var n=new xr(3);return n[0]=t,n[1]=r,n[2]=e,n}function zD(t,r,e){return t[0]=r[0]+e[0],t[1]=r[1]+e[1],t[2]=r[2]+e[2],t}function dye(t,r,e){return t[0]=r[0]*e[0],t[1]=r[1]*e[1],t[2]=r[2]*e[2],t}function vye(t,r){var e=r[0]-t[0],n=r[1]-t[1],i=r[2]-t[2];return Math.hypot(e,n,i)}function VD(t,r){return t[0]=-r[0],t[1]=-r[1],t[2]=-r[2],t}function HD(t,r){var e=r[0],n=r[1],i=r[2],a=e*e+n*n+i*i;return a>0&&(a=1/Math.sqrt(a)),t[0]=r[0]*a,t[1]=r[1]*a,t[2]=r[2]*a,t}function Tp(t,r){return t[0]*r[0]+t[1]*r[1]+t[2]*r[2]}function ml(t,r,e){var n=r[0],i=r[1],a=r[2],o=e[0],s=e[1],u=e[2];return t[0]=i*u-a*s,t[1]=a*o-n*u,t[2]=n*s-i*o,t}function gl(t,r,e){var n=r[0],i=r[1],a=r[2],o=e[3]*n+e[7]*i+e[11]*a+e[15];return o=o||1,t[0]=(e[0]*n+e[4]*i+e[8]*a+e[12])/o,t[1]=(e[1]*n+e[5]*i+e[9]*a+e[13])/o,t[2]=(e[2]*n+e[6]*i+e[10]*a+e[14])/o,t}function Em(t,r,e){var n=r[0],i=r[1],a=r[2];return t[0]=n*e[0]+i*e[3]+a*e[6],t[1]=n*e[1]+i*e[4]+a*e[7],t[2]=n*e[2]+i*e[5]+a*e[8],t}function Cm(t,r,e){var n=e[0],i=e[1],a=e[2],o=e[3],s=r[0],u=r[1],l=r[2],f=i*l-a*u,c=a*s-n*l,p=n*u-i*s,d=i*p-a*c,v=a*f-n*p,m=n*c-i*f,g=o*2;return f*=g,c*=g,p*=g,d*=2,v*=2,m*=2,t[0]=s+f+d,t[1]=u+c+v,t[2]=l+p+m,t}function WD(t,r,e,n){var i=[],a=[];return i[0]=r[0]-e[0],i[1]=r[1]-e[1],i[2]=r[2]-e[2],a[0]=i[0],a[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),a[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),t[0]=a[0]+e[0],t[1]=a[1]+e[1],t[2]=a[2]+e[2],t}function $D(t,r,e,n){var i=[],a=[];return i[0]=r[0]-e[0],i[1]=r[1]-e[1],i[2]=r[2]-e[2],a[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),a[1]=i[1],a[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),t[0]=a[0]+e[0],t[1]=a[1]+e[1],t[2]=a[2]+e[2],t}function XD(t,r,e,n){var i=[],a=[];return i[0]=r[0]-e[0],i[1]=r[1]-e[1],i[2]=r[2]-e[2],a[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),a[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),a[2]=i[2],t[0]=a[0]+e[0],t[1]=a[1]+e[1],t[2]=a[2]+e[2],t}function qD(t,r){var e=t[0],n=t[1],i=t[2],a=r[0],o=r[1],s=r[2],u=Math.sqrt(e*e+n*n+i*i),l=Math.sqrt(a*a+o*o+s*s),f=u*l,c=f&&Tp(t,r)/f;return Math.acos(Math.min(Math.max(c,-1),1))}var YD=dye;var KD=vye;var ZD=Sp;var SWe=function(){var t=pS();return function(r,e,n,i,a,o){var s,u;for(e||(e=3),n||(n=0),i?u=Math.min(i*e+n,r.length):u=r.length,s=n;s<u;s+=e)t[0]=r[s],t[1]=r[s+1],t[2]=r[s+2],a(t,t,o),r[s]=t[0],r[s+1]=t[1],r[s+2]=t[2];return r}}();function mye(t){var r=gye();return function(){var n=lt(t),i;if(r){var a=lt(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return or(this,i)}}function gye(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var dS=[0,0,0],Mm,j=function(t){ar(e,t);var r=mye(e);function e(){var n,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return $t(this,e),n=r.call(this,-0,-0,-0),arguments.length===1&&Dr(i)?n.copy(i):(ft.debug&&(Ve(i),Ve(a),Ve(o)),n[0]=i,n[1]=a,n[2]=o),n}return Xt(e,[{key:"set",value:function(i,a,o){return this[0]=i,this[1]=a,this[2]=o,this.check()}},{key:"copy",value:function(i){return this[0]=i[0],this[1]=i[1],this[2]=i[2],this.check()}},{key:"fromObject",value:function(i){return ft.debug&&(Ve(i.x),Ve(i.y),Ve(i.z)),this[0]=i.x,this[1]=i.y,this[2]=i.z,this.check()}},{key:"toObject",value:function(i){return i.x=this[0],i.y=this[1],i.z=this[2],i}},{key:"ELEMENTS",get:function(){return 3}},{key:"z",get:function(){return this[2]},set:function(i){this[2]=Ve(i)}},{key:"angle",value:function(i){return qD(this,i)}},{key:"cross",value:function(i){return ml(this,this,i),this.check()}},{key:"rotateX",value:function(i){var a=i.radians,o=i.origin,s=o===void 0?dS:o;return WD(this,this,s,a),this.check()}},{key:"rotateY",value:function(i){var a=i.radians,o=i.origin,s=o===void 0?dS:o;return $D(this,this,s,a),this.check()}},{key:"rotateZ",value:function(i){var a=i.radians,o=i.origin,s=o===void 0?dS:o;return XD(this,this,s,a),this.check()}},{key:"transform",value:function(i){return this.transformAsPoint(i)}},{key:"transformAsPoint",value:function(i){return gl(this,this,i),this.check()}},{key:"transformAsVector",value:function(i){return Pm(this,this,i),this.check()}},{key:"transformByMatrix3",value:function(i){return Em(this,this,i),this.check()}},{key:"transformByMatrix2",value:function(i){return UD(this,this,i),this.check()}},{key:"transformByQuaternion",value:function(i){return Cm(this,this,i),this.check()}}],[{key:"ZERO",get:function(){return Mm||(Mm=new e(0,0,0),Object.freeze(Mm)),Mm}}]),e}(dl);function yye(t){var r=_ye();return function(){var n=lt(t),i;if(r){var a=lt(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return or(this,i)}}function _ye(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Im,JD=function(t){ar(e,t);var r=yye(e);function e(){var n,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;return $t(this,e),n=r.call(this,-0,-0,-0,-0),Dr(i)&&arguments.length===1?n.copy(i):(ft.debug&&(Ve(i),Ve(a),Ve(o),Ve(s)),n[0]=i,n[1]=a,n[2]=o,n[3]=s),n}return Xt(e,[{key:"set",value:function(i,a,o,s){return this[0]=i,this[1]=a,this[2]=o,this[3]=s,this.check()}},{key:"copy",value:function(i){return this[0]=i[0],this[1]=i[1],this[2]=i[2],this[3]=i[3],this.check()}},{key:"fromObject",value:function(i){return ft.debug&&(Ve(i.x),Ve(i.y),Ve(i.z),Ve(i.w)),this[0]=i.x,this[1]=i.y,this[2]=i.z,this[3]=i.w,this}},{key:"toObject",value:function(i){return i.x=this[0],i.y=this[1],i.z=this[2],i.w=this[3],i}},{key:"ELEMENTS",get:function(){return 4}},{key:"z",get:function(){return this[2]},set:function(i){this[2]=Ve(i)}},{key:"w",get:function(){return this[3]},set:function(i){this[3]=Ve(i)}},{key:"transform",value:function(i){return gl(this,this,i),this.check()}},{key:"transformByMatrix3",value:function(i){return Om(this,this,i),this.check()}},{key:"transformByMatrix2",value:function(i){return GD(this,this,i),this.check()}},{key:"transformByQuaternion",value:function(i){return Cm(this,this,i),this.check()}},{key:"applyMatrix4",value:function(i){return i.transform(this,this),this}}],[{key:"ZERO",get:function(){return Im||(Im=new e(0,0,0,0),Object.freeze(Im)),Im}}]),e}(dl);function bye(t){var r=xye();return function(){var n=lt(t),i;if(r){var a=lt(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return or(this,i)}}function xye(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Rm=function(t){ar(e,t);var r=bye(e);function e(){return $t(this,e),r.apply(this,arguments)}return Xt(e,[{key:"toString",value:function(){var i="[";if(ft.printRowMajor){i+="row-major:";for(var a=0;a<this.RANK;++a)for(var o=0;o<this.RANK;++o)i+=" ".concat(this[o*this.RANK+a])}else{i+="column-major:";for(var s=0;s<this.ELEMENTS;++s)i+=" ".concat(this[s])}return i+="]",i}},{key:"getElementIndex",value:function(i,a){return a*this.RANK+i}},{key:"getElement",value:function(i,a){return this[a*this.RANK+i]}},{key:"setElement",value:function(i,a,o){return this[a*this.RANK+i]=Ve(o),this}},{key:"getColumn",value:function(i){for(var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Array(this.RANK).fill(-0),o=i*this.RANK,s=0;s<this.RANK;++s)a[s]=this[o+s];return a}},{key:"setColumn",value:function(i,a){for(var o=i*this.RANK,s=0;s<this.RANK;++s)this[o+s]=a[s];return this}}]),e}(hl);function QD(){var t=new xr(9);return xr!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function eN(t,r){if(t===r){var e=r[1],n=r[2],i=r[5];t[1]=r[3],t[2]=r[6],t[3]=e,t[5]=r[7],t[6]=n,t[7]=i}else t[0]=r[0],t[1]=r[3],t[2]=r[6],t[3]=r[1],t[4]=r[4],t[5]=r[7],t[6]=r[2],t[7]=r[5],t[8]=r[8];return t}function tN(t,r){var e=r[0],n=r[1],i=r[2],a=r[3],o=r[4],s=r[5],u=r[6],l=r[7],f=r[8],c=f*o-s*l,p=-f*a+s*u,d=l*a-o*u,v=e*c+n*p+i*d;return v?(v=1/v,t[0]=c*v,t[1]=(-f*n+i*l)*v,t[2]=(s*n-i*o)*v,t[3]=p*v,t[4]=(f*e-i*u)*v,t[5]=(-s*e+i*a)*v,t[6]=d*v,t[7]=(-l*e+n*u)*v,t[8]=(o*e-n*a)*v,t):null}function rN(t){var r=t[0],e=t[1],n=t[2],i=t[3],a=t[4],o=t[5],s=t[6],u=t[7],l=t[8];return r*(l*a-o*u)+e*(-l*i+o*s)+n*(u*i-a*s)}function vS(t,r,e){var n=r[0],i=r[1],a=r[2],o=r[3],s=r[4],u=r[5],l=r[6],f=r[7],c=r[8],p=e[0],d=e[1],v=e[2],m=e[3],g=e[4],y=e[5],_=e[6],b=e[7],x=e[8];return t[0]=p*n+d*o+v*l,t[1]=p*i+d*s+v*f,t[2]=p*a+d*u+v*c,t[3]=m*n+g*o+y*l,t[4]=m*i+g*s+y*f,t[5]=m*a+g*u+y*c,t[6]=_*n+b*o+x*l,t[7]=_*i+b*s+x*f,t[8]=_*a+b*u+x*c,t}function nN(t,r,e){var n=r[0],i=r[1],a=r[2],o=r[3],s=r[4],u=r[5],l=r[6],f=r[7],c=r[8],p=e[0],d=e[1];return t[0]=n,t[1]=i,t[2]=a,t[3]=o,t[4]=s,t[5]=u,t[6]=p*n+d*o+l,t[7]=p*i+d*s+f,t[8]=p*a+d*u+c,t}function iN(t,r,e){var n=r[0],i=r[1],a=r[2],o=r[3],s=r[4],u=r[5],l=r[6],f=r[7],c=r[8],p=Math.sin(e),d=Math.cos(e);return t[0]=d*n+p*o,t[1]=d*i+p*s,t[2]=d*a+p*u,t[3]=d*o-p*n,t[4]=d*s-p*i,t[5]=d*u-p*a,t[6]=l,t[7]=f,t[8]=c,t}function mS(t,r,e){var n=e[0],i=e[1];return t[0]=n*r[0],t[1]=n*r[1],t[2]=n*r[2],t[3]=i*r[3],t[4]=i*r[4],t[5]=i*r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t}function aN(t,r){var e=r[0],n=r[1],i=r[2],a=r[3],o=e+e,s=n+n,u=i+i,l=e*o,f=n*o,c=n*s,p=i*o,d=i*s,v=i*u,m=a*o,g=a*s,y=a*u;return t[0]=1-c-v,t[3]=f-y,t[6]=p+g,t[1]=f+y,t[4]=1-l-v,t[7]=d-m,t[2]=p-g,t[5]=d+m,t[8]=1-l-c,t}function Aye(t){var r=Sye();return function(){var n=lt(t),i;if(r){var a=lt(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return or(this,i)}}function Sye(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var gS;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL1ROW0=3]="COL1ROW0",t[t.COL1ROW1=4]="COL1ROW1",t[t.COL1ROW2=5]="COL1ROW2",t[t.COL2ROW0=6]="COL2ROW0",t[t.COL2ROW1=7]="COL2ROW1",t[t.COL2ROW2=8]="COL2ROW2"})(gS||(gS={}));var Tye=Object.freeze([1,0,0,0,1,0,0,0,1]),ct=function(t){ar(e,t);var r=Aye(e);function e(n){for(var i,a=arguments.length,o=new Array(a>1?a-1:0),s=1;s<a;s++)o[s-1]=arguments[s];return $t(this,e),i=r.call(this,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(n)?i.copy(n):o.length>0?i.copy([n].concat(o)):i.identity(),i}return Xt(e,[{key:"ELEMENTS",get:function(){return 9}},{key:"RANK",get:function(){return 3}},{key:"INDICES",get:function(){return gS}},{key:"copy",value:function(i){return this[0]=i[0],this[1]=i[1],this[2]=i[2],this[3]=i[3],this[4]=i[4],this[5]=i[5],this[6]=i[6],this[7]=i[7],this[8]=i[8],this.check()}},{key:"identity",value:function(){return this.copy(Tye)}},{key:"fromObject",value:function(i){return this.check()}},{key:"fromQuaternion",value:function(i){return aN(this,i),this.check()}},{key:"set",value:function(i,a,o,s,u,l,f,c,p){return this[0]=i,this[1]=a,this[2]=o,this[3]=s,this[4]=u,this[5]=l,this[6]=f,this[7]=c,this[8]=p,this.check()}},{key:"setRowMajor",value:function(i,a,o,s,u,l,f,c,p){return this[0]=i,this[1]=s,this[2]=f,this[3]=a,this[4]=u,this[5]=c,this[6]=o,this[7]=l,this[8]=p,this.check()}},{key:"determinant",value:function(){return rN(this)}},{key:"transpose",value:function(){return eN(this,this),this.check()}},{key:"invert",value:function(){return tN(this,this),this.check()}},{key:"multiplyLeft",value:function(i){return vS(this,i,this),this.check()}},{key:"multiplyRight",value:function(i){return vS(this,this,i),this.check()}},{key:"rotate",value:function(i){return iN(this,this,i),this.check()}},{key:"scale",value:function(i){return Array.isArray(i)?mS(this,this,i):mS(this,this,[i,i]),this.check()}},{key:"translate",value:function(i){return nN(this,this,i),this.check()}},{key:"transform",value:function(i,a){var o;switch(i.length){case 2:o=Sm(a||[-0,-0],i,this);break;case 3:o=Em(a||[-0,-0,-0],i,this);break;case 4:o=Om(a||[-0,-0,-0,-0],i,this);break;default:throw new Error("Illegal vector")}return mo(o,i.length),o}},{key:"transformVector",value:function(i,a){return this.transform(i,a)}},{key:"transformVector2",value:function(i,a){return this.transform(i,a)}},{key:"transformVector3",value:function(i,a){return this.transform(i,a)}}],[{key:"IDENTITY",get:function(){return Pye()}},{key:"ZERO",get:function(){return wye()}}]),e}(Rm);var Lm,km;function wye(){return Lm||(Lm=new ct([0,0,0,0,0,0,0,0,0]),Object.freeze(Lm)),Lm}function Pye(){return km||(km=new ct,Object.freeze(km)),km}function Oye(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function sN(t,r){if(t===r){var e=r[1],n=r[2],i=r[3],a=r[6],o=r[7],s=r[11];t[1]=r[4],t[2]=r[8],t[3]=r[12],t[4]=e,t[6]=r[9],t[7]=r[13],t[8]=n,t[9]=a,t[11]=r[14],t[12]=i,t[13]=o,t[14]=s}else t[0]=r[0],t[1]=r[4],t[2]=r[8],t[3]=r[12],t[4]=r[1],t[5]=r[5],t[6]=r[9],t[7]=r[13],t[8]=r[2],t[9]=r[6],t[10]=r[10],t[11]=r[14],t[12]=r[3],t[13]=r[7],t[14]=r[11],t[15]=r[15];return t}function Bm(t,r){var e=r[0],n=r[1],i=r[2],a=r[3],o=r[4],s=r[5],u=r[6],l=r[7],f=r[8],c=r[9],p=r[10],d=r[11],v=r[12],m=r[13],g=r[14],y=r[15],_=e*s-n*o,b=e*u-i*o,x=e*l-a*o,A=n*u-i*s,S=n*l-a*s,P=i*l-a*u,O=f*m-c*v,C=f*g-p*v,T=f*y-d*v,I=c*g-p*m,R=c*y-d*m,V=p*y-d*g,z=_*V-b*R+x*I+A*T-S*C+P*O;return z?(z=1/z,t[0]=(s*V-u*R+l*I)*z,t[1]=(i*R-n*V-a*I)*z,t[2]=(m*P-g*S+y*A)*z,t[3]=(p*S-c*P-d*A)*z,t[4]=(u*T-o*V-l*C)*z,t[5]=(e*V-i*T+a*C)*z,t[6]=(g*x-v*P-y*b)*z,t[7]=(f*P-p*x+d*b)*z,t[8]=(o*R-s*T+l*O)*z,t[9]=(n*T-e*R-a*O)*z,t[10]=(v*S-m*x+y*_)*z,t[11]=(c*x-f*S-d*_)*z,t[12]=(s*C-o*I-u*O)*z,t[13]=(e*I-n*C+i*O)*z,t[14]=(m*b-v*A-g*_)*z,t[15]=(f*A-c*b+p*_)*z,t):null}function uN(t){var r=t[0],e=t[1],n=t[2],i=t[3],a=t[4],o=t[5],s=t[6],u=t[7],l=t[8],f=t[9],c=t[10],p=t[11],d=t[12],v=t[13],m=t[14],g=t[15],y=r*o-e*a,_=r*s-n*a,b=r*u-i*a,x=e*s-n*o,A=e*u-i*o,S=n*u-i*s,P=l*v-f*d,O=l*m-c*d,C=l*g-p*d,T=f*m-c*v,I=f*g-p*v,R=c*g-p*m;return y*R-_*I+b*T+x*C-A*O+S*P}function Es(t,r,e){var n=r[0],i=r[1],a=r[2],o=r[3],s=r[4],u=r[5],l=r[6],f=r[7],c=r[8],p=r[9],d=r[10],v=r[11],m=r[12],g=r[13],y=r[14],_=r[15],b=e[0],x=e[1],A=e[2],S=e[3];return t[0]=b*n+x*s+A*c+S*m,t[1]=b*i+x*u+A*p+S*g,t[2]=b*a+x*l+A*d+S*y,t[3]=b*o+x*f+A*v+S*_,b=e[4],x=e[5],A=e[6],S=e[7],t[4]=b*n+x*s+A*c+S*m,t[5]=b*i+x*u+A*p+S*g,t[6]=b*a+x*l+A*d+S*y,t[7]=b*o+x*f+A*v+S*_,b=e[8],x=e[9],A=e[10],S=e[11],t[8]=b*n+x*s+A*c+S*m,t[9]=b*i+x*u+A*p+S*g,t[10]=b*a+x*l+A*d+S*y,t[11]=b*o+x*f+A*v+S*_,b=e[12],x=e[13],A=e[14],S=e[15],t[12]=b*n+x*s+A*c+S*m,t[13]=b*i+x*u+A*p+S*g,t[14]=b*a+x*l+A*d+S*y,t[15]=b*o+x*f+A*v+S*_,t}function Cs(t,r,e){var n=e[0],i=e[1],a=e[2],o,s,u,l,f,c,p,d,v,m,g,y;return r===t?(t[12]=r[0]*n+r[4]*i+r[8]*a+r[12],t[13]=r[1]*n+r[5]*i+r[9]*a+r[13],t[14]=r[2]*n+r[6]*i+r[10]*a+r[14],t[15]=r[3]*n+r[7]*i+r[11]*a+r[15]):(o=r[0],s=r[1],u=r[2],l=r[3],f=r[4],c=r[5],p=r[6],d=r[7],v=r[8],m=r[9],g=r[10],y=r[11],t[0]=o,t[1]=s,t[2]=u,t[3]=l,t[4]=f,t[5]=c,t[6]=p,t[7]=d,t[8]=v,t[9]=m,t[10]=g,t[11]=y,t[12]=o*n+f*i+v*a+r[12],t[13]=s*n+c*i+m*a+r[13],t[14]=u*n+p*i+g*a+r[14],t[15]=l*n+d*i+y*a+r[15]),t}function yl(t,r,e){var n=e[0],i=e[1],a=e[2];return t[0]=r[0]*n,t[1]=r[1]*n,t[2]=r[2]*n,t[3]=r[3]*n,t[4]=r[4]*i,t[5]=r[5]*i,t[6]=r[6]*i,t[7]=r[7]*i,t[8]=r[8]*a,t[9]=r[9]*a,t[10]=r[10]*a,t[11]=r[11]*a,t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t}function lN(t,r,e,n){var i=n[0],a=n[1],o=n[2],s=Math.hypot(i,a,o),u,l,f,c,p,d,v,m,g,y,_,b,x,A,S,P,O,C,T,I,R,V,z,k;return s<dt?null:(s=1/s,i*=s,a*=s,o*=s,u=Math.sin(e),l=Math.cos(e),f=1-l,c=r[0],p=r[1],d=r[2],v=r[3],m=r[4],g=r[5],y=r[6],_=r[7],b=r[8],x=r[9],A=r[10],S=r[11],P=i*i*f+l,O=a*i*f+o*u,C=o*i*f-a*u,T=i*a*f-o*u,I=a*a*f+l,R=o*a*f+i*u,V=i*o*f+a*u,z=a*o*f-i*u,k=o*o*f+l,t[0]=c*P+m*O+b*C,t[1]=p*P+g*O+x*C,t[2]=d*P+y*O+A*C,t[3]=v*P+_*O+S*C,t[4]=c*T+m*I+b*R,t[5]=p*T+g*I+x*R,t[6]=d*T+y*I+A*R,t[7]=v*T+_*I+S*R,t[8]=c*V+m*z+b*k,t[9]=p*V+g*z+x*k,t[10]=d*V+y*z+A*k,t[11]=v*V+_*z+S*k,r!==t&&(t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t)}function Fm(t,r,e){var n=Math.sin(e),i=Math.cos(e),a=r[4],o=r[5],s=r[6],u=r[7],l=r[8],f=r[9],c=r[10],p=r[11];return r!==t&&(t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t[4]=a*i+l*n,t[5]=o*i+f*n,t[6]=s*i+c*n,t[7]=u*i+p*n,t[8]=l*i-a*n,t[9]=f*i-o*n,t[10]=c*i-s*n,t[11]=p*i-u*n,t}function fN(t,r,e){var n=Math.sin(e),i=Math.cos(e),a=r[0],o=r[1],s=r[2],u=r[3],l=r[8],f=r[9],c=r[10],p=r[11];return r!==t&&(t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t[0]=a*i-l*n,t[1]=o*i-f*n,t[2]=s*i-c*n,t[3]=u*i-p*n,t[8]=a*n+l*i,t[9]=o*n+f*i,t[10]=s*n+c*i,t[11]=u*n+p*i,t}function Dm(t,r,e){var n=Math.sin(e),i=Math.cos(e),a=r[0],o=r[1],s=r[2],u=r[3],l=r[4],f=r[5],c=r[6],p=r[7];return r!==t&&(t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t[0]=a*i+l*n,t[1]=o*i+f*n,t[2]=s*i+c*n,t[3]=u*i+p*n,t[4]=l*i-a*n,t[5]=f*i-o*n,t[6]=c*i-s*n,t[7]=p*i-u*n,t}function cN(t,r){var e=r[0],n=r[1],i=r[2],a=r[4],o=r[5],s=r[6],u=r[8],l=r[9],f=r[10];return t[0]=Math.hypot(e,n,i),t[1]=Math.hypot(a,o,s),t[2]=Math.hypot(u,l,f),t}function pN(t,r){var e=r[0],n=r[1],i=r[2],a=r[3],o=e+e,s=n+n,u=i+i,l=e*o,f=n*o,c=n*s,p=i*o,d=i*s,v=i*u,m=a*o,g=a*s,y=a*u;return t[0]=1-c-v,t[1]=f+y,t[2]=p-g,t[3]=0,t[4]=f-y,t[5]=1-l-v,t[6]=d+m,t[7]=0,t[8]=p+g,t[9]=d-m,t[10]=1-l-c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function hN(t,r,e,n,i,a,o){var s=1/(e-r),u=1/(i-n),l=1/(a-o);return t[0]=a*2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a*2*u,t[6]=0,t[7]=0,t[8]=(e+r)*s,t[9]=(i+n)*u,t[10]=(o+a)*l,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*a*2*l,t[15]=0,t}function Eye(t,r,e,n,i){var a=1/Math.tan(r/2),o;return t[0]=a/e,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,i!=null&&i!==1/0?(o=1/(n-i),t[10]=(i+n)*o,t[14]=2*i*n*o):(t[10]=-1,t[14]=-2*n),t}var Nm=Eye;function Cye(t,r,e,n,i,a,o){var s=1/(r-e),u=1/(n-i),l=1/(a-o);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(r+e)*s,t[13]=(i+n)*u,t[14]=(o+a)*l,t[15]=1,t}var dN=Cye;function vN(t,r,e,n){var i,a,o,s,u,l,f,c,p,d,v=r[0],m=r[1],g=r[2],y=n[0],_=n[1],b=n[2],x=e[0],A=e[1],S=e[2];return Math.abs(v-x)<dt&&Math.abs(m-A)<dt&&Math.abs(g-S)<dt?Oye(t):(f=v-x,c=m-A,p=g-S,d=1/Math.hypot(f,c,p),f*=d,c*=d,p*=d,i=_*p-b*c,a=b*f-y*p,o=y*c-_*f,d=Math.hypot(i,a,o),d?(d=1/d,i*=d,a*=d,o*=d):(i=0,a=0,o=0),s=c*o-p*a,u=p*i-f*o,l=f*a-c*i,d=Math.hypot(s,u,l),d?(d=1/d,s*=d,u*=d,l*=d):(s=0,u=0,l=0),t[0]=i,t[1]=s,t[2]=f,t[3]=0,t[4]=a,t[5]=u,t[6]=c,t[7]=0,t[8]=o,t[9]=l,t[10]=p,t[11]=0,t[12]=-(i*v+a*m+o*g),t[13]=-(s*v+u*m+l*g),t[14]=-(f*v+c*m+p*g),t[15]=1,t)}function yS(t,r){var e=t[0],n=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],l=t[7],f=t[8],c=t[9],p=t[10],d=t[11],v=t[12],m=t[13],g=t[14],y=t[15],_=r[0],b=r[1],x=r[2],A=r[3],S=r[4],P=r[5],O=r[6],C=r[7],T=r[8],I=r[9],R=r[10],V=r[11],z=r[12],k=r[13],G=r[14],U=r[15];return Math.abs(e-_)<=dt*Math.max(1,Math.abs(e),Math.abs(_))&&Math.abs(n-b)<=dt*Math.max(1,Math.abs(n),Math.abs(b))&&Math.abs(i-x)<=dt*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(a-A)<=dt*Math.max(1,Math.abs(a),Math.abs(A))&&Math.abs(o-S)<=dt*Math.max(1,Math.abs(o),Math.abs(S))&&Math.abs(s-P)<=dt*Math.max(1,Math.abs(s),Math.abs(P))&&Math.abs(u-O)<=dt*Math.max(1,Math.abs(u),Math.abs(O))&&Math.abs(l-C)<=dt*Math.max(1,Math.abs(l),Math.abs(C))&&Math.abs(f-T)<=dt*Math.max(1,Math.abs(f),Math.abs(T))&&Math.abs(c-I)<=dt*Math.max(1,Math.abs(c),Math.abs(I))&&Math.abs(p-R)<=dt*Math.max(1,Math.abs(p),Math.abs(R))&&Math.abs(d-V)<=dt*Math.max(1,Math.abs(d),Math.abs(V))&&Math.abs(v-z)<=dt*Math.max(1,Math.abs(v),Math.abs(z))&&Math.abs(m-k)<=dt*Math.max(1,Math.abs(m),Math.abs(k))&&Math.abs(g-G)<=dt*Math.max(1,Math.abs(g),Math.abs(G))&&Math.abs(y-U)<=dt*Math.max(1,Math.abs(y),Math.abs(U))}function Mye(){var t=new xr(4);return xr!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function mN(t,r,e){return t[0]=r[0]+e[0],t[1]=r[1]+e[1],t[2]=r[2]+e[2],t[3]=r[3]+e[3],t}function Um(t,r,e){return t[0]=r[0]*e,t[1]=r[1]*e,t[2]=r[2]*e,t[3]=r[3]*e,t}function gN(t){var r=t[0],e=t[1],n=t[2],i=t[3];return Math.hypot(r,e,n,i)}function yN(t){var r=t[0],e=t[1],n=t[2],i=t[3];return r*r+e*e+n*n+i*i}function _N(t,r){var e=r[0],n=r[1],i=r[2],a=r[3],o=e*e+n*n+i*i+a*a;return o>0&&(o=1/Math.sqrt(o)),t[0]=e*o,t[1]=n*o,t[2]=i*o,t[3]=a*o,t}function bN(t,r){return t[0]*r[0]+t[1]*r[1]+t[2]*r[2]+t[3]*r[3]}function xN(t,r,e,n){var i=r[0],a=r[1],o=r[2],s=r[3];return t[0]=i+n*(e[0]-i),t[1]=a+n*(e[1]-a),t[2]=o+n*(e[2]-o),t[3]=s+n*(e[3]-s),t}function Gm(t,r,e){var n=r[0],i=r[1],a=r[2],o=r[3];return t[0]=e[0]*n+e[4]*i+e[8]*a+e[12]*o,t[1]=e[1]*n+e[5]*i+e[9]*a+e[13]*o,t[2]=e[2]*n+e[6]*i+e[10]*a+e[14]*o,t[3]=e[3]*n+e[7]*i+e[11]*a+e[15]*o,t}function AN(t,r,e){var n=r[0],i=r[1],a=r[2],o=e[0],s=e[1],u=e[2],l=e[3],f=l*n+s*a-u*i,c=l*i+u*n-o*a,p=l*a+o*i-s*n,d=-o*n-s*i-u*a;return t[0]=f*l+d*-o+c*-u-p*-s,t[1]=c*l+d*-s+p*-o-f*-u,t[2]=p*l+d*-u+f*-s-c*-o,t[3]=r[3],t}var u7e=function(){var t=Mye();return function(r,e,n,i,a,o){var s,u;for(e||(e=4),n||(n=0),i?u=Math.min(i*e+n,r.length):u=r.length,s=n;s<u;s+=e)t[0]=r[s],t[1]=r[s+1],t[2]=r[s+2],t[3]=r[s+3],a(t,t,o),r[s]=t[0],r[s+1]=t[1],r[s+2]=t[2],r[s+3]=t[3];return r}}();function Iye(t){var r=Rye();return function(){var n=lt(t),i;if(r){var a=lt(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return or(this,i)}}function Rye(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var AS;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(AS||(AS={}));var Lye=45*Math.PI/180,kye=1,bS=.1,xS=500,Bye=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),pe=function(t){ar(e,t);var r=Iye(e);function e(n){var i;return $t(this,e),i=r.call(this,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(n)?i.copy(n):i.identity(),i}return Xt(e,[{key:"ELEMENTS",get:function(){return 16}},{key:"RANK",get:function(){return 4}},{key:"INDICES",get:function(){return AS}},{key:"copy",value:function(i){return this[0]=i[0],this[1]=i[1],this[2]=i[2],this[3]=i[3],this[4]=i[4],this[5]=i[5],this[6]=i[6],this[7]=i[7],this[8]=i[8],this[9]=i[9],this[10]=i[10],this[11]=i[11],this[12]=i[12],this[13]=i[13],this[14]=i[14],this[15]=i[15],this.check()}},{key:"set",value:function(i,a,o,s,u,l,f,c,p,d,v,m,g,y,_,b){return this[0]=i,this[1]=a,this[2]=o,this[3]=s,this[4]=u,this[5]=l,this[6]=f,this[7]=c,this[8]=p,this[9]=d,this[10]=v,this[11]=m,this[12]=g,this[13]=y,this[14]=_,this[15]=b,this.check()}},{key:"setRowMajor",value:function(i,a,o,s,u,l,f,c,p,d,v,m,g,y,_,b){return this[0]=i,this[1]=u,this[2]=p,this[3]=g,this[4]=a,this[5]=l,this[6]=d,this[7]=y,this[8]=o,this[9]=f,this[10]=v,this[11]=_,this[12]=s,this[13]=c,this[14]=m,this[15]=b,this.check()}},{key:"toRowMajor",value:function(i){return i[0]=this[0],i[1]=this[4],i[2]=this[8],i[3]=this[12],i[4]=this[1],i[5]=this[5],i[6]=this[9],i[7]=this[13],i[8]=this[2],i[9]=this[6],i[10]=this[10],i[11]=this[14],i[12]=this[3],i[13]=this[7],i[14]=this[11],i[15]=this[15],i}},{key:"identity",value:function(){return this.copy(Bye)}},{key:"fromObject",value:function(i){return this.check()}},{key:"fromQuaternion",value:function(i){return pN(this,i),this.check()}},{key:"frustum",value:function(i){var a=i.left,o=i.right,s=i.bottom,u=i.top,l=i.near,f=l===void 0?bS:l,c=i.far,p=c===void 0?xS:c;return p===1/0?Nye(this,a,o,s,u,f):hN(this,a,o,s,u,f,p),this.check()}},{key:"lookAt",value:function(i){var a=i.eye,o=i.center,s=o===void 0?[0,0,0]:o,u=i.up,l=u===void 0?[0,1,0]:u;return vN(this,a,s,l),this.check()}},{key:"ortho",value:function(i){var a=i.left,o=i.right,s=i.bottom,u=i.top,l=i.near,f=l===void 0?bS:l,c=i.far,p=c===void 0?xS:c;return dN(this,a,o,s,u,f,p),this.check()}},{key:"orthographic",value:function(i){var a=i.fovy,o=a===void 0?Lye:a,s=i.aspect,u=s===void 0?kye:s,l=i.focalDistance,f=l===void 0?1:l,c=i.near,p=c===void 0?bS:c,d=i.far,v=d===void 0?xS:d;SN(o);var m=o/2,g=f*Math.tan(m),y=g*u;return this.ortho({left:-y,right:y,bottom:-g,top:g,near:p,far:v})}},{key:"perspective",value:function(i){var a=i.fovy,o=a===void 0?45*Math.PI/180:a,s=i.aspect,u=s===void 0?1:s,l=i.near,f=l===void 0?.1:l,c=i.far,p=c===void 0?500:c;return SN(o),Nm(this,o,u,f,p),this.check()}},{key:"determinant",value:function(){return uN(this)}},{key:"getScale",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[-0,-0,-0];return i[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),i[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),i[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),i}},{key:"getTranslation",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[-0,-0,-0];return i[0]=this[12],i[1]=this[13],i[2]=this[14],i}},{key:"getRotation",value:function(i,a){i=i||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],a=a||[-0,-0,-0];var o=this.getScale(a),s=1/o[0],u=1/o[1],l=1/o[2];return i[0]=this[0]*s,i[1]=this[1]*u,i[2]=this[2]*l,i[3]=0,i[4]=this[4]*s,i[5]=this[5]*u,i[6]=this[6]*l,i[7]=0,i[8]=this[8]*s,i[9]=this[9]*u,i[10]=this[10]*l,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}},{key:"getRotationMatrix3",value:function(i,a){i=i||[-0,-0,-0,-0,-0,-0,-0,-0,-0],a=a||[-0,-0,-0];var o=this.getScale(a),s=1/o[0],u=1/o[1],l=1/o[2];return i[0]=this[0]*s,i[1]=this[1]*u,i[2]=this[2]*l,i[3]=this[4]*s,i[4]=this[5]*u,i[5]=this[6]*l,i[6]=this[8]*s,i[7]=this[9]*u,i[8]=this[10]*l,i}},{key:"transpose",value:function(){return sN(this,this),this.check()}},{key:"invert",value:function(){return Bm(this,this),this.check()}},{key:"multiplyLeft",value:function(i){return Es(this,i,this),this.check()}},{key:"multiplyRight",value:function(i){return Es(this,this,i),this.check()}},{key:"rotateX",value:function(i){return Fm(this,this,i),this.check()}},{key:"rotateY",value:function(i){return fN(this,this,i),this.check()}},{key:"rotateZ",value:function(i){return Dm(this,this,i),this.check()}},{key:"rotateXYZ",value:function(i){return this.rotateX(i[0]).rotateY(i[1]).rotateZ(i[2])}},{key:"rotateAxis",value:function(i,a){return lN(this,this,i,a),this.check()}},{key:"scale",value:function(i){return yl(this,this,Array.isArray(i)?i:[i,i,i]),this.check()}},{key:"translate",value:function(i){return Cs(this,this,i),this.check()}},{key:"transform",value:function(i,a){return i.length===4?(a=Gm(a||[-0,-0,-0,-0],i,this),mo(a,4),a):this.transformAsPoint(i,a)}},{key:"transformAsPoint",value:function(i,a){var o=i.length,s;switch(o){case 2:s=Tm(a||[-0,-0],i,this);break;case 3:s=gl(a||[-0,-0,-0],i,this);break;default:throw new Error("Illegal vector")}return mo(s,i.length),s}},{key:"transformAsVector",value:function(i,a){var o;switch(i.length){case 2:o=wm(a||[-0,-0],i,this);break;case 3:o=Pm(a||[-0,-0,-0],i,this);break;default:throw new Error("Illegal vector")}return mo(o,i.length),o}},{key:"transformPoint",value:function(i,a){return this.transformAsPoint(i,a)}},{key:"transformVector",value:function(i,a){return this.transformAsPoint(i,a)}},{key:"transformDirection",value:function(i,a){return this.transformAsVector(i,a)}},{key:"makeRotationX",value:function(i){return this.identity().rotateX(i)}},{key:"makeTranslation",value:function(i,a,o){return this.identity().translate([i,a,o])}}],[{key:"IDENTITY",get:function(){return Dye()}},{key:"ZERO",get:function(){return Fye()}}]),e}(Rm);var zm,Vm;function Fye(){return zm||(zm=new pe([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(zm)),zm}function Dye(){return Vm||(Vm=new pe,Object.freeze(Vm)),Vm}function SN(t){if(t>Math.PI*2)throw Error("expected radians")}function Nye(t,r,e,n,i,a){var o=2*a/(e-r),s=2*a/(i-n),u=(e+r)/(e-r),l=(i+n)/(i-n),f=-1,c=-1,p=-2*a;return t[0]=o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=u,t[9]=l,t[10]=f,t[11]=c,t[12]=0,t[13]=0,t[14]=p,t[15]=0,t}function TN(){var t=new xr(4);return xr!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function wN(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function SS(t,r,e){e=e*.5;var n=Math.sin(e);return t[0]=n*r[0],t[1]=n*r[1],t[2]=n*r[2],t[3]=Math.cos(e),t}function TS(t,r,e){var n=r[0],i=r[1],a=r[2],o=r[3],s=e[0],u=e[1],l=e[2],f=e[3];return t[0]=n*f+o*s+i*l-a*u,t[1]=i*f+o*u+a*s-n*l,t[2]=a*f+o*l+n*u-i*s,t[3]=o*f-n*s-i*u-a*l,t}function PN(t,r,e){e*=.5;var n=r[0],i=r[1],a=r[2],o=r[3],s=Math.sin(e),u=Math.cos(e);return t[0]=n*u+o*s,t[1]=i*u+a*s,t[2]=a*u-i*s,t[3]=o*u-n*s,t}function ON(t,r,e){e*=.5;var n=r[0],i=r[1],a=r[2],o=r[3],s=Math.sin(e),u=Math.cos(e);return t[0]=n*u-a*s,t[1]=i*u+o*s,t[2]=a*u+n*s,t[3]=o*u-i*s,t}function EN(t,r,e){e*=.5;var n=r[0],i=r[1],a=r[2],o=r[3],s=Math.sin(e),u=Math.cos(e);return t[0]=n*u+i*s,t[1]=i*u-n*s,t[2]=a*u+o*s,t[3]=o*u-a*s,t}function CN(t,r){var e=r[0],n=r[1],i=r[2];return t[0]=e,t[1]=n,t[2]=i,t[3]=Math.sqrt(Math.abs(1-e*e-n*n-i*i)),t}function wp(t,r,e,n){var i=r[0],a=r[1],o=r[2],s=r[3],u=e[0],l=e[1],f=e[2],c=e[3],p,d,v,m,g;return d=i*u+a*l+o*f+s*c,d<0&&(d=-d,u=-u,l=-l,f=-f,c=-c),1-d>dt?(p=Math.acos(d),v=Math.sin(p),m=Math.sin((1-n)*p)/v,g=Math.sin(n*p)/v):(m=1-n,g=n),t[0]=m*i+g*u,t[1]=m*a+g*l,t[2]=m*o+g*f,t[3]=m*s+g*c,t}function MN(t,r){var e=r[0],n=r[1],i=r[2],a=r[3],o=e*e+n*n+i*i+a*a,s=o?1/o:0;return t[0]=-e*s,t[1]=-n*s,t[2]=-i*s,t[3]=a*s,t}function IN(t,r){return t[0]=-r[0],t[1]=-r[1],t[2]=-r[2],t[3]=r[3],t}function wS(t,r){var e=r[0]+r[4]+r[8],n;if(e>0)n=Math.sqrt(e+1),t[3]=.5*n,n=.5/n,t[0]=(r[5]-r[7])*n,t[1]=(r[6]-r[2])*n,t[2]=(r[1]-r[3])*n;else{var i=0;r[4]>r[0]&&(i=1),r[8]>r[i*3+i]&&(i=2);var a=(i+1)%3,o=(i+2)%3;n=Math.sqrt(r[i*3+i]-r[a*3+a]-r[o*3+o]+1),t[i]=.5*n,n=.5/n,t[3]=(r[a*3+o]-r[o*3+a])*n,t[a]=(r[a*3+i]+r[i*3+a])*n,t[o]=(r[o*3+i]+r[i*3+o])*n}return t}var RN=mN;var LN=Um,kN=bN,BN=xN,FN=gN;var DN=yN;var NN=_N;var jN=function(){var t=pS(),r=hS(1,0,0),e=hS(0,1,0);return function(n,i,a){var o=Tp(i,a);return o<-.999999?(ml(t,r,i),ZD(t)<1e-6&&ml(t,e,i),HD(t,t),SS(n,t,Math.PI),n):o>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(ml(t,i,a),n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=1+o,NN(n,n))}}(),T7e=function(){var t=TN(),r=TN();return function(e,n,i,a,o,s){return wp(t,n,o,s),wp(r,i,a,s),wp(e,t,r,2*s*(1-s)),e}}(),w7e=function(){var t=QD();return function(r,e,n,i){return t[0]=n[0],t[3]=n[1],t[6]=n[2],t[1]=i[0],t[4]=i[1],t[7]=i[2],t[2]=-e[0],t[5]=-e[1],t[8]=-e[2],NN(r,wS(r,t))}}();function Uye(t){var r=Gye();return function(){var n=lt(t),i;if(r){var a=lt(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return or(this,i)}}function Gye(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var zye=[0,0,0,1],Bi=function(t){ar(e,t);var r=Uye(e);function e(){var n,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;return $t(this,e),n=r.call(this,-0,-0,-0,-0),Array.isArray(i)&&arguments.length===1?n.copy(i):n.set(i,a,o,s),n}return Xt(e,[{key:"copy",value:function(i){return this[0]=i[0],this[1]=i[1],this[2]=i[2],this[3]=i[3],this.check()}},{key:"set",value:function(i,a,o,s){return this[0]=i,this[1]=a,this[2]=o,this[3]=s,this.check()}},{key:"fromObject",value:function(i){return this[0]=i.x,this[1]=i.y,this[2]=i.z,this[3]=i.w,this.check()}},{key:"fromMatrix3",value:function(i){return wS(this,i),this.check()}},{key:"fromAxisRotation",value:function(i,a){return SS(this,i,a),this.check()}},{key:"identity",value:function(){return wN(this),this.check()}},{key:"setAxisAngle",value:function(i,a){return this.fromAxisRotation(i,a)}},{key:"ELEMENTS",get:function(){return 4}},{key:"x",get:function(){return this[0]},set:function(i){this[0]=Ve(i)}},{key:"y",get:function(){return this[1]},set:function(i){this[1]=Ve(i)}},{key:"z",get:function(){return this[2]},set:function(i){this[2]=Ve(i)}},{key:"w",get:function(){return this[3]},set:function(i){this[3]=Ve(i)}},{key:"len",value:function(){return FN(this)}},{key:"lengthSquared",value:function(){return DN(this)}},{key:"dot",value:function(i){return kN(this,i)}},{key:"rotationTo",value:function(i,a){return jN(this,i,a),this.check()}},{key:"add",value:function(i){return RN(this,this,i),this.check()}},{key:"calculateW",value:function(){return CN(this,this),this.check()}},{key:"conjugate",value:function(){return IN(this,this),this.check()}},{key:"invert",value:function(){return MN(this,this),this.check()}},{key:"lerp",value:function(i,a,o){return o===void 0?this.lerp(this,i,a):(BN(this,i,a,o),this.check())}},{key:"multiplyRight",value:function(i){return TS(this,this,i),this.check()}},{key:"multiplyLeft",value:function(i){return TS(this,i,this),this.check()}},{key:"normalize",value:function(){var i=this.len(),a=i>0?1/i:0;return this[0]=this[0]*a,this[1]=this[1]*a,this[2]=this[2]*a,this[3]=this[3]*a,i===0&&(this[3]=1),this.check()}},{key:"rotateX",value:function(i){return PN(this,this,i),this.check()}},{key:"rotateY",value:function(i){return ON(this,this,i),this.check()}},{key:"rotateZ",value:function(i){return EN(this,this,i),this.check()}},{key:"scale",value:function(i){return LN(this,this,i),this.check()}},{key:"slerp",value:function(i,a,o){var s,u,l;switch(arguments.length){case 1:var f=i.start;s=f===void 0?zye:f,u=i.target,l=i.ratio;break;case 2:s=this,u=i,l=a;break;default:s=i,u=a,l=o}return wp(this,s,u,l),this.check()}},{key:"transformVector4",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new JD;return AN(a,i,this),mo(a,4)}},{key:"lengthSq",value:function(){return this.lengthSquared()}},{key:"setFromAxisAngle",value:function(i,a){return this.setAxisAngle(i,a)}},{key:"premultiply",value:function(i){return this.multiplyLeft(i)}},{key:"multiply",value:function(i){return this.multiplyRight(i)}}]),e}(hl);function PS(t){if(Array.isArray(t))return t}function OS(t,r){var e=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(e!=null){var n=[],i=!0,a=!1,o,s;try{for(e=e.call(t);!(i=(o=e.next()).done)&&(n.push(o.value),!(r&&n.length===r));i=!0);}catch(u){a=!0,s=u}finally{try{!i&&e.return!=null&&e.return()}finally{if(a)throw s}}return n}}function Hm(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function ES(t,r){if(t){if(typeof t=="string")return Hm(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Hm(t,r)}}function CS(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function MS(t,r){return PS(t)||OS(t,r)||ES(t,r)||CS()}function _l(t,r,e){return r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e,t}var UN=1e-6,Vye=6371e3,Pp=function(){function t(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=r.phi,n=e===void 0?0:e,i=r.theta,a=i===void 0?0:i,o=r.radius,s=o===void 0?1:o,u=r.bearing,l=r.pitch,f=r.altitude,c=r.radiusScale,p=c===void 0?Vye:c;$t(this,t),_l(this,"phi",void 0),_l(this,"theta",void 0),_l(this,"radius",void 0),_l(this,"radiusScale",void 0),this.phi=n,this.theta=a,this.radius=s||f||1,this.radiusScale=p||1,u!==void 0&&(this.bearing=u),l!==void 0&&(this.pitch=l),this.check()}return Xt(t,[{key:"toString",value:function(){return this.formatString(ft)}},{key:"formatString",value:function(e){var n=e.printTypes,i=n===void 0?!1:n,a=xp;return"".concat(i?"Spherical":"","[rho:").concat(a(this.radius),",theta:").concat(a(this.theta),",phi:").concat(a(this.phi),"]")}},{key:"equals",value:function(e){return tt(this.radius,e.radius)&&tt(this.theta,e.theta)&&tt(this.phi,e.phi)}},{key:"exactEquals",value:function(e){return this.radius===e.radius&&this.theta===e.theta&&this.phi===e.phi}},{key:"bearing",get:function(){return 180-vr(this.phi)},set:function(e){this.phi=Math.PI-Ps(e)}},{key:"pitch",get:function(){return vr(this.theta)},set:function(e){this.theta=Ps(e)}},{key:"longitude",get:function(){return vr(this.phi)}},{key:"latitude",get:function(){return vr(this.theta)}},{key:"lng",get:function(){return vr(this.phi)}},{key:"lat",get:function(){return vr(this.theta)}},{key:"z",get:function(){return(this.radius-1)*this.radiusScale}},{key:"set",value:function(e,n,i){return this.radius=e,this.phi=n,this.theta=i,this.check()}},{key:"clone",value:function(){return new t().copy(this)}},{key:"copy",value:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this.check()}},{key:"fromLngLatZ",value:function(e){var n=MS(e,3),i=n[0],a=n[1],o=n[2];return this.radius=1+o/this.radiusScale,this.phi=Ps(a),this.theta=Ps(i),this.check()}},{key:"fromVector3",value:function(e){return this.radius=Sp(e),this.radius>0&&(this.theta=Math.atan2(e[0],e[1]),this.phi=Math.acos(We(e[2]/this.radius,-1,1))),this.check()}},{key:"toVector3",value:function(){return new j(0,0,this.radius).rotateX({radians:this.theta}).rotateZ({radians:this.phi})}},{key:"makeSafe",value:function(){return this.phi=Math.max(UN,Math.min(Math.PI-UN,this.phi)),this}},{key:"check",value:function(){if(!Number.isFinite(this.phi)||!Number.isFinite(this.theta)||!(this.radius>0))throw new Error("SphericalCoordinates: some fields set to invalid numbers");return this}}]),t}();var Fi={EPSILON1:.1,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,EPSILON13:1e-13,EPSILON14:1e-14,EPSILON15:1e-15,EPSILON16:1e-16,EPSILON17:1e-17,EPSILON18:1e-18,EPSILON19:1e-19,EPSILON20:1e-20,PI_OVER_TWO:Math.PI/2,PI_OVER_FOUR:Math.PI/4,PI_OVER_SIX:Math.PI/6,TWO_PI:Math.PI*2};var IS=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))

struct AmbientLight {
 vec3 color;
};

struct PointLight {
 vec3 color;
 vec3 position;
 vec3 attenuation;
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;

uniform bool lighting_uEnabled;

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

#endif
`;function Hye(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=Wye(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function Wye(t,r){if(t){if(typeof t=="string")return GN(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return GN(t,r)}}function GN(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var $ye={lightSources:{}};function RS(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=t.color,e=r===void 0?[0,0,0]:r,n=t.intensity,i=n===void 0?1:n;return e.map(function(a){return a*i/255})}function Xye(t){var r=t.ambientLight,e=t.pointLights,n=e===void 0?[]:e,i=t.directionalLights,a=i===void 0?[]:i,o={};return r?o["lighting_uAmbientLight.color"]=RS(r):o["lighting_uAmbientLight.color"]=[0,0,0],n.forEach(function(s,u){o["lighting_uPointLight[".concat(u,"].color")]=RS(s),o["lighting_uPointLight[".concat(u,"].position")]=s.position,o["lighting_uPointLight[".concat(u,"].attenuation")]=s.attenuation||[1,0,0]}),o.lighting_uPointLightCount=n.length,a.forEach(function(s,u){o["lighting_uDirectionalLight[".concat(u,"].color")]=RS(s),o["lighting_uDirectionalLight[".concat(u,"].direction")]=s.direction}),o.lighting_uDirectionalLightCount=a.length,o}function zN(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:$ye;if("lightSources"in t){var r=t.lightSources||{},e=r.ambientLight,n=r.pointLights,i=r.directionalLights,a=e||n&&n.length>0||i&&i.length>0;return a?Object.assign({},Xye({ambientLight:e,pointLights:n,directionalLights:i}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in t){var o={pointLights:[],directionalLights:[]},s=Hye(t.lights||[]),u;try{for(s.s();!(u=s.n()).done;){var l=u.value;switch(l.type){case"ambient":o.ambientLight=l;break;case"directional":o.directionalLights.push(l);break;case"point":o.pointLights.push(l);break;default:}}}catch(f){s.e(f)}finally{s.f()}return zN({lightSources:o})}return{}}var Op={name:"lights",vs:IS,fs:IS,getUniforms:zN,defines:{MAX_LIGHTS:3}};var qye=new Uint8Array([0,255,255,255]),Yye={pickingSelectedColor:null,pickingHighlightColor:qye,pickingActive:!1,pickingAttribute:!1};function Kye(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Yye,r={};if(t.pickingSelectedColor!==void 0)if(!t.pickingSelectedColor)r.picking_uSelectedColorValid=0;else{var e=t.pickingSelectedColor.slice(0,3);r.picking_uSelectedColorValid=1,r.picking_uSelectedColor=e}if(t.pickingHighlightColor){var n=Array.from(t.pickingHighlightColor,function(i){return i/255});Number.isFinite(n[3])||(n[3]=1),r.picking_uHighlightColor=n}return t.pickingActive!==void 0&&(r.picking_uActive=Boolean(t.pickingActive),r.picking_uAttribute=Boolean(t.pickingAttribute)),r}var Zye=`uniform bool picking_uActive;
uniform bool picking_uAttribute;
uniform vec3 picking_uSelectedColor;
uniform bool picking_uSelectedColorValid;

out vec4 picking_vRGBcolor_Avalid;

const float COLOR_SCALE = 1. / 255.;

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.001;
}

bool isVertexPicked(vec3 vertexColor) {
  return
    picking_uSelectedColorValid &&
    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));
}

void picking_setPickingColor(vec3 pickingColor) {
  if (picking_uActive) {
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!picking_uAttribute) {
      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;
    }
  } else {
    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.r = value;
  }
}
void picking_setPickingAttribute(vec2 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}
void picking_setPickingAttribute(vec3 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,Jye=`uniform bool picking_uActive;
uniform vec3 picking_uSelectedColor;
uniform vec4 picking_uHighlightColor;

in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
  if (picking_uActive) {
    return color;
  }
  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    float highLightAlpha = picking_uHighlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}
vec4 picking_filterPickingColor(vec4 color) {
  if (picking_uActive) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}
vec4 picking_filterColor(vec4 color) {
  vec4 highightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highightColor);
}

`,Wm={name:"picking",vs:Zye,fs:Jye,getUniforms:Kye};var LS=`
uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
    vec3 halfway_direction = normalize(light_direction + view_direction);
    float lambertian = dot(light_direction, normal_worldspace);
    float specular = 0.0;
    if (lambertian > 0.0) {
      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
      specular = pow(specular_angle, lighting_uShininess);
    }
    lambertian = max(lambertian, 0.0);
    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);
    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}

vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = vec3(0, 0, 0);
  vec3 surfaceColor = vec3(0, 0, 0);

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}
`;var Qye={};function e0e(t){var r=t.ambient,e=r===void 0?.35:r,n=t.diffuse,i=n===void 0?.6:n,a=t.shininess,o=a===void 0?32:a,s=t.specularColor,u=s===void 0?[30,30,30]:s;return{lighting_uAmbient:e,lighting_uDiffuse:i,lighting_uShininess:o,lighting_uSpecularColor:u.map(function(l){return l/255})}}function VN(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Qye;if(!("material"in t))return{};var r=t.material;return r?e0e(r):{lighting_uEnabled:!1}}var pn={name:"gouraud-lighting",dependencies:[Op],vs:LS,defines:{LIGHTING_VERTEX:1},getUniforms:VN},ya={name:"phong-lighting",dependencies:[Op],fs:LS,defines:{LIGHTING_FRAGMENT:1},getUniforms:VN};var HN=`uniform mat4 u_MVPMatrix;
uniform mat4 u_ModelMatrix;
uniform mat4 u_NormalMatrix;

varying vec3 pbr_vPosition;
varying vec2 pbr_vUV;

#ifdef HAS_NORMALS
# ifdef HAS_TANGENTS
varying mat3 pbr_vTBN;
# else
varying vec3 pbr_vNormal;
# endif
#endif

void pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)
{
  vec4 pos = u_ModelMatrix * position;
  pbr_vPosition = vec3(pos.xyz) / pos.w;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
  vec3 normalW = normalize(vec3(u_NormalMatrix * vec4(normal.xyz, 0.0)));
  vec3 tangentW = normalize(vec3(u_ModelMatrix * vec4(tangent.xyz, 0.0)));
  vec3 bitangentW = cross(normalW, tangentW) * tangent.w;
  pbr_vTBN = mat3(tangentW, bitangentW, normalW);
#else
  pbr_vNormal = normalize(vec3(u_ModelMatrix * vec4(normal.xyz, 0.0)));
#endif
#endif

#ifdef HAS_UV
  pbr_vUV = uv;
#else
  pbr_vUV = vec2(0.,0.);
#endif
}
`;var WN=`#if defined(USE_TEX_LOD) && !defined(FEATURE_GLSL_TEXTURE_LOD)
# error PBR fragment shader: Texture LOD is not available
#endif

#if !defined(HAS_TANGENTS) && !defined(FEATURE_GLSL_DERIVATIVES)
# error PBR fragment shader: Derivatives are not available
#endif


#if (__VERSION__ < 300)
  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL1COND; INCR)
#else
  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL2COND; INCR)
#endif

precision highp float;

uniform bool pbr_uUnlit;

#ifdef USE_IBL
uniform samplerCube u_DiffuseEnvSampler;
uniform samplerCube u_SpecularEnvSampler;
uniform sampler2D u_brdfLUT;
uniform vec2 u_ScaleIBLAmbient;
#endif

#ifdef HAS_BASECOLORMAP
uniform sampler2D u_BaseColorSampler;
#endif
#ifdef HAS_NORMALMAP
uniform sampler2D u_NormalSampler;
uniform float u_NormalScale;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D u_EmissiveSampler;
uniform vec3 u_EmissiveFactor;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D u_MetallicRoughnessSampler;
#endif
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D u_OcclusionSampler;
uniform float u_OcclusionStrength;
#endif

#ifdef ALPHA_CUTOFF
uniform float u_AlphaCutoff;
#endif

uniform vec2 u_MetallicRoughnessValues;
uniform vec4 u_BaseColorFactor;

uniform vec3 u_Camera;
#ifdef PBR_DEBUG
uniform vec4 u_ScaleDiffBaseMR;
uniform vec4 u_ScaleFGDSpec;
#endif

varying vec3 pbr_vPosition;

varying vec2 pbr_vUV;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
varying mat3 pbr_vTBN;
#else
varying vec3 pbr_vNormal;
#endif
#endif


struct PBRInfo
{
  float NdotL;
  float NdotV;
  float NdotH;
  float LdotH;
  float VdotH;
  float perceptualRoughness;
  float metalness;
  vec3 reflectance0;
  vec3 reflectance90;
  float alphaRoughness;
  vec3 diffuseColor;
  vec3 specularColor;
  vec3 n;
  vec3 v;
};

const float M_PI = 3.141592653589793;
const float c_MinRoughness = 0.04;

vec4 SRGBtoLINEAR(vec4 srgbIn)
{
#ifdef MANUAL_SRGB
#ifdef SRGB_FAST_APPROXIMATION
  vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
#else
  vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
  vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
#endif
  return vec4(linOut,srgbIn.w);;
#else
  return srgbIn;
#endif
}

vec3 getNormal()
{
#ifndef HAS_TANGENTS
  vec3 pos_dx = dFdx(pbr_vPosition);
  vec3 pos_dy = dFdy(pbr_vPosition);
  vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));
  vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));
  vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);

#ifdef HAS_NORMALS
  vec3 ng = normalize(pbr_vNormal);
#else
  vec3 ng = cross(pos_dx, pos_dy);
#endif

  t = normalize(t - ng * dot(ng, t));
  vec3 b = normalize(cross(ng, t));
  mat3 tbn = mat3(t, b, ng);
#else
  mat3 tbn = pbr_vTBN;
#endif

#ifdef HAS_NORMALMAP
  vec3 n = texture2D(u_NormalSampler, pbr_vUV).rgb;
  n = normalize(tbn * ((2.0 * n - 1.0) * vec3(u_NormalScale, u_NormalScale, 1.0)));
#else
  vec3 n = normalize(tbn[2].xyz);
#endif

  return n;
}


#ifdef USE_IBL
vec3 getIBLContribution(PBRInfo pbrInputs, vec3 n, vec3 reflection)
{
  float mipCount = 9.0;
  float lod = (pbrInputs.perceptualRoughness * mipCount);
  vec3 brdf = SRGBtoLINEAR(texture2D(u_brdfLUT,
    vec2(pbrInputs.NdotV, 1.0 - pbrInputs.perceptualRoughness))).rgb;
  vec3 diffuseLight = SRGBtoLINEAR(textureCube(u_DiffuseEnvSampler, n)).rgb;

#ifdef USE_TEX_LOD
  vec3 specularLight = SRGBtoLINEAR(textureCubeLod(u_SpecularEnvSampler, reflection, lod)).rgb;
#else
  vec3 specularLight = SRGBtoLINEAR(textureCube(u_SpecularEnvSampler, reflection)).rgb;
#endif

  vec3 diffuse = diffuseLight * pbrInputs.diffuseColor;
  vec3 specular = specularLight * (pbrInputs.specularColor * brdf.x + brdf.y);
  diffuse *= u_ScaleIBLAmbient.x;
  specular *= u_ScaleIBLAmbient.y;

  return diffuse + specular;
}
#endif


vec3 diffuse(PBRInfo pbrInputs)
{
  return pbrInputs.diffuseColor / M_PI;
}

vec3 specularReflection(PBRInfo pbrInputs)
{
  return pbrInputs.reflectance0 +
    (pbrInputs.reflectance90 - pbrInputs.reflectance0) *
    pow(clamp(1.0 - pbrInputs.VdotH, 0.0, 1.0), 5.0);
}



float geometricOcclusion(PBRInfo pbrInputs)
{
  float NdotL = pbrInputs.NdotL;
  float NdotV = pbrInputs.NdotV;
  float r = pbrInputs.alphaRoughness;

  float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
  float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
  return attenuationL * attenuationV;
}





float microfacetDistribution(PBRInfo pbrInputs)
{
  float roughnessSq = pbrInputs.alphaRoughness * pbrInputs.alphaRoughness;
  float f = (pbrInputs.NdotH * roughnessSq - pbrInputs.NdotH) * pbrInputs.NdotH + 1.0;
  return roughnessSq / (M_PI * f * f);
}

void PBRInfo_setAmbientLight(inout PBRInfo pbrInputs) {
  pbrInputs.NdotL = 1.0;
  pbrInputs.NdotH = 0.0;
  pbrInputs.LdotH = 0.0;
  pbrInputs.VdotH = 1.0;
}

void PBRInfo_setDirectionalLight(inout PBRInfo pbrInputs, vec3 lightDirection) {
  vec3 n = pbrInputs.n;
  vec3 v = pbrInputs.v;
  vec3 l = normalize(lightDirection);
  vec3 h = normalize(l+v);

  pbrInputs.NdotL = clamp(dot(n, l), 0.001, 1.0);
  pbrInputs.NdotH = clamp(dot(n, h), 0.0, 1.0);
  pbrInputs.LdotH = clamp(dot(l, h), 0.0, 1.0);
  pbrInputs.VdotH = clamp(dot(v, h), 0.0, 1.0);
}

void PBRInfo_setPointLight(inout PBRInfo pbrInputs, PointLight pointLight) {
  vec3 light_direction = normalize(pointLight.position - pbr_vPosition);
  PBRInfo_setDirectionalLight(pbrInputs, light_direction);
}

vec3 calculateFinalColor(PBRInfo pbrInputs, vec3 lightColor) {
  vec3 F = specularReflection(pbrInputs);
  float G = geometricOcclusion(pbrInputs);
  float D = microfacetDistribution(pbrInputs);
  vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInputs);
  vec3 specContrib = F * G * D / (4.0 * pbrInputs.NdotL * pbrInputs.NdotV);
  return pbrInputs.NdotL * lightColor * (diffuseContrib + specContrib);
}

vec4 pbr_filterColor(vec4 colorUnused)
{
#ifdef HAS_BASECOLORMAP
  vec4 baseColor = SRGBtoLINEAR(texture2D(u_BaseColorSampler, pbr_vUV)) * u_BaseColorFactor;
#else
  vec4 baseColor = u_BaseColorFactor;
#endif

#ifdef ALPHA_CUTOFF
  if (baseColor.a < u_AlphaCutoff) {
    discard;
  }
#endif

  vec3 color = vec3(0, 0, 0);

  if(pbr_uUnlit){
    color.rgb = baseColor.rgb;
  }
  else{


    float perceptualRoughness = u_MetallicRoughnessValues.y;
    float metallic = u_MetallicRoughnessValues.x;
#ifdef HAS_METALROUGHNESSMAP

    vec4 mrSample = texture2D(u_MetallicRoughnessSampler, pbr_vUV);
    perceptualRoughness = mrSample.g * perceptualRoughness;
    metallic = mrSample.b * metallic;
#endif
    perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
    metallic = clamp(metallic, 0.0, 1.0);

    float alphaRoughness = perceptualRoughness * perceptualRoughness;

    vec3 f0 = vec3(0.04);
    vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
    diffuseColor *= 1.0 - metallic;
    vec3 specularColor = mix(f0, baseColor.rgb, metallic);
    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);



    float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
    vec3 specularEnvironmentR0 = specularColor.rgb;
    vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;

    vec3 n = getNormal();
    vec3 v = normalize(u_Camera - pbr_vPosition);

    float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
    vec3 reflection = -normalize(reflect(v, n));

    PBRInfo pbrInputs = PBRInfo(
      0.0,
      NdotV,
      0.0,
      0.0,
      0.0,
      perceptualRoughness,
      metallic,
      specularEnvironmentR0,
      specularEnvironmentR90,
      alphaRoughness,
      diffuseColor,
      specularColor,
      n,
      v
    );

#ifdef USE_LIGHTS
    PBRInfo_setAmbientLight(pbrInputs);
    color += calculateFinalColor(pbrInputs, lighting_uAmbientLight.color);
    SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uDirectionalLightCount, i++) {
      if (i < lighting_uDirectionalLightCount) {
        PBRInfo_setDirectionalLight(pbrInputs, lighting_uDirectionalLight[i].direction);
        color += calculateFinalColor(pbrInputs, lighting_uDirectionalLight[i].color);
      }
    }
    SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uPointLightCount, i++) {
      if (i < lighting_uPointLightCount) {
        PBRInfo_setPointLight(pbrInputs, lighting_uPointLight[i]);
        float attenuation = getPointLightAttenuation(lighting_uPointLight[i], distance(lighting_uPointLight[i].position, pbr_vPosition));
        color += calculateFinalColor(pbrInputs, lighting_uPointLight[i].color / attenuation);
      }
    }
#endif
#ifdef USE_IBL
    color += getIBLContribution(pbrInputs, n, reflection);
#endif
#ifdef HAS_OCCLUSIONMAP
    float ao = texture2D(u_OcclusionSampler, pbr_vUV).r;
    color = mix(color, color * ao, u_OcclusionStrength);
#endif

#ifdef HAS_EMISSIVEMAP
    vec3 emissive = SRGBtoLINEAR(texture2D(u_EmissiveSampler, pbr_vUV)).rgb * u_EmissiveFactor;
    color += emissive;
#endif

#ifdef PBR_DEBUG





    color = mix(color, baseColor.rgb, u_ScaleDiffBaseMR.y);
    color = mix(color, vec3(metallic), u_ScaleDiffBaseMR.z);
    color = mix(color, vec3(perceptualRoughness), u_ScaleDiffBaseMR.w);
#endif

  }

  return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
}
`;var go={name:"pbr",vs:HN,fs:WN,defines:{LIGHTING_FRAGMENT:1},dependencies:[Op]};var t0e=`attribute float transform_elementID;
vec2 transform_getPixelSizeHalf(vec2 size) {
  return vec2(1.) / (2. * size);
}

vec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {
  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);
  float xIndex = transform_elementID - (yIndex * texSize[0]);
  return vec2(xIndex, yIndex);
}
vec2 transform_getTexCoord(vec2 size) {
  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);
  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);
  vec2 coord = indices / size + pixelSizeHalf;
  return coord;
}
vec2 transform_getPos(vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);
  return pos;
}
vec4 transform_getInput(sampler2D texSampler, vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec4 textureColor = texture2D(texSampler, texCoord);
  return textureColor;
}
`,kS={name:"transform",vs:t0e,fs:null};function $N(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=r0e(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function r0e(t,r){if(t){if(typeof t=="string")return XN(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return XN(t,r)}}function XN(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var Pn=function(){function t(r){(0,qN.default)(this,t),this.gl=r,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}return(0,YN.default)(t,[{key:"addDefaultModule",value:function(e){this._defaultModules.find(function(n){return n.name===e.name})||this._defaultModules.push(e),this.stateHash++}},{key:"removeDefaultModule",value:function(e){var n=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(function(i){return i.name!==n}),this.stateHash++}},{key:"addShaderHook",value:function(e,n){n&&(e=Object.assign(n,{hook:e})),this._hookFunctions.push(e),this.stateHash++}},{key:"get",value:function(){var e=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.vs,a=i===void 0?"":i,o=n.fs,s=o===void 0?"":o,u=n.defines,l=u===void 0?{}:u,f=n.inject,c=f===void 0?{}:f,p=n.varyings,d=p===void 0?[]:p,v=n.bufferMode,m=v===void 0?35981:v,g=n.transpileToGLSL100,y=g===void 0?!1:g,_=this._getModuleList(n.modules),b=this._getHash(a),x=this._getHash(s),A=_.map(function(H){return e._getHash(H.name)}).sort(),S=d.map(function(H){return e._getHash(H)}),P=Object.keys(l).sort(),O=Object.keys(c).sort(),C=[],T=[],I=$N(P),R;try{for(I.s();!(R=I.n()).done;){var V=R.value;C.push(this._getHash(V)),C.push(this._getHash(l[V]))}}catch(H){I.e(H)}finally{I.f()}var z=$N(O),k;try{for(z.s();!(k=z.n()).done;){var G=k.value;T.push(this._getHash(G)),T.push(this._getHash(c[G]))}}catch(H){z.e(H)}finally{z.f()}var U="".concat(b,"/").concat(x,"D").concat(C.join("/"),"M").concat(A.join("/"),"I").concat(T.join("/"),"V").concat(S.join("/"),"H").concat(this.stateHash,"B").concat(m).concat(y?"T":"");if(!this._programCache[U]){var $=rS(this.gl,{vs:a,fs:s,modules:_,inject:c,defines:l,hookFunctions:this._hookFunctions,transpileToGLSL100:y});this._programCache[U]=new po(this.gl,{hash:U,vs:$.vs,fs:$.fs,varyings:d,bufferMode:m}),this._getUniforms[U]=$.getUniforms||function(H){},this._useCounts[U]=0}return this._useCounts[U]++,this._programCache[U]}},{key:"getUniforms",value:function(e){return this._getUniforms[e.hash]||null}},{key:"release",value:function(e){var n=e.hash;this._useCounts[n]--,this._useCounts[n]===0&&(this._programCache[n].delete(),delete this._programCache[n],delete this._getUniforms[n],delete this._useCounts[n])}},{key:"_getHash",value:function(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}},{key:"_getModuleList",value:function(){for(var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],n=new Array(this._defaultModules.length+e.length),i={},a=0,o=0,s=this._defaultModules.length;o<s;++o){var u=this._defaultModules[o],l=u.name;n[a++]=u,i[l]=!0}for(var f=0,c=e.length;f<c;++f){var p=e[f],d=p.name;i[d]||(n[a++]=p,i[d]=!0)}return n.length=a,n}}],[{key:"getDefaultProgramManager",value:function(e){return e.luma=e.luma||{},e.luma.defaultProgramManager=e.luma.defaultProgramManager||new t(e),e.luma.defaultProgramManager}}]),t}();var ZN=h(B());function KN(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function n0e(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?KN(Object(e),!0).forEach(function(n){(0,ZN.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):KN(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var i0e={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function JN(t,r,e){var n={},i=r.indices;for(var a in r.attributes){var o=r.attributes[a],s=a0e(a,e);if(a==="indices")i=o;else if(o.constant)n[s]=o.value;else{var u=o.value,l=n0e({},o);delete l.value,n[s]=[new xe(t,u),l],o0e(a,l)}}if(i){var f=i.value||i;Z(f instanceof Uint16Array||f instanceof Uint32Array,'attribute array for "indices" must be of integer type');var c={size:1,isIndexed:i.isIndexed===void 0?!0:i.isIndexed};n.indices=[new xe(t,{data:f,target:34963}),c]}return n}function a0e(t,r){var e=r||{},n=e.attributeMap,i=n===void 0?i0e:n;return i&&i[t]||t}function o0e(t,r){var e;switch(t){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":e="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":e="vectors";break;default:}switch(e){case"vectors":r.size=r.size||3;break;case"uvs":r.size=r.size||2;break;default:}Z(Number.isFinite(r.size),"attribute ".concat(t," needs size"))}var bl=2,s0e=1e4,u0e="Model needs drawMode and vertexCount",QN=function(){},l0e={},Ce=function(){function t(r){(0,tj.default)(this,t);var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=e.id,i=n===void 0?Ye("model"):n;Z(pa(r)),this.id=i,this.gl=r,this.id=e.id||Ye("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(e)}return(0,rj.default)(t,[{key:"initialize",value:function(e){this.props={},this.programManager=e.programManager||Pn.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;var n=e.program,i=n===void 0?null:n,a=e.vs,o=e.fs,s=e.modules,u=e.defines,l=e.inject,f=e.varyings,c=e.bufferMode,p=e.transpileToGLSL100;this.programProps={program:i,vs:a,fs:o,modules:s,defines:u,inject:l,varyings:f,bufferMode:c,transpileToGLSL100:p},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(e.moduleSettings))),this.drawMode=e.drawMode!==void 0?e.drawMode:4,this.vertexCount=e.vertexCount||0,this.geometryBuffers={},this.isInstanced=e.isInstanced||e.instanced||e.instanceCount>0,this._setModelProps(e),this.geometry={},Z(this.drawMode!==void 0&&Number.isFinite(this.vertexCount),u0e)}},{key:"setProps",value:function(e){this._setModelProps(e)}},{key:"delete",value:function(){for(var e in this._attributes)this._attributes[e]!==this.attributes[e]&&this._attributes[e].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}},{key:"getDrawMode",value:function(){return this.drawMode}},{key:"getVertexCount",value:function(){return this.vertexCount}},{key:"getInstanceCount",value:function(){return this.instanceCount}},{key:"getAttributes",value:function(){return this.attributes}},{key:"getProgram",value:function(){return this.program}},{key:"setProgram",value:function(e){var n=e.program,i=e.vs,a=e.fs,o=e.modules,s=e.defines,u=e.inject,l=e.varyings,f=e.bufferMode,c=e.transpileToGLSL100;this.programProps={program:n,vs:i,fs:a,modules:o,defines:s,inject:u,varyings:l,bufferMode:f,transpileToGLSL100:c},this._programDirty=!0}},{key:"getUniforms",value:function(){return this.uniforms}},{key:"setDrawMode",value:function(e){return this.drawMode=e,this}},{key:"setVertexCount",value:function(e){return Z(Number.isFinite(e)),this.vertexCount=e,this}},{key:"setInstanceCount",value:function(e){return Z(Number.isFinite(e)),this.instanceCount=e,this}},{key:"setGeometry",value:function(e){return this.drawMode=e.drawMode,this.vertexCount=e.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=JN(this.gl,e),this.vertexArray.setAttributes(this.geometryBuffers),this}},{key:"setAttributes",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Li(e))return this;var n={};for(var i in e){var a=e[i];n[i]=a.getValue?a.getValue():a}return this.vertexArray.setAttributes(n),this}},{key:"setUniforms",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object.assign(this.uniforms,e),this}},{key:"getModuleUniforms",value:function(e){this._checkProgram();var n=this.programManager.getUniforms(this.program);return n?n(e):{}}},{key:"updateModuleSettings",value:function(e){var n=this.getModuleUniforms(e||{});return this.setUniforms(n)}},{key:"clear",value:function(e){return wn(this.program.gl,e),this}},{key:"draw",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._checkProgram();var n=e.moduleSettings,i=n===void 0?null:n,a=e.framebuffer,o=e.uniforms,s=o===void 0?{}:o,u=e.attributes,l=u===void 0?{}:u,f=e.transformFeedback,c=f===void 0?this.transformFeedback:f,p=e.parameters,d=p===void 0?{}:p,v=e.vertexArray,m=v===void 0?this.vertexArray:v;this.setAttributes(l),this.updateModuleSettings(i),this.setUniforms(s);var g;ne.priority>=bl&&(g=this._logDrawCallStart(bl));var y=this.vertexArray.getDrawParams(),_=this.props,b=_.isIndexed,x=b===void 0?y.isIndexed:b,A=_.indexType,S=A===void 0?y.indexType:A,P=_.indexOffset,O=P===void 0?y.indexOffset:P,C=_.vertexArrayInstanced,T=C===void 0?y.isInstanced:C;T&&!this.isInstanced&&ne.warn("Found instanced attributes on non-instanced model",this.id)();var I=this.isInstanced,R=this.instanceCount,V=this.props,z=V.onBeforeRender,k=z===void 0?QN:z,G=V.onAfterRender,U=G===void 0?QN:G;k(),this.program.setUniforms(this.uniforms);var $=this.program.draw(Object.assign(l0e,e,{logPriority:g,uniforms:null,framebuffer:a,parameters:d,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:m,transformFeedback:c,isIndexed:x,indexType:S,isInstanced:I,instanceCount:R,offset:x?O:0}));return U(),ne.priority>=bl&&this._logDrawCallEnd(g,m,a),$}},{key:"transform",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.discard,i=n===void 0?!0:n,a=e.feedbackBuffers,o=e.unbindModels,s=o===void 0?[]:o,u=e.parameters;a&&this._setFeedbackBuffers(a),i&&(u=Object.assign({},u,(0,ej.default)({},35977,i))),s.forEach(function(l){return l.vertexArray.unbindBuffers()});try{this.draw(Object.assign({},e,{parameters:u}))}finally{s.forEach(function(l){return l.vertexArray.bindBuffers()})}return this}},{key:"render",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ne.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(e).draw()}},{key:"_setModelProps",value:function(e){Object.assign(this.props,e),"uniforms"in e&&this.setUniforms(e.uniforms),"pickable"in e&&(this.pickable=e.pickable),"instanceCount"in e&&(this.instanceCount=e.instanceCount),"geometry"in e&&this.setGeometry(e.geometry),"attributes"in e&&this.setAttributes(e.attributes),"_feedbackBuffers"in e&&this._setFeedbackBuffers(e._feedbackBuffers)}},{key:"_checkProgram",value:function(){var e=this._programDirty||this.programManager.stateHash!==this._programManagerState;if(e){var n=this.programProps.program;if(n)this._managedProgram=!1;else{var i=this.programProps,a=i.vs,o=i.fs,s=i.modules,u=i.inject,l=i.defines,f=i.varyings,c=i.bufferMode,p=i.transpileToGLSL100;n=this.programManager.get({vs:a,fs:o,modules:s,inject:u,defines:l,varyings:f,bufferMode:c,transpileToGLSL100:p}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}Z(n instanceof po,"Model needs a program"),this._programDirty=!1,n!==this.program&&(this.program=n,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new DA(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}}},{key:"_deleteGeometryBuffers",value:function(){for(var e in this.geometryBuffers){var n=this.geometryBuffers[e][0]||this.geometryBuffers[e];n instanceof xe&&n.delete()}}},{key:"_setAnimationProps",value:function(e){this.animated&&Z(e,"Model.draw(): animated uniforms but no animationProps")}},{key:"_setFeedbackBuffers",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Li(e))return this;var n=this.program.gl;return this.transformFeedback=this.transformFeedback||new ho(n,{program:this.program}),this.transformFeedback.setBuffers(e),this}},{key:"_logDrawCallStart",value:function(e){var n=e>3?0:s0e;if(!(Date.now()-this.lastLogTime<n))return this.lastLogTime=Date.now(),ne.group(bl,">>> DRAWING MODEL ".concat(this.id),{collapsed:ne.level<=2})(),e}},{key:"_logDrawCallEnd",value:function(e,n,i,a){if(e!==void 0){var o=UA({vertexArray:n,header:"".concat(this.id," attributes"),attributes:this._attributes}),s=cm({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,i)}),u=s.table,l=s.unusedTable,f=s.unusedCount,c=cm({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,i),undefinedOnly:!0}),p=c.table,d=c.count;d>0&&ne.log("MISSING UNIFORMS",Object.keys(p))(),f>0&&ne.log("UNUSED UNIFORMS",Object.keys(l))();var v=zA(this.vertexArray.configuration);ne.table(e,o)(),ne.table(e,u)(),ne.table(e+1,v)(),a&&a.log({logLevel:bl,message:"Rendered to ".concat(a.id)}),ne.groupEnd(bl)()}}}]),t}();var dj=h(L()),vj=h(N());var ij=h(L()),aj=h(N());function f0e(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=c0e(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function c0e(t,r){if(t){if(typeof t=="string")return nj(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return nj(t,r)}}function nj(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var oj=function(){function t(r){(0,ij.default)(this,t);var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=r,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(e),Object.seal(this)}return(0,aj.default)(t,[{key:"setupResources",value:function(e){var n=f0e(this.bindings),i;try{for(n.s();!(i=n.n()).done;){var a=i.value;this._setupTransformFeedback(a,e)}}catch(o){n.e(o)}finally{n.f()}}},{key:"updateModelProps",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=this.varyings;return n.length>0&&(e=Object.assign({},e,{varyings:n})),e}},{key:"getDrawOptions",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=this.bindings[this.currentIndex],i=n.sourceBuffers,a=n.transformFeedback,o=Object.assign({},i,e.attributes);return{attributes:o,transformFeedback:a}}},{key:"swap",value:function(){return this.feedbackMap?(this.currentIndex=this._getNextIndex(),!0):!1}},{key:"update",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e)}},{key:"getBuffer",value:function(e){var n=this.bindings[this.currentIndex].feedbackBuffers,i=e?n[e]:null;return i?i instanceof xe?i:i.buffer:null}},{key:"getData",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.varyingName,i=this.getBuffer(n);return i?i.getData():null}},{key:"delete",value:function(){for(var e in this.resources)this.resources[e].delete()}},{key:"_initialize",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e),this.varyings=e.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&Z(ce(this.gl))}},{key:"_getFeedbackBuffers",value:function(e){var n=e.sourceBuffers,i=n===void 0?{}:n,a={};if(this.bindings[this.currentIndex]&&Object.assign(a,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(var o in this.feedbackMap){var s=this.feedbackMap[o];o in i&&(a[s]=o)}Object.assign(a,e.feedbackBuffers);for(var u in a){var l=a[u];if(typeof l=="string"){var f=i[l],c=f.byteLength,p=f.usage,d=f.accessor;a[u]=this._createNewBuffer(u,{byteLength:c,usage:p,accessor:d})}}return a}},{key:"_setupBuffers",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.sourceBuffers,i=n===void 0?null:n;Object.assign(this.feedbackMap,e.feedbackMap);var a=this._getFeedbackBuffers(e);this._updateBindings({sourceBuffers:i,feedbackBuffers:a})}},{key:"_setupTransformFeedback",value:function(e,n){var i=n.model,a=i.program;e.transformFeedback=new ho(this.gl,{program:a,buffers:e.feedbackBuffers})}},{key:"_updateBindings",value:function(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this.feedbackMap){var n=this._swapBuffers(this.bindings[this.currentIndex]),i=n.sourceBuffers,a=n.feedbackBuffers,o=this._getNextIndex();this.bindings[o]=this._updateBinding(this.bindings[o],{sourceBuffers:i,feedbackBuffers:a})}}},{key:"_updateBinding",value:function(e,n){return e?(Object.assign(e.sourceBuffers,n.sourceBuffers),Object.assign(e.feedbackBuffers,n.feedbackBuffers),e.transformFeedback&&e.transformFeedback.setBuffers(e.feedbackBuffers),e):{sourceBuffers:Object.assign({},n.sourceBuffers),feedbackBuffers:Object.assign({},n.feedbackBuffers)}}},{key:"_swapBuffers",value:function(e){if(!this.feedbackMap)return null;var n=Object.assign({},e.sourceBuffers),i=Object.assign({},e.feedbackBuffers);for(var a in this.feedbackMap){var o=this.feedbackMap[a];n[a]=e.feedbackBuffers[o],i[o]=e.sourceBuffers[a],Z(i[o]instanceof xe)}return{sourceBuffers:n,feedbackBuffers:i}}},{key:"_createNewBuffer",value:function(e,n){var i=new xe(this.gl,n);return this.resources[e]&&this.resources[e].delete(),this.resources[e]=i,i}},{key:"_getNextIndex",value:function(){return(this.currentIndex+1)%2}}]),t}();var fj=h(L()),cj=h(N()),On=h(B());var p0e="transform_uSampler_",$m="transform_uSize_",sj="transform_position";function uj(t){var r=t.vs,e=t.sourceTextureMap,n=t.targetTextureVarying,i=t.targetTexture,a=Object.keys(e),o=a.length,s=null,u={},l=r,f={};if(o>0||n){var c=l.split(`
`),p=c.slice();if(c.forEach(function(y,_,b){if(o>0){var x=m0e(y,e);if(x){var A=x.updatedLine,S=x.inject;p[_]=A,f=fl([f,S]),Object.assign(u,x.samplerTextureMap),o--}}n&&!s&&(s=v0e(y,n))}),n){Z(i);var d="".concat($m).concat(n),v="uniform vec2 ".concat(d,`;
`),m="     vec2 ".concat(sj," = transform_getPos(").concat(d,`);
     gl_Position = vec4(`).concat(sj,`, 0, 1.);
`),g={"vs:#decl":v,"vs:#main-start":m};f=fl([f,g])}l=p.join(`
`)}return{vs:l,targetTextureType:s,inject:f,samplerTextureMap:u}}function lj(t){var r=t.sourceTextureMap,e=t.targetTextureVarying,n=t.targetTexture,i={},a,o;e&&(a=n.width,o=n.height,i["".concat($m).concat(e)]=[a,o]);for(var s in r){var u=r[s];a=u.width,o=u.height,i["".concat($m).concat(s)]=[a,o]}return i}function h0e(t){return _m(t,["attribute","in"])}function d0e(t){var r="".concat(p0e).concat(t),e="".concat($m).concat(t),n="  uniform sampler2D ".concat(r,`;
  uniform vec2 `).concat(e,";");return{samplerName:r,sizeName:e,uniformDeclerations:n}}function v0e(t,r){var e=_m(t,["varying","out"]);return e&&e.name===r?e.type:null}function m0e(t,r){var e={},n=h0e(t);if(!n)return null;var i=n.type,a=n.name;if(a&&r[a]){var o="// ".concat(t," => Replaced by Transform with a sampler"),s=d0e(a),u=s.samplerName,l=s.sizeName,f=s.uniformDeclerations,c=nS(i),p="  ".concat(i," ").concat(a," = transform_getInput(").concat(u,", ").concat(l,").").concat(c,`;
`);e[u]=a;var d={"vs:#decl":f,"vs:#main-start":p};return{updatedLine:o,inject:d,samplerTextureMap:e}}return null}var xl,g0e=(xl={},(0,On.default)(xl,10241,9728),(0,On.default)(xl,10240,9728),(0,On.default)(xl,10242,33071),(0,On.default)(xl,10243,33071),xl),y0e="transform_output",pj=function(){function t(r){(0,fj.default)(this,t);var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=r,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(e),Object.seal(this)}return(0,cj.default)(t,[{key:"updateModelProps",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=this._processVertexShader(e);return Object.assign({},e,n)}},{key:"getDrawOptions",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=this.bindings[this.currentIndex],i=n.sourceBuffers,a=n.sourceTextures,o=n.framebuffer,s=n.targetTexture,u=Object.assign({},i,e.attributes),l=Object.assign({},e.uniforms),f=Object.assign({},e.parameters),c=e.discard;if(this.hasSourceTextures||this.hasTargetTexture){u.transform_elementID=this.elementIDBuffer;for(var p in this.samplerTextureMap){var d=this.samplerTextureMap[p];l[p]=a[d]}this._setSourceTextureParameters();var v=lj({sourceTextureMap:a,targetTextureVarying:this.targetTextureVarying,targetTexture:s});Object.assign(l,v)}return this.hasTargetTexture&&(c=!1,f.viewport=[0,0,o.width,o.height]),{attributes:u,framebuffer:o,uniforms:l,discard:c,parameters:f}}},{key:"swap",value:function(){return this._swapTexture?(this.currentIndex=this._getNextIndex(),!0):!1}},{key:"update",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupTextures(e)}},{key:"getTargetTexture",value:function(){var e=this.bindings[this.currentIndex].targetTexture;return e}},{key:"getData",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.packed,i=n===void 0?!1:n,a=this.bindings[this.currentIndex].framebuffer,o=ei(a);if(!i)return o;for(var s=o.constructor,u=iS(this.targetTextureType),l=new s(o.length*u/4),f=0,c=0;c<o.length;c+=4)for(var p=0;p<u;p++)l[f++]=o[c+p];return l}},{key:"getFramebuffer",value:function(){var e=this.bindings[this.currentIndex];return e.framebuffer}},{key:"delete",value:function(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}},{key:"_initialize",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e._targetTextureVarying,i=e._swapTexture;this._swapTexture=i,this.targetTextureVarying=n,this.hasTargetTexture=n,this._setupTextures(e)}},{key:"_createTargetTexture",value:function(e){var n=e.sourceTextures,i=e.textureOrReference;if(i instanceof we)return i;var a=n[i];return a?(this._targetRefTexName=i,this._createNewTexture(a)):null}},{key:"_setupTextures",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.sourceBuffers,i=e._sourceTextures,a=i===void 0?{}:i,o=e._targetTexture,s=this._createTargetTexture({sourceTextures:a,textureOrReference:o});this.hasSourceTextures=this.hasSourceTextures||a&&Object.keys(a).length>0,this._updateBindings({sourceBuffers:n,sourceTextures:a,targetTexture:s}),"elementCount"in e&&this._updateElementIDBuffer(e.elementCount)}},{key:"_updateElementIDBuffer",value:function(e){if(!(typeof e!="number"||this.elementCount>=e)){var n=new Float32Array(e);n.forEach(function(i,a,o){o[a]=a}),this.elementIDBuffer?this.elementIDBuffer.setData({data:n}):this.elementIDBuffer=new xe(this.gl,{data:n,accessor:{size:1}}),this.elementCount=e}}},{key:"_updateBindings",value:function(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this._swapTexture){var n=this._swapTextures(this.bindings[this.currentIndex]),i=n.sourceTextures,a=n.targetTexture,o=this._getNextIndex();this.bindings[o]=this._updateBinding(this.bindings[o],{sourceTextures:i,targetTexture:a})}}},{key:"_updateBinding",value:function(e,n){var i=n.sourceBuffers,a=n.sourceTextures,o=n.targetTexture;if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,a),Object.assign(e.sourceBuffers,i),o){e.targetTexture=o;var s=o.width,u=o.height,l=e,f=l.framebuffer;f?(f.update({attachments:(0,On.default)({},36064,o),resizeAttachments:!1}),f.resize({width:s,height:u})):e.framebuffer=new Re(this.gl,{id:"transform-framebuffer",width:s,height:u,attachments:(0,On.default)({},36064,o)})}return e}},{key:"_setSourceTextureParameters",value:function(){var e=this.currentIndex,n=this.bindings[e].sourceTextures;for(var i in n)n[i].setParameters(g0e)}},{key:"_swapTextures",value:function(e){if(!this._swapTexture)return null;var n=Object.assign({},e.sourceTextures);n[this._swapTexture]=e.targetTexture;var i=e.sourceTextures[this._swapTexture];return{sourceTextures:n,targetTexture:i}}},{key:"_createNewTexture",value:function(e){var n,i=ul(e,{parameters:(n={},(0,On.default)(n,10241,9728),(0,On.default)(n,10240,9728),(0,On.default)(n,10242,33071),(0,On.default)(n,10243,33071),n),pixelStore:(0,On.default)({},37440,!1)});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=i,i}},{key:"_getNextIndex",value:function(){return(this.currentIndex+1)%2}},{key:"_processVertexShader",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=this.bindings[this.currentIndex],i=n.sourceTextures,a=n.targetTexture,o=uj({vs:e.vs,sourceTextureMap:i,targetTextureVarying:this.targetTextureVarying,targetTexture:a}),s=o.vs,u=o.uniforms,l=o.targetTextureType,f=o.inject,c=o.samplerTextureMap,p=fl([e.inject||{},f]);this.targetTextureType=l,this.samplerTextureMap=c;var d=e._fs||_p({version:ll(s),input:this.targetTextureVarying,inputType:l,output:y0e}),v=this.hasSourceTextures||this.targetTextureVarying?[kS].concat(e.modules||[]):e.modules;return{vs:s,fs:d,modules:v,uniforms:u,inject:p}}}]),t}();function Ep(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=_0e(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function _0e(t,r){if(t){if(typeof t=="string")return hj(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return hj(t,r)}}function hj(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var Nr=function(){function t(r){(0,dj.default)(this,t);var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=r,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(e),Object.seal(this)}return(0,vj.default)(t,[{key:"delete",value:function(){var e=this.model,n=this.bufferTransform,i=this.textureTransform;e&&e.delete(),n&&n.delete(),i&&i.delete()}},{key:"run",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.clearRenderTarget,i=n===void 0?!0:n,a=this._updateDrawOptions(e);i&&a.framebuffer&&a.framebuffer.clear({color:!0}),this.model.transform(a)}},{key:"swap",value:function(){var e=!1,n=[this.bufferTransform,this.textureTransform].filter(Boolean),i=Ep(n),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;e=e||o.swap()}}catch(s){i.e(s)}finally{i.f()}Z(e,"Nothing to swap")}},{key:"getBuffer",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return this.bufferTransform&&this.bufferTransform.getBuffer(e)}},{key:"getData",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=[this.bufferTransform,this.textureTransform].filter(Boolean),i=Ep(n),a;try{for(i.s();!(a=i.n()).done;){var o=a.value,s=o.getData(e);if(s)return s}}catch(u){i.e(u)}finally{i.f()}return null}},{key:"getFramebuffer",value:function(){return this.textureTransform&&this.textureTransform.getFramebuffer()}},{key:"update",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};"elementCount"in e&&this.model.setVertexCount(e.elementCount);var n=[this.bufferTransform,this.textureTransform].filter(Boolean),i=Ep(n),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;o.update(e)}}catch(s){i.e(s)}finally{i.f()}}},{key:"_initialize",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=this.gl;this._buildResourceTransforms(n,e),e=this._updateModelProps(e),this.model=new Ce(n,Object.assign({},e,{fs:e.fs||_p({version:ll(e.vs)}),id:e.id||"transform-model",drawMode:e.drawMode||0,vertexCount:e.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}},{key:"_updateModelProps",value:function(e){var n=Object.assign({},e),i=[this.bufferTransform,this.textureTransform].filter(Boolean),a=Ep(i),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;n=s.updateModelProps(n)}}catch(u){a.e(u)}finally{a.f()}return n}},{key:"_buildResourceTransforms",value:function(e,n){b0e(n)&&(this.bufferTransform=new oj(e,n)),x0e(n)&&(this.textureTransform=new pj(e,n)),Z(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}},{key:"_updateDrawOptions",value:function(e){var n=Object.assign({},e),i=[this.bufferTransform,this.textureTransform].filter(Boolean),a=Ep(i),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;n=Object.assign(n,s.getDrawOptions(n))}}catch(u){a.e(u)}finally{a.f()}return n}}],[{key:"isSupported",value:function(e){return ce(e)}}]),t}();function b0e(t){return!!(!Li(t.feedbackBuffers)||!Li(t.feedbackMap)||t.varyings&&t.varyings.length>0)}function x0e(t){return!!(!Li(t._sourceTextures)||t._targetTexture||t._targetTextureVarying)}var yj=h(B()),_j=h(L()),bj=h(N());function mj(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function A0e(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?mj(Object(e),!0).forEach(function(n){(0,yj.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):mj(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var gj={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Me=function(){function t(){(0,_j.default)(this,t);var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=r.id,n=e===void 0?Ye("geometry"):e,i=r.drawMode,a=i===void 0?gj.TRIANGLES:i,o=r.attributes,s=o===void 0?{}:o,u=r.indices,l=u===void 0?null:u,f=r.vertexCount,c=f===void 0?null:f;this.id=n,this.drawMode=a|0,this.attributes={},this.userData={},this._setAttributes(s,l),this.vertexCount=c||this._calculateVertexCount(this.attributes,this.indices)}return(0,bj.default)(t,[{key:"mode",get:function(){return this.drawMode}},{key:"getVertexCount",value:function(){return this.vertexCount}},{key:"getAttributes",value:function(){return this.indices?A0e({indices:this.indices},this.attributes):this.attributes}},{key:"_print",value:function(e){return"Geometry ".concat(this.id," attribute ").concat(e)}},{key:"_setAttributes",value:function(e,n){n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n);for(var i in e){var a=e[i];a=ArrayBuffer.isView(a)?{value:a}:a,Z(ArrayBuffer.isView(a.value),"".concat(this._print(i),": must be typed array or object with value as typed array")),(i==="POSITION"||i==="positions")&&!a.size&&(a.size=3),i==="indices"?(Z(!this.indices),this.indices=a):this.attributes[i]=a}return this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}},{key:"_calculateVertexCount",value:function(e,n){if(n)return n.value.length;var i=1/0;for(var a in e){var o=e[a],s=o.value,u=o.size,l=o.constant;!l&&s&&u>=1&&(i=Math.min(i,s.length/u))}return Z(Number.isFinite(i)),i}}],[{key:"DRAW_MODE",get:function(){return gj}}]),t}();var Ej=h(B()),Cj=h(L()),Mj=h(Y()),Ij=h(K()),FS=h(q());var Aj=h(B()),Sj=h(L()),Tj=h(Y()),wj=h(K()),BS=h(q());function xj(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Xm(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?xj(Object(e),!0).forEach(function(n){(0,Aj.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):xj(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function S0e(t){var r=T0e();return function(){var n=(0,BS.default)(t),i;if(r){var a=(0,BS.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,wj.default)(this,i)}}function T0e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var w0e={x:[2,0,1],y:[0,1,2],z:[1,2,0]},yo=function(t){(0,Tj.default)(e,t);var r=S0e(e);function e(){(0,Sj.default)(this,e);var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.id,a=i===void 0?Ye("truncated-code-geometry"):i,o=P0e(n),s=o.indices,u=o.attributes;return r.call(this,Xm(Xm({},n),{},{id:a,indices:s,attributes:Xm(Xm({},u),n.attributes)}))}return e}(Me);function P0e(t){for(var r=t.bottomRadius,e=r===void 0?0:r,n=t.topRadius,i=n===void 0?0:n,a=t.height,o=a===void 0?1:a,s=t.nradial,u=s===void 0?10:s,l=t.nvertical,f=l===void 0?10:l,c=t.verticalAxis,p=c===void 0?"y":c,d=t.topCap,v=d===void 0?!1:d,m=t.bottomCap,g=m===void 0?!1:m,y=(v?2:0)+(g?2:0),_=(u+1)*(f+1+y),b=Math.atan2(e-i,o),x=Math.sin,A=Math.cos,S=Math.PI,P=A(b),O=x(b),C=v?-2:0,T=f+(g?2:0),I=u+1,R=new Uint16Array(u*(f+y)*6),V=w0e[p],z=new Float32Array(_*3),k=new Float32Array(_*3),G=new Float32Array(_*2),U=0,$=0,H=C;H<=T;H++){var Q=H/f,ie=o*Q,fe=void 0;H<0?(ie=0,Q=1,fe=e):H>f?(ie=o,Q=1,fe=i):fe=e+(i-e)*(H/f),(H===-2||H===f+2)&&(fe=0,Q=0),ie-=o/2;for(var Ae=0;Ae<I;Ae++){var Oe=x(Ae*S*2/u),Xe=A(Ae*S*2/u);z[U+V[0]]=Oe*fe,z[U+V[1]]=ie,z[U+V[2]]=Xe*fe,k[U+V[0]]=H<0||H>f?0:Oe*P,k[U+V[1]]=H<0?-1:H>f?1:O,k[U+V[2]]=H<0||H>f?0:Xe*P,G[$+0]=Ae/u,G[$+1]=Q,$+=2,U+=3}}for(var ge=0;ge<f+y;ge++)for(var qe=0;qe<u;qe++){var Ie=(ge*u+qe)*6;R[Ie+0]=I*(ge+0)+0+qe,R[Ie+1]=I*(ge+0)+1+qe,R[Ie+2]=I*(ge+1)+1+qe,R[Ie+3]=I*(ge+0)+0+qe,R[Ie+4]=I*(ge+1)+1+qe,R[Ie+5]=I*(ge+1)+0+qe}return{indices:R,attributes:{POSITION:{size:3,value:z},NORMAL:{size:3,value:k},TEXCOORD_0:{size:2,value:G}}}}function Pj(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Oj(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Pj(Object(e),!0).forEach(function(n){(0,Ej.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Pj(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function O0e(t){var r=E0e();return function(){var n=(0,FS.default)(t),i;if(r){var a=(0,FS.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Ij.default)(this,i)}}function E0e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var qm=function(t){(0,Mj.default)(e,t);var r=O0e(e);function e(){(0,Cj.default)(this,e);var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.id,a=i===void 0?Ye("cone-geometry"):i,o=n.radius,s=o===void 0?1:o,u=n.cap,l=u===void 0?!0:u;return r.call(this,Oj(Oj({},n),{},{id:a,topRadius:0,topCap:Boolean(l),bottomCap:Boolean(l),bottomRadius:s}))}return e}(yo);var Lj=h(B()),kj=h(L()),Bj=h(Y()),Fj=h(K()),DS=h(q());function Rj(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Ym(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Rj(Object(e),!0).forEach(function(n){(0,Lj.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Rj(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function C0e(t){var r=M0e();return function(){var n=(0,DS.default)(t),i;if(r){var a=(0,DS.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Fj.default)(this,i)}}function M0e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var I0e=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),R0e=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),L0e=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),k0e=new Float32Array([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]),B0e={POSITION:{size:3,value:new Float32Array(R0e)},NORMAL:{size:3,value:new Float32Array(L0e)},TEXCOORD_0:{size:2,value:new Float32Array(k0e)}},_o=function(t){(0,Bj.default)(e,t);var r=C0e(e);function e(){(0,kj.default)(this,e);var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.id,a=i===void 0?Ye("cube-geometry"):i;return r.call(this,Ym(Ym({},n),{},{id:a,indices:{size:1,value:new Uint16Array(I0e)},attributes:Ym(Ym({},B0e),n.attributes)}))}return e}(Me);var jj=h(B()),Uj=h(L()),Gj=h(Y()),zj=h(K()),NS=h(q());function Dj(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Nj(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Dj(Object(e),!0).forEach(function(n){(0,jj.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Dj(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function F0e(t){var r=D0e();return function(){var n=(0,NS.default)(t),i;if(r){var a=(0,NS.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,zj.default)(this,i)}}function D0e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Km=function(t){(0,Gj.default)(e,t);var r=F0e(e);function e(){(0,Uj.default)(this,e);var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.id,a=i===void 0?Ye("cylinder-geometry"):i,o=n.radius,s=o===void 0?1:o;return r.call(this,Nj(Nj({},n),{},{id:a,bottomRadius:s,topRadius:s}))}return e}(yo);var Hj=h(B()),Wj=h(L()),$j=h(Y()),Xj=h(K()),jS=h(q());function Vj(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Zm(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Vj(Object(e),!0).forEach(function(n){(0,Hj.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Vj(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function N0e(t){var r=j0e();return function(){var n=(0,jS.default)(t),i;if(r){var a=(0,jS.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Xj.default)(this,i)}}function j0e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var U0e=[-1,0,0,0,1,0,0,0,-1,0,0,1,0,-1,0,1,0,0],G0e=[3,4,5,3,5,1,3,1,0,3,0,4,4,0,2,4,2,5,2,0,1,5,2,1],Jm=function(t){(0,$j.default)(e,t);var r=N0e(e);function e(){(0,Wj.default)(this,e);var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.id,a=i===void 0?Ye("ico-sphere-geometry"):i,o=z0e(n),s=o.indices,u=o.attributes;return r.call(this,Zm(Zm({},n),{},{id:a,indices:s,attributes:Zm(Zm({},u),n.attributes)}))}return e}(Me);function z0e(t){var r=t.iterations,e=r===void 0?0:r,n=Math.PI,i=n*2,a=[].concat(U0e),o=[].concat(G0e);a.push(),o.push();for(var s=function(){var $n={};return function(Xn,qn){Xn*=3,qn*=3;var Hu=Xn<qn?Xn:qn,$r=Xn>qn?Xn:qn,wc="".concat(Hu,"|").concat($r);if(wc in $n)return $n[wc];var e1=a[Xn],t1=a[Xn+1],r1=a[Xn+2],n1=a[qn],tv=a[qn+1],rv=a[qn+2],rs=(e1+n1)/2,ns=(t1+tv)/2,oa=(r1+rv)/2,is=Math.sqrt(rs*rs+ns*ns+oa*oa);return rs/=is,ns/=is,oa/=is,a.push(rs,ns,oa),$n[wc]=a.length/3-1}}(),u=0;u<e;u++){for(var l=[],f=0;f<o.length;f+=3){var c=s(o[f+0],o[f+1]),p=s(o[f+1],o[f+2]),d=s(o[f+2],o[f+0]);l.push(d,o[f+0],c,c,o[f+1],p,p,o[f+2],d,c,p,d)}o=l}for(var v=new Array(a.length),m=new Array(a.length/3*2),g=o.length,y=g-3;y>=0;y-=3){var _=o[y+0],b=o[y+1],x=o[y+2],A=_*3,S=b*3,P=x*3,O=_*2,C=b*2,T=x*2,I=a[A+0],R=a[A+1],V=a[A+2],z=Math.acos(V/Math.sqrt(I*I+R*R+V*V)),k=Math.atan2(R,I)+n,G=z/n,U=1-k/i,$=a[S+0],H=a[S+1],Q=a[S+2],ie=Math.acos(Q/Math.sqrt($*$+H*H+Q*Q)),fe=Math.atan2(H,$)+n,Ae=ie/n,Oe=1-fe/i,Xe=a[P+0],ge=a[P+1],qe=a[P+2],Ie=Math.acos(qe/Math.sqrt(Xe*Xe+ge*ge+qe*qe)),Et=Math.atan2(ge,Xe)+n,Wn=Ie/n,sn=1-Et/i,no=[Xe-$,ge-H,qe-Q],zt=[I-$,R-H,V-Q],fr=new j(no).cross(zt).normalize(),et=void 0;(U===0||Oe===0||sn===0)&&(U===0||U>.5)&&(Oe===0||Oe>.5)&&(sn===0||sn>.5)&&(a.push(a[A+0],a[A+1],a[A+2]),et=a.length/3-1,o.push(et),m[et*2+0]=1,m[et*2+1]=G,v[et*3+0]=fr.x,v[et*3+1]=fr.y,v[et*3+2]=fr.z,a.push(a[S+0],a[S+1],a[S+2]),et=a.length/3-1,o.push(et),m[et*2+0]=1,m[et*2+1]=Ae,v[et*3+0]=fr.x,v[et*3+1]=fr.y,v[et*3+2]=fr.z,a.push(a[P+0],a[P+1],a[P+2]),et=a.length/3-1,o.push(et),m[et*2+0]=1,m[et*2+1]=Wn,v[et*3+0]=fr.x,v[et*3+1]=fr.y,v[et*3+2]=fr.z),v[A+0]=v[S+0]=v[P+0]=fr.x,v[A+1]=v[S+1]=v[P+1]=fr.y,v[A+2]=v[S+2]=v[P+2]=fr.z,m[O+0]=U,m[O+1]=G,m[C+0]=Oe,m[C+1]=Ae,m[T+0]=sn,m[T+1]=Wn}return{indices:{size:1,value:new Uint16Array(o)},attributes:{POSITION:{size:3,value:new Float32Array(a)},NORMAL:{size:3,value:new Float32Array(v)},TEXCOORD_0:{size:2,value:new Float32Array(m)}}}}var Kj=h(B()),Zj=h(L()),Jj=h(Y()),Qj=h(K()),US=h(q());function qj(t){var r=t.indices,e=t.attributes;if(!r)return t;var n=r.value.length,i={};for(var a in e){var o=e[a],s=o.constant,u=o.value,l=o.size;if(!(s||!l)){for(var f=new u.constructor(n*l),c=0;c<n;++c)for(var p=r.value[c],d=0;d<l;d++)f[c*l+d]=u[p*l+d];i[a]={size:l,value:f}}}return{attributes:Object.assign({},e,i)}}function Yj(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Qm(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Yj(Object(e),!0).forEach(function(n){(0,Kj.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Yj(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function V0e(t){var r=H0e();return function(){var n=(0,US.default)(t),i;if(r){var a=(0,US.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Qj.default)(this,i)}}function H0e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var eg=function(t){(0,Jj.default)(e,t);var r=V0e(e);function e(){(0,Zj.default)(this,e);var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.id,a=i===void 0?Ye("plane-geometry"):i,o=W0e(n),s=o.indices,u=o.attributes;return r.call(this,Qm(Qm({},n),{},{id:a,indices:s,attributes:Qm(Qm({},u),n.attributes)}))}return e}(Me);function W0e(t){var r=t.type,e=r===void 0?"x,y":r,n=t.offset,i=n===void 0?0:n,a=t.flipCull,o=a===void 0?!1:a,s=t.unpack,u=s===void 0?!1:s,l=e.split(","),f=t["".concat(l[0],"len")]||1,c=t["".concat(l[1],"len")]||1,p=t["n".concat(l[0])]||1,d=t["n".concat(l[1])]||1,v=(p+1)*(d+1),m=new Float32Array(v*3),g=new Float32Array(v*3),y=new Float32Array(v*2);o&&(f=-f);for(var _=0,b=0,x=0;x<=d;x++)for(var A=0;A<=p;A++){var S=A/p,P=x/d;switch(y[_+0]=o?1-S:S,y[_+1]=P,e){case"x,y":m[b+0]=f*S-f*.5,m[b+1]=c*P-c*.5,m[b+2]=i,g[b+0]=0,g[b+1]=0,g[b+2]=o?1:-1;break;case"x,z":m[b+0]=f*S-f*.5,m[b+1]=i,m[b+2]=c*P-c*.5,g[b+0]=0,g[b+1]=o?1:-1,g[b+2]=0;break;case"y,z":m[b+0]=i,m[b+1]=f*S-f*.5,m[b+2]=c*P-c*.5,g[b+0]=o?1:-1,g[b+1]=0,g[b+2]=0;break;default:throw new Error("PlaneGeometry: unknown type")}_+=2,b+=3}for(var O=p+1,C=new Uint16Array(p*d*6),T=0;T<d;T++)for(var I=0;I<p;I++){var R=(T*p+I)*6;C[R+0]=(T+0)*O+I,C[R+1]=(T+1)*O+I,C[R+2]=(T+0)*O+I+1,C[R+3]=(T+1)*O+I,C[R+4]=(T+1)*O+I+1,C[R+5]=(T+0)*O+I+1}var V={indices:{size:1,value:C},attributes:{POSITION:{size:3,value:m},NORMAL:{size:3,value:g},TEXCOORD_0:{size:2,value:y}}};return u?qj(V):V}var t4=h(B()),r4=h(L()),n4=h(Y()),i4=h(K()),GS=h(q());function e4(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function tg(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?e4(Object(e),!0).forEach(function(n){(0,t4.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):e4(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function $0e(t){var r=X0e();return function(){var n=(0,GS.default)(t),i;if(r){var a=(0,GS.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,i4.default)(this,i)}}function X0e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var rg=function(t){(0,n4.default)(e,t);var r=$0e(e);function e(){(0,r4.default)(this,e);var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.id,a=i===void 0?Ye("sphere-geometry"):i,o=q0e(n),s=o.indices,u=o.attributes;return r.call(this,tg(tg({},n),{},{id:a,indices:s,attributes:tg(tg({},u),n.attributes)}))}return e}(Me);function q0e(t){var r=t.nlat,e=r===void 0?10:r,n=t.nlong,i=n===void 0?10:n,a=t.radius,o=a===void 0?1:a,s=0,u=Math.PI,l=u-s,f=0,c=2*Math.PI,p=c-f,d=(e+1)*(i+1);if(typeof o=="number"){var v=o;o=function(ge,qe,Ie,Et,Wn){return v}}for(var m=new Float32Array(d*3),g=new Float32Array(d*3),y=new Float32Array(d*2),_=d>65535?Uint32Array:Uint16Array,b=new _(e*i*6),x=0;x<=e;x++)for(var A=0;A<=i;A++){var S=A/i,P=x/e,O=A+x*(i+1),C=O*2,T=O*3,I=p*S,R=l*P,V=Math.sin(I),z=Math.cos(I),k=Math.sin(R),G=Math.cos(R),U=z*k,$=G,H=V*k,Q=o(U,$,H,S,P);m[T+0]=Q*U,m[T+1]=Q*$,m[T+2]=Q*H,g[T+0]=U,g[T+1]=$,g[T+2]=H,y[C+0]=S,y[C+1]=1-P}for(var ie=i+1,fe=0;fe<i;fe++)for(var Ae=0;Ae<e;Ae++){var Oe=(fe*e+Ae)*6;b[Oe+0]=Ae*ie+fe,b[Oe+1]=Ae*ie+fe+1,b[Oe+2]=(Ae+1)*ie+fe,b[Oe+3]=(Ae+1)*ie+fe,b[Oe+4]=Ae*ie+fe+1,b[Oe+5]=(Ae+1)*ie+fe+1}return{indices:{size:1,value:b},attributes:{POSITION:{size:3,value:m},NORMAL:{size:3,value:g},TEXCOORD_0:{size:2,value:y}}}}var o4=h(me()),s4=h(L()),u4=h(N());function zS(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=Y0e(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function Y0e(t,r){if(t){if(typeof t=="string")return a4(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return a4(t,r)}}function a4(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var K0e=1,Z0e=1,bo=function(){function t(){(0,s4.default)(this,t),this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}return(0,u4.default)(t,[{key:"addChannel",value:function(e){var n=e.delay,i=n===void 0?0:n,a=e.duration,o=a===void 0?Number.POSITIVE_INFINITY:a,s=e.rate,u=s===void 0?1:s,l=e.repeat,f=l===void 0?1:l,c=K0e++,p={time:0,delay:i,duration:o,rate:u,repeat:f};return this._setChannelTime(p,this.time),this.channels.set(c,p),c}},{key:"removeChannel",value:function(e){this.channels.delete(e);var n=zS(this.animations),i;try{for(n.s();!(i=n.n()).done;){var a=(0,o4.default)(i.value,2),o=a[0],s=a[1];s.channel===e&&this.detachAnimation(o)}}catch(u){n.e(u)}finally{n.f()}}},{key:"isFinished",value:function(e){var n=this.channels.get(e);return n===void 0?!1:this.time>=n.delay+n.duration*n.repeat}},{key:"getTime",value:function(e){if(e===void 0)return this.time;var n=this.channels.get(e);return n===void 0?-1:n.time}},{key:"setTime",value:function(e){this.time=Math.max(0,e);var n=this.channels.values(),i=zS(n),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;this._setChannelTime(o,this.time)}}catch(d){i.e(d)}finally{i.f()}var s=this.animations.values(),u=zS(s),l;try{for(u.s();!(l=u.n()).done;){var f=l.value,c=f.animation,p=f.channel;c.setTime(this.getTime(p))}}catch(d){u.e(d)}finally{u.f()}}},{key:"play",value:function(){this.playing=!0}},{key:"pause",value:function(){this.playing=!1,this.lastEngineTime=-1}},{key:"reset",value:function(){this.setTime(0)}},{key:"attachAnimation",value:function(e,n){var i=Z0e++;return this.animations.set(i,{animation:e,channel:n}),e.setTime(this.getTime(n)),i}},{key:"detachAnimation",value:function(e){this.animations.delete(e)}},{key:"update",value:function(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}},{key:"_setChannelTime",value:function(e,n){var i=n-e.delay,a=e.duration*e.repeat;i>=a?e.time=e.duration*e.rate:(e.time=Math.max(0,i)%e.duration,e.time*=e.rate)}}]),t}();var f4=h(L()),c4=h(Y()),p4=h(K()),VS=h(q());function J0e(t){var r=Q0e();return function(){var n=(0,VS.default)(t),i;if(r){var a=(0,VS.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,p4.default)(this,i)}}function Q0e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var e_e=`attribute vec2 aClipSpacePosition;
attribute vec2 aTexCoord;
attribute vec2 aCoordinate;

varying vec2 position;
varying vec2 coordinate;
varying vec2 uv;

void main(void) {
  gl_Position = vec4(aClipSpacePosition, 0., 1.);
  position = aClipSpacePosition;
  coordinate = aCoordinate;
  uv = aTexCoord;
}
`,l4=[-1,-1,1,-1,-1,1,1,1],ng=function(t){(0,c4.default)(e,t);var r=J0e(e);function e(n,i){var a;(0,f4.default)(this,e);var o=l4.map(function(s){return s===-1?0:s});return a=r.call(this,n,Object.assign({},i,{vs:e_e,geometry:new Me({drawMode:5,vertexCount:4,attributes:{aClipSpacePosition:{size:2,value:new Float32Array(l4)},aTexCoord:{size:2,value:new Float32Array(o)},aCoordinate:{size:2,value:new Float32Array(o)}}})})),a.setVertexCount(4),a}return e}(Ce);var h4=h(L()),Cp=h(B()),t_e=[255,255,255],r_e=1,n_e=0,ig=function t(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,h4.default)(this,t),(0,Cp.default)(this,"id",void 0),(0,Cp.default)(this,"color",void 0),(0,Cp.default)(this,"intensity",void 0),(0,Cp.default)(this,"type","ambient");var e=r.color,n=e===void 0?t_e:e,i=r.intensity,a=i===void 0?r_e:i;this.id=r.id||"ambient-".concat(n_e++),this.color=n,this.intensity=a};var d4=h(L()),v4=h(N()),Ms=h(B());var i_e=[255,255,255],a_e=1,o_e=[0,0,-1],s_e=0,Is=function(){function t(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,d4.default)(this,t),(0,Ms.default)(this,"id",void 0),(0,Ms.default)(this,"color",void 0),(0,Ms.default)(this,"intensity",void 0),(0,Ms.default)(this,"type","directional"),(0,Ms.default)(this,"direction",void 0),(0,Ms.default)(this,"shadow",void 0);var e=r.color,n=e===void 0?i_e:e,i=r.intensity,a=i===void 0?a_e:i,o=r.direction,s=o===void 0?o_e:o,u=r._shadow,l=u===void 0?!1:u;this.id=r.id||"directional-".concat(s_e++),this.color=n,this.intensity=a,this.type="directional",this.direction=new j(s).normalize().toArray(),this.shadow=l}return(0,v4.default)(t,[{key:"getProjectedLight",value:function(e){return this}}]),t}();var C4=h(L()),M4=h(N()),og=h(be()),I4=h(Ee()),R4=h(Y()),L4=h(K()),sg=h(q()),ni=h(B());var b4=h(L()),x4=h(N()),A4=h(be()),S4=h(Y()),T4=h(K()),WS=h(q()),w4=h(B());var g4=h(L()),y4=h(N()),Mp=h(B());function m4(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function u_e(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?m4(Object(e),!0).forEach(function(n){(0,Mp.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):m4(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var ag=function(){function t(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{id:"pass"};(0,g4.default)(this,t),(0,Mp.default)(this,"id",void 0),(0,Mp.default)(this,"gl",void 0),(0,Mp.default)(this,"props",void 0);var n=e.id;this.id=n,this.gl=r,this.props=u_e({},e)}return(0,y4.default)(t,[{key:"setProps",value:function(e){Object.assign(this.props,e)}},{key:"render",value:function(e){}},{key:"cleanup",value:function(){}}]),t}();function HS(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=l_e(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function l_e(t,r){if(t){if(typeof t=="string")return _4(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return _4(t,r)}}function _4(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function f_e(t){var r=c_e();return function(){var n=(0,WS.default)(t),i;if(r){var a=(0,WS.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,T4.default)(this,i)}}function c_e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Xr=function(t){(0,S4.default)(e,t);var r=f_e(e);function e(){var n;(0,b4.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,w4.default)((0,A4.default)(n),"_lastRenderIndex",-1),n}return(0,x4.default)(e,[{key:"render",value:function(i){var a=this.gl;return Ht(a,{framebuffer:i.target}),this._drawLayers(i)}},{key:"_drawLayers",value:function(i){var a=i.target,o=i.moduleParameters,s=i.viewports,u=i.views,l=i.onViewportActive,f=i.clearStack,c=f===void 0?!0:f,p=i.clearCanvas,d=p===void 0?!0:p;i.pass=i.pass||"unknown";var v=this.gl;d&&h_e(v,a),c&&(this._lastRenderIndex=-1);var m=[],g=HS(s),y;try{for(g.s();!(y=g.n()).done;){var _=y.value,b=u&&u[_.id];l?.(_);var x=this._getDrawLayerParams(_,i),A=_.subViewports||[_],S=HS(A),P;try{for(S.s();!(P=S.n()).done;){var O=P.value,C=this._drawLayersInViewport(v,{target:a,moduleParameters:o,viewport:O,view:b,pass:i.pass,layers:i.layers},x);m.push(C)}}catch(T){S.e(T)}finally{S.f()}}}catch(T){g.e(T)}finally{g.f()}return m}},{key:"_getDrawLayerParams",value:function(i,a){for(var o=a.layers,s=a.pass,u=a.isPicking,l=u===void 0?!1:u,f=a.layerFilter,c=a.cullRect,p=a.effects,d=a.moduleParameters,v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,m=[],g=P4(this._lastRenderIndex+1),y={layer:o[0],viewport:i,isPicking:l,renderPass:s,cullRect:c},_={},b=0;b<o.length;b++){var x=o[b],A=this._shouldDrawLayer(x,y,f,_),S={shouldDrawLayer:A};A&&!v&&(S.layerRenderIndex=g(x,A),S.moduleParameters=this._getModuleParameters(x,p,s,d),S.layerParameters=this.getLayerParameters(x,b,i)),m[b]=S}return m}},{key:"_drawLayersInViewport",value:function(i,a,o){var s=a.layers,u=a.moduleParameters,l=a.pass,f=a.target,c=a.viewport,p=a.view,d=p_e(i,{moduleParameters:u,target:f,viewport:c});if(p&&p.props.clear){var v=p.props.clear===!0?{color:!0,depth:!0}:p.props.clear;Le(i,{scissorTest:!0,scissor:d},function(){return wn(i,v)})}var m={totalCount:s.length,visibleCount:0,compositeCount:0,pickableCount:0};Ht(i,{viewport:d});for(var g=0;g<s.length;g++){var y=s[g],_=o[g],b=_.shouldDrawLayer,x=_.layerRenderIndex,A=_.moduleParameters,S=_.layerParameters;if(b&&y.props.pickable&&m.pickableCount++,y.isComposite)m.compositeCount++;else if(b){m.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,x),A.viewport=c;try{y._drawLayer({moduleParameters:A,uniforms:{layerIndex:x},parameters:S})}catch(P){y.raiseError(P,"drawing ".concat(y," to ").concat(l))}}}return m}},{key:"shouldDrawLayer",value:function(i){return!0}},{key:"getModuleParameters",value:function(i,a){return null}},{key:"getLayerParameters",value:function(i,a,o){return i.props.parameters}},{key:"_shouldDrawLayer",value:function(i,a,o,s){var u=i.props.visible&&this.shouldDrawLayer(i);if(!u)return!1;a.layer=i;for(var l=i.parent;l;){if(!l.props.visible||!l.filterSubLayer(a))return!1;a.layer=l,l=l.parent}if(o){var f=a.layer.id;if(f in s||(s[f]=o(a)),!s[f])return!1}return i.activateViewport(a.viewport),!0}},{key:"_getModuleParameters",value:function(i,a,o,s){var u,l=Object.assign(Object.create(((u=i.internalState)===null||u===void 0?void 0:u.propsInTransition)||i.props),{autoWrapLongitude:i.wrapLongitude,viewport:i.context.viewport,mousePosition:i.context.mousePosition,pickingActive:0,devicePixelRatio:_r(this.gl)});if(a){var f=HS(a),c;try{for(f.s();!(c=f.n()).done;){var p,d=c.value;Object.assign(l,(p=d.getModuleParameters)===null||p===void 0?void 0:p.call(d,i))}}catch(v){f.e(v)}finally{f.f()}}return Object.assign(l,this.getModuleParameters(i,a),s)}}]),e}(ag);function P4(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e={},n=function i(a,o){var s=a.props._offset,u=a.id,l=a.parent&&a.parent.id,f;if(l&&!(l in r)&&i(a.parent,!1),l in e){var c=e[l]=e[l]||P4(r[l],r);f=c(a,o),e[u]=c}else Number.isFinite(s)?(f=s+(r[l]||0),e[u]=null):f=t;return o&&f>=t&&(t=f+1),r[u]=f,f};return n}function p_e(t,r){var e=r.moduleParameters,n=r.target,i=r.viewport,a=n&&n.id!=="default-framebuffer",o=e&&e.devicePixelRatio||_r(t),s=a?n.height:t.drawingBufferHeight,u=i;return[u.x*o,s-(u.y+u.height)*o,u.width*o,u.height*o]}function h_e(t,r){var e=r?r.width:t.drawingBufferWidth,n=r?r.height:t.drawingBufferHeight;Ht(t,{viewport:[0,0,e,n]}),t.clear(16640)}function O4(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function E4(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?O4(Object(e),!0).forEach(function(n){(0,ni.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):O4(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function d_e(t){var r=v_e();return function(){var n=(0,sg.default)(t),i;if(r){var a=(0,sg.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,L4.default)(this,i)}}function v_e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var k4=function(t){(0,R4.default)(e,t);var r=d_e(e);function e(n,i){var a,o,s;return(0,C4.default)(this,e),s=r.call(this,n,i),(0,ni.default)((0,og.default)(s),"shadowMap",void 0),(0,ni.default)((0,og.default)(s),"depthBuffer",void 0),(0,ni.default)((0,og.default)(s),"fbo",void 0),s.shadowMap=new we(n,{width:1,height:1,parameters:(a={},(0,ni.default)(a,10241,9729),(0,ni.default)(a,10240,9729),(0,ni.default)(a,10242,33071),(0,ni.default)(a,10243,33071),a)}),s.depthBuffer=new Fr(n,{format:33189,width:1,height:1}),s.fbo=new Re(n,{id:"shadowmap",width:1,height:1,attachments:(o={},(0,ni.default)(o,36064,s.shadowMap),(0,ni.default)(o,36096,s.depthBuffer),o)}),s}return(0,M4.default)(e,[{key:"render",value:function(i){var a=this,o=this.fbo;Le(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},function(){var s=i.viewports[0],u=_r(a.gl),l=s.width*u,f=s.height*u;(l!==o.width||f!==o.height)&&o.resize({width:l,height:f}),(0,I4.default)((0,sg.default)(e.prototype),"render",a).call(a,E4(E4({},i),{},{target:o,pass:"shadow"}))})}},{key:"shouldDrawLayer",value:function(i){return i.props.shadowEnabled!==!1}},{key:"getModuleParameters",value:function(){return{drawToShadowMap:!0}}},{key:"delete",value:function(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}]),e}(Xr);var Ds=h(Zt()),sU=h(me());var B4="#define SMOOTH_EDGE_RADIUS 0.5",m_e=`
`.concat(B4,`

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`),g_e=`
`.concat(B4,`

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`),F4={name:"geometry",vs:m_e,fs:g_e};var y_e=Object.keys(ue).map(function(t){return"const int COORDINATE_SYSTEM_".concat(t," = ").concat(ue[t],";")}).join(""),__e=Object.keys(Sr).map(function(t){return"const int PROJECTION_MODE_".concat(t," = ").concat(Sr[t],";")}).join(""),b_e=Object.keys(St).map(function(t){return"const int UNIT_".concat(t.toUpperCase()," = ").concat(St[t],";")}).join(""),D4="".concat(y_e,`
`).concat(__e,`
`).concat(b_e,`

uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;

const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
  float y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

float project_size() {
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
    project_uPseudoMeters == false) {
    
    if (geometry.position.w == 0.0) {
      return project_size_at_latitude(geometry.worldPosition.y);
    }
  
    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    float y2 = y * y;
    float y4 = y2 * y2;
    float y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

float project_size_at_latitude(float meters, float lat) {
  return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
  return meters * project_uCommonUnitsPerMeter.z * project_size();
}

vec2 project_size(vec2 meters) {
  return meters * project_uCommonUnitsPerMeter.xy * project_size();
}

vec3 project_size(vec3 meters) {
  return meters * project_uCommonUnitsPerMeter * project_size();
}

vec4 project_size(vec4 meters) {
  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
  vec3 uz = normalize(up);
  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
  vec3 uy = cross(uz, ux);
  return mat3(ux, uy, uz);
}

bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    transform = project_get_orientation_matrix(commonPosition);
    return true;
  }
  return false;
}
vec3 project_normal(vec3 vector) {
  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
  vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
  mat3 rotation;
  if (project_needs_rotation(geometry.position.xyz, rotation)) {
    n = rotation * n;
  }
  return n;
}

vec4 project_offset_(vec4 offset) {
  float dy = offset.y;
  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
  float x = lnglat.x;
  if (project_uWrapLongitude) {
    x = mod(x + 180., 360.0) - 180.;
  }
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

vec3 project_globe_(vec3 lnglatz) {
  float lambda = radians(lnglatz.x);
  float phi = radians(lnglatz.y);
  float cosPhi = cos(phi);
  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;

  return vec3(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
  vec4 position_world = project_uModelMatrix * position;
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_mercator_(position_world.xy),
        project_size_at_latitude(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world.xyz += project_uCoordinateOrigin;
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
        return vec4(
          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
          project_size(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world.xyz -= project_uCoordinateOrigin;
  }
  return project_offset_(position_world + project_uModelMatrix * vec4(position64Low, 0.0));
}

vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_LOW);
}

vec3 project_position(vec3 position, vec3 position64Low) {
  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
  return projected_position.xyz;
}

vec3 project_position(vec3 position) {
  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

vec2 project_position(vec2 position) {
  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
  return offset * project_uFocalDistance;
}

float project_size_to_pixel(float meters) {
  return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
  if (unit == UNIT_METERS) return project_size_to_pixel(size);
  if (unit == UNIT_COMMON) return size * project_uScale;
  return size;
}
float project_pixel_size(float pixels) {
  return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
  return pixels / project_uScale;
}
`);var _a=typeof Float32Array<"u"?Float32Array:Array;var Dqe=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,r=arguments.length;r--;)t+=arguments[r]*arguments[r];return Math.sqrt(t)});function XS(t,r){var e=r[0],n=r[1],i=r[2],a=r[3],o=r[4],s=r[5],u=r[6],l=r[7],f=r[8],c=r[9],p=r[10],d=r[11],v=r[12],m=r[13],g=r[14],y=r[15],_=e*s-n*o,b=e*u-i*o,x=e*l-a*o,A=n*u-i*s,S=n*l-a*s,P=i*l-a*u,O=f*m-c*v,C=f*g-p*v,T=f*y-d*v,I=c*g-p*m,R=c*y-d*m,V=p*y-d*g,z=_*V-b*R+x*I+A*T-S*C+P*O;return z?(z=1/z,t[0]=(s*V-u*R+l*I)*z,t[1]=(i*R-n*V-a*I)*z,t[2]=(m*P-g*S+y*A)*z,t[3]=(p*S-c*P-d*A)*z,t[4]=(u*T-o*V-l*C)*z,t[5]=(e*V-i*T+a*C)*z,t[6]=(g*x-v*P-y*b)*z,t[7]=(f*P-p*x+d*b)*z,t[8]=(o*R-s*T+l*O)*z,t[9]=(n*T-e*R-a*O)*z,t[10]=(v*S-m*x+y*_)*z,t[11]=(c*x-f*S-d*_)*z,t[12]=(s*C-o*I-u*O)*z,t[13]=(e*I-n*C+i*O)*z,t[14]=(m*b-v*A-g*_)*z,t[15]=(f*A-c*b+p*_)*z,t):null}function Rs(t,r,e){var n=r[0],i=r[1],a=r[2],o=r[3],s=r[4],u=r[5],l=r[6],f=r[7],c=r[8],p=r[9],d=r[10],v=r[11],m=r[12],g=r[13],y=r[14],_=r[15],b=e[0],x=e[1],A=e[2],S=e[3];return t[0]=b*n+x*s+A*c+S*m,t[1]=b*i+x*u+A*p+S*g,t[2]=b*a+x*l+A*d+S*y,t[3]=b*o+x*f+A*v+S*_,b=e[4],x=e[5],A=e[6],S=e[7],t[4]=b*n+x*s+A*c+S*m,t[5]=b*i+x*u+A*p+S*g,t[6]=b*a+x*l+A*d+S*y,t[7]=b*o+x*f+A*v+S*_,b=e[8],x=e[9],A=e[10],S=e[11],t[8]=b*n+x*s+A*c+S*m,t[9]=b*i+x*u+A*p+S*g,t[10]=b*a+x*l+A*d+S*y,t[11]=b*o+x*f+A*v+S*_,b=e[12],x=e[13],A=e[14],S=e[15],t[12]=b*n+x*s+A*c+S*m,t[13]=b*i+x*u+A*p+S*g,t[14]=b*a+x*l+A*d+S*y,t[15]=b*o+x*f+A*v+S*_,t}function N4(t,r,e){var n=e[0],i=e[1],a=e[2],o,s,u,l,f,c,p,d,v,m,g,y;return r===t?(t[12]=r[0]*n+r[4]*i+r[8]*a+r[12],t[13]=r[1]*n+r[5]*i+r[9]*a+r[13],t[14]=r[2]*n+r[6]*i+r[10]*a+r[14],t[15]=r[3]*n+r[7]*i+r[11]*a+r[15]):(o=r[0],s=r[1],u=r[2],l=r[3],f=r[4],c=r[5],p=r[6],d=r[7],v=r[8],m=r[9],g=r[10],y=r[11],t[0]=o,t[1]=s,t[2]=u,t[3]=l,t[4]=f,t[5]=c,t[6]=p,t[7]=d,t[8]=v,t[9]=m,t[10]=g,t[11]=y,t[12]=o*n+f*i+v*a+r[12],t[13]=s*n+c*i+m*a+r[13],t[14]=u*n+p*i+g*a+r[14],t[15]=l*n+d*i+y*a+r[15]),t}function j4(t,r,e){var n=e[0],i=e[1],a=e[2];return t[0]=r[0]*n,t[1]=r[1]*n,t[2]=r[2]*n,t[3]=r[3]*n,t[4]=r[4]*i,t[5]=r[5]*i,t[6]=r[6]*i,t[7]=r[7]*i,t[8]=r[8]*a,t[9]=r[9]*a,t[10]=r[10]*a,t[11]=r[11]*a,t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t}function x_e(){var t=new _a(4);return _a!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function V4(t,r,e){return t[0]=r[0]*e,t[1]=r[1]*e,t[2]=r[2]*e,t[3]=r[3]*e,t}function Ls(t,r,e){var n=r[0],i=r[1],a=r[2],o=r[3];return t[0]=e[0]*n+e[4]*i+e[8]*a+e[12]*o,t[1]=e[1]*n+e[5]*i+e[9]*a+e[13]*o,t[2]=e[2]*n+e[6]*i+e[10]*a+e[14]*o,t[3]=e[3]*n+e[7]*i+e[11]*a+e[15]*o,t}var Nqe=function(){var t=x_e();return function(r,e,n,i,a,o){var s,u;for(e||(e=4),n||(n=0),i?u=Math.min(i*e+n,r.length):u=r.length,s=n;s<u;s+=e)t[0]=r[s],t[1]=r[s+1],t[2]=r[s+2],t[3]=r[s+3],a(t,t,o),r[s]=t[0],r[s+1]=t[1],r[s+2]=t[2],r[s+3]=t[3];return r}}();function A_e(t,r){if(t===r)return!0;if(Array.isArray(t)){var e=t.length;if(!r||r.length!==e)return!1;for(var n=0;n<e;n++)if(t[n]!==r[n])return!1;return!0}return!1}function qr(t){var r={},e;return function(n){for(var i in n)if(!A_e(n[i],r[i])){e=t(n),r=n;break}return e}}var H4=[0,0,0,0],S_e=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],W4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],T_e=[0,0,0],$4=[0,0,0],w_e=qr(O_e);function YS(t,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:$4;e.length<3&&(e=[e[0],e[1],0]);var n=e,i,a=!0;switch(r===ue.LNGLAT_OFFSETS||r===ue.METER_OFFSETS?i=e:i=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case Sr.WEB_MERCATOR:(r===ue.LNGLAT||r===ue.CARTESIAN)&&(i=[0,0,0],a=!1);break;case Sr.WEB_MERCATOR_AUTO_OFFSET:r===ue.LNGLAT?n=i:r===ue.CARTESIAN&&(n=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],i=t.unprojectPosition(n),n[0]-=e[0],n[1]-=e[1],n[2]-=e[2]);break;case Sr.IDENTITY:n=t.position.map(Math.fround),n[2]=n[2]||0;break;case Sr.GLOBE:a=!1,i=null;break;default:a=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:n,offsetMode:a}}function P_e(t,r,e){var n=t.viewMatrixUncentered,i=t.projectionMatrix,a=t.viewMatrix,o=t.viewProjectionMatrix,s=H4,u=H4,l=t.cameraPosition,f=YS(t,r,e),c=f.geospatialOrigin,p=f.shaderCoordinateOrigin,d=f.offsetMode;return d&&(u=t.projectPosition(c||p),l=[l[0]-u[0],l[1]-u[1],l[2]-u[2]],u[3]=1,s=Ls([],u,o),a=n||a,o=Rs([],i,a),o=Rs([],o,S_e)),{viewMatrix:a,viewProjectionMatrix:o,projectionCenter:s,originCommon:u,cameraPosCommon:l,shaderCoordinateOrigin:p,geospatialOrigin:c}}function ug(t){var r=t.viewport,e=t.devicePixelRatio,n=e===void 0?1:e,i=t.modelMatrix,a=i===void 0?null:i,o=t.coordinateSystem,s=o===void 0?ue.DEFAULT:o,u=t.coordinateOrigin,l=u===void 0?$4:u,f=t.autoWrapLongitude,c=f===void 0?!1:f;s===ue.DEFAULT&&(s=r.isGeospatial?ue.LNGLAT:ue.CARTESIAN);var p=w_e({viewport:r,devicePixelRatio:n,coordinateSystem:s,coordinateOrigin:l});return p.project_uWrapLongitude=c,p.project_uModelMatrix=a||W4,p}function O_e(t){var r=t.viewport,e=t.devicePixelRatio,n=t.coordinateSystem,i=t.coordinateOrigin,a=P_e(r,n,i),o=a.projectionCenter,s=a.viewProjectionMatrix,u=a.originCommon,l=a.cameraPosCommon,f=a.shaderCoordinateOrigin,c=a.geospatialOrigin,p=r.getDistanceScales(),d=[r.width*e,r.height*e],v=Ls([],[0,0,-r.focalDistance,1],r.projectionMatrix)[3]||1,m={project_uCoordinateSystem:n,project_uProjectionMode:r.projectionMode,project_uCoordinateOrigin:f,project_uCommonOrigin:u.slice(0,3),project_uCenter:o,project_uPseudoMeters:Boolean(r._pseudoMeters),project_uViewportSize:d,project_uDevicePixelRatio:e,project_uFocalDistance:v,project_uCommonUnitsPerMeter:p.unitsPerMeter,project_uCommonUnitsPerWorldUnit:p.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:T_e,project_uScale:r.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:s,project_uModelMatrix:W4,project_uCameraPosition:l};if(c){var g=r.getDistanceScales(c);switch(n){case ue.METER_OFFSETS:m.project_uCommonUnitsPerWorldUnit=g.unitsPerMeter,m.project_uCommonUnitsPerWorldUnit2=g.unitsPerMeter2;break;case ue.LNGLAT:case ue.LNGLAT_OFFSETS:r._pseudoMeters||(m.project_uCommonUnitsPerMeter=g.unitsPerMeter),m.project_uCommonUnitsPerWorldUnit=g.unitsPerDegree,m.project_uCommonUnitsPerWorldUnit2=g.unitsPerDegree2;break;case ue.CARTESIAN:m.project_uCommonUnitsPerWorldUnit=[1,1,g.unitsPerMeter[2]],m.project_uCommonUnitsPerWorldUnit2=[0,0,g.unitsPerMeter2[2]];break;default:break}}return m}var E_e={};function C_e(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:E_e;return"viewport"in t?ug(t):{}}var Qt={name:"project",dependencies:[bm,F4],vs:D4,getUniforms:C_e};function Al(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function KS(t){if(Array.isArray(t))return Al(t)}function ZS(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function Ip(t,r){if(t){if(typeof t=="string")return Al(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Al(t,r)}}function JS(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Sl(t){return KS(t)||ZS(t)||Ip(t)||JS()}function QS(t){if(Array.isArray(t))return t}function eT(t,r){var e=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(e!=null){var n=[],i=!0,a=!1,o,s;try{for(e=e.call(t);!(i=(o=e.next()).done)&&(n.push(o.value),!(r&&n.length===r));i=!0);}catch(u){a=!0,s=u}finally{try{!i&&e.return!=null&&e.return()}finally{if(a)throw s}}return n}}function tT(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function mr(t,r){return QS(t)||eT(t,r)||Ip(t,r)||tT()}function rT(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function X4(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function nT(t,r,e){return r&&X4(t.prototype,r),e&&X4(t,e),t}function vt(t,r,e){return r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e,t}function Tl(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function xo(t,r){var e=Gm([],r,t);return Um(e,e,1/e[3]),e}function iT(t,r){var e=t%r;return e<0?r+e:e}function q4(t,r,e){return e*r+(1-e)*t}function Rp(t,r,e){return t<r?r:t>e?e:t}function M_e(t){return Math.log(t)*Math.LOG2E}var wl=Math.log2||M_e;function En(t,r){if(!t)throw new Error(r||"@math.gl/web-mercator: assertion failed.")}var ii=Math.PI,Y4=ii/4,Cn=ii/180,aT=180/ii,Pl=512,lg=4003e4,Ol=85.051129,oT=1.5;function El(t){return Math.pow(2,t)}function fg(t){return wl(t)}function wt(t){var r=mr(t,2),e=r[0],n=r[1];En(Number.isFinite(e)),En(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");var i=e*Cn,a=n*Cn,o=Pl*(i+ii)/(2*ii),s=Pl*(ii+Math.log(Math.tan(Y4+a*.5)))/(2*ii);return[o,s]}function er(t){var r=mr(t,2),e=r[0],n=r[1],i=e/Pl*(2*ii)-ii,a=2*(Math.atan(Math.exp(n/Pl*(2*ii)-ii))-Y4);return[i*aT,a*aT]}function Lp(t){var r=t.latitude;En(Number.isFinite(r));var e=Math.cos(r*Cn);return fg(lg*e)-9}function ks(t){var r=Math.cos(t*Cn);return Pl/lg/r}function Bs(t){var r=t.latitude,e=t.longitude,n=t.highPrecision,i=n===void 0?!1:n;En(Number.isFinite(r)&&Number.isFinite(e));var a=Pl,o=Math.cos(r*Cn),s=a/360,u=s/o,l=a/lg/o,f={unitsPerMeter:[l,l,l],metersPerUnit:[1/l,1/l,1/l],unitsPerDegree:[s,u,l],degreesPerUnit:[1/s,1/u,1/l]};if(i){var c=Cn*Math.tan(r*Cn)/o,p=s*c/2,d=a/lg*c,v=d/u*l;f.unitsPerDegree2=[0,p,d],f.unitsPerMeter2=[v,0,v]}return f}function kp(t,r){var e=mr(t,3),n=e[0],i=e[1],a=e[2],o=mr(r,3),s=o[0],u=o[1],l=o[2],f=Bs({longitude:n,latitude:i,highPrecision:!0}),c=f.unitsPerMeter,p=f.unitsPerMeter2,d=wt(t);d[0]+=s*(c[0]+p[0]*u),d[1]+=u*(c[1]+p[1]*u);var v=er(d),m=(a||0)+(l||0);return Number.isFinite(a)||Number.isFinite(l)?[v[0],v[1],m]:v}function Bp(t){var r=t.height,e=t.pitch,n=t.bearing,i=t.altitude,a=t.scale,o=t.center,s=Tl();Cs(s,s,[0,0,-i]),Fm(s,s,-e*Cn),Dm(s,s,n*Cn);var u=a/r;return yl(s,s,[u,u,u]),o&&Cs(s,s,VD([],o)),s}function cg(t){var r=t.width,e=t.height,n=t.altitude,i=t.pitch,a=i===void 0?0:i,o=t.offset,s=t.center,u=t.scale,l=t.nearZMultiplier,f=l===void 0?1:l,c=t.farZMultiplier,p=c===void 0?1:c,d=t.fovy,v=d===void 0?ba(oT):d;n!==void 0&&(v=ba(n));var m=v*Cn,g=a*Cn,y=Ao(v),_=y;s&&(_+=s[2]*u/Math.cos(g)/e);var b=m*(.5+(o?o[1]:0)/e),x=Math.sin(b)*_/Math.sin(Rp(Math.PI/2-g-b,.01,Math.PI-.01)),A=Math.sin(g)*x+_,S=_*10,P=Math.min(A*p,S);return{fov:m,aspect:r/e,focalDistance:y,near:f,far:P}}function sT(t){var r=cg(t),e=r.fov,n=r.aspect,i=r.near,a=r.far,o=Nm([],e,n,i,a);return o}function ba(t){return 2*Math.atan(.5/t)*aT}function Ao(t){return .5/Math.tan(.5*t*Cn)}function Fs(t,r){var e=mr(t,3),n=e[0],i=e[1],a=e[2],o=a===void 0?0:a;return En(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(o)),xo(r,[n,i,o,1])}function Yr(t,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=mr(t,3),i=n[0],a=n[1],o=n[2];if(En(Number.isFinite(i)&&Number.isFinite(a),"invalid pixel coordinate"),Number.isFinite(o)){var s=xo(r,[i,a,o,1]);return s}var u=xo(r,[i,a,0,1]),l=xo(r,[i,a,1,1]),f=u[2],c=l[2],p=f===c?0:((e||0)-f)/(c-f);return Am([],u,l,p)}function Cl(t){var r=t.width,e=t.height,n=t.bounds,i=t.minExtent,a=i===void 0?0:i,o=t.maxZoom,s=o===void 0?24:o,u=t.offset,l=u===void 0?[0,0]:u,f=mr(n,2),c=mr(f[0],2),p=c[0],d=c[1],v=mr(f[1],2),m=v[0],g=v[1],y=I_e(t.padding),_=wt([p,Rp(g,-Ol,Ol)]),b=wt([m,Rp(d,-Ol,Ol)]),x=[Math.max(Math.abs(b[0]-_[0]),a),Math.max(Math.abs(b[1]-_[1]),a)],A=[r-y.left-y.right-Math.abs(l[0])*2,e-y.top-y.bottom-Math.abs(l[1])*2];En(A[0]>0&&A[1]>0);var S=A[0]/x[0],P=A[1]/x[1],O=(y.right-y.left)/2/S,C=(y.bottom-y.top)/2/P,T=[(b[0]+_[0])/2+O,(b[1]+_[1])/2+C],I=er(T),R=Math.min(s,wl(Math.abs(Math.min(S,P))));return En(Number.isFinite(R)),{longitude:I[0],latitude:I[1],zoom:R}}function I_e(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(En(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}var K4=Math.PI/180;function Ml(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=t.width,n=t.height,i=t.unproject,a={targetZ:r},o=i([0,n],a),s=i([e,n],a),u,l,f=t.fovy?.5*t.fovy*K4:Math.atan(.5/t.altitude),c=(90-t.pitch)*K4;return f>c-.01?(u=Z4(t,0,r),l=Z4(t,e,r)):(u=i([0,0],a),l=i([e,0],a)),[o,s,l,u]}function Z4(t,r,e){var n=t.pixelUnprojectionMatrix,i=xo(n,[r,0,1,1]),a=xo(n,[r,t.height,1,1]),o=e*t.distanceScales.unitsPerMeter[2],s=(o-i[2])/(a[2]-i[2]),u=Am([],i,a,s),l=er(u);return l.push(e),l}var J4=function(){function t(){var r=this,e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{width:1,height:1};rT(this,t),vt(this,"latitude",void 0),vt(this,"longitude",void 0),vt(this,"zoom",void 0),vt(this,"pitch",void 0),vt(this,"bearing",void 0),vt(this,"altitude",void 0),vt(this,"fovy",void 0),vt(this,"meterOffset",void 0),vt(this,"center",void 0),vt(this,"width",void 0),vt(this,"height",void 0),vt(this,"scale",void 0),vt(this,"distanceScales",void 0),vt(this,"viewMatrix",void 0),vt(this,"projectionMatrix",void 0),vt(this,"viewProjectionMatrix",void 0),vt(this,"pixelProjectionMatrix",void 0),vt(this,"pixelUnprojectionMatrix",void 0),vt(this,"equals",function(R){return R instanceof t?R.width===r.width&&R.height===r.height&&yS(R.projectionMatrix,r.projectionMatrix)&&yS(R.viewMatrix,r.viewMatrix):!1}),vt(this,"project",function(R){var V=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},z=V.topLeft,k=z===void 0?!0:z,G=r.projectPosition(R),U=Fs(G,r.pixelProjectionMatrix),$=mr(U,2),H=$[0],Q=$[1],ie=k?Q:r.height-Q;return R.length===2?[H,ie]:[H,ie,U[2]]}),vt(this,"unproject",function(R){var V=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},z=V.topLeft,k=z===void 0?!0:z,G=V.targetZ,U=G===void 0?void 0:G,$=mr(R,3),H=$[0],Q=$[1],ie=$[2],fe=k?Q:r.height-Q,Ae=U&&U*r.distanceScales.unitsPerMeter[2],Oe=Yr([H,fe,ie],r.pixelUnprojectionMatrix,Ae),Xe=r.unprojectPosition(Oe),ge=mr(Xe,3),qe=ge[0],Ie=ge[1],Et=ge[2];return Number.isFinite(ie)?[qe,Ie,Et]:Number.isFinite(U)?[qe,Ie,U]:[qe,Ie]}),vt(this,"projectPosition",function(R){var V=wt(R),z=mr(V,2),k=z[0],G=z[1],U=(R[2]||0)*r.distanceScales.unitsPerMeter[2];return[k,G,U]}),vt(this,"unprojectPosition",function(R){var V=er(R),z=mr(V,2),k=z[0],G=z[1],U=(R[2]||0)*r.distanceScales.metersPerUnit[2];return[k,G,U]});var n=e.width,i=e.height,a=e.altitude,o=a===void 0?null:a,s=e.fovy,u=s===void 0?null:s,l=e.latitude,f=l===void 0?0:l,c=e.longitude,p=c===void 0?0:c,d=e.zoom,v=d===void 0?0:d,m=e.pitch,g=m===void 0?0:m,y=e.bearing,_=y===void 0?0:y,b=e.position,x=b===void 0?null:b,A=e.nearZMultiplier,S=A===void 0?.02:A,P=e.farZMultiplier,O=P===void 0?1.01:P;n=n||1,i=i||1,u===null&&o===null?(o=oT,u=ba(o)):u===null?u=ba(o):o===null&&(o=Ao(u));var C=El(v);o=Math.max(.75,o);var T=Bs({longitude:p,latitude:f}),I=wt([p,f]);I.push(0),x&&zD(I,I,YD([],x,T.unitsPerMeter)),this.projectionMatrix=sT({width:n,height:i,scale:C,center:I,pitch:g,fovy:u,nearZMultiplier:S,farZMultiplier:O}),this.viewMatrix=Bp({height:i,scale:C,center:I,pitch:g,bearing:_,altitude:o}),this.width=n,this.height=i,this.scale=C,this.latitude=f,this.longitude=p,this.zoom=v,this.pitch=g,this.bearing=_,this.altitude=o,this.fovy=u,this.center=I,this.meterOffset=x||[0,0,0],this.distanceScales=T,this._initMatrices(),Object.freeze(this)}return nT(t,[{key:"_initMatrices",value:function(){var e=this.width,n=this.height,i=this.projectionMatrix,a=this.viewMatrix,o=Tl();Es(o,o,i),Es(o,o,a),this.viewProjectionMatrix=o;var s=Tl();yl(s,s,[e/2,-n/2,1]),Cs(s,s,[1,-1,0]),Es(s,s,o);var u=Bm(Tl(),s);if(!u)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=s,this.pixelUnprojectionMatrix=u}},{key:"projectFlat",value:function(e){return wt(e)}},{key:"unprojectFlat",value:function(e){return er(e)}},{key:"getMapCenterByLngLatPosition",value:function(e){var n=e.lngLat,i=e.pos,a=Yr(i,this.pixelUnprojectionMatrix),o=wt(n),s=Ap([],o,FD([],a)),u=Ap([],this.center,s);return er(u)}},{key:"fitBounds",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=this.width,a=this.height,o=Cl(Object.assign({width:i,height:a,bounds:e},n)),s=o.longitude,u=o.latitude,l=o.zoom;return new t({width:i,height:a,longitude:s,latitude:u,zoom:l})}},{key:"getBounds",value:function(e){var n=this.getBoundingRegion(e),i=Math.min.apply(Math,Sl(n.map(function(u){return u[0]}))),a=Math.max.apply(Math,Sl(n.map(function(u){return u[0]}))),o=Math.min.apply(Math,Sl(n.map(function(u){return u[1]}))),s=Math.max.apply(Math,Sl(n.map(function(u){return u[1]})));return[[i,o],[a,s]]}},{key:"getBoundingRegion",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Ml(this,e.z||0)}},{key:"getLocationAtPoint",value:function(e){var n=e.lngLat,i=e.pos;return this.getMapCenterByLngLatPosition({lngLat:n,pos:i})}}]),t}();var Q4=512;function pg(t){var r=t.width,e=t.height,n=t.pitch,i=n===void 0?0:n,a=t.longitude,o=t.latitude,s=t.zoom,u=t.bearing,l=u===void 0?0:u;(a<-180||a>180)&&(a=iT(a+180,360)-180),(l<-180||l>180)&&(l=iT(l+180,360)-180);var f=wl(e/Q4);if(s<=f)s=f,o=0;else{var c=e/2/Math.pow(2,s),p=er([0,c])[1];if(o<p)o=p;else{var d=er([0,Q4-c])[1];o>d&&(o=d)}}return{width:r,height:e,longitude:a,latitude:o,zoom:s,pitch:i,bearing:l}}function eU(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function tU(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?eU(Object(e),!0).forEach(function(n){vt(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):eU(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function R_e(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=L_e(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function L_e(t,r){if(t){if(typeof t=="string")return rU(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return rU(t,r)}}function rU(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var nU=.01,k_e=["longitude","latitude","zoom"],iU={curve:1.414,speed:1.2};function hg(t,r,e,n){var i=aU(t,r,n),a=i.startZoom,o=i.startCenterXY,s=i.uDelta,u=i.w0,l=i.u1,f=i.S,c=i.rho,p=i.rho2,d=i.r0;if(l<nU){var v={},m=R_e(k_e),g;try{for(m.s();!(g=m.n()).done;){var y=g.value,_=t[y],b=r[y];v[y]=q4(_,b,e)}}catch(I){m.e(I)}finally{m.f()}return v}var x=e*f,A=Math.cosh(d)/Math.cosh(d+c*x),S=u*((Math.cosh(d)*Math.tanh(d+c*x)-Math.sinh(d))/p)/l,P=1/A,O=a+fg(P),C=kD([],s,S);Ap(C,C,o);var T=er(C);return{longitude:T[0],latitude:T[1],zoom:O}}function uT(t,r,e){var n=tU(tU({},iU),e),i=n.screenSpeed,a=n.speed,o=n.maxDuration,s=aU(t,r,n),u=s.S,l=s.rho,f=1e3*u,c;return Number.isFinite(i)?c=f/(i/l):c=f/a,Number.isFinite(o)&&c>o?0:c}function aU(t,r,e){e=Object.assign({},iU,e);var n=e.curve,i=t.zoom,a=[t.longitude,t.latitude],o=El(i),s=r.zoom,u=[r.longitude,r.latitude],l=El(s-i),f=wt(a),c=wt(u),p=jD([],c,f),d=Math.max(t.width,t.height),v=d/l,m=BD(p)*o,g=Math.max(m,nU),y=n*n,_=(v*v-d*d+y*y*g*g)/(2*d*y*g),b=(v*v-d*d-y*y*g*g)/(2*v*y*g),x=Math.log(Math.sqrt(_*_+1)-_),A=Math.log(Math.sqrt(b*b+1)-b),S=(A-x)/n;return{startZoom:i,startCenterXY:f,uDelta:p,w0:d,u1:m,S,rho:n,rho2:y,r0:x,r1:A}}function B_e(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=F_e(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function F_e(t,r){if(t){if(typeof t=="string")return oU(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return oU(t,r)}}function oU(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var D_e=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,N_e=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture2D(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,j_e=qr(H_e),U_e=qr(W_e),G_e=[0,0,0,1],z_e=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function V_e(t,r){var e=(0,sU.default)(t,3),n=e[0],i=e[1],a=e[2],o=Yr([n,i,a],r);return Number.isFinite(a)?o:[o[0],o[1],0]}function H_e(t){var r=t.viewport,e=t.center;return new pe(r.viewProjectionMatrix).invert().transform(e)}function W_e(t){var r=t.viewport,e=t.shadowMatrices,n=[],i=r.pixelUnprojectionMatrix,a=r.isGeospatial?void 0:1,o=[[0,0,a],[r.width,0,a],[0,r.height,a],[r.width,r.height,a],[0,0,-1],[r.width,0,-1],[0,r.height,-1],[r.width,r.height,-1]].map(function(f){return V_e(f,i)}),s=B_e(e),u;try{var l=function(){var c=u.value,p=c.clone().translate(new j(r.center).negate()),d=o.map(function(m){return p.transform(m)}),v=new pe().ortho({left:Math.min.apply(Math,(0,Ds.default)(d.map(function(m){return m[0]}))),right:Math.max.apply(Math,(0,Ds.default)(d.map(function(m){return m[0]}))),bottom:Math.min.apply(Math,(0,Ds.default)(d.map(function(m){return m[1]}))),top:Math.max.apply(Math,(0,Ds.default)(d.map(function(m){return m[1]}))),near:Math.min.apply(Math,(0,Ds.default)(d.map(function(m){return-m[2]}))),far:Math.max.apply(Math,(0,Ds.default)(d.map(function(m){return-m[2]})))});n.push(v.multiplyRight(c))};for(s.s();!(u=s.n()).done;)l()}catch(f){s.e(f)}finally{s.f()}return n}function $_e(t,r){var e=t.shadowEnabled,n=e===void 0?!0:e;if(!n||!t.shadowMatrices||!t.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1};for(var i={shadow_uDrawShadowMap:Boolean(t.drawToShadowMap),shadow_uUseShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,shadow_uColor:t.shadowColor||G_e,shadow_uLightId:t.shadowLightId||0,shadow_uLightCount:t.shadowMatrices.length},a=j_e({viewport:t.viewport,center:r.project_uCenter}),o=[],s=U_e({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice(),u=0;u<t.shadowMatrices.length;u++){var l=s[u],f=l.clone().translate(new j(t.viewport.center).negate());r.project_uCoordinateSystem===ue.LNGLAT&&r.project_uProjectionMode===Sr.WEB_MERCATOR?(s[u]=f,o[u]=a):(s[u]=l.clone().multiplyRight(z_e),o[u]=f.transform(a))}for(var c=0;c<s.length;c++)i["shadow_uViewProjectionMatrices[".concat(c,"]")]=s[c],i["shadow_uProjectCenters[".concat(c,"]")]=o[c],t.shadowMaps&&t.shadowMaps.length>0?i["shadow_uShadowMap".concat(c)]=t.shadowMaps[c]:i["shadow_uShadowMap".concat(c)]=t.dummyShadowMap;return i}var Ns={name:"shadow",dependencies:[Qt],vs:D_e,fs:N_e,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return"viewport"in r&&(r.drawToShadowMap||r.shadowMaps&&r.shadowMaps.length>0)?$_e(r,e):{}}};function uU(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=X_e(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function X_e(t,r){if(t){if(typeof t=="string")return lU(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return lU(t,r)}}function lU(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var q_e={color:[255,255,255],intensity:1},fU=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],Y_e=[0,0,0,200/255],Fp=function(){function t(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,cU.default)(this,t),(0,hn.default)(this,"id","lighting-effect"),(0,hn.default)(this,"props",void 0),(0,hn.default)(this,"shadowColor",Y_e),(0,hn.default)(this,"shadow",void 0),(0,hn.default)(this,"ambientLight",void 0),(0,hn.default)(this,"directionalLights",void 0),(0,hn.default)(this,"pointLights",void 0),(0,hn.default)(this,"shadowPasses",[]),(0,hn.default)(this,"shadowMaps",[]),(0,hn.default)(this,"dummyShadowMap",null),(0,hn.default)(this,"programManager",void 0),(0,hn.default)(this,"shadowMatrices",void 0),this.setProps(r)}return(0,pU.default)(t,[{key:"setProps",value:function(e){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(var n in e){var i=e[n];switch(i.type){case"ambient":this.ambientLight=i;break;case"directional":this.directionalLights.push(i);break;case"point":this.pointLights.push(i);break;default:}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(function(a){return a.shadow}),this.props=e}},{key:"preRender",value:function(e,n){var i=n.layers,a=n.layerFilter,o=n.viewports,s=n.onViewportActive,u=n.views;if(this.shadow){this.shadowMatrices=this._calculateMatrices(),this.shadowPasses.length===0&&this._createShadowPasses(e),this.programManager||(this.programManager=Pn.getDefaultProgramManager(e),Ns&&this.programManager.addDefaultModule(Ns)),this.dummyShadowMap||(this.dummyShadowMap=new we(e,{width:1,height:1}));for(var l=0;l<this.shadowPasses.length;l++){var f=this.shadowPasses[l];f.render({layers:i,layerFilter:a,viewports:o,onViewportActive:s,views:u,moduleParameters:{shadowLightId:l,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}}},{key:"getModuleParameters",value:function(e){var n=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return n.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(function(i){return i.getProjectedLight({layer:e})}),pointLights:this.pointLights.map(function(i){return i.getProjectedLight({layer:e})})},n}},{key:"cleanup",value:function(){var e=uU(this.shadowPasses),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;i.delete()}}catch(a){e.e(a)}finally{e.f()}this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(Ns),this.programManager=null)}},{key:"_calculateMatrices",value:function(){var e=[],n=uU(this.directionalLights),i;try{for(n.s();!(i=n.n()).done;){var a=i.value,o=new pe().lookAt({eye:new j(a.direction).negate()});e.push(o)}}catch(s){n.e(s)}finally{n.f()}return e}},{key:"_createShadowPasses",value:function(e){for(var n=0;n<this.directionalLights.length;n++){var i=new k4(e);this.shadowPasses[n]=i,this.shadowMaps[n]=i.shadowMap}}},{key:"_applyDefaultLights",value:function(){var e=this.ambientLight,n=this.pointLights,i=this.directionalLights;!e&&n.length===0&&i.length===0&&(this.ambientLight=new ig(q_e),this.directionalLights.push(new Is(fU[0]),new Is(fU[1])))}}]),t}();var kU=h(L()),BU=h(N()),xa=h(B());var _g=h(me());var mg=h(me()),wU=h(L()),PU=h(N()),si=h(be()),fT=h(Ee()),OU=h(Y()),EU=h(K()),Np=h(q()),Mn=h(B());var Ll=h(me()),xU=h(L()),AU=h(N()),xt=h(B());var hU=h(L()),dU=h(N()),lT=h(B()),K_e=function(){function t(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,hU.default)(this,t),(0,lT.default)(this,"_pool",[]),(0,lT.default)(this,"opts",{overAlloc:2,poolSize:100}),this.setOptions(r)}return(0,dU.default)(t,[{key:"setOptions",value:function(e){Object.assign(this.opts,e)}},{key:"allocate",value:function(e,n,i){var a=i.size,o=a===void 0?1:a,s=i.type,u=i.padding,l=u===void 0?0:u,f=i.copy,c=f===void 0?!1:f,p=i.initialize,d=p===void 0?!1:p,v=i.maxCount,m=s||e&&e.constructor||Float32Array,g=n*o+l;if(ArrayBuffer.isView(e)){if(g<=e.length)return e;if(g*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new m(e.buffer,0,g)}var y=1/0;v&&(y=v*o+l);var _=this._allocate(m,g,d,y);return e&&c?_.set(e):d||_.fill(0,0,4),this._release(e),_}},{key:"release",value:function(e){this._release(e)}},{key:"_allocate",value:function(e,n,i,a){var o=Math.max(Math.ceil(n*this.opts.overAlloc),1);o>a&&(o=a);var s=this._pool,u=e.BYTES_PER_ELEMENT*o,l=s.findIndex(function(c){return c.byteLength>=u});if(l>=0){var f=new e(s.splice(l,1)[0],0,o);return i&&f.fill(0),f}return new e(o)}},{key:"_release",value:function(e){if(ArrayBuffer.isView(e)){var n=this._pool,i=e.buffer,a=i.byteLength,o=n.findIndex(function(s){return s.byteLength>=a});o<0?n.push(i):(o>0||n.length<this.opts.poolSize)&&n.splice(o,0,i),n.length>this.opts.poolSize&&n.shift()}}}]),t}(),ai=new K_e;function Z_e(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=J_e(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function J_e(t,r){if(t){if(typeof t=="string")return vU(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return vU(t,r)}}function vU(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function Rl(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function js(t,r){var e=t%r;return e<0?r+e:e}function gU(t){return[t[12],t[13],t[14]]}function yU(t){return{left:Il(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:Il(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:Il(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:Il(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:Il(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:Il(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}var mU=new j;function Il(t,r,e,n){mU.set(t,r,e);var i=mU.len();return{distance:n/i,normal:new j(-t/i,-r/i,-e/i)}}function oi(t){return t-Math.fround(t)}var Dp;function dg(t,r){var e=r.size,n=e===void 0?1:e,i=r.startIndex,a=i===void 0?0:i,o=r.endIndex!==void 0?r.endIndex:t.length,s=(o-a)/n;Dp=ai.allocate(Dp,s,{type:Float32Array,size:n*2});for(var u=a,l=0;u<o;){for(var f=0;f<n;f++){var c=t[u++];Dp[l+f]=c,Dp[l+f+n]=oi(c)}l+=n*2}return Dp.subarray(0,s*n*2)}function _U(t){var r=null,e=!1,n=Z_e(t),i;try{for(n.s();!(i=n.n()).done;){var a=i.value;a&&(r?(e||(r=[[r[0][0],r[0][1]],[r[1][0],r[1][1]]],e=!0),r[0][0]=Math.min(r[0][0],a[0][0]),r[0][1]=Math.min(r[0][1],a[0][1]),r[1][0]=Math.max(r[1][0],a[1][0]),r[1][1]=Math.max(r[1][1],a[1][1])):r=a)}}catch(o){n.e(o)}finally{n.f()}return r}var Q_e=Math.PI/180,ebe=Rl(),bU=[0,0,0],tbe={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function rbe(t){var r=t.width,e=t.height,n=t.orthographic,i=t.fovyRadians,a=t.focalDistance,o=t.padding,s=t.near,u=t.far,l=r/e,f=n?new pe().orthographic({fovy:i,aspect:l,focalDistance:a,near:s,far:u}):new pe().perspective({fovy:i,aspect:l,near:s,far:u});if(o){var c=o.left,p=c===void 0?0:c,d=o.right,v=d===void 0?0:d,m=o.top,g=m===void 0?0:m,y=o.bottom,_=y===void 0?0:y,b=We((p+r-v)/2,0,r)-r/2,x=We((g+e-_)/2,0,e)-e/2;f[8]-=b*2/r,f[9]+=x*2/e}return f}var Ar=function(){function t(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,xU.default)(this,t),(0,xt.default)(this,"id",void 0),(0,xt.default)(this,"x",void 0),(0,xt.default)(this,"y",void 0),(0,xt.default)(this,"width",void 0),(0,xt.default)(this,"height",void 0),(0,xt.default)(this,"padding",void 0),(0,xt.default)(this,"isGeospatial",void 0),(0,xt.default)(this,"zoom",void 0),(0,xt.default)(this,"focalDistance",void 0),(0,xt.default)(this,"position",void 0),(0,xt.default)(this,"modelMatrix",void 0),(0,xt.default)(this,"distanceScales",void 0),(0,xt.default)(this,"scale",void 0),(0,xt.default)(this,"center",void 0),(0,xt.default)(this,"cameraPosition",void 0),(0,xt.default)(this,"projectionMatrix",void 0),(0,xt.default)(this,"viewMatrix",void 0),(0,xt.default)(this,"viewMatrixUncentered",void 0),(0,xt.default)(this,"viewMatrixInverse",void 0),(0,xt.default)(this,"viewProjectionMatrix",void 0),(0,xt.default)(this,"pixelProjectionMatrix",void 0),(0,xt.default)(this,"pixelUnprojectionMatrix",void 0),(0,xt.default)(this,"resolution",void 0),(0,xt.default)(this,"_frustumPlanes",{}),this.id=r.id||this.constructor.displayName||"viewport",this.x=r.x||0,this.y=r.y||0,this.width=r.width||1,this.height=r.height||1,this.zoom=r.zoom||0,this.padding=r.padding,this.distanceScales=r.distanceScales||tbe,this.focalDistance=r.focalDistance||1,this.position=r.position||bU,this.modelMatrix=r.modelMatrix||null;var e=r.longitude,n=r.latitude;this.isGeospatial=Number.isFinite(n)&&Number.isFinite(e),this._initProps(r),this._initMatrices(r),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,AU.default)(t,[{key:"subViewports",get:function(){return null}},{key:"metersPerPixel",get:function(){return this.distanceScales.metersPerUnit[2]/this.scale}},{key:"projectionMode",get:function(){return this.isGeospatial?this.zoom<12?Sr.WEB_MERCATOR:Sr.WEB_MERCATOR_AUTO_OFFSET:Sr.IDENTITY}},{key:"equals",value:function(e){return e instanceof t?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&tt(e.projectionMatrix,this.projectionMatrix)&&tt(e.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=n.topLeft,a=i===void 0?!0:i,o=this.projectPosition(e),s=Fs(o,this.pixelProjectionMatrix),u=(0,Ll.default)(s,2),l=u[0],f=u[1],c=a?f:this.height-f;return e.length===2?[l,c]:[l,c,s[2]]}},{key:"unproject",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=n.topLeft,a=i===void 0?!0:i,o=n.targetZ,s=(0,Ll.default)(e,3),u=s[0],l=s[1],f=s[2],c=a?l:this.height-l,p=o&&o*this.distanceScales.unitsPerMeter[2],d=Yr([u,c,f],this.pixelUnprojectionMatrix,p),v=this.unprojectPosition(d),m=(0,Ll.default)(v,3),g=m[0],y=m[1],_=m[2];return Number.isFinite(f)?[g,y,_]:Number.isFinite(o)?[g,y,o]:[g,y]}},{key:"projectPosition",value:function(e){var n=this.projectFlat(e),i=(0,Ll.default)(n,2),a=i[0],o=i[1],s=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[a,o,s]}},{key:"unprojectPosition",value:function(e){var n=this.unprojectFlat(e),i=(0,Ll.default)(n,2),a=i[0],o=i[1],s=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[a,o,s]}},{key:"projectFlat",value:function(e){if(this.isGeospatial){var n=wt(e);return n[1]=We(n[1],-318,830),n}return e}},{key:"unprojectFlat",value:function(e){return this.isGeospatial?er(e):e}},{key:"getBounds",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n={targetZ:e.z||0},i=this.unproject([0,0],n),a=this.unproject([this.width,0],n),o=this.unproject([0,this.height],n),s=this.unproject([this.width,this.height],n);return[Math.min(i[0],a[0],o[0],s[0]),Math.min(i[1],a[1],o[1],s[1]),Math.max(i[0],a[0],o[0],s[0]),Math.max(i[1],a[1],o[1],s[1])]}},{key:"getDistanceScales",value:function(e){return e?Bs({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}},{key:"containsPixel",value:function(e){var n=e.x,i=e.y,a=e.width,o=a===void 0?1:a,s=e.height,u=s===void 0?1:s;return n<this.x+this.width&&this.x<n+o&&i<this.y+this.height&&this.y<i+u}},{key:"getFrustumPlanes",value:function(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,yU(this.viewProjectionMatrix)),this._frustumPlanes)}},{key:"panByPosition",value:function(e,n){return null}},{key:"_initProps",value:function(e){var n=e.longitude,i=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=Lp({latitude:i})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||Bs({latitude:i,longitude:n}));var a=Math.pow(2,this.zoom);this.scale=a;var o=e.position,s=e.modelMatrix,u=bU;if(o&&(u=s?new pe(s).transformAsVector(o,[]):o),this.isGeospatial){var l=this.projectPosition([n,i,0]);this.center=new j(u).scale(this.distanceScales.unitsPerMeter).add(l)}else this.center=this.projectPosition(u)}},{key:"_initMatrices",value:function(e){var n=e.viewMatrix,i=n===void 0?ebe:n,a=e.projectionMatrix,o=a===void 0?null:a,s=e.orthographic,u=s===void 0?!1:s,l=e.fovyRadians,f=e.fovy,c=f===void 0?75:f,p=e.near,d=p===void 0?.1:p,v=e.far,m=v===void 0?1e3:v,g=e.padding,y=g===void 0?null:g,_=e.focalDistance,b=_===void 0?1:_;this.viewMatrixUncentered=i,this.viewMatrix=new pe().multiplyRight(i).translate(new j(this.center).negate()),this.projectionMatrix=o||rbe({width:this.width,height:this.height,orthographic:u,fovyRadians:l||c*Q_e,focalDistance:b,padding:y,near:d,far:m});var x=Rl();Rs(x,x,this.projectionMatrix),Rs(x,x,this.viewMatrix),this.viewProjectionMatrix=x,this.viewMatrixInverse=XS([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=gU(this.viewMatrixInverse);var A=Rl(),S=Rl();j4(A,A,[this.width/2,-this.height/2,1]),N4(A,A,[1,-1,0]),Rs(S,A,this.viewProjectionMatrix),this.pixelProjectionMatrix=S,this.pixelUnprojectionMatrix=XS(Rl(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||J.warn("Pixel project matrix not invertible")()}}]),t}();(0,xt.default)(Ar,"displayName","Viewport");function nbe(){var t=new _a(2);return _a!=Float32Array&&(t[0]=0,t[1]=0),t}function kl(t,r,e){return t[0]=r[0]+e[0],t[1]=r[1]+e[1],t}function vg(t,r){return t[0]=-r[0],t[1]=-r[1],t}var PKe=function(){var t=nbe();return function(r,e,n,i,a,o){var s,u;for(e||(e=2),n||(n=0),i?u=Math.min(i*e+n,r.length):u=r.length,s=n;s<u;s+=e)t[0]=r[s],t[1]=r[s+1],a(t,t,o),r[s]=t[0],r[s+1]=t[1];return r}}();function TU(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Bl(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?TU(Object(e),!0).forEach(function(n){(0,Mn.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):TU(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function ibe(t){var r=abe();return function(){var n=(0,Np.default)(t),i;if(r){var a=(0,Np.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,EU.default)(this,i)}}function abe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Kr=function(t){(0,OU.default)(e,t);var r=ibe(e);function e(){var n,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,wU.default)(this,e);var a=i.latitude,o=a===void 0?0:a,s=i.longitude,u=s===void 0?0:s,l=i.zoom,f=l===void 0?0:l,c=i.pitch,p=c===void 0?0:c,d=i.bearing,v=d===void 0?0:d,m=i.nearZMultiplier,g=m===void 0?.1:m,y=i.farZMultiplier,_=y===void 0?1.01:y,b=i.orthographic,x=b===void 0?!1:b,A=i.projectionMatrix,S=i.repeat,P=S===void 0?!1:S,O=i.worldOffset,C=O===void 0?0:O,T=i.position,I=i.padding,R=i.legacyMeterSizes,V=R===void 0?!1:R,z=i.width,k=i.height,G=i.altitude,U=G===void 0?1.5:G,$=Math.pow(2,f);z=z||1,k=k||1;var H,Q=null;if(A)U=A[5]/2,H=ba(U);else{i.fovy?(H=i.fovy,U=Ao(H)):H=ba(U);var ie;if(I){var fe=I.top,Ae=fe===void 0?0:fe,Oe=I.bottom,Xe=Oe===void 0?0:Oe;ie=[0,We((Ae+k-Xe)/2,0,k)-k/2]}Q=cg({width:z,height:k,scale:$,center:T&&[0,0,T[2]*ks(o)],offset:ie,pitch:p,fovy:H,nearZMultiplier:g,farZMultiplier:_})}var ge=Bp({height:k,pitch:p,bearing:v,scale:$,altitude:U});if(C){var qe=new pe().translate([512*C,0,0]);ge=qe.multiplyLeft(ge)}return n=r.call(this,Bl(Bl(Bl({},i),{},{width:z,height:k,viewMatrix:ge,longitude:u,latitude:o,zoom:f},Q),{},{fovy:H,focalDistance:U})),(0,Mn.default)((0,si.default)(n),"longitude",void 0),(0,Mn.default)((0,si.default)(n),"latitude",void 0),(0,Mn.default)((0,si.default)(n),"pitch",void 0),(0,Mn.default)((0,si.default)(n),"bearing",void 0),(0,Mn.default)((0,si.default)(n),"altitude",void 0),(0,Mn.default)((0,si.default)(n),"fovy",void 0),(0,Mn.default)((0,si.default)(n),"orthographic",void 0),(0,Mn.default)((0,si.default)(n),"_subViewports",void 0),(0,Mn.default)((0,si.default)(n),"_pseudoMeters",void 0),n.latitude=o,n.longitude=u,n.zoom=f,n.pitch=p,n.bearing=v,n.altitude=U,n.fovy=H,n.orthographic=x,n._subViewports=P?[]:null,n._pseudoMeters=V,Object.freeze((0,si.default)(n)),n}return(0,PU.default)(e,[{key:"subViewports",get:function(){if(this._subViewports&&!this._subViewports.length)for(var i=this.getBounds(),a=Math.floor((i[0]+180)/360),o=Math.ceil((i[2]-180)/360),s=a;s<=o;s++){var u=s?new e(Bl(Bl({},this),{},{worldOffset:s})):this;this._subViewports.push(u)}return this._subViewports}},{key:"projectPosition",value:function(i){if(this._pseudoMeters)return(0,fT.default)((0,Np.default)(e.prototype),"projectPosition",this).call(this,i);var a=this.projectFlat(i),o=(0,mg.default)(a,2),s=o[0],u=o[1],l=(i[2]||0)*ks(i[1]);return[s,u,l]}},{key:"unprojectPosition",value:function(i){if(this._pseudoMeters)return(0,fT.default)((0,Np.default)(e.prototype),"unprojectPosition",this).call(this,i);var a=this.unprojectFlat(i),o=(0,mg.default)(a,2),s=o[0],u=o[1],l=(i[2]||0)/ks(u);return[s,u,l]}},{key:"addMetersToLngLat",value:function(i,a){return kp(i,a)}},{key:"panByPosition",value:function(i,a){var o=Yr(a,this.pixelUnprojectionMatrix),s=this.projectFlat(i),u=kl([],s,vg([],o)),l=kl([],this.center,u),f=this.unprojectFlat(l),c=(0,mg.default)(f,2),p=c[0],d=c[1];return{longitude:p,latitude:d}}},{key:"getBounds",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=Ml(this,i.z||0);return[Math.min(a[0][0],a[1][0],a[2][0],a[3][0]),Math.min(a[0][1],a[1][1],a[2][1],a[3][1]),Math.max(a[0][0],a[1][0],a[2][0],a[3][0]),Math.max(a[0][1],a[1][1],a[2][1],a[3][1])]}},{key:"fitBounds",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=this.width,s=this.height,u=Cl(Bl({width:o,height:s,bounds:i},a)),l=u.longitude,f=u.latitude,c=u.zoom;return new e({width:o,height:s,longitude:l,latitude:f,zoom:c})}}]),e}(Ar);(0,Mn.default)(Kr,"displayName","WebMercatorViewport");function obe(){var t=new _a(3);return _a!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function sbe(t){var r=t[0],e=t[1],n=t[2];return Math.hypot(r,e,n)}function ube(t,r,e){return t[0]=r[0]-e[0],t[1]=r[1]-e[1],t[2]=r[2]-e[2],t}function lbe(t){var r=t[0],e=t[1],n=t[2];return r*r+e*e+n*n}function CU(t,r,e,n){var i=r[0],a=r[1],o=r[2];return t[0]=i+n*(e[0]-i),t[1]=a+n*(e[1]-a),t[2]=o+n*(e[2]-o),t}var gg=ube;var MU=sbe,yg=lbe,IKe=function(){var t=obe();return function(r,e,n,i,a,o){var s,u;for(e||(e=3),n||(n=0),i?u=Math.min(i*e+n,r.length):u=r.length,s=n;s<u;s+=e)t[0]=r[s],t[1]=r[s+1],t[2]=r[s+2],a(t,t,o),r[s]=t[0],r[s+1]=t[1],r[s+2]=t[2];return r}}();var RU=[0,0,0];function cT(t,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,n=r.projectPosition(t);if(e&&r instanceof Kr){var i=(0,_g.default)(t,3),a=i[0],o=i[1],s=i[2],u=s===void 0?0:s,l=r.getDistanceScales([a,o]);n[2]=u*l.unitsPerMeter[2]}return n}function fbe(t){var r=t.viewport,e=t.modelMatrix,n=t.coordinateOrigin,i=t.coordinateSystem,a=t.fromCoordinateSystem,o=t.fromCoordinateOrigin;return i===ue.DEFAULT&&(i=r.isGeospatial?ue.LNGLAT:ue.CARTESIAN),a===void 0&&(a=i),o===void 0&&(o=n),{viewport:r,coordinateSystem:i,coordinateOrigin:n,modelMatrix:e,fromCoordinateSystem:a,fromCoordinateOrigin:o}}function pT(t,r){var e=r.viewport,n=r.modelMatrix,i=r.coordinateSystem,a=r.coordinateOrigin,o=r.offsetMode,s=(0,_g.default)(t,3),u=s[0],l=s[1],f=s[2],c=f===void 0?0:f;if(n){var p=Ls([],[u,l,c,1],n),d=(0,_g.default)(p,3);u=d[0],l=d[1],c=d[2]}switch(i){case ue.LNGLAT:return cT([u,l,c],e,o);case ue.LNGLAT_OFFSETS:return cT([u+a[0],l+a[1],c+(a[2]||0)],e,o);case ue.METER_OFFSETS:return cT(kp(a,[u,l,c]),e,o);case ue.CARTESIAN:default:return e.isGeospatial?[u+a[0],l+a[1],c+a[2]]:e.projectPosition([u,l,c])}}function bg(t,r){var e=fbe(r),n=e.viewport,i=e.coordinateSystem,a=e.coordinateOrigin,o=e.modelMatrix,s=e.fromCoordinateSystem,u=e.fromCoordinateOrigin,l=r.autoOffset,f=l===void 0?!0:l,c=f?YS(n,i,a):{},p=c.geospatialOrigin,d=p===void 0?RU:p,v=c.shaderCoordinateOrigin,m=v===void 0?RU:v,g=c.offsetMode,y=g===void 0?!1:g,_=pT(t,{viewport:n,modelMatrix:o,coordinateSystem:s,coordinateOrigin:u,offsetMode:y});if(y){var b=n.projectPosition(d||m);gg(_,_,b)}return _}function LU(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function cbe(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?LU(Object(e),!0).forEach(function(n){(0,xa.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):LU(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var pbe=[255,255,255],hbe=1,dbe=[0,0,1],vbe=[0,0,1],mbe=0,xg=function(){function t(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,kU.default)(this,t),(0,xa.default)(this,"id",void 0),(0,xa.default)(this,"color",void 0),(0,xa.default)(this,"intensity",void 0),(0,xa.default)(this,"type","point"),(0,xa.default)(this,"position",void 0),(0,xa.default)(this,"attenuation",void 0),(0,xa.default)(this,"projectedLight",void 0);var e=r.color,n=e===void 0?pbe:e,i=r.intensity,a=i===void 0?hbe:i,o=r.position,s=o===void 0?vbe:o;this.id=r.id||"point-".concat(mbe++),this.color=n,this.intensity=a,this.type="point",this.position=s,this.attenuation=gbe(r),this.projectedLight=cbe({},this)}return(0,BU.default)(t,[{key:"getProjectedLight",value:function(e){var n=e.layer,i=this.projectedLight,a=n.context.viewport,o=n.props,s=o.coordinateSystem,u=o.coordinateOrigin,l=bg(this.position,{viewport:a,coordinateSystem:s,coordinateOrigin:u,fromCoordinateSystem:a.isGeospatial?ue.LNGLAT:ue.CARTESIAN,fromCoordinateOrigin:[0,0,0]});return i.color=this.color,i.intensity=this.intensity,i.position=l,i}}]),t}();function gbe(t){return t.attenuation?t.attenuation:"intensity"in t?[0,0,t.intensity||0]:dbe}var FU=h(L()),DU=h(N()),NU=h(Y()),jU=h(K()),hT=h(q());function ybe(t){var r=_be();return function(){var n=(0,hT.default)(t),i;if(r){var a=(0,hT.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,jU.default)(this,i)}}function _be(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var UU=function(t){(0,NU.default)(e,t);var r=ybe(e);function e(){return(0,FU.default)(this,e),r.apply(this,arguments)}return(0,DU.default)(e,[{key:"getProjectedLight",value:function(i){var a=i.layer,o=this.projectedLight,s=a.context.viewport,u=a.props,l=u.coordinateSystem,f=u.coordinateOrigin,c=u.modelMatrix,p=ug({viewport:s,modelMatrix:c,coordinateSystem:l,coordinateOrigin:f}),d=p.project_uCameraPosition;return o.color=this.color,o.intensity=this.intensity,o.position=d,o}}]),e}(xg);var zU=h(me()),VU=h(L()),HU=h(N()),WU=h(be()),$U=h(Y()),XU=h(K()),dT=h(q()),qU=h(B());var Us=Math.PI/180,bbe=1e3*60*60*24,xbe=2440588,Abe=2451545,Ag=Us*23.4397,Sbe=357.5291,Tbe=.98560028,wbe=280.147,Pbe=360.9856235;function GU(t,r,e){var n=Us*-e,i=Us*r,a=Ebe(t),o=Fbe(a),s=Lbe(a,n)-o.rightAscension;return{azimuth:Ibe(s,i,o.declination),altitude:Rbe(s,i,o.declination)}}function Sg(t,r,e){var n=GU(t,r,e),i=n.azimuth,a=n.altitude;return[Math.sin(i)*Math.cos(a),Math.cos(i)*Math.cos(a),-Math.sin(a)]}function Obe(t){var r=typeof t=="number"?t:t.getTime();return r/bbe-.5+xbe}function Ebe(t){return Obe(t)-Abe}function Cbe(t,r){var e=t;return Math.atan2(Math.sin(e)*Math.cos(Ag)-Math.tan(r)*Math.sin(Ag),Math.cos(e))}function Mbe(t,r){var e=t;return Math.asin(Math.sin(r)*Math.cos(Ag)+Math.cos(r)*Math.sin(Ag)*Math.sin(e))}function Ibe(t,r,e){var n=t,i=r,a=e;return Math.atan2(Math.sin(n),Math.cos(n)*Math.sin(i)-Math.tan(a)*Math.cos(i))}function Rbe(t,r,e){var n=t,i=r,a=e;return Math.asin(Math.sin(i)*Math.sin(a)+Math.cos(i)*Math.cos(a)*Math.cos(n))}function Lbe(t,r){return Us*(wbe+Pbe*t)-r}function kbe(t){return Us*(Sbe+Tbe*t)}function Bbe(t){var r=t,e=Us*(1.9148*Math.sin(r)+.02*Math.sin(2*r)+3e-4*Math.sin(3*r)),n=Us*102.9372;return r+e+n+Math.PI}function Fbe(t){var r=kbe(t),e=Bbe(r);return{declination:Mbe(e,0),rightAscension:Cbe(e,0)}}function Dbe(t){var r=Nbe();return function(){var n=(0,dT.default)(t),i;if(r){var a=(0,dT.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,XU.default)(this,i)}}function Nbe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var YU=function(t){(0,$U.default)(e,t);var r=Dbe(e);function e(n){var i;return(0,VU.default)(this,e),i=r.call(this,n),(0,qU.default)((0,WU.default)(i),"timestamp",void 0),i.timestamp=n.timestamp,i}return(0,HU.default)(e,[{key:"getProjectedLight",value:function(i){var a=i.layer,o=a.context.viewport,s=o.resolution&&o.resolution>0;if(s){var u=Sg(this.timestamp,0,0),l=(0,zU.default)(u,3),f=l[0],c=l[1],p=l[2];this.direction=[f,-p,c]}else{var d=o.latitude,v=o.longitude;this.direction=Sg(this.timestamp,d,v)}return this}}]),e}(Is);var i6=h(L()),a6=h(N()),jp=h(B());var KU=h(L()),ZU=h(N()),JU=h(be()),QU=h(Y()),e6=h(K()),vT=h(q()),t6=h(B());function jbe(t){var r=Ube();return function(){var n=(0,vT.default)(t),i;if(r){var a=(0,vT.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,e6.default)(this,i)}}function Ube(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var mT=function(t){(0,QU.default)(e,t);var r=jbe(e);function e(n,i){var a;(0,KU.default)(this,e),a=r.call(this,n,i),(0,t6.default)((0,JU.default)(a),"model",void 0);var o=i.module,s=i.fs,u=i.id;return a.model=new ng(n,{id:u,fs:s,modules:[o]}),a}return(0,ZU.default)(e,[{key:"render",value:function(i){var a=this,o=this.gl;Ht(o,{viewport:[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}),Le(o,{framebuffer:i.outputBuffer,clearColor:[0,0,0,0]},function(){return a._renderPass(o,i)})}},{key:"delete",value:function(){this.model.delete(),this.model=null}},{key:"_renderPass",value:function(i,a){var o=a.inputBuffer;wn(i,{color:!0}),this.model.draw({moduleSettings:a.moduleSettings,uniforms:{texture:o,texSize:[o.width,o.height]},parameters:{depthWrite:!1,depthTest:!1}})}}]),e}(ag);function Gbe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=zbe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function zbe(t,r){if(t){if(typeof t=="string")return r6(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return r6(t,r)}}function r6(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var o6=function(){function t(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};(0,i6.default)(this,t),(0,jp.default)(this,"id",void 0),(0,jp.default)(this,"props",void 0),(0,jp.default)(this,"module",void 0),(0,jp.default)(this,"passes",void 0),this.id="".concat(r.name,"-pass"),this.props=e,dm(r),this.module=r}return(0,a6.default)(t,[{key:"setProps",value:function(e){this.props=e}},{key:"preRender",value:function(){}},{key:"postRender",value:function(e,n){var i=this.passes||Vbe(e,this.module,this.id);this.passes=i;for(var a=n.target,o=n.inputBuffer,s=n.swapBuffer,u=0;u<this.passes.length;u++){a&&u===this.passes.length-1&&(s=a),this.passes[u].render({inputBuffer:o,outputBuffer:s,moduleSettings:this.props});var l=s;s=o,o=l}return o}},{key:"cleanup",value:function(){if(this.passes){var e=Gbe(this.passes),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;i.delete()}}catch(a){e.e(a)}finally{e.f()}this.passes=void 0}}}]),t}();function Vbe(t,r,e){if(!r.passes){var n=n6(r),i=new mT(t,{id:e,module:r,fs:n});return[i]}return r.passes.map(function(a,o){var s=n6(r,a),u="".concat(e,"-").concat(o);return new mT(t,{id:u,module:r,fs:s})})}var Hbe=function(r){return`uniform sampler2D texture;
uniform vec2 texSize;

varying vec2 position;
varying vec2 coordinate;
varying vec2 uv;

void main() {
  vec2 texCoord = coordinate;

  gl_FragColor = texture2D(texture, texCoord);
  gl_FragColor = `.concat(r,`(gl_FragColor, texSize, texCoord);
}
`)},Wbe=function(r){return`uniform sampler2D texture;
uniform vec2 texSize;

varying vec2 position;
varying vec2 coordinate;
varying vec2 uv;

void main() {
  vec2 texCoord = coordinate;

  gl_FragColor = `.concat(r,`(texture, texSize, texCoord);
}
`)};function n6(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t;if(r.filter){var e=typeof r.filter=="string"?r.filter:"".concat(t.name,"_filterColor");return Hbe(e)}if(r.sampler){var n=typeof r.sampler=="string"?r.sampler:"".concat(t.name,"_sampleColor");return Wbe(n)}return null}var l6=h(L()),f6=h(N()),yT=h(be()),_T=h(Ee()),c6=h(Y()),p6=h(K()),Up=h(q()),Tg=h(B());function s6(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function gT(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?s6(Object(e),!0).forEach(function(n){(0,Tg.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):s6(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function $be(t){var r=Xbe();return function(){var n=(0,Up.default)(t),i;if(r){var a=(0,Up.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,p6.default)(this,i)}}function Xbe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var u6={blendFunc:[1,0,32771,0],blendEquation:32774},So=function(t){(0,c6.default)(e,t);var r=$be(e);function e(){var n;(0,l6.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,Tg.default)((0,yT.default)(n),"pickZ",void 0),(0,Tg.default)((0,yT.default)(n),"_colorEncoderState",null),n}return(0,f6.default)(e,[{key:"render",value:function(i){return"pickingFBO"in i?this._drawPickingBuffer(i):(0,_T.default)((0,Up.default)(e.prototype),"render",this).call(this,i)}},{key:"_drawPickingBuffer",value:function(i){var a=this,o=i.layers,s=i.layerFilter,u=i.views,l=i.viewports,f=i.onViewportActive,c=i.pickingFBO,p=i.deviceRect,d=p.x,v=p.y,m=p.width,g=p.height,y=i.cullRect,_=i.effects,b=i.pass,x=b===void 0?"picking":b,A=i.pickZ,S=i.moduleParameters,P=this.gl;this.pickZ=A;var O=this._resetColorEncoder(A),C=Le(P,gT(gT({scissorTest:!0,scissor:[d,v,m,g],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0]},u6),{},{blend:!A}),function(){return(0,_T.default)((0,Up.default)(e.prototype),"render",a).call(a,{target:c,layers:o,layerFilter:s,views:u,viewports:l,onViewportActive:f,cullRect:y,effects:_?.filter(function(I){return I.useInPicking}),pass:x,isPicking:!0,moduleParameters:S})});this._colorEncoderState=null;var T=O&&Ybe.bind(null,O);return{decodePickingColor:T,stats:C}}},{key:"shouldDrawLayer",value:function(i){var a=i.props,o=a.pickable,s=a.operation;return o&&s.includes("draw")||s.includes("terrain")}},{key:"getModuleParameters",value:function(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}},{key:"getLayerParameters",value:function(i,a,o){var s=gT({},i.props.parameters),u=i.props,l=u.pickable,f=u.operation;return this._colorEncoderState?l&&f.includes("draw")&&(Object.assign(s,u6),s.blend=!0,s.blendColor=qbe(this._colorEncoderState,i,o)):s.blend=!1,f.includes("terrain")&&(s.blend=!1),s}},{key:"_resetColorEncoder",value:function(i){return this._colorEncoderState=i?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}]),e}(Xr);function qbe(t,r,e){var n=t.byLayer,i=t.byAlpha,a,o=n.get(r);return o?(o.viewports.push(e),a=o.a):(a=n.size+1,a<=255?(o={a,layer:r,viewports:[e]},n.set(r,o),i[a]=o):(J.warn("Too many pickable layers, only picking the first 255")(),a=0)),[0,0,0,a/255]}function Ybe(t,r){var e=t.byAlpha[r[3]];return e&&{pickedLayer:e.layer,pickedViewports:e.viewports,pickedObjectIndex:e.layer.decodePickingColor(r)}}var nV=h(L()),iV=h(N()),pt=h(B());var O6=h(L()),E6=h(N()),Ni=h(B());var To={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},Fl=Symbol.for("component"),In=Symbol.for("propTypes"),wg=Symbol.for("deprecatedProps"),Aa=Symbol.for("asyncPropDefaults"),Di=Symbol.for("asyncPropOriginal"),ui=Symbol.for("asyncPropResolved");function jr(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(){return!0};return Array.isArray(t)?h6(t,r,[]):r(t)?[t]:[]}function h6(t,r,e){for(var n=-1;++n<t.length;){var i=t[n];Array.isArray(i)?h6(i,r,e):r(i)&&e.push(i)}return e}function Pg(t){for(var r=t.target,e=t.source,n=t.start,i=n===void 0?0:n,a=t.count,o=a===void 0?1:a,s=e.length,u=o*s,l=0,f=i;l<s;l++)r[f++]=e[l];for(;l<u;)l<u-l?(r.copyWithin(i+l,i,i+l),l*=2):(r.copyWithin(i+l,i,i+u-l),l=u);return r}var y6=h(L()),_6=h(N()),Dl=h(B());var v6=h(L()),m6=h(N()),li=h(B());function Kbe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=Zbe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function Zbe(t,r){if(t){if(typeof t=="string")return d6(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return d6(t,r)}}function d6(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var g6=function(){function t(r,e,n){(0,v6.default)(this,t),(0,li.default)(this,"id",void 0),(0,li.default)(this,"context",void 0),(0,li.default)(this,"isLoaded",void 0),(0,li.default)(this,"persistent",void 0),(0,li.default)(this,"_loadCount",0),(0,li.default)(this,"_subscribers",new Set),(0,li.default)(this,"_data",void 0),(0,li.default)(this,"_loader",void 0),(0,li.default)(this,"_error",void 0),(0,li.default)(this,"_content",void 0),this.id=r,this.context=n,this.setData(e)}return(0,m6.default)(t,[{key:"subscribe",value:function(e){this._subscribers.add(e)}},{key:"unsubscribe",value:function(e){this._subscribers.delete(e)}},{key:"inUse",value:function(){return this._subscribers.size>0}},{key:"delete",value:function(){}},{key:"getData",value:function(){var e=this;return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(function(){return e.getData()})}},{key:"setData",value:function(e,n){var i=this;if(!(e===this._data&&!n)){this._data=e;var a=++this._loadCount,o=e;typeof e=="string"&&(o=Jt(e)),o instanceof Promise?(this.isLoaded=!1,this._loader=o.then(function(f){i._loadCount===a&&(i.isLoaded=!0,i._error=void 0,i._content=f)}).catch(function(f){i._loadCount===a&&(i.isLoaded=!0,i._error=f||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);var s=Kbe(this._subscribers),u;try{for(s.s();!(u=s.n()).done;){var l=u.value;l.onChange(this.getData())}}catch(f){s.e(f)}finally{s.f()}}}}]),t}();var b6=function(){function t(r){var e=r.gl,n=r.protocol;(0,y6.default)(this,t),(0,Dl.default)(this,"protocol",void 0),(0,Dl.default)(this,"_context",void 0),(0,Dl.default)(this,"_resources",void 0),(0,Dl.default)(this,"_consumers",void 0),(0,Dl.default)(this,"_pruneRequest",void 0),this.protocol=n||"resource://",this._context={gl:e,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}return(0,_6.default)(t,[{key:"contains",value:function(e){return e.startsWith(this.protocol)?!0:e in this._resources}},{key:"add",value:function(e){var n=e.resourceId,i=e.data,a=e.forceUpdate,o=a===void 0?!1:a,s=e.persistent,u=s===void 0?!0:s,l=this._resources[n];l?l.setData(i,o):(l=new g6(n,i,this._context),this._resources[n]=l),l.persistent=u}},{key:"remove",value:function(e){var n=this._resources[e];n&&(n.delete(),delete this._resources[e])}},{key:"unsubscribe",value:function(e){var n=e.consumerId,i=this._consumers[n];if(i){for(var a in i){var o=i[a],s=this._resources[o.resourceId];s&&s.unsubscribe(o)}delete this._consumers[n],this.prune()}}},{key:"subscribe",value:function(e){var n=e.resourceId,i=e.onChange,a=e.consumerId,o=e.requestId,s=o===void 0?"default":o,u=this._resources,l=this.protocol;n.startsWith(l)&&(n=n.replace(l,""),u[n]||this.add({resourceId:n,data:null,persistent:!1}));var f=u[n];if(this._track(a,s,f,i),f)return f.getData()}},{key:"prune",value:function(){var e=this;this._pruneRequest||(this._pruneRequest=setTimeout(function(){return e._prune()},0))}},{key:"finalize",value:function(){for(var e in this._resources)this._resources[e].delete()}},{key:"_track",value:function(e,n,i,a){var o=this._consumers,s=o[e]=o[e]||{},u=s[n]||{},l=u.resourceId&&this._resources[u.resourceId];l&&(l.unsubscribe(u),this.prune()),i&&(s[n]=u,u.onChange=a,u.resourceId=i.id,i.subscribe(u))}},{key:"_prune",value:function(){this._pruneRequest=null;for(var e=0,n=Object.keys(this._resources);e<n.length;e++){var i=n[e],a=this._resources[i];!a.persistent&&!a.inUse()&&(a.delete(),delete this._resources[i])}}}]),t}();var Jbe=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,Je={name:"project32",dependencies:[Qt],vs:Jbe};var A6=h(B());function x6(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Qbe(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?x6(Object(e),!0).forEach(function(n){(0,A6.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):x6(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var st=Qbe({inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:#decl":`
uniform bool picking_uAttribute;
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},Wm);function S6(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=e1e(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function e1e(t,r){if(t){if(typeof t=="string")return T6(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return T6(t,r)}}function T6(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var t1e=[Qt],r1e=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function w6(t){var r=Pn.getDefaultProgramManager(t),e=S6(t1e),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;r.addDefaultModule(i)}}catch(u){e.e(u)}finally{e.f()}var a=S6(r1e),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;r.addShaderHook(s)}}catch(u){a.e(u)}finally{a.f()}return r}function Gp(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=n1e(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function n1e(t,r){if(t){if(typeof t=="string")return P6(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return P6(t,r)}}function P6(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var i1e="layerManager.setLayers",a1e="layerManager.activateViewport",Og=function(){function t(r){var e=this,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=n.deck,a=n.stats,o=n.viewport,s=n.timeline;(0,O6.default)(this,t),(0,Ni.default)(this,"layers",void 0),(0,Ni.default)(this,"context",void 0),(0,Ni.default)(this,"resourceManager",void 0),(0,Ni.default)(this,"_lastRenderedLayers",[]),(0,Ni.default)(this,"_needsRedraw",!1),(0,Ni.default)(this,"_needsUpdate",!1),(0,Ni.default)(this,"_nextLayers",null),(0,Ni.default)(this,"_debug",!1),(0,Ni.default)(this,"activateViewport",function(u){Nt(a1e,e,u),u&&(e.context.viewport=u)}),this.layers=[],this.resourceManager=new b6({gl:r,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,gl:r,deck:i,programManager:r&&w6(r),stats:a||new ys({id:"deck.gl"}),viewport:o||new Ar({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:s||new bo,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}return(0,E6.default)(t,[{key:"finalize",value:function(){this.resourceManager.finalize();var e=Gp(this.layers),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;this._finalizeLayer(i)}}catch(a){e.e(a)}finally{e.f()}}},{key:"needsRedraw",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1},n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);var i=Gp(this.layers),a;try{for(i.s();!(a=i.n()).done;){var o=a.value,s=o.getNeedsRedraw(e);n=n||s}}catch(u){i.e(u)}finally{i.f()}return n}},{key:"needsUpdate",value:function(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._needsUpdate}},{key:"setNeedsRedraw",value:function(e){this._needsRedraw=this._needsRedraw||e}},{key:"setNeedsUpdate",value:function(e){this._needsUpdate=this._needsUpdate||e}},{key:"getLayers",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.layerIds;return n?this.layers.filter(function(i){return n.find(function(a){return i.id.indexOf(a)===0})}):this.layers}},{key:"setProps",value:function(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}},{key:"setLayers",value:function(e,n){Nt(i1e,this,n,e),this._lastRenderedLayers=e;var i=jr(e,Boolean),a=Gp(i),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;s.context=this.context}}catch(u){a.e(u)}finally{a.f()}this._updateLayers(this.layers,i)}},{key:"updateLayers",value:function(){var e=this.needsUpdate();e&&(this.setNeedsRedraw("updating layers: ".concat(e)),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}},{key:"_handleError",value:function(e,n,i){i.raiseError(n,"".concat(e," of ").concat(i))}},{key:"_updateLayers",value:function(e,n){var i={},a=Gp(e),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;i[s.id]?J.warn("Multiple old layers with same id ".concat(s.id))():i[s.id]=s}}catch(d){a.e(d)}finally{a.f()}var u=[];this._updateSublayersRecursively(n,i,u),this._finalizeOldLayers(i);for(var l=!1,f=0,c=u;f<c.length;f++){var p=c[f];if(p.hasUniformTransition()){l="Uniform transition in ".concat(p);break}}this._needsUpdate=l,this.layers=u}},{key:"_updateSublayersRecursively",value:function(e,n,i){var a=Gp(e),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;s.context=this.context;var u=n[s.id];u===null&&J.warn("Multiple new layers with same id ".concat(s.id))(),n[s.id]=null;var l=null;try{this._debug&&u!==s&&s.validateProps(),u?(this._transferLayerState(u,s),this._updateLayer(s)):this._initializeLayer(s),i.push(s),l=s.isComposite?s.getSubLayers():null}catch(f){this._handleError("matching",f,s)}l&&this._updateSublayersRecursively(l,n,i)}}catch(f){a.e(f)}finally{a.f()}}},{key:"_finalizeOldLayers",value:function(e){for(var n in e){var i=e[n];i&&this._finalizeLayer(i)}}},{key:"_initializeLayer",value:function(e){try{e._initialize(),e.lifecycle=To.INITIALIZED}catch(n){this._handleError("initialization",n,e)}}},{key:"_transferLayerState",value:function(e,n){n._transferState(e),n.lifecycle=To.MATCHED,n!==e&&(e.lifecycle=To.AWAITING_GC)}},{key:"_updateLayer",value:function(e){try{e._update()}catch(n){this._handleError("update",n,e)}}},{key:"_finalizeLayer",value:function(e){this._needsRedraw=this._needsRedraw||"finalized ".concat(e),e.lifecycle=To.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=To.FINALIZED}catch(n){this._handleError("finalization",n,e)}}}]),t}();var M6=h(L()),I6=h(N()),Ur=h(B());var bT=h(ze());function Lt(t,r,e){if(t===r)return!0;if(!e||!t||!r)return!1;if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(var n=0;n<t.length;n++)if(!Lt(t[n],r[n],e-1))return!1;return!0}if(Array.isArray(r))return!1;if((0,bT.default)(t)==="object"&&(0,bT.default)(r)==="object"){var i=Object.keys(t),a=Object.keys(r);if(i.length!==a.length)return!1;for(var o=0,s=i;o<s.length;o++){var u=s[o];if(!r.hasOwnProperty(u)||!Lt(t[u],r[u],e-1))return!1}return!0}return!1}function C6(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function zp(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?C6(Object(e),!0).forEach(function(n){(0,Ur.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):C6(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var R6=function(){function t(r){(0,M6.default)(this,t),(0,Ur.default)(this,"width",void 0),(0,Ur.default)(this,"height",void 0),(0,Ur.default)(this,"views",void 0),(0,Ur.default)(this,"viewState",void 0),(0,Ur.default)(this,"controllers",void 0),(0,Ur.default)(this,"timeline",void 0),(0,Ur.default)(this,"_viewports",void 0),(0,Ur.default)(this,"_viewportMap",void 0),(0,Ur.default)(this,"_isUpdating",void 0),(0,Ur.default)(this,"_needsRedraw",void 0),(0,Ur.default)(this,"_needsUpdate",void 0),(0,Ur.default)(this,"_eventManager",void 0),(0,Ur.default)(this,"_eventCallbacks",void 0),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=r.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=r.eventManager,this._eventCallbacks={onViewStateChange:r.onViewStateChange,onInteractionStateChange:r.onInteractionStateChange},Object.seal(this),this.setProps(r)}return(0,I6.default)(t,[{key:"finalize",value:function(){for(var e in this.controllers){var n=this.controllers[e];n&&n.finalize()}this.controllers={}}},{key:"needsRedraw",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1},n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}},{key:"setNeedsUpdate",value:function(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}},{key:"updateViewStates",value:function(){for(var e in this.controllers){var n=this.controllers[e];n&&n.updateTransition()}}},{key:"getViewports",value:function(e){return e?this._viewports.filter(function(n){return n.containsPixel(e)}):this._viewports}},{key:"getViews",value:function(){var e={};return this.views.forEach(function(n){e[n.id]=n}),e}},{key:"getView",value:function(e){return this.views.find(function(n){return n.id===e})}},{key:"getViewState",value:function(e){var n=typeof e=="string"?this.getView(e):e,i=n&&this.viewState[n.getViewStateId()]||this.viewState;return n?n.filterViewState(i):i}},{key:"getViewport",value:function(e){return this._viewportMap[e]}},{key:"unproject",value:function(e,n){for(var i=this.getViewports(),a={x:e[0],y:e[1]},o=i.length-1;o>=0;--o){var s=i[o];if(s.containsPixel(a)){var u=e.slice();return u[0]-=s.x,u[1]-=s.y,s.unproject(u,n)}}return null}},{key:"setProps",value:function(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}},{key:"_update",value:function(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}},{key:"_setSize",value:function(e,n){(e!==this.width||n!==this.height)&&(this.width=e,this.height=n,this.setNeedsUpdate("Size changed"))}},{key:"_setViews",value:function(e){e=jr(e,Boolean);var n=this._diffViews(e,this.views);n&&this.setNeedsUpdate("views changed"),this.views=e}},{key:"_setViewState",value:function(e){if(e){var n=!Lt(e,this.viewState,3);n&&this.setNeedsUpdate("viewState changed"),this.viewState=e}else J.warn("missing `viewState` or `initialViewState`")()}},{key:"_onViewStateChange",value:function(e,n){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange(zp(zp({},n),{},{viewId:e}))}},{key:"_createController",value:function(e,n){var i=this,a=n.type,o=new a({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,n.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:function(u){var l;return(l=i.getView(e.id))===null||l===void 0?void 0:l.makeViewport({viewState:u,width:i.width,height:i.height})}});return o}},{key:"_updateController",value:function(e,n,i,a){var o=e.controller;if(o&&i){var s=zp(zp(zp({},n),o),{},{id:e.id,x:i.x,y:i.y,width:i.width,height:i.height});return(!a||a.constructor!==e.ControllerType)&&(a=this._createController(e,s)),a&&a.setProps(s),a}return null}},{key:"_rebuildViewports",value:function(){var e=this.views,n=this.controllers;this._viewports=[],this.controllers={};for(var i=!1,a=e.length;a--;){var o=e[a],s=this.getViewState(o),u=o.makeViewport({viewState:s,width:this.width,height:this.height}),l=n[o.id],f=Boolean(o.controller);f&&!l&&(i=!0),(i||!f)&&l&&(l.finalize(),l=null),this.controllers[o.id]=this._updateController(o,s,u,l),u&&this._viewports.unshift(u)}for(var c in n){var p=n[c];p&&!this.controllers[c]&&p.finalize()}this._buildViewportMap()}},{key:"_buildViewportMap",value:function(){var e=this;this._viewportMap={},this._viewports.forEach(function(n){n.id&&(e._viewportMap[n.id]=e._viewportMap[n.id]||n)})}},{key:"_diffViews",value:function(e,n){return e.length!==n.length?!0:e.some(function(i,a){return!e[a].equals(n[a])})}}]),t}();var dG=h(L()),vG=h(N()),mG=h(Y()),gG=h(K()),OT=h(q()),yG=h(B());var B6=h(ze()),F6=h(L()),D6=h(N()),ji=h(B());var L6=h(ze()),o1e=/([0-9]+\.?[0-9]*)(%|px)/;function Sa(t){switch((0,L6.default)(t)){case"number":return{position:t,relative:!1};case"string":var r=o1e.exec(t);if(r&&r.length>=3){var e=r[2]==="%",n=parseFloat(r[1]);return{position:e?n/100:n,relative:e}}default:throw new Error("Could not parse position string ".concat(t))}}function Ta(t,r){return t.relative?Math.round(t.position*r):t.position}function rt(t,r){if(!t)throw new Error(r||"deck.gl: assertion failed.")}function k6(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Gs(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?k6(Object(e),!0).forEach(function(n){(0,ji.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):k6(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var Rn=function(){function t(r){(0,F6.default)(this,t),(0,ji.default)(this,"id",void 0),(0,ji.default)(this,"viewportInstance",void 0),(0,ji.default)(this,"_x",void 0),(0,ji.default)(this,"_y",void 0),(0,ji.default)(this,"_width",void 0),(0,ji.default)(this,"_height",void 0),(0,ji.default)(this,"_padding",void 0),(0,ji.default)(this,"props",void 0);var e=r||{},n=e.id,i=e.x,a=i===void 0?0:i,o=e.y,s=o===void 0?0:o,u=e.width,l=u===void 0?"100%":u,f=e.height,c=f===void 0?"100%":f,p=e.padding,d=p===void 0?null:p,v=e.viewportInstance;rt(!v||v instanceof Ar),this.viewportInstance=v,this.id=n||this.constructor.displayName||"view",this.props=Gs(Gs({},r),{},{id:this.id}),this._x=Sa(a),this._y=Sa(s),this._width=Sa(l),this._height=Sa(c),this._padding=d&&{left:Sa(d.left||0),right:Sa(d.right||0),top:Sa(d.top||0),bottom:Sa(d.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}return(0,D6.default)(t,[{key:"equals",value:function(e){return this===e?!0:this.viewportInstance?e.viewportInstance?this.viewportInstance.equals(e.viewportInstance):!1:this.ViewportType===e.ViewportType&&Lt(this.props,e.props,2)}},{key:"makeViewport",value:function(e){var n=e.width,i=e.height,a=e.viewState;if(this.viewportInstance)return this.viewportInstance;a=this.filterViewState(a);var o=this.getDimensions({width:n,height:i});return!o.height||!o.width?null:new this.ViewportType(Gs(Gs(Gs({},a),this.props),o))}},{key:"getViewStateId",value:function(){var e=this.props.viewState;return typeof e=="string"?e:e?.id||this.id}},{key:"filterViewState",value:function(e){if(this.props.viewState&&(0,B6.default)(this.props.viewState)==="object"){if(!this.props.viewState.id)return this.props.viewState;var n=Gs({},e);for(var i in this.props.viewState)i!=="id"&&(n[i]=this.props.viewState[i]);return n}return e}},{key:"getDimensions",value:function(e){var n=e.width,i=e.height,a={x:Ta(this._x,n),y:Ta(this._y,i),width:Ta(this._width,n),height:Ta(this._height,i)};return this._padding&&(a.padding={left:Ta(this._padding.left,n),top:Ta(this._padding.top,i),right:Ta(this._padding.right,n),bottom:Ta(this._padding.bottom,i)}),a}},{key:"controller",get:function(){var e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:Gs({type:this.ControllerType},e):null}}]),t}();var cG=h(Ee()),ST=h(L()),TT=h(N()),Hp=h(be()),wT=h(Y()),pG=h(K()),Rg=h(q()),zl=h(B());var aG=h(L()),oG=h(N()),Pt=h(B());var z6=h(L()),V6=h(N()),wa=h(B());var N6=h(L()),j6=h(N()),Nl=h(B()),Ui=function(){function t(r){(0,N6.default)(this,t),(0,Nl.default)(this,"_inProgress",void 0),(0,Nl.default)(this,"_handle",void 0),(0,Nl.default)(this,"_timeline",void 0),(0,Nl.default)(this,"time",void 0),(0,Nl.default)(this,"settings",void 0),this._inProgress=!1,this._handle=null,this._timeline=r,this.time=0,this.settings={duration:0}}return(0,j6.default)(t,[{key:"inProgress",get:function(){return this._inProgress}},{key:"start",value:function(e){var n,i;this.cancel(),this.settings=e,this._inProgress=!0,(n=(i=this.settings).onStart)===null||n===void 0||n.call(i,this)}},{key:"end",value:function(){if(this._inProgress){var e,n;this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(e=(n=this.settings).onEnd)===null||e===void 0||e.call(n,this)}}},{key:"cancel",value:function(){if(this._inProgress){var e,n;(e=(n=this.settings).onInterrupt)===null||e===void 0||e.call(n,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1}}},{key:"update",value:function(){var e,n;if(!this._inProgress)return!1;if(this._handle===null){var i=this._timeline,a=this.settings;this._handle=i.addChannel({delay:i.getTime(),duration:a.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(e=(n=this.settings).onUpdate)===null||e===void 0||e.call(n,this),this._timeline.isFinished(this._handle)&&this.end(),!0}},{key:"_onUpdate",value:function(){}}]),t}();function U6(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Eg(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?U6(Object(e),!0).forEach(function(n){(0,wa.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):U6(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var G6=function(){},Vp={BREAK:1,SNAP_TO_END:2,IGNORE:3},s1e=function(r){return r},u1e=Vp.BREAK,H6=function(){function t(r){var e=this;(0,z6.default)(this,t),(0,wa.default)(this,"getControllerState",void 0),(0,wa.default)(this,"props",void 0),(0,wa.default)(this,"propsInTransition",void 0),(0,wa.default)(this,"transition",void 0),(0,wa.default)(this,"onViewStateChange",void 0),(0,wa.default)(this,"onStateChange",void 0),(0,wa.default)(this,"_onTransitionUpdate",function(n){var i=n.time,a=n.settings,o=a.interpolator,s=a.startProps,u=a.endProps,l=a.duration,f=a.easing,c=f(i/l),p=o.interpolateProps(s,u,c);e.propsInTransition=e.getControllerState(Eg(Eg({},e.props),p)).getViewportProps(),e.onViewStateChange({viewState:e.propsInTransition,oldViewState:e.props})}),this.getControllerState=r.getControllerState,this.propsInTransition=null,this.transition=new Ui(r.timeline),this.onViewStateChange=r.onViewStateChange||G6,this.onStateChange=r.onStateChange||G6}return(0,V6.default)(t,[{key:"finalize",value:function(){this.transition.cancel()}},{key:"getViewportInTransition",value:function(){return this.propsInTransition}},{key:"processViewStateChange",value:function(e){var n=!1,i=this.props;if(this.props=e,!i||this._shouldIgnoreViewportChange(i,e))return!1;if(this._isTransitionEnabled(e)){var a=i;if(this.transition.inProgress){var o=this.transition.settings,s=o.interruption,u=o.endProps;a=Eg(Eg({},i),s===Vp.SNAP_TO_END?u:this.propsInTransition||i)}this._triggerTransition(a,e),n=!0}else this.transition.cancel();return n}},{key:"updateTransition",value:function(){this.transition.update()}},{key:"_isTransitionEnabled",value:function(e){var n=e.transitionDuration,i=e.transitionInterpolator;return(n>0||n==="auto")&&Boolean(i)}},{key:"_isUpdateDueToCurrentTransition",value:function(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}},{key:"_shouldIgnoreViewportChange",value:function(e,n){return this.transition.inProgress?this.transition.settings.interruption===Vp.IGNORE||this._isUpdateDueToCurrentTransition(n):this._isTransitionEnabled(n)?n.transitionInterpolator.arePropsEqual(e,n):!0}},{key:"_triggerTransition",value:function(e,n){var i=this.getControllerState(e),a=this.getControllerState(n).shortestPathFrom(i),o=n.transitionInterpolator,s=o.getDuration?o.getDuration(e,n):n.transitionDuration;if(s!==0){var u=o.initializeProps(e,a);this.propsInTransition={};var l={duration:s,easing:n.transitionEasing||s1e,interpolator:o,interruption:n.transitionInterruption||u1e,startProps:u.start,endProps:u.end,onStart:n.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(n.onTransitionInterrupt),onEnd:this._onTransitionEnd(n.onTransitionEnd)};this.transition.start(l),this.onStateChange({inTransition:!0}),this.updateTransition()}}},{key:"_onTransitionEnd",value:function(e){var n=this;return function(i){n.propsInTransition=null,n.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e?.(i)}}}]),t}();var J6=h(L()),Q6=h(N()),eG=h(be()),tG=h(Ee()),rG=h(Y()),nG=h(K()),Mg=h(q()),xT=h(B());var X6=h(L()),q6=h(N()),Cg=h(B());function W6(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=l1e(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function l1e(t,r){if(t){if(typeof t=="string")return $6(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return $6(t,r)}}function $6(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var jl=function(){function t(r){(0,X6.default)(this,t),(0,Cg.default)(this,"_propsToCompare",void 0),(0,Cg.default)(this,"_propsToExtract",void 0),(0,Cg.default)(this,"_requiredProps",void 0);var e=r.compare,n=r.extract,i=r.required;this._propsToCompare=e,this._propsToExtract=n||e,this._requiredProps=i}return(0,q6.default)(t,[{key:"arePropsEqual",value:function(e,n){var i=W6(this._propsToCompare),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;if(!(o in e)||!(o in n)||!tt(e[o],n[o]))return!1}}catch(s){i.e(s)}finally{i.f()}return!0}},{key:"initializeProps",value:function(e,n){var i={},a={},o=W6(this._propsToExtract),s;try{for(o.s();!(s=o.n()).done;){var u=s.value;(u in e||u in n)&&(i[u]=e[u],a[u]=n[u])}}catch(l){o.e(l)}finally{o.f()}return this._checkRequiredProps(i),this._checkRequiredProps(a),{start:i,end:a}}},{key:"getDuration",value:function(e,n){return n.transitionDuration}},{key:"_checkRequiredProps",value:function(e){this._requiredProps&&this._requiredProps.forEach(function(n){var i=e[n];rt(Number.isFinite(i)||Array.isArray(i),"".concat(n," is required for transition"))})}}]),t}();function Y6(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function K6(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Y6(Object(e),!0).forEach(function(n){(0,xT.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Y6(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function f1e(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=c1e(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function c1e(t,r){if(t){if(typeof t=="string")return Z6(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Z6(t,r)}}function Z6(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function p1e(t){var r=h1e();return function(){var n=(0,Mg.default)(t),i;if(r){var a=(0,Mg.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,nG.default)(this,i)}}function h1e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var d1e=["longitude","latitude","zoom","bearing","pitch"],v1e=["longitude","latitude","zoom"],Zr=function(t){(0,rG.default)(e,t);var r=p1e(e);function e(){var n,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,J6.default)(this,e);var a=Array.isArray(i)?i:i.transitionProps,o=Array.isArray(i)?{}:i;return o.transitionProps=Array.isArray(a)?{compare:a,required:a}:a||{compare:d1e,required:v1e},n=r.call(this,o.transitionProps),(0,xT.default)((0,eG.default)(n),"opts",void 0),n.opts=o,n}return(0,Q6.default)(e,[{key:"initializeProps",value:function(i,a){var o=(0,tG.default)((0,Mg.default)(e.prototype),"initializeProps",this).call(this,i,a),s=this.opts,u=s.makeViewport,l=s.around;if(u&&l){var f=u(i),c=u(a),p=f.unproject(l);o.start.around=l,Object.assign(o.end,{around:c.project(p),aroundPosition:p,width:a.width,height:a.height})}return o}},{key:"interpolateProps",value:function(i,a,o){var s={},u=f1e(this._propsToExtract),l;try{for(u.s();!(l=u.n()).done;){var f=l.value;s[f]=sr(i[f]||0,a[f]||0,o)}}catch(p){u.e(p)}finally{u.f()}if(a.aroundPosition&&this.opts.makeViewport){var c=this.opts.makeViewport(K6(K6({},a),s));Object.assign(s,c.panByPosition(a.aroundPosition,sr(i.around,a.around,o)))}return s}}]),e}(jl);function iG(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function kt(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?iG(Object(e),!0).forEach(function(n){(0,Pt.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):iG(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var wo={transitionDuration:0},m1e=300,Ig=function(r){return 1-(1-r)*(1-r)},Ul={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},zs={},Ln=function(){function t(r){var e=this;(0,aG.default)(this,t),(0,Pt.default)(this,"props",void 0),(0,Pt.default)(this,"state",{}),(0,Pt.default)(this,"transitionManager",void 0),(0,Pt.default)(this,"eventManager",void 0),(0,Pt.default)(this,"onViewStateChange",void 0),(0,Pt.default)(this,"onStateChange",void 0),(0,Pt.default)(this,"makeViewport",void 0),(0,Pt.default)(this,"_controllerState",void 0),(0,Pt.default)(this,"_events",{}),(0,Pt.default)(this,"_interactionState",{isDragging:!1}),(0,Pt.default)(this,"_customEvents",[]),(0,Pt.default)(this,"_eventStartBlocked",null),(0,Pt.default)(this,"_panMove",!1),(0,Pt.default)(this,"invertPan",!1),(0,Pt.default)(this,"dragMode","rotate"),(0,Pt.default)(this,"inertia",0),(0,Pt.default)(this,"scrollZoom",!0),(0,Pt.default)(this,"dragPan",!0),(0,Pt.default)(this,"dragRotate",!0),(0,Pt.default)(this,"doubleClickZoom",!0),(0,Pt.default)(this,"touchZoom",!0),(0,Pt.default)(this,"touchRotate",!1),(0,Pt.default)(this,"keyboard",!0),this.transitionManager=new H6(kt(kt({},r),{},{getControllerState:function(i){return new e.ControllerState(i)},onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)})),this.handleEvent=this.handleEvent.bind(this),this.eventManager=r.eventManager,this.onViewStateChange=r.onViewStateChange||function(){},this.onStateChange=r.onStateChange||function(){},this.makeViewport=r.makeViewport}return(0,oG.default)(t,[{key:"events",set:function(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}},{key:"finalize",value:function(){for(var e in this._events)if(this._events[e]){var n;(n=this.eventManager)===null||n===void 0||n.off(e,this.handleEvent)}this.transitionManager.finalize()}},{key:"handleEvent",value:function(e){this._controllerState=void 0;var n=this._eventStartBlocked;switch(e.type){case"panstart":return n?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return n?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return n?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}},{key:"controllerState",get:function(){return this._controllerState=this._controllerState||new this.ControllerState(kt(kt({makeViewport:this.makeViewport},this.props),this.state)),this._controllerState}},{key:"getCenter",value:function(e){var n=this.props,i=n.x,a=n.y,o=e.offsetCenter;return[o.x-i,o.y-a]}},{key:"isPointInBounds",value:function(e,n){var i=this.props,a=i.width,o=i.height;if(n&&n.handled)return!1;var s=e[0]>=0&&e[0]<=a&&e[1]>=0&&e[1]<=o;return s&&n&&n.stopPropagation(),s}},{key:"isFunctionKeyPressed",value:function(e){var n=e.srcEvent;return Boolean(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}},{key:"isDragging",value:function(){return this._interactionState.isDragging||!1}},{key:"blockEvents",value:function(e){var n=this,i=setTimeout(function(){n._eventStartBlocked===i&&(n._eventStartBlocked=null)},e);this._eventStartBlocked=i}},{key:"setProps",value:function(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);var n=e.inertia;this.inertia=Number.isFinite(n)?n:n===!0?m1e:0;var i=e.scrollZoom,a=i===void 0?!0:i,o=e.dragPan,s=o===void 0?!0:o,u=e.dragRotate,l=u===void 0?!0:u,f=e.doubleClickZoom,c=f===void 0?!0:f,p=e.touchZoom,d=p===void 0?!0:p,v=e.touchRotate,m=v===void 0?!1:v,g=e.keyboard,y=g===void 0?!0:g,_=Boolean(this.onViewStateChange);this.toggleEvents(Ul.WHEEL,_&&a),this.toggleEvents(Ul.PAN,_),this.toggleEvents(Ul.PINCH,_&&(d||m)),this.toggleEvents(Ul.TRIPLE_PAN,_&&m),this.toggleEvents(Ul.DOUBLE_TAP,_&&c),this.toggleEvents(Ul.KEYBOARD,_&&y),this.scrollZoom=a,this.dragPan=s,this.dragRotate=l,this.doubleClickZoom=c,this.touchZoom=d,this.touchRotate=m,this.keyboard=y}},{key:"updateTransition",value:function(){this.transitionManager.updateTransition()}},{key:"toggleEvents",value:function(e,n){var i=this;this.eventManager&&e.forEach(function(a){i._events[a]!==n&&(i._events[a]=n,n?i.eventManager.on(a,i.handleEvent):i.eventManager.off(a,i.handleEvent))})}},{key:"updateViewport",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=kt(kt({},e.getViewportProps()),n),o=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(i),o){var s=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:a,interactionState:this._interactionState,oldViewState:s})}}},{key:"_onTransition",value:function(e){this.onViewStateChange(kt(kt({},e),{},{interactionState:this._interactionState}))}},{key:"_setInteractionState",value:function(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}},{key:"_onPanStart",value:function(e){var n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;var i=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(i=!i);var a=this.controllerState[i?"panStart":"rotateStart"]({pos:n});return this._panMove=i,this.updateViewport(a,wo,{isDragging:!0}),!0}},{key:"_onPan",value:function(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}},{key:"_onPanEnd",value:function(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}},{key:"_onPanMove",value:function(e){if(!this.dragPan)return!1;var n=this.getCenter(e),i=this.controllerState.pan({pos:n});return this.updateViewport(i,wo,{isDragging:!0,isPanning:!0}),!0}},{key:"_onPanMoveEnd",value:function(e){var n=this.inertia;if(this.dragPan&&n&&e.velocity){var i=this.getCenter(e),a=[i[0]+e.velocityX*n/2,i[1]+e.velocityY*n/2],o=this.controllerState.pan({pos:a}).panEnd();this.updateViewport(o,kt(kt({},this._getTransitionProps()),{},{transitionDuration:n,transitionEasing:Ig}),{isDragging:!1,isPanning:!0})}else{var s=this.controllerState.panEnd();this.updateViewport(s,null,{isDragging:!1,isPanning:!1})}return!0}},{key:"_onPanRotate",value:function(e){if(!this.dragRotate)return!1;var n=this.getCenter(e),i=this.controllerState.rotate({pos:n});return this.updateViewport(i,wo,{isDragging:!0,isRotating:!0}),!0}},{key:"_onPanRotateEnd",value:function(e){var n=this.inertia;if(this.dragRotate&&n&&e.velocity){var i=this.getCenter(e),a=[i[0]+e.velocityX*n/2,i[1]+e.velocityY*n/2],o=this.controllerState.rotate({pos:a}).rotateEnd();this.updateViewport(o,kt(kt({},this._getTransitionProps()),{},{transitionDuration:n,transitionEasing:Ig}),{isDragging:!1,isRotating:!0})}else{var s=this.controllerState.rotateEnd();this.updateViewport(s,null,{isDragging:!1,isRotating:!1})}return!0}},{key:"_onWheel",value:function(e){if(!this.scrollZoom)return!1;e.srcEvent.preventDefault();var n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;var i=this.scrollZoom===!0?{}:this.scrollZoom,a=i.speed,o=a===void 0?.01:a,s=i.smooth,u=s===void 0?!1:s,l=e.delta,f=2/(1+Math.exp(-Math.abs(l*o)));l<0&&f!==0&&(f=1/f);var c=this.controllerState.zoom({pos:n,scale:f});return this.updateViewport(c,kt(kt({},this._getTransitionProps({around:n})),{},{transitionDuration:u?250:1}),{isZooming:!0,isPanning:!0}),!0}},{key:"_onTriplePanStart",value:function(e){var n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;var i=this.controllerState.rotateStart({pos:n});return this.updateViewport(i,wo,{isDragging:!0}),!0}},{key:"_onTriplePan",value:function(e){if(!this.touchRotate||!this.isDragging())return!1;var n=this.getCenter(e);n[0]-=e.deltaX;var i=this.controllerState.rotate({pos:n});return this.updateViewport(i,wo,{isDragging:!0,isRotating:!0}),!0}},{key:"_onTriplePanEnd",value:function(e){if(!this.isDragging())return!1;var n=this.inertia;if(this.touchRotate&&n&&e.velocityY){var i=this.getCenter(e),a=[i[0],i[1]+=e.velocityY*n/2],o=this.controllerState.rotate({pos:a});this.updateViewport(o,kt(kt({},this._getTransitionProps()),{},{transitionDuration:n,transitionEasing:Ig}),{isDragging:!1,isRotating:!0}),this.blockEvents(n)}else{var s=this.controllerState.rotateEnd();this.updateViewport(s,null,{isDragging:!1,isRotating:!1})}return!0}},{key:"_onPinchStart",value:function(e){var n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;var i=this.controllerState.zoomStart({pos:n}).rotateStart({pos:n});return zs._startPinchRotation=e.rotation,zs._lastPinchEvent=e,this.updateViewport(i,wo,{isDragging:!0}),!0}},{key:"_onPinch",value:function(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;var n=this.controllerState;if(this.touchZoom){var i=e.scale,a=this.getCenter(e);n=n.zoom({pos:a,scale:i})}if(this.touchRotate){var o=e.rotation;n=n.rotate({deltaAngleX:zs._startPinchRotation-o})}return this.updateViewport(n,wo,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),zs._lastPinchEvent=e,!0}},{key:"_onPinchEnd",value:function(e){if(!this.isDragging())return!1;var n=this.inertia,i=zs._lastPinchEvent;if(this.touchZoom&&n&&i&&e.scale!==i.scale){var a=this.getCenter(e),o=this.controllerState.rotateEnd(),s=Math.log2(e.scale),u=(s-Math.log2(i.scale))/(e.deltaTime-i.deltaTime),l=Math.pow(2,s+u*n/2);o=o.zoom({pos:a,scale:l}).zoomEnd(),this.updateViewport(o,kt(kt({},this._getTransitionProps({around:a})),{},{transitionDuration:n,transitionEasing:Ig}),{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(n)}else{var f=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(f,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return zs._startPinchRotation=null,zs._lastPinchEvent=null,!0}},{key:"_onDoubleTap",value:function(e){if(!this.doubleClickZoom)return!1;var n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;var i=this.isFunctionKeyPressed(e),a=this.controllerState.zoom({pos:n,scale:i?.5:2});return this.updateViewport(a,this._getTransitionProps({around:n}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}},{key:"_onKeyDown",value:function(e){if(!this.keyboard)return!1;var n=this.isFunctionKeyPressed(e),i=this.keyboard===!0?{}:this.keyboard,a=i.zoomSpeed,o=i.moveSpeed,s=i.rotateSpeedX,u=i.rotateSpeedY,l=this.controllerState,f,c={};switch(e.srcEvent.code){case"Minus":f=n?l.zoomOut(a).zoomOut(a):l.zoomOut(a),c.isZooming=!0;break;case"Equal":f=n?l.zoomIn(a).zoomIn(a):l.zoomIn(a),c.isZooming=!0;break;case"ArrowLeft":n?(f=l.rotateLeft(s),c.isRotating=!0):(f=l.moveLeft(o),c.isPanning=!0);break;case"ArrowRight":n?(f=l.rotateRight(s),c.isRotating=!0):(f=l.moveRight(o),c.isPanning=!0);break;case"ArrowUp":n?(f=l.rotateUp(u),c.isRotating=!0):(f=l.moveUp(o),c.isPanning=!0);break;case"ArrowDown":n?(f=l.rotateDown(u),c.isRotating=!0):(f=l.moveDown(o),c.isPanning=!0);break;default:return!1}return this.updateViewport(f,this._getTransitionProps(),c),!0}},{key:"_getTransitionProps",value:function(e){var n=this.transition;return!n||!n.transitionInterpolator?wo:e?kt(kt({},n),{},{transitionInterpolator:new Zr(kt(kt(kt({},e),n.transitionInterpolator.opts),{},{makeViewport:this.controllerState.makeViewport}))}):n}}]),t}();var sG=h(L()),uG=h(N()),AT=h(B()),Gl=function(){function t(r,e){(0,sG.default)(this,t),(0,AT.default)(this,"_viewportProps",void 0),(0,AT.default)(this,"_state",void 0),this._viewportProps=this.applyConstraints(r),this._state=e}return(0,uG.default)(t,[{key:"getViewportProps",value:function(){return this._viewportProps}},{key:"getState",value:function(){return this._state}}]),t}();function lG(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Pa(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?lG(Object(e),!0).forEach(function(n){(0,zl.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):lG(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function hG(t){var r=g1e();return function(){var n=(0,Rg.default)(t),i;if(r){var a=(0,Rg.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,pG.default)(this,i)}}function g1e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var fG=5,y1e=1.2,PT=function(t){(0,wT.default)(e,t);var r=hG(e);function e(n){var i;(0,ST.default)(this,e);var a=n.width,o=n.height,s=n.latitude,u=n.longitude,l=n.zoom,f=n.bearing,c=f===void 0?0:f,p=n.pitch,d=p===void 0?0:p,v=n.altitude,m=v===void 0?1.5:v,g=n.position,y=g===void 0?[0,0,0]:g,_=n.maxZoom,b=_===void 0?20:_,x=n.minZoom,A=x===void 0?0:x,S=n.maxPitch,P=S===void 0?60:S,O=n.minPitch,C=O===void 0?0:O,T=n.startPanLngLat,I=n.startZoomLngLat,R=n.startRotatePos,V=n.startBearing,z=n.startPitch,k=n.startZoom,G=n.normalize,U=G===void 0?!0:G;return rt(Number.isFinite(u)),rt(Number.isFinite(s)),rt(Number.isFinite(l)),i=r.call(this,{width:a,height:o,latitude:s,longitude:u,zoom:l,bearing:c,pitch:d,altitude:m,maxZoom:b,minZoom:A,maxPitch:P,minPitch:C,normalize:U,position:y},{startPanLngLat:T,startZoomLngLat:I,startRotatePos:R,startBearing:V,startPitch:z,startZoom:k}),(0,zl.default)((0,Hp.default)(i),"makeViewport",void 0),i.makeViewport=n.makeViewport,i}return(0,TT.default)(e,[{key:"panStart",value:function(i){var a=i.pos;return this._getUpdatedState({startPanLngLat:this._unproject(a)})}},{key:"pan",value:function(i){var a=i.pos,o=i.startPos,s=this.getState().startPanLngLat||this._unproject(o);if(!s)return this;var u=this.makeViewport(this.getViewportProps()),l=u.panByPosition(s,a);return this._getUpdatedState(l)}},{key:"panEnd",value:function(){return this._getUpdatedState({startPanLngLat:null})}},{key:"rotateStart",value:function(i){var a=i.pos;return this._getUpdatedState({startRotatePos:a,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}},{key:"rotate",value:function(i){var a=i.pos,o=i.deltaAngleX,s=o===void 0?0:o,u=i.deltaAngleY,l=u===void 0?0:u,f=this.getState(),c=f.startRotatePos,p=f.startBearing,d=f.startPitch;if(!c||p===void 0||d===void 0)return this;var v;return a?v=this._getNewRotation(a,c,d,p):v={bearing:p+s,pitch:d+l},this._getUpdatedState(v)}},{key:"rotateEnd",value:function(){return this._getUpdatedState({startBearing:null,startPitch:null})}},{key:"zoomStart",value:function(i){var a=i.pos;return this._getUpdatedState({startZoomLngLat:this._unproject(a),startZoom:this.getViewportProps().zoom})}},{key:"zoom",value:function(i){var a=i.pos,o=i.startPos,s=i.scale,u=this.getState(),l=u.startZoom,f=u.startZoomLngLat;if(f||(l=this.getViewportProps().zoom,f=this._unproject(o)||this._unproject(a)),!f)return this;var c=this.getViewportProps(),p=c.maxZoom,d=c.minZoom,v=l+Math.log2(s);v=We(v,d,p);var m=this.makeViewport(Pa(Pa({},this.getViewportProps()),{},{zoom:v}));return this._getUpdatedState(Pa({zoom:v},m.panByPosition(f,a)))}},{key:"zoomEnd",value:function(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}},{key:"zoomIn",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this._zoomFromCenter(i)}},{key:"zoomOut",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this._zoomFromCenter(1/i)}},{key:"moveLeft",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([i,0])}},{key:"moveRight",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([-i,0])}},{key:"moveUp",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([0,i])}},{key:"moveDown",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([0,-i])}},{key:"rotateLeft",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({bearing:this.getViewportProps().bearing-i})}},{key:"rotateRight",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({bearing:this.getViewportProps().bearing+i})}},{key:"rotateUp",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({pitch:this.getViewportProps().pitch+i})}},{key:"rotateDown",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({pitch:this.getViewportProps().pitch-i})}},{key:"shortestPathFrom",value:function(i){var a=i.getViewportProps(),o=Pa({},this.getViewportProps()),s=o.bearing,u=o.longitude;return Math.abs(s-a.bearing)>180&&(o.bearing=s<0?s+360:s-360),Math.abs(u-a.longitude)>180&&(o.longitude=u<0?u+360:u-360),o}},{key:"applyConstraints",value:function(i){var a=i.maxZoom,o=i.minZoom,s=i.zoom;i.zoom=We(s,o,a);var u=i.maxPitch,l=i.minPitch,f=i.pitch;i.pitch=We(f,l,u);var c=i.normalize,p=c===void 0?!0:c;return p&&Object.assign(i,pg(i)),i}},{key:"_zoomFromCenter",value:function(i){var a=this.getViewportProps(),o=a.width,s=a.height;return this.zoom({pos:[o/2,s/2],scale:i})}},{key:"_panFromCenter",value:function(i){var a=this.getViewportProps(),o=a.width,s=a.height;return this.pan({startPos:[o/2,s/2],pos:[o/2+i[0],s/2+i[1]]})}},{key:"_getUpdatedState",value:function(i){return new this.constructor(Pa(Pa(Pa({makeViewport:this.makeViewport},this.getViewportProps()),this.getState()),i))}},{key:"_unproject",value:function(i){var a=this.makeViewport(this.getViewportProps());return i&&a.unproject(i)}},{key:"_getNewRotation",value:function(i,a,o,s){var u=i[0]-a[0],l=i[1]-a[1],f=i[1],c=a[1],p=this.getViewportProps(),d=p.width,v=p.height,m=u/d,g=0;l>0?Math.abs(v-c)>fG&&(g=l/(c-v)*y1e):l<0&&c>fG&&(g=1-f/c),g=We(g,-1,1);var y=this.getViewportProps(),_=y.minPitch,b=y.maxPitch,x=s+180*m,A=o;return g>0?A=o+g*(b-o):g<0&&(A=o-g*(_-o)),{pitch:A,bearing:x}}}]),e}(Gl),Lg=function(t){(0,wT.default)(e,t);var r=hG(e);function e(){var n;(0,ST.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,zl.default)((0,Hp.default)(n),"ControllerState",PT),(0,zl.default)((0,Hp.default)(n),"transition",{transitionDuration:300,transitionInterpolator:new Zr({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})}),(0,zl.default)((0,Hp.default)(n),"dragMode","pan"),n}return(0,TT.default)(e,[{key:"setProps",value:function(i){i.position=i.position||[0,0,0];var a=this.props;(0,cG.default)((0,Rg.default)(e.prototype),"setProps",this).call(this,i);var o=!a||a.height!==i.height;o&&this.updateViewport(new this.ControllerState(Pa(Pa({makeViewport:this.makeViewport},i),this.state)))}}]),e}(Ln);function _1e(t){var r=b1e();return function(){var n=(0,OT.default)(t),i;if(r){var a=(0,OT.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gG.default)(this,i)}}function b1e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Vs=function(t){(0,mG.default)(e,t);var r=_1e(e);function e(){return(0,dG.default)(this,e),r.apply(this,arguments)}return(0,vG.default)(e,[{key:"ViewportType",get:function(){return Kr}},{key:"ControllerType",get:function(){return Lg}}]),e}(Rn);(0,yG.default)(Vs,"displayName","MapView");var bG=h(L()),xG=h(N()),Wp=h(B());function ET(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=x1e(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function x1e(t,r){if(t){if(typeof t=="string")return _G(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return _G(t,r)}}function _G(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var A1e=new Fp;function S1e(t,r){var e,n,i=(e=t.order)!==null&&e!==void 0?e:1/0,a=(n=r.order)!==null&&n!==void 0?n:1/0;return i-a}var AG=function(){function t(){(0,bG.default)(this,t),(0,Wp.default)(this,"effects",void 0),(0,Wp.default)(this,"_resolvedEffects",[]),(0,Wp.default)(this,"_defaultEffects",[]),(0,Wp.default)(this,"_needsRedraw",void 0),this.effects=[],this._needsRedraw="Initial render",this._setEffects([])}return(0,xG.default)(t,[{key:"addDefaultEffect",value:function(e){var n=this._defaultEffects;if(!n.find(function(a){return a.id===e.id})){var i=n.findIndex(function(a){return S1e(a,e)>0});i<0?n.push(e):n.splice(i,0,e),this._setEffects(this.effects)}}},{key:"setProps",value:function(e){"effects"in e&&(Lt(e.effects,this.effects,1)||this._setEffects(e.effects))}},{key:"needsRedraw",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1},n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}},{key:"getEffects",value:function(){return this._resolvedEffects}},{key:"_setEffects",value:function(e){var n={},i=ET(this.effects),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;n[o.id]=o}}catch(d){i.e(d)}finally{i.f()}var s=[],u=ET(e),l;try{for(u.s();!(l=u.n()).done;){var f=l.value,c=n[f.id];c&&c!==f?c.setProps?(c.setProps(f.props),s.push(c)):(c.cleanup(),s.push(f)):s.push(f),delete n[f.id]}}catch(d){u.e(d)}finally{u.f()}for(var p in n)n[p].cleanup();this.effects=s,this._resolvedEffects=s.concat(this._defaultEffects),e.some(function(d){return d instanceof Fp})||this._resolvedEffects.push(A1e),this._needsRedraw="effects changed"}},{key:"finalize",value:function(){var e=ET(this._resolvedEffects),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;i.cleanup()}}catch(a){e.e(a)}finally{e.f()}this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}]),t}();var MG=h(L()),IG=h(N()),fi=h(B());var SG=h(L()),TG=h(N()),wG=h(Y()),PG=h(K()),CT=h(q());function T1e(t){var r=w1e();return function(){var n=(0,CT.default)(t),i;if(r){var a=(0,CT.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,PG.default)(this,i)}}function w1e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var OG=function(t){(0,wG.default)(e,t);var r=T1e(e);function e(){return(0,SG.default)(this,e),r.apply(this,arguments)}return(0,TG.default)(e,[{key:"shouldDrawLayer",value:function(i){var a=i.props.operation;return a.includes("draw")||a.includes("terrain")}}]),e}(Xr);function kg(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=P1e(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function P1e(t,r){if(t){if(typeof t=="string")return EG(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return EG(t,r)}}function EG(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function CG(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Vl(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?CG(Object(e),!0).forEach(function(n){(0,fi.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):CG(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var O1e="deckRenderer.renderLayers",Bg=function(){function t(r){(0,MG.default)(this,t),(0,fi.default)(this,"gl",void 0),(0,fi.default)(this,"layerFilter",void 0),(0,fi.default)(this,"drawPickingColors",void 0),(0,fi.default)(this,"drawLayersPass",void 0),(0,fi.default)(this,"pickLayersPass",void 0),(0,fi.default)(this,"renderCount",void 0),(0,fi.default)(this,"_needsRedraw",void 0),(0,fi.default)(this,"renderBuffers",void 0),(0,fi.default)(this,"lastPostProcessEffect",void 0),this.gl=r,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new OG(r),this.pickLayersPass=new So(r),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}return(0,IG.default)(t,[{key:"setProps",value:function(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}},{key:"renderLayers",value:function(e){var n=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,i=Vl(Vl({layerFilter:this.layerFilter,isPicking:this.drawPickingColors},e),{},{target:e.target||Re.getDefaultFramebuffer(this.gl)});i.effects&&this._preRender(i.effects,i);var a=this.lastPostProcessEffect?this.renderBuffers[0]:i.target,o=n.render(Vl(Vl({},i),{},{target:a}));i.effects&&this._postRender(i.effects,i),this.renderCount++,Nt(O1e,this,o,e)}},{key:"needsRedraw",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1},n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}},{key:"finalize",value:function(){var e=this.renderBuffers,n=kg(e),i;try{for(n.s();!(i=n.n()).done;){var a=i.value;a.delete()}}catch(o){n.e(o)}finally{n.f()}e.length=0}},{key:"_preRender",value:function(e,n){this.lastPostProcessEffect=null,n.preRenderStats=n.preRenderStats||{};var i=kg(e),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;n.preRenderStats[o.id]=o.preRender(this.gl,n),o.postRender&&(this.lastPostProcessEffect=o.id)}}catch(s){i.e(s)}finally{i.f()}this.lastPostProcessEffect&&this._resizeRenderBuffers()}},{key:"_resizeRenderBuffers",value:function(){var e=this.renderBuffers;e.length===0&&e.push(new Re(this.gl),new Re(this.gl));var n=kg(e),i;try{for(n.s();!(i=n.n()).done;){var a=i.value;a.resize()}}catch(o){n.e(o)}finally{n.f()}}},{key:"_postRender",value:function(e,n){var i=this.renderBuffers,a=Vl(Vl({},n),{},{inputBuffer:i[0],swapBuffer:i[1],target:null}),o=kg(e),s;try{for(o.s();!(s=o.n()).done;){var u=s.value;if(u.postRender){if(u.id===this.lastPostProcessEffect){a.target=n.target,u.postRender(this.gl,a);break}var l=u.postRender(this.gl,a);a.inputBuffer=l,a.swapBuffer=l===i[0]?i[1]:i[0]}}}catch(f){o.e(f)}finally{o.f()}}}]),t}();var GG=h(L()),zG=h(N()),Gi=h(B());var LG=h(B());function RG(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Fg(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?RG(Object(e),!0).forEach(function(n){(0,LG.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):RG(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var E1e={pickedColor:null,pickedObjectIndex:-1};function kG(t){for(var r=t.pickedColors,e=t.decodePickingColor,n=t.deviceX,i=t.deviceY,a=t.deviceRadius,o=t.deviceRect,s=o.x,u=o.y,l=o.width,f=o.height,c=a*a,p=-1,d=0,v=0;v<f;v++){var m=v+u-i,g=m*m;if(g>c)d+=4*l;else for(var y=0;y<l;y++){var _=r[d+3]-1;if(_>=0){var b=y+s-n,x=b*b+g;x<=c&&(c=x,p=d)}d+=4}}if(p>=0){var A=r.slice(p,p+4),S=e(A);if(S){var P=Math.floor(p/4/l),O=p/4-P*l;return Fg(Fg({},S),{},{pickedColor:A,pickedX:s+O,pickedY:u+P})}J.error("Picked non-existent layer. Is picking buffer corrupt?")()}return E1e}function BG(t){var r=t.pickedColors,e=t.decodePickingColor,n=new Map;if(r)for(var i=0;i<r.length;i+=4){var a=r[i+3]-1;if(a>=0){var o=r.slice(i,i+4),s=o.join(",");if(!n.has(s)){var u=e(o);u?n.set(s,Fg(Fg({},u),{},{color:o})):J.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}var DG=h(B());function FG(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function C1e(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?FG(Object(e),!0).forEach(function(n){(0,DG.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):FG(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function MT(t){var r=t.pickInfo,e=t.viewports,n=t.pixelRatio,i=t.x,a=t.y,o=t.z,s=e[0];e.length>1&&(s=M1e(r?.pickedViewports||e,{x:i,y:a}));var u;if(s){var l=[i-s.x,a-s.y];o!==void 0&&(l[2]=o),u=s.unproject(l)}return{color:null,layer:null,viewport:s,index:-1,picked:!1,x:i,y:a,pixel:[i,a],coordinate:u,devicePixel:r&&"pickedX"in r?[r.pickedX,r.pickedY]:void 0,pixelRatio:n}}function NG(t){var r=t.pickInfo,e=t.lastPickedInfo,n=t.mode,i=t.layers,a=r.pickedColor,o=r.pickedLayer,s=r.pickedObjectIndex,u=o?[o]:[];if(n==="hover"){var l=e.index,f=e.layerId,c=o?o.props.id:null;if(c!==f||s!==l){if(c!==f){var p=i.find(function(m){return m.props.id===f});p&&u.unshift(p)}e.layerId=c,e.index=s,e.info=null}}var d=MT(t),v=new Map;return v.set(null,d),u.forEach(function(m){var g=C1e({},d);m===o&&(g.color=a,g.index=s,g.picked=!0),g=IT({layer:m,info:g,mode:n});var y=g.layer;m===o&&n==="hover"&&(e.info=g),v.set(y.id,g),n==="hover"&&y.updateAutoHighlight(g)}),v}function IT(t){for(var r=t.layer,e=t.info,n=t.mode;r&&e;){var i=e.layer||null;e.sourceLayer=i,e.layer=r,e=r.getPickingInfo({info:e,mode:n,sourceLayer:i}),r=r.parent}return e}function M1e(t,r){for(var e=t.length-1;e>=0;e--){var n=t[e];if(n.containsPixel(r))return n}return t[0]}function RT(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=I1e(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function I1e(t,r){if(t){if(typeof t=="string")return jG(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return jG(t,r)}}function jG(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function UG(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Dg(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?UG(Object(e),!0).forEach(function(n){(0,Gi.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):UG(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var VG=function(){function t(r){(0,GG.default)(this,t),(0,Gi.default)(this,"gl",void 0),(0,Gi.default)(this,"pickingFBO",void 0),(0,Gi.default)(this,"depthFBO",void 0),(0,Gi.default)(this,"pickLayersPass",void 0),(0,Gi.default)(this,"layerFilter",void 0),(0,Gi.default)(this,"lastPickedInfo",void 0),(0,Gi.default)(this,"_pickable",!0),this.gl=r,this.pickLayersPass=new So(r),this.lastPickedInfo={index:-1,layerId:null,info:null}}return(0,zG.default)(t,[{key:"setProps",value:function(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}},{key:"finalize",value:function(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}},{key:"pickObject",value:function(e){return this._pickClosestObject(e)}},{key:"pickObjects",value:function(e){return this._pickVisibleObjects(e)}},{key:"getLastPickedObject",value:function(e){var n=e.x,i=e.y,a=e.layers,o=e.viewports,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.lastPickedInfo.info,u=s&&s.layer&&s.layer.id,l=s&&s.viewport&&s.viewport.id,f=u?a.find(function(v){return v.id===u}):null,c=l&&o.find(function(v){return v.id===l})||o[0],p=c&&c.unproject([n-c.x,i-c.y]),d={x:n,y:i,viewport:c,coordinate:p,layer:f};return Dg(Dg({},s),d)}},{key:"_resizeBuffer",value:function(){var e,n,i=this.gl;if(!this.pickingFBO&&(this.pickingFBO=new Re(i),Re.isSupported(i,{colorBufferFloat:!0}))){var a=new Re(i);a.attach((0,Gi.default)({},36064,new we(i,{format:ce(i)?34836:6408,type:5126}))),this.depthFBO=a}(e=this.pickingFBO)===null||e===void 0||e.resize({width:i.canvas.width,height:i.canvas.height}),(n=this.depthFBO)===null||n===void 0||n.resize({width:i.canvas.width,height:i.canvas.height})}},{key:"_getPickable",value:function(e){var n=this;if(this._pickable===!1)return null;var i=e.filter(function(a){return n.pickLayersPass.shouldDrawLayer(a)&&!a.isComposite});return i.length?i:null}},{key:"_pickClosestObject",value:function(e){var n=e.layers,i=e.views,a=e.viewports,o=e.x,s=e.y,u=e.radius,l=u===void 0?0:u,f=e.depth,c=f===void 0?1:f,p=e.mode,d=p===void 0?"query":p,v=e.unproject3D,m=e.onViewportActive,g=e.effects,y=this._getPickable(n),_=_r(this.gl);if(!y)return{result:[],emptyInfo:MT({viewports:a,x:o,y:s,pixelRatio:_})};this._resizeBuffer();for(var b=nl(this.gl,[o,s],!0),x=[b.x+Math.floor(b.width/2),b.y+Math.floor(b.height/2)],A=Math.round(l*_),S=this.pickingFBO,P=S.width,O=S.height,C=this._getPickingRect({deviceX:x[0],deviceY:x[1],deviceRadius:A,deviceWidth:P,deviceHeight:O}),T={x:o-l,y:s-l,width:l*2+1,height:l*2+1},I,R=[],V=new Set,z=0;z<c;z++){var k=void 0;if(C){var G=this._drawAndSample({layers:y,views:i,viewports:a,onViewportActive:m,deviceRect:C,cullRect:T,effects:g,pass:"picking:".concat(d)});k=kG(Dg(Dg({},G),{},{deviceX:x[0],deviceY:x[1],deviceRadius:A,deviceRect:C}))}else k={pickedColor:null,pickedObjectIndex:-1};var U=void 0;if(k.pickedLayer&&v&&this.depthFBO){var $=this._drawAndSample({layers:[k.pickedLayer],views:i,viewports:a,onViewportActive:m,deviceRect:{x:k.pickedX,y:k.pickedY,width:1,height:1},cullRect:T,effects:g,pass:"picking:".concat(d,":z")},!0),H=$.pickedColors;H[3]&&(U=H[0])}k.pickedLayer&&z+1<c&&(V.add(k.pickedLayer),k.pickedLayer.disablePickingIndex(k.pickedObjectIndex)),I=NG({pickInfo:k,lastPickedInfo:this.lastPickedInfo,mode:d,layers:y,viewports:a,x:o,y:s,z:U,pixelRatio:_});var Q=RT(I.values()),ie;try{for(Q.s();!(ie=Q.n()).done;){var fe=ie.value;fe.layer&&R.push(fe)}}catch(ge){Q.e(ge)}finally{Q.f()}if(!k.pickedColor)break}var Ae=RT(V),Oe;try{for(Ae.s();!(Oe=Ae.n()).done;){var Xe=Oe.value;Xe.restorePickingColors()}}catch(ge){Ae.e(ge)}finally{Ae.f()}return{result:R,emptyInfo:I.get(null)}}},{key:"_pickVisibleObjects",value:function(e){var n=e.layers,i=e.views,a=e.viewports,o=e.x,s=e.y,u=e.width,l=u===void 0?1:u,f=e.height,c=f===void 0?1:f,p=e.mode,d=p===void 0?"query":p,v=e.maxObjects,m=v===void 0?null:v,g=e.onViewportActive,y=e.effects,_=this._getPickable(n);if(!_)return[];this._resizeBuffer();for(var b=_r(this.gl),x=nl(this.gl,[o,s],!0),A=x.x,S=x.y+x.height,P=nl(this.gl,[o+l,s+c],!0),O=P.x+P.width,C=P.y,T={x:A,y:C,width:O-A,height:S-C},I=this._drawAndSample({layers:_,views:i,viewports:a,onViewportActive:g,deviceRect:T,cullRect:{x:o,y:s,width:l,height:c},effects:y,pass:"picking:".concat(d)}),R=BG(I),V=new Map,z=Number.isFinite(m),k=0;k<R.length&&!(z&&m&&V.size>=m);k++){var G=R[k],U={color:G.pickedColor,layer:null,index:G.pickedObjectIndex,picked:!0,x:o,y:s,pixelRatio:b};U=IT({layer:G.pickedLayer,info:U,mode:d}),V.has(U.object)||V.set(U.object,U)}return Array.from(V.values())}},{key:"_drawAndSample",value:function(e){var n=e.layers,i=e.views,a=e.viewports,o=e.onViewportActive,s=e.deviceRect,u=e.cullRect,l=e.effects,f=e.pass,c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,p=c?this.depthFBO:this.pickingFBO,d={layers:n,layerFilter:this.layerFilter,views:i,viewports:a,onViewportActive:o,pickingFBO:p,deviceRect:s,cullRect:u,effects:l,pass:f,pickZ:c,preRenderStats:{}},v=RT(l),m;try{for(v.s();!(m=v.n()).done;){var g=m.value;g.useInPicking&&(d.preRenderStats[g.id]=g.preRender(this.gl,d))}}catch(O){v.e(O)}finally{v.f()}var y=this.pickLayersPass.render(d),_=y.decodePickingColor,b=s.x,x=s.y,A=s.width,S=s.height,P=new(c?Float32Array:Uint8Array)(A*S*4);return ei(p,{sourceX:b,sourceY:x,sourceWidth:A,sourceHeight:S,target:P}),{pickedColors:P,decodePickingColor:_}}},{key:"_getPickingRect",value:function(e){var n=e.deviceX,i=e.deviceY,a=e.deviceRadius,o=e.deviceWidth,s=e.deviceHeight,u=Math.max(0,n-a),l=Math.max(0,i-a),f=Math.min(o,n+a+1)-u,c=Math.min(s,i+a+1)-l;return f<=0||c<=0?null:{x:u,y:l,width:f,height:c}}}]),t}();var HG=h(ze()),WG=h(L()),$G=h(N()),LT=h(B()),R1e={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"},XG=function(){function t(r){(0,WG.default)(this,t),(0,LT.default)(this,"el",null),(0,LT.default)(this,"isVisible",!1);var e=r.parentElement;e&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,R1e),e.appendChild(this.el))}return(0,$G.default)(t,[{key:"setTooltip",value:function(e,n,i){var a=this.el;if(a){if(typeof e=="string")a.innerText=e;else if(e)e.text&&(a.innerText=e.text),e.html&&(a.innerHTML=e.html),e.className&&(a.className=e.className);else{this.isVisible=!1,a.style.display="none";return}this.isVisible=!0,a.style.display="block",a.style.transform="translate(".concat(n,"px, ").concat(i,"px)"),e&&(0,HG.default)(e)==="object"&&"style"in e&&Object.assign(a.style,e.style)}}},{key:"remove",value:function(){this.el&&(this.el.remove(),this.el=null)}}]),t}();var Kz=h(me()),Zz=h(B()),Jz=h(L()),Qz=h(N());var $p=h(qG());var YG=1,KG=2,kT=4,L1e={mousedown:YG,mousemove:KG,mouseup:kT};function k1e(t,r){for(var e=0;e<t.length;e++)if(r(t[e]))return!0;return!1}function ZG(t){var r=t.prototype.handler;t.prototype.handler=function(n){var i=this.store;n.button>0&&n.type==="pointerdown"&&(k1e(i,function(a){return a.pointerId===n.pointerId})||i.push(n)),r.call(this,n)}}function JG(t){t.prototype.handler=function(e){var n=L1e[e.type];n&YG&&e.button>=0&&(this.pressed=!0),n&KG&&e.which===0&&(n=kT),this.pressed&&(n&kT&&(this.pressed=!1),this.callback(this.manager,n,{pointers:[e],changedPointers:[e],pointerType:"mouse",srcEvent:e}))}}ZG($p.default.PointerEventInput);JG($p.default.MouseInput);var QG=$p.default.Manager,ci=$p.default;var cz=h(L()),pz=h(N()),hz=h(Y()),dz=h(K()),DT=h(q());var tz=h(B()),rz=h(L());function ez(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function B1e(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?ez(Object(e),!0).forEach(function(n){(0,tz.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):ez(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var Po=function t(r,e,n){(0,rz.default)(this,t),this.element=r,this.callback=e,this.options=B1e({enable:!0},n)};var nz=ci?[[ci.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[ci.Rotate,{enable:!1}],[ci.Pinch,{enable:!1}],[ci.Swipe,{enable:!1}],[ci.Pan,{threshold:0,enable:!1}],[ci.Press,{enable:!1}],[ci.Tap,{event:"doubletap",taps:2,enable:!1}],[ci.Tap,{event:"anytap",enable:!1}],[ci.Tap,{enable:!1}]]:null,BT={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},iz={doubletap:["tap"]},az={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},Hl={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},oz={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},FT={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"};var uz=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",Hs=typeof window<"u"?window:global;var jg=!1;try{sz={get passive(){return jg=!0,!0}},Hs.addEventListener("test",null,sz),Hs.removeEventListener("test",null)}catch{jg=!1}var sz;function F1e(t){var r=D1e();return function(){var n=(0,DT.default)(t),i;if(r){var a=(0,DT.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,dz.default)(this,i)}}function D1e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var N1e=uz.indexOf("firefox")!==-1,j1e=Hl.WHEEL_EVENTS,lz="wheel",fz=4.000244140625,U1e=40,G1e=.25,vz=function(t){(0,hz.default)(e,t);var r=F1e(e);function e(n,i,a){var o;return(0,cz.default)(this,e),o=r.call(this,n,i,a),o.handleEvent=function(s){if(o.options.enable){var u=s.deltaY;Hs.WheelEvent&&(N1e&&s.deltaMode===Hs.WheelEvent.DOM_DELTA_PIXEL&&(u/=Hs.devicePixelRatio),s.deltaMode===Hs.WheelEvent.DOM_DELTA_LINE&&(u*=U1e)),u!==0&&u%fz===0&&(u=Math.floor(u/fz)),s.shiftKey&&u&&(u=u*G1e),o.callback({type:lz,center:{x:s.clientX,y:s.clientY},delta:-u,srcEvent:s,pointerType:"mouse",target:s.target})}},o.events=(o.options.events||[]).concat(j1e),o.events.forEach(function(s){return n.addEventListener(s,o.handleEvent,jg?{passive:!1}:!1)}),o}return(0,pz.default)(e,[{key:"destroy",value:function(){var i=this;this.events.forEach(function(a){return i.element.removeEventListener(a,i.handleEvent)})}},{key:"enableEventType",value:function(i,a){i===lz&&(this.options.enable=a)}}]),e}(Po);var xz=h(L()),Az=h(N()),Sz=h(Y()),Tz=h(K()),NT=h(q());function z1e(t){var r=V1e();return function(){var n=(0,NT.default)(t),i;if(r){var a=(0,NT.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Tz.default)(this,i)}}function V1e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var H1e=Hl.MOUSE_EVENTS,mz="pointermove",gz="pointerover",yz="pointerout",_z="pointerenter",bz="pointerleave",wz=function(t){(0,Sz.default)(e,t);var r=z1e(e);function e(n,i,a){var o;(0,xz.default)(this,e),o=r.call(this,n,i,a),o.handleEvent=function(u){o.handleOverEvent(u),o.handleOutEvent(u),o.handleEnterEvent(u),o.handleLeaveEvent(u),o.handleMoveEvent(u)},o.pressed=!1;var s=o.options.enable;return o.enableMoveEvent=s,o.enableLeaveEvent=s,o.enableEnterEvent=s,o.enableOutEvent=s,o.enableOverEvent=s,o.events=(o.options.events||[]).concat(H1e),o.events.forEach(function(u){return n.addEventListener(u,o.handleEvent)}),o}return(0,Az.default)(e,[{key:"destroy",value:function(){var i=this;this.events.forEach(function(a){return i.element.removeEventListener(a,i.handleEvent)})}},{key:"enableEventType",value:function(i,a){i===mz&&(this.enableMoveEvent=a),i===gz&&(this.enableOverEvent=a),i===yz&&(this.enableOutEvent=a),i===_z&&(this.enableEnterEvent=a),i===bz&&(this.enableLeaveEvent=a)}},{key:"handleOverEvent",value:function(i){this.enableOverEvent&&i.type==="mouseover"&&this._emit(gz,i)}},{key:"handleOutEvent",value:function(i){this.enableOutEvent&&i.type==="mouseout"&&this._emit(yz,i)}},{key:"handleEnterEvent",value:function(i){this.enableEnterEvent&&i.type==="mouseenter"&&this._emit(_z,i)}},{key:"handleLeaveEvent",value:function(i){this.enableLeaveEvent&&i.type==="mouseleave"&&this._emit(bz,i)}},{key:"handleMoveEvent",value:function(i){if(this.enableMoveEvent)switch(i.type){case"mousedown":i.button>=0&&(this.pressed=!0);break;case"mousemove":i.which===0&&(this.pressed=!1),this.pressed||this._emit(mz,i);break;case"mouseup":this.pressed=!1;break;default:}}},{key:"_emit",value:function(i,a){this.callback({type:i,center:{x:a.clientX,y:a.clientY},srcEvent:a,pointerType:"mouse",target:a.target})}}]),e}(Po);var Ez=h(L()),Cz=h(N()),Mz=h(Y()),Iz=h(K()),jT=h(q());function W1e(t){var r=$1e();return function(){var n=(0,jT.default)(t),i;if(r){var a=(0,jT.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Iz.default)(this,i)}}function $1e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var X1e=Hl.KEY_EVENTS,Pz="keydown",Oz="keyup",Rz=function(t){(0,Mz.default)(e,t);var r=W1e(e);function e(n,i,a){var o;return(0,Ez.default)(this,e),o=r.call(this,n,i,a),o.handleEvent=function(s){var u=s.target||s.srcElement;u.tagName==="INPUT"&&u.type==="text"||u.tagName==="TEXTAREA"||(o.enableDownEvent&&s.type==="keydown"&&o.callback({type:Pz,srcEvent:s,key:s.key,target:s.target}),o.enableUpEvent&&s.type==="keyup"&&o.callback({type:Oz,srcEvent:s,key:s.key,target:s.target}))},o.enableDownEvent=o.options.enable,o.enableUpEvent=o.options.enable,o.events=(o.options.events||[]).concat(X1e),n.tabIndex=o.options.tabIndex||0,n.style.outline="none",o.events.forEach(function(s){return n.addEventListener(s,o.handleEvent)}),o}return(0,Cz.default)(e,[{key:"destroy",value:function(){var i=this;this.events.forEach(function(a){return i.element.removeEventListener(a,i.handleEvent)})}},{key:"enableEventType",value:function(i,a){i===Pz&&(this.enableDownEvent=a),i===Oz&&(this.enableUpEvent=a)}}]),e}(Po);var kz=h(L()),Bz=h(N()),Fz=h(Y()),Dz=h(K()),UT=h(q());function q1e(t){var r=Y1e();return function(){var n=(0,UT.default)(t),i;if(r){var a=(0,UT.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Dz.default)(this,i)}}function Y1e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Lz="contextmenu",Nz=function(t){(0,Fz.default)(e,t);var r=q1e(e);function e(n,i,a){var o;return(0,kz.default)(this,e),o=r.call(this,n,i,a),o.handleEvent=function(s){o.options.enable&&o.callback({type:Lz,center:{x:s.clientX,y:s.clientY},srcEvent:s,pointerType:"mouse",target:s.target})},n.addEventListener("contextmenu",o.handleEvent),o}return(0,Bz.default)(e,[{key:"destroy",value:function(){this.element.removeEventListener("contextmenu",this.handleEvent)}},{key:"enableEventType",value:function(i,a){i===Lz&&(this.options.enable=a)}}]),e}(Po);var zz=h(B()),Vz=h(L()),Hz=h(N());var GT=1,Ug=2,zT=4,K1e={pointerdown:GT,pointermove:Ug,pointerup:zT,mousedown:GT,mousemove:Ug,mouseup:zT},Z1e=1,J1e=2,Q1e=3,exe=0,txe=1,rxe=2,nxe=1,ixe=2,axe=4;function jz(t){var r=K1e[t.srcEvent.type];if(!r)return null;var e=t.srcEvent,n=e.buttons,i=e.button,a=e.which,o=!1,s=!1,u=!1;return r===zT||r===Ug&&!Number.isFinite(n)?(o=a===Z1e,s=a===J1e,u=a===Q1e):r===Ug?(o=Boolean(n&nxe),s=Boolean(n&axe),u=Boolean(n&ixe)):r===GT&&(o=i===exe,s=i===txe,u=i===rxe),{leftButton:o,middleButton:s,rightButton:u}}function Uz(t,r){var e=t.center;if(!e)return null;var n=r.getBoundingClientRect(),i=n.width/r.offsetWidth||1,a=n.height/r.offsetHeight||1,o={x:(e.x-n.left-r.clientLeft)/i,y:(e.y-n.top-r.clientTop)/a};return{center:e,offsetCenter:o}}function Gz(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function zi(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Gz(Object(e),!0).forEach(function(n){(0,zz.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Gz(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var VT={srcElement:"root",priority:0},Wz=function(){function t(r){var e=this;(0,Vz.default)(this,t),this.handleEvent=function(n){if(!e.isEmpty()){for(var i=e._normalizeEvent(n),a=n.srcEvent.target;a&&a!==i.rootElement;){if(e._emit(i,a),i.handled)return;a=a.parentNode}e._emit(i,"root")}},this.eventManager=r,this.handlers=[],this.handlersByElement=new Map,this._active=!1}return(0,Hz.default)(t,[{key:"isEmpty",value:function(){return!this._active}},{key:"add",value:function(e,n,i){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,s=this.handlers,u=this.handlersByElement,l=VT;typeof i=="string"||i&&i.addEventListener?l=zi(zi({},VT),{},{srcElement:i}):i&&(l=zi(zi({},VT),i));var f=u.get(l.srcElement);f||(f=[],u.set(l.srcElement,f));var c={type:e,handler:n,srcElement:l.srcElement,priority:l.priority};a&&(c.once=!0),o&&(c.passive=!0),s.push(c),this._active=this._active||!c.passive;for(var p=f.length-1;p>=0&&!(f[p].priority>=c.priority);)p--;f.splice(p+1,0,c)}},{key:"remove",value:function(e,n){for(var i=this.handlers,a=this.handlersByElement,o=i.length-1;o>=0;o--){var s=i[o];if(s.type===e&&s.handler===n){i.splice(o,1);var u=a.get(s.srcElement);u.splice(u.indexOf(s),1),u.length===0&&a.delete(s.srcElement)}}this._active=i.some(function(l){return!l.passive})}},{key:"_emit",value:function(e,n){var i=this.handlersByElement.get(n);if(i){for(var a=!1,o=function(){e.handled=!0},s=function(){e.handled=!0,a=!0},u=[],l=0;l<i.length;l++){var f=i[l],c=f.type,p=f.handler,d=f.once;if(p(zi(zi({},e),{},{type:c,stopPropagation:o,stopImmediatePropagation:s})),d&&u.push(i[l]),a)break}for(var v=0;v<u.length;v++){var m=u[v],g=m.type,y=m.handler;this.remove(g,y)}}}},{key:"_normalizeEvent",value:function(e){var n=this.eventManager.getElement();return zi(zi(zi(zi({},e),jz(e)),Uz(e,n)),{},{preventDefault:function(){e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:n})}}]),t}();function $z(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=oxe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function oxe(t,r){if(t){if(typeof t=="string")return Xz(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Xz(t,r)}}function Xz(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function qz(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Yz(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?qz(Object(e),!0).forEach(function(n){(0,Zz.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):qz(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var sxe={events:null,recognizers:null,recognizerOptions:{},Manager:QG,touchAction:"none",tabIndex:0},HT=function(){function t(){var r=this,e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1?arguments[1]:void 0;(0,Jz.default)(this,t),this._onBasicInput=function(a){var o=a.srcEvent,s=az[o.type];s&&r.manager.emit(s,a)},this._onOtherEvent=function(a){r.manager.emit(a.type,a)},this.options=Yz(Yz({},sxe),n),this.events=new Map,this.setElement(e);var i=this.options.events;i&&this.on(i)}return(0,Qz.default)(t,[{key:"getElement",value:function(){return this.element}},{key:"setElement",value:function(e){var n=this;if(this.element&&this.destroy(),this.element=e,!!e){var i=this.options,a=i.Manager;this.manager=new a(e,{touchAction:i.touchAction,recognizers:i.recognizers||nz}).on("hammer.input",this._onBasicInput),i.recognizers||Object.keys(BT).forEach(function(v){var m=n.manager.get(v);m&&BT[v].forEach(function(g){m.recognizeWith(g)})});for(var o in i.recognizerOptions){var s=this.manager.get(o);if(s){var u=i.recognizerOptions[o];delete u.enable,s.set(u)}}this.wheelInput=new vz(e,this._onOtherEvent,{enable:!1}),this.moveInput=new wz(e,this._onOtherEvent,{enable:!1}),this.keyInput=new Rz(e,this._onOtherEvent,{enable:!1,tabIndex:i.tabIndex}),this.contextmenuInput=new Nz(e,this._onOtherEvent,{enable:!1});var l=$z(this.events),f;try{for(l.s();!(f=l.n()).done;){var c=(0,Kz.default)(f.value,2),p=c[0],d=c[1];d.isEmpty()||(this._toggleRecognizer(d.recognizerName,!0),this.manager.on(p,d.handleEvent))}}catch(v){l.e(v)}finally{l.f()}}}},{key:"destroy",value:function(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}},{key:"on",value:function(e,n,i){this._addEventHandler(e,n,i,!1)}},{key:"once",value:function(e,n,i){this._addEventHandler(e,n,i,!0)}},{key:"watch",value:function(e,n,i){this._addEventHandler(e,n,i,!1,!0)}},{key:"off",value:function(e,n){this._removeEventHandler(e,n)}},{key:"_toggleRecognizer",value:function(e,n){var i=this.manager;if(i){var a=i.get(e);if(a&&a.options.enable!==n){a.set({enable:n});var o=iz[e];o&&!this.options.recognizers&&o.forEach(function(s){var u=i.get(s);n?(u.requireFailure(e),a.dropRequireFailure(s)):u.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,n),this.moveInput.enableEventType(e,n),this.keyInput.enableEventType(e,n),this.contextmenuInput.enableEventType(e,n)}}},{key:"_addEventHandler",value:function(e,n,i,a,o){if(typeof e!="string"){i=n;for(var s in e)this._addEventHandler(s,e[s],i,a,o);return}var u=this.manager,l=this.events,f=FT[e]||e,c=l.get(f);c||(c=new Wz(this),l.set(f,c),c.recognizerName=oz[f]||f,u&&u.on(f,c.handleEvent)),c.add(e,n,i,a,o),c.isEmpty()||this._toggleRecognizer(c.recognizerName,!0)}},{key:"_removeEventHandler",value:function(e,n){if(typeof e!="string"){for(var i in e)this._removeEventHandler(i,e[i]);return}var a=this.events,o=FT[e]||e,s=a.get(o);if(s&&(s.remove(e,n),s.isEmpty())){var u=s.recognizerName,l=!1,f=$z(a.values()),c;try{for(f.s();!(c=f.n()).done;){var p=c.value;if(p.recognizerName===u&&!p.isEmpty()){l=!0;break}}}catch(d){f.e(d)}finally{f.f()}l||this._toggleRecognizer(u,!1)}}}]),t}();function eV(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=uxe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function uxe(t,r){if(t){if(typeof t=="string")return tV(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return tV(t,r)}}function tV(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function rV(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Oa(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?rV(Object(e),!0).forEach(function(n){(0,pt.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):rV(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function Ws(){}var lxe=function(r){var e=r.isDragging;return e?"grabbing":"grab"},aV={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,glOptions:{},parameters:{},parent:null,gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,onWebGLInitialized:Ws,onResize:Ws,onViewStateChange:Ws,onInteractionStateChange:Ws,onBeforeRender:Ws,onAfterRender:Ws,onLoad:Ws,onError:function(r){return J.error(r.message)()},onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:lxe,getTooltip:null,debug:!1,drawPickingColors:!1},dn=function(){function t(r){var e=this;(0,nV.default)(this,t),(0,pt.default)(this,"props",void 0),(0,pt.default)(this,"width",0),(0,pt.default)(this,"height",0),(0,pt.default)(this,"userData",{}),(0,pt.default)(this,"canvas",null),(0,pt.default)(this,"viewManager",null),(0,pt.default)(this,"layerManager",null),(0,pt.default)(this,"effectManager",null),(0,pt.default)(this,"deckRenderer",null),(0,pt.default)(this,"deckPicker",null),(0,pt.default)(this,"eventManager",null),(0,pt.default)(this,"tooltip",null),(0,pt.default)(this,"metrics",void 0),(0,pt.default)(this,"animationLoop",void 0),(0,pt.default)(this,"stats",void 0),(0,pt.default)(this,"viewState",void 0),(0,pt.default)(this,"cursorState",void 0),(0,pt.default)(this,"_needsRedraw",void 0),(0,pt.default)(this,"_pickRequest",void 0),(0,pt.default)(this,"_lastPointerDownInfo",null),(0,pt.default)(this,"_metricsCounter",void 0),(0,pt.default)(this,"_onPointerMove",function(n){var i=e._pickRequest;if(n.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(n.leftButton||n.rightButton)return;var a=n.offsetCenter;if(!a)return;i.x=a.x,i.y=a.y,i.radius=e.props.pickingRadius}e.layerManager&&(e.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=n}),(0,pt.default)(this,"_onEvent",function(n){var i=eA[n.type],a=n.offsetCenter;if(!(!i||!a||!e.layerManager)){var o=e.layerManager.getLayers(),s=e.deckPicker.getLastPickedObject({x:a.x,y:a.y,layers:o,viewports:e.getViewports(a)},e._lastPointerDownInfo),u=s.layer,l=u&&(u[i.handler]||u.props[i.handler]),f=e.props[i.handler],c=!1;l&&(c=l.call(u,s,n)),!c&&f&&f(s,n)}}),(0,pt.default)(this,"_onPointerDown",function(n){var i=n.offsetCenter,a=e._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:e.props.pickingRadius});e._lastPointerDownInfo=a.result[0]||a.emptyInfo}),this.props=Oa(Oa({},aV),r),r=this.props,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this.cursorState={isHovering:!1,isDragging:!1},r.viewState&&r.initialViewState&&J.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),Qu()==="IE"&&J.warn("IE 11 is not supported")(),this.viewState=r.initialViewState,r.gl||typeof document<"u"&&(this.canvas=this._createCanvas(r)),this.animationLoop=this._createAnimationLoop(r),this.stats=new ys({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(r),r._typedArrayManagerProps&&ai.setOptions(r._typedArrayManagerProps),this.animationLoop.start()}return(0,iV.default)(t,[{key:"finalize",value:function(){var e,n,i,a,o,s,u,l;if((e=this.animationLoop)===null||e===void 0||e.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,(n=this.layerManager)===null||n===void 0||n.finalize(),this.layerManager=null,(i=this.viewManager)===null||i===void 0||i.finalize(),this.viewManager=null,(a=this.effectManager)===null||a===void 0||a.finalize(),this.effectManager=null,(o=this.deckRenderer)===null||o===void 0||o.finalize(),this.deckRenderer=null,(s=this.deckPicker)===null||s===void 0||s.finalize(),this.deckPicker=null,(u=this.eventManager)===null||u===void 0||u.destroy(),this.eventManager=null,(l=this.tooltip)===null||l===void 0||l.remove(),this.tooltip=null,!this.props.canvas&&!this.props.gl&&this.canvas){var f;(f=this.canvas.parentElement)===null||f===void 0||f.removeChild(this.canvas),this.canvas=null}}},{key:"setProps",value:function(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&J.removed("onLayerHover","onHover")(),"onLayerClick"in e&&J.removed("onLayerClick","onClick")(),e.initialViewState&&!Lt(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);var n=Object.create(this.props);Object.assign(n,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(n),this.layerManager&&(this.viewManager.setProps(n),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(n),this.effectManager.setProps(n),this.deckRenderer.setProps(n),this.deckPicker.setProps(n)),this.stats.get("setProps Time").timeEnd()}},{key:"needsRedraw",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";var n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);var i=this.viewManager.needsRedraw(e),a=this.layerManager.needsRedraw(e),o=this.effectManager.needsRedraw(e),s=this.deckRenderer.needsRedraw(e);return n=n||i||a||o||s,n}},{key:"redraw",value:function(e){if(this.layerManager){var n=this.needsRedraw({clearRedrawFlags:!0});n=e||n,n&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(n):this._drawLayers(n))}}},{key:"isInitialized",get:function(){return this.viewManager!==null}},{key:"getViews",value:function(){return rt(this.viewManager),this.viewManager.views}},{key:"getViewports",value:function(e){return rt(this.viewManager),this.viewManager.getViewports(e)}},{key:"pickObject",value:function(e){var n=this._pick("pickObject","pickObject Time",e).result;return n.length?n[0]:null}},{key:"pickMultipleObjects",value:function(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}},{key:"pickObjects",value:function(e){return this._pick("pickObjects","pickObjects Time",e)}},{key:"_addResources",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;for(var i in e)this.layerManager.resourceManager.add({resourceId:i,data:e[i],forceUpdate:n})}},{key:"_removeResources",value:function(e){var n=eV(e),i;try{for(n.s();!(i=n.n()).done;){var a=i.value;this.layerManager.resourceManager.remove(a)}}catch(o){n.e(o)}finally{n.f()}}},{key:"_addDefaultEffect",value:function(e){this.effectManager.addDefaultEffect(e)}},{key:"_pick",value:function(e,n,i){rt(this.deckPicker);var a=this.stats;a.get("Pick Count").incrementCount(),a.get(n).timeStart();var o=this.deckPicker[e](Oa({layers:this.layerManager.getLayers(i),views:this.viewManager.getViews(),viewports:this.getViewports(i),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects()},i));return a.get(n).timeEnd(),o}},{key:"_createCanvas",value:function(e){var n=e.canvas;if(typeof n=="string"&&(n=document.getElementById(n),rt(n)),!n){n=document.createElement("canvas"),n.id=e.id||"deckgl-overlay";var i=e.parent||document.body;i.appendChild(n)}return Object.assign(n.style,e.style),n}},{key:"_setCanvasSize",value:function(e){if(this.canvas){var n=e.width,i=e.height;if(n||n===0){var a=Number.isFinite(n)?"".concat(n,"px"):n;this.canvas.style.width=a}if(i||i===0){var o,s=Number.isFinite(i)?"".concat(i,"px"):i;this.canvas.style.position=((o=e.style)===null||o===void 0?void 0:o.position)||"absolute",this.canvas.style.height=s}}}},{key:"_updateCanvasSize",value:function(){var e,n,i=this.canvas;if(i){var a=(e=i.clientWidth)!==null&&e!==void 0?e:i.width,o=(n=i.clientHeight)!==null&&n!==void 0?n:i.height;if(a!==this.width||o!==this.height){var s,u;this.width=a,this.height=o,(s=this.viewManager)===null||s===void 0||s.setProps({width:a,height:o}),(u=this.layerManager)===null||u===void 0||u.activateViewport(this.getViewports()[0]),this.props.onResize({width:a,height:o})}}}},{key:"_createAnimationLoop",value:function(e){var n=this,i=e.width,a=e.height,o=e.gl,s=e.glOptions,u=e.debug,l=e.onError,f=e.onBeforeRender,c=e.onAfterRender,p=e.useDevicePixels;return new pm({width:i,height:a,useDevicePixels:p,autoResizeDrawingBuffer:!o,autoResizeViewport:!1,gl:o,onCreateContext:function(v){return il(Oa(Oa(Oa({},s),v),{},{canvas:n.canvas,debug:u,onContextLost:function(){return n._onContextLost()}}))},onInitialize:function(v){return n._setGLContext(v.gl)},onRender:this._onRenderFrame.bind(this),onBeforeRender:f,onAfterRender:c,onError:l})}},{key:"_getViewState",value:function(){return this.props.viewState||this.viewState}},{key:"_getViews",value:function(){var e=this.props.views||[new Vs({id:"default-view"})];return e=Array.isArray(e)?e:[e],e.length&&this.props.controller&&(e[0].props.controller=this.props.controller),e}},{key:"_onContextLost",value:function(){var e=this.props.onError;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}},{key:"_pickAndCallback",value:function(){var e=this._pickRequest;if(e.event){var n=this._pick("pickObject","pickObject Time",e),i=n.result,a=n.emptyInfo;this.cursorState.isHovering=i.length>0;var o=a,s=!1,u=eV(i),l;try{for(u.s();!(l=u.n()).done;){var f,c=l.value;o=c,s=((f=c.layer)===null||f===void 0?void 0:f.onHover(c,e.event))||s}}catch(d){u.e(d)}finally{u.f()}if(!s&&this.props.onHover&&this.props.onHover(o,e.event),this.props.getTooltip&&this.tooltip){var p=this.props.getTooltip(o);this.tooltip.setTooltip(p,o.x,o.y)}e.event=null}}},{key:"_updateCursor",value:function(){var e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}},{key:"_setGLContext",value:function(e){if(!this.layerManager){this.canvas||(this.canvas=e.canvas,da(e,{enable:!0,copyState:!0})),this.tooltip=new XG(this.canvas),Ht(e,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(e);var n=new bo;n.play(),this.animationLoop.attachTimeline(n),this.eventManager=new HT(this.props.parent||e.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(var i in eA)this.eventManager.on(i,this._onEvent);this.viewManager=new R6({timeline:n,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});var a=this.viewManager.getViewports()[0];this.layerManager=new Og(e,{deck:this,stats:this.stats,viewport:a,timeline:n}),this.effectManager=new AG,this.deckRenderer=new Bg(e),this.deckPicker=new VG(e),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}}},{key:"_drawLayers",value:function(e,n){var i=this.layerManager.context.gl;Ht(i,this.props.parameters),this.props.onBeforeRender({gl:i}),this.deckRenderer.renderLayers(Oa({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects()},n)),this.props.onAfterRender({gl:i})}},{key:"_onRenderFrame",value:function(e){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),J.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}},{key:"_onViewStateChange",value:function(e){var n=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState=Oa(Oa({},this.viewState),{},(0,pt.default)({},e.viewId,n)),this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}},{key:"_onInteractionStateChange",value:function(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}},{key:"_getFrameStats",value:function(){var e=this.stats;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();var n=this.animationLoop.stats;e.get("GPU Time").addTime(n.get("GPU Time").lastTiming),e.get("CPU Time").addTime(n.get("CPU Time").lastTiming)}},{key:"_getMetrics",value:function(){var e=this.metrics,n=this.stats;e.fps=n.get("frameRate").getHz(),e.setPropsTime=n.get("setProps Time").time,e.updateAttributesTime=n.get("Update Attributes").time,e.framesRedrawn=n.get("Redraw Count").count,e.pickTime=n.get("pickObject Time").time+n.get("pickMultipleObjects Time").time+n.get("pickObjects Time").time,e.pickCount=n.get("Pick Count").count,e.gpuTime=n.get("GPU Time").time,e.cpuTime=n.get("CPU Time").time,e.gpuTimePerFrame=n.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=n.get("CPU Time").getAverageTime();var i=Sn.get("Memory Usage");e.bufferMemory=i.get("Buffer Memory").count,e.textureMemory=i.get("Texture Memory").count,e.renderbufferMemory=i.get("Renderbuffer Memory").count,e.gpuMemory=i.get("GPU Memory").count}}]),t}();(0,pt.default)(dn,"defaultProps",aV);(0,pt.default)(dn,"VERSION",Bv);var XV=h(L()),qV=h(N()),pi=h(B());var $T=h(me()),TV=h(L()),wV=h(N()),PV=h(be()),Qg=h(Ee()),OV=h(Y()),EV=h(K()),Wl=h(q()),XT=h(B());var pV=h(L()),hV=h(N()),kn=h(B());var uV=h(L()),lV=h(N()),Gg=h(B());function oV(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function sV(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?oV(Object(e),!0).forEach(function(n){(0,Gg.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):oV(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var zg=function(){function t(r,e){(0,uV.default)(this,t),(0,Gg.default)(this,"opts",void 0),(0,Gg.default)(this,"source",void 0),this.opts=e,this.source=r}return(0,lV.default)(t,[{key:"value",get:function(){return this.source.value}},{key:"getValue",value:function(){var e=this.source.getBuffer(),n=this.getAccessor();if(e)return[e,n];var i=this.source.value,a=n.size,o=i;if(i&&i.length!==a){o=new Float32Array(a);for(var s=n.elementOffset||0,u=0;u<a;++u)o[u]=i[s+u]}return o}},{key:"getAccessor",value:function(){return sV(sV({},this.source.getAccessor()),this.opts)}}]),t}();function fV(t){switch(t){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}function cV(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Vi(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?cV(Object(e),!0).forEach(function(n){(0,kn.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):cV(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function Vg(t){return t.stride||t.size*t.bytesPerElement}function dV(t,r){r.offset&&J.removed("shaderAttribute.offset","vertexOffset, elementOffset")();var e=Vg(t),n=r.vertexOffset!==void 0?r.vertexOffset:t.vertexOffset||0,i=r.elementOffset||0,a=n*e+i*t.bytesPerElement+(t.offset||0);return Vi(Vi({},r),{},{offset:a,stride:e})}function fxe(t,r){var e=dV(t,r);return{high:e,low:Vi(Vi({},e),{},{offset:e.offset+t.size*4})}}var vV=function(){function t(r,e,n){(0,pV.default)(this,t),(0,kn.default)(this,"gl",void 0),(0,kn.default)(this,"id",void 0),(0,kn.default)(this,"size",void 0),(0,kn.default)(this,"settings",void 0),(0,kn.default)(this,"value",void 0),(0,kn.default)(this,"doublePrecision",void 0),(0,kn.default)(this,"_buffer",void 0),(0,kn.default)(this,"state",void 0),this.gl=r,this.id=e.id||"",this.size=e.size||1;var i=e.logicalType||e.type,a=i===5130,o=e.defaultValue;o=Number.isFinite(o)?[o]:o||new Array(this.size).fill(0);var s;a?s=5126:!i&&e.isIndexed?s=r&&ti(r,Se.ELEMENT_INDEX_UINT32)?5125:5123:s=i||5126;var u=fV(i||s||5126);this.doublePrecision=a,a&&e.fp64===!1&&(u=Float32Array),this.value=null,this.settings=Vi(Vi({},e),{},{defaultType:u,defaultValue:o,logicalType:i,type:s,size:this.size,bytesPerElement:u.BYTES_PER_ELEMENT}),this.state=Vi(Vi({},n),{},{externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}),this._buffer=null}return(0,hV.default)(t,[{key:"isConstant",get:function(){return this.state.constant}},{key:"buffer",get:function(){if(!this._buffer){var e=this.settings,n=e.isIndexed,i=e.type;this._buffer=new xe(this.gl,{id:this.id,target:n?34963:34962,accessor:{type:i}})}return this._buffer}},{key:"byteOffset",get:function(){var e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Vg(e):0}},{key:"numInstances",get:function(){return this.state.numInstances},set:function(e){this.state.numInstances=e}},{key:"delete",value:function(){this._buffer&&(this._buffer.delete(),this._buffer=null),ai.release(this.state.allocatedValue)}},{key:"getShaderAttributes",value:function(e,n){if(this.doublePrecision){var i={},a=this.value instanceof Float64Array,o=fxe(this.getAccessor(),n||{});return i[e]=new zg(this,o.high),i["".concat(e,"64Low")]=a?new zg(this,o.low):new Float32Array(this.size),i}if(n){var s=dV(this.getAccessor(),n);return(0,kn.default)({},e,new zg(this,s))}return(0,kn.default)({},e,this)}},{key:"getBuffer",value:function(){return this.state.constant?null:this.state.externalBuffer||this._buffer}},{key:"getValue",value:function(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}},{key:"getAccessor",value:function(){return this.state.bufferAccessor}},{key:"getBounds",value:function(){if(this.state.bounds)return this.state.bounds;var e=null;if(this.state.constant&&this.value){var n=Array.from(this.value);e=[n,n]}else{var i=this.value,a=this.numInstances,o=this.size,s=a*o;if(i&&s&&i.length>=s){for(var u=new Array(o).fill(1/0),l=new Array(o).fill(-1/0),f=0;f<s;)for(var c=0;c<o;c++){var p=i[f++];p<u[c]&&(u[c]=p),p>l[c]&&(l[c]=p)}e=[u,l]}}return this.state.bounds=e,e}},{key:"setData",value:function(e){var n=this.state,i;ArrayBuffer.isView(e)?i={value:e}:e instanceof xe?i={buffer:e}:i=e;var a=Vi(Vi({},this.settings),i);if(n.bufferAccessor=a,n.bounds=null,i.constant){var o=i.value;o=this._normalizeValue(o,[],0),this.settings.normalized&&(o=this.normalizeConstant(o));var s=!n.constant||!this._areValuesEqual(o,this.value);if(!s)return!1;n.externalBuffer=null,n.constant=!0,this.value=o}else if(i.buffer){var u=i.buffer;n.externalBuffer=u,n.constant=!1,this.value=i.value||null;var l=i.value instanceof Float64Array;a.type=i.type||u.accessor.type,a.bytesPerElement=u.accessor.BYTES_PER_ELEMENT*(l?2:1),a.stride=Vg(a)}else if(i.value){this._checkExternalBuffer(i);var f=i.value;n.externalBuffer=null,n.constant=!1,this.value=f,a.bytesPerElement=f.BYTES_PER_ELEMENT,a.stride=Vg(a);var c=this.buffer,p=this.byteOffset;this.doublePrecision&&f instanceof Float64Array&&(f=dg(f,a));var d=f.byteLength+p+a.stride*2;c.byteLength<d&&c.reallocate(d),c.setAccessor(null),c.subData({data:f,offset:p}),a.type=i.type||c.accessor.type}return!0}},{key:"updateSubBuffer",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.state.bounds=null;var n=this.value,i=e.startOffset,a=i===void 0?0:i,o=e.endOffset;this.buffer.subData({data:this.doublePrecision&&n instanceof Float64Array?dg(n,{size:this.size,startIndex:a,endIndex:o}):n.subarray(a,o),offset:a*n.BYTES_PER_ELEMENT+this.byteOffset})}},{key:"allocate",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,i=this.state,a=i.allocatedValue,o=ai.allocate(a,e+1,{size:this.size,type:this.settings.defaultType,copy:n});this.value=o;var s=this.buffer,u=this.byteOffset;return s.byteLength<o.byteLength+u&&(s.reallocate(o.byteLength+u),n&&a&&s.subData({data:a instanceof Float64Array?dg(a,this):a,offset:u})),i.allocatedValue=o,i.constant=!1,i.externalBuffer=null,i.bufferAccessor=this.settings,!0}},{key:"_checkExternalBuffer",value:function(e){var n=e.value;if(!ArrayBuffer.isView(n))throw new Error("Attribute ".concat(this.id," value is not TypedArray"));var i=this.settings.defaultType,a=!1;if(this.doublePrecision&&(a=n.BYTES_PER_ELEMENT<4),a)throw new Error("Attribute ".concat(this.id," does not support ").concat(n.constructor.name));!(n instanceof i)&&this.settings.normalized&&!("normalized"in e)&&J.warn("Attribute ".concat(this.id," is normalized"))()}},{key:"normalizeConstant",value:function(e){switch(this.settings.type){case 5120:return new Float32Array(e).map(function(n){return(n+128)/255*2-1});case 5122:return new Float32Array(e).map(function(n){return(n+32768)/65535*2-1});case 5121:return new Float32Array(e).map(function(n){return n/255});case 5123:return new Float32Array(e).map(function(n){return n/65535});default:return e}}},{key:"_normalizeValue",value:function(e,n,i){var a=this.settings,o=a.defaultValue,s=a.size;if(Number.isFinite(e))return n[i]=e,n;if(!e){for(var u=s;--u>=0;)n[i+u]=o[u];return n}switch(s){case 4:n[i+3]=Number.isFinite(e[3])?e[3]:o[3];case 3:n[i+2]=Number.isFinite(e[2])?e[2]:o[2];case 2:n[i+1]=Number.isFinite(e[1])?e[1]:o[1];case 1:n[i+0]=Number.isFinite(e[0])?e[0]:o[0];break;default:for(var l=s;--l>=0;)n[i+l]=Number.isFinite(e[l])?e[l]:o[l]}return n}},{key:"_areValuesEqual",value:function(e,n){if(!e||!n)return!1;for(var i=this.size,a=0;a<i;a++)if(e[a]!==n[a])return!1;return!0}}]),t}();var mV=[],gV=[];function Ut(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1/0,n=mV,i={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?n=t:t.length>0&&(gV.length=t.length,n=gV):n=mV,(r>0||Number.isFinite(e))&&(n=(Array.isArray(n)?n:Array.from(n)).slice(r,e),i.index=r-1),{iterable:n,objectInfo:i}}function Hg(t){return t&&t[Symbol.asyncIterator]}function Wg(t,r){var e=r.size,n=r.stride,i=r.offset,a=r.startIndices,o=r.nested,s=t.BYTES_PER_ELEMENT,u=n?n/s:e,l=i?i/s:0,f=Math.floor((t.length-l)/u);return function(c,p){var d=p.index,v=p.target;if(!a){for(var m=d*u+l,g=0;g<e;g++)v[g]=t[m+g];return v}var y=a[d],_=a[d+1]||f,b;if(o){b=new Array(_-y);for(var x=y;x<_;x++){var A=x*u+l;v=new Array(e);for(var S=0;S<e;S++)v[S]=t[A+S];b[x-y]=v}}else if(u===e)b=t.subarray(y*e+l,_*e+l);else{b=new t.constructor((_-y)*e);for(var P=0,O=y;O<_;O++)for(var C=O*u+l,T=0;T<e;T++)b[P++]=t[C+T]}return b}}var yV=[],Xp=[[0,1/0]];function _V(t,r){if(t===Xp||(r[0]<0&&(r[0]=0),r[0]>=r[1]))return t;for(var e=[],n=t.length,i=0,a=0;a<n;a++){var o=t[a];o[1]<r[0]?(e.push(o),i=a+1):o[0]>r[1]?e.push(o):r=[Math.min(o[0],r[0]),Math.max(o[1],r[1])]}return e.splice(i,0,r),e}var AV=h(B());function WT(t){var r=t.source,e=t.target,n=t.start,i=n===void 0?0:n,a=t.size,o=t.getData,s=t.end||e.length,u=r.length,l=s-i;if(u>l){e.set(r.subarray(0,l),i);return}if(e.set(r,i),!!o)for(var f=u;f<l;)for(var c=o(f,r),p=0;p<a;p++)e[i+f]=c[p]||0,f++}function bV(t){var r=t.source,e=t.target,n=t.size,i=t.getData,a=t.sourceStartIndices,o=t.targetStartIndices;if(!Array.isArray(o))return WT({source:r,target:e,size:n,getData:i}),e;for(var s=0,u=0,l=i&&function(v,m){return i(v+u,m)},f=Math.min(a.length,o.length),c=1;c<f;c++){var p=a[c]*n,d=o[c]*n;WT({source:r.subarray(s,p),target:e,start:u,end:d,size:n,getData:l}),s=p,u=d}return u<e.length&&WT({source:[],target:e,start:u,size:n,getData:l}),e}function xV(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function $g(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?xV(Object(e),!0).forEach(function(n){(0,AV.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):xV(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var pxe={interpolation:{duration:0,easing:function(r){return r}},spring:{stiffness:.05,damping:.5}};function Xg(t,r){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});var e=t.type||"interpolation";return $g($g($g($g({},pxe[e]),r),t),{},{type:e})}function qg(t,r){var e=r.getBuffer();return e?[e,{divisor:0,size:r.size,normalized:r.settings.normalized}]:r.value}function Yg(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(t,'"'))}}function Kg(t){t.push(t.shift())}function qp(t,r){var e=t.doublePrecision,n=t.settings,i=t.value,a=t.size,o=e&&i instanceof Float64Array?2:1;return(n.noAlloc?i.length:r*a)*o}function Zg(t){var r=t.buffer,e=t.numInstances,n=t.attribute,i=t.fromLength,a=t.fromStartIndices,o=t.getData,s=o===void 0?function(x){return x}:o,u=n.doublePrecision&&n.value instanceof Float64Array?2:1,l=n.size*u,f=n.byteOffset,c=n.startIndices,p=a&&c,d=qp(n,e),v=n.isConstant;if(!(!p&&i>=d)){var m=v?n.value:n.getBuffer().getData({srcByteOffset:f});if(n.settings.normalized&&!v){var g=s;s=function(A,S){return n.normalizeConstant(g(A,S))}}var y=v?function(x,A){return s(m,A)}:function(x,A){return s(m.subarray(x,x+l),A)},_=r.getData({length:i}),b=new Float32Array(d);bV({source:_,target:b,sourceStartIndices:a,targetStartIndices:c,size:l,getData:y}),r.byteLength<b.byteLength+f&&r.reallocate(b.byteLength+f),r.subData({data:b,offset:f})}}function Jg(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=hxe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function hxe(t,r){if(t){if(typeof t=="string")return SV(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return SV(t,r)}}function SV(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function dxe(t){var r=vxe();return function(){var n=(0,Wl.default)(t),i;if(r){var a=(0,Wl.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,EV.default)(this,i)}}function vxe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var $l=function(t){(0,OV.default)(e,t);var r=dxe(e);function e(n,i){var a;return(0,TV.default)(this,e),a=r.call(this,n,i,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:Xp}),(0,XT.default)((0,PV.default)(a),"constant",!1),a.settings.update=i.update||(i.accessor?a._autoUpdater:void 0),Object.seal(a.settings),Object.seal(a.state),a._validateAttributeUpdaters(),a}return(0,wV.default)(e,[{key:"startIndices",get:function(){return this.state.startIndices},set:function(i){this.state.startIndices=i}},{key:"needsUpdate",value:function(){return this.state.needsUpdate}},{key:"needsRedraw",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=i.clearChangedFlags,o=a===void 0?!1:a,s=this.state.needsRedraw;return this.state.needsRedraw=s&&!o,s}},{key:"getUpdateTriggers",value:function(){var i=this.settings.accessor;return[this.id].concat(typeof i!="function"&&i||[])}},{key:"supportsTransition",value:function(){return Boolean(this.settings.transition)}},{key:"getTransitionSetting",value:function(i){if(!i||!this.supportsTransition())return null;var a=this.settings.accessor,o=this.settings.transition,s=Array.isArray(a)?i[a.find(function(u){return i[u]})]:i[a];return Xg(s,o)}},{key:"setNeedsUpdate",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.id,a=arguments.length>1?arguments[1]:void 0;if(this.state.needsUpdate=this.state.needsUpdate||i,this.setNeedsRedraw(i),a){var o=a.startRow,s=o===void 0?0:o,u=a.endRow,l=u===void 0?1/0:u;this.state.updateRanges=_V(this.state.updateRanges,[s,l])}else this.state.updateRanges=Xp}},{key:"clearNeedsUpdate",value:function(){this.state.needsUpdate=!1,this.state.updateRanges=yV}},{key:"setNeedsRedraw",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.id;this.state.needsRedraw=this.state.needsRedraw||i}},{key:"allocate",value:function(i){var a=this.state,o=this.settings;return o.noAlloc?!1:o.update?((0,Qg.default)((0,Wl.default)(e.prototype),"allocate",this).call(this,i,a.updateRanges!==Xp),!0):!1}},{key:"updateBuffer",value:function(i){var a=i.numInstances,o=i.data,s=i.props,u=i.context;if(!this.needsUpdate())return!1;var l=this.state.updateRanges,f=this.settings,c=f.update,p=f.noAlloc,d=!0;if(c){var v=Jg(l),m;try{for(v.s();!(m=v.n()).done;){var g=(0,$T.default)(m.value,2),y=g[0],_=g[1];c.call(u,this,{data:o,startRow:y,endRow:_,props:s,numInstances:a})}}catch(T){v.e(T)}finally{v.f()}if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else{var b=Jg(l),x;try{for(b.s();!(x=b.n()).done;){var A=(0,$T.default)(x.value,2),S=A[0],P=A[1],O=Number.isFinite(S)?this.getVertexOffset(S):0,C=Number.isFinite(P)?this.getVertexOffset(P):p||!Number.isFinite(a)?this.value.length:a*this.size;(0,Qg.default)((0,Wl.default)(e.prototype),"updateSubBuffer",this).call(this,{startOffset:O,endOffset:C})}}catch(T){b.e(T)}finally{b.f()}}this._checkAttributeArray()}else d=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),d}},{key:"setConstantValue",value:function(i){if(i===void 0||typeof i=="function")return!1;var a=this.setData({constant:!0,value:i});return a&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0}},{key:"setExternalBuffer",value:function(i){var a=this.state;return i?(this.clearNeedsUpdate(),a.lastExternalBuffer===i||(a.lastExternalBuffer=i,this.setNeedsRedraw(),this.setData(i)),!0):(a.lastExternalBuffer=null,!1)}},{key:"setBinaryValue",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,o=this.state,s=this.settings;if(!i)return o.binaryValue=null,o.binaryAccessor=null,!1;if(s.noAlloc)return!1;if(o.binaryValue===i)return this.clearNeedsUpdate(),!0;o.binaryValue=i,this.setNeedsRedraw();var u=s.transform||a!==this.startIndices;if(u){ArrayBuffer.isView(i)&&(i={value:i});var l=i;rt(ArrayBuffer.isView(l.value),"invalid ".concat(s.accessor));var f=Boolean(l.size)&&l.size!==this.size;return o.binaryAccessor=Wg(l.value,{size:l.size||this.size,stride:l.stride,offset:l.offset,startIndices:a,nested:f}),!1}return this.clearNeedsUpdate(),this.setData(i),!0}},{key:"getVertexOffset",value:function(i){var a=this.startIndices,o=a?i<a.length?a[i]:this.numInstances:i;return o*this.size}},{key:"getShaderAttributes",value:function(){var i=this.settings.shaderAttributes||(0,XT.default)({},this.id,null),a={};for(var o in i)Object.assign(a,(0,Qg.default)((0,Wl.default)(e.prototype),"getShaderAttributes",this).call(this,o,i[o]));return a}},{key:"_autoUpdater",value:function(i,a){var o=a.data,s=a.startRow,u=a.endRow,l=a.props,f=a.numInstances;if(!i.constant){var c=i.settings,p=i.state,d=i.value,v=i.size,m=i.startIndices,g=c.accessor,y=c.transform,_=p.binaryAccessor||(typeof g=="function"?g:l[g]);rt(typeof _=="function",'accessor "'.concat(g,'" is not a function'));var b=i.getVertexOffset(s),x=Ut(o,s,u),A=x.iterable,S=x.objectInfo,P=Jg(A),O;try{for(P.s();!(O=P.n()).done;){var C=O.value;S.index++;var T=_(C,S);if(y&&(T=y.call(this,T)),m){var I=(S.index<m.length-1?m[S.index+1]:f)-m[S.index];if(T&&Array.isArray(T[0])){var R=b,V=Jg(T),z;try{for(V.s();!(z=V.n()).done;){var k=z.value;i._normalizeValue(k,d,R),R+=v}}catch(G){V.e(G)}finally{V.f()}}else T&&T.length>v?d.set(T,b):(i._normalizeValue(T,S.target,0),Pg({target:d,source:S.target,start:b,count:I}));b+=I*v}else i._normalizeValue(T,d,b),b+=v}}catch(G){P.e(G)}finally{P.f()}}}},{key:"_validateAttributeUpdaters",value:function(){var i=this.settings,a=i.noAlloc||typeof i.update=="function";if(!a)throw new Error("Attribute ".concat(this.id," missing update or accessor"))}},{key:"_checkAttributeArray",value:function(){var i=this.value,a=Math.min(4,this.size);if(i&&i.length>=a){var o=!0;switch(a){case 4:o=o&&Number.isFinite(i[3]);case 3:o=o&&Number.isFinite(i[2]);case 2:o=o&&Number.isFinite(i[1]);case 1:o=o&&Number.isFinite(i[0]);break;default:o=!1}if(!o)throw new Error("Illegal attribute generated for ".concat(this.id))}}}]),e}(vV);var GV=h(L()),zV=h(N()),Oo=h(B());var RV=h(L()),LV=h(N()),Bn=h(B());function CV(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function mxe(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?CV(Object(e),!0).forEach(function(n){(0,Bn.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):CV(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function MV(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=gxe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function gxe(t,r){if(t){if(typeof t=="string")return IV(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return IV(t,r)}}function IV(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var kV=function(){function t(r){var e=r.gl,n=r.attribute,i=r.timeline;(0,RV.default)(this,t),(0,Bn.default)(this,"gl",void 0),(0,Bn.default)(this,"type","interpolation"),(0,Bn.default)(this,"attributeInTransition",void 0),(0,Bn.default)(this,"settings",void 0),(0,Bn.default)(this,"attribute",void 0),(0,Bn.default)(this,"transition",void 0),(0,Bn.default)(this,"currentStartIndices",void 0),(0,Bn.default)(this,"currentLength",void 0),(0,Bn.default)(this,"transform",void 0),(0,Bn.default)(this,"buffers",void 0),this.gl=e,this.transition=new Ui(i),this.attribute=n,this.attributeInTransition=new $l(e,n.settings),this.currentStartIndices=n.startIndices,this.currentLength=0,this.transform=_xe(e,n);var a={byteLength:0,usage:35050};this.buffers=[new xe(e,a),new xe(e,a)]}return(0,LV.default)(t,[{key:"inProgress",get:function(){return this.transition.inProgress}},{key:"start",value:function(e,n){if(e.duration<=0){this.transition.cancel();return}this.settings=e;var i=this.gl,a=this.buffers,o=this.attribute;Kg(a);var s={numInstances:n,attribute:o,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter},u=MV(a),l;try{for(u.s();!(l=u.n()).done;){var f=l.value;Zg(mxe({buffer:f},s))}}catch(c){u.e(c)}finally{u.f()}this.currentStartIndices=o.startIndices,this.currentLength=qp(o,n),this.attributeInTransition.setData({buffer:a[1],value:o.value}),this.transition.start(e),this.transform.update({elementCount:Math.floor(this.currentLength/o.size),sourceBuffers:{aFrom:a[0],aTo:qg(i,o)},feedbackBuffers:{vCurrent:a[1]}})}},{key:"update",value:function(){var e=this.transition.update();if(e){var n=this.settings,i=n.duration,a=n.easing,o=this.transition.time,s=o/i;a&&(s=a(s)),this.transform.run({uniforms:{time:s}})}return e}},{key:"cancel",value:function(){this.transition.cancel(),this.transform.delete();var e=MV(this.buffers),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;i.delete()}}catch(a){e.e(a)}finally{e.f()}this.buffers.length=0}}]),t}();var yxe=`
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
attribute ATTRIBUTE_TYPE aFrom;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function _xe(t,r){var e=Yg(r.size);return new Nr(t,{vs:yxe,defines:{ATTRIBUTE_TYPE:e},varyings:["vCurrent"]})}var NV=h(L()),jV=h(N()),Gr=h(B());function BV(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=bxe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function bxe(t,r){if(t){if(typeof t=="string")return FV(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return FV(t,r)}}function FV(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function DV(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Yp(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?DV(Object(e),!0).forEach(function(n){(0,Gr.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):DV(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var UV=function(){function t(r){var e=r.gl,n=r.attribute,i=r.timeline;(0,NV.default)(this,t),(0,Gr.default)(this,"gl",void 0),(0,Gr.default)(this,"type","spring"),(0,Gr.default)(this,"attributeInTransition",void 0),(0,Gr.default)(this,"settings",void 0),(0,Gr.default)(this,"attribute",void 0),(0,Gr.default)(this,"transition",void 0),(0,Gr.default)(this,"currentStartIndices",void 0),(0,Gr.default)(this,"currentLength",void 0),(0,Gr.default)(this,"texture",void 0),(0,Gr.default)(this,"framebuffer",void 0),(0,Gr.default)(this,"transform",void 0),(0,Gr.default)(this,"buffers",void 0),this.gl=e,this.type="spring",this.transition=new Ui(i),this.attribute=n,this.attributeInTransition=new $l(e,Yp(Yp({},n.settings),{},{normalized:!1})),this.currentStartIndices=n.startIndices,this.currentLength=0,this.texture=Axe(e),this.framebuffer=Sxe(e,this.texture),this.transform=xxe(e,n,this.framebuffer);var a={byteLength:0,usage:35050};this.buffers=[new xe(e,a),new xe(e,a),new xe(e,a)]}return(0,jV.default)(t,[{key:"inProgress",get:function(){return this.transition.inProgress}},{key:"start",value:function(e,n){var i=this.gl,a=this.buffers,o=this.attribute,s={numInstances:n,attribute:o,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter},u=BV(a),l;try{for(u.s();!(l=u.n()).done;){var f=l.value;Zg(Yp({buffer:f},s))}}catch(c){u.e(c)}finally{u.f()}this.settings=e,this.currentStartIndices=o.startIndices,this.currentLength=qp(o,n),this.attributeInTransition.setData({buffer:a[1],value:o.value}),this.transition.start(Yp(Yp({},e),{},{duration:1/0})),this.transform.update({elementCount:Math.floor(this.currentLength/o.size),sourceBuffers:{aTo:qg(i,o)}})}},{key:"update",value:function(){var e=this.buffers,n=this.transform,i=this.framebuffer,a=this.transition,o=a.update();if(!o)return!1;var s=this.settings;n.update({sourceBuffers:{aPrev:e[0],aCur:e[1]},feedbackBuffers:{vNext:e[2]}}),n.run({framebuffer:i,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:s.stiffness,damping:s.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),Kg(e),this.attributeInTransition.setData({buffer:e[1],value:this.attribute.value});var u=ei(i)[0]>0;return u||a.end(),!0}},{key:"cancel",value:function(){this.transition.cancel(),this.transform.delete();var e=BV(this.buffers),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;i.delete()}}catch(a){e.e(a)}finally{e.f()}this.buffers.length=0,this.texture.delete(),this.framebuffer.delete()}}]),t}();function xxe(t,r,e){var n=Yg(r.size);return new Nr(t,{framebuffer:e,vs:`
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
attribute ATTRIBUTE_TYPE aPrev;
attribute ATTRIBUTE_TYPE aCur;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vNext;
varying float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,fs:`
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

varying float vIsTransitioningFlag;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  gl_FragColor = vec4(1.0);
}`,defines:{ATTRIBUTE_TYPE:n},varyings:["vNext"]})}function Axe(t){return new we(t,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}function Sxe(t,r){return new Re(t,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:(0,Gr.default)({},36064,r)})}var Txe={interpolation:kV,spring:UV},VV=function(){function t(r,e){var n=e.id,i=e.timeline;(0,GV.default)(this,t),(0,Oo.default)(this,"id",void 0),(0,Oo.default)(this,"isSupported",void 0),(0,Oo.default)(this,"gl",void 0),(0,Oo.default)(this,"timeline",void 0),(0,Oo.default)(this,"transitions",void 0),(0,Oo.default)(this,"needsRedraw",void 0),(0,Oo.default)(this,"numInstances",void 0),this.id=n,this.gl=r,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=Nr.isSupported(r)}return(0,zV.default)(t,[{key:"finalize",value:function(){for(var e in this.transitions)this._removeTransition(e)}},{key:"update",value:function(e){var n=e.attributes,i=e.transitions,a=e.numInstances;this.numInstances=a||1;for(var o in n){var s=n[o],u=s.getTransitionSetting(i);u&&this._updateAttribute(o,s,u)}for(var l in this.transitions){var f=n[l];(!f||!f.getTransitionSetting(i))&&this._removeTransition(l)}}},{key:"hasAttribute",value:function(e){var n=this.transitions[e];return n&&n.inProgress}},{key:"getAttributes",value:function(){var e={};for(var n in this.transitions){var i=this.transitions[n];i.inProgress&&(e[n]=i.attributeInTransition)}return e}},{key:"run",value:function(){if(!this.isSupported||this.numInstances===0)return!1;for(var e in this.transitions){var n=this.transitions[e].update();n&&(this.needsRedraw=!0)}var i=this.needsRedraw;return this.needsRedraw=!1,i}},{key:"_removeTransition",value:function(e){this.transitions[e].cancel(),delete this.transitions[e]}},{key:"_updateAttribute",value:function(e,n,i){var a=this.transitions[e],o=!a||a.type!==i.type;if(o){if(!this.isSupported){J.warn("WebGL2 not supported by this browser. Transition for ".concat(e," is disabled."))();return}a&&this._removeTransition(e);var s=Txe[i.type];s?this.transitions[e]=new s({attribute:n,timeline:this.timeline,gl:this.gl}):(J.error("unsupported transition type '".concat(i.type,"'"))(),o=!1)}(o||n.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(i,this.numInstances))}}]),t}();function HV(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function qT(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?HV(Object(e),!0).forEach(function(n){(0,pi.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):HV(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function wxe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=Pxe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function Pxe(t,r){if(t){if(typeof t=="string")return WV(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return WV(t,r)}}function WV(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var $V="attributeManager.invalidate",Oxe="attributeManager.updateStart",Exe="attributeManager.updateEnd",Cxe="attribute.updateStart",Mxe="attribute.allocate",Ixe="attribute.updateEnd",Eo=function(){function t(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=e.id,i=n===void 0?"attribute-manager":n,a=e.stats,o=e.timeline;(0,XV.default)(this,t),(0,pi.default)(this,"id",void 0),(0,pi.default)(this,"gl",void 0),(0,pi.default)(this,"attributes",void 0),(0,pi.default)(this,"updateTriggers",void 0),(0,pi.default)(this,"needsRedraw",void 0),(0,pi.default)(this,"userData",void 0),(0,pi.default)(this,"stats",void 0),(0,pi.default)(this,"attributeTransitionManager",void 0),(0,pi.default)(this,"mergeBoundsMemoized",qr(_U)),this.id=i,this.gl=r,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=a,this.attributeTransitionManager=new VV(r,{id:"".concat(i,"-transitions"),timeline:o}),Object.seal(this)}return(0,qV.default)(t,[{key:"finalize",value:function(){for(var e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}},{key:"getNeedsRedraw",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1},n=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,n&&this.id}},{key:"setNeedsRedraw",value:function(){this.needsRedraw=!0}},{key:"add",value:function(e){this._add(e)}},{key:"addInstanced",value:function(e){this._add(e,{instanced:1})}},{key:"remove",value:function(e){var n=wxe(e),i;try{for(n.s();!(i=n.n()).done;){var a=i.value;this.attributes[a]!==void 0&&(this.attributes[a].delete(),delete this.attributes[a])}}catch(o){n.e(o)}finally{n.f()}}},{key:"invalidate",value:function(e,n){var i=this._invalidateTrigger(e,n);Nt($V,this,e,i)}},{key:"invalidateAll",value:function(e){for(var n in this.attributes)this.attributes[n].setNeedsUpdate(n,e);Nt($V,this,"all")}},{key:"update",value:function(e){var n=e.data,i=e.numInstances,a=e.startIndices,o=a===void 0?null:a,s=e.transitions,u=e.props,l=u===void 0?{}:u,f=e.buffers,c=f===void 0?{}:f,p=e.context,d=p===void 0?{}:p,v=!1;Nt(Oxe,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(var m in this.attributes){var g=this.attributes[m],y=g.settings.accessor;g.startIndices=o,g.numInstances=i,l[m]&&J.removed("props.".concat(m),"data.attributes.".concat(m))(),g.setExternalBuffer(c[m])||g.setBinaryValue(typeof y=="string"?c[y]:void 0,n.startIndices)||typeof y=="string"&&!c[y]&&g.setConstantValue(l[y])||g.needsUpdate()&&(v=!0,this._updateAttribute({attribute:g,numInstances:i,data:n,props:l,context:d})),this.needsRedraw=this.needsRedraw||g.needsRedraw()}v&&Nt(Exe,this,i),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:i,transitions:s})}},{key:"updateTransition",value:function(){var e=this.attributeTransitionManager,n=e.run();return this.needsRedraw=this.needsRedraw||n,n}},{key:"getAttributes",value:function(){return this.attributes}},{key:"getBounds",value:function(e){var n=this,i=e.map(function(a){var o;return(o=n.attributes[a])===null||o===void 0?void 0:o.getBounds()});return this.mergeBoundsMemoized(i)}},{key:"getChangedAttributes",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearChangedFlags:!1},n=this.attributes,i=this.attributeTransitionManager,a=qT({},i.getAttributes());for(var o in n){var s=n[o];s.needsRedraw(e)&&!i.hasAttribute(o)&&(a[o]=s)}return a}},{key:"getShaderAttributes",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e||(e=this.getAttributes());var i={};for(var a in e)n[a]||Object.assign(i,e[a].getShaderAttributes());return i}},{key:"_add",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};for(var i in e){var a=e[i];this.attributes[i]=this._createAttribute(i,a,n)}this._mapUpdateTriggersToAttributes()}},{key:"_createAttribute",value:function(e,n,i){var a=qT(qT({},n),{},{id:e,size:n.isIndexed&&1||n.size||1,divisor:i.instanced?1:n.divisor||0});return new $l(this.gl,a)}},{key:"_mapUpdateTriggersToAttributes",value:function(){var e=this,n={},i=function(s){var u=e.attributes[s];u.getUpdateTriggers().forEach(function(l){n[l]||(n[l]=[]),n[l].push(s)})};for(var a in this.attributes)i(a);this.updateTriggers=n}},{key:"_invalidateTrigger",value:function(e,n){var i=this.attributes,a=this.updateTriggers,o=a[e];return o&&o.forEach(function(s){var u=i[s];u&&u.setNeedsUpdate(u.id,n)}),o}},{key:"_updateAttribute",value:function(e){var n=e.attribute,i=e.numInstances;if(Nt(Cxe,n),n.constant){n.setConstantValue(n.value);return}n.allocate(i)&&Nt(Mxe,n,i);var a=n.updateBuffer(e);a&&(this.needsRedraw=!0,Nt(Ixe,n,i))}}]),t}();var sw=h(me()),K8=h(L()),Z8=h(N()),Kl=h(be()),J8=h(Y()),Q8=h(K()),uw=h(q()),Ca=h(B());var p8=h(me()),h8=h(B()),d8=h(L()),v8=h(N());var YV=h(L()),KV=h(N()),ZV=h(Y()),JV=h(K()),YT=h(q());function Rxe(t){var r=Lxe();return function(){var n=(0,YT.default)(t),i;if(r){var a=(0,YT.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,JV.default)(this,i)}}function Lxe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var QV=function(t){(0,ZV.default)(e,t);var r=Rxe(e);function e(){return(0,YV.default)(this,e),r.apply(this,arguments)}return(0,KV.default)(e,[{key:"value",get:function(){return this._value}},{key:"_onUpdate",value:function(){var i=this.time,a=this.settings,o=a.fromValue,s=a.toValue,u=a.duration,l=a.easing,f=l(i/u);this._value=sr(o,s,f)}}]),e}(Ui);var n8=h(L()),i8=h(N()),a8=h(Y()),o8=h(K()),KT=h(q());function kxe(t){var r=Bxe();return function(){var n=(0,KT.default)(t),i;if(r){var a=(0,KT.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,o8.default)(this,i)}}function Bxe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var e8=1e-5;function t8(t,r,e,n,i){var a=r-t,o=e-r,s=o*i,u=-a*n;return s+u+a+r}function Fxe(t,r,e,n,i){if(Array.isArray(e)){for(var a=[],o=0;o<e.length;o++)a[o]=t8(t[o],r[o],e[o],n,i);return a}return t8(t,r,e,n,i)}function r8(t,r){if(Array.isArray(t)){for(var e=0,n=0;n<t.length;n++){var i=t[n]-r[n];e+=i*i}return Math.sqrt(e)}return Math.abs(t-r)}var s8=function(t){(0,a8.default)(e,t);var r=kxe(e);function e(){return(0,n8.default)(this,e),r.apply(this,arguments)}return(0,i8.default)(e,[{key:"value",get:function(){return this._currValue}},{key:"_onUpdate",value:function(){var i=this.settings,a=i.fromValue,o=i.toValue,s=i.damping,u=i.stiffness,l=this._prevValue,f=l===void 0?a:l,c=this._currValue,p=c===void 0?a:c,d=Fxe(f,p,o,s,u),v=r8(d,o),m=r8(d,p);v<e8&&m<e8&&(d=o,this.end()),this._prevValue=p,this._currValue=d}}]),e}(Ui);function u8(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=Dxe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function Dxe(t,r){if(t){if(typeof t=="string")return l8(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return l8(t,r)}}function l8(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function f8(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function c8(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?f8(Object(e),!0).forEach(function(n){(0,h8.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):f8(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var Nxe={interpolation:QV,spring:s8},m8=function(){function t(r){(0,d8.default)(this,t),this.transitions=new Map,this.timeline=r}return(0,v8.default)(t,[{key:"active",get:function(){return this.transitions.size>0}},{key:"add",value:function(e,n,i,a){var o=this.transitions;if(o.has(e)){var s=o.get(e),u=s.value,l=u===void 0?s.settings.fromValue:u;n=l,this.remove(e)}if(a=Xg(a),!!a){var f=Nxe[a.type];if(!f){J.error("unsupported transition type '".concat(a.type,"'"))();return}var c=new f(this.timeline);c.start(c8(c8({},a),{},{fromValue:n,toValue:i})),o.set(e,c)}}},{key:"remove",value:function(e){var n=this.transitions;n.has(e)&&(n.get(e).cancel(),n.delete(e))}},{key:"update",value:function(){var e={},n=u8(this.transitions),i;try{for(n.s();!(i=n.n()).done;){var a=(0,p8.default)(i.value,2),o=a[0],s=a[1];s.update(),e[o]=s.value,s.inProgress||this.remove(o)}}catch(u){n.e(u)}finally{n.f()}return e}},{key:"clear",value:function(){var e=u8(this.transitions.keys()),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;this.remove(i)}}catch(a){e.e(a)}finally{e.f()}}}]),t}();var ZT=h(ze());function y8(t){var r=t[In];for(var e in r){var n=r[e],i=n.validate;if(i&&!i(t[e],n))throw new Error("Invalid prop ".concat(e,": ").concat(t[e]))}}function _8(t,r){var e=Xl({newProps:t,oldProps:r,propTypes:t[In],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),n=Uxe(t,r),i=!1;return n||(i=Gxe(t,r)),{dataChanged:n,propsChanged:e,updateTriggersChanged:i,extensionsChanged:zxe(t,r),transitionsChanged:jxe(t,r)}}function jxe(t,r){if(!t.transitions)return!1;var e={},n=t[In],i=!1;for(var a in t.transitions){var o=n[a],s=o&&o.type,u=s==="number"||s==="color"||s==="array";u&&JT(t[a],r[a],o)&&(e[a]=!0,i=!0)}return i?e:!1}function Xl(t){var r=t.newProps,e=t.oldProps,n=t.ignoreProps,i=n===void 0?{}:n,a=t.propTypes,o=a===void 0?{}:a,s=t.triggerName,u=s===void 0?"props":s;if(e===r)return!1;if((0,ZT.default)(r)!=="object"||r===null||(0,ZT.default)(e)!=="object"||e===null)return"".concat(u," changed shallowly");for(var l=0,f=Object.keys(r);l<f.length;l++){var c=f[l];if(!(c in i)){if(!(c in e))return"".concat(u,".").concat(c," added");var p=JT(r[c],e[c],o[c]);if(p)return"".concat(u,".").concat(c," ").concat(p)}}for(var d=0,v=Object.keys(e);d<v.length;d++){var m=v[d];if(!(m in i)){if(!(m in r))return"".concat(u,".").concat(m," dropped");if(!Object.hasOwnProperty.call(r,m)){var g=JT(r[m],e[m],o[m]);if(g)return"".concat(u,".").concat(m," ").concat(g)}}}return!1}function JT(t,r,e){var n=e&&e.equal;return n&&!n(t,r,e)||!n&&(n=t&&r&&t.equals,n&&!n.call(t,r))?"changed deeply":!n&&r!==t?"changed shallowly":null}function Uxe(t,r){if(r===null)return"oldProps is null, initial diff";var e=!1,n=t.dataComparator,i=t._dataDiff;return n?n(t.data,r.data)||(e="Data comparator detected a change"):t.data!==r.data&&(e="A new data container was supplied"),e&&i&&(e=i(t.data,r.data)||e),e}function Gxe(t,r){if(r===null)return{all:!0};if("all"in t.updateTriggers){var e=g8(t,r,"all");if(e)return{all:!0}}var n={},i=!1;for(var a in t.updateTriggers)if(a!=="all"){var o=g8(t,r,a);o&&(n[a]=!0,i=!0)}return i?n:!1}function zxe(t,r){if(r===null)return!0;var e=r.extensions,n=t.extensions;if(n===e)return!1;if(!e||!n||n.length!==e.length)return!0;for(var i=0;i<n.length;i++)if(!n[i].equals(e[i]))return!0;return!1}function g8(t,r,e){var n=t.updateTriggers[e];n=n??{};var i=r.updateTriggers[e];i=i??{};var a=Xl({oldProps:i,newProps:n,triggerName:e});return a}var QT=h(ze()),Vxe="count(): argument not an object",Hxe="count(): argument not a container";function ey(t){if(!$xe(t))throw new Error(Vxe);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(Wxe(t))return Object.keys(t).length;throw new Error(Hxe)}function Wxe(t){return t!==null&&(0,QT.default)(t)==="object"&&t.constructor===Object}function $xe(t){return t!==null&&(0,QT.default)(t)==="object"}var x8=h(B());function b8(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Kp(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?b8(Object(e),!0).forEach(function(n){(0,x8.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):b8(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function Ea(t,r){if(!r)return t;var e=Kp(Kp({},t),r);if("defines"in r&&(e.defines=Kp(Kp({},t.defines),r.defines)),"modules"in r&&(e.modules=(t.modules||[]).concat(r.modules),r.modules.some(function(o){return o.name==="project64"}))){var n=e.modules.findIndex(function(o){return o.name==="project32"});n>=0&&e.modules.splice(n,1)}if("inject"in r)if(!t.inject)e.inject=r.inject;else{var i=Kp({},t.inject);for(var a in r.inject)i[a]=(i[a]||"")+r.inject[a];e.inject=i}return e}var k8=h(L()),B8=h(N()),Xs=h(B());var P8=h(ze()),O8=h(me()),E8=h(B());var $s=h(B());var ql;function A8(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Zp(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?A8(Object(e),!0).forEach(function(n){(0,$s.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):A8(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var Xxe=(ql={},(0,$s.default)(ql,10241,9987),(0,$s.default)(ql,10240,9729),(0,$s.default)(ql,10242,33071),(0,$s.default)(ql,10243,33071),ql),ew={};function S8(t,r,e,n){if(e instanceof we)return e;e.constructor&&e.constructor.name!=="Object"&&(e={data:e});var i=null;e.compressed&&(i=(0,$s.default)({},10241,e.data.length>1?9985:9729));var a=new we(r,Zp(Zp({},e),{},{parameters:Zp(Zp(Zp({},Xxe),i),n)}));return ew[a.id]=t,a}function T8(t,r){!r||!(r instanceof we)||ew[r.id]===t&&(r.delete(),delete ew[r.id])}function w8(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Qp(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?w8(Object(e),!0).forEach(function(n){(0,E8.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):w8(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var qxe={boolean:{validate:function(r,e){return!0},equal:function(r,e,n){return Boolean(r)===Boolean(e)}},number:{validate:function(r,e){return Number.isFinite(r)&&(!("max"in e)||r<=e.max)&&(!("min"in e)||r>=e.min)}},color:{validate:function(r,e){return e.optional&&!r||tw(r)&&(r.length===3||r.length===4)},equal:function(r,e,n){return Lt(r,e,1)}},accessor:{validate:function(r,e){var n=ty(r);return n==="function"||n===ty(e.value)},equal:function(r,e,n){return typeof e=="function"?!0:Lt(r,e,1)}},array:{validate:function(r,e){return e.optional&&!r||tw(r)},equal:function(r,e,n){var i=n.compare,a=Number.isInteger(i)?i:i?1:0;return i?Lt(r,e,a):r===e}},object:{equal:function(r,e,n){if(n.ignore)return!0;var i=n.compare,a=Number.isInteger(i)?i:i?1:0;return i?Lt(r,e,a):r===e}},function:{validate:function(r,e){return e.optional&&!r||typeof r=="function"},equal:function(r,e,n){var i=!n.compare&&n.ignore!==!1;return i||r===e}},data:{transform:function(r,e,n){var i=n.props.dataTransform;return i&&r?i(r):r}},image:{transform:function(r,e,n){var i=n.context;return!i||!i.gl?null:S8(n.id,i.gl,r,Qp(Qp({},e.parameters),n.props.textureParameters))},release:function(r,e,n){T8(n.id,r)}}};function C8(t){for(var r={},e={},n={},i=0,a=Object.entries(t);i<a.length;i++){var o=(0,O8.default)(a[i],2),s=o[0],u=o[1],l=u?.deprecatedFor;if(l)n[s]=Array.isArray(l)?l:[l];else{var f=Yxe(s,u);r[s]=f,e[s]=f.value}}return{propTypes:r,defaultProps:e,deprecatedProps:n}}function Yxe(t,r){switch(ty(r)){case"object":return Jp(t,r);case"array":return Jp(t,{type:"array",value:r,compare:!1});case"boolean":return Jp(t,{type:"boolean",value:r});case"number":return Jp(t,{type:"number",value:r});case"function":return Jp(t,{type:"function",value:r,compare:!0});default:return{name:t,type:"unknown",value:r}}}function Jp(t,r){return"type"in r?Qp(Qp({name:t},qxe[r.type]),r):"value"in r?Qp({name:t,type:ty(r.value)},r):{name:t,type:"object",value:r}}function tw(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function ty(t){return tw(t)?"array":t===null?"null":(0,P8.default)(t)}function nw(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=Kxe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function Kxe(t,r){if(t){if(typeof t=="string")return M8(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return M8(t,r)}}function M8(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function I8(t,r){for(var e,n=r.length-1;n>=0;n--){var i=r[n];"extensions"in i&&(e=i.extensions)}var a=rw(t.constructor,e),o=Object.create(a);o[Fl]=t,o[Di]={},o[ui]={};for(var s=0;s<r.length;++s){var u=r[s];for(var l in u)o[l]=u[l]}return Object.freeze(o),o}var Zxe="_mergedDefaultProps";function rw(t,r){var e=Zxe;if(r){var n=nw(r),i;try{for(n.s();!(i=n.n()).done;){var a=i.value,o=a.constructor;o&&(e+=":".concat(o.extensionName||o.name))}}catch(u){n.e(u)}finally{n.f()}}var s=R8(t,e);return s||(t[e]=Jxe(t,r||[]))}function Jxe(t,r){var e=t.prototype;if(!e)return null;var n=Object.getPrototypeOf(t),i=rw(n),a=R8(t,"defaultProps")||{},o=C8(a),s=Object.assign(Object.create(null),i,o.defaultProps),u=Object.assign(Object.create(null),i?.[In],o.propTypes),l=Object.assign(Object.create(null),i?.[wg],o.deprecatedProps),f=nw(r),c;try{for(f.s();!(c=f.n()).done;){var p=c.value,d=rw(p.constructor);d&&(Object.assign(s,d),Object.assign(u,d[In]),Object.assign(l,d[wg]))}}catch(v){f.e(v)}finally{f.f()}return Qxe(s,t),tAe(s,u),eAe(s,l),s[In]=u,s[wg]=l,r.length===0&&!iw(t,"_propTypes")&&(t._propTypes=u),s}function Qxe(t,r){var e=nAe(r);Object.defineProperties(t,{id:{writable:!0,value:e}})}function eAe(t,r){var e=function(a){Object.defineProperty(t,a,{enumerable:!1,set:function(s){var u="".concat(this.id,": ").concat(a),l=nw(r[a]),f;try{for(l.s();!(f=l.n()).done;){var c=f.value;iw(this,c)||(this[c]=s)}}catch(p){l.e(p)}finally{l.f()}J.deprecated(u,r[a].join("/"))()}})};for(var n in r)e(n)}function tAe(t,r){var e={},n={};for(var i in r){var a=r[i],o=a.name,s=a.value;a.async&&(e[o]=s,n[o]=rAe(o))}t[Aa]=e,t[Di]={},Object.defineProperties(t,n)}function rAe(t){return{enumerable:!0,set:function(e){typeof e=="string"||e instanceof Promise||Hg(e)?this[Di][t]=e:this[ui][t]=e},get:function(){if(this[ui]){if(t in this[ui]){var e=this[ui][t];return e||this[Aa][t]}if(t in this[Di]){var n=this[Fl]&&this[Fl].internalState;if(n&&n.hasAsyncProp(t))return n.getAsyncProp(t)||this[Aa][t]}}return this[Aa][t]}}}function iw(t,r){return Object.prototype.hasOwnProperty.call(t,r)}function R8(t,r){return iw(t,r)&&t[r]}function nAe(t){var r=t.componentName;return r||J.warn("".concat(t.name,".componentName not specified"))(),r||t.name}function L8(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function aw(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?L8(Object(e),!0).forEach(function(n){(0,Xs.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):L8(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var iAe=0,ry=function(){function t(){(0,k8.default)(this,t),(0,Xs.default)(this,"id",void 0),(0,Xs.default)(this,"props",void 0),(0,Xs.default)(this,"count",void 0);for(var r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];this.props=I8(this,e),this.id=this.props.id,this.count=iAe++}return(0,B8.default)(t,[{key:"clone",value:function(e){var n=this.props,i={};for(var a in n[Aa])a in n[ui]?i[a]=n[ui][a]:a in n[Di]&&(i[a]=n[Di][a]);return new this.constructor(aw(aw(aw({},n),i),e))}}]),t}();(0,Xs.default)(ry,"componentName","Component");(0,Xs.default)(ry,"defaultProps",{});var G8=h(L()),z8=h(N()),hi=h(be()),V8=h(Ee()),H8=h(Y()),W8=h(K()),ny=h(q()),di=h(B());var F8=h(ye()),D8=h(L()),N8=h(N()),Yl=h(B()),j8=h(mv()),ow=h(ve());var aAe=Object.freeze({}),U8=function(){function t(r){(0,D8.default)(this,t),(0,Yl.default)(this,"component",void 0),(0,Yl.default)(this,"onAsyncPropUpdated",void 0),(0,Yl.default)(this,"asyncProps",void 0),(0,Yl.default)(this,"oldProps",void 0),(0,Yl.default)(this,"oldAsyncProps",void 0),this.component=r,this.asyncProps={},this.onAsyncPropUpdated=function(){},this.oldProps=null,this.oldAsyncProps=null}return(0,N8.default)(t,[{key:"finalize",value:function(){for(var e in this.asyncProps){var n=this.asyncProps[e];n&&n.type&&n.type.release&&n.type.release(n.resolvedValue,n.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}},{key:"getOldProps",value:function(){return this.oldAsyncProps||this.oldProps||aAe}},{key:"resetOldProps",value:function(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}},{key:"hasAsyncProp",value:function(e){return e in this.asyncProps}},{key:"getAsyncProp",value:function(e){var n=this.asyncProps[e];return n&&n.resolvedValue}},{key:"isAsyncPropLoading",value:function(e){if(e){var n=this.asyncProps[e];return Boolean(n&&n.pendingLoadCount>0&&n.pendingLoadCount!==n.resolvedLoadCount)}for(var i in this.asyncProps)if(this.isAsyncPropLoading(i))return!0;return!1}},{key:"reloadAsyncProp",value:function(e,n){this._watchPromise(e,Promise.resolve(n))}},{key:"setAsyncProps",value:function(e){this.component=e[Fl]||this.component;var n=e[ui]||{},i=e[Di]||e,a=e[Aa]||{};for(var o in n){var s=n[o];this._createAsyncPropData(o,a[o]),this._updateAsyncProp(o,s),n[o]=this.getAsyncProp(o)}for(var u in i){var l=i[u];this._createAsyncPropData(u,a[u]),this._updateAsyncProp(u,l)}}},{key:"_fetch",value:function(e,n){return null}},{key:"_onResolve",value:function(e,n){}},{key:"_onError",value:function(e,n){}},{key:"_updateAsyncProp",value:function(e,n){if(this._didAsyncInputValueChange(e,n)){if(typeof n=="string"&&(n=this._fetch(e,n)),n instanceof Promise){this._watchPromise(e,n);return}if(Hg(n)){this._resolveAsyncIterable(e,n);return}this._setPropValue(e,n)}}},{key:"_freezeAsyncOldProps",value:function(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(var e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}},{key:"_didAsyncInputValueChange",value:function(e,n){var i=this.asyncProps[e];return n===i.resolvedValue||n===i.lastValue?!1:(i.lastValue=n,!0)}},{key:"_setPropValue",value:function(e,n){this._freezeAsyncOldProps();var i=this.asyncProps[e];i&&(n=this._postProcessValue(i,n),i.resolvedValue=n,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount)}},{key:"_setAsyncPropValue",value:function(e,n,i){var a=this.asyncProps[e];a&&i>=a.resolvedLoadCount&&n!==void 0&&(this._freezeAsyncOldProps(),a.resolvedValue=n,a.resolvedLoadCount=i,this.onAsyncPropUpdated(e,n))}},{key:"_watchPromise",value:function(e,n){var i=this,a=this.asyncProps[e];if(a){a.pendingLoadCount++;var o=a.pendingLoadCount;n.then(function(s){i.component&&(s=i._postProcessValue(a,s),i._setAsyncPropValue(e,s,o),i._onResolve(e,s))}).catch(function(s){i._onError(e,s)})}}},{key:"_resolveAsyncIterable",value:function(){var r=(0,F8.default)(ow.default.mark(function n(i,a){var o,s,u,l,f,c,p,d,v,m,g;return ow.default.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(i==="data"){_.next=3;break}return this._setPropValue(i,a),_.abrupt("return");case 3:if(o=this.asyncProps[i],o){_.next=6;break}return _.abrupt("return");case 6:o.pendingLoadCount++,s=o.pendingLoadCount,u=[],l=0,f=!1,c=!1,_.prev=12,d=(0,j8.default)(a);case 14:return _.next=16,d.next();case 16:if(!(f=!(v=_.sent).done)){_.next=28;break}if(m=v.value,this.component){_.next=20;break}return _.abrupt("return");case 20:g=this.component.props.dataTransform,g?u=g(m,u):u=u.concat(m),Object.defineProperty(u,"__diff",{enumerable:!1,value:[{startRow:l,endRow:u.length}]}),l=u.length,this._setAsyncPropValue(i,u,s);case 25:f=!1,_.next=14;break;case 28:_.next=34;break;case 30:_.prev=30,_.t0=_.catch(12),c=!0,p=_.t0;case 34:if(_.prev=34,_.prev=35,!(f&&d.return!=null)){_.next=39;break}return _.next=39,d.return();case 39:if(_.prev=39,!c){_.next=42;break}throw p;case 42:return _.finish(39);case 43:return _.finish(34);case 44:this._onResolve(i,u);case 45:case"end":return _.stop()}},n,this,[[12,30,34,44],[35,,39,43]])}));function e(n,i){return r.apply(this,arguments)}return e}()},{key:"_postProcessValue",value:function(e,n){var i=e.type;return i&&this.component&&(i.release&&i.release(e.resolvedValue,i,this.component),i.transform)?i.transform(n,i,this.component):n}},{key:"_createAsyncPropData",value:function(e,n){var i=this.asyncProps[e];if(!i){var a=this.component&&this.component.props[In];this.asyncProps[e]={type:a&&a[e],lastValue:null,resolvedValue:n,pendingLoadCount:0,resolvedLoadCount:0}}}}]),t}();function oAe(t){var r=sAe();return function(){var n=(0,ny.default)(t),i;if(r){var a=(0,ny.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,W8.default)(this,i)}}function sAe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var $8=function(t){(0,H8.default)(e,t);var r=oAe(e);function e(n){var i,a=n.attributeManager,o=n.layer;return(0,G8.default)(this,e),i=r.call(this,o),(0,di.default)((0,hi.default)(i),"attributeManager",void 0),(0,di.default)((0,hi.default)(i),"needsRedraw",void 0),(0,di.default)((0,hi.default)(i),"needsUpdate",void 0),(0,di.default)((0,hi.default)(i),"subLayers",void 0),(0,di.default)((0,hi.default)(i),"usesPickingColorCache",void 0),(0,di.default)((0,hi.default)(i),"hasPickingBuffer",void 0),(0,di.default)((0,hi.default)(i),"changeFlags",void 0),(0,di.default)((0,hi.default)(i),"viewport",void 0),(0,di.default)((0,hi.default)(i),"uniformTransitions",void 0),(0,di.default)((0,hi.default)(i),"propsInTransition",void 0),i.attributeManager=a,i.needsRedraw=!0,i.needsUpdate=!0,i.subLayers=null,i.usesPickingColorCache=!1,i}return(0,z8.default)(e,[{key:"layer",get:function(){return this.component}},{key:"_fetch",value:function(i,a){var o=this.layer,s=o?.props.fetch;return s?s(a,{propName:i,layer:o}):(0,V8.default)((0,ny.default)(e.prototype),"_fetch",this).call(this,i,a)}},{key:"_onResolve",value:function(i,a){var o=this.layer;if(o){var s=o.props.onDataLoad;i==="data"&&s&&s(a,{propName:i,layer:o})}}},{key:"_onError",value:function(i,a){var o=this.layer;o&&o.raiseError(a,"loading ".concat(i," of ").concat(this.layer))}}]),e}(U8);function vi(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=uAe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function uAe(t,r){if(t){if(typeof t=="string")return X8(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return X8(t,r)}}function X8(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function lAe(t){var r=fAe();return function(){var n=(0,uw.default)(t),i;if(r){var a=(0,uw.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Q8.default)(this,i)}}function fAe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function q8(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function eh(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?q8(Object(e),!0).forEach(function(n){(0,Ca.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):q8(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var cAe="layer.changeFlag",pAe="layer.initialize",hAe="layer.update",dAe="layer.finalize",vAe="layer.matched",Y8=Math.pow(2,24)-1,mAe=Object.freeze([]),gAe=qr(function(t){var r=t.oldViewport,e=t.viewport;return r.equals(e)}),Hi=new Uint8ClampedArray(0),yAe={data:{type:"data",value:mAe,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:function(r){return r&&r.__diff},optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:function(r,e){var n=e.propName,i=e.layer,a=e.loaders,o=e.loadOptions,s=e.signal,u=i.context.resourceManager;if(o=o||i.getLoadOptions(),a=a||i.props.loaders,s){var l;o=eh(eh({},o),{},{fetch:eh(eh({},(l=o)===null||l===void 0?void 0:l.fetch),{},{signal:s})})}var f=u.contains(r);return!f&&!o&&(u.add({resourceId:r,data:Jt(r,a),persistent:!1}),f=!0),f?u.subscribe({resourceId:r,onChange:function(p){var d;return(d=i.internalState)===null||d===void 0?void 0:d.reloadAsyncProp(n,p)},consumerId:i.id,requestId:n}):Jt(r,a,o)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:ue.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:function(r){var e=r.layerIndex;return[0,-e*100]}},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}},He=function(t){(0,J8.default)(e,t);var r=lAe(e);function e(){var n;(0,K8.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,Ca.default)((0,Kl.default)(n),"internalState",null),(0,Ca.default)((0,Kl.default)(n),"lifecycle",To.NO_STATE),(0,Ca.default)((0,Kl.default)(n),"context",void 0),(0,Ca.default)((0,Kl.default)(n),"state",void 0),(0,Ca.default)((0,Kl.default)(n),"parent",null),n}return(0,Z8.default)(e,[{key:"root",get:function(){for(var i=this;i.parent;)i=i.parent;return i}},{key:"toString",value:function(){var i=this.constructor.layerName||this.constructor.name;return"".concat(i,"({id: '").concat(this.props.id,"'})")}},{key:"project",value:function(i){rt(this.internalState);var a=this.internalState.viewport||this.context.viewport,o=pT(i,{viewport:a,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),s=Fs(o,a.pixelProjectionMatrix),u=(0,sw.default)(s,3),l=u[0],f=u[1],c=u[2];return i.length===2?[l,f]:[l,f,c]}},{key:"unproject",value:function(i){rt(this.internalState);var a=this.internalState.viewport||this.context.viewport;return a.unproject(i)}},{key:"projectPosition",value:function(i,a){rt(this.internalState);var o=this.internalState.viewport||this.context.viewport;return bg(i,eh({viewport:o,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem},a))}},{key:"isComposite",get:function(){return!1}},{key:"setState",value:function(i){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,i),this.setNeedsRedraw()}},{key:"setNeedsRedraw",value:function(){this.internalState&&(this.internalState.needsRedraw=!0)}},{key:"setNeedsUpdate",value:function(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}},{key:"isLoaded",get:function(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}},{key:"wrapLongitude",get:function(){return this.props.wrapLongitude}},{key:"isPickable",value:function(){return this.props.pickable&&this.props.visible}},{key:"getModels",value:function(){return this.state&&(this.state.models||this.state.model&&[this.state.model])||[]}},{key:"setModuleParameters",value:function(i){var a=vi(this.getModels()),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;s.updateModuleSettings(i)}}catch(u){a.e(u)}finally{a.f()}}},{key:"getAttributeManager",value:function(){return this.internalState&&this.internalState.attributeManager}},{key:"getCurrentLayer",value:function(){return this.internalState&&this.internalState.layer}},{key:"getLoadOptions",value:function(){return this.props.loadOptions}},{key:"use64bitPositions",value:function(){var i=this.props.coordinateSystem;return i===ue.DEFAULT||i===ue.LNGLAT||i===ue.CARTESIAN}},{key:"onHover",value:function(i,a){return this.props.onHover&&this.props.onHover(i,a)||!1}},{key:"onClick",value:function(i,a){return this.props.onClick&&this.props.onClick(i,a)||!1}},{key:"nullPickingColor",value:function(){return[0,0,0]}},{key:"encodePickingColor",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return a[0]=i+1&255,a[1]=i+1>>8&255,a[2]=i+1>>8>>8&255,a}},{key:"decodePickingColor",value:function(i){rt(i instanceof Uint8Array);var a=(0,sw.default)(i,3),o=a[0],s=a[1],u=a[2],l=o+s*256+u*65536-1;return l}},{key:"getNumInstances",value:function(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:ey(this.props.data)}},{key:"getStartIndices",value:function(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}},{key:"getBounds",value:function(){var i;return(i=this.getAttributeManager())===null||i===void 0?void 0:i.getBounds(["positions","instancePositions"])}},{key:"getShaders",value:function(i){var a=vi(this.props.extensions),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;i=Ea(i,s.getShaders.call(this,s))}}catch(u){a.e(u)}finally{a.f()}return i}},{key:"shouldUpdateState",value:function(i){return i.changeFlags.propsOrDataChanged}},{key:"updateState",value:function(i){var a=this,o=this.getAttributeManager(),s=i.changeFlags.dataChanged;if(s&&o)if(Array.isArray(s)){var u=vi(s),l;try{for(u.s();!(l=u.n()).done;){var f=l.value;o.invalidateAll(f)}}catch(_){u.e(_)}finally{u.f()}}else o.invalidateAll();if(o){var c=i.props,p=this.internalState.hasPickingBuffer,d=Number.isInteger(c.highlightedObjectIndex)||c.pickable||c.extensions.some(function(_){return _.getNeedsPickingBuffer.call(a,_)});if(p!==d){this.internalState.hasPickingBuffer=d;var v=o.attributes,m=v.pickingColors,g=v.instancePickingColors,y=m||g;y&&(d&&y.constant&&(y.constant=!1,o.invalidate(y.id)),!y.value&&!d&&(y.constant=!0,y.value=[0,0,0]))}}}},{key:"finalizeState",value:function(i){var a=vi(this.getModels()),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;s.delete()}}catch(l){a.e(l)}finally{a.f()}var u=this.getAttributeManager();u&&u.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}},{key:"draw",value:function(i){var a=vi(this.getModels()),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;s.draw(i)}}catch(u){a.e(u)}finally{a.f()}}},{key:"getPickingInfo",value:function(i){var a=i.info,o=i.mode,s=i.sourceLayer,u=a.index;return u>=0&&Array.isArray(this.props.data)&&(a.object=this.props.data[u]),a}},{key:"raiseError",value:function(i,a){var o,s;if(a&&(i.message="".concat(a,": ").concat(i.message)),!((o=(s=this.props).onError)!==null&&o!==void 0&&o.call(s,i))){var u,l;(u=this.context)===null||u===void 0||(l=u.onError)===null||l===void 0||l.call(u,i,this)}}},{key:"getNeedsRedraw",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};return this._getNeedsRedraw(i)}},{key:"needsUpdate",value:function(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}},{key:"hasUniformTransition",value:function(){var i;return((i=this.internalState)===null||i===void 0?void 0:i.uniformTransitions.active)||!1}},{key:"activateViewport",value:function(i){if(this.internalState){var a=this.internalState.viewport;this.internalState.viewport=i,(!a||!gAe({oldViewport:a,viewport:i}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}}},{key:"invalidateAttribute",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"all",a=this.getAttributeManager();a&&(i==="all"?a.invalidateAll():a.invalidate(i))}},{key:"updateAttributes",value:function(i){var a=vi(this.getModels()),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;this._setModelAttributes(s,i)}}catch(u){a.e(u)}finally{a.f()}}},{key:"_updateAttributes",value:function(){var i=this.getAttributeManager();if(i){var a=this.props,o=this.getNumInstances(),s=this.getStartIndices();i.update({data:a.data,numInstances:o,startIndices:s,props:a,transitions:a.transitions,buffers:a.data.attributes,context:this});var u=i.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(u)}}},{key:"_updateAttributeTransition",value:function(){var i=this.getAttributeManager();i&&i.updateTransition()}},{key:"_updateUniformTransition",value:function(){var i=this.internalState.uniformTransitions;if(i.active){var a=i.update(),o=Object.create(this.props);for(var s in a)Object.defineProperty(o,s,{value:a[s]});return o}return this.props}},{key:"calculateInstancePickingColors",value:function(i,a){var o=a.numInstances;if(!i.constant){var s=Math.floor(Hi.length/3);if(this.internalState.usesPickingColorCache=!0,s<o){o>Y8&&J.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Hi=ai.allocate(Hi,o,{size:3,copy:!0,maxCount:Math.max(o,Y8)});for(var u=Math.floor(Hi.length/3),l=[],f=s;f<u;f++)this.encodePickingColor(f,l),Hi[f*3+0]=l[0],Hi[f*3+1]=l[1],Hi[f*3+2]=l[2]}i.value=Hi.subarray(0,o*3)}}},{key:"_setModelAttributes",value:function(i,a){var o=this.getAttributeManager(),s=i.userData.excludeAttributes||{},u=o.getShaderAttributes(a,s);i.setAttributes(u)}},{key:"disablePickingIndex",value:function(i){var a=this.props.data;if(!("attributes"in a)){this._disablePickingIndex(i);return}var o=this.getAttributeManager().attributes,s=o.pickingColors,u=o.instancePickingColors,l=s||u,f=l&&a.attributes&&a.attributes[l.id];if(f&&f.value)for(var c=f.value,p=this.encodePickingColor(i),d=0;d<a.length;d++){var v=l.getVertexOffset(d);c[v]===p[0]&&c[v+1]===p[1]&&c[v+2]===p[2]&&this._disablePickingIndex(d)}else this._disablePickingIndex(i)}},{key:"_disablePickingIndex",value:function(i){var a=this.getAttributeManager().attributes,o=a.pickingColors,s=a.instancePickingColors,u=o||s;if(u){var l=u.getVertexOffset(i),f=u.getVertexOffset(i+1);u.buffer.subData({data:new Uint8Array(f-l),offset:l})}}},{key:"restorePickingColors",value:function(){var i=this.getAttributeManager().attributes,a=i.pickingColors,o=i.instancePickingColors,s=a||o;s&&(this.internalState.usesPickingColorCache&&s.value.buffer!==Hi.buffer&&(s.value=Hi.subarray(0,s.value.length)),s.updateSubBuffer({startOffset:0}))}},{key:"_initialize",value:function(){rt(!this.internalState),rt(Number.isFinite(this.props.coordinateSystem)),Nt(pAe,this);var i=this._getAttributeManager();i&&i.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new $8({attributeManager:i,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:function(){return J.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),i}}),this.internalState.uniformTransitions=new m8(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);var a=vi(this.props.extensions),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;s.initializeState.call(this,this.context,s)}}catch(u){a.e(u)}finally{a.f()}this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}},{key:"_transferState",value:function(i){Nt(vAe,this,this===i);var a=i.state,o=i.internalState;this!==i&&(this.internalState=o,this.state=a,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}},{key:"_update",value:function(){var i=this.needsUpdate();if(Nt(hAe,this,i),!!i){var a=this.props,o=this.context,s=this.internalState,u=o.viewport,l=this._updateUniformTransition();s.propsInTransition=l,o.viewport=s.viewport||u,this.props=l;try{var f=this._getUpdateParams(),c=this.getModels();if(o.gl)this.updateState(f);else try{this.updateState(f)}catch{}var p=vi(this.props.extensions),d;try{for(p.s();!(d=p.n()).done;){var v=d.value;v.updateState.call(this,f,v)}}catch(g){p.e(g)}finally{p.f()}var m=this.getModels()[0]!==c[0];this._postUpdate(f,m)}finally{o.viewport=u,this.props=a,this._clearChangeFlags(),s.needsUpdate=!1,s.resetOldProps()}}}},{key:"_finalize",value:function(){Nt(dAe,this),this.finalizeState(this.context);var i=vi(this.props.extensions),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;o.finalizeState.call(this,this.context,o)}}catch(s){i.e(s)}finally{i.f()}}},{key:"_drawLayer",value:function(i){var a=this,o=i.moduleParameters,s=o===void 0?null:o,u=i.uniforms,l=u===void 0?{}:u,f=i.parameters,c=f===void 0?{}:f;this._updateAttributeTransition();var p=this.props,d=this.context;this.props=this.internalState.propsInTransition||p;var v=this.props.opacity;l.opacity=Math.pow(v,1/2.2);try{s&&this.setModuleParameters(s);var m=this.props.getPolygonOffset,g=m&&m(l)||[0,0];Ht(d.gl,{polygonOffset:g}),Le(d.gl,c,function(){var y={moduleParameters:s,uniforms:l,parameters:c,context:d},_=vi(a.props.extensions),b;try{for(_.s();!(b=_.n()).done;){var x=b.value;x.draw.call(a,y,x)}}catch(A){_.e(A)}finally{_.f()}a.draw(y)})}finally{this.props=p}}},{key:"getChangeFlags",value:function(){var i;return(i=this.internalState)===null||i===void 0?void 0:i.changeFlags}},{key:"setChangeFlags",value:function(i){if(this.internalState){var a=this.internalState.changeFlags;for(var o in i)if(i[o]){var s=!1;switch(o){case"dataChanged":var u=i[o],l=a[o];u&&Array.isArray(l)&&(a.dataChanged=Array.isArray(u)?l.concat(u):u,s=!0);default:a[o]||(a[o]=i[o],s=!0)}s&&Nt(cAe,this,o,i)}var f=Boolean(a.dataChanged||a.updateTriggersChanged||a.propsChanged||a.extensionsChanged);a.propsOrDataChanged=f,a.somethingChanged=f||a.viewportChanged||a.stateChanged}}},{key:"_clearChangeFlags",value:function(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}},{key:"_diffProps",value:function(i,a){var o=_8(i,a);if(o.updateTriggersChanged)for(var s in o.updateTriggersChanged)o.updateTriggersChanged[s]&&this.invalidateAttribute(s);if(o.transitionsChanged)for(var u in o.transitionsChanged){var l;this.internalState.uniformTransitions.add(u,a[u],i[u],(l=i.transitions)===null||l===void 0?void 0:l[u])}return this.setChangeFlags(o)}},{key:"validateProps",value:function(){y8(this.props)}},{key:"updateAutoHighlight",value:function(i){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(i)}},{key:"_updateAutoHighlight",value:function(i){var a={pickingSelectedColor:i.picked?i.color:null},o=this.props.highlightColor;i.picked&&typeof o=="function"&&(a.pickingHighlightColor=o(i)),this.setModuleParameters(a),this.setNeedsRedraw()}},{key:"_getAttributeManager",value:function(){var i=this.context;return new Eo(i.gl,{id:this.props.id,stats:i.stats,timeline:i.timeline})}},{key:"_postUpdate",value:function(i,a){var o=i.props,s=i.oldProps;this.setNeedsRedraw(),this._updateAttributes();var u=this.state.model;u?.setInstanceCount(this.getNumInstances());var l=o.autoHighlight,f=o.highlightedObjectIndex,c=o.highlightColor;if(a||s.autoHighlight!==l||s.highlightedObjectIndex!==f||s.highlightColor!==c){var p={};l||(p.pickingSelectedColor=null),Array.isArray(c)&&(p.pickingHighlightColor=c),(a||f!==s.highlightedObjectIndex)&&(p.pickingSelectedColor=Number.isFinite(f)&&f>=0?this.encodePickingColor(f):null),this.setModuleParameters(p)}}},{key:"_getUpdateParams",value:function(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}},{key:"_getNeedsRedraw",value:function(i){if(!this.internalState)return!1;var a=!1;a=a||this.internalState.needsRedraw&&this.id;var o=this.getAttributeManager(),s=o?o.getNeedsRedraw(i):!1;if(a=a||s,a){var u=vi(this.props.extensions),l;try{for(u.s();!(l=u.n()).done;){var f=l.value;f.onNeedsRedraw.call(this,f)}}catch(c){u.e(c)}finally{u.f()}}return this.internalState.needsRedraw=this.internalState.needsRedraw&&!i.clearRedrawFlags,a}},{key:"_onAsyncPropUpdated",value:function(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}],[{key:"componentName",get:function(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}}]),e}(ry);(0,Ca.default)(He,"defaultProps",yAe);(0,Ca.default)(He,"layerName","Layer");var n5=h(L()),i5=h(N()),fw=h(Ee()),a5=h(Y()),o5=h(K()),th=h(q()),cw=h(B());function lw(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=_Ae(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function _Ae(t,r){if(t){if(typeof t=="string")return e5(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return e5(t,r)}}function e5(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function t5(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function r5(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?t5(Object(e),!0).forEach(function(n){(0,cw.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):t5(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function bAe(t){var r=xAe();return function(){var n=(0,th.default)(t),i;if(r){var a=(0,th.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,o5.default)(this,i)}}function xAe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var AAe="compositeLayer.renderLayers",Ot=function(t){(0,a5.default)(e,t);var r=bAe(e);function e(){return(0,n5.default)(this,e),r.apply(this,arguments)}return(0,i5.default)(e,[{key:"isComposite",get:function(){return!0}},{key:"isLoaded",get:function(){return(0,fw.default)((0,th.default)(e.prototype),"isLoaded",this)&&this.getSubLayers().every(function(i){return i.isLoaded})}},{key:"getSubLayers",value:function(){return this.internalState&&this.internalState.subLayers||[]}},{key:"initializeState",value:function(i){}},{key:"setState",value:function(i){(0,fw.default)((0,th.default)(e.prototype),"setState",this).call(this,i),this.setNeedsUpdate()}},{key:"getPickingInfo",value:function(i){var a=i.info,o=a.object,s=o&&o.__source&&o.__source.parent&&o.__source.parent.id===this.id;return s&&(a.object=o.__source.object,a.index=o.__source.index),a}},{key:"filterSubLayer",value:function(i){return!0}},{key:"shouldRenderSubLayer",value:function(i,a){return a&&a.length}},{key:"getSubLayerClass",value:function(i,a){var o=this.props._subLayerProps;return o&&o[i]&&o[i].type||a}},{key:"getSubLayerRow",value:function(i,a,o){return i.__source={parent:this,object:a,index:o},i}},{key:"getSubLayerAccessor",value:function(i){if(typeof i=="function"){var a={index:-1,data:this.props.data,target:[]};return function(o,s){return o&&o.__source?(a.index=o.__source.index,i(o.__source.object,a)):i(o,s)}}return i}},{key:"getSubLayerProps",value:function(){var i,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=this.props,s=o.opacity,u=o.pickable,l=o.visible,f=o.parameters,c=o.getPolygonOffset,p=o.highlightedObjectIndex,d=o.autoHighlight,v=o.highlightColor,m=o.coordinateSystem,g=o.coordinateOrigin,y=o.wrapLongitude,_=o.positionFormat,b=o.modelMatrix,x=o.extensions,A=o.fetch,S=o.operation,P=o._subLayerProps,O={id:"",updateTriggers:{},opacity:s,pickable:u,visible:l,parameters:f,getPolygonOffset:c,highlightedObjectIndex:p,autoHighlight:d,highlightColor:v,coordinateSystem:m,coordinateOrigin:g,wrapLongitude:y,positionFormat:_,modelMatrix:b,extensions:x,fetch:A,operation:S},C=P&&a.id&&P[a.id],T=C&&C.updateTriggers,I=a.id||"sublayer";if(C){var R=this.props[In],V=a.type?a.type._propTypes:{};for(var z in C){var k=V[z]||R[z];k&&k.type==="accessor"&&(C[z]=this.getSubLayerAccessor(C[z]))}}Object.assign(O,a,C),O.id="".concat(this.props.id,"-").concat(I),O.updateTriggers=r5(r5({all:(i=this.props.updateTriggers)===null||i===void 0?void 0:i.all},a.updateTriggers),T);var G=lw(x),U;try{for(G.s();!(U=G.n()).done;){var $=U.value,H=$.getSubLayerProps.call(this,$);H&&Object.assign(O,H,{updateTriggers:Object.assign(O.updateTriggers,H.updateTriggers)})}}catch(Q){G.e(Q)}finally{G.f()}return O}},{key:"_updateAutoHighlight",value:function(i){var a=lw(this.getSubLayers()),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;s.updateAutoHighlight(i)}}catch(u){a.e(u)}finally{a.f()}}},{key:"_getAttributeManager",value:function(){return null}},{key:"_postUpdate",value:function(i,a){var o=this.internalState.subLayers,s=!o||this.needsUpdate();if(s){var u=this.renderLayers();o=jr(u,Boolean),this.internalState.subLayers=o}Nt(AAe,this,s,o);var l=lw(o),f;try{for(l.s();!(f=l.n()).done;){var c=f.value;c.parent=this}}catch(p){l.e(p)}finally{l.f()}}}]),e}(He);(0,cw.default)(Ot,"layerName","CompositeLayer");var rh=h(me()),f5=h(L()),c5=h(N()),ay=h(be()),p5=h(Y()),h5=h(K()),hw=h(q()),nh=h(B());function s5(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function u5(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?s5(Object(e),!0).forEach(function(n){(0,nh.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):s5(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function SAe(t){var r=TAe();return function(){var n=(0,hw.default)(t),i;if(r){var a=(0,hw.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,h5.default)(this,i)}}function TAe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var iy=Math.PI/180,l5=180/Math.PI,oy=6370972,Zl=256;function wAe(){var t=Zl/oy,r=Math.PI/180*Zl;return{unitsPerMeter:[t,t,t],unitsPerMeter2:[0,0,0],metersPerUnit:[1/t,1/t,1/t],unitsPerDegree:[r,r,t],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/r,1/r,1/t]}}var Jl=function(t){(0,p5.default)(e,t);var r=SAe(e);function e(){var n,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,f5.default)(this,e);var a=i.latitude,o=a===void 0?0:a,s=i.longitude,u=s===void 0?0:s,l=i.zoom,f=l===void 0?0:l,c=i.nearZMultiplier,p=c===void 0?.1:c,d=i.farZMultiplier,v=d===void 0?2:d,m=i.resolution,g=m===void 0?10:m,y=i.height,_=i.altitude,b=_===void 0?1.5:_;y=y||1,b=Math.max(.75,b);var x=new pe().lookAt({eye:[0,-b,0],up:[0,0,1]}),A=Math.pow(2,f);x.rotateX(o*iy),x.rotateZ(-u*iy),x.scale(A/y);var S=Math.atan(.5/b),P=Zl*2*A/y;return n=r.call(this,u5(u5({},i),{},{height:y,viewMatrix:x,longitude:u,latitude:o,zoom:f,distanceScales:wAe(),fovyRadians:S*2,focalDistance:b,near:p,far:Math.min(2,1/P+1)*b*v})),(0,nh.default)((0,ay.default)(n),"longitude",void 0),(0,nh.default)((0,ay.default)(n),"latitude",void 0),(0,nh.default)((0,ay.default)(n),"resolution",void 0),n.latitude=o,n.longitude=u,n.resolution=g,n}return(0,c5.default)(e,[{key:"projectionMode",get:function(){return Sr.GLOBE}},{key:"getDistanceScales",value:function(){return this.distanceScales}},{key:"getBounds",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a={targetZ:i.z||0},o=this.unproject([0,this.height/2],a),s=this.unproject([this.width/2,0],a),u=this.unproject([this.width,this.height/2],a),l=this.unproject([this.width/2,this.height],a);return u[0]<this.longitude&&(u[0]+=360),o[0]>this.longitude&&(o[0]-=360),[Math.min(o[0],u[0],s[0],l[0]),Math.min(o[1],u[1],s[1],l[1]),Math.max(o[0],u[0],s[0],l[0]),Math.max(o[1],u[1],s[1],l[1])]}},{key:"unproject",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=a.topLeft,s=o===void 0?!0:o,u=a.targetZ,l=(0,rh.default)(i,3),f=l[0],c=l[1],p=l[2],d=s?c:this.height-c,v=this.pixelUnprojectionMatrix,m;if(Number.isFinite(p))m=pw(v,[f,d,p,1]);else{var g=pw(v,[f,d,-1,1]),y=pw(v,[f,d,1,1]),_=((u||0)/oy+1)*Zl,b=yg(gg([],g,y)),x=yg(g),A=yg(y),S=(4*x*A-Math.pow(b-x-A,2))/16,P=4*S/b,O=Math.sqrt(x-P),C=Math.sqrt(Math.max(0,_*_-P)),T=(O-C)/Math.sqrt(b);m=CU([],g,y,T)}var I=this.unprojectPosition(m),R=(0,rh.default)(I,3),V=R[0],z=R[1],k=R[2];return Number.isFinite(p)?[V,z,k]:Number.isFinite(u)?[V,z,u]:[V,z]}},{key:"projectPosition",value:function(i){var a=(0,rh.default)(i,3),o=a[0],s=a[1],u=a[2],l=u===void 0?0:u,f=o*iy,c=s*iy,p=Math.cos(c),d=(l/oy+1)*Zl;return[Math.sin(f)*p*d,-Math.cos(f)*p*d,Math.sin(c)*d]}},{key:"unprojectPosition",value:function(i){var a=(0,rh.default)(i,3),o=a[0],s=a[1],u=a[2],l=MU(i),f=Math.asin(u/l),c=Math.atan2(o,-s),p=c*l5,d=f*l5,v=(l/Zl-1)*oy;return[p,d,v]}},{key:"projectFlat",value:function(i){return i}},{key:"unprojectFlat",value:function(i){return i}},{key:"panByPosition",value:function(i,a){var o=this.unproject(a);return{longitude:i[0]-o[0]+this.longitude,latitude:i[1]-o[1]+this.latitude}}}]),e}(Ar);function pw(t,r){var e=Ls([],r,t);return V4(e,e,1/e[3]),e}var vw=h(me()),m5=h(L()),g5=h(N()),y5=h(be()),_5=h(Y()),b5=h(K()),mw=h(q()),gw=h(B());function d5(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function v5(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?d5(Object(e),!0).forEach(function(n){(0,gw.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):d5(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function PAe(t){var r=OAe();return function(){var n=(0,mw.default)(t),i;if(r){var a=(0,mw.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,b5.default)(this,i)}}function OAe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var dw=Math.PI/180;function EAe(t){var r=t.height,e=t.focalDistance,n=t.orbitAxis,i=t.rotationX,a=t.rotationOrbit,o=t.zoom,s=n==="Z"?[0,0,1]:[0,1,0],u=n==="Z"?[0,-e,0]:[0,0,e],l=new pe().lookAt({eye:u,up:s});l.rotateX(i*dw),n==="Z"?l.rotateZ(a*dw):l.rotateY(a*dw);var f=Math.pow(2,o)/r;return l.scale(f),l}var sy=function(t){(0,_5.default)(e,t);var r=PAe(e);function e(n){var i;(0,m5.default)(this,e);var a=n.height,o=n.projectionMatrix,s=n.fovy,u=s===void 0?50:s,l=n.orbitAxis,f=l===void 0?"Z":l,c=n.target,p=c===void 0?[0,0,0]:c,d=n.rotationX,v=d===void 0?0:d,m=n.rotationOrbit,g=m===void 0?0:m,y=n.zoom,_=y===void 0?0:y,b=o?o[5]/2:Ao(u);return i=r.call(this,v5(v5({},n),{},{longitude:void 0,viewMatrix:EAe({height:a||1,focalDistance:b,orbitAxis:f,rotationX:v,rotationOrbit:g,zoom:_}),fovy:u,focalDistance:b,position:p,zoom:_})),(0,gw.default)((0,y5.default)(i),"projectedCenter",void 0),i.projectedCenter=i.project(i.center),i}return(0,g5.default)(e,[{key:"unproject",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=a.topLeft,s=o===void 0?!0:o,u=(0,vw.default)(i,3),l=u[0],f=u[1],c=u[2],p=c===void 0?this.projectedCenter[2]:c,d=s?f:this.height-f,v=Yr([l,d,p],this.pixelUnprojectionMatrix),m=(0,vw.default)(v,3),g=m[0],y=m[1],_=m[2];return[g,y,_]}},{key:"panByPosition",value:function(i,a){var o=this.project(i),s=[this.width/2+o[0]-a[0],this.height/2+o[1]-a[1],this.projectedCenter[2]];return{target:this.unproject(s)}}}]),e}(Ar);var yw=h(me()),S5=h(B()),T5=h(L()),w5=h(N()),P5=h(Y()),O5=h(K()),_w=h(q());function x5(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function A5(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?x5(Object(e),!0).forEach(function(n){(0,S5.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):x5(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function CAe(t){var r=MAe();return function(){var n=(0,_w.default)(t),i;if(r){var a=(0,_w.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,O5.default)(this,i)}}function MAe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var IAe=new pe().lookAt({eye:[0,0,1]});function RAe(t){var r=t.width,e=t.height,n=t.near,i=t.far,a=t.padding,o=-r/2,s=r/2,u=-e/2,l=e/2;if(a){var f=a.left,c=f===void 0?0:f,p=a.right,d=p===void 0?0:p,v=a.top,m=v===void 0?0:v,g=a.bottom,y=g===void 0?0:g,_=We((c+r-d)/2,0,r)-r/2,b=We((m+e-y)/2,0,e)-e/2;o-=_,s-=_,u+=b,l+=b}return new pe().ortho({left:o,right:s,bottom:u,top:l,near:n,far:i})}var Ql=function(t){(0,P5.default)(e,t);var r=CAe(e);function e(n){(0,T5.default)(this,e);var i=n.width,a=n.height,o=n.near,s=o===void 0?.1:o,u=n.far,l=u===void 0?1e3:u,f=n.zoom,c=f===void 0?0:f,p=n.target,d=p===void 0?[0,0,0]:p,v=n.padding,m=v===void 0?null:v,g=n.flipY,y=g===void 0?!0:g,_=Array.isArray(c)?c[0]:c,b=Array.isArray(c)?c[1]:c,x=Math.min(_,b),A=Math.pow(2,x),S;if(_!==b){var P=Math.pow(2,_),O=Math.pow(2,b);S={unitsPerMeter:[P/A,O/A,1],metersPerUnit:[A/P,A/O,1]}}return r.call(this,A5(A5({},n),{},{longitude:void 0,position:d,viewMatrix:IAe.clone().scale([A,A*(y?-1:1),A]),projectionMatrix:RAe({width:i||1,height:a||1,padding:m,near:s,far:l}),zoom:x,distanceScales:S}))}return(0,w5.default)(e,[{key:"projectFlat",value:function(i){var a=(0,yw.default)(i,2),o=a[0],s=a[1],u=this.distanceScales.unitsPerMeter;return[o*u[0],s*u[1]]}},{key:"unprojectFlat",value:function(i){var a=(0,yw.default)(i,2),o=a[0],s=a[1],u=this.distanceScales.metersPerUnit;return[o*u[0],s*u[1]]}},{key:"panByPosition",value:function(i,a){var o=Yr(a,this.pixelUnprojectionMatrix),s=this.projectFlat(i),u=kl([],s,vg([],o)),l=kl([],this.center,u);return{target:this.unprojectFlat(l)}}}]),e}(Ar);var M5=h(L()),bw=h(be()),I5=h(Y()),R5=h(K()),xw=h(q()),uy=h(B());function E5(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function C5(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?E5(Object(e),!0).forEach(function(n){(0,uy.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):E5(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function LAe(t){var r=kAe();return function(){var n=(0,xw.default)(t),i;if(r){var a=(0,xw.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,R5.default)(this,i)}}function kAe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ly=function(t){(0,I5.default)(e,t);var r=LAe(e);function e(n){var i;(0,M5.default)(this,e);var a=n.longitude,o=n.latitude,s=n.modelMatrix,u=n.bearing,l=u===void 0?0:u,f=n.pitch,c=f===void 0?0:f,p=n.up,d=p===void 0?[0,0,1]:p,v=new Pp({bearing:l,pitch:c===-90?1e-4:90+c}),m=v.toVector3().normalize(),g=s?new pe(s).transformAsVector(m):m,y=Number.isFinite(o)?Lp({latitude:o}):0,_=Math.pow(2,y),b=new pe().lookAt({eye:[0,0,0],center:g,up:d}).scale(_);return i=r.call(this,C5(C5({},n),{},{zoom:y,viewMatrix:b})),(0,uy.default)((0,bw.default)(i),"longitude",void 0),(0,uy.default)((0,bw.default)(i),"latitude",void 0),i.latitude=o,i.longitude=a,i}return e}(Ar);var D5=h(L()),N5=h(N()),j5=h(Y()),U5=h(K()),Pw=h(q()),G5=h(B());var Aw=h(be()),cy=h(B()),Tw=h(L()),k5=h(N()),ww=h(Y()),B5=h(K()),Sw=h(q());function L5(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function fy(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?L5(Object(e),!0).forEach(function(n){(0,cy.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):L5(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function F5(t){var r=BAe();return function(){var n=(0,Sw.default)(t),i;if(r){var a=(0,Sw.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,B5.default)(this,i)}}function BAe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ih=20,FAe=function(t){(0,ww.default)(e,t);var r=F5(e);function e(n){(0,Tw.default)(this,e);var i=n.width,a=n.height,o=n.position,s=o===void 0?[0,0,0]:o,u=n.bearing,l=u===void 0?0:u,f=n.pitch,c=f===void 0?0:f,p=n.longitude,d=p===void 0?null:p,v=n.latitude,m=v===void 0?null:v,g=n.maxPitch,y=g===void 0?90:g,_=n.minPitch,b=_===void 0?-90:_,x=n.startRotatePos,A=n.startBearing,S=n.startPitch,P=n.startZoomPosition;return r.call(this,{width:i,height:a,position:s,bearing:l,pitch:c,longitude:d,latitude:m,maxPitch:y,minPitch:b},{startRotatePos:x,startBearing:A,startPitch:S,startZoomPosition:P})}return(0,k5.default)(e,[{key:"panStart",value:function(){return this}},{key:"pan",value:function(){return this}},{key:"panEnd",value:function(){return this}},{key:"rotateStart",value:function(i){var a=i.pos;return this._getUpdatedState({startRotatePos:a,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}},{key:"rotate",value:function(i){var a=i.pos,o=i.deltaAngleX,s=o===void 0?0:o,u=i.deltaAngleY,l=u===void 0?0:u,f=this.getState(),c=f.startRotatePos,p=f.startBearing,d=f.startPitch,v=this.getViewportProps(),m=v.width,g=v.height;if(!c||p===void 0||d===void 0)return this;var y;if(a){var _=(a[0]-c[0])/m,b=(a[1]-c[1])/g;y={bearing:p-_*180,pitch:d-b*90}}else y={bearing:p-s,pitch:d-l};return this._getUpdatedState(y)}},{key:"rotateEnd",value:function(){return this._getUpdatedState({startRotatePos:null,startBearing:null,startPitch:null})}},{key:"zoomStart",value:function(){return this._getUpdatedState({startZoomPosition:this.getViewportProps().position})}},{key:"zoom",value:function(i){var a=i.scale,o=this.getState(),s=o.startZoomPosition;s||(s=this.getViewportProps().position);var u=this.getDirection();return this._move(u,Math.log2(a)*ih,s)}},{key:"zoomEnd",value:function(){return this._getUpdatedState({startZoomPosition:null})}},{key:"moveLeft",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ih,a=this.getDirection(!0);return this._move(a.rotateZ({radians:Math.PI/2}),i)}},{key:"moveRight",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ih,a=this.getDirection(!0);return this._move(a.rotateZ({radians:-Math.PI/2}),i)}},{key:"moveUp",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ih,a=this.getDirection(!0);return this._move(a,i)}},{key:"moveDown",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ih,a=this.getDirection(!0);return this._move(a.negate(),i)}},{key:"rotateLeft",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({bearing:this.getViewportProps().bearing-i})}},{key:"rotateRight",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({bearing:this.getViewportProps().bearing+i})}},{key:"rotateUp",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({pitch:this.getViewportProps().pitch+i})}},{key:"rotateDown",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({pitch:this.getViewportProps().pitch-i})}},{key:"zoomIn",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this.zoom({scale:i})}},{key:"zoomOut",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this.zoom({scale:1/i})}},{key:"shortestPathFrom",value:function(i){var a=i.getViewportProps(),o=fy({},this.getViewportProps()),s=o.bearing,u=o.longitude;return Math.abs(s-a.bearing)>180&&(o.bearing=s<0?s+360:s-360),u!==null&&a.longitude!==null&&Math.abs(u-a.longitude)>180&&(o.longitude=u<0?u+360:u-360),o}},{key:"_move",value:function(i,a){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.getViewportProps().position,s=i.scale(a);return this._getUpdatedState({position:new j(o).add(s)})}},{key:"getDirection",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,a=new Pp({bearing:this.getViewportProps().bearing,pitch:i?90:90+this.getViewportProps().pitch}),o=a.toVector3().normalize();return o}},{key:"_getUpdatedState",value:function(i){return new e(fy(fy(fy({},this.getViewportProps()),this.getState()),i))}},{key:"applyConstraints",value:function(i){var a=i.pitch,o=i.maxPitch,s=i.minPitch,u=i.longitude,l=i.bearing;return i.pitch=We(a,s,o),u!==null&&(u<-180||u>180)&&(i.longitude=js(u+180,360)-180),(l<-180||l>180)&&(i.bearing=js(l+180,360)-180),i}}]),e}(Gl),py=function(t){(0,ww.default)(e,t);var r=F5(e);function e(){var n;(0,Tw.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,cy.default)((0,Aw.default)(n),"ControllerState",FAe),(0,cy.default)((0,Aw.default)(n),"transition",{transitionDuration:300,transitionInterpolator:new Zr(["position","pitch","bearing"])}),n}return e}(Ln);function DAe(t){var r=NAe();return function(){var n=(0,Pw.default)(t),i;if(r){var a=(0,Pw.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,U5.default)(this,i)}}function NAe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Ow=function(t){(0,j5.default)(e,t);var r=DAe(e);function e(){return(0,D5.default)(this,e),r.apply(this,arguments)}return(0,N5.default)(e,[{key:"ViewportType",get:function(){return ly}},{key:"ControllerType",get:function(){return py}}]),e}(Rn);(0,G5.default)(Ow,"displayName","FirstPersonView");var $5=h(L()),X5=h(N()),q5=h(Y()),Y5=h(K()),Rw=h(q()),K5=h(B());var Cw=h(L()),V5=h(N()),hy=h(be()),Mw=h(Y()),H5=h(K()),Ew=h(q()),ah=h(B());function z5(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function qs(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?z5(Object(e),!0).forEach(function(n){(0,ah.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):z5(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function W5(t){var r=jAe();return function(){var n=(0,Ew.default)(t),i;if(r){var a=(0,Ew.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,H5.default)(this,i)}}function jAe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Iw=function(t){(0,Mw.default)(e,t);var r=W5(e);function e(n){var i;(0,Cw.default)(this,e);var a=n.width,o=n.height,s=n.rotationX,u=s===void 0?0:s,l=n.rotationOrbit,f=l===void 0?0:l,c=n.target,p=c===void 0?[0,0,0]:c,d=n.zoom,v=d===void 0?0:d,m=n.minRotationX,g=m===void 0?-90:m,y=n.maxRotationX,_=y===void 0?90:y,b=n.minZoom,x=b===void 0?-1/0:b,A=n.maxZoom,S=A===void 0?1/0:A,P=n.startPanPosition,O=n.startRotatePos,C=n.startRotationX,T=n.startRotationOrbit,I=n.startZoomPosition,R=n.startZoom;return i=r.call(this,{width:a,height:o,rotationX:u,rotationOrbit:f,target:p,zoom:v,minRotationX:g,maxRotationX:_,minZoom:x,maxZoom:S},{startPanPosition:P,startRotatePos:O,startRotationX:C,startRotationOrbit:T,startZoomPosition:I,startZoom:R}),(0,ah.default)((0,hy.default)(i),"makeViewport",void 0),i.makeViewport=n.makeViewport,i}return(0,V5.default)(e,[{key:"panStart",value:function(i){var a=i.pos;return this._getUpdatedState({startPanPosition:this._unproject(a)})}},{key:"pan",value:function(i){var a=i.pos,o=i.startPosition,s=this.getState().startPanPosition||o;if(!s)return this;var u=this.makeViewport(this.getViewportProps()),l=u.panByPosition(s,a);return this._getUpdatedState(l)}},{key:"panEnd",value:function(){return this._getUpdatedState({startPanPosition:null})}},{key:"rotateStart",value:function(i){var a=i.pos;return this._getUpdatedState({startRotatePos:a,startRotationX:this.getViewportProps().rotationX,startRotationOrbit:this.getViewportProps().rotationOrbit})}},{key:"rotate",value:function(i){var a=i.pos,o=i.deltaAngleX,s=o===void 0?0:o,u=i.deltaAngleY,l=u===void 0?0:u,f=this.getState(),c=f.startRotatePos,p=f.startRotationX,d=f.startRotationOrbit,v=this.getViewportProps(),m=v.width,g=v.height;if(!c||p===void 0||d===void 0)return this;var y;if(a){var _=(a[0]-c[0])/m,b=(a[1]-c[1])/g;(p<-90||p>90)&&(_*=-1),y={rotationX:p+b*180,rotationOrbit:d+_*180}}else y={rotationX:p+l,rotationOrbit:d+s};return this._getUpdatedState(y)}},{key:"rotateEnd",value:function(){return this._getUpdatedState({startRotationX:null,startRotationOrbit:null})}},{key:"shortestPathFrom",value:function(i){var a=i.getViewportProps(),o=qs({},this.getViewportProps()),s=o.rotationOrbit;return Math.abs(s-a.rotationOrbit)>180&&(o.rotationOrbit=s<0?s+360:s-360),o}},{key:"zoomStart",value:function(i){var a=i.pos;return this._getUpdatedState({startZoomPosition:this._unproject(a),startZoom:this.getViewportProps().zoom})}},{key:"zoom",value:function(i){var a=i.pos,o=i.startPos,s=i.scale,u=this.getState(),l=u.startZoom,f=u.startZoomPosition;if(f||(l=this.getViewportProps().zoom,f=this._unproject(o)||this._unproject(a)),!f)return this;var c=this._calculateNewZoom({scale:s,startZoom:l}),p=this.makeViewport(qs(qs({},this.getViewportProps()),{},{zoom:c}));return this._getUpdatedState(qs({zoom:c},p.panByPosition(f,a)))}},{key:"zoomEnd",value:function(){return this._getUpdatedState({startZoomPosition:null,startZoom:null})}},{key:"zoomIn",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this._getUpdatedState({zoom:this._calculateNewZoom({scale:i})})}},{key:"zoomOut",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this._getUpdatedState({zoom:this._calculateNewZoom({scale:1/i})})}},{key:"moveLeft",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50;return this._panFromCenter([-i,0])}},{key:"moveRight",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50;return this._panFromCenter([i,0])}},{key:"moveUp",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50;return this._panFromCenter([0,-i])}},{key:"moveDown",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50;return this._panFromCenter([0,i])}},{key:"rotateLeft",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit-i})}},{key:"rotateRight",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit+i})}},{key:"rotateUp",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({rotationX:this.getViewportProps().rotationX-i})}},{key:"rotateDown",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({rotationX:this.getViewportProps().rotationX+i})}},{key:"_unproject",value:function(i){var a=this.makeViewport(this.getViewportProps());return i&&a.unproject(i)}},{key:"_calculateNewZoom",value:function(i){var a=i.scale,o=i.startZoom,s=this.getViewportProps(),u=s.maxZoom,l=s.minZoom;o===void 0&&(o=this.getViewportProps().zoom);var f=o+Math.log2(a);return We(f,l,u)}},{key:"_panFromCenter",value:function(i){var a=this.getViewportProps(),o=a.width,s=a.height,u=a.target;return this.pan({startPosition:u,pos:[o/2+i[0],s/2+i[1]]})}},{key:"_getUpdatedState",value:function(i){return new this.constructor(qs(qs(qs({makeViewport:this.makeViewport},this.getViewportProps()),this.getState()),i))}},{key:"applyConstraints",value:function(i){var a=i.maxZoom,o=i.minZoom,s=i.zoom,u=i.maxRotationX,l=i.minRotationX,f=i.rotationOrbit;return i.zoom=Array.isArray(s)?[We(s[0],o,a),We(s[1],o,a)]:We(s,o,a),i.rotationX=We(i.rotationX,l,u),(f<-180||f>180)&&(i.rotationOrbit=js(f+180,360)-180),i}}]),e}(Gl),dy=function(t){(0,Mw.default)(e,t);var r=W5(e);function e(){var n;(0,Cw.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,ah.default)((0,hy.default)(n),"ControllerState",Iw),(0,ah.default)((0,hy.default)(n),"transition",{transitionDuration:300,transitionInterpolator:new Zr({transitionProps:{compare:["target","zoom","rotationX","rotationOrbit"],required:["target","zoom"]}})}),n}return e}(Ln);function UAe(t){var r=GAe();return function(){var n=(0,Rw.default)(t),i;if(r){var a=(0,Rw.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Y5.default)(this,i)}}function GAe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Lw=function(t){(0,q5.default)(e,t);var r=UAe(e);function e(){var n,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,$5.default)(this,e),n=r.call(this,i),n.props.orbitAxis=i.orbitAxis||"Z",n}return(0,X5.default)(e,[{key:"ViewportType",get:function(){return sy}},{key:"ControllerType",get:function(){return dy}}]),e}(Rn);(0,K5.default)(Lw,"displayName","OrbitView");var eH=h(L()),tH=h(N()),rH=h(Y()),nH=h(K()),Nw=h(q()),iH=h(B());var Z5=h(me()),Bw=h(L()),Fw=h(N()),oh=h(be()),Dw=h(Y()),J5=h(K()),kw=h(q()),sh=h(B());function Q5(t){var r=zAe();return function(){var n=(0,kw.default)(t),i;if(r){var a=(0,kw.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,J5.default)(this,i)}}function zAe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var VAe=function(t){(0,Dw.default)(e,t);var r=Q5(e);function e(n){var i;return(0,Bw.default)(this,e),i=r.call(this,n),(0,sh.default)((0,oh.default)(i),"zoomAxis",void 0),i.zoomAxis=n.zoomAxis||"all",i}return(0,Fw.default)(e,[{key:"_calculateNewZoom",value:function(i){var a=i.scale,o=i.startZoom,s=this.getViewportProps(),u=s.maxZoom,l=s.minZoom;o===void 0&&(o=this.getViewportProps().zoom);var f=Math.log2(a);if(Array.isArray(o)){var c=o,p=(0,Z5.default)(c,2),d=p[0],v=p[1];switch(this.zoomAxis){case"X":d=We(d+f,l,u);break;case"Y":v=We(v+f,l,u);break;default:var m=Math.min(d+f,v+f);m<l&&(f+=l-m),m=Math.max(d+f,v+f),m>u&&(f+=u-m),d+=f,v+=f}return[d,v]}return We(o+f,l,u)}}]),e}(Iw),vy=function(t){(0,Dw.default)(e,t);var r=Q5(e);function e(){var n;(0,Bw.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,sh.default)((0,oh.default)(n),"ControllerState",VAe),(0,sh.default)((0,oh.default)(n),"transition",{transitionDuration:300,transitionInterpolator:new Zr(["target","zoom"])}),(0,sh.default)((0,oh.default)(n),"dragMode","pan"),n}return(0,Fw.default)(e,[{key:"_onPanRotate",value:function(){return!1}}]),e}(Ln);function HAe(t){var r=WAe();return function(){var n=(0,Nw.default)(t),i;if(r){var a=(0,Nw.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,nH.default)(this,i)}}function WAe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var jw=function(t){(0,rH.default)(e,t);var r=HAe(e);function e(){return(0,eH.default)(this,e),r.apply(this,arguments)}return(0,tH.default)(e,[{key:"ViewportType",get:function(){return Ql}},{key:"ControllerType",get:function(){return vy}}]),e}(Rn);(0,iH.default)(jw,"displayName","OrthographicView");var uH=h(L()),lH=h(N()),fH=h(Y()),cH=h(K()),Vw=h(q()),pH=h(B());var my=h(be()),aH=h(Ee()),gy=h(B()),Uw=h(L()),Gw=h(N()),zw=h(Y()),oH=h(K()),yy=h(q());function sH(t){var r=$Ae();return function(){var n=(0,yy.default)(t),i;if(r){var a=(0,yy.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,oH.default)(this,i)}}function $Ae(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var XAe=function(t){(0,zw.default)(e,t);var r=sH(e);function e(){return(0,Uw.default)(this,e),r.apply(this,arguments)}return(0,Gw.default)(e,[{key:"applyConstraints",value:function(i){var a=i.maxZoom,o=i.minZoom,s=i.zoom;i.zoom=We(s,o,a);var u=i.longitude,l=i.latitude;return(u<-180||u>180)&&(i.longitude=js(u+180,360)-180),i.latitude=We(l,-89,89),i}}]),e}(PT),_y=function(t){(0,zw.default)(e,t);var r=sH(e);function e(){var n;(0,Uw.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,gy.default)((0,my.default)(n),"ControllerState",XAe),(0,gy.default)((0,my.default)(n),"transition",{transitionDuration:300,transitionInterpolator:new Zr(["longitude","latitude","zoom"])}),(0,gy.default)((0,my.default)(n),"dragMode","pan"),n}return(0,Gw.default)(e,[{key:"setProps",value:function(i){(0,aH.default)((0,yy.default)(e.prototype),"setProps",this).call(this,i),this.dragRotate=!1,this.touchRotate=!1}}]),e}(Ln);function qAe(t){var r=YAe();return function(){var n=(0,Vw.default)(t),i;if(r){var a=(0,Vw.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cH.default)(this,i)}}function YAe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Hw=function(t){(0,fH.default)(e,t);var r=qAe(e);function e(){return(0,uH.default)(this,e),r.apply(this,arguments)}return(0,lH.default)(e,[{key:"ViewportType",get:function(){return Jl}},{key:"ControllerType",get:function(){return _y}}]),e}(Rn);(0,pH.default)(Hw,"displayName","GlobeView");var hH=h(L()),dH=h(N()),by=h(B());var Gt=function(){function t(r){(0,hH.default)(this,t),(0,by.default)(this,"opts",void 0),r&&(this.opts=r)}return(0,dH.default)(t,[{key:"equals",value:function(e){return this===e?!0:this.constructor===e.constructor&&Lt(this.opts,e.opts,1)}},{key:"getShaders",value:function(e){return null}},{key:"getSubLayerProps",value:function(e){var n=e.constructor,i=n.defaultProps,a={updateTriggers:{}};for(var o in i)if(o in this.props){var s=i[o],u=this.props[o];a[o]=u,s&&s.type==="accessor"&&(a.updateTriggers[o]=this.props.updateTriggers[o],typeof u=="function"&&(a[o]=this.getSubLayerAccessor(u)))}return a}},{key:"initializeState",value:function(e,n){}},{key:"updateState",value:function(e,n){}},{key:"onNeedsRedraw",value:function(e){}},{key:"getNeedsPickingBuffer",value:function(e){return!1}},{key:"draw",value:function(e,n){}},{key:"finalizeState",value:function(e,n){}}],[{key:"componentName",get:function(){return Object.prototype.hasOwnProperty.call(this,"extensionName")?this.extensionName:""}}]),t}();(0,by.default)(Gt,"defaultProps",{});(0,by.default)(Gt,"extensionName","LayerExtension");var gH=h(L()),yH=h(N()),_H=h(be()),bH=h(Y()),xH=h(K()),$w=h(q()),Xw=h(B());function vH(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function mH(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?vH(Object(e),!0).forEach(function(n){(0,Xw.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):vH(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function KAe(t){var r=ZAe();return function(){var n=(0,$w.default)(t),i;if(r){var a=(0,$w.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,xH.default)(this,i)}}function ZAe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Ww={bearing:0,pitch:0,position:[0,0,0]},JAe={speed:1.2,curve:1.414},AH=function(t){(0,bH.default)(e,t);var r=KAe(e);function e(){var n,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,gH.default)(this,e),n=r.call(this,{compare:["longitude","latitude","zoom","bearing","pitch","position"],extract:["width","height","longitude","latitude","zoom","bearing","pitch","position"],required:["width","height","latitude","longitude","zoom"]}),(0,Xw.default)((0,_H.default)(n),"opts",void 0),n.opts=mH(mH({},JAe),i),n}return(0,yH.default)(e,[{key:"interpolateProps",value:function(i,a,o){var s=hg(i,a,o,this.opts);for(var u in Ww)s[u]=sr(i[u]||Ww[u],a[u]||Ww[u],o);return s}},{key:"getDuration",value:function(i,a){var o=a.transitionDuration;return o==="auto"&&(o=uT(i,a,this.opts)),o}}]),e}(jl);var wH=h(L()),PH=h(N()),zr=h(B());function SH(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=QAe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function QAe(t,r){if(t){if(typeof t=="string")return TH(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return TH(t,r)}}function TH(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var ef=function(){function t(r){(0,wH.default)(this,t),(0,zr.default)(this,"opts",void 0),(0,zr.default)(this,"typedArrayManager",void 0),(0,zr.default)(this,"indexStarts",[0]),(0,zr.default)(this,"vertexStarts",[0]),(0,zr.default)(this,"vertexCount",0),(0,zr.default)(this,"instanceCount",0),(0,zr.default)(this,"attributes",void 0),(0,zr.default)(this,"_attributeDefs",void 0),(0,zr.default)(this,"data",void 0),(0,zr.default)(this,"getGeometry",void 0),(0,zr.default)(this,"geometryBuffer",void 0),(0,zr.default)(this,"buffers",void 0),(0,zr.default)(this,"positionSize",void 0),(0,zr.default)(this,"normalize",void 0);var e=r.attributes,n=e===void 0?{}:e;this.typedArrayManager=ai,this.attributes={},this._attributeDefs=n,this.opts=r,this.updateGeometry(r)}return(0,PH.default)(t,[{key:"updateGeometry",value:function(e){Object.assign(this.opts,e);var n=this.opts,i=n.data,a=n.buffers,o=a===void 0?{}:a,s=n.getGeometry,u=n.geometryBuffer,l=n.positionFormat,f=n.dataChanged,c=n.normalize,p=c===void 0?!0:c;if(this.data=i,this.getGeometry=s,this.positionSize=u&&u.size||(l==="XY"?2:3),this.buffers=o,this.normalize=p,u&&(rt(i.startIndices),this.getGeometry=this.getGeometryFromBuffer(u),p||(o.positions=u)),this.geometryBuffer=o.positions,Array.isArray(f)){var d=SH(f),v;try{for(d.s();!(v=d.n()).done;){var m=v.value;this._rebuildGeometry(m)}}catch(g){d.e(g)}finally{d.f()}}else this._rebuildGeometry()}},{key:"updatePartialGeometry",value:function(e){var n=e.startRow,i=e.endRow;this._rebuildGeometry({startRow:n,endRow:i})}},{key:"getGeometryFromBuffer",value:function(e){var n=e.value||e;return ArrayBuffer.isView(n)?Wg(n,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}},{key:"_allocate",value:function(e,n){var i=this.attributes,a=this.buffers,o=this._attributeDefs,s=this.typedArrayManager;for(var u in o)if(u in a)s.release(i[u]),i[u]=null;else{var l=o[u];l.copy=n,i[u]=s.allocate(i[u],e,l)}}},{key:"_forEachGeometry",value:function(e,n,i){var a=this.data,o=this.getGeometry,s=Ut(a,n,i),u=s.iterable,l=s.objectInfo,f=SH(u),c;try{for(f.s();!(c=f.n()).done;){var p=c.value;l.index++;var d=o?o(p,l):null;e(d,l.index)}}catch(v){f.e(v)}finally{f.f()}}},{key:"_rebuildGeometry",value:function(e){var n=this;if(this.data){var i=this.indexStarts,a=this.vertexStarts,o=this.instanceCount,s=this.data,u=this.geometryBuffer,l=e||{},f=l.startRow,c=f===void 0?0:f,p=l.endRow,d=p===void 0?1/0:p,v={};if(e||(i=[0],a=[0]),this.normalize||!u)this._forEachGeometry(function(x,A){var S=x&&n.normalizeGeometry(x);v[A]=S,a[A+1]=a[A]+(S?n.getGeometrySize(S):0)},c,d),o=a[a.length-1];else if(a=s.startIndices,o=a[s.length]||0,ArrayBuffer.isView(u))o=o||u.length/this.positionSize;else if(u instanceof xe){var m=u.accessor.stride||this.positionSize*4;o=o||u.byteLength/m}else if(u.buffer){var g=u.stride||this.positionSize*4;o=o||u.buffer.byteLength/g}else if(u.value){var y=u.value,_=u.stride/y.BYTES_PER_ELEMENT||this.positionSize;o=o||y.length/_}this._allocate(o,Boolean(e)),this.indexStarts=i,this.vertexStarts=a,this.instanceCount=o;var b={};this._forEachGeometry(function(x,A){var S=v[A]||x;b.vertexStart=a[A],b.indexStart=i[A];var P=A<a.length-1?a[A+1]:o;b.geometrySize=P-a[A],b.geometryIndex=A,n.updateGeometryAttributes(S,b)},c,d),this.vertexCount=i[i.length-1]}}}]),t}();var IH=h(L()),RH=h(N()),LH=h(be()),qw=h(Ee()),kH=h(Y()),BH=h(K()),uh=h(q()),lh=h(B());var OH=`#define SHADER_NAME arc-layer-vertex-shader

attribute vec3 positions;
attribute vec4 instanceSourceColors;
attribute vec4 instanceTargetColors;
attribute vec3 instanceSourcePositions;
attribute vec3 instanceSourcePositions64Low;
attribute vec3 instanceTargetPositions;
attribute vec3 instanceTargetPositions64Low;
attribute vec3 instancePickingColors;
attribute float instanceWidths;
attribute float instanceHeights;
attribute float instanceTilts;

uniform bool greatCircle;
uniform bool useShortestPath;
uniform float numSegments;
uniform float opacity;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform int widthUnits;

varying vec4 vColor;
varying vec2 uv;
varying float isValid;

float paraboloid(float distance, float sourceZ, float targetZ, float ratio) {

  float deltaZ = targetZ - sourceZ;
  float dh = distance * instanceHeights;
  if (dh == 0.0) {
    return sourceZ + deltaZ * ratio;
  }
  float unitZ = deltaZ / dh;
  float p2 = unitZ * unitZ + 1.0;
  float dir = step(deltaZ, 0.0);
  float z0 = mix(sourceZ, targetZ, dir);
  float r = mix(ratio, 1.0 - ratio, dir);
  return sqrt(r * (p2 - r)) * dh + z0;
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  return dir_screenspace * offset_direction * width / 2.0;
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (numSegments - 1.0));
}

vec3 interpolateFlat(vec3 source, vec3 target, float segmentRatio) {
  float distance = length(source.xy - target.xy);
  float z = paraboloid(distance, source.z, target.z, segmentRatio);

  float tiltAngle = radians(instanceTilts);
  vec2 tiltDirection = normalize(target.xy - source.xy);
  vec2 tilt = vec2(-tiltDirection.y, tiltDirection.x) * z * sin(tiltAngle);

  return vec3(
    mix(source.xy, target.xy, segmentRatio) + tilt,
    z * cos(tiltAngle)
  );
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 sourceRadians = radians(source);
  vec2 targetRadians = radians(target);
  vec2 sin_half_delta = sin((sourceRadians - targetRadians) / 2.0);
  vec2 shd_sq = sin_half_delta * sin_half_delta;

  float a = shd_sq.y + cos(sourceRadians.y) * cos(targetRadians.y) * shd_sq.x;
  return 2.0 * asin(sqrt(a));
}

vec3 interpolateGreatCircle(vec3 source, vec3 target, vec3 source3D, vec3 target3D, float angularDist, float t) {
  vec2 lngLat;
  if(abs(angularDist - PI) < 0.001) {
    lngLat = (1.0 - t) * source.xy + t * target.xy;
  } else {
    float a = sin((1.0 - t) * angularDist);
    float b = sin(t * angularDist);
    vec3 p = source3D.yxz * a + target3D.yxz * b;
    lngLat = degrees(vec2(atan(p.y, -p.x), atan(p.z, length(p.xy))));
  }

  float z = paraboloid(angularDist * EARTH_RADIUS, source.z, target.z, t);

  return vec3(lngLat, z);
}

void main(void) {
  geometry.worldPosition = instanceSourcePositions;
  geometry.worldPositionAlt = instanceTargetPositions;

  float segmentIndex = positions.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float prevSegmentRatio = getSegmentRatio(max(0.0, segmentIndex - 1.0));
  float nextSegmentRatio = getSegmentRatio(min(numSegments - 1.0, segmentIndex + 1.0));
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  isValid = 1.0;

  uv = vec2(segmentRatio, positions.y);
  geometry.uv = uv;
  geometry.pickingColor = instancePickingColors;

  vec4 curr;
  vec4 next;
  vec3 source;
  vec3 target;

  if ((greatCircle || project_uProjectionMode == PROJECTION_MODE_GLOBE) && project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    source = project_globe_(vec3(instanceSourcePositions.xy, 0.0));
    target = project_globe_(vec3(instanceTargetPositions.xy, 0.0));
    float angularDist = getAngularDist(instanceSourcePositions.xy, instanceTargetPositions.xy);

    vec3 prevPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, prevSegmentRatio);
    vec3 currPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, segmentRatio);
    vec3 nextPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, nextSegmentRatio);

    if (abs(currPos.x - prevPos.x) > 180.0) {
      indexDir = -1.0;
      isValid = 0.0;
    } else if (abs(currPos.x - nextPos.x) > 180.0) {
      indexDir = 1.0;
      isValid = 0.0;
    }
    nextPos = indexDir < 0.0 ? prevPos : nextPos;
    nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;

    if (isValid == 0.0) {
      nextPos.x += nextPos.x > 0.0 ? -360.0 : 360.0;
      float t = ((currPos.x > 0.0 ? 180.0 : -180.0) - currPos.x) / (nextPos.x - currPos.x);
      currPos = mix(currPos, nextPos, t);
      segmentRatio = mix(segmentRatio, nextSegmentRatio, t);
    }

    vec3 currPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, segmentRatio);
    vec3 nextPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, nextSegmentRatio);
  
    curr = project_position_to_clipspace(currPos, currPos64Low, vec3(0.0), geometry.position);
    next = project_position_to_clipspace(nextPos, nextPos64Low, vec3(0.0));
  
  } else {
    vec3 source_world = instanceSourcePositions;
    vec3 target_world = instanceTargetPositions;
    if (useShortestPath) {
      source_world.x = mod(source_world.x + 180., 360.0) - 180.;
      target_world.x = mod(target_world.x + 180., 360.0) - 180.;

      float deltaLng = target_world.x - source_world.x;
      if (deltaLng > 180.) target_world.x -= 360.;
      if (deltaLng < -180.) source_world.x -= 360.;
    }
    source = project_position(source_world, instanceSourcePositions64Low);
    target = project_position(target_world, instanceTargetPositions64Low);
    float antiMeridianX = 0.0;

    if (useShortestPath) {
      if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
        antiMeridianX = -(project_uCoordinateOrigin.x + 180.) / 360. * TILE_SIZE;
      }
      float thresholdRatio = (antiMeridianX - source.x) / (target.x - source.x);

      if (prevSegmentRatio <= thresholdRatio && nextSegmentRatio > thresholdRatio) {
        isValid = 0.0;
        indexDir = sign(segmentRatio - thresholdRatio);
        segmentRatio = thresholdRatio;
      }
    }

    nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;
    vec3 currPos = interpolateFlat(source, target, segmentRatio);
    vec3 nextPos = interpolateFlat(source, target, nextSegmentRatio);

    if (useShortestPath) {
      if (nextPos.x < antiMeridianX) {
        currPos.x += TILE_SIZE;
        nextPos.x += TILE_SIZE;
      }
    }

    curr = project_common_position_to_clipspace(vec4(currPos, 1.0));
    next = project_common_position_to_clipspace(vec4(nextPos, 1.0));
    geometry.position = vec4(currPos, 1.0);
  }
  float widthPixels = clamp(
    project_size_to_pixel(instanceWidths * widthScale, widthUnits),
    widthMinPixels, widthMaxPixels
  );
  vec3 offset = vec3(
    getExtrusionOffset((next.xy - curr.xy) * indexDir, positions.y, widthPixels),
    0.0);
  DECKGL_FILTER_SIZE(offset, geometry);
  DECKGL_FILTER_GL_POSITION(curr, geometry);
  gl_Position = curr + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);

  vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio);
  vColor = vec4(color.rgb, color.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var EH=`#define SHADER_NAME arc-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 uv;
varying float isValid;

void main(void) {
  if (isValid == 0.0) {
    discard;
  }

  gl_FragColor = vColor;
  geometry.uv = uv;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;function CH(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function MH(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?CH(Object(e),!0).forEach(function(n){(0,lh.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):CH(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function eSe(t){var r=tSe();return function(){var n=(0,uh.default)(t),i;if(r){var a=(0,uh.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,BH.default)(this,i)}}function tSe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var xy=[0,0,0,255],rSe={getSourcePosition:{type:"accessor",value:function(r){return r.sourcePosition}},getTargetPosition:{type:"accessor",value:function(r){return r.targetPosition}},getSourceColor:{type:"accessor",value:xy},getTargetColor:{type:"accessor",value:xy},getWidth:{type:"accessor",value:1},getHeight:{type:"accessor",value:1},getTilt:{type:"accessor",value:0},greatCircle:!1,widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}},tf=function(t){(0,kH.default)(e,t);var r=eSe(e);function e(){var n;(0,IH.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,lh.default)((0,LH.default)(n),"state",void 0),n}return(0,RH.default)(e,[{key:"getBounds",value:function(){var i;return(i=this.getAttributeManager())===null||i===void 0?void 0:i.getBounds(["instanceSourcePositions","instanceTargetPositions"])}},{key:"getShaders",value:function(){return(0,qw.default)((0,uh.default)(e.prototype),"getShaders",this).call(this,{vs:OH,fs:EH,modules:[Je,st]})}},{key:"wrapLongitude",get:function(){return!1}},{key:"initializeState",value:function(){var i=this.getAttributeManager();i.addInstanced({instanceSourcePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceSourceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getSourceColor",defaultValue:xy},instanceTargetColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getTargetColor",defaultValue:xy},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1},instanceHeights:{size:1,transition:!0,accessor:"getHeight",defaultValue:1},instanceTilts:{size:1,transition:!0,accessor:"getTilt",defaultValue:0}})}},{key:"updateState",value:function(i){if((0,qw.default)((0,uh.default)(e.prototype),"updateState",this).call(this,i),i.changeFlags.extensionsChanged){var a,o=this.context.gl;(a=this.state.model)===null||a===void 0||a.delete(),this.state.model=this._getModel(o),this.getAttributeManager().invalidateAll()}}},{key:"draw",value:function(i){var a=i.uniforms,o=this.props,s=o.widthUnits,u=o.widthScale,l=o.widthMinPixels,f=o.widthMaxPixels,c=o.greatCircle,p=o.wrapLongitude;this.state.model.setUniforms(a).setUniforms({greatCircle:c,widthUnits:St[s],widthScale:u,widthMinPixels:l,widthMaxPixels:f,useShortestPath:p}).draw()}},{key:"_getModel",value:function(i){for(var a=[],o=50,s=0;s<o;s++)a=a.concat([s,1,0,s,-1,0]);var u=new Ce(i,MH(MH({},this.getShaders()),{},{id:this.props.id,geometry:new Me({drawMode:5,attributes:{positions:new Float32Array(a)}}),isInstanced:!0}));return u.setUniforms({numSegments:o}),u}}]),e}(He);(0,lh.default)(tf,"layerName","ArcLayer");(0,lh.default)(tf,"defaultProps",rSe);var UH=h(me()),GH=h(L()),zH=h(N()),VH=h(be()),Kw=h(Ee()),HH=h(Y()),WH=h(K()),ch=h(q()),ph=h(B());var nSe=new Uint16Array([0,2,1,0,3,2]),iSe=new Float32Array([0,1,0,0,1,0,1,1]);function Yw(t,r){if(!r)return aSe(t);for(var e=Math.max(Math.abs(t[0][0]-t[3][0]),Math.abs(t[1][0]-t[2][0])),n=Math.max(Math.abs(t[1][1]-t[0][1]),Math.abs(t[2][1]-t[3][1])),i=Math.ceil(e/r)+1,a=Math.ceil(n/r)+1,o=(i-1)*(a-1)*6,s=new Uint32Array(o),u=new Float32Array(i*a*2),l=new Float64Array(i*a*3),f=0,c=0,p=0;p<i;p++)for(var d=p/(i-1),v=0;v<a;v++){var m=v/(a-1),g=oSe(t,d,m);l[f*3+0]=g[0],l[f*3+1]=g[1],l[f*3+2]=g[2]||0,u[f*2+0]=d,u[f*2+1]=1-m,p>0&&v>0&&(s[c++]=f-a,s[c++]=f-a-1,s[c++]=f-1,s[c++]=f-a,s[c++]=f-1,s[c++]=f),f++}return{vertexCount:o,positions:l,indices:s,texCoords:u}}function aSe(t){for(var r=new Float64Array(12),e=0;e<t.length;e++)r[e*3+0]=t[e][0],r[e*3+1]=t[e][1],r[e*3+2]=t[e][2]||0;return{vertexCount:6,positions:r,indices:nSe,texCoords:iSe}}function oSe(t,r,e){return sr(sr(t[0],t[1],e),sr(t[3],t[2],e),r)}var FH=`
#define SHADER_NAME bitmap-layer-vertex-shader

attribute vec2 texCoords;
attribute vec3 positions;
attribute vec3 positions64Low;

varying vec2 vTexCoord;
varying vec2 vTexPos;

uniform float coordinateConversion;

const vec3 pickingColor = vec3(1.0, 0.0, 0.0);

void main(void) {
  geometry.worldPosition = positions;
  geometry.uv = texCoords;
  geometry.pickingColor = pickingColor;

  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  vTexCoord = texCoords;

  if (coordinateConversion < -0.5) {
    vTexPos = geometry.position.xy + project_uCommonOrigin.xy;
  } else if (coordinateConversion > 0.5) {
    vTexPos = geometry.worldPosition.xy;
  }

  vec4 color = vec4(0.0);
  DECKGL_FILTER_COLOR(color, geometry);
}
`;var sSe=`
vec3 packUVsIntoRGB(vec2 uv) {
  // Extract the top 8 bits. We want values to be truncated down so we can add a fraction
  vec2 uv8bit = floor(uv * 256.);

  // Calculate the normalized remainders of u and v parts that do not fit into 8 bits
  // Scale and clamp to 0-1 range
  vec2 uvFraction = fract(uv * 256.);
  vec2 uvFraction4bit = floor(uvFraction * 16.);

  // Remainder can be encoded in blue channel, encode as 4 bits for pixel coordinates
  float fractions = uvFraction4bit.x + uvFraction4bit.y * 16.;

  return vec3(uv8bit, fractions) / 255.;
}
`,DH=`
#define SHADER_NAME bitmap-layer-fragment-shader

#ifdef GL_ES
precision highp float;
#endif

uniform sampler2D bitmapTexture;

varying vec2 vTexCoord;
varying vec2 vTexPos;

uniform float desaturate;
uniform vec4 transparentColor;
uniform vec3 tintColor;
uniform float opacity;

uniform float coordinateConversion;
uniform vec4 bounds;

/* projection utils */
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / PI / 2.0;

// from degrees to Web Mercator
vec2 lnglat_to_mercator(vec2 lnglat) {
  float x = lnglat.x;
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// from Web Mercator to degrees
vec2 mercator_to_lnglat(vec2 xy) {
  xy /= WORLD_SCALE;
  return degrees(vec2(
    xy.x - PI,
    atan(exp(xy.y - PI)) * 2.0 - PI * 0.5
  ));
}
/* End projection utils */

// apply desaturation
vec3 color_desaturate(vec3 color) {
  float luminance = (color.r + color.g + color.b) * 0.333333333;
  return mix(color, vec3(luminance), desaturate);
}

// apply tint
vec3 color_tint(vec3 color) {
  return color * tintColor;
}

// blend with background color
vec4 apply_opacity(vec3 color, float alpha) {
  if (transparentColor.a == 0.0) {
    return vec4(color, alpha);
  }
  float blendedAlpha = alpha + transparentColor.a * (1.0 - alpha);
  float highLightRatio = alpha / blendedAlpha;
  vec3 blendedRGB = mix(transparentColor.rgb, color, highLightRatio);
  return vec4(blendedRGB, blendedAlpha);
}

vec2 getUV(vec2 pos) {
  return vec2(
    (pos.x - bounds[0]) / (bounds[2] - bounds[0]),
    (pos.y - bounds[3]) / (bounds[1] - bounds[3])
  );
}

`.concat(sSe,`

void main(void) {
  vec2 uv = vTexCoord;
  if (coordinateConversion < -0.5) {
    vec2 lnglat = mercator_to_lnglat(vTexPos);
    uv = getUV(lnglat);
  } else if (coordinateConversion > 0.5) {
    vec2 commonPos = lnglat_to_mercator(vTexPos);
    uv = getUV(commonPos);
  }
  vec4 bitmapColor = texture2D(bitmapTexture, uv);

  gl_FragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * opacity);

  geometry.uv = uv;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);

  if (picking_uActive && !picking_uAttribute) {
    // Since instance information is not used, we can use picking color for pixel index
    gl_FragColor.rgb = packUVsIntoRGB(uv);
  }
}
`);function NH(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function fh(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?NH(Object(e),!0).forEach(function(n){(0,ph.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):NH(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function uSe(t){var r=lSe();return function(){var n=(0,ch.default)(t),i;if(r){var a=(0,ch.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,WH.default)(this,i)}}function lSe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var fSe={image:{type:"image",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},_imageCoordinateSystem:ue.DEFAULT,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]},textureParameters:{type:"object",ignore:!0}},rf=function(t){(0,HH.default)(e,t);var r=uSe(e);function e(){var n;(0,GH.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,ph.default)((0,VH.default)(n),"state",void 0),n}return(0,zH.default)(e,[{key:"getShaders",value:function(){return(0,Kw.default)((0,ch.default)(e.prototype),"getShaders",this).call(this,{vs:FH,fs:DH,modules:[Je,st]})}},{key:"initializeState",value:function(){var i=this,a=this.getAttributeManager();a.remove(["instancePickingColors"]);var o=!0;a.add({indices:{size:1,isIndexed:!0,update:function(u){return u.value=i.state.mesh.indices},noAlloc:o},positions:{size:3,type:5130,fp64:this.use64bitPositions(),update:function(u){return u.value=i.state.mesh.positions},noAlloc:o},texCoords:{size:2,update:function(u){return u.value=i.state.mesh.texCoords},noAlloc:o}})}},{key:"updateState",value:function(i){var a=i.props,o=i.oldProps,s=i.changeFlags,u=this.getAttributeManager();if(s.extensionsChanged){var l,f=this.context.gl;(l=this.state.model)===null||l===void 0||l.delete(),this.state.model=this._getModel(f),u.invalidateAll()}if(a.bounds!==o.bounds){var c=this.state.mesh,p=this._createMesh();this.state.model.setVertexCount(p.vertexCount);for(var d in p)c&&c[d]!==p[d]&&u.invalidate(d);this.setState(fh({mesh:p},this._getCoordinateUniforms()))}else a._imageCoordinateSystem!==o._imageCoordinateSystem&&this.setState(this._getCoordinateUniforms())}},{key:"getPickingInfo",value:function(i){var a=this.props.image,o=i.info;if(!o.color||!a)return o.bitmap=null,o;var s=a,u=s.width,l=s.height;o.index=0;var f=cSe(o.color),c=[Math.floor(f[0]*u),Math.floor(f[1]*l)];return o.bitmap={size:{width:u,height:l},uv:f,pixel:c},o}},{key:"disablePickingIndex",value:function(){this.setState({disablePicking:!0})}},{key:"restorePickingColors",value:function(){this.setState({disablePicking:!1})}},{key:"_updateAutoHighlight",value:function(i){(0,Kw.default)((0,ch.default)(e.prototype),"_updateAutoHighlight",this).call(this,fh(fh({},i),{},{color:this.encodePickingColor(0)}))}},{key:"_createMesh",value:function(){var i=this.props.bounds,a=i;return jH(i)&&(a=[[i[0],i[1]],[i[0],i[3]],[i[2],i[3]],[i[2],i[1]]]),Yw(a,this.context.viewport.resolution)}},{key:"_getModel",value:function(i){return i?new Ce(i,fh(fh({},this.getShaders()),{},{id:this.props.id,geometry:new Me({drawMode:4,vertexCount:6}),isInstanced:!1})):null}},{key:"draw",value:function(i){var a=i.uniforms,o=i.moduleParameters,s=this.state,u=s.model,l=s.coordinateConversion,f=s.bounds,c=s.disablePicking,p=this.props,d=p.image,v=p.desaturate,m=p.transparentColor,g=p.tintColor;o.pickingActive&&c||d&&u&&u.setUniforms(a).setUniforms({bitmapTexture:d,desaturate:v,transparentColor:m.map(function(y){return y/255}),tintColor:g.slice(0,3).map(function(y){return y/255}),coordinateConversion:l,bounds:f}).draw()}},{key:"_getCoordinateUniforms",value:function(){var i=ue.LNGLAT,a=ue.CARTESIAN,o=ue.DEFAULT,s=this.props._imageCoordinateSystem;if(s!==o){var u=this.props.bounds;if(!jH(u))throw new Error("_imageCoordinateSystem only supports rectangular bounds");var l=this.context.viewport.resolution?i:a;if(s=s===i?i:a,s===i&&l===a)return{coordinateConversion:-1,bounds:u};if(s===a&&l===i){var f=wt([u[0],u[1]]),c=wt([u[2],u[3]]);return{coordinateConversion:1,bounds:[f[0],f[1],c[0],c[1]]}}}return{coordinateConversion:0,bounds:[0,0,0,0]}}}]),e}(He);(0,ph.default)(rf,"layerName","BitmapLayer");(0,ph.default)(rf,"defaultProps",fSe);function cSe(t){var r=(0,UH.default)(t,3),e=r[0],n=r[1],i=r[2],a=(i&240)/256,o=(i&15)/16;return[(e+o)/256,(n+a)/256]}function jH(t){return Number.isFinite(t[0])}var a9=h(L()),o9=h(N()),s9=h(be()),dh=h(Ee()),u9=h(Y()),l9=h(K()),Ys=h(q()),vh=h(B());var $H=`#define SHADER_NAME icon-layer-vertex-shader

attribute vec2 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceSizes;
attribute float instanceAngles;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;
attribute vec4 instanceIconFrames;
attribute float instanceColorModes;
attribute vec2 instanceOffsets;
attribute vec2 instancePixelOffset;

uniform float sizeScale;
uniform vec2 iconsTextureDim;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform bool billboard;
uniform int sizeUnits;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = angle * PI / 180.0;
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
}

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;

  vec2 iconSize = instanceIconFrames.zw;
  float sizePixels = clamp(
    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits), 
    sizeMinPixels, sizeMaxPixels
  );
  float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
  vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
  pixelOffset += instancePixelOffset;
  pixelOffset.y *= -1.0;

  if (billboard)  {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
    vec3 offset = vec3(pixelOffset, 0.0);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);

  } else {
    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
    DECKGL_FILTER_SIZE(offset_common, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position); 
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }

  vTextureCoords = mix(
    instanceIconFrames.xy,
    instanceIconFrames.xy + iconSize,
    (positions.xy + 1.0) / 2.0
  ) / iconsTextureDim;

  vColor = instanceColors;
  DECKGL_FILTER_COLOR(vColor, geometry);

  vColorMode = instanceColorModes;
}
`;var XH=`#define SHADER_NAME icon-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D iconsTexture;
uniform float alphaCutoff;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  vec4 texColor = texture2D(iconsTexture, vTextureCoords);
  vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
  float a = texColor.a * opacity * vColor.a;

  if (a < alphaCutoff) {
    discard;
  }

  gl_FragColor = vec4(color, a);
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;var QH=h(L()),e9=h(N()),Bt=h(B());var nf;function t9(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=pSe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function pSe(t,r){if(t){if(typeof t=="string")return qH(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return qH(t,r)}}function qH(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function YH(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Ay(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?YH(Object(e),!0).forEach(function(n){(0,Bt.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):YH(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var hSe=1024,dSe=4,KH=function(){},ZH=(nf={},(0,Bt.default)(nf,10241,9987),(0,Bt.default)(nf,10240,9729),(0,Bt.default)(nf,10242,33071),(0,Bt.default)(nf,10243,33071),nf);function vSe(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function mSe(t,r,e,n){var i=Math.min(e/r.width,n/r.height),a=Math.floor(r.width*i),o=Math.floor(r.height*i);return i===1?{data:r,width:a,height:o}:(t.canvas.height=o,t.canvas.width=a,t.clearRect(0,0,a,o),t.drawImage(r,0,0,r.width,r.height,0,0,a,o),{data:t.canvas,width:a,height:o})}function hh(t){return t&&(t.id||t.url)}function gSe(t,r,e,n){var i=t.width,a=t.height,o=new we(t.gl,{width:r,height:e,parameters:n});return sl(t,o,{targetY:0,width:i,height:a}),t.delete(),o}function JH(t,r,e){for(var n=0;n<r.length;n++){var i=r[n],a=i.icon,o=i.xOffset,s=hh(a);t[s]=Ay(Ay({},a),{},{x:o,y:e})}}function ySe(t){for(var r=t.icons,e=t.buffer,n=t.mapping,i=n===void 0?{}:n,a=t.xOffset,o=a===void 0?0:a,s=t.yOffset,u=s===void 0?0:s,l=t.rowHeight,f=l===void 0?0:l,c=t.canvasWidth,p=[],d=0;d<r.length;d++){var v=r[d],m=hh(v);if(!i[m]){var g=v.height,y=v.width;o+y+e>c&&(JH(i,p,u),o=0,u=f+u+e,f=0,p=[]),p.push({icon:v,xOffset:o}),o=o+y+e,f=Math.max(f,g)}}return p.length>0&&JH(i,p,u),{mapping:i,rowHeight:f,xOffset:o,yOffset:u,canvasWidth:c,canvasHeight:vSe(f+u+e)}}function _Se(t,r,e){if(!t||!r)return null;e=e||{};var n={},i=Ut(t),a=i.iterable,o=i.objectInfo,s=t9(a),u;try{for(s.s();!(u=s.n()).done;){var l=u.value;o.index++;var f=r(l,o),c=hh(f);if(!f)throw new Error("Icon is missing.");if(!f.url)throw new Error("Icon url is missing.");!n[c]&&(!e[c]||f.url!==e[c].url)&&(n[c]=Ay(Ay({},f),{},{source:l,sourceIndex:o.index}))}}catch(p){s.e(p)}finally{s.f()}return n}var r9=function(){function t(r,e){var n=e.onUpdate,i=n===void 0?KH:n,a=e.onError,o=a===void 0?KH:a;(0,QH.default)(this,t),(0,Bt.default)(this,"gl",void 0),(0,Bt.default)(this,"onUpdate",void 0),(0,Bt.default)(this,"onError",void 0),(0,Bt.default)(this,"_loadOptions",null),(0,Bt.default)(this,"_texture",null),(0,Bt.default)(this,"_externalTexture",null),(0,Bt.default)(this,"_mapping",{}),(0,Bt.default)(this,"_textureParameters",null),(0,Bt.default)(this,"_pendingCount",0),(0,Bt.default)(this,"_autoPacking",!1),(0,Bt.default)(this,"_xOffset",0),(0,Bt.default)(this,"_yOffset",0),(0,Bt.default)(this,"_rowHeight",0),(0,Bt.default)(this,"_buffer",dSe),(0,Bt.default)(this,"_canvasWidth",hSe),(0,Bt.default)(this,"_canvasHeight",0),(0,Bt.default)(this,"_canvas",null),this.gl=r,this.onUpdate=i,this.onError=o}return(0,e9.default)(t,[{key:"finalize",value:function(){var e;(e=this._texture)===null||e===void 0||e.delete()}},{key:"getTexture",value:function(){return this._texture||this._externalTexture}},{key:"getIconMapping",value:function(e){var n=this._autoPacking?hh(e):e;return this._mapping[n]||{}}},{key:"setProps",value:function(e){var n=e.loadOptions,i=e.autoPacking,a=e.iconAtlas,o=e.iconMapping,s=e.textureParameters;if(n&&(this._loadOptions=n),i!==void 0&&(this._autoPacking=i),o&&(this._mapping=o),a){var u;(u=this._texture)===null||u===void 0||u.delete(),this._texture=null,this._externalTexture=a}s&&(this._textureParameters=s)}},{key:"isLoaded",get:function(){return this._pendingCount===0}},{key:"packIcons",value:function(e,n){if(!(!this._autoPacking||typeof document>"u")){var i=Object.values(_Se(e,n,this._mapping)||{});if(i.length>0){var a=ySe({icons:i,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset}),o=a.mapping,s=a.xOffset,u=a.yOffset,l=a.rowHeight,f=a.canvasHeight;this._rowHeight=l,this._mapping=o,this._xOffset=s,this._yOffset=u,this._canvasHeight=f,this._texture||(this._texture=new we(this.gl,{width:this._canvasWidth,height:this._canvasHeight,parameters:this._textureParameters||ZH})),this._texture.height!==this._canvasHeight&&(this._texture=gSe(this._texture,this._canvasWidth,this._canvasHeight,this._textureParameters||ZH)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(i)}}}},{key:"_loadIcons",value:function(e){var n=this,i=this._canvas.getContext("2d",{willReadFrequently:!0}),a=t9(e),o;try{var s=function(){var l=o.value;n._pendingCount++,Jt(l.url,n._loadOptions).then(function(f){var c=hh(l),p=n._mapping[c],d=p.x,v=p.y,m=p.width,g=p.height,y=mSe(i,f,m,g),_=y.data,b=y.width,x=y.height;n._texture.setSubImageData({data:_,x:d+(m-b)/2,y:v+(g-x)/2,width:b,height:x}),p.width=b,p.height=x,n._texture.generateMipmap(),n.onUpdate()}).catch(function(f){n.onError({url:l.url,source:l.source,sourceIndex:l.sourceIndex,loadOptions:n._loadOptions,error:f})}).finally(function(){n._pendingCount--})};for(a.s();!(o=a.n()).done;)s()}catch(u){a.e(u)}finally{a.f()}}}]),t}();function n9(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function i9(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?n9(Object(e),!0).forEach(function(n){(0,vh.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):n9(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function bSe(t){var r=xSe();return function(){var n=(0,Ys.default)(t),i;if(r){var a=(0,Ys.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,l9.default)(this,i)}}function xSe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var f9=[0,0,0,255],ASe={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:function(r){return r.position}},getIcon:{type:"accessor",value:function(r){return r.icon}},getColor:{type:"accessor",value:f9},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0}},Co=function(t){(0,u9.default)(e,t);var r=bSe(e);function e(){var n;(0,a9.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,vh.default)((0,s9.default)(n),"state",void 0),n}return(0,o9.default)(e,[{key:"getShaders",value:function(){return(0,dh.default)((0,Ys.default)(e.prototype),"getShaders",this).call(this,{vs:$H,fs:XH,modules:[Je,st]})}},{key:"initializeState",value:function(){this.state={iconManager:new r9(this.context.gl,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})};var i=this.getAttributeManager();i.addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:5121,accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:f9},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}},{key:"updateState",value:function(i){(0,dh.default)((0,Ys.default)(e.prototype),"updateState",this).call(this,i);var a=i.props,o=i.oldProps,s=i.changeFlags,u=this.getAttributeManager(),l=a.iconAtlas,f=a.iconMapping,c=a.data,p=a.getIcon,d=a.textureParameters,v=this.state.iconManager,m=l||this.internalState.isAsyncPropLoading("iconAtlas");if(v.setProps({loadOptions:a.loadOptions,autoPacking:!m,iconAtlas:l,iconMapping:m?f:null,textureParameters:d}),m?o.iconMapping!==a.iconMapping&&u.invalidate("getIcon"):(s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getIcon))&&v.packIcons(c,p),s.extensionsChanged){var g,y=this.context.gl;(g=this.state.model)===null||g===void 0||g.delete(),this.state.model=this._getModel(y),u.invalidateAll()}}},{key:"isLoaded",get:function(){return(0,dh.default)((0,Ys.default)(e.prototype),"isLoaded",this)&&this.state.iconManager.isLoaded}},{key:"finalizeState",value:function(i){(0,dh.default)((0,Ys.default)(e.prototype),"finalizeState",this).call(this,i),this.state.iconManager.finalize()}},{key:"draw",value:function(i){var a=i.uniforms,o=this.props,s=o.sizeScale,u=o.sizeMinPixels,l=o.sizeMaxPixels,f=o.sizeUnits,c=o.billboard,p=o.alphaCutoff,d=this.state.iconManager,v=d.getTexture();v&&this.state.model.setUniforms(a).setUniforms({iconsTexture:v,iconsTextureDim:[v.width,v.height],sizeUnits:St[f],sizeScale:s,sizeMinPixels:u,sizeMaxPixels:l,billboard:c,alphaCutoff:p}).draw()}},{key:"_getModel",value:function(i){var a=[-1,-1,-1,1,1,1,1,-1];return new Ce(i,i9(i9({},this.getShaders()),{},{id:this.props.id,geometry:new Me({drawMode:6,attributes:{positions:{size:2,value:new Float32Array(a)}}}),isInstanced:!0}))}},{key:"_onUpdate",value:function(){this.setNeedsRedraw()}},{key:"_onError",value:function(i){var a,o=(a=this.getCurrentLayer())===null||a===void 0?void 0:a.props.onIconError;o?o(i):J.error(i.error.message)()}},{key:"getInstanceOffset",value:function(i){var a=this.state.iconManager.getIconMapping(i),o=a.width,s=a.height,u=a.anchorX,l=u===void 0?o/2:u,f=a.anchorY,c=f===void 0?s/2:f;return[o/2-l,s/2-c]}},{key:"getInstanceColorMode",value:function(i){var a=this.state.iconManager.getIconMapping(i);return a.mask?1:0}},{key:"getInstanceIconFrame",value:function(i){var a=this.state.iconManager.getIconMapping(i),o=a.x,s=a.y,u=a.width,l=a.height;return[o,s,u,l]}}]),e}(He);(0,vh.default)(Co,"defaultProps",ASe);(0,vh.default)(Co,"layerName","IconLayer");var v9=h(L()),m9=h(N()),Zw=h(Ee()),g9=h(Y()),y9=h(K()),mh=h(q()),Sy=h(B());var c9=`#define SHADER_NAME line-layer-vertex-shader

attribute vec3 positions;
attribute vec3 instanceSourcePositions;
attribute vec3 instanceTargetPositions;
attribute vec3 instanceSourcePositions64Low;
attribute vec3 instanceTargetPositions64Low;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;
attribute float instanceWidths;

uniform float opacity;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float useShortestPath;
uniform int widthUnits;

varying vec4 vColor;
varying vec2 uv;
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  return dir_screenspace * offset_direction * width / 2.0;
}

vec3 splitLine(vec3 a, vec3 b, float x) {
  float t = (x - a.x) / (b.x - a.x);
  return vec3(x, mix(a.yz, b.yz, t));
}

void main(void) {
  geometry.worldPosition = instanceSourcePositions;
  geometry.worldPositionAlt = instanceTargetPositions;

  vec3 source_world = instanceSourcePositions;
  vec3 target_world = instanceTargetPositions;
  vec3 source_world_64low = instanceSourcePositions64Low;
  vec3 target_world_64low = instanceTargetPositions64Low;

  if (useShortestPath > 0.5 || useShortestPath < -0.5) {
    source_world.x = mod(source_world.x + 180., 360.0) - 180.;
    target_world.x = mod(target_world.x + 180., 360.0) - 180.;
    float deltaLng = target_world.x - source_world.x;

    if (deltaLng * useShortestPath > 180.) {
      source_world.x += 360. * useShortestPath;
      source_world = splitLine(source_world, target_world, 180. * useShortestPath);
      source_world_64low = vec3(0.0);
    } else if (deltaLng * useShortestPath < -180.) {
      target_world.x += 360. * useShortestPath;
      target_world = splitLine(source_world, target_world, 180. * useShortestPath);
      target_world_64low = vec3(0.0);
    } else if (useShortestPath < 0.) {
      gl_Position = vec4(0.);
      return;
    }
  }
  vec4 source_commonspace;
  vec4 target_commonspace;
  vec4 source = project_position_to_clipspace(source_world, source_world_64low, vec3(0.), source_commonspace);
  vec4 target = project_position_to_clipspace(target_world, target_world_64low, vec3(0.), target_commonspace);
  float segmentIndex = positions.x;
  vec4 p = mix(source, target, segmentIndex);
  geometry.position = mix(source_commonspace, target_commonspace, segmentIndex);
  uv = positions.xy;
  geometry.uv = uv;
  geometry.pickingColor = instancePickingColors;
  float widthPixels = clamp(
    project_size_to_pixel(instanceWidths * widthScale, widthUnits),
    widthMinPixels, widthMaxPixels
  );
  vec3 offset = vec3(
    getExtrusionOffset(target.xy - source.xy, positions.y, widthPixels),
    0.0);
  DECKGL_FILTER_SIZE(offset, geometry);
  DECKGL_FILTER_GL_POSITION(p, geometry);
  gl_Position = p + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var p9=`#define SHADER_NAME line-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;function h9(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function d9(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?h9(Object(e),!0).forEach(function(n){(0,Sy.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):h9(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function SSe(t){var r=TSe();return function(){var n=(0,mh.default)(t),i;if(r){var a=(0,mh.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,y9.default)(this,i)}}function TSe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var wSe=[0,0,0,255],PSe={getSourcePosition:{type:"accessor",value:function(r){return r.sourcePosition}},getTargetPosition:{type:"accessor",value:function(r){return r.targetPosition}},getColor:{type:"accessor",value:wSe},getWidth:{type:"accessor",value:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}},af=function(t){(0,g9.default)(e,t);var r=SSe(e);function e(){return(0,v9.default)(this,e),r.apply(this,arguments)}return(0,m9.default)(e,[{key:"getBounds",value:function(){var i;return(i=this.getAttributeManager())===null||i===void 0?void 0:i.getBounds(["instanceSourcePositions","instanceTargetPositions"])}},{key:"getShaders",value:function(){return(0,Zw.default)((0,mh.default)(e.prototype),"getShaders",this).call(this,{vs:c9,fs:p9,modules:[Je,st]})}},{key:"wrapLongitude",get:function(){return!1}},{key:"initializeState",value:function(){var i=this.getAttributeManager();i.addInstanced({instanceSourcePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1}})}},{key:"updateState",value:function(i){if((0,Zw.default)((0,mh.default)(e.prototype),"updateState",this).call(this,i),i.changeFlags.extensionsChanged){var a,o=this.context.gl;(a=this.state.model)===null||a===void 0||a.delete(),this.state.model=this._getModel(o),this.getAttributeManager().invalidateAll()}}},{key:"draw",value:function(i){var a=i.uniforms,o=this.props,s=o.widthUnits,u=o.widthScale,l=o.widthMinPixels,f=o.widthMaxPixels,c=o.wrapLongitude;this.state.model.setUniforms(a).setUniforms({widthUnits:St[s],widthScale:u,widthMinPixels:l,widthMaxPixels:f,useShortestPath:c?1:0}).draw(),c&&this.state.model.setUniforms({useShortestPath:-1}).draw()}},{key:"_getModel",value:function(i){var a=[0,-1,0,0,1,0,1,-1,0,1,1,0];return new Ce(i,d9(d9({},this.getShaders()),{},{id:this.props.id,geometry:new Me({drawMode:5,attributes:{positions:new Float32Array(a)}}),isInstanced:!0}))}}]),e}(He);(0,Sy.default)(af,"layerName","LineLayer");(0,Sy.default)(af,"defaultProps",PSe);var S9=h(L()),T9=h(N()),Jw=h(Ee()),w9=h(Y()),P9=h(K()),gh=h(q()),Ty=h(B());var _9=`#define SHADER_NAME point-cloud-layer-vertex-shader

attribute vec3 positions;
attribute vec3 instanceNormals;
attribute vec4 instanceColors;
attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform float radiusPixels;
uniform int sizeUnits;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.normal = project_normal(instanceNormals);
  unitPosition = positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;
  vec3 offset = vec3(positions.xy * project_size_to_pixel(radiusPixels, sizeUnits), 0.0);
  DECKGL_FILTER_SIZE(offset, geometry);

  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
  vColor = vec4(lightColor, instanceColors.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var b9=`#define SHADER_NAME point-cloud-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.uv = unitPosition;

  float distToCenter = length(unitPosition);

  if (distToCenter > 1.0) {
    discard;
  }

  gl_FragColor = vColor;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;function x9(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function A9(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?x9(Object(e),!0).forEach(function(n){(0,Ty.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):x9(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function OSe(t){var r=ESe();return function(){var n=(0,gh.default)(t),i;if(r){var a=(0,gh.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,P9.default)(this,i)}}function ESe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var O9=[0,0,0,255],E9=[0,0,1],CSe={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:function(r){return r.position}},getNormal:{type:"accessor",value:E9},getColor:{type:"accessor",value:O9},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function MSe(t){var r=t.header,e=t.attributes;!r||!e||(t.length=r.vertexCount,e.POSITION&&(e.instancePositions=e.POSITION),e.NORMAL&&(e.instanceNormals=e.NORMAL),e.COLOR_0&&(e.instanceColors=e.COLOR_0))}var of=function(t){(0,w9.default)(e,t);var r=OSe(e);function e(){return(0,S9.default)(this,e),r.apply(this,arguments)}return(0,T9.default)(e,[{key:"getShaders",value:function(){return(0,Jw.default)((0,gh.default)(e.prototype),"getShaders",this).call(this,{vs:_9,fs:b9,modules:[Je,pn,st]})}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:E9},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:O9}})}},{key:"updateState",value:function(i){var a=i.changeFlags,o=i.props;if((0,Jw.default)((0,gh.default)(e.prototype),"updateState",this).call(this,i),a.extensionsChanged){var s,u=this.context.gl;(s=this.state.model)===null||s===void 0||s.delete(),this.state.model=this._getModel(u),this.getAttributeManager().invalidateAll()}a.dataChanged&&MSe(o.data)}},{key:"draw",value:function(i){var a=i.uniforms,o=this.props,s=o.pointSize,u=o.sizeUnits;this.state.model.setUniforms(a).setUniforms({sizeUnits:St[u],radiusPixels:s}).draw()}},{key:"_getModel",value:function(i){for(var a=[],o=0;o<3;o++){var s=o/3*Math.PI*2;a.push(Math.cos(s)*2,Math.sin(s)*2,0)}return new Ce(i,A9(A9({},this.getShaders()),{},{id:this.props.id,geometry:new Me({drawMode:4,attributes:{positions:new Float32Array(a)}}),isInstanced:!0}))}}]),e}(He);(0,Ty.default)(of,"layerName","PointCloudLayer");(0,Ty.default)(of,"defaultProps",CSe);var k9=h(L()),B9=h(N()),Qw=h(Ee()),F9=h(Y()),D9=h(K()),yh=h(q()),wy=h(B());var C9=`#define SHADER_NAME scatterplot-layer-vertex-shader

attribute vec3 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceRadius;
attribute float instanceLineWidths;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform float radiusScale;
uniform float radiusMinPixels;
uniform float radiusMaxPixels;
uniform float lineWidthScale;
uniform float lineWidthMinPixels;
uniform float lineWidthMaxPixels;
uniform float stroked;
uniform bool filled;
uniform bool antialiasing;
uniform bool billboard;
uniform int radiusUnits;
uniform int lineWidthUnits;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying vec2 unitPosition;
varying float innerUnitRadius;
varying float outerRadiusPixels;


void main(void) {
  geometry.worldPosition = instancePositions;
  outerRadiusPixels = clamp(
    project_size_to_pixel(radiusScale * instanceRadius, radiusUnits),
    radiusMinPixels, radiusMaxPixels
  );
  float lineWidthPixels = clamp(
    project_size_to_pixel(lineWidthScale * instanceLineWidths, lineWidthUnits),
    lineWidthMinPixels, lineWidthMaxPixels
  );
  outerRadiusPixels += stroked * lineWidthPixels / 2.0;
  float edgePadding = antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
  unitPosition = edgePadding * positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;

  innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;
  
  if (billboard) {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
    vec3 offset = edgePadding * positions * outerRadiusPixels;
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  } else {
    vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }
  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
  DECKGL_FILTER_COLOR(vFillColor, geometry);
  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
  DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`;var M9=`#define SHADER_NAME scatterplot-layer-fragment-shader

precision highp float;

uniform bool filled;
uniform float stroked;
uniform bool antialiasing;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying vec2 unitPosition;
varying float innerUnitRadius;
varying float outerRadiusPixels;

void main(void) {
  geometry.uv = unitPosition;

  float distToCenter = length(unitPosition) * outerRadiusPixels;
  float inCircle = antialiasing ? 
    smoothedge(distToCenter, outerRadiusPixels) : 
    step(distToCenter, outerRadiusPixels);

  if (inCircle == 0.0) {
    discard;
  }

  if (stroked > 0.5) {
    float isLine = antialiasing ? 
      smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
      step(innerUnitRadius * outerRadiusPixels, distToCenter);

    if (filled) {
      gl_FragColor = mix(vFillColor, vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        discard;
      }
      gl_FragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
    }
  } else if (filled) {
    gl_FragColor = vFillColor;
  } else {
    discard;
  }

  gl_FragColor.a *= inCircle;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;function I9(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function R9(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?I9(Object(e),!0).forEach(function(n){(0,wy.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):I9(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function ISe(t){var r=RSe();return function(){var n=(0,yh.default)(t),i;if(r){var a=(0,yh.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,D9.default)(this,i)}}function RSe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var L9=[0,0,0,255],LSe={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:function(r){return r.position}},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:L9},getLineColor:{type:"accessor",value:L9},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}},sf=function(t){(0,F9.default)(e,t);var r=ISe(e);function e(){return(0,k9.default)(this,e),r.apply(this,arguments)}return(0,B9.default)(e,[{key:"getShaders",value:function(){return(0,Qw.default)((0,yh.default)(e.prototype),"getShaders",this).call(this,{vs:C9,fs:M9,modules:[Je,st]})}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}},{key:"updateState",value:function(i){if((0,Qw.default)((0,yh.default)(e.prototype),"updateState",this).call(this,i),i.changeFlags.extensionsChanged){var a,o=this.context.gl;(a=this.state.model)===null||a===void 0||a.delete(),this.state.model=this._getModel(o),this.getAttributeManager().invalidateAll()}}},{key:"draw",value:function(i){var a=i.uniforms,o=this.props,s=o.radiusUnits,u=o.radiusScale,l=o.radiusMinPixels,f=o.radiusMaxPixels,c=o.stroked,p=o.filled,d=o.billboard,v=o.antialiasing,m=o.lineWidthUnits,g=o.lineWidthScale,y=o.lineWidthMinPixels,_=o.lineWidthMaxPixels;this.state.model.setUniforms(a).setUniforms({stroked:c?1:0,filled:p,billboard:d,antialiasing:v,radiusUnits:St[s],radiusScale:u,radiusMinPixels:l,radiusMaxPixels:f,lineWidthUnits:St[m],lineWidthScale:g,lineWidthMinPixels:y,lineWidthMaxPixels:_}).draw()}},{key:"_getModel",value:function(i){var a=[-1,-1,0,1,-1,0,1,1,0,-1,1,0];return new Ce(i,R9(R9({},this.getShaders()),{},{id:this.props.id,geometry:new Me({drawMode:6,vertexCount:4,attributes:{positions:{size:3,value:new Float32Array(a)}}}),isInstanced:!0}))}}]),e}(He);(0,wy.default)(sf,"defaultProps",LSe);(0,wy.default)(sf,"layerName","ScatterplotLayer");var pW=h(L()),hW=h(N()),uP=h(Ee()),dW=h(Y()),vW=h(K()),Ph=h(q()),Ry=h(B());var nW=h(B()),iW=h(L()),aW=h(Y()),oW=h(K()),sP=h(q());var G9=h(L()),z9=h(N());var uf={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function Mo(t,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=N9(t,e);return n!==r?(kSe(t,e),!0):!1}function N9(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Math.sign(Ma(t,r))}function Ma(t){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=r.start,n=e===void 0?0:e,i=r.end,a=i===void 0?t.length:i,o=r.size||2,s=0,u=n,l=a-o;u<a;u+=o)s+=(t[u]-t[l])*(t[u+1]+t[l+1]),l=u;return s/2}function eP(t,r){for(var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=e.start,i=n===void 0?0:n,a=e.end,o=a===void 0?t.length:a,s=e.size,u=s===void 0?2:s,l=e.isClosed,f=(o-i)/u,c=0;c<f-1;++c)r(t[i+c*u],t[i+c*u+1],t[i+(c+1)*u],t[i+(c+1)*u+1],c,c+1);var p=i+(f-1)*u,d=l||tt(t[i],t[p])&&tt(t[i+1],t[p+1]);d||r(t[p],t[p+1],t[i],t[i+1],f-1,0)}function kSe(t,r){for(var e=r.start,n=e===void 0?0:e,i=r.end,a=i===void 0?t.length:i,o=r.size,s=o===void 0?2:o,u=(a-n)/s,l=Math.floor(u/2),f=0;f<l;++f)for(var c=n+f*s,p=n+(u-1-f)*s,d=0;d<s;++d){var v=t[c+d];t[c+d]=t[p+d],t[p+d]=v}}function j9(t,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=BSe(t,e);return n!==r?(t.reverse(),!0):!1}function BSe(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Math.sign(tP(t,r))}function tP(t){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=r.start,n=e===void 0?0:e,i=r.end,a=i===void 0?t.length:i,o=0,s=n,u=a-1;s<a;++s)o+=(t[s][0]-t[u][0])*(t[s][1]+t[u][1]),u=s;return o/2}function U9(t,r){for(var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=e.start,i=n===void 0?0:n,a=e.end,o=a===void 0?t.length:a,s=e.isClosed,u=i;u<o-1;++u)r(t[u],t[u+1],u,u+1);var l=s||tt(t[o-1],t[0]);l||r(t[o-1],t[0],o-1,0)}var V9=function(){function t(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};(0,G9.default)(this,t),w(this,"points",void 0),w(this,"isFlatArray",void 0),w(this,"options",void 0),this.points=r,this.isFlatArray=!Dr(r[0]),this.options={start:e.start||0,end:e.end||r.length,size:e.size||2,isClosed:e.isClosed},Object.freeze(this)}return(0,z9.default)(t,[{key:"getSignedArea",value:function(){return this.isFlatArray?Ma(this.points,this.options):tP(this.points,this.options)}},{key:"getArea",value:function(){return Math.abs(this.getSignedArea())}},{key:"getWindingDirection",value:function(){return Math.sign(this.getSignedArea())}},{key:"forEachSegment",value:function(e){this.isFlatArray?eP(this.points,function(n,i,a,o,s,u){e([n,i],[a,o],s,u)},this.options):U9(this.points,e,this.options)}},{key:"modifyWindingDirection",value:function(e){return this.isFlatArray?Mo(this.points,e,this.options):j9(this.points,e,this.options)}}]),t}();function iP(t,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:2,n=arguments.length>3?arguments[3]:void 0,i=r&&r.length,a=i?r[0]*e:t.length,o=W9(t,0,a,e,!0,n&&n[0]),s=[];if(!o||o.next===o.prev)return s;var u,l,f,c,p,d,v;if(i&&(o=USe(t,r,o,e,n)),t.length>80*e){c=l=t[0],p=f=t[1];for(var m=e;m<a;m+=e)d=t[m],v=t[m+1],d<c&&(c=d),v<p&&(p=v),d>l&&(l=d),v>f&&(f=v);u=Math.max(l-c,f-p),u=u!==0?1/u:0}return _h(o,s,e,c,p,u),s}function W9(t,r,e,n,i,a){var o,s;if(a===void 0&&(a=Ma(t,{start:r,end:e,size:n})),i===a<0)for(o=r;o<e;o+=n)s=H9(o,t[o],t[o+1],s);else for(o=e-n;o>=r;o-=n)s=H9(o,t[o],t[o+1],s);return s&&Ey(s,s.next)&&(xh(s),s=s.next),s}function Io(t,r){if(!t)return t;r||(r=t);var e=t,n;do if(n=!1,!e.steiner&&(Ey(e,e.next)||Ft(e.prev,e,e.next)===0)){if(xh(e),e=r=e.prev,e===e.next)break;n=!0}else e=e.next;while(n||e!==r);return r}function _h(t,r,e,n,i,a,o){if(t){!o&&a&&WSe(t,n,i,a);for(var s=t,u,l;t.prev!==t.next;){if(u=t.prev,l=t.next,a?DSe(t,n,i,a):FSe(t)){r.push(u.i/e),r.push(t.i/e),r.push(l.i/e),xh(t),t=l.next,s=l.next;continue}if(t=l,t===s){o?o===1?(t=NSe(Io(t),r,e),_h(t,r,e,n,i,a,2)):o===2&&jSe(t,r,e,n,i,a):_h(Io(t),r,e,n,i,a,1);break}}}}function FSe(t){var r=t.prev,e=t,n=t.next;if(Ft(r,e,n)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(lf(r.x,r.y,e.x,e.y,n.x,n.y,i.x,i.y)&&Ft(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function DSe(t,r,e,n){var i=t.prev,a=t,o=t.next;if(Ft(i,a,o)>=0)return!1;for(var s=i.x<a.x?i.x<o.x?i.x:o.x:a.x<o.x?a.x:o.x,u=i.y<a.y?i.y<o.y?i.y:o.y:a.y<o.y?a.y:o.y,l=i.x>a.x?i.x>o.x?i.x:o.x:a.x>o.x?a.x:o.x,f=i.y>a.y?i.y>o.y?i.y:o.y:a.y>o.y?a.y:o.y,c=rP(s,u,r,e,n),p=rP(l,f,r,e,n),d=t.prevZ,v=t.nextZ;d&&d.z>=c&&v&&v.z<=p;){if(d!==t.prev&&d!==t.next&&lf(i.x,i.y,a.x,a.y,o.x,o.y,d.x,d.y)&&Ft(d.prev,d,d.next)>=0||(d=d.prevZ,v!==t.prev&&v!==t.next&&lf(i.x,i.y,a.x,a.y,o.x,o.y,v.x,v.y)&&Ft(v.prev,v,v.next)>=0))return!1;v=v.nextZ}for(;d&&d.z>=c;){if(d!==t.prev&&d!==t.next&&lf(i.x,i.y,a.x,a.y,o.x,o.y,d.x,d.y)&&Ft(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;v&&v.z<=p;){if(v!==t.prev&&v!==t.next&&lf(i.x,i.y,a.x,a.y,o.x,o.y,v.x,v.y)&&Ft(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function NSe(t,r,e){var n=t;do{var i=n.prev,a=n.next.next;!Ey(i,a)&&$9(i,n,n.next,a)&&bh(i,a)&&bh(a,i)&&(r.push(i.i/e),r.push(n.i/e),r.push(a.i/e),xh(n),xh(n.next),n=t=a),n=n.next}while(n!==t);return Io(n)}function jSe(t,r,e,n,i,a){var o=t;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&qSe(o,s)){var u=X9(o,s);o=Io(o,o.next),u=Io(u,u.next),_h(o,r,e,n,i,a),_h(u,r,e,n,i,a);return}s=s.next}o=o.next}while(o!==t)}function USe(t,r,e,n,i){var a=[],o,s,u,l,f;for(o=0,s=r.length;o<s;o++)u=r[o]*n,l=o<s-1?r[o+1]*n:t.length,f=W9(t,u,l,n,!1,i&&i[o+1]),f===f.next&&(f.steiner=!0),a.push(XSe(f));for(a.sort(GSe),o=0;o<a.length;o++)zSe(a[o],e),e=Io(e,e.next);return e}function GSe(t,r){return t.x-r.x}function zSe(t,r){if(r=VSe(t,r),r){var e=X9(r,t);Io(r,r.next),Io(e,e.next)}}function VSe(t,r){var e=r,n=t.x,i=t.y,a=-1/0,o;do{if(i<=e.y&&i>=e.next.y&&e.next.y!==e.y){var s=e.x+(i-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(s<=n&&s>a){if(a=s,s===n){if(i===e.y)return e;if(i===e.next.y)return e.next}o=e.x<e.next.x?e:e.next}}e=e.next}while(e!==r);if(!o)return null;if(n===a)return o;var u=o,l=o.x,f=o.y,c=1/0,p;e=o;do n>=e.x&&e.x>=l&&n!==e.x&&lf(i<f?n:a,i,l,f,i<f?a:n,i,e.x,e.y)&&(p=Math.abs(i-e.y)/(n-e.x),bh(e,t)&&(p<c||p===c&&(e.x>o.x||e.x===o.x&&HSe(o,e)))&&(o=e,c=p)),e=e.next;while(e!==u);return o}function HSe(t,r){return Ft(t.prev,t,r.prev)<0&&Ft(r.next,t,t.next)<0}function WSe(t,r,e,n){var i=t;do i.z===null&&(i.z=rP(i.x,i.y,r,e,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,$Se(i)}function $Se(t){var r,e,n=1,i,a,o,s,u,l;do{for(a=t,t=null,l=null,i=0;a;){for(i++,s=a,o=0,e=0;e<n&&(o++,s=s.nextZ,!!s);e++);for(u=n;o>0||u>0&&s;)o!==0&&(u===0||!s||a.z<=s.z)?(r=a,a=a.nextZ,o--):(r=s,s=s.nextZ,u--),l?l.nextZ=r:t=r,r.prevZ=l,l=r;a=s}l.nextZ=null,n*=2}while(i>1);return t}function rP(t,r,e,n,i){return t=32767*(t-e)*i,r=32767*(r-n)*i,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,t|r<<1}function XSe(t){var r=t,e=t;do(r.x<e.x||r.x===e.x&&r.y<e.y)&&(e=r),r=r.next;while(r!==t);return e}function lf(t,r,e,n,i,a,o,s){return(i-o)*(r-s)-(t-o)*(a-s)>=0&&(t-o)*(n-s)-(e-o)*(r-s)>=0&&(e-o)*(a-s)-(i-o)*(n-s)>=0}function qSe(t,r){return t.next.i!==r.i&&t.prev.i!==r.i&&!YSe(t,r)&&(bh(t,r)&&bh(r,t)&&KSe(t,r)&&(Ft(t.prev,t,r.prev)||Ft(t,r.prev,r))||Ey(t,r)&&Ft(t.prev,t,t.next)>0&&Ft(r.prev,r,r.next)>0)}function Ft(t,r,e){return(r.y-t.y)*(e.x-r.x)-(r.x-t.x)*(e.y-r.y)}function Ey(t,r){return t.x===r.x&&t.y===r.y}function $9(t,r,e,n){var i=Oy(Ft(t,r,e)),a=Oy(Ft(t,r,n)),o=Oy(Ft(e,n,t)),s=Oy(Ft(e,n,r));return!!(i!==a&&o!==s||i===0&&Py(t,e,r)||a===0&&Py(t,n,r)||o===0&&Py(e,t,n)||s===0&&Py(e,r,n))}function Py(t,r,e){return r.x<=Math.max(t.x,e.x)&&r.x>=Math.min(t.x,e.x)&&r.y<=Math.max(t.y,e.y)&&r.y>=Math.min(t.y,e.y)}function Oy(t){return t>0?1:t<0?-1:0}function YSe(t,r){var e=t;do{if(e.i!==t.i&&e.next.i!==t.i&&e.i!==r.i&&e.next.i!==r.i&&$9(e,e.next,t,r))return!0;e=e.next}while(e!==t);return!1}function bh(t,r){return Ft(t.prev,t,t.next)<0?Ft(t,r,t.next)>=0&&Ft(t,t.prev,r)>=0:Ft(t,r,t.prev)<0||Ft(t,t.next,r)<0}function KSe(t,r){var e=t,n=!1,i=(t.x+r.x)/2,a=(t.y+r.y)/2;do e.y>a!=e.next.y>a&&e.next.y!==e.y&&i<(e.next.x-e.x)*(a-e.y)/(e.next.y-e.y)+e.x&&(n=!n),e=e.next;while(e!==t);return n}function X9(t,r){var e=new nP(t.i,t.x,t.y),n=new nP(r.i,r.x,r.y),i=t.next,a=r.prev;return t.next=r,r.prev=t,e.next=i,i.prev=e,n.next=e,e.prev=n,a.next=n,n.prev=a,n}function H9(t,r,e,n){var i=new nP(t,r,e);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function xh(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function nP(t,r,e){this.i=t,this.x=r,this.y=e,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Jr(t,r){var e=r.length,n=t.length;if(n>0){for(var i=!0,a=0;a<e;a++)if(t[n-e+a]!==r[a]){i=!1;break}if(i)return!1}for(var o=0;o<e;o++)t[n+o]=r[o];return!0}function Ah(t,r){for(var e=r.length,n=0;n<e;n++)t[n]=r[n]}function Ro(t,r,e,n){for(var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:[],a=n+r*e,o=0;o<e;o++)i[o]=t[a+o];return i}function Cy(t,r,e,n){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:[],a,o;if(e&8)a=(n[3]-t[1])/(r[1]-t[1]),o=3;else if(e&4)a=(n[1]-t[1])/(r[1]-t[1]),o=1;else if(e&2)a=(n[2]-t[0])/(r[0]-t[0]),o=2;else if(e&1)a=(n[0]-t[0])/(r[0]-t[0]),o=0;else return null;for(var s=0;s<t.length;s++)i[s]=(o&1)===s?n[o]:a*(r[s]-t[s])+t[s];return i}function Sh(t,r){var e=0;return t[0]<r[0]?e|=1:t[0]>r[2]&&(e|=2),t[1]<r[1]?e|=4:t[1]>r[3]&&(e|=8),e}function Th(t,r){var e=r||{},n=e.size,i=n===void 0?2:n,a=e.broken,o=a===void 0?!1:a,s=e.gridResolution,u=s===void 0?10:s,l=e.gridOffset,f=l===void 0?[0,0]:l,c=e.startIndex,p=c===void 0?0:c,d=e.endIndex,v=d===void 0?t.length:d,m=(v-p)/i,g=[],y=[g],_=Ro(t,0,i,p),b,x,A=K9(_,u,f,[]),S=[];Jr(g,_);for(var P=1;P<m;P++){for(b=Ro(t,P,i,p,b),x=Sh(b,A);x;){Cy(_,b,x,A,S);var O=Sh(S,A);O&&(Cy(_,S,O,A,S),x=O),Jr(g,S),Ah(_,S),JSe(A,u,x),o&&g.length>i&&(g=[],y.push(g),Jr(g,_)),x=Sh(b,A)}Jr(g,b),Ah(_,b)}return o?y:y[0]}var q9=0,ZSe=1;function My(t,r){for(var e=0;e<r.length;e++)t.push(r[e]);return t}function wh(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,e=arguments.length>2?arguments[2]:void 0;if(!t.length)return[];for(var n=e||{},i=n.size,a=i===void 0?2:i,o=n.gridResolution,s=o===void 0?10:o,u=n.gridOffset,l=u===void 0?[0,0]:u,f=n.edgeTypes,c=f===void 0?!1:f,p=[],d=[{pos:t,types:c?new Array(t.length/a).fill(ZSe):null,holes:r||[]}],v=[[],[]],m=[];d.length;){var g=d.shift(),y=g.pos,_=g.types,b=g.holes;QSe(y,a,b[0]||y.length,v),m=K9(v[0],s,l,m);var x=Sh(v[1],m);if(x){var A=Y9(y,_,a,0,b[0]||y.length,m,x),S={pos:A[0].pos,types:A[0].types,holes:[]},P={pos:A[1].pos,types:A[1].types,holes:[]};d.push(S,P);for(var O=0;O<b.length;O++)A=Y9(y,_,a,b[O],b[O+1]||y.length,m,x),A[0]&&(S.holes.push(S.pos.length),S.pos=My(S.pos,A[0].pos),c&&(S.types=My(S.types,A[0].types))),A[1]&&(P.holes.push(P.pos.length),P.pos=My(P.pos,A[1].pos),c&&(P.types=My(P.types,A[1].types)))}else{var C={positions:y};c&&(C.edgeTypes=_),b.length&&(C.holeIndices=b),p.push(C)}}return p}function Y9(t,r,e,n,i,a,o){for(var s=(i-n)/e,u=[],l=[],f=[],c=[],p=[],d,v,m,g=Ro(t,s-1,e,n),y=Math.sign(o&8?g[1]-a[3]:g[0]-a[2]),_=r&&r[s-1],b=0,x=0,A=0;A<s;A++)d=Ro(t,A,e,n,d),v=Math.sign(o&8?d[1]-a[3]:d[0]-a[2]),m=r&&r[n/e+A],v&&y&&y!==v&&(Cy(g,d,o,a,p),Jr(u,p)&&f.push(_),Jr(l,p)&&c.push(_)),v<=0?(Jr(u,d)&&f.push(m),b-=v):f.length&&(f[f.length-1]=q9),v>=0?(Jr(l,d)&&c.push(m),x+=v):c.length&&(c[c.length-1]=q9),Ah(g,d),y=v,_=m;return[b?{pos:u,types:r&&f}:null,x?{pos:l,types:r&&c}:null]}function K9(t,r,e,n){var i=Math.floor((t[0]-e[0])/r)*r+e[0],a=Math.floor((t[1]-e[1])/r)*r+e[1];return n[0]=i,n[1]=a,n[2]=i+r,n[3]=a+r,n}function JSe(t,r,e){e&8?(t[1]+=r,t[3]+=r):e&4?(t[1]-=r,t[3]-=r):e&2?(t[0]+=r,t[2]+=r):e&1&&(t[0]-=r,t[2]-=r)}function QSe(t,r,e,n){for(var i=1/0,a=-1/0,o=1/0,s=-1/0,u=0;u<e;u+=r){var l=t[u],f=t[u+1];i=l<i?l:i,a=l>a?l:a,o=f<o?f:o,s=f>s?f:s}return n[0][0]=i,n[0][1]=o,n[1][0]=a,n[1][1]=s,n}function J9(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=eTe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function eTe(t,r){if(t){if(typeof t=="string")return Z9(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Z9(t,r)}}function Z9(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var tTe=85.051129;function aP(t,r){var e=r||{},n=e.size,i=n===void 0?2:n,a=e.startIndex,o=a===void 0?0:a,s=e.endIndex,u=s===void 0?t.length:s,l=e.normalize,f=l===void 0?!0:l,c=t.slice(o,u);Q9(c,i,0,u-o);var p=Th(c,{size:i,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(f){var d=J9(p),v;try{for(d.s();!(v=d.n()).done;){var m=v.value;eW(m,i)}}catch(g){d.e(g)}finally{d.f()}}return p}function oP(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,e=arguments.length>2?arguments[2]:void 0,n=e||{},i=n.size,a=i===void 0?2:i,o=n.normalize,s=o===void 0?!0:o,u=n.edgeTypes,l=u===void 0?!1:u;r=r||[];for(var f=[],c=[],p=0,d=0,v=0;v<=r.length;v++){for(var m=r[v]||t.length,g=d,y=rTe(t,a,p,m),_=y;_<m;_++)f[d++]=t[_];for(var b=p;b<y;b++)f[d++]=t[b];Q9(f,a,g,d),nTe(f,a,g,d,e?.maxLatitude),p=m,c[v]=d}c.pop();var x=wh(f,c,{size:a,gridResolution:360,gridOffset:[-180,-180],edgeTypes:l});if(s){var A=J9(x),S;try{for(A.s();!(S=A.n()).done;){var P=S.value;eW(P.positions,a)}}catch(O){A.e(O)}finally{A.f()}}return x}function rTe(t,r,e,n){for(var i=-1,a=-1,o=e+1;o<n;o+=r){var s=Math.abs(t[o]);s>i&&(i=s,a=o-1)}return a}function nTe(t,r,e,n){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:tTe,a=t[e],o=t[n-r];if(Math.abs(a-o)>180){var s=Ro(t,0,r,e);s[0]+=Math.round((o-a)/360)*360,Jr(t,s),s[1]=Math.sign(s[1])*i,Jr(t,s),s[0]=a,Jr(t,s)}}function Q9(t,r,e,n){for(var i=t[0],a,o=e;o<n;o+=r){a=t[o];var s=a-i;(s>180||s<-180)&&(a-=Math.round(s/360)*360),t[o]=i=a}}function eW(t,r){for(var e,n=t.length/r,i=0;i<n&&(e=t[i*r],(e+180)%360===0);i++);var a=-Math.round(e/360)*360;if(a!==0)for(var o=0;o<n;o++)t[o*r]+=a}function tW(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function rW(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?tW(Object(e),!0).forEach(function(n){(0,nW.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):tW(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function iTe(t){var r=aTe();return function(){var n=(0,sP.default)(t),i;if(r){var a=(0,sP.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,oW.default)(this,i)}}function aTe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var sW=function(t){(0,aW.default)(e,t);var r=iTe(e);function e(n){(0,iW.default)(this,e);var i=n.id,a=i===void 0?Ye("column-geometry"):i,o=oTe(n),s=o.indices,u=o.attributes;return r.call(this,rW(rW({},n),{},{id:a,indices:s,attributes:u}))}return e}(Me);function oTe(t){var r=t.radius,e=t.height,n=e===void 0?1:e,i=t.nradial,a=i===void 0?10:i,o=t.vertices;o&&(J.assert(o.length>=a),o=o.flatMap(function(V){return[V[0],V[1]]}),Mo(o,uf.COUNTER_CLOCKWISE));var s=n>0,u=a+1,l=s?u*3+1:a,f=Math.PI*2/a,c=new Uint16Array(s?a*3*2:0),p=new Float32Array(l*3),d=new Float32Array(l*3),v=0;if(s){for(var m=0;m<u;m++)for(var g=m*f,y=m%a,_=Math.sin(g),b=Math.cos(g),x=0;x<2;x++)p[v+0]=o?o[y*2]:b*r,p[v+1]=o?o[y*2+1]:_*r,p[v+2]=(1/2-x)*n,d[v+0]=o?o[y*2]:b,d[v+1]=o?o[y*2+1]:_,v+=3;p[v+0]=p[v-3],p[v+1]=p[v-2],p[v+2]=p[v-1],v+=3}for(var A=s?0:1;A<u;A++){var S=Math.floor(A/2)*Math.sign(.5-A%2),P=S*f,O=(S+a)%a,C=Math.sin(P),T=Math.cos(P);p[v+0]=o?o[O*2]:T*r,p[v+1]=o?o[O*2+1]:C*r,p[v+2]=n/2,d[v+2]=1,v+=3}if(s)for(var I=0,R=0;R<a;R++)c[I++]=R*2+0,c[I++]=R*2+2,c[I++]=R*2+0,c[I++]=R*2+1,c[I++]=R*2+1,c[I++]=R*2+3;return{indices:c,attributes:{POSITION:{size:3,value:p},NORMAL:{size:3,value:d}}}}var uW=`#version 300 es

#define SHADER_NAME column-layer-vertex-shader

in vec3 positions;
in vec3 normals;

in vec3 instancePositions;
in float instanceElevations;
in vec3 instancePositions64Low;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in float instanceStrokeWidths;

in vec3 instancePickingColors;
uniform float opacity;
uniform float radius;
uniform float angle;
uniform vec2 offset;
uniform bool extruded;
uniform bool stroked;
uniform bool isStroke;
uniform float coverage;
uniform float elevationScale;
uniform float edgeDistance;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform int radiusUnits;
uniform int widthUnits;
out vec4 vColor;
#ifdef FLAT_SHADING
out vec4 position_commonspace;
#endif

void main(void) {
  geometry.worldPosition = instancePositions;

  vec4 color = isStroke ? instanceLineColors : instanceFillColors;
  mat2 rotationMatrix = mat2(cos(angle), sin(angle), -sin(angle), cos(angle));
  float elevation = 0.0;
  float strokeOffsetRatio = 1.0;

  if (extruded) {
    elevation = instanceElevations * (positions.z + 1.0) / 2.0 * elevationScale;
  } else if (stroked) {
    float widthPixels = clamp(
      project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
      widthMinPixels, widthMaxPixels) / 2.0;
    float halfOffset = project_pixel_size(widthPixels) / project_size(edgeDistance * coverage * radius);
    if (isStroke) {
      strokeOffsetRatio -= sign(positions.z) * halfOffset;
    } else {
      strokeOffsetRatio -= halfOffset;
    }
  }
  float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);
  float dotRadius = radius * coverage * shouldRender;

  geometry.pickingColor = instancePickingColors;
  vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);
  vec3 centroidPosition64Low = instancePositions64Low;
  vec2 offset = (rotationMatrix * positions.xy * strokeOffsetRatio + offset) * dotRadius;
  if (radiusUnits == UNIT_METERS) {
    offset = project_size(offset);
  }
  vec3 pos = vec3(offset, 0.);
  DECKGL_FILTER_SIZE(pos, geometry);

  gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);
  geometry.normal = project_normal(vec3(rotationMatrix * normals.xy, normals.z));
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  if (extruded && !isStroke) {
#ifdef FLAT_SHADING
    position_commonspace = geometry.position;
    vColor = vec4(color.rgb, color.a * opacity);
#else
    vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
    vColor = vec4(lightColor, color.a * opacity);
#endif
  } else {
    vColor = vec4(color.rgb, color.a * opacity);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var lW=`#version 300 es
#define SHADER_NAME column-layer-fragment-shader

precision highp float;

uniform vec3 project_uCameraPosition;
uniform bool extruded;
uniform bool isStroke;

out vec4 fragColor;

in vec4 vColor;
#ifdef FLAT_SHADING
in vec4 position_commonspace;
#endif

void main(void) {
  fragColor = vColor;
#ifdef FLAT_SHADING
  if (extruded && !isStroke && !picking_uActive) {
    vec3 normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
    fragColor.rgb = lighting_getLightColor(vColor.rgb, project_uCameraPosition, position_commonspace.xyz, normal);
  }
#endif
  DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function fW(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function cW(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?fW(Object(e),!0).forEach(function(n){(0,Ry.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):fW(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function sTe(t){var r=uTe();return function(){var n=(0,Ph.default)(t),i;if(r){var a=(0,Ph.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,vW.default)(this,i)}}function uTe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Iy=[0,0,0,255],lTe={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},radiusUnits:"meters",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,wireframe:!1,filled:!0,stroked:!1,getPosition:{type:"accessor",value:function(r){return r.position}},getFillColor:{type:"accessor",value:Iy},getLineColor:{type:"accessor",value:Iy},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0,getColor:{deprecatedFor:["getFillColor","getLineColor"]}},Wi=function(t){(0,dW.default)(e,t);var r=sTe(e);function e(){return(0,pW.default)(this,e),r.apply(this,arguments)}return(0,hW.default)(e,[{key:"getShaders",value:function(){var i=this.context.gl,a=!ce(i),o={},s=this.props.flatShading&&ti(i,Se.GLSL_DERIVATIVES);return s&&(o.FLAT_SHADING=1),(0,uP.default)((0,Ph.default)(e.prototype),"getShaders",this).call(this,{vs:uW,fs:lW,defines:o,transpileToGLSL100:a,modules:[Je,s?ya:pn,st]})}},{key:"initializeState",value:function(){var i=this.getAttributeManager();i.addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getFillColor",defaultValue:Iy},instanceLineColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getLineColor",defaultValue:Iy},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}},{key:"updateState",value:function(i){(0,uP.default)((0,Ph.default)(e.prototype),"updateState",this).call(this,i);var a=i.props,o=i.oldProps,s=i.changeFlags,u=s.extensionsChanged||a.flatShading!==o.flatShading;if(u){var l,f=this.context.gl;(l=this.state.model)===null||l===void 0||l.delete(),this.state.model=this._getModel(f),this.getAttributeManager().invalidateAll()}(u||a.diskResolution!==o.diskResolution||a.vertices!==o.vertices||(a.extruded||a.stroked)!==(o.extruded||o.stroked))&&this._updateGeometry(a)}},{key:"getGeometry",value:function(i,a,o){var s=new sW({radius:1,height:o?2:0,vertices:a,nradial:i}),u=0;if(a)for(var l=0;l<i;l++){var f=a[l],c=Math.sqrt(f[0]*f[0]+f[1]*f[1]);u+=c/i}else u=1;return this.setState({edgeDistance:Math.cos(Math.PI/i)*u}),s}},{key:"_getModel",value:function(i){return new Ce(i,cW(cW({},this.getShaders()),{},{id:this.props.id,isInstanced:!0}))}},{key:"_updateGeometry",value:function(i){var a=i.diskResolution,o=i.vertices,s=i.extruded,u=i.stroked,l=this.getGeometry(a,o,s||u);this.setState({fillVertexCount:l.attributes.POSITION.value.length/3,wireframeVertexCount:l.indices.value.length}),this.state.model.setProps({geometry:l})}},{key:"draw",value:function(i){var a=i.uniforms,o=this.props,s=o.lineWidthUnits,u=o.lineWidthScale,l=o.lineWidthMinPixels,f=o.lineWidthMaxPixels,c=o.radiusUnits,p=o.elevationScale,d=o.extruded,v=o.filled,m=o.stroked,g=o.wireframe,y=o.offset,_=o.coverage,b=o.radius,x=o.angle,A=this.state,S=A.model,P=A.fillVertexCount,O=A.wireframeVertexCount,C=A.edgeDistance;S.setUniforms(a).setUniforms({radius:b,angle:x/180*Math.PI,offset:y,extruded:d,stroked:m,coverage:_,elevationScale:p,edgeDistance:C,radiusUnits:St[c],widthUnits:St[s],widthScale:u,widthMinPixels:l,widthMaxPixels:f}),d&&g&&(S.setProps({isIndexed:!0}),S.setVertexCount(O).setDrawMode(1).setUniforms({isStroke:!0}).draw()),v&&(S.setProps({isIndexed:!1}),S.setVertexCount(P).setDrawMode(5).setUniforms({isStroke:!1}).draw()),!d&&m&&(S.setProps({isIndexed:!1}),S.setVertexCount(P*2/3).setDrawMode(5).setUniforms({isStroke:!0}).draw())}}]),e}(He);(0,Ry.default)(Wi,"layerName","ColumnLayer");(0,Ry.default)(Wi,"defaultProps",lTe);var mW=h(L()),gW=h(N()),yW=h(Y()),_W=h(K()),lP=h(q()),fP=h(B());function fTe(t){var r=cTe();return function(){var n=(0,lP.default)(t),i;if(r){var a=(0,lP.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_W.default)(this,i)}}function cTe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var pTe={cellSize:{type:"number",min:0,value:1e3},offset:{type:"array",value:[1,1]}},ff=function(t){(0,yW.default)(e,t);var r=fTe(e);function e(){return(0,mW.default)(this,e),r.apply(this,arguments)}return(0,gW.default)(e,[{key:"getGeometry",value:function(i){return new _o}},{key:"draw",value:function(i){var a=i.uniforms,o=this.props,s=o.elevationScale,u=o.extruded,l=o.offset,f=o.coverage,c=o.cellSize,p=o.angle,d=o.radiusUnits;this.state.model.setUniforms(a).setUniforms({radius:c/2,radiusUnits:St[d],angle:p,offset:l,extruded:u,coverage:f,elevationScale:s,edgeDistance:1,isWireframe:!1}).draw()}}]),e}(Wi);(0,fP.default)(ff,"layerName","GridCellLayer");(0,fP.default)(ff,"defaultProps",pTe);var DW=h(L()),NW=h(N()),jW=h(be()),Oh=h(Ee()),UW=h(Y()),GW=h(K()),Ks=h(q()),Eh=h(B());var PW=h(B()),OW=h(L()),EW=h(N()),CW=h(Ee()),MW=h(Y()),IW=h(K()),Ly=h(q());function bW(t,r,e,n){var i;if(Array.isArray(t[0])){var a=t.length*r;i=new Array(a);for(var o=0;o<t.length;o++)for(var s=0;s<r;s++)i[o*r+s]=t[o][s]||0}else i=t;return e?Th(i,{size:r,gridResolution:e}):n?aP(i,{size:r}):i}function xW(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=hTe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function hTe(t,r){if(t){if(typeof t=="string")return AW(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return AW(t,r)}}function AW(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function SW(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function TW(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?SW(Object(e),!0).forEach(function(n){(0,PW.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):SW(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function dTe(t){var r=vTe();return function(){var n=(0,Ly.default)(t),i;if(r){var a=(0,Ly.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,IW.default)(this,i)}}function vTe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var mTe=1,gTe=2,cP=4,RW=function(t){(0,MW.default)(e,t);var r=dTe(e);function e(n){return(0,OW.default)(this,e),r.call(this,TW(TW({},n),{},{attributes:{positions:{size:3,padding:18,initialize:!0,type:n.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}}))}return(0,EW.default)(e,[{key:"get",value:function(i){return this.attributes[i]}},{key:"getGeometryFromBuffer",value:function(i){return this.normalize?(0,CW.default)((0,Ly.default)(e.prototype),"getGeometryFromBuffer",this).call(this,i):null}},{key:"normalizeGeometry",value:function(i){return this.normalize?bW(i,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):i}},{key:"getGeometrySize",value:function(i){if(wW(i)){var a=0,o=xW(i),s;try{for(o.s();!(s=o.n()).done;){var u=s.value;a+=this.getGeometrySize(u)}}catch(f){o.e(f)}finally{o.f()}return a}var l=this.getPathLength(i);return l<2?0:this.isClosed(i)?l<3?0:l+2:l}},{key:"updateGeometryAttributes",value:function(i,a){if(a.geometrySize!==0)if(i&&wW(i)){var o=xW(i),s;try{for(o.s();!(s=o.n()).done;){var u=s.value,l=this.getGeometrySize(u);a.geometrySize=l,this.updateGeometryAttributes(u,a),a.vertexStart+=l}}catch(f){o.e(f)}finally{o.f()}}else this._updateSegmentTypes(i,a),this._updatePositions(i,a)}},{key:"_updateSegmentTypes",value:function(i,a){var o=this.attributes.segmentTypes,s=i?this.isClosed(i):!1,u=a.vertexStart,l=a.geometrySize;o.fill(0,u,u+l),s?(o[u]=cP,o[u+l-2]=cP):(o[u]+=mTe,o[u+l-2]+=gTe),o[u+l-1]=cP}},{key:"_updatePositions",value:function(i,a){var o=this.attributes.positions;if(!(!o||!i))for(var s=a.vertexStart,u=a.geometrySize,l=new Array(3),f=s,c=0;c<u;f++,c++)this.getPointOnPath(i,c,l),o[f*3]=l[0],o[f*3+1]=l[1],o[f*3+2]=l[2]}},{key:"getPathLength",value:function(i){return i.length/this.positionSize}},{key:"getPointOnPath",value:function(i,a){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],s=this.positionSize;a*s>=i.length&&(a+=1-i.length/s);var u=a*s;return o[0]=i[u],o[1]=i[u+1],o[2]=s===3&&i[u+2]||0,o}},{key:"isClosed",value:function(i){if(!this.normalize)return Boolean(this.opts.loop);var a=this.positionSize,o=i.length-a;return i[0]===i[o]&&i[1]===i[o+1]&&(a===2||i[2]===i[o+2])}}]),e}(ef);function wW(t){return Array.isArray(t[0])}var LW=`#define SHADER_NAME path-layer-vertex-shader

attribute vec2 positions;

attribute float instanceTypes;
attribute vec3 instanceStartPositions;
attribute vec3 instanceEndPositions;
attribute vec3 instanceLeftPositions;
attribute vec3 instanceRightPositions;
attribute vec3 instanceLeftPositions64Low;
attribute vec3 instanceStartPositions64Low;
attribute vec3 instanceEndPositions64Low;
attribute vec3 instanceRightPositions64Low;
attribute float instanceStrokeWidths;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;

uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float jointType;
uniform float capType;
uniform float miterLimit;
uniform bool billboard;
uniform int widthUnits;

uniform float opacity;

varying vec4 vColor;
varying vec2 vCornerOffset;
varying float vMiterLength;
varying vec2 vPathPosition;
varying float vPathLength;
varying float vJointType;

const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);

float flipIfTrue(bool flag) {
  return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
  vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
  vec2 width
) {
  bool isEnd = positions.x > 0.0;
  float sideOfPath = positions.y;
  float isJoint = float(sideOfPath == 0.0);

  vec3 deltaA3 = (currPoint - prevPoint);
  vec3 deltaB3 = (nextPoint - currPoint);

  mat3 rotationMatrix;
  bool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);
  if (needsRotation) {
    deltaA3 = deltaA3 * rotationMatrix;
    deltaB3 = deltaB3 * rotationMatrix;
  }
  vec2 deltaA = deltaA3.xy / width;
  vec2 deltaB = deltaB3.xy / width;

  float lenA = length(deltaA);
  float lenB = length(deltaB);

  vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
  vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);

  vec2 perpA = vec2(-dirA.y, dirA.x);
  vec2 perpB = vec2(-dirB.y, dirB.x);
  vec2 tangent = dirA + dirB;
  tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
  vec2 miterVec = vec2(-tangent.y, tangent.x);
  vec2 dir = isEnd ? dirA : dirB;
  vec2 perp = isEnd ? perpA : perpB;
  float L = isEnd ? lenA : lenB;
  float sinHalfA = abs(dot(miterVec, perp));
  float cosHalfA = abs(dot(dirA, miterVec));
  float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
  float cornerPosition = sideOfPath * turnDirection;

  float miterSize = 1.0 / max(sinHalfA, EPSILON);
  miterSize = mix(
    min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
    miterSize,
    step(0.0, cornerPosition)
  );

  vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
    * (sideOfPath + isJoint * turnDirection);
  bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
  bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
  bool isCap = isStartCap || isEndCap;
  if (isCap) {
    offsetVec = mix(perp * sideOfPath, dir * capType * 4.0 * flipIfTrue(isStartCap), isJoint);
    vJointType = capType;
  } else {
    vJointType = jointType;
  }
  vPathLength = L;
  vCornerOffset = offsetVec;
  vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
  vMiterLength = isCap ? isJoint : vMiterLength;

  vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
  vPathPosition = vec2(
    dot(offsetFromStartOfPath, perp),
    dot(offsetFromStartOfPath, dir)
  );
  geometry.uv = vPathPosition;

  float isValid = step(instanceTypes, 3.5);
  vec3 offset = vec3(offsetVec * width * isValid, 0.0);

  if (needsRotation) {
    offset = rotationMatrix * offset;
  }
  return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
  if (position.w < EPSILON) {
    float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
    position = refPosition + (position - refPosition) * r;
  }
}

void main() {
  geometry.pickingColor = instancePickingColors;

  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);

  float isEnd = positions.x;

  vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
  vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);

  vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
  vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);

  vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
  vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);

  geometry.worldPosition = currPosition;
  vec2 widthPixels = vec2(clamp(
    project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
    widthMinPixels, widthMaxPixels) / 2.0);
  vec3 width;

  if (billboard) {
    vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
    vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
    vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);

    clipLine(prevPositionScreen, currPositionScreen);
    clipLine(nextPositionScreen, currPositionScreen);
    clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));

    width = vec3(widthPixels, 0.0);
    DECKGL_FILTER_SIZE(width, geometry);

    vec3 offset = getLineJoinOffset(
      prevPositionScreen.xyz / prevPositionScreen.w,
      currPositionScreen.xyz / currPositionScreen.w,
      nextPositionScreen.xyz / nextPositionScreen.w,
      project_pixel_size_to_clipspace(width.xy)
    );

    DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
    gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
  } else {
    prevPosition = project_position(prevPosition, prevPosition64Low);
    currPosition = project_position(currPosition, currPosition64Low);
    nextPosition = project_position(nextPosition, nextPosition64Low);

    width = vec3(project_pixel_size(widthPixels), 0.0);
    DECKGL_FILTER_SIZE(width, geometry);

    vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
    geometry.position = vec4(currPosition + offset, 1.0);
    gl_Position = project_common_position_to_clipspace(geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var kW=`#define SHADER_NAME path-layer-fragment-shader

precision highp float;

uniform float miterLimit;

varying vec4 vColor;
varying vec2 vCornerOffset;
varying float vMiterLength;
varying vec2 vPathPosition;
varying float vPathLength;
varying float vJointType;

void main(void) {
  geometry.uv = vPathPosition;

  if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
    if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
      discard;
    }
    if (vJointType < 0.5 && vMiterLength > miterLimit + 1.0) {
      discard;
    }
  }
  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;function BW(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function FW(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?BW(Object(e),!0).forEach(function(n){(0,Eh.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):BW(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function yTe(t){var r=_Te();return function(){var n=(0,Ks.default)(t),i;if(r){var a=(0,Ks.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,GW.default)(this,i)}}function _Te(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var zW=[0,0,0,255],bTe={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:function(r){return r.path}},getColor:{type:"accessor",value:zW},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},pP={enter:function(r,e){return e.length?e.subarray(e.length-r.length):r}},$i=function(t){(0,UW.default)(e,t);var r=yTe(e);function e(){var n;(0,DW.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,Eh.default)((0,jW.default)(n),"state",void 0),n}return(0,NW.default)(e,[{key:"getShaders",value:function(){return(0,Oh.default)((0,Ks.default)(e.prototype),"getShaders",this).call(this,{vs:LW,fs:kW,modules:[Je,st]})}},{key:"wrapLongitude",get:function(){return!1}},{key:"initializeState",value:function(){var i=this,a=!0,o=this.getAttributeManager();o.addInstanced({positions:{size:3,vertexOffset:1,type:5130,fp64:this.use64bitPositions(),transition:pP,accessor:"getPath",update:this.calculatePositions,noAlloc:a,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:5121,update:this.calculateSegmentTypes,noAlloc:a},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:pP,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,accessor:"getColor",transition:pP,defaultValue:zW},instancePickingColors:{size:3,type:5121,accessor:function(u,l){var f=l.index,c=l.target;return i.encodePickingColor(u&&u.__source?u.__source.index:f,c)}}}),this.setState({pathTesselator:new RW({fp64:this.use64bitPositions()})})}},{key:"updateState",value:function(i){(0,Oh.default)((0,Ks.default)(e.prototype),"updateState",this).call(this,i);var a=i.props,o=i.changeFlags,s=this.getAttributeManager(),u=o.dataChanged||o.updateTriggersChanged&&(o.updateTriggersChanged.all||o.updateTriggersChanged.getPath);if(u){var l=this.state.pathTesselator,f=a.data.attributes||{};l.updateGeometry({data:a.data,geometryBuffer:f.getPath,buffers:f,normalize:!a._pathType,loop:a._pathType==="loop",getGeometry:a.getPath,positionFormat:a.positionFormat,wrapLongitude:a.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:o.dataChanged}),this.setState({numInstances:l.instanceCount,startIndices:l.vertexStarts}),o.dataChanged||s.invalidateAll()}if(o.extensionsChanged){var c,p=this.context.gl;(c=this.state.model)===null||c===void 0||c.delete(),this.state.model=this._getModel(p),s.invalidateAll()}}},{key:"getPickingInfo",value:function(i){var a=(0,Oh.default)((0,Ks.default)(e.prototype),"getPickingInfo",this).call(this,i),o=a.index,s=this.props.data;return s[0]&&s[0].__source&&(a.object=s.find(function(u){return u.__source.index===o})),a}},{key:"disablePickingIndex",value:function(i){var a=this.props.data;if(a[0]&&a[0].__source)for(var o=0;o<a.length;o++)a[o].__source.index===i&&this._disablePickingIndex(o);else(0,Oh.default)((0,Ks.default)(e.prototype),"disablePickingIndex",this).call(this,i)}},{key:"draw",value:function(i){var a=i.uniforms,o=this.props,s=o.jointRounded,u=o.capRounded,l=o.billboard,f=o.miterLimit,c=o.widthUnits,p=o.widthScale,d=o.widthMinPixels,v=o.widthMaxPixels;this.state.model.setUniforms(a).setUniforms({jointType:Number(s),capType:Number(u),billboard:l,widthUnits:St[c],widthScale:p,miterLimit:f,widthMinPixels:d,widthMaxPixels:v}).draw()}},{key:"_getModel",value:function(i){var a=[0,1,2,1,4,2,1,3,4,3,5,4],o=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new Ce(i,FW(FW({},this.getShaders()),{},{id:this.props.id,geometry:new Me({drawMode:4,attributes:{indices:new Uint16Array(a),positions:{value:new Float32Array(o),size:2}}}),isInstanced:!0}))}},{key:"calculatePositions",value:function(i){var a=this.state.pathTesselator;i.startIndices=a.vertexStarts,i.value=a.get("positions")}},{key:"calculateSegmentTypes",value:function(i){var a=this.state.pathTesselator;i.startIndices=a.vertexStarts,i.value=a.get("segmentTypes")}}]),e}(He);(0,Eh.default)($i,"defaultProps",bTe);(0,Eh.default)($i,"layerName","PathLayer");var T7=h(L()),w7=h(N()),P7=h(Y()),O7=h(K()),_P=h(q()),bP=h(B());var y7=h(L()),_7=h(N()),b7=h(be()),kh=h(Ee()),x7=h(Y()),A7=h(K()),Js=h(q()),Bh=h(B());var u7=h(B()),l7=h(L()),f7=h(N()),yP=h(Ee()),c7=h(Y()),p7=h(K()),Lh=h(q());var QW=h(me()),e7=h(XW());function FTe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=DTe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function DTe(t,r){if(t){if(typeof t=="string")return qW(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return qW(t,r)}}function qW(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var Ny=uf.CLOCKWISE,YW=uf.COUNTER_CLOCKWISE,Lo={isClosed:!0};function NTe(t){if(t=t&&t.positions||t,!Array.isArray(t)&&!ArrayBuffer.isView(t))throw new Error("invalid polygon")}function pf(t){return"positions"in t?t.positions:t}function Rh(t){return"holeIndices"in t?t.holeIndices:null}function jTe(t){return Array.isArray(t[0])}function UTe(t){return t.length>=1&&t[0].length>=2&&Number.isFinite(t[0][0])}function GTe(t){var r=t[0],e=t[t.length-1];return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]}function zTe(t,r,e,n){for(var i=0;i<r;i++)if(t[e+i]!==t[n-r+i])return!1;return!0}function KW(t,r,e,n,i){for(var a=r,o=e.length,s=0;s<o;s++)for(var u=0;u<n;u++)t[a++]=e[s][u]||0;if(!GTe(e))for(var l=0;l<n;l++)t[a++]=e[0][l]||0;return Lo.start=r,Lo.end=a,Lo.size=n,Mo(t,i,Lo),a}function ZW(t,r,e,n){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0,a=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0;a=a||e.length;var s=a-i;if(s<=0)return r;for(var u=r,l=0;l<s;l++)t[u++]=e[i+l];if(!zTe(e,n,i,a))for(var f=0;f<n;f++)t[u++]=e[i+f];return Lo.start=r,Lo.end=u,Lo.size=n,Mo(t,o,Lo),u}function jy(t,r){NTe(t);var e=[],n=[];if("positions"in t){var i=t,a=i.positions,o=i.holeIndices;if(o){for(var s=0,u=0;u<=o.length;u++)s=ZW(e,s,a,r,o[u-1],o[u],u===0?Ny:YW),n.push(s);return n.pop(),{positions:e,holeIndices:n}}t=a}if(!jTe(t))return ZW(e,0,t,r,0,e.length,Ny),e;if(!UTe(t)){var l=0,f=FTe(t.entries()),c;try{for(f.s();!(c=f.n()).done;){var p=(0,QW.default)(c.value,2),d=p[0],v=p[1];l=KW(e,l,v,r,d===0?Ny:YW),n.push(l)}}catch(m){f.e(m)}finally{f.f()}return n.pop(),{positions:e,holeIndices:n}}return KW(e,0,t,r,Ny),e}function gP(t,r,e){for(var n=t.length/3,i=0,a=0;a<n;a++){var o=(a+1)%n;i+=t[a*3+r]*t[o*3+e],i-=t[o*3+r]*t[a*3+e]}return Math.abs(i/2)}function JW(t,r,e,n){for(var i=t.length/3,a=0;a<i;a++){var o=a*3,s=t[o+0],u=t[o+1],l=t[o+2];t[o+r]=s,t[o+e]=u,t[o+n]=l}}function t7(t,r,e,n){var i=Rh(t);i&&(i=i.map(function(v){return v/r}));var a=pf(t),o=n&&r===3;if(e){var s=a.length;a=a.slice();for(var u=[],l=0;l<s;l+=r){u[0]=a[l],u[1]=a[l+1],o&&(u[2]=a[l+2]);var f=e(u);a[l]=f[0],a[l+1]=f[1],o&&(a[l+2]=f[2])}}if(o){var c=gP(a,0,1),p=gP(a,0,2),d=gP(a,1,2);if(!c&&!p&&!d)return[];c>p&&c>d||(p>d?(e||(a=a.slice()),JW(a,0,2,1)):(e||(a=a.slice()),JW(a,2,0,1)))}return(0,e7.default)(a,i,r)}function n7(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=VTe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function VTe(t,r){if(t){if(typeof t=="string")return i7(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return i7(t,r)}}function i7(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function a7(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function o7(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?a7(Object(e),!0).forEach(function(n){(0,u7.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):a7(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function HTe(t){var r=WTe();return function(){var n=(0,Lh.default)(t),i;if(r){var a=(0,Lh.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,p7.default)(this,i)}}function WTe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var h7=function(t){(0,c7.default)(e,t);var r=HTe(e);function e(n){(0,l7.default)(this,e);var i=n.fp64,a=n.IndexType,o=a===void 0?Uint32Array:a;return r.call(this,o7(o7({},n),{},{attributes:{positions:{size:3,type:i?Float64Array:Float32Array},vertexValid:{type:Uint8ClampedArray,size:1},indices:{type:o,size:1}}}))}return(0,f7.default)(e,[{key:"get",value:function(i){var a=this.attributes;return i==="indices"?a.indices&&a.indices.subarray(0,this.vertexCount):a[i]}},{key:"updateGeometry",value:function(i){(0,yP.default)((0,Lh.default)(e.prototype),"updateGeometry",this).call(this,i);var a=this.buffers.indices;if(a)this.vertexCount=(a.value||a).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}},{key:"normalizeGeometry",value:function(i){if(this.normalize){var a=jy(i,this.positionSize);return this.opts.resolution?wh(pf(a),Rh(a),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?oP(pf(a),Rh(a),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):a}return i}},{key:"getGeometrySize",value:function(i){if(s7(i)){var a=0,o=n7(i),s;try{for(o.s();!(s=o.n()).done;){var u=s.value;a+=this.getGeometrySize(u)}}catch(l){o.e(l)}finally{o.f()}return a}return pf(i).length/this.positionSize}},{key:"getGeometryFromBuffer",value:function(i){return this.normalize||!this.buffers.indices?(0,yP.default)((0,Lh.default)(e.prototype),"getGeometryFromBuffer",this).call(this,i):null}},{key:"updateGeometryAttributes",value:function(i,a){if(i&&s7(i)){var o=n7(i),s;try{for(o.s();!(s=o.n()).done;){var u=s.value,l=this.getGeometrySize(u);a.geometrySize=l,this.updateGeometryAttributes(u,a),a.vertexStart+=l,a.indexStart=this.indexStarts[a.geometryIndex+1]}}catch(f){o.e(f)}finally{o.f()}}else this._updateIndices(i,a),this._updatePositions(i,a),this._updateVertexValid(i,a)}},{key:"_updateIndices",value:function(i,a){var o=a.geometryIndex,s=a.vertexStart,u=a.indexStart,l=this.attributes,f=this.indexStarts,c=this.typedArrayManager,p=l.indices;if(!(!p||!i)){var d=u,v=t7(i,this.positionSize,this.opts.preproject,this.opts.full3d);p=c.allocate(p,u+v.length,{copy:!0});for(var m=0;m<v.length;m++)p[d++]=v[m]+s;f[o+1]=u+v.length,l.indices=p}}},{key:"_updatePositions",value:function(i,a){var o=a.vertexStart,s=a.geometrySize,u=this.attributes.positions,l=this.positionSize;if(!(!u||!i))for(var f=pf(i),c=o,p=0;p<s;c++,p++){var d=f[p*l],v=f[p*l+1],m=l>2?f[p*l+2]:0;u[c*3]=d,u[c*3+1]=v,u[c*3+2]=m}}},{key:"_updateVertexValid",value:function(i,a){var o=a.vertexStart,s=a.geometrySize,u=this.positionSize,l=this.attributes.vertexValid,f=i&&Rh(i);if(i&&i.edgeTypes?l.set(i.edgeTypes,o):l.fill(1,o,o+s),f)for(var c=0;c<f.length;c++)l[o+f[c]/u-1]=0;l[o+s-1]=0}}]),e}(ef);function s7(t){return Array.isArray(t)&&t.length>0&&!Number.isFinite(t[0])}var Uy=`
attribute vec2 vertexPositions;
attribute float vertexValid;

uniform bool extruded;
uniform bool isWireframe;
uniform float elevationScale;
uniform float opacity;

varying vec4 vColor;

struct PolygonProps {
  vec4 fillColors;
  vec4 lineColors;
  vec3 positions;
  vec3 nextPositions;
  vec3 pickingColors;
  vec3 positions64Low;
  vec3 nextPositions64Low;
  float elevations;
};

vec3 project_offset_normal(vec3 vector) {
  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
    return normalize(vector * project_uCommonUnitsPerWorldUnit);
  }
  return project_normal(vector);
}

void calculatePosition(PolygonProps props) {
#ifdef IS_SIDE_VERTEX
  if(vertexValid < 0.5){
    gl_Position = vec4(0.);
    return;
  }
#endif

  vec3 pos;
  vec3 pos64Low;
  vec3 normal;
  vec4 colors = isWireframe ? props.lineColors : props.fillColors;

  geometry.worldPosition = props.positions;
  geometry.worldPositionAlt = props.nextPositions;
  geometry.pickingColor = props.pickingColors;

#ifdef IS_SIDE_VERTEX
  pos = mix(props.positions, props.nextPositions, vertexPositions.x);
  pos64Low = mix(props.positions64Low, props.nextPositions64Low, vertexPositions.x);
#else
  pos = props.positions;
  pos64Low = props.positions64Low;
#endif

  if (extruded) {
    pos.z += props.elevations * vertexPositions.y * elevationScale;
  }
  gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  if (extruded) {
  #ifdef IS_SIDE_VERTEX
    normal = vec3(
      props.positions.y - props.nextPositions.y + (props.positions64Low.y - props.nextPositions64Low.y),
      props.nextPositions.x - props.positions.x + (props.nextPositions64Low.x - props.positions64Low.x),
      0.0);
    normal = project_offset_normal(normal);
  #else
    normal = project_normal(vec3(0.0, 0.0, 1.0));
  #endif
    geometry.normal = normal;
    vec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, geometry.position.xyz, normal);
    vColor = vec4(lightColor, colors.a * opacity);
  } else {
    vColor = vec4(colors.rgb, colors.a * opacity);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var d7=`#define SHADER_NAME solid-polygon-layer-vertex-shader

attribute vec3 positions;
attribute vec3 positions64Low;
attribute float elevations;
attribute vec4 fillColors;
attribute vec4 lineColors;
attribute vec3 pickingColors;

`.concat(Uy,`

void main(void) {
  PolygonProps props;

  props.positions = positions;
  props.positions64Low = positions64Low;
  props.elevations = elevations;
  props.fillColors = fillColors;
  props.lineColors = lineColors;
  props.pickingColors = pickingColors;

  calculatePosition(props);
}
`);var v7=`#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX


attribute vec3 instancePositions;
attribute vec3 nextPositions;
attribute vec3 instancePositions64Low;
attribute vec3 nextPositions64Low;
attribute float instanceElevations;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

`.concat(Uy,`

void main(void) {
  PolygonProps props;

  #if RING_WINDING_ORDER_CW == 1
    props.positions = instancePositions;
    props.positions64Low = instancePositions64Low;
    props.nextPositions = nextPositions;
    props.nextPositions64Low = nextPositions64Low;
  #else
    props.positions = nextPositions;
    props.positions64Low = nextPositions64Low;
    props.nextPositions = instancePositions;
    props.nextPositions64Low = instancePositions64Low;
  #endif
  props.elevations = instanceElevations;
  props.fillColors = instanceFillColors;
  props.lineColors = instanceLineColors;
  props.pickingColors = instancePickingColors;

  calculatePosition(props);
}
`);var m7=`#define SHADER_NAME solid-polygon-layer-fragment-shader

precision highp float;

varying vec4 vColor;

void main(void) {
  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;function g7(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function hf(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?g7(Object(e),!0).forEach(function(n){(0,Bh.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):g7(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function $Te(t){var r=XTe();return function(){var n=(0,Js.default)(t),i;if(r){var a=(0,Js.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,A7.default)(this,i)}}function XTe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var zy=[0,0,0,255],qTe={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:function(r){return r.polygon}},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:zy},getLineColor:{type:"accessor",value:zy},material:!0},Gy={enter:function(r,e){return e.length?e.subarray(e.length-r.length):r}},Xi=function(t){(0,x7.default)(e,t);var r=$Te(e);function e(){var n;(0,y7.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,Bh.default)((0,b7.default)(n),"state",void 0),n}return(0,_7.default)(e,[{key:"getShaders",value:function(i){return(0,kh.default)((0,Js.default)(e.prototype),"getShaders",this).call(this,{vs:i==="top"?d7:v7,fs:m7,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[Je,pn,st]})}},{key:"wrapLongitude",get:function(){return!1}},{key:"initializeState",value:function(){var i=this,a=this.context,o=a.gl,s=a.viewport,u=this.props.coordinateSystem,l=this.props._full3d;s.isGeospatial&&u===ue.DEFAULT&&(u=ue.LNGLAT);var f;u===ue.LNGLAT&&(l?f=s.projectPosition.bind(s):f=s.projectFlat.bind(s)),this.setState({numInstances:0,polygonTesselator:new h7({preproject:f,fp64:this.use64bitPositions(),IndexType:!o||dr(o,Se.ELEMENT_INDEX_UINT32)?Uint32Array:Uint16Array})});var c=this.getAttributeManager(),p=!0;c.remove(["instancePickingColors"]),c.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:p},positions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:Gy,accessor:"getPolygon",update:this.calculatePositions,noAlloc:p,shaderAttributes:{positions:{vertexOffset:0,divisor:0},instancePositions:{vertexOffset:0,divisor:1},nextPositions:{vertexOffset:1,divisor:1}}},vertexValid:{size:1,divisor:1,type:5121,update:this.calculateVertexValid,noAlloc:p},elevations:{size:1,transition:Gy,accessor:"getElevation",shaderAttributes:{elevations:{divisor:0},instanceElevations:{divisor:1}}},fillColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:Gy,accessor:"getFillColor",defaultValue:zy,shaderAttributes:{fillColors:{divisor:0},instanceFillColors:{divisor:1}}},lineColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:Gy,accessor:"getLineColor",defaultValue:zy,shaderAttributes:{lineColors:{divisor:0},instanceLineColors:{divisor:1}}},pickingColors:{size:3,type:5121,accessor:function(v,m){var g=m.index,y=m.target;return i.encodePickingColor(v&&v.__source?v.__source.index:g,y)},shaderAttributes:{pickingColors:{divisor:0},instancePickingColors:{divisor:1}}}})}},{key:"getPickingInfo",value:function(i){var a=(0,kh.default)((0,Js.default)(e.prototype),"getPickingInfo",this).call(this,i),o=a.index,s=this.props.data;return s[0]&&s[0].__source&&(a.object=s.find(function(u){return u.__source.index===o})),a}},{key:"disablePickingIndex",value:function(i){var a=this.props.data;if(a[0]&&a[0].__source)for(var o=0;o<a.length;o++)a[o].__source.index===i&&this._disablePickingIndex(o);else(0,kh.default)((0,Js.default)(e.prototype),"disablePickingIndex",this).call(this,i)}},{key:"draw",value:function(i){var a=i.uniforms,o=this.props,s=o.extruded,u=o.filled,l=o.wireframe,f=o.elevationScale,c=this.state,p=c.topModel,d=c.sideModel,v=c.polygonTesselator,m=hf(hf({},a),{},{extruded:Boolean(s),elevationScale:f});d&&(d.setInstanceCount(v.instanceCount-1),d.setUniforms(m),l&&(d.setDrawMode(3),d.setUniforms({isWireframe:!0}).draw()),u&&(d.setDrawMode(6),d.setUniforms({isWireframe:!1}).draw())),p&&(p.setVertexCount(v.vertexCount),p.setUniforms(m).draw())}},{key:"updateState",value:function(i){(0,kh.default)((0,Js.default)(e.prototype),"updateState",this).call(this,i),this.updateGeometry(i);var a=i.props,o=i.oldProps,s=i.changeFlags,u=this.getAttributeManager(),l=s.extensionsChanged||a.filled!==o.filled||a.extruded!==o.extruded;if(l){var f;(f=this.state.models)===null||f===void 0||f.forEach(function(c){return c.delete()}),this.setState(this._getModels(this.context.gl)),u.invalidateAll()}}},{key:"updateGeometry",value:function(i){var a=i.props,o=i.oldProps,s=i.changeFlags,u=s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getPolygon);if(u){var l=this.state.polygonTesselator,f=a.data.attributes||{};l.updateGeometry({data:a.data,normalize:a._normalize,geometryBuffer:f.getPolygon,buffers:f,getGeometry:a.getPolygon,positionFormat:a.positionFormat,wrapLongitude:a.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:s.dataChanged,full3d:a._full3d}),this.setState({numInstances:l.instanceCount,startIndices:l.vertexStarts}),s.dataChanged||this.getAttributeManager().invalidateAll()}}},{key:"_getModels",value:function(i){var a=this.props,o=a.id,s=a.filled,u=a.extruded,l,f;if(s){var c=this.getShaders("top");c.defines.NON_INSTANCED_MODEL=1,l=new Ce(i,hf(hf({},c),{},{id:"".concat(o,"-top"),drawMode:4,attributes:{vertexPositions:new Float32Array([0,1])},uniforms:{isWireframe:!1,isSideVertex:!1},vertexCount:0,isIndexed:!0}))}return u&&(f=new Ce(i,hf(hf({},this.getShaders("side")),{},{id:"".concat(o,"-side"),geometry:new Me({drawMode:1,vertexCount:4,attributes:{vertexPositions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),instanceCount:0,isInstanced:1})),f.userData.excludeAttributes={indices:!0}),{models:[f,l].filter(Boolean),topModel:l,sideModel:f}}},{key:"calculateIndices",value:function(i){var a=this.state.polygonTesselator;i.startIndices=a.indexStarts,i.value=a.get("indices")}},{key:"calculatePositions",value:function(i){var a=this.state.polygonTesselator;i.startIndices=a.vertexStarts,i.value=a.get("positions")}},{key:"calculateVertexValid",value:function(i){i.value=this.state.polygonTesselator.get("vertexValid")}}]),e}(He);(0,Bh.default)(Xi,"defaultProps",qTe);(0,Bh.default)(Xi,"layerName","SolidPolygonLayer");function Vy(t){for(var r=t.data,e=t.getIndex,n=t.dataRange,i=t.replace,a=n.startRow,o=a===void 0?0:a,s=n.endRow,u=s===void 0?1/0:s,l=r.length,f=l,c=l,p=0;p<l;p++){var d=e(r[p]);if(f>p&&d>=o&&(f=p),d>=u){c=p;break}}for(var v=f,m=c-f!==i.length,g=m?r.slice(c):void 0,y=0;y<i.length;y++)r[v++]=i[y];if(g){for(var _=0;_<g.length;_++)r[v++]=g[_];r.length=v}return{startRow:f,endRow:f+i.length}}function YTe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=KTe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function KTe(t,r){if(t){if(typeof t=="string")return S7(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return S7(t,r)}}function S7(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function ZTe(t){var r=JTe();return function(){var n=(0,_P.default)(t),i;if(r){var a=(0,_P.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,O7.default)(this,i)}}function JTe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var E7=[0,0,0,255],QTe=[0,0,0,255],ewe={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:function(r){return r.polygon}},getFillColor:{type:"accessor",value:QTe},getLineColor:{type:"accessor",value:E7},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0},qi=function(t){(0,P7.default)(e,t);var r=ZTe(e);function e(){return(0,T7.default)(this,e),r.apply(this,arguments)}return(0,w7.default)(e,[{key:"initializeState",value:function(){this.state={paths:[]},this.props.getLineDashArray&&J.removed("getLineDashArray","PathStyleExtension")()}},{key:"updateState",value:function(i){var a=this,o=i.changeFlags,s=o.dataChanged||o.updateTriggersChanged&&(o.updateTriggersChanged.all||o.updateTriggersChanged.getPolygon);if(s&&Array.isArray(o.dataChanged)){var u=this.state.paths.slice(),l=o.dataChanged.map(function(f){return Vy({data:u,getIndex:function(p){return p.__source.index},dataRange:f,replace:a._getPaths(f)})});this.setState({paths:u,pathsDiff:l})}else s&&this.setState({paths:this._getPaths(),pathsDiff:null})}},{key:"_getPaths",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=this.props,o=a.data,s=a.getPolygon,u=a.positionFormat,l=a._normalize,f=[],c=u==="XY"?2:3,p=i.startRow,d=i.endRow,v=Ut(o,p,d),m=v.iterable,g=v.objectInfo,y=YTe(m),_;try{for(y.s();!(_=y.n()).done;){var b=_.value;g.index++;var x=s(b,g);l&&(x=jy(x,c));var A=x,S=A.holeIndices,P=x.positions||x;if(S)for(var O=0;O<=S.length;O++){var C=P.slice(S[O-1]||0,S[O]||P.length);f.push(this.getSubLayerRow({path:C},b,g.index))}else f.push(this.getSubLayerRow({path:P},b,g.index))}}catch(T){y.e(T)}finally{y.f()}return f}},{key:"renderLayers",value:function(){var i=this.props,a=i.data,o=i._dataDiff,s=i.stroked,u=i.filled,l=i.extruded,f=i.wireframe,c=i._normalize,p=i._windingOrder,d=i.elevationScale,v=i.transitions,m=i.positionFormat,g=this.props,y=g.lineWidthUnits,_=g.lineWidthScale,b=g.lineWidthMinPixels,x=g.lineWidthMaxPixels,A=g.lineJointRounded,S=g.lineMiterLimit,P=g.lineDashJustified,O=this.props,C=O.getFillColor,T=O.getLineColor,I=O.getLineWidth,R=O.getLineDashArray,V=O.getElevation,z=O.getPolygon,k=O.updateTriggers,G=O.material,U=this.state,$=U.paths,H=U.pathsDiff,Q=this.getSubLayerClass("fill",Xi),ie=this.getSubLayerClass("stroke",$i),fe=this.shouldRenderSubLayer("fill",$)&&new Q({_dataDiff:o,extruded:l,elevationScale:d,filled:u,wireframe:f,_normalize:c,_windingOrder:p,getElevation:V,getFillColor:C,getLineColor:l&&f?T:E7,material:G,transitions:v},this.getSubLayerProps({id:"fill",updateTriggers:k&&{getPolygon:k.getPolygon,getElevation:k.getElevation,getFillColor:k.getFillColor,lineColors:l&&f,getLineColor:k.getLineColor}}),{data:a,positionFormat:m,getPolygon:z}),Ae=!l&&s&&this.shouldRenderSubLayer("stroke",$)&&new ie({_dataDiff:H&&function(){return H},widthUnits:y,widthScale:_,widthMinPixels:b,widthMaxPixels:x,jointRounded:A,miterLimit:S,dashJustified:P,_pathType:"loop",transitions:v&&{getWidth:v.getLineWidth,getColor:v.getLineColor,getPath:v.getPolygon},getColor:this.getSubLayerAccessor(T),getWidth:this.getSubLayerAccessor(I),getDashArray:this.getSubLayerAccessor(R)},this.getSubLayerProps({id:"stroke",updateTriggers:k&&{getWidth:k.getLineWidth,getColor:k.getLineColor,getDashArray:k.getLineDashArray}}),{data:$,positionFormat:m,getPath:function(Xe){return Xe.path}});return[!l&&fe,Ae,l&&fe]}}]),e}(Ot);(0,bP.default)(qi,"layerName","PolygonLayer");(0,bP.default)(qi,"defaultProps",ewe);var U$=h(Hy()),G$=h(L()),z$=h(N()),CP=h(Ee()),V$=h(Y()),H$=h(K()),Vh=h(q()),Qy=h(B());var L7=h(B());function R7(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function iwe(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?R7(Object(e),!0).forEach(function(n){(0,L7.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):R7(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function k7(t,r){if(!t)return null;var e="startIndices"in t?t.startIndices[r]:r,n=t.featureIds.value[e];return e!==-1?awe(t,n,e):null}function awe(t,r,e){var n={properties:iwe({},t.properties[r])};for(var i in t.numericProps)n.properties[i]=t.numericProps[i].value[e];return n}function B7(t,r){var e={points:null,lines:null,polygons:null};for(var n in e){var i=t[n].globalFeatureIds.value;e[n]=new Uint8ClampedArray(i.length*3);for(var a=[],o=0;o<i.length;o++)r(i[o],a),e[n][o*3+0]=a[0],e[n][o*3+1]=a[1],e[n][o*3+2]=a[2]}return e}var wP=h(me()),O$=h(L()),E$=h(N()),Yy=h(be()),C$=h(Y()),M$=h(K()),PP=h(q()),tu=h(B());var j7=h(L()),U7=h(N()),G7=h(be()),Qs=h(Ee()),z7=h(Y()),V7=h(K()),Ia=h(q()),Fh=h(B());var F7=`#define SHADER_NAME multi-icon-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D iconsTexture;
uniform float gamma;
uniform bool sdf;
uniform float alphaCutoff;
uniform float sdfBuffer;
uniform float outlineBuffer;
uniform vec4 outlineColor;

varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  if (!picking_uActive) {
    float alpha = texture2D(iconsTexture, vTextureCoords).a;
    vec4 color = vColor;
    if (sdf) {
      float distance = alpha;
      alpha = smoothstep(sdfBuffer - gamma, sdfBuffer + gamma, distance);

      if (outlineBuffer > 0.0) {
        float inFill = alpha;
        float inBorder = smoothstep(outlineBuffer - gamma, outlineBuffer + gamma, distance);
        color = mix(outlineColor, vColor, inFill);
        alpha = inBorder;
      }
    }
    float a = alpha * color.a;
    
    if (a < alphaCutoff) {
      discard;
    }

    gl_FragColor = vec4(color.rgb, a * opacity);
  }

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;function D7(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Wy(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?D7(Object(e),!0).forEach(function(n){(0,Fh.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):D7(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function owe(t){var r=swe();return function(){var n=(0,Ia.default)(t),i;if(r){var a=(0,Ia.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,V7.default)(this,i)}}function swe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var xP=192/256,N7=[],uwe={getIconOffsets:{type:"accessor",value:function(r){return r.offsets}},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}},df=function(t){(0,z7.default)(e,t);var r=owe(e);function e(){var n;(0,j7.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,Fh.default)((0,G7.default)(n),"state",void 0),n}return(0,U7.default)(e,[{key:"getShaders",value:function(){return Wy(Wy({},(0,Qs.default)((0,Ia.default)(e.prototype),"getShaders",this).call(this)),{},{fs:F7})}},{key:"initializeState",value:function(){var i=this;(0,Qs.default)((0,Ia.default)(e.prototype),"initializeState",this).call(this);var a=this.getAttributeManager();a.addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:5121,size:3,accessor:function(s,u){var l=u.index,f=u.target;return i.encodePickingColor(l,f)}}})}},{key:"updateState",value:function(i){(0,Qs.default)((0,Ia.default)(e.prototype),"updateState",this).call(this,i);var a=i.props,o=i.oldProps,s=a.outlineColor;s!==o.outlineColor&&(s=s.map(function(u){return u/255}),s[3]=Number.isFinite(s[3])?s[3]:1,this.setState({outlineColor:s})),!a.sdf&&a.outlineWidth&&J.warn("".concat(this.id,": fontSettings.sdf is required to render outline"))()}},{key:"draw",value:function(i){var a=this.props,o=a.sdf,s=a.smoothing,u=a.outlineWidth,l=this.state.outlineColor,f=u?Math.max(s,xP*(1-u)):-1;if(i.uniforms=Wy(Wy({},i.uniforms),{},{sdfBuffer:xP,outlineBuffer:f,gamma:s,sdf:Boolean(o),outlineColor:l}),(0,Qs.default)((0,Ia.default)(e.prototype),"draw",this).call(this,i),o&&u){var c=this.state.iconManager,p=c.getTexture();p&&this.state.model.draw({uniforms:{outlineBuffer:xP}})}}},{key:"getInstanceOffset",value:function(i){var a=this;return i?Array.from(i).flatMap(function(o){return(0,Qs.default)((0,Ia.default)(e.prototype),"getInstanceOffset",a).call(a,o)}):N7}},{key:"getInstanceColorMode",value:function(i){return 1}},{key:"getInstanceIconFrame",value:function(i){var a=this;return i?Array.from(i).flatMap(function(o){return(0,Qs.default)((0,Ia.default)(e.prototype),"getInstanceIconFrame",a).call(a,o)}):N7}}]),e}(Co);(0,Fh.default)(df,"defaultProps",uwe);(0,Fh.default)(df,"layerName","MultiIconLayer");var l$=h(L()),f$=h(N()),Nh=h(B());var Dh=class{constructor({fontSize:r=24,buffer:e=3,radius:n=8,cutoff:i=.25,fontFamily:a="sans-serif",fontWeight:o="normal",fontStyle:s="normal"}={}){this.buffer=e,this.cutoff=i,this.radius=n;let u=this.size=r+e*4,l=this._createCanvas(u),f=this.ctx=l.getContext("2d",{willReadFrequently:!0});f.font=`${s} ${o} ${r}px ${a}`,f.textBaseline="alphabetic",f.textAlign="left",f.fillStyle="black",this.gridOuter=new Float64Array(u*u),this.gridInner=new Float64Array(u*u),this.f=new Float64Array(u),this.z=new Float64Array(u+1),this.v=new Uint16Array(u)}_createCanvas(r){let e=document.createElement("canvas");return e.width=e.height=r,e}draw(r){let{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:i,actualBoundingBoxLeft:a,actualBoundingBoxRight:o}=this.ctx.measureText(r),s=Math.ceil(n),u=0,l=Math.min(this.size-this.buffer,Math.ceil(o-a)),f=Math.min(this.size-this.buffer,s+Math.ceil(i)),c=l+2*this.buffer,p=f+2*this.buffer,d=Math.max(c*p,0),v=new Uint8ClampedArray(d),m={data:v,width:c,height:p,glyphWidth:l,glyphHeight:f,glyphTop:s,glyphLeft:u,glyphAdvance:e};if(l===0||f===0)return m;let{ctx:g,buffer:y,gridInner:_,gridOuter:b}=this;g.clearRect(y,y,l,f),g.fillText(r,y,y+s);let x=g.getImageData(y,y,l,f);b.fill(1e20,0,d),_.fill(0,0,d);for(let A=0;A<f;A++)for(let S=0;S<l;S++){let P=x.data[4*(A*l+S)+3]/255;if(P===0)continue;let O=(A+y)*c+S+y;if(P===1)b[O]=0,_[O]=1e20;else{let C=.5-P;b[O]=C>0?C*C:0,_[O]=C<0?C*C:0}}H7(b,0,0,c,p,c,this.f,this.v,this.z),H7(_,y,y,l,f,c,this.f,this.v,this.z);for(let A=0;A<d;A++){let S=Math.sqrt(b[A])-Math.sqrt(_[A]);v[A]=Math.round(255-255*(S/this.radius+this.cutoff))}return m}};function H7(t,r,e,n,i,a,o,s,u){for(let l=r;l<r+n;l++)W7(t,e*a+l,a,i,o,s,u);for(let l=e;l<e+i;l++)W7(t,l*a+r,1,n,o,s,u)}function W7(t,r,e,n,i,a,o){a[0]=0,o[0]=-1e20,o[1]=1e20,i[0]=t[r];for(let s=1,u=0,l=0;s<n;s++){i[s]=t[r+s*e];let f=s*s;do{let c=a[u];l=(i[s]-i[c]+f-c*c)/(s-c)/2}while(l<=o[u]&&--u>-1);u++,a[u]=s,o[u]=l,o[u+1]=1e20}for(let s=0,u=0;s<n;s++){for(;o[u+1]<s;)u++;let l=a[u],f=s-l;t[r+s*e]=i[l]+f*f}}function X7(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=lwe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function lwe(t,r){if(t){if(typeof t=="string")return $7(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return $7(t,r)}}function $7(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var fwe=32,cwe=[];function pwe(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function q7(t){var r=t.characterSet,e=t.getFontWidth,n=t.fontHeight,i=t.buffer,a=t.maxCanvasWidth,o=t.mapping,s=o===void 0?{}:o,u=t.xOffset,l=u===void 0?0:u,f=t.yOffset,c=f===void 0?0:f,p=0,d=l,v=n+i*2,m=X7(r),g;try{for(m.s();!(g=m.n()).done;){var y=g.value;if(!s[y]){var _=e(y);d+_+i*2>a&&(d=0,p++),s[y]={x:d+i,y:c+p*v+i,width:_,height:v,layoutWidth:_,layoutHeight:n},d+=_+i*2}}}catch(b){m.e(b)}finally{m.f()}return{mapping:s,xOffset:d,yOffset:c+p*v,canvasHeight:pwe(c+(p+1)*v)}}function Y7(t,r,e,n){for(var i=0,a=r;a<e;a++){var o,s=t[a];i+=((o=n[s])===null||o===void 0?void 0:o.layoutWidth)||0}return i}function K7(t,r,e,n,i,a){for(var o=r,s=0,u=r;u<e;u++){var l=Y7(t,u,u+1,i);s+l>n&&(o<u&&a.push(u),o=u,s=0),s+=l}return s}function hwe(t,r,e,n,i,a){for(var o=r,s=r,u=r,l=0,f=r;f<e;f++)if((t[f]===" "||t[f+1]===" "||f+1===e)&&(u=f+1),u>s){var c=Y7(t,s,u,i);l+c>n&&(o<s&&(a.push(s),o=s,l=0),c>n&&(c=K7(t,s,u,n,i,a),o=a[a.length-1])),s=u,l+=c}return l}function dwe(t,r,e,n){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0,a=arguments.length>5?arguments[5]:void 0;a===void 0&&(a=t.length);var o=[];return r==="break-all"?K7(t,i,a,e,n,o):hwe(t,i,a,e,n,o),o}function vwe(t,r,e,n,i,a){for(var o=0,s=0,u=r;u<e;u++){var l=t[u],f=n[l];f?(s||(s=f.layoutHeight),i[u]=o+f.layoutWidth/2,o+=f.layoutWidth):(J.warn("Missing character: ".concat(l," (").concat(l.codePointAt(0),")"))(),i[u]=o,o+=fwe)}a[0]=o,a[1]=s}function Z7(t,r,e,n,i){for(var a=Array.from(t),o=a.length,s=new Array(o),u=new Array(o),l=new Array(o),f=(e==="break-word"||e==="break-all")&&isFinite(n)&&n>0,c=[0,0],p=[0,0],d=0,v=0,m=0,g=0;g<=o;g++){var y=a[g];if((y===`
`||g===o)&&(m=g),m>v){for(var _=f?dwe(a,e,n,i,v,m):cwe,b=0;b<=_.length;b++){var x=b===0?v:_[b-1],A=b<_.length?_[b]:m;vwe(a,x,A,i,s,p);for(var S=x;S<A;S++){var P,O=a[S],C=((P=i[O])===null||P===void 0?void 0:P.layoutOffsetY)||0;u[S]=d+p[1]/2+C,l[S]=p[0]}d=d+p[1]*r,c[0]=Math.max(c[0],p[0])}v=m}y===`
`&&(s[v]=0,u[v]=0,l[v]=0,v++)}return c[1]=d,{x:s,y:u,rowWidth:l,size:c}}function J7(t){var r=t.value,e=t.length,n=t.stride,i=t.offset,a=t.startIndices,o=t.characterSet,s=r.BYTES_PER_ELEMENT,u=n?n/s:1,l=i?i/s:0,f=a[e]||Math.ceil((r.length-l)/u),c=o&&new Set,p=new Array(e),d=r;if(u>1||l>0){var v=r.constructor;d=new v(f);for(var m=0;m<f;m++)d[m]=r[m*u+l]}for(var g=0;g<e;g++){var y=a[g],_=a[g+1]||f,b=d.subarray(y,_);p[g]=String.fromCodePoint.apply(null,b),c&&b.forEach(c.add,c)}if(c){var x=X7(c),A;try{for(x.s();!(A=x.n()).done;){var S=A.value;o.add(String.fromCodePoint(S))}}catch(P){x.e(P)}finally{x.f()}}return{texts:p,characterCount:f}}var Q7=h(L()),e$=h(N()),$y=h(B()),AP=function(){function t(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:5;(0,Q7.default)(this,t),(0,$y.default)(this,"limit",void 0),(0,$y.default)(this,"_cache",{}),(0,$y.default)(this,"_order",[]),this.limit=r}return(0,e$.default)(t,[{key:"get",value:function(e){var n=this._cache[e];return n&&(this._deleteOrder(e),this._appendOrder(e)),n}},{key:"set",value:function(e,n){this._cache[e]?(this.delete(e),this._cache[e]=n,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=n,this._appendOrder(e))}},{key:"delete",value:function(e){var n=this._cache[e];n&&(delete this._cache[e],this._deleteOrder(e))}},{key:"_deleteOrder",value:function(e){var n=this._order.indexOf(e);n>=0&&this._order.splice(n,1)}},{key:"_appendOrder",value:function(e){this._order.push(e)}}]),t}();function t$(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=mwe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function mwe(t,r){if(t){if(typeof t=="string")return r$(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return r$(t,r)}}function r$(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function n$(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function i$(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?n$(Object(e),!0).forEach(function(n){(0,Nh.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):n$(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function gwe(){for(var t=[],r=32;r<128;r++)t.push(String.fromCharCode(r));return t}var eu={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:gwe(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},a$=1024,o$=.9,s$=1.2,c$=3,Xy=new AP(c$);function ywe(t,r){var e;typeof r=="string"?e=new Set(Array.from(r)):e=new Set(r);var n=Xy.get(t);if(!n)return e;for(var i in n.mapping)e.has(i)&&e.delete(i);return e}function _we(t,r){for(var e=0;e<t.length;e++)r.data[4*e+3]=t[e]}function u$(t,r,e,n){t.font="".concat(n," ").concat(e,"px ").concat(r),t.fillStyle="#000",t.textBaseline="alphabetic",t.textAlign="left"}function p$(t){J.assert(Number.isFinite(t)&&t>=c$,"Invalid cache limit"),Xy=new AP(t)}var h$=function(){function t(){(0,l$.default)(this,t),(0,Nh.default)(this,"props",i$({},eu)),(0,Nh.default)(this,"_key",void 0),(0,Nh.default)(this,"_atlas",void 0)}return(0,f$.default)(t,[{key:"texture",get:function(){return this._atlas}},{key:"mapping",get:function(){return this._atlas&&this._atlas.mapping}},{key:"scale",get:function(){var e=this.props,n=e.fontSize,i=e.buffer;return(n*s$+i*2)/n}},{key:"setProps",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Object.assign(this.props,e),this._key=this._getKey();var n=ywe(this._key,this.props.characterSet),i=Xy.get(this._key);if(i&&n.size===0){this._atlas!==i&&(this._atlas=i);return}var a=this._generateFontAtlas(n,i);this._atlas=a,Xy.set(this._key,a)}},{key:"_generateFontAtlas",value:function(e,n){var i=this.props,a=i.fontFamily,o=i.fontWeight,s=i.fontSize,u=i.buffer,l=i.sdf,f=i.radius,c=i.cutoff,p=n&&n.data;p||(p=document.createElement("canvas"),p.width=a$);var d=p.getContext("2d",{willReadFrequently:!0});u$(d,a,s,o);var v=q7(i$({getFontWidth:function($){return d.measureText($).width},fontHeight:s*s$,buffer:u,characterSet:e,maxCanvasWidth:a$},n&&{mapping:n.mapping,xOffset:n.xOffset,yOffset:n.yOffset})),m=v.mapping,g=v.canvasHeight,y=v.xOffset,_=v.yOffset;if(p.height!==g){var b=d.getImageData(0,0,p.width,p.height);p.height=g,d.putImageData(b,0,0)}if(u$(d,a,s,o),l){var x=new Dh({fontSize:s,buffer:u,radius:f,cutoff:c,fontFamily:a,fontWeight:"".concat(o)}),A=t$(e),S;try{for(A.s();!(S=A.n()).done;){var P=S.value,O=x.draw(P),C=O.data,T=O.width,I=O.height,R=O.glyphTop;m[P].width=T,m[P].layoutOffsetY=s*o$-R;var V=d.createImageData(T,I);_we(C,V),d.putImageData(V,m[P].x,m[P].y)}}catch(U){A.e(U)}finally{A.f()}}else{var z=t$(e),k;try{for(z.s();!(k=z.n()).done;){var G=k.value;d.fillText(G,m[G].x,m[G].y+u+s*o$)}}catch(U){z.e(U)}finally{z.f()}}return{xOffset:y,yOffset:_,mapping:m,data:p,width:p.width,height:p.height}}},{key:"_getKey",value:function(){var e=this.props,n=e.fontFamily,i=e.fontWeight,a=e.fontSize,o=e.buffer,s=e.sdf,u=e.radius,l=e.cutoff;return s?"".concat(n," ").concat(i," ").concat(a," ").concat(o," ").concat(u," ").concat(l):"".concat(n," ").concat(i," ").concat(a," ").concat(o)}}]),t}();var y$=h(L()),_$=h(N()),b$=h(be()),SP=h(Ee()),x$=h(Y()),A$=h(K()),jh=h(q()),Uh=h(B());var d$=`#define SHADER_NAME text-background-layer-vertex-shader

attribute vec2 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec4 instanceRects;
attribute float instanceSizes;
attribute float instanceAngles;
attribute vec2 instancePixelOffsets;
attribute float instanceLineWidths;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

uniform bool billboard;
uniform float opacity;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform vec4 padding;
uniform int sizeUnits;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying float vLineWidth;
varying vec2 uv;
varying vec2 dimensions;

vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = radians(angle);
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
}

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;
  vLineWidth = instanceLineWidths;
  float sizePixels = clamp(
    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
    sizeMinPixels, sizeMaxPixels
  );

  dimensions = instanceRects.zw * sizePixels + padding.xy + padding.zw;

  vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-padding.xy, padding.zw, positions);
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
  pixelOffset += instancePixelOffsets;
  pixelOffset.y *= -1.0;

  if (billboard)  {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
    vec3 offset = vec3(pixelOffset, 0.0);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  } else {
    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
    DECKGL_FILTER_SIZE(offset_common, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }
  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
  DECKGL_FILTER_COLOR(vFillColor, geometry);
  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
  DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`;var v$=`#define SHADER_NAME text-background-layer-fragment-shader

precision highp float;

uniform bool stroked;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying float vLineWidth;
varying vec2 uv;
varying vec2 dimensions;

void main(void) {
  geometry.uv = uv;

  vec2 pixelPosition = uv * dimensions;
  if (stroked) {
    float distToEdge = min(
      min(pixelPosition.x, dimensions.x - pixelPosition.x),
      min(pixelPosition.y, dimensions.y - pixelPosition.y)
    );
    float isBorder = smoothedge(distToEdge, vLineWidth);
    gl_FragColor = mix(vFillColor, vLineColor, isBorder);
  } else {
    gl_FragColor = vFillColor;
  }

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;function m$(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function g$(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?m$(Object(e),!0).forEach(function(n){(0,Uh.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):m$(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function bwe(t){var r=xwe();return function(){var n=(0,jh.default)(t),i;if(r){var a=(0,jh.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,A$.default)(this,i)}}function xwe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Awe={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:function(r){return r.position}},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}},vf=function(t){(0,x$.default)(e,t);var r=bwe(e);function e(){var n;(0,y$.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,Uh.default)((0,b$.default)(n),"state",void 0),n}return(0,_$.default)(e,[{key:"getShaders",value:function(){return(0,SP.default)((0,jh.default)(e.prototype),"getShaders",this).call(this,{vs:d$,fs:v$,modules:[Je,st]})}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}},{key:"updateState",value:function(i){(0,SP.default)((0,jh.default)(e.prototype),"updateState",this).call(this,i);var a=i.changeFlags;if(a.extensionsChanged){var o,s=this.context.gl;(o=this.state.model)===null||o===void 0||o.delete(),this.state.model=this._getModel(s),this.getAttributeManager().invalidateAll()}}},{key:"draw",value:function(i){var a=i.uniforms,o=this.props,s=o.billboard,u=o.sizeScale,l=o.sizeUnits,f=o.sizeMinPixels,c=o.sizeMaxPixels,p=o.getLineWidth,d=this.props.padding;d.length<4&&(d=[d[0],d[1],d[0],d[1]]),this.state.model.setUniforms(a).setUniforms({billboard:s,stroked:Boolean(p),padding:d,sizeUnits:St[l],sizeScale:u,sizeMinPixels:f,sizeMaxPixels:c}).draw()}},{key:"_getModel",value:function(i){var a=[0,0,1,0,1,1,0,1];return new Ce(i,g$(g$({},this.getShaders()),{},{id:this.props.id,geometry:new Me({drawMode:6,vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(a)}}}),isInstanced:!0}))}}]),e}(He);(0,Uh.default)(vf,"defaultProps",Awe);(0,Uh.default)(vf,"layerName","TextBackgroundLayer");function Swe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=Twe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function Twe(t,r){if(t){if(typeof t=="string")return S$(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return S$(t,r)}}function S$(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function T$(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function qy(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?T$(Object(e),!0).forEach(function(n){(0,tu.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):T$(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function wwe(t){var r=Pwe();return function(){var n=(0,PP.default)(t),i;if(r){var a=(0,PP.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,M$.default)(this,i)}}function Pwe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var w$={start:1,middle:0,end:-1},P$={top:1,center:0,bottom:-1},TP=[0,0,0,255],Owe=1,Ewe={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:TP},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:eu.characterSet},fontFamily:eu.fontFamily,fontWeight:eu.fontWeight,lineHeight:Owe,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:TP},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:function(r){return r.text}},getPosition:{type:"accessor",value:function(r){return r.position}},getColor:{type:"accessor",value:TP},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}},mf=function(t){(0,C$.default)(e,t);var r=wwe(e);function e(){var n;(0,O$.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,tu.default)((0,Yy.default)(n),"state",void 0),(0,tu.default)((0,Yy.default)(n),"getBoundingRect",function(s,u){var l=n.transformParagraph(s,u),f=(0,wP.default)(l.size,2),c=f[0],p=f[1],d=n.state.fontAtlasManager.props.fontSize;c/=d,p/=d;var v=n.props,m=v.getTextAnchor,g=v.getAlignmentBaseline,y=w$[typeof m=="function"?m(s,u):m],_=P$[typeof g=="function"?g(s,u):g];return[(y-1)*c/2,(_-1)*p/2,c,p]}),(0,tu.default)((0,Yy.default)(n),"getIconOffsets",function(s,u){for(var l=n.props,f=l.getTextAnchor,c=l.getAlignmentBaseline,p=n.transformParagraph(s,u),d=p.x,v=p.y,m=p.rowWidth,g=(0,wP.default)(p.size,2),y=g[0],_=g[1],b=w$[typeof f=="function"?f(s,u):f],x=P$[typeof c=="function"?c(s,u):c],A=d.length,S=new Array(A*2),P=0,O=0;O<A;O++){var C=(1-b)*(y-m[O])/2;S[P++]=(b-1)*y/2+C+d[O],S[P++]=(x-1)*_/2+v[O]}return S}),n}return(0,E$.default)(e,[{key:"initializeState",value:function(){this.state={styleVersion:0,fontAtlasManager:new h$},this.props.maxWidth>0&&J.warn("v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}},{key:"updateState",value:function(i){var a=i.props,o=i.oldProps,s=i.changeFlags,u=s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getText);u&&this._updateText();var l=this._updateFontAtlas(),f=l||a.lineHeight!==o.lineHeight||a.wordBreak!==o.wordBreak||a.maxWidth!==o.maxWidth;f&&this.setState({styleVersion:this.state.styleVersion+1})}},{key:"getPickingInfo",value:function(i){var a=i.info;return a.object=a.index>=0?this.props.data[a.index]:null,a}},{key:"_updateFontAtlas",value:function(){var i=this.props,a=i.fontSettings,o=i.fontFamily,s=i.fontWeight,u=this.state,l=u.fontAtlasManager,f=u.characterSet,c=qy(qy({},a),{},{characterSet:f,fontFamily:o,fontWeight:s});if(!l.mapping)return l.setProps(c),!0;for(var p in c)if(c[p]!==l.props[p])return l.setProps(c),!0;return!1}},{key:"_updateText",value:function(){var i,a=this.props,o=a.data,s=a.characterSet,u=(i=o.attributes)===null||i===void 0?void 0:i.getText,l=this.props.getText,f=o.startIndices,c,p=s==="auto"&&new Set;if(u&&f){var d=J7(qy(qy({},ArrayBuffer.isView(u)?{value:u}:u),{},{length:o.length,startIndices:f,characterSet:p})),v=d.texts,m=d.characterCount;c=m,l=function(O,C){var T=C.index;return v[T]}}else{var g=Ut(o),y=g.iterable,_=g.objectInfo;f=[0],c=0;var b=Swe(y),x;try{for(b.s();!(x=b.n()).done;){var A=x.value;_.index++;var S=Array.from(l(A,_)||"");p&&S.forEach(p.add,p),c+=S.length,f.push(c)}}catch(P){b.e(P)}finally{b.f()}}this.setState({getText:l,startIndices:f,numInstances:c,characterSet:p||s})}},{key:"transformParagraph",value:function(i,a){var o=this.state.fontAtlasManager,s=o.mapping,u=this.state.getText,l=this.props,f=l.wordBreak,c=l.lineHeight,p=l.maxWidth,d=u(i,a)||"";return Z7(d,c,f,p*o.props.fontSize,s)}},{key:"renderLayers",value:function(){var i=this.state,a=i.startIndices,o=i.numInstances,s=i.getText,u=i.fontAtlasManager,l=u.scale,f=u.texture,c=u.mapping,p=i.styleVersion,d=this.props,v=d.data,m=d._dataDiff,g=d.getPosition,y=d.getColor,_=d.getSize,b=d.getAngle,x=d.getPixelOffset,A=d.getBackgroundColor,S=d.getBorderColor,P=d.getBorderWidth,O=d.backgroundPadding,C=d.background,T=d.billboard,I=d.fontSettings,R=d.outlineWidth,V=d.outlineColor,z=d.sizeScale,k=d.sizeUnits,G=d.sizeMinPixels,U=d.sizeMaxPixels,$=d.transitions,H=d.updateTriggers,Q=this.getSubLayerClass("characters",df),ie=this.getSubLayerClass("background",vf);return[C&&new ie({getFillColor:A,getLineColor:S,getLineWidth:P,padding:O,getPosition:g,getSize:_,getAngle:b,getPixelOffset:x,billboard:T,sizeScale:z,sizeUnits:k,sizeMinPixels:G,sizeMaxPixels:U,transitions:$&&{getPosition:$.getPosition,getAngle:$.getAngle,getSize:$.getSize,getFillColor:$.getBackgroundColor,getLineColor:$.getBorderColor,getLineWidth:$.getBorderWidth,getPixelOffset:$.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:H.getPosition,getAngle:H.getAngle,getSize:H.getSize,getFillColor:H.getBackgroundColor,getLineColor:H.getBorderColor,getLineWidth:H.getBorderWidth,getPixelOffset:H.getPixelOffset,getBoundingRect:{getText:H.getText,getTextAnchor:H.getTextAnchor,getAlignmentBaseline:H.getAlignmentBaseline,styleVersion:p}}}),{data:v.attributes&&v.attributes.background?{length:v.length,attributes:v.attributes.background}:v,_dataDiff:m,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new Q({sdf:I.sdf,smoothing:Number.isFinite(I.smoothing)?I.smoothing:eu.smoothing,outlineWidth:R/(I.radius||eu.radius),outlineColor:V,iconAtlas:f,iconMapping:c,getPosition:g,getColor:y,getSize:_,getAngle:b,getPixelOffset:x,billboard:T,sizeScale:z*l,sizeUnits:k,sizeMinPixels:G*l,sizeMaxPixels:U*l,transitions:$&&{getPosition:$.getPosition,getAngle:$.getAngle,getColor:$.getColor,getSize:$.getSize,getPixelOffset:$.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:H.getText,getPosition:H.getPosition,getAngle:H.getAngle,getColor:H.getColor,getSize:H.getSize,getPixelOffset:H.getPixelOffset,getIconOffsets:{getTextAnchor:H.getTextAnchor,getAlignmentBaseline:H.getAlignmentBaseline,styleVersion:p}}}),{data:v,_dataDiff:m,startIndices:a,numInstances:o,getIconOffsets:this.getIconOffsets,getIcon:s})]}}],[{key:"fontAtlasCacheLimit",set:function(i){p$(i)}}]),e}(Ot);(0,tu.default)(mf,"defaultProps",Ewe);(0,tu.default)(mf,"layerName","TextLayer");var Gh={circle:{type:sf,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:Co,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:mf,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},zh={type:$i,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},Ky={type:Xi,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function gf(t){var r=t.type,e=t.props,n={};for(var i in e)n[i]=r.defaultProps[e[i]];return n}function Zy(t,r){var e=t.props,n=e.transitions,i=e.updateTriggers,a={updateTriggers:{},transitions:n&&{getPosition:n.geometry}};for(var o in r){var s=r[o],u=t.props[o];o.startsWith("get")&&(u=t.getSubLayerAccessor(u),a.updateTriggers[s]=i[o],n&&(a.transitions[s]=n[o])),a[s]=u}return a}function R$(t){if(Array.isArray(t))return t;switch(J.assert(t.type,"GeoJSON does not have type"),t.type){case"Feature":return[t];case"FeatureCollection":return J.assert(Array.isArray(t.features),"GeoJSON does not have features array"),t.features;default:return[{geometry:t}]}}function OP(t,r){for(var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},i=e.startRow,a=i===void 0?0:i,o=e.endRow,s=o===void 0?t.length:o,u=a;u<s;u++){var l=t[u],f=l.geometry;if(f)if(f.type==="GeometryCollection"){J.assert(Array.isArray(f.geometries),"GeoJSON does not have geometries array");for(var c=f.geometries,p=0;p<c.length;p++){var d=c[p];I$(d,n,r,l,u)}}else I$(f,n,r,l,u)}return n}function I$(t,r,e,n,i){var a=t.type,o=t.coordinates,s=r.pointFeatures,u=r.lineFeatures,l=r.polygonFeatures,f=r.polygonOutlineFeatures;if(!Mwe(a,o)){J.warn("".concat(a," coordinates are malformed"))();return}switch(a){case"Point":s.push(e({geometry:t},n,i));break;case"MultiPoint":o.forEach(function(c){s.push(e({geometry:{type:"Point",coordinates:c}},n,i))});break;case"LineString":u.push(e({geometry:t},n,i));break;case"MultiLineString":o.forEach(function(c){u.push(e({geometry:{type:"LineString",coordinates:c}},n,i))});break;case"Polygon":l.push(e({geometry:t},n,i)),o.forEach(function(c){f.push(e({geometry:{type:"LineString",coordinates:c}},n,i))});break;case"MultiPolygon":o.forEach(function(c){l.push(e({geometry:{type:"Polygon",coordinates:c}},n,i)),c.forEach(function(p){f.push(e({geometry:{type:"LineString",coordinates:p}},n,i))})});break;default:}}var Cwe={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function Mwe(t,r){var e=Cwe[t];for(J.assert(e,"Unknown GeoJSON type ".concat(t));r&&--e>0;)r=r[0];return r&&Number.isFinite(r[0])}var k$=h(B());function L$(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function ko(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?L$(Object(e),!0).forEach(function(n){(0,k$.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):L$(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function B$(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function Jy(t){return t.geometry.coordinates}function F$(t,r){var e=B$(),n=t.pointFeatures,i=t.lineFeatures,a=t.polygonFeatures,o=t.polygonOutlineFeatures;return e.points.data=n,e.points._dataDiff=r.pointFeatures&&function(){return r.pointFeatures},e.points.getPosition=Jy,e.lines.data=i,e.lines._dataDiff=r.lineFeatures&&function(){return r.lineFeatures},e.lines.getPath=Jy,e.polygons.data=a,e.polygons._dataDiff=r.polygonFeatures&&function(){return r.polygonFeatures},e.polygons.getPolygon=Jy,e.polygonsOutline.data=o,e.polygonsOutline._dataDiff=r.polygonOutlineFeatures&&function(){return r.polygonOutlineFeatures},e.polygonsOutline.getPath=Jy,e}function D$(t,r){var e=B$(),n=t.points,i=t.lines,a=t.polygons,o=B7(t,r);return e.points.data={length:n.positions.value.length/n.positions.size,attributes:ko(ko({},n.attributes),{},{getPosition:n.positions,instancePickingColors:{size:3,value:o.points}}),properties:n.properties,numericProps:n.numericProps,featureIds:n.featureIds},e.lines.data={length:i.pathIndices.value.length-1,startIndices:i.pathIndices.value,attributes:ko(ko({},i.attributes),{},{getPath:i.positions,instancePickingColors:{size:3,value:o.lines}}),properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},e.lines._pathType="open",e.polygons.data={length:a.polygonIndices.value.length-1,startIndices:a.polygonIndices.value,attributes:ko(ko({},a.attributes),{},{getPolygon:a.positions,pickingColors:{size:3,value:o.polygons}}),properties:a.properties,numericProps:a.numericProps,featureIds:a.featureIds},e.polygons._normalize=!1,a.triangles&&(e.polygons.data.attributes.indices=a.triangles.value),e.polygonsOutline.data={length:a.primitivePolygonIndices.value.length-1,startIndices:a.primitivePolygonIndices.value,attributes:ko(ko({},a.attributes),{},{getPath:a.positions,instancePickingColors:{size:3,value:o.polygons}}),properties:a.properties,numericProps:a.numericProps,featureIds:a.featureIds},e.polygonsOutline._pathType="open",e}var Iwe=["instancePickingColors"];function EP(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=Rwe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function Rwe(t,r){if(t){if(typeof t=="string")return N$(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return N$(t,r)}}function N$(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function Lwe(t){var r=kwe();return function(){var n=(0,Vh.default)(t),i;if(r){var a=(0,Vh.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,H$.default)(this,i)}}function kwe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function j$(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Yi(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?j$(Object(e),!0).forEach(function(n){(0,Qy.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):j$(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var Bwe=["points","linestrings","polygons"],Fwe=Yi(Yi(Yi(Yi(Yi(Yi({},gf(Gh.circle)),gf(Gh.icon)),gf(Gh.text)),gf(zh)),gf(Ky)),{},{stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:function(r){return r.properties.icon}},getText:{type:"accessor",value:function(r){return r.properties.text}},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}}),Ra=function(t){(0,V$.default)(e,t);var r=Lwe(e);function e(){return(0,G$.default)(this,e),r.apply(this,arguments)}return(0,z$.default)(e,[{key:"initializeState",value:function(){this.state={layerProps:{},features:{}}}},{key:"updateState",value:function(i){var a=i.props,o=i.changeFlags;if(o.dataChanged){var s=this.props.data,u=s&&"points"in s&&"polygons"in s&&"lines"in s;this.setState({binary:u}),u?this._updateStateBinary({props:a,changeFlags:o}):this._updateStateJSON({props:a,changeFlags:o})}}},{key:"_updateStateBinary",value:function(i){var a=i.props,o=i.changeFlags,s=D$(a.data,this.encodePickingColor);this.setState({layerProps:s})}},{key:"_updateStateJSON",value:function(i){var a=i.props,o=i.changeFlags,s=R$(a.data),u=this.getSubLayerRow.bind(this),l={},f={};if(Array.isArray(o.dataChanged)){var c=this.state.features;for(var p in c)l[p]=c[p].slice(),f[p]=[];var d=EP(o.dataChanged),v;try{for(d.s();!(v=d.n()).done;){var m=v.value,g=OP(s,u,m);for(var y in c)f[y].push(Vy({data:l[y],getIndex:function(x){return x.__source.index},dataRange:m,replace:g[y]}))}}catch(b){d.e(b)}finally{d.f()}}else l=OP(s,u);var _=F$(l,f);this.setState({features:l,featuresDiff:f,layerProps:_})}},{key:"getPickingInfo",value:function(i){var a=this,o=(0,CP.default)((0,Vh.default)(e.prototype),"getPickingInfo",this).call(this,i),s=o.index,u=o.sourceLayer;return o.featureType=Bwe.find(function(l){return u.id.startsWith("".concat(a.id,"-").concat(l,"-"))}),s>=0&&u.id.startsWith("".concat(this.id,"-points-text"))&&this.state.binary&&(o.index=this.props.data.points.globalFeatureIds.value[s]),o}},{key:"_updateAutoHighlight",value:function(i){var a="".concat(this.id,"-points-"),o=i.featureType==="points",s=EP(this.getSubLayers()),u;try{for(s.s();!(u=s.n()).done;){var l=u.value;l.id.startsWith(a)===o&&l.updateAutoHighlight(i)}}catch(f){s.e(f)}finally{s.f()}}},{key:"_renderPolygonLayer",value:function(){var i=this.props,a=i.extruded,o=i.wireframe,s=this.state.layerProps,u="polygons-fill",l=this.shouldRenderSubLayer(u,s.polygons.data)&&this.getSubLayerClass(u,Ky.type);if(l){var f=Zy(this,Ky.props),c=a&&o;return c||delete f.getLineColor,f.updateTriggers.lineColors=c,new l(f,this.getSubLayerProps({id:u,updateTriggers:f.updateTriggers}),s.polygons)}return null}},{key:"_renderLineLayers",value:function(){var i=this.props,a=i.extruded,o=i.stroked,s=this.state.layerProps,u="polygons-stroke",l="linestrings",f=!a&&o&&this.shouldRenderSubLayer(u,s.polygonsOutline.data)&&this.getSubLayerClass(u,zh.type),c=this.shouldRenderSubLayer(l,s.lines.data)&&this.getSubLayerClass(l,zh.type);if(f||c){var p=Zy(this,zh.props);return[f&&new f(p,this.getSubLayerProps({id:u,updateTriggers:p.updateTriggers}),s.polygonsOutline),c&&new c(p,this.getSubLayerProps({id:l,updateTriggers:p.updateTriggers}),s.lines)]}return null}},{key:"_renderPointLayers",value:function(){var i=this.props.pointType,a=this.state,o=a.layerProps,s=a.binary,u=this.props.highlightedObjectIndex;!s&&Number.isFinite(u)&&(u=o.points.data.findIndex(function(S){return S.__source.index===u}));var l=new Set(i.split("+")),f=[],c=EP(l),p;try{for(c.s();!(p=c.n()).done;){var d=p.value,v="points-".concat(d),m=Gh[d],g=m&&this.shouldRenderSubLayer(v,o.points.data)&&this.getSubLayerClass(v,m.type);if(g){var y=Zy(this,m.props),_=o.points;if(d==="text"&&s){var b=_.data.attributes,x=b.instancePickingColors,A=(0,U$.default)(b,Iwe);_=Yi(Yi({},_),{},{data:Yi(Yi({},_.data),{},{attributes:A})})}f.push(new g(y,this.getSubLayerProps({id:v,updateTriggers:y.updateTriggers,highlightedObjectIndex:u}),_))}}}catch(S){c.e(S)}finally{c.f()}return f}},{key:"renderLayers",value:function(){var i=this.props.extruded,a=this._renderPolygonLayer(),o=this._renderLineLayers(),s=this._renderPointLayers();return[!i&&a,o,s,i&&a]}},{key:"getSubLayerAccessor",value:function(i){var a=this.state.binary;return!a||typeof i!="function"?(0,CP.default)((0,Vh.default)(e.prototype),"getSubLayerAccessor",this).call(this,i):function(o,s){var u=s.data,l=s.index,f=k7(u,l);return i(f,s)}}}]),e}(Ot);(0,Qy.default)(Ra,"layerName","GeoJsonLayer");(0,Qy.default)(Ra,"defaultProps",Fwe);var DX=h(B()),NX=h(ye()),UP=h(ve());var MX=h(B());var IX=h(EX());function CX(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function qPe(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?CX(Object(e),!0).forEach(function(n){(0,MX.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):CX(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function RX(t,r){var e=new IX.XMLParser(qPe({ignoreAttributes:!1,attributeNamePrefix:""},r)),n=e.parse(t);return n}var LX=h(me()),kX=h(ze());function YPe(t){return typeof t=="string"?t.charAt(0).toLowerCase()+t.slice(1):t}function e0(t){if(Array.isArray(t))return t.map(function(s){return e0(s)});if(t&&(0,kX.default)(t)==="object"){for(var r={},e=0,n=Object.entries(t);e<n.length;e++){var i=(0,LX.default)(n[e],2),a=i[0],o=i[1];r[YPe(a)]=e0(o)}return r}return t}function BX(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function jP(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?BX(Object(e),!0).forEach(function(n){(0,DX.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):BX(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var KPe="3.4.2",Fn={name:"XML",id:"xml",module:"xml",version:KPe,worker:!1,extensions:["xml"],mimeTypes:["application/xml","text/xml"],testText:ZPe,options:{xml:{parser:"fast-xml-parser",uncapitalizeKeys:!1,removeNSPrefix:!1,textNodeName:"value",arrayPaths:[]}},parse:function(){var t=(0,NX.default)(UP.default.mark(function e(n,i){return UP.default.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",FX(new TextDecoder().decode(n),i));case 1:case"end":return o.stop()}},e)}));function r(e,n){return t.apply(this,arguments)}return r}(),parseTextSync:function(r,e){return FX(r,e)}};function ZPe(t){return t.startsWith("<?xml")}function FX(t,r){var e,n=jP(jP({},Fn.options.xml),r?.xml);switch(n.parser){case"fast-xml-parser":var i=jP({allowBooleanAttributes:!0,ignoreDeclaration:!0,removeNSPrefix:n.removeNSPrefix,textNodeName:n.textNodeName,isArray:function(s,u,l,f){var c,p=Boolean(n==null||(c=n.arrayPaths)===null||c===void 0?void 0:c.some(function(d){return u===d}));return p}},r?._fastXML),a=RX(t,i);return n.uncapitalizeKeys?e0(a):a;default:throw new Error(r==null||(e=r.xml)===null||e===void 0?void 0:e.parser)}}var zX=h(B()),VX=h(ye()),zP=h(ve());function jX(t,r){var e,n,i,a=(e=Fn.parseTextSync)===null||e===void 0?void 0:e.call(Fn,t,r),o=(a==null||(n=a.ServiceExceptionReport)===null||n===void 0?void 0:n.ServiceException)||(a==null||(i=a["ogc:ServiceExceptionReport"])===null||i===void 0?void 0:i["ogc:ServiceException"]),s=typeof o=="string"?o:o.value||o.code||"Unknown error";return s}function UX(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function GX(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?UX(Object(e),!0).forEach(function(n){(0,zX.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):UX(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var JPe="3.4.2",yf={id:"wms-error",name:"WMS Error",module:"wms",version:JPe,worker:!1,extensions:["xml"],mimeTypes:["application/vnd.ogc.se_xml","application/xml","text/xml"],testText:QPe,options:{wms:{throwOnError:!1}},parse:function(){var t=(0,VX.default)(zP.default.mark(function e(n,i){return zP.default.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",GP(new TextDecoder().decode(n),i));case 1:case"end":return o.stop()}},e)}));function r(e,n){return t.apply(this,arguments)}return r}(),parseSync:function(r,e){return GP(new TextDecoder().decode(r),e)},parseTextSync:function(r,e){return GP(r,e)}};function QPe(t){return t.startsWith("<?xml")}function GP(t,r){var e=GX(GX({},yf.options.wms),r?.wms),n=jX(t,e),i=e.minimalErrors?n:"WMS Service error: ".concat(n);if(e.throwOnError)throw new Error(i);return i}var XX=h(ye()),WP=h(ve());var Kh=h(Zt()),r0=h(me());var VP=h(ze());function nu(t){return Array.isArray(t)?t:t?[t]:[]}function qh(t){var r=nu(t);return r.length>0&&r.every(function(e){return typeof e=="string"})?r:[]}function Yh(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:void 0;switch((0,VP.default)(t)){case"number":return t;case"string":return parseFloat(t);default:return}}function t0(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:void 0;switch((0,VP.default)(t)){case"number":return t;case"string":return parseInt(t,10);default:return}}function iu(t){switch(t){case"true":return!0;case"false":return!1;case"1":return!0;case"0":return!1;default:return!1}}function n0(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=eOe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function eOe(t,r){if(t){if(typeof t=="string")return HX(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return HX(t,r)}}function HX(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function HP(t,r){var e=Fn.parseTextSync(t,r),n=e.WMT_MS_Capabilities||e.WMS_Capabilities||e,i=tOe(n);if(r!=null&&r.inheritedLayerProps){var a=n0(i.layers),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;$X(s,null)}}catch(u){a.e(u)}finally{a.f()}}return(r!=null&&r.includeRawData||r!=null&&r.raw)&&(i.raw=n),r!=null&&r.includeXMLText&&(i.xml=t),i}function tOe(t){var r,e,n,i,a,o,s,u,l,f,c,p,d,v,m,g,y={version:String(t.version||""),name:String(((r=t.Service)===null||r===void 0?void 0:r.Name)||"unnamed"),title:(e=t.Service)!==null&&e!==void 0&&e.Title?String((n=t.Service)===null||n===void 0?void 0:n.Title):void 0,abstract:(i=t.Service)!==null&&i!==void 0&&i.Abstract?String((a=t.Service)===null||a===void 0?void 0:a.Abstract):void 0,keywords:qh((o=t.Service)===null||o===void 0||(s=o.KeywordList)===null||s===void 0?void 0:s.Keyword),fees:(u=t.Service)!==null&&u!==void 0&&u.Fees?JSON.stringify((l=t.Service)===null||l===void 0?void 0:l.Fees):void 0,accessConstraints:(f=t.Service)!==null&&f!==void 0&&f.AccessConstraints?JSON.stringify((c=t.Service)===null||c===void 0?void 0:c.AccessConstraints):void 0,layerLimit:t0((p=t.Service)===null||p===void 0?void 0:p.LayerLimit),maxWidth:t0((d=t.Service)===null||d===void 0?void 0:d.maxWidth),maxHeight:t0((v=t.Service)===null||v===void 0?void 0:v.maxHeight),layers:[],requests:rOe((m=t.Capability)===null||m===void 0?void 0:m.Request),exceptions:nOe(t.Exception)},_=nu((g=t.Capability)===null||g===void 0?void 0:g.Layer),b=n0(_),x;try{for(b.s();!(x=b.n()).done;){var A=x.value;y.layers.push(WX(A))}}catch(I){b.e(I)}finally{b.f()}for(var S=0,P=Object.entries(y);S<P.length;S++){var O=(0,r0.default)(P[S],2),C=O[0],T=O[1];T===void 0&&delete y[C]}return y}function rOe(t){for(var r={},e=0,n=Object.entries(t||{});e<n.length;e++){var i=(0,r0.default)(n[e],2),a=i[0],o=i[1],s=qh(o?.Format);r[a]={mimeTypes:s}}return r}function nOe(t){var r=nu(t?.Format);if(r.length>0)return{mimeTypes:qh(t)}}function WX(t){var r,e={title:String(t?.Title||""),name:t?.Name&&String(t?.Name),abstract:t?.Name&&String(t?.Abstract),keywords:qh((r=t.KeywordList)===null||r===void 0?void 0:r.Keyword)},n=t?.CRS||t?.SRS;n&&Array.isArray(n)&&n.every(function(_){return typeof _=="string"})&&(e.crs=n);var i=t?.EX_GeographicBoundingBox&&iOe(t?.EX_GeographicBoundingBox);i&&(e.geographicBoundingBox=i),i=t?.LatLonBoundingBox&&aOe(t?.LatLonBoundingBox),i&&(e.geographicBoundingBox=i);var a=t?.BoundingBox&&oOe(t?.BoundingBox);a&&a.length>0&&(e.boundingBoxes=a);var o=nu(t?.Dimension),s=o.map(function(_){return uOe(_)});s.length&&(e.dimensions=s),t!=null&&t.opaque&&(e.opaque=iu(t?.opaque)),t!=null&&t.cascaded&&(e.cascaded=iu(t?.cascaded)),t!=null&&t.queryable&&(e.queryable=iu(t?.queryable));var u=nu(t?.Layer),l=[],f=n0(u),c;try{for(f.s();!(c=f.n()).done;){var p=c.value;l.push(WX(p))}}catch(_){f.e(_)}finally{f.f()}l.length>0&&(e.layers=l);for(var d=0,v=Object.entries(e);d<v.length;d++){var m=(0,r0.default)(v[d],2),g=m[0],y=m[1];y===void 0&&delete e[g]}return e}function iOe(t){var r=t.westBoundLongitude,e=t.northBoundLatitude,n=t.eastBoundLongitude,i=t.southBoundLatitude;return[[r,i],[n,e]]}function aOe(t){var r=t.minx,e=t.miny,n=t.maxx,i=t.maxy;return[[r,e],[n,i]]}function oOe(t){var r=nu(t);return r.map(function(e){return sOe(e)})}function sOe(t){var r=t.CRS,e=t.SRS,n=t.minx,i=t.miny,a=t.maxx,o=t.maxy,s=t.resx,u=t.resy,l={crs:r||e,boundingBox:[[Yh(n),Yh(i)],[Yh(a),Yh(o)]]};return s&&(l.xResolution=s),u&&(l.yResolution=u),l}function uOe(t){var r=t.name,e=t.units,n=t.value,i={name:r,units:e,extent:n};return t.unitSymbol&&(i.unitSymbol=t.unitSymbol),t.default&&(i.defaultValue=t.default),t.multipleValues&&(i.multipleValues=iu(t.multipleValues)),t.nearestValue&&(i.nearestValue=iu(t.nearestValue)),t.current&&(i.current=iu(t.current)),i}function $X(t,r){r!=null&&r.geographicBoundingBox&&!t.geographicBoundingBox&&(t.geographicBoundingBox=(0,Kh.default)(r.geographicBoundingBox)),r!=null&&r.crs&&!t.crs&&(t.crs=(0,Kh.default)(r.crs)),r!=null&&r.boundingBoxes&&!t.boundingBoxes&&(t.boundingBoxes=(0,Kh.default)(r.boundingBoxes)),r!=null&&r.dimensions&&!t.dimensions&&(t.dimensions=(0,Kh.default)(r.dimensions));var e=n0(t.layers||[]),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;$X(i,t)}}catch(a){e.e(a)}finally{e.f()}}var lOe="3.4.2",au={id:"wms-capabilities",name:"WMS Capabilities",module:"wms",version:lOe,worker:!1,extensions:["xml"],mimeTypes:["application/vnd.ogc.wms_xml","application/xml","text/xml"],testText:fOe,options:{wms:{}},parse:function(){var t=(0,XX.default)(WP.default.mark(function e(n,i){return WP.default.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",HP(new TextDecoder().decode(n),i?.wms));case 1:case"end":return o.stop()}},e)}));function r(e,n){return t.apply(this,arguments)}return r}(),parseTextSync:function(r,e){return HP(r,e?.wms)}};function fOe(t){return t.startsWith("<?xml")}var KX=h(ye()),ZX=h(B()),XP=h(ve());function $P(t,r){var e,n=Fn.parseTextSync(t,r),i=((e=n.FeatureInfoResponse)===null||e===void 0?void 0:e.FIELDS)||[],a=Array.isArray(i)?i:[i];return{features:a.map(function(o){return cOe(o)})}}function cOe(t){var r=t||{};return{attributes:r,type:"",bounds:{bottom:0,top:0,left:0,right:0}}}function qX(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function YX(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?qX(Object(e),!0).forEach(function(n){(0,ZX.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):qX(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var qP=YX(YX({},au),{},{id:"wms-feature-info",name:"WMS FeatureInfo",parse:function(){var t=(0,KX.default)(XP.default.mark(function e(n,i){return XP.default.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",$P(new TextDecoder().decode(n),i));case 1:case"end":return o.stop()}},e)}));function r(e,n){return t.apply(this,arguments)}return r}(),parseTextSync:function(r,e){return $P(r,e)}});var eq=h(ye()),tq=h(B()),KP=h(ve());function YP(t,r){var e,n=(e=Fn.parseTextSync)===null||e===void 0?void 0:e.call(Fn,t,r);return n}function JX(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function QX(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?JX(Object(e),!0).forEach(function(n){(0,tq.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):JX(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var ZP=QX(QX({},au),{},{id:"wms-layer-description",name:"WMS DescribeLayer",parse:function(){var t=(0,eq.default)(KP.default.mark(function e(n,i){return KP.default.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",YP(new TextDecoder().decode(n),i));case 1:case"end":return o.stop()}},e)}));function r(e,n){return t.apply(this,arguments)}return r}(),parseTextSync:function(r,e){return YP(r,e)}});var uq=h(L()),lq=h(Y()),fq=h(K()),JP=h(q());var iq=h(B()),aq=h(L()),oq=h(N());function rq(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function nq(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?rq(Object(e),!0).forEach(function(n){(0,iq.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):rq(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var sq=function(){function t(r){(0,aq.default)(this,t),w(this,"fetch",void 0),w(this,"loadOptions",void 0),w(this,"_needsRefresh",!0),w(this,"props",void 0),this.props=nq({},r),this.loadOptions=nq({},r.loadOptions),this.fetch=pOe(this.loadOptions)}return(0,oq.default)(t,[{key:"setProps",value:function(e){this.props=Object.assign(this.props,e),this.setNeedsRefresh()}},{key:"setNeedsRefresh",value:function(){this._needsRefresh=!0}},{key:"getNeedsRefresh",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,n=this._needsRefresh;return e&&(this._needsRefresh=!1),n}}]),t}();function pOe(t){var r=t?.fetch;if(r&&typeof r=="function")return function(n,i){return r(n,i)};var e=t?.fetch;return e&&typeof e!="function"?function(n){return fetch(n,e)}:function(n){return fetch(n)}}function hOe(t){var r=dOe();return function(){var n=(0,JP.default)(t),i;if(r){var a=(0,JP.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,fq.default)(this,i)}}function dOe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ka=function(t){(0,lq.default)(e,t);var r=hOe(e);function e(){return(0,uq.default)(this,e),r.apply(this,arguments)}return e}(sq);var hq=h(B()),QP=h(me()),eO=h(ye()),dq=h(L()),vq=h(N()),mq=h(Y()),gq=h(K()),tO=h(q()),Zh=h(ve());function cq(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function pq(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?cq(Object(e),!0).forEach(function(n){(0,hq.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):cq(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function vOe(t){var r=mOe();return function(){var n=(0,tO.default)(t),i;if(r){var a=(0,tO.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gq.default)(this,i)}}function mOe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Jh=function(t){(0,mq.default)(e,t);var r=vOe(e);function e(n){return(0,dq.default)(this,e),r.call(this,n)}return(0,vq.default)(e,[{key:"getMetadata",value:function(){var n=(0,eO.default)(Zh.default.mark(function a(){return Zh.default.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:throw new Error("ImageSource.getMetadata not implemented");case 1:case"end":return s.stop()}},a)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getImage",value:function(){var n=(0,eO.default)(Zh.default.mark(function a(o){var s,u,l,f;return Zh.default.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return s=this.getGranularParameters(o),u=this.getURLFromTemplate(s),p.next=4,this.fetch(u);case 4:return l=p.sent,p.next=7,l.arrayBuffer();case 7:return f=p.sent,p.next=10,Jn.parse(f);case 10:return p.abrupt("return",p.sent);case 11:case"end":return p.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"getGranularParameters",value:function(i){var a=(0,QP.default)(i.bbox,4),o=a[0],s=a[1],u=a[2],l=a[3];return pq(pq({},i),{},{east:o,north:s,south:l,west:u})}},{key:"getURLFromTemplate",value:function(i){for(var a=this.props.url,o=0,s=Object.entries(i);o<s.length;o++){var u=(0,QP.default)(s[o],2),l=u[0],f=u[1];a=a.replace("${".concat(l,"}"),String(f)),a=a.replace("{".concat(l,"}"),String(f))}return a}}]),e}(ka);w(Jh,"type","template");w(Jh,"testURL",function(t){return t.toLowerCase().includes("{")});var i0=h(me()),Zi=h(ye()),bq=h(B()),xq=h(L()),Aq=h(N()),Fo=h(be()),Sq=h(Y()),Tq=h(K()),rO=h(q()),ur=h(ve());function gOe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=yOe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function yOe(t,r){if(t){if(typeof t=="string")return yq(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return yq(t,r)}}function yq(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function _q(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Ki(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?_q(Object(e),!0).forEach(function(n){(0,bq.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):_q(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function _Oe(t){var r=bOe();return function(){var n=(0,rO.default)(t),i;if(r){var a=(0,rO.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Tq.default)(this,i)}}function bOe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Qh=function(t){(0,Sq.default)(e,t);var r=_Oe(e);function e(n){var i;(0,xq.default)(this,e);var a;return i=r.call(this,n),w((0,Fo.default)(i),"url",void 0),w((0,Fo.default)(i),"substituteCRS84",void 0),w((0,Fo.default)(i),"flipCRS",void 0),w((0,Fo.default)(i),"wmsParameters",void 0),w((0,Fo.default)(i),"vendorParameters",void 0),w((0,Fo.default)(i),"capabilities",null),w((0,Fo.default)(i),"loaders",[Jn,yf,au,qP,ZP]),i.url=n.url,i.substituteCRS84=(a=n.substituteCRS84)!==null&&a!==void 0?a:!1,i.flipCRS=["EPSG:4326"],i.wmsParameters=Ki({layers:void 0,query_layers:void 0,styles:void 0,version:"1.3.0",crs:"EPSG:4326",format:"image/png",info_format:"text/plain",transparent:void 0,time:void 0,elevation:void 0},n.wmsParameters),i.vendorParameters=n.vendorParameters||{},i}return(0,Aq.default)(e,[{key:"getMetadata",value:function(){var n=(0,Zi.default)(ur.default.mark(function a(){var o;return ur.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,this.getCapabilities();case 2:return o=u.sent,u.abrupt("return",this.normalizeMetadata(o));case 4:case"end":return u.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getImage",value:function(){var n=(0,Zi.default)(ur.default.mark(function a(o){return ur.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,this.getMap(o);case 2:return u.abrupt("return",u.sent);case 3:case"end":return u.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"normalizeMetadata",value:function(i){return i}},{key:"getCapabilities",value:function(){var n=(0,Zi.default)(ur.default.mark(function a(o,s){var u,l,f,c;return ur.default.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return u=this.getCapabilitiesURL(o,s),d.next=3,this.fetch(u);case 3:return l=d.sent,d.next=6,l.arrayBuffer();case 6:return f=d.sent,this._checkResponse(l,f),d.next=10,au.parse(f,this.loadOptions);case 10:return c=d.sent,this.capabilities=c,d.abrupt("return",c);case 13:case"end":return d.stop()}},a,this)}));function i(a,o){return n.apply(this,arguments)}return i}()},{key:"getMap",value:function(){var n=(0,Zi.default)(ur.default.mark(function a(o,s){var u,l,f;return ur.default.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=this.getMapURL(o,s),p.next=3,this.fetch(u);case 3:return l=p.sent,p.next=6,l.arrayBuffer();case 6:return f=p.sent,this._checkResponse(l,f),p.prev=8,p.next=11,Jn.parse(f,this.loadOptions);case 11:return p.abrupt("return",p.sent);case 14:throw p.prev=14,p.t0=p.catch(8),this._parseError(f);case 17:case"end":return p.stop()}},a,this,[[8,14]])}));function i(a,o){return n.apply(this,arguments)}return i}()},{key:"getFeatureInfo",value:function(){var n=(0,Zi.default)(ur.default.mark(function a(o,s){var u,l,f;return ur.default.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=this.getFeatureInfoURL(o,s),p.next=3,this.fetch(u);case 3:return l=p.sent,p.next=6,l.arrayBuffer();case 6:return f=p.sent,this._checkResponse(l,f),p.next=10,qP.parse(f,this.loadOptions);case 10:return p.abrupt("return",p.sent);case 11:case"end":return p.stop()}},a,this)}));function i(a,o){return n.apply(this,arguments)}return i}()},{key:"getFeatureInfoText",value:function(){var n=(0,Zi.default)(ur.default.mark(function a(o,s){var u,l,f;return ur.default.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=this.getFeatureInfoURL(o,s),p.next=3,this.fetch(u);case 3:return l=p.sent,p.next=6,l.arrayBuffer();case 6:return f=p.sent,this._checkResponse(l,f),p.abrupt("return",new TextDecoder().decode(f));case 9:case"end":return p.stop()}},a,this)}));function i(a,o){return n.apply(this,arguments)}return i}()},{key:"describeLayer",value:function(){var n=(0,Zi.default)(ur.default.mark(function a(o,s){var u,l,f;return ur.default.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=this.describeLayerURL(o,s),p.next=3,this.fetch(u);case 3:return l=p.sent,p.next=6,l.arrayBuffer();case 6:return f=p.sent,this._checkResponse(l,f),p.next=10,ZP.parse(f,this.loadOptions);case 10:return p.abrupt("return",p.sent);case 11:case"end":return p.stop()}},a,this)}));function i(a,o){return n.apply(this,arguments)}return i}()},{key:"getLegendGraphic",value:function(){var n=(0,Zi.default)(ur.default.mark(function a(o,s){var u,l,f;return ur.default.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=this.getLegendGraphicURL(o,s),p.next=3,this.fetch(u);case 3:return l=p.sent,p.next=6,l.arrayBuffer();case 6:return f=p.sent,this._checkResponse(l,f),p.prev=8,p.next=11,Jn.parse(f,this.loadOptions);case 11:return p.abrupt("return",p.sent);case 14:throw p.prev=14,p.t0=p.catch(8),this._parseError(f);case 17:case"end":return p.stop()}},a,this,[[8,14]])}));function i(a,o){return n.apply(this,arguments)}return i}()},{key:"getCapabilitiesURL",value:function(i,a){var o=Ki({version:this.wmsParameters.version},i);return this._getWMSUrl("GetCapabilities",o,a)}},{key:"getMapURL",value:function(i,a){i=this._getWMS130Parameters(i);var o=Ki({version:this.wmsParameters.version,format:this.wmsParameters.format,transparent:this.wmsParameters.transparent,time:this.wmsParameters.time,elevation:this.wmsParameters.elevation,layers:this.wmsParameters.layers,styles:this.wmsParameters.styles,crs:this.wmsParameters.crs},i);return this._getWMSUrl("GetMap",o,a)}},{key:"getFeatureInfoURL",value:function(i,a){var o=Ki({version:this.wmsParameters.version,info_format:this.wmsParameters.info_format,layers:this.wmsParameters.layers,query_layers:this.wmsParameters.query_layers,styles:this.wmsParameters.styles,crs:this.wmsParameters.crs},i);return this._getWMSUrl("GetFeatureInfo",o,a)}},{key:"describeLayerURL",value:function(i,a){var o=Ki({version:this.wmsParameters.version},i);return this._getWMSUrl("DescribeLayer",o,a)}},{key:"getLegendGraphicURL",value:function(i,a){var o=Ki({version:this.wmsParameters.version},i);return this._getWMSUrl("GetLegendGraphic",o,a)}},{key:"_parseWMSUrl",value:function(i){var a=i.split("?"),o=(0,i0.default)(a,2),s=o[0],u=o[1],l=u.split("&"),f={},c=gOe(l),p;try{for(c.s();!(p=c.n()).done;){var d=p.value,v=d.split("="),m=(0,i0.default)(v,2),g=m[0],y=m[1];f[g]=y}}catch(_){c.e(_)}finally{c.f()}return{url:s,parameters:f}}},{key:"_getWMSUrl",value:function(i,a,o){for(var s=this.url,u=!0,l=Ki(Ki(Ki({service:"WMS",version:a.version,request:i},a),this.vendorParameters),o),f=["transparent","time","elevation"],c=0,p=Object.entries(l);c<p.length;c++){var d=(0,i0.default)(p[c],2),v=d[0],m=d[1];(!f.includes(v)||m)&&(s+=u?"?":"&",u=!1,s+=this._getURLParameter(v,m,a))}return encodeURI(s)}},{key:"_getWMS130Parameters",value:function(i){var a=Ki({},i);return a.srs&&(a.crs=a.crs||a.srs,delete a.srs),a}},{key:"_getURLParameter",value:function(i,a,o){switch(i){case"crs":o.version!=="1.3.0"?i="srs":this.substituteCRS84&&a==="EPSG:4326"&&(a="CRS:84");break;case"srs":o.version==="1.3.0"&&(i="crs");break;case"bbox":var s=this._flipBoundingBox(a,o);s&&(a=s);break;default:}return i=i.toUpperCase(),Array.isArray(a)?"".concat(i,"=").concat(a.join(",")):"".concat(i,"=").concat(a?String(a):"")}},{key:"_flipBoundingBox",value:function(i,a){if(!Array.isArray(i)||i.length!==4)return null;var o=a.version==="1.3.0"&&this.flipCRS.includes(a.crs||"")&&!(this.substituteCRS84&&a.crs==="EPSG:4326"),s=i;return o?[s[1],s[0],s[3],s[2]]:s}},{key:"_fetchArrayBuffer",value:function(){var n=(0,Zi.default)(ur.default.mark(function a(o){var s,u;return ur.default.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,this.fetch(o);case 2:return s=f.sent,f.next=5,s.arrayBuffer();case 5:return u=f.sent,this._checkResponse(s,u),f.abrupt("return",u);case 8:case"end":return f.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"_checkResponse",value:function(i,a){var o=i.headers["content-type"];if(!i.ok||yf.mimeTypes.includes(o)){var s=_1(this.loadOptions,{wms:{throwOnError:!0}}),u=yf.parseSync(a,s);throw new Error(u)}}},{key:"_parseError",value:function(i){var a=yf.parseSync(i,this.loadOptions);return new Error(a)}}]),e}(ka);w(Qh,"type","wms");w(Qh,"testURL",function(t){return t.toLowerCase().includes("wms")});var Oq=h(me()),Eq=h(B()),ed=h(ye()),Cq=h(L()),Mq=h(N()),Iq=h(Y()),Rq=h(K()),nO=h(q()),Ba=h(ve());function wq(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Pq(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?wq(Object(e),!0).forEach(function(n){(0,Eq.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):wq(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function xOe(t){var r=AOe();return function(){var n=(0,nO.default)(t),i;if(r){var a=(0,nO.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Rq.default)(this,i)}}function AOe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var a0=function(t){(0,Iq.default)(e,t);var r=xOe(e);function e(n){return(0,Cq.default)(this,e),r.call(this,n)}return(0,Mq.default)(e,[{key:"getMetadata",value:function(){var n=(0,ed.default)(Ba.default.mark(function a(){return Ba.default.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,this.metadata();case 2:return s.abrupt("return",s.sent);case 3:case"end":return s.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getImage",value:function(){var n=(0,ed.default)(Ba.default.mark(function a(o){return Ba.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:throw new Error("not implemented");case 1:case"end":return u.stop()}},a)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"metadata",value:function(){var n=(0,ed.default)(Ba.default.mark(function a(){return Ba.default.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:throw new Error("not implemented");case 1:case"end":return s.stop()}},a)}));function i(){return n.apply(this,arguments)}return i}()},{key:"exportImage",value:function(i){throw new Error("not implemented")}},{key:"metadataURL",value:function(i){return"".concat(this.props.url,"?f=pjson")}},{key:"exportImageURL",value:function(i){var a="bbox=".concat(i.bbox[0],",").concat(i.bbox[1],",").concat(i.bbox[2],",").concat(i.bbox[3]),o="size=".concat(i.width,",").concat(i.height),s=Pq(Pq({},i),{},{bbox:a,size:o});return delete s.width,delete s.height,this.getUrl("exportImage",s)}},{key:"getUrl",value:function(i,a,o){for(var s="".concat(this.props.url,"/").concat(i),u=!0,l=0,f=Object.entries(a);l<f.length;l++){var c=(0,Oq.default)(f[l],2),p=c[0],d=c[1];s+=u?"?":"&",u=!1,Array.isArray(d)?s+="".concat(p.toUpperCase(),"=").concat(d.join(",")):s+="".concat(p.toUpperCase(),"=").concat(d?String(d):"")}return s}},{key:"checkResponse",value:function(){var n=(0,ed.default)(Ba.default.mark(function a(o){return Ba.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(o.ok){u.next=2;break}throw new Error("error");case 2:case"end":return u.stop()}},a)}));function i(a){return n.apply(this,arguments)}return i}()}]),e}(ka);w(a0,"type","arcgis-image-server");w(a0,"testURL",function(t){return t.toLowerCase().includes("ImageServer")});function SOe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=TOe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function TOe(t,r){if(t){if(typeof t=="string")return Lq(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Lq(t,r)}}function Lq(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var wOe=[Qh,a0,Jh];function iO(t){var r=t.type,e=r===void 0?"auto":r,n=e==="auto"?POe(t.url):e;switch(n){case"template":return new Jh(t);case"wms":return new Qh(t);default:throw new Error("Not a valid image source type")}}function POe(t){var r=SOe(wOe),e;try{for(r.s();!(e=r.n()).done;){var n=e.value;if(n.testURL&&n.testURL(t))return n.type}}catch(i){r.e(i)}finally{r.f()}return"wms"}var kq=6378137*Math.PI;function aO(t){var r=wt(t);return r[0]=(r[0]/256-1)*kq,r[1]=(r[1]/256-1)*kq,r}function Bq(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function o0(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Bq(Object(e),!0).forEach(function(n){(0,td.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Bq(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function OOe(t){var r=EOe();return function(){var n=(0,u0.default)(t),i;if(r){var a=(0,u0.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Gq.default)(this,i)}}function EOe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var COe={id:"imagery-layer",data:"",serviceType:"auto",srs:"auto",layers:{type:"array",compare:!0,value:[]},onMetadataLoad:{type:"function",value:function(){}},onMetadataLoadError:{type:"function",value:console.error},onImageLoadStart:{type:"function",value:function(){}},onImageLoad:{type:"function",value:function(){}},onImageLoadError:{type:"function",compare:!1,value:function(r,e){return console.error(e,r)}}},l0=function(t){(0,Uq.default)(e,t);var r=OOe(e);function e(){var n;(0,Fq.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,td.default)((0,Nq.default)(n),"state",void 0),n}return(0,Dq.default)(e,[{key:"isLoaded",get:function(){return Boolean(this.state)&&this.state.loadCounter===0&&(0,jq.default)((0,u0.default)(e.prototype),"isLoaded",this)}},{key:"shouldUpdateState",value:function(){return!0}},{key:"initializeState",value:function(){this.state._nextRequestId=0,this.state.lastRequestId=-1,this.state.loadCounter=0}},{key:"updateState",value:function(i){var a=this,o=i.changeFlags,s=i.props,u=i.oldProps,l=this.context.viewport;o.dataChanged||s.serviceType!==u.serviceType?(this.state.imageSource=this._createImageSource(s),this._loadMetadata(),this.debounce(function(){return a.loadImage(l,"image source changed")},0)):Lt(s.layers,u.layers,1)?o.viewportChanged&&this.debounce(function(){return a.loadImage(l,"viewport changed")}):this.debounce(function(){return a.loadImage(l,"layers changed")},0)}},{key:"finalizeState",value:function(){}},{key:"renderLayers",value:function(){var i=this.state,a=i.bounds,o=i.image,s=i.lastRequestParameters;return o&&new rf(o0(o0({},this.getSubLayerProps({id:"bitmap"})),{},{_imageCoordinateSystem:s.srs==="EPSG:4326"?ue.LNGLAT:ue.CARTESIAN,bounds:a,image:o}))}},{key:"getFeatureInfoText",value:function(){var n=(0,s0.default)(ou.default.mark(function a(o,s){var u,l,f,c;return ou.default.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(u=this.state.lastRequestParameters,!u){d.next=6;break}return d.next=4,(l=(f=this.state.imageSource).getFeatureInfoText)===null||l===void 0?void 0:l.call(f,o0(o0({},u),{},{query_layers:u.layers,x:o,y:s,info_format:"application/vnd.ogc.gml"}));case 4:return c=d.sent,d.abrupt("return",c);case 6:return d.abrupt("return","");case 7:case"end":return d.stop()}},a,this)}));function i(a,o){return n.apply(this,arguments)}return i}()},{key:"_createImageSource",value:function(i){if(i.data instanceof ka)return i.data;if(typeof i.data=="string")return iO({url:i.data,loadOptions:i.loadOptions,type:i.serviceType});throw new Error("invalid image source in props.data")}},{key:"_loadMetadata",value:function(){var n=(0,s0.default)(ou.default.mark(function a(){var o,s,u,l;return ou.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return o=this.state.imageSource,c.prev=1,this.state.loadCounter++,c.next=5,o.getMetadata();case 5:s=c.sent,this.state.imageSource===o&&((u=this.getCurrentLayer())===null||u===void 0||u.props.onMetadataLoad(s)),c.next=12;break;case 9:c.prev=9,c.t0=c.catch(1),(l=this.getCurrentLayer())===null||l===void 0||l.props.onMetadataLoadError(c.t0);case 12:return c.prev=12,this.state.loadCounter--,c.finish(12);case 15:case"end":return c.stop()}},a,this,[[1,9,12,15]])}));function i(){return n.apply(this,arguments)}return i}()},{key:"loadImage",value:function(){var n=(0,s0.default)(ou.default.mark(function a(o,s){var u,l,f,c,p,d,v,m,g,y,_,b,x,A,S,P,O,C,T,I;return ou.default.wrap(function(V){for(;;)switch(V.prev=V.next){case 0:if(u=this.props,l=u.layers,f=u.serviceType,!(f==="wms"&&l.length===0)){V.next=3;break}return V.abrupt("return");case 3:return c=o.getBounds(),p=o.width,d=o.height,v=this.getRequestId(),m=this.props.srs,m==="auto"&&(m=o.resolution?"EPSG:4326":"EPSG:3857"),g={width:p,height:d,bbox:c,layers:l,srs:m},m==="EPSG:3857"&&(y=aO([c[0],c[1]]),_=(0,oO.default)(y,2),b=_[0],x=_[1],A=aO([c[2],c[3]]),S=(0,oO.default)(A,2),P=S[0],O=S[1],g.bbox=[b,x,P,O]),V.prev=10,this.state.loadCounter++,this.props.onImageLoadStart(v),V.next=15,this.state.imageSource.getImage(g);case 15:C=V.sent,this.state.lastRequestId<v&&((T=this.getCurrentLayer())===null||T===void 0||T.props.onImageLoad(v),this.setState({image:C,bounds:c,lastRequestParameters:g,lastRequestId:v})),V.next=23;break;case 19:V.prev=19,V.t0=V.catch(10),this.raiseError(V.t0,"Load image"),(I=this.getCurrentLayer())===null||I===void 0||I.props.onImageLoadError(v,V.t0);case 23:return V.prev=23,this.state.loadCounter--,V.finish(23);case 26:case"end":return V.stop()}},a,this,[[10,19,23,26]])}));function i(a,o){return n.apply(this,arguments)}return i}()},{key:"getRequestId",value:function(){return this.state._nextRequestId++}},{key:"debounce",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:500;clearTimeout(this.state._timeoutId),this.state._timeoutId=setTimeout(function(){return i()},a)}}]),e}(Ot);(0,td.default)(l0,"layerName","WMSLayer");(0,td.default)(l0,"defaultProps",COe);var zq=h(L()),Vq=h(Y()),Hq=h(K()),sO=h(q()),uO=h(B());function MOe(t){var r=IOe();return function(){var n=(0,sO.default)(t),i;if(r){var a=(0,sO.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Hq.default)(this,i)}}function IOe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ROe={getHeight:{type:"accessor",value:0},greatCircle:!0},f0=function(t){(0,Vq.default)(e,t);var r=MOe(e);function e(){return(0,zq.default)(this,e),r.apply(this,arguments)}return e}(tf);(0,uO.default)(f0,"layerName","GreatCircleLayer");(0,uO.default)(f0,"defaultProps",ROe);var sY=h(L()),uY=h(N()),lY=h(Y()),fY=h(K()),pO=h(q()),hO=h(B());var $q=h(L()),Xq=h(N()),qq=h(Y()),Yq=h(K()),lO=h(q()),c0=h(B());function LOe(t){var r=kOe();return function(){var n=(0,lO.default)(t),i;if(r){var a=(0,lO.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Yq.default)(this,i)}}function kOe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Wq(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function BOe(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Wq(Object(e),!0).forEach(function(n){(0,c0.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Wq(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var FOe=BOe({},qi.defaultProps),Dn=function(t){(0,qq.default)(e,t);var r=LOe(e);function e(){return(0,$q.default)(this,e),r.apply(this,arguments)}return(0,Xq.default)(e,[{key:"indexToBounds",value:function(){return null}},{key:"renderLayers",value:function(){var i=this.props,a=i.elevationScale,o=i.extruded,s=i.wireframe,u=i.filled,l=i.stroked,f=i.lineWidthUnits,c=i.lineWidthScale,p=i.lineWidthMinPixels,d=i.lineWidthMaxPixels,v=i.lineJointRounded,m=i.lineMiterLimit,g=i.lineDashJustified,y=i.getElevation,_=i.getFillColor,b=i.getLineColor,x=i.getLineWidth,A=this.props,S=A.updateTriggers,P=A.material,O=A.transitions,C=this.getSubLayerClass("cell",qi);return new C({filled:u,wireframe:s,extruded:o,elevationScale:a,stroked:l,lineWidthUnits:f,lineWidthScale:c,lineWidthMinPixels:p,lineWidthMaxPixels:d,lineJointRounded:v,lineMiterLimit:m,lineDashJustified:g,material:P,transitions:O,getElevation:y,getFillColor:_,getLineColor:b,getLineWidth:x},this.getSubLayerProps({id:"cell",updateTriggers:S&&{getElevation:S.getElevation,getFillColor:S.getFillColor,getLineColor:S.getLineColor,getLineWidth:S.getLineWidth}}),this.indexToBounds())}}]),e}(Ot);(0,c0.default)(Dn,"layerName","GeoCellLayer");(0,c0.default)(Dn,"defaultProps",FOe);var cO=h(me()),p0=h(fO()),DOe=3,NOe=30,jOe=2*NOe+1,Zq=180/Math.PI;function Qq(t,r,e){var n=1<<r;return[(t[0]+e[0])/n,(t[1]+e[1])/n]}function Jq(t){return t>=.5?1/3*(4*t*t-1):1/3*(1-4*(1-t)*(1-t))}function eY(t){return[Jq(t[0]),Jq(t[1])]}function tY(t,r){var e=(0,cO.default)(r,2),n=e[0],i=e[1];switch(t){case 0:return[1,n,i];case 1:return[-n,1,i];case 2:return[-n,-i,1];case 3:return[-1,-i,-n];case 4:return[i,-1,-n];case 5:return[i,n,-1];default:throw new Error("Invalid face")}}function rY(t){var r=(0,cO.default)(t,3),e=r[0],n=r[1],i=r[2],a=Math.atan2(i,Math.sqrt(e*e+n*n)),o=Math.atan2(n,e);return[o*Zq,a*Zq]}function nY(t){for(var r=p0.default.fromString(t,!0,10).toString(2);r.length<DOe+jOe;)r="0"+r;for(var e=r.lastIndexOf("1"),n=r.substring(0,3),i=r.substring(3,e),a=i.length/2,o=p0.default.fromString(n,!0,2).toString(10),s=p0.default.fromString(i,!0,2).toString(4);s.length<a;)s="0"+s;return"".concat(o,"/").concat(s)}function UOe(t,r,e,n){if(n===0){e===1&&(r[0]=t-1-r[0],r[1]=t-1-r[1]);var i=r[0];r[0]=r[1],r[1]=i}}function iY(t){for(var r=t.split("/"),e=parseInt(r[0],10),n=r[1],i=n.length,a=[0,0],o,s=i-1;s>=0;s--){o=i-s;var u=n[s],l=0,f=0;u==="1"?f=1:u==="2"?(l=1,f=1):u==="3"&&(l=1);var c=Math.pow(2,o-1);UOe(c,a,l,f),a[0]+=c*l,a[1]+=c*f}if(e%2===1){var p=a[0];a[0]=a[1],a[1]=p}return{face:e,ij:a,level:o}}var aY=h(fO());function GOe(t){var r=t.padEnd(16,"0");return aY.default.fromString(r,16)}var zOe=100;function VOe(t){for(var r=t.face,e=t.ij,n=t.level,i=[[0,0],[0,1],[1,1],[1,0],[0,0]],a=Math.max(1,Math.ceil(zOe*Math.pow(2,-n))),o=new Float64Array(4*a*2+2),s=0,u=0,l=0;l<4;l++)for(var f=i[l].slice(0),c=i[l+1],p=(c[0]-f[0])/a,d=(c[1]-f[1])/a,v=0;v<a;v++){f[0]+=p,f[1]+=d;var m=Qq(e,n,f),g=eY(m),y=tY(r,g),_=rY(y);Math.abs(_[1])>89.999&&(_[0]=u);var b=_[0]-u;_[0]+=b>180?-360:b<-180?360:0,o[s++]=_[0],o[s++]=_[1],u=_[0]}return o[s++]=o[0],o[s++]=o[1],o}function HOe(t){if(typeof t=="string"){if(t.indexOf("/")>0)return t;t=GOe(t)}return nY(t.toString())}function oY(t){var r=HOe(t),e=iY(r);return VOe(e)}function WOe(t){var r=$Oe();return function(){var n=(0,pO.default)(t),i;if(r){var a=(0,pO.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,fY.default)(this,i)}}function $Oe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var XOe={getS2Token:{type:"accessor",value:function(r){return r.token}}},h0=function(t){(0,lY.default)(e,t);var r=WOe(e);function e(){return(0,sY.default)(this,e),r.apply(this,arguments)}return(0,uY.default)(e,[{key:"indexToBounds",value:function(){var i=this.props,a=i.data,o=i.getS2Token;return{data:a,_normalize:!1,positionFormat:"XY",getPolygon:function(u,l){return oY(o(u,l))}}}}]),e}(Dn);(0,hO.default)(h0,"layerName","S2Layer");(0,hO.default)(h0,"defaultProps",XOe);var pY=h(L()),hY=h(N()),dY=h(Y()),vY=h(K()),vO=h(q()),mO=h(B());var d0=h(me());var dO=512;function qOe(t){for(var r=0,e=0,n=1<<t.length,i=n/dO,a=0;a<t.length;a++){n>>=1;var o=parseInt(t[a]);o%2&&(r|=n),o>1&&(e|=n)}return[[r/i,dO-e/i],[(r+.99)/i,dO-(e+.99)/i]]}function cY(t){var r=qOe(t),e=(0,d0.default)(r,2),n=e[0],i=e[1],a=er(n),o=(0,d0.default)(a,2),s=o[0],u=o[1],l=er(i),f=(0,d0.default)(l,2),c=f[0],p=f[1];return[c,u,c,p,s,p,s,u,c,u]}function YOe(t){var r=KOe();return function(){var n=(0,vO.default)(t),i;if(r){var a=(0,vO.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,vY.default)(this,i)}}function KOe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ZOe={getQuadkey:{type:"accessor",value:function(r){return r.quadkey}}},v0=function(t){(0,dY.default)(e,t);var r=YOe(e);function e(){return(0,pY.default)(this,e),r.apply(this,arguments)}return(0,hY.default)(e,[{key:"indexToBounds",value:function(){var i=this.props,a=i.data,o=i.getQuadkey;return{data:a,_normalize:!1,positionFormat:"XY",getPolygon:function(u,l){return cY(o(u,l))}}}}]),e}(Dn);(0,mO.default)(v0,"layerName","QuadkeyLayer");(0,mO.default)(v0,"defaultProps",ZOe);var KY=h(L()),ZY=h(N()),JY=h(Y()),QY=h(K()),DO=h(q()),T0=h(B());var kO=h(me()),WY=h(L()),$Y=h(N()),Kt=h(B());var mY=h(ye()),gY=h(L()),yY=h(N()),rr=h(B()),gO=h(ve()),nd=function(){function t(r){(0,gY.default)(this,t),(0,rr.default)(this,"index",void 0),(0,rr.default)(this,"isVisible",void 0),(0,rr.default)(this,"isSelected",void 0),(0,rr.default)(this,"parent",void 0),(0,rr.default)(this,"children",void 0),(0,rr.default)(this,"content",void 0),(0,rr.default)(this,"state",void 0),(0,rr.default)(this,"layers",void 0),(0,rr.default)(this,"id",void 0),(0,rr.default)(this,"zoom",void 0),(0,rr.default)(this,"userData",void 0),(0,rr.default)(this,"boundingBox",void 0),(0,rr.default)(this,"_abortController",void 0),(0,rr.default)(this,"_loader",void 0),(0,rr.default)(this,"_loaderId",void 0),(0,rr.default)(this,"_isLoaded",void 0),(0,rr.default)(this,"_isCancelled",void 0),(0,rr.default)(this,"_needsReload",void 0),(0,rr.default)(this,"_bbox",void 0),this.index=r,this.isVisible=!1,this.isSelected=!1,this.parent=null,this.children=[],this.content=null,this._loader=void 0,this._abortController=null,this._loaderId=0,this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1}return(0,yY.default)(t,[{key:"bbox",get:function(){return this._bbox},set:function(e){this._bbox||(this._bbox=e,"west"in e?this.boundingBox=[[e.west,e.south],[e.east,e.north]]:this.boundingBox=[[e.left,e.top],[e.right,e.bottom]])}},{key:"data",get:function(){var e=this;return this.isLoading&&this._loader?this._loader.then(function(){return e.data}):this.content}},{key:"isLoaded",get:function(){return this._isLoaded&&!this._needsReload}},{key:"isLoading",get:function(){return Boolean(this._loader)&&!this._isCancelled}},{key:"needsReload",get:function(){return this._needsReload||this._isCancelled}},{key:"byteLength",get:function(){var e=this.content?this.content.byteLength:0;return Number.isFinite(e)||console.error("byteLength not defined in tile data"),e}},{key:"_loadData",value:function(){var r=(0,mY.default)(gO.default.mark(function n(i){var a,o,s,u,l,f,c,p,d,v,m,g,y,_;return gO.default.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return a=i.getData,o=i.requestScheduler,s=i.onLoad,u=i.onError,l=this.index,f=this.id,c=this.bbox,p=this.userData,d=this.zoom,v=this._loaderId,this._abortController=new AbortController,m=this._abortController.signal,x.next=7,o.scheduleRequest(this,function(A){return A.isSelected?1:-1});case 7:if(g=x.sent,g){x.next=11;break}return this._isCancelled=!0,x.abrupt("return");case 11:if(!this._isCancelled){x.next=14;break}return g.done(),x.abrupt("return");case 14:return y=null,x.prev=15,x.next=18,a({index:l,id:f,bbox:c,userData:p,zoom:d,signal:m});case 18:y=x.sent,x.next=24;break;case 21:x.prev=21,x.t0=x.catch(15),_=x.t0||!0;case 24:return x.prev=24,g.done(),x.finish(24);case 27:if(v===this._loaderId){x.next=29;break}return x.abrupt("return");case 29:if(this._loader=void 0,this.content=y,!(this._isCancelled&&!y)){x.next=34;break}return this._isLoaded=!1,x.abrupt("return");case 34:this._isLoaded=!0,this._isCancelled=!1,_?u(_,this):s(this);case 37:case"end":return x.stop()}},n,this,[[15,21,24,27]])}));function e(n){return r.apply(this,arguments)}return e}()},{key:"loadData",value:function(e){return this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1,this._loaderId++,this._loader=this._loadData(e),this._loader}},{key:"setNeedsReload",value:function(){this.isLoading&&(this.abort(),this._loader=void 0),this._needsReload=!0}},{key:"abort",value:function(){var e;this.isLoaded||(this._isCancelled=!0,(e=this._abortController)===null||e===void 0||e.abort())}}]),t}();var lu=h(me()),od=h(Zt());var OO=h(me()),RY=h(L()),LY=h(N()),uu=h(B());var qt={OUTSIDE:-1,INTERSECTING:0,INSIDE:1};function Vr(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function _Y(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Hr(t,r,e){return r&&_Y(t.prototype,r),e&&_Y(t,e),t}function Pe(t,r,e){return r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e,t}var bY=new j,JOe=new j,m0=function(){function t(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,0],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0],n=arguments.length>2?arguments[2]:void 0;Vr(this,t),Pe(this,"center",void 0),Pe(this,"halfDiagonal",void 0),Pe(this,"minimum",void 0),Pe(this,"maximum",void 0),n=n||bY.copy(r).add(e).scale(.5),this.center=new j(n),this.halfDiagonal=new j(e).subtract(this.center),this.minimum=new j(r),this.maximum=new j(e)}return Hr(t,[{key:"clone",value:function(){return new t(this.minimum,this.maximum,this.center)}},{key:"equals",value:function(e){return this===e||Boolean(e)&&this.minimum.equals(e.minimum)&&this.maximum.equals(e.maximum)}},{key:"transform",value:function(e){return this.center.transformAsPoint(e),this.halfDiagonal.transform(e),this.minimum.transform(e),this.maximum.transform(e),this}},{key:"intersectPlane",value:function(e){var n=this.halfDiagonal,i=JOe.from(e.normal),a=n.x*Math.abs(i.x)+n.y*Math.abs(i.y)+n.z*Math.abs(i.z),o=this.center.dot(i)+e.distance;return o-a>0?qt.INSIDE:o+a<0?qt.OUTSIDE:qt.INTERSECTING}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceSquaredTo(e))}},{key:"distanceSquaredTo",value:function(e){var n=bY.from(e).subtract(this.center),i=this.halfDiagonal,a=0,o;return o=Math.abs(n.x)-i.x,o>0&&(a+=o*o),o=Math.abs(n.y)-i.y,o>0&&(a+=o*o),o=Math.abs(n.z)-i.z,o>0&&(a+=o*o),a}}]),t}();var id=new j,xY=new j,Do=function(){function t(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,0],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;Vr(this,t),Pe(this,"center",void 0),Pe(this,"radius",void 0),this.radius=-0,this.center=new j,this.fromCenterRadius(r,e)}return Hr(t,[{key:"fromCenterRadius",value:function(e,n){return this.center.from(e),this.radius=n,this}},{key:"fromCornerPoints",value:function(e,n){return n=id.from(n),this.center=new j().from(e).add(n).scale(.5),this.radius=this.center.distance(n),this}},{key:"equals",value:function(e){return this===e||Boolean(e)&&this.center.equals(e.center)&&this.radius===e.radius}},{key:"clone",value:function(){return new t(this.center,this.radius)}},{key:"union",value:function(e){var n=this.center,i=this.radius,a=e.center,o=e.radius,s=id.copy(a).subtract(n),u=s.magnitude();if(i>=u+o)return this.clone();if(o>=u+i)return e.clone();var l=(i+u+o)*.5;return xY.copy(s).scale((-i+l)/u).add(n),this.center.copy(xY),this.radius=l,this}},{key:"expand",value:function(e){var n=id.from(e),i=n.subtract(this.center).magnitude();return i>this.radius&&(this.radius=i),this}},{key:"transform",value:function(e){this.center.transform(e);var n=cN(id,e);return this.radius=Math.max(n[0],Math.max(n[1],n[2]))*this.radius,this}},{key:"distanceSquaredTo",value:function(e){var n=this.distanceTo(e);return n*n}},{key:"distanceTo",value:function(e){var n=id.from(e),i=n.subtract(this.center);return Math.max(0,i.len()-this.radius)}},{key:"intersectPlane",value:function(e){var n=this.center,i=this.radius,a=e.normal,o=a.dot(n)+e.distance;return o<-i?qt.OUTSIDE:o<i?qt.INTERSECTING:qt.INSIDE}}]),t}();function _f(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function yO(t){if(Array.isArray(t))return _f(t)}function _O(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function bO(t,r){if(t){if(typeof t=="string")return _f(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return _f(t,r)}}function xO(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function No(t){return yO(t)||_O(t)||bO(t)||xO()}var QOe=new j,eEe=new j,g0=new j,y0=new j,_0=new j,tEe=new j,rEe=new j,Fa={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8},su=function(){function t(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,0],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0,0,0,0,0,0,0];Vr(this,t),Pe(this,"center",void 0),Pe(this,"halfAxes",void 0),this.center=new j().from(r),this.halfAxes=new ct(e)}return Hr(t,[{key:"halfSize",get:function(){var e=this.halfAxes.getColumn(0),n=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2);return[new j(e).len(),new j(n).len(),new j(i).len()]}},{key:"quaternion",get:function(){var e=this.halfAxes.getColumn(0),n=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2),a=new j(e).normalize(),o=new j(n).normalize(),s=new j(i).normalize();return new Bi().fromMatrix3(new ct([].concat(No(a),No(o),No(s))))}},{key:"fromCenterHalfSizeQuaternion",value:function(e,n,i){var a=new Bi(i),o=new ct().fromQuaternion(a);return o[0]=o[0]*n[0],o[1]=o[1]*n[0],o[2]=o[2]*n[0],o[3]=o[3]*n[1],o[4]=o[4]*n[1],o[5]=o[5]*n[1],o[6]=o[6]*n[2],o[7]=o[7]*n[2],o[8]=o[8]*n[2],this.center=new j().from(e),this.halfAxes=o,this}},{key:"clone",value:function(){return new t(this.center,this.halfAxes)}},{key:"equals",value:function(e){return this===e||Boolean(e)&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}},{key:"getBoundingSphere",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:new Do,n=this.halfAxes,i=n.getColumn(0,g0),a=n.getColumn(1,y0),o=n.getColumn(2,_0),s=QOe.copy(i).add(a).add(o);return e.center.copy(this.center),e.radius=s.magnitude(),e}},{key:"intersectPlane",value:function(e){var n=this.center,i=e.normal,a=this.halfAxes,o=i.x,s=i.y,u=i.z,l=Math.abs(o*a[Fa.COLUMN0ROW0]+s*a[Fa.COLUMN0ROW1]+u*a[Fa.COLUMN0ROW2])+Math.abs(o*a[Fa.COLUMN1ROW0]+s*a[Fa.COLUMN1ROW1]+u*a[Fa.COLUMN1ROW2])+Math.abs(o*a[Fa.COLUMN2ROW0]+s*a[Fa.COLUMN2ROW1]+u*a[Fa.COLUMN2ROW2]),f=i.dot(n)+e.distance;return f<=-l?qt.OUTSIDE:f>=l?qt.INSIDE:qt.INTERSECTING}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceSquaredTo(e))}},{key:"distanceSquaredTo",value:function(e){var n=eEe.from(e).subtract(this.center),i=this.halfAxes,a=i.getColumn(0,g0),o=i.getColumn(1,y0),s=i.getColumn(2,_0),u=a.magnitude(),l=o.magnitude(),f=s.magnitude();a.normalize(),o.normalize(),s.normalize();var c=0,p;return p=Math.abs(n.dot(a))-u,p>0&&(c+=p*p),p=Math.abs(n.dot(o))-l,p>0&&(c+=p*p),p=Math.abs(n.dot(s))-f,p>0&&(c+=p*p),c}},{key:"computePlaneDistances",value:function(e,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[-0,-0],a=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,s=this.center,u=this.halfAxes,l=u.getColumn(0,g0),f=u.getColumn(1,y0),c=u.getColumn(2,_0),p=tEe.copy(l).add(f).add(c).add(s),d=rEe.copy(p).subtract(e),v=n.dot(d);return a=Math.min(v,a),o=Math.max(v,o),p.copy(s).add(l).add(f).subtract(c),d.copy(p).subtract(e),v=n.dot(d),a=Math.min(v,a),o=Math.max(v,o),p.copy(s).add(l).subtract(f).add(c),d.copy(p).subtract(e),v=n.dot(d),a=Math.min(v,a),o=Math.max(v,o),p.copy(s).add(l).subtract(f).subtract(c),d.copy(p).subtract(e),v=n.dot(d),a=Math.min(v,a),o=Math.max(v,o),s.copy(p).subtract(l).add(f).add(c),d.copy(p).subtract(e),v=n.dot(d),a=Math.min(v,a),o=Math.max(v,o),s.copy(p).subtract(l).add(f).subtract(c),d.copy(p).subtract(e),v=n.dot(d),a=Math.min(v,a),o=Math.max(v,o),s.copy(p).subtract(l).subtract(f).add(c),d.copy(p).subtract(e),v=n.dot(d),a=Math.min(v,a),o=Math.max(v,o),s.copy(p).subtract(l).subtract(f).subtract(c),d.copy(p).subtract(e),v=n.dot(d),a=Math.min(v,a),o=Math.max(v,o),i[0]=a,i[1]=o,i}},{key:"transform",value:function(e){this.center.transformAsPoint(e);var n=this.halfAxes.getColumn(0,g0);n.transformAsPoint(e);var i=this.halfAxes.getColumn(1,y0);i.transformAsPoint(e);var a=this.halfAxes.getColumn(2,_0);return a.transformAsPoint(e),this.halfAxes=new ct([].concat(No(n),No(i),No(a))),this}},{key:"getTransform",value:function(){throw new Error("not implemented")}}]),t}();var AY=new j,SY=new j,Yt=function(){function t(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,1],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;Vr(this,t),Pe(this,"normal",void 0),Pe(this,"distance",void 0),this.normal=new j,this.distance=-0,this.fromNormalDistance(r,e)}return Hr(t,[{key:"fromNormalDistance",value:function(e,n){return Ke(Number.isFinite(n)),this.normal.from(e).normalize(),this.distance=n,this}},{key:"fromPointNormal",value:function(e,n){e=AY.from(e),this.normal.from(n).normalize();var i=-this.normal.dot(e);return this.distance=i,this}},{key:"fromCoefficients",value:function(e,n,i,a){return this.normal.set(e,n,i),Ke(tt(this.normal.len(),1)),this.distance=a,this}},{key:"clone",value:function(){return new t(this.normal,this.distance)}},{key:"equals",value:function(e){return tt(this.distance,e.distance)&&tt(this.normal,e.normal)}},{key:"getPointDistance",value:function(e){return this.normal.dot(e)+this.distance}},{key:"transform",value:function(e){var n=SY.copy(this.normal).transformAsVector(e).normalize(),i=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(i,n)}},{key:"projectPointOntoPlane",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];e=AY.from(e);var i=this.getPointDistance(e),a=SY.copy(this.normal).scale(i);return e.subtract(a).to(n)}}]),t}();function TY(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=nEe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function nEe(t,r){if(t){if(typeof t=="string")return wY(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return wY(t,r)}}function wY(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var PY=[new j([1,0,0]),new j([0,1,0]),new j([0,0,1])],OY=new j,iEe=new j,Vlt=new Yt(new j(1,0,0),0),en=function(){function t(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];Vr(this,t),Pe(this,"planes",void 0),this.planes=r}return Hr(t,[{key:"fromBoundingSphere",value:function(e){this.planes.length=2*PY.length;var n=e.center,i=e.radius,a=0,o=TY(PY),s;try{for(o.s();!(s=o.n()).done;){var u=s.value,l=this.planes[a],f=this.planes[a+1];l||(l=this.planes[a]=new Yt),f||(f=this.planes[a+1]=new Yt);var c=OY.copy(u).scale(-i).add(n),p=-u.dot(c);l.fromPointNormal(c,u);var d=OY.copy(u).scale(i).add(n),v=iEe.copy(u).negate(),m=-v.dot(d);f.fromPointNormal(d,v),a+=2}}catch(g){o.e(g)}finally{o.f()}return this}},{key:"computeVisibility",value:function(e){var n=qt.INSIDE,i=TY(this.planes),a;try{for(i.s();!(a=i.n()).done;){var o=a.value,s=e.intersectPlane(o);switch(s){case qt.OUTSIDE:return qt.OUTSIDE;case qt.INTERSECTING:n=qt.INTERSECTING;break;default:}}}catch(u){i.e(u)}finally{i.f()}return n}},{key:"computeVisibilityWithPlaneMask",value:function(e,n){if(Ke(Number.isFinite(n),"parentPlaneMask is required."),n===t.MASK_OUTSIDE||n===t.MASK_INSIDE)return n;for(var i=t.MASK_INSIDE,a=this.planes,o=0;o<this.planes.length;++o){var s=o<31?1<<o:0;if(!(o<31&&!(n&s))){var u=a[o],l=e.intersectPlane(u);if(l===qt.OUTSIDE)return t.MASK_OUTSIDE;l===qt.INTERSECTING&&(i|=s)}}return i}}]),t}();Pe(en,"MASK_OUTSIDE",4294967295);Pe(en,"MASK_INSIDE",0);Pe(en,"MASK_INDETERMINATE",2147483647);var aEe=new j,oEe=new j,sEe=new j,uEe=new j,lEe=new j,AO=function(){function t(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Vr(this,t),Pe(this,"left",void 0),Pe(this,"_left",void 0),Pe(this,"right",void 0),Pe(this,"_right",void 0),Pe(this,"top",void 0),Pe(this,"_top",void 0),Pe(this,"bottom",void 0),Pe(this,"_bottom",void 0),Pe(this,"near",void 0),Pe(this,"_near",void 0),Pe(this,"far",void 0),Pe(this,"_far",void 0),Pe(this,"_cullingVolume",new en([new Yt,new Yt,new Yt,new Yt,new Yt,new Yt])),Pe(this,"_perspectiveMatrix",new pe),Pe(this,"_infinitePerspective",new pe);var e=r.near,n=e===void 0?1:e,i=r.far,a=i===void 0?5e8:i;this.left=r.left,this._left=void 0,this.right=r.right,this._right=void 0,this.top=r.top,this._top=void 0,this.bottom=r.bottom,this._bottom=void 0,this.near=n,this._near=n,this.far=a,this._far=a}return Hr(t,[{key:"clone",value:function(){return new t({right:this.right,left:this.left,top:this.top,bottom:this.bottom,near:this.near,far:this.far})}},{key:"equals",value:function(e){return e&&e instanceof t&&this.right===e.right&&this.left===e.left&&this.top===e.top&&this.bottom===e.bottom&&this.near===e.near&&this.far===e.far}},{key:"projectionMatrix",get:function(){return this._update(),this._perspectiveMatrix}},{key:"infiniteProjectionMatrix",get:function(){return this._update(),this._infinitePerspective}},{key:"computeCullingVolume",value:function(e,n,i){Ke(e,"position is required."),Ke(n,"direction is required."),Ke(i,"up is required.");var a=this._cullingVolume.planes;i=aEe.copy(i).normalize();var o=oEe.copy(n).cross(i).normalize(),s=sEe.copy(n).multiplyByScalar(this.near).add(e),u=uEe.copy(n).multiplyByScalar(this.far).add(e),l=lEe;return l.copy(o).multiplyByScalar(this.left).add(s).subtract(e).cross(i),a[0].fromPointNormal(e,l),l.copy(o).multiplyByScalar(this.right).add(s).subtract(e).cross(i).negate(),a[1].fromPointNormal(e,l),l.copy(i).multiplyByScalar(this.bottom).add(s).subtract(e).cross(o).negate(),a[2].fromPointNormal(e,l),l.copy(i).multiplyByScalar(this.top).add(s).subtract(e).cross(o),a[3].fromPointNormal(e,l),l=new j().copy(n),a[4].fromPointNormal(s,l),l.negate(),a[5].fromPointNormal(u,l),this._cullingVolume}},{key:"getPixelDimensions",value:function(e,n,i,a){this._update(),Ke(Number.isFinite(e)&&Number.isFinite(n)),Ke(e>0),Ke(n>0),Ke(i>0),Ke(a);var o=1/this.near,s=this.top*o,u=2*i*s/n;s=this.right*o;var l=2*i*s/e;return a.x=l,a.y=u,a}},{key:"_update",value:function(){Ke(Number.isFinite(this.right)&&Number.isFinite(this.left)&&Number.isFinite(this.top)&&Number.isFinite(this.bottom)&&Number.isFinite(this.near)&&Number.isFinite(this.far));var e=this.top,n=this.bottom,i=this.right,a=this.left,o=this.near,s=this.far;(e!==this._top||n!==this._bottom||a!==this._left||i!==this._right||o!==this._near||s!==this._far)&&(Ke(this.near>0&&this.near<this.far,"near must be greater than zero and less than far."),this._left=a,this._right=i,this._top=e,this._bottom=n,this._near=o,this._far=s,this._perspectiveMatrix=new pe().frustum({left:a,right:i,bottom:n,top:e,near:o,far:s}),this._infinitePerspective=new pe().frustum({left:a,right:i,bottom:n,top:e,near:o,far:1/0}))}}]),t}();var fEe=function(r){return r!==null&&typeof r<"u"},cEe=function(){function t(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Vr(this,t),Pe(this,"_offCenterFrustum",new AO),Pe(this,"fov",void 0),Pe(this,"_fov",void 0),Pe(this,"_fovy",void 0),Pe(this,"_sseDenominator",void 0),Pe(this,"aspectRatio",void 0),Pe(this,"_aspectRatio",void 0),Pe(this,"near",void 0),Pe(this,"_near",void 0),Pe(this,"far",void 0),Pe(this,"_far",void 0),Pe(this,"xOffset",void 0),Pe(this,"_xOffset",void 0),Pe(this,"yOffset",void 0),Pe(this,"_yOffset",void 0);var e=r.fov,n=r.aspectRatio,i=r.near,a=i===void 0?1:i,o=r.far,s=o===void 0?5e8:o,u=r.xOffset,l=u===void 0?0:u,f=r.yOffset,c=f===void 0?0:f;this.fov=e,this.aspectRatio=n,this.near=a,this.far=s,this.xOffset=l,this.yOffset=c}return Hr(t,[{key:"clone",value:function(){return new t({aspectRatio:this.aspectRatio,fov:this.fov,near:this.near,far:this.far})}},{key:"equals",value:function(e){return!fEe(e)||!(e instanceof t)?!1:(this._update(),e._update(),this.fov===e.fov&&this.aspectRatio===e.aspectRatio&&this.near===e.near&&this.far===e.far&&this._offCenterFrustum.equals(e._offCenterFrustum))}},{key:"projectionMatrix",get:function(){return this._update(),this._offCenterFrustum.projectionMatrix}},{key:"infiniteProjectionMatrix",get:function(){return this._update(),this._offCenterFrustum.infiniteProjectionMatrix}},{key:"fovy",get:function(){return this._update(),this._fovy}},{key:"sseDenominator",get:function(){return this._update(),this._sseDenominator}},{key:"computeCullingVolume",value:function(e,n,i){return this._update(),this._offCenterFrustum.computeCullingVolume(e,n,i)}},{key:"getPixelDimensions",value:function(e,n,i,a){return this._update(),this._offCenterFrustum.getPixelDimensions(e,n,i,a||new ri)}},{key:"_update",value:function(){Ke(Number.isFinite(this.fov)&&Number.isFinite(this.aspectRatio)&&Number.isFinite(this.near)&&Number.isFinite(this.far));var e=this._offCenterFrustum;(this.fov!==this._fov||this.aspectRatio!==this._aspectRatio||this.near!==this._near||this.far!==this._far||this.xOffset!==this._xOffset||this.yOffset!==this._yOffset)&&(Ke(this.fov>=0&&this.fov<Math.PI),Ke(this.aspectRatio>0),Ke(this.near>=0&&this.near<this.far),this._aspectRatio=this.aspectRatio,this._fov=this.fov,this._fovy=this.aspectRatio<=1?this.fov:Math.atan(Math.tan(this.fov*.5)/this.aspectRatio)*2,this._near=this.near,this._far=this.far,this._sseDenominator=2*Math.tan(.5*this._fovy),this._xOffset=this.xOffset,this._yOffset=this.yOffset,e.top=this.near*Math.tan(.5*this._fovy),e.bottom=-e.top,e.right=this.aspectRatio*e.top,e.left=-e.right,e.near=this.near,e.far=this.far,e.right+=this.xOffset,e.left+=this.xOffset,e.top+=this.yOffset,e.bottom+=this.yOffset)}}]),t}();var oft=new j,sft=new j,uft=new j,lft=new j,fft=new j,cft=new j,pft=new j,hft=new j,dft=new j,vft=new j,mft=new j,gft=new j,yft=4/3*Math.PI;var Ji=new ct,pEe=new ct,hEe=new ct,b0=new ct,EY=new ct;function x0(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=Fi.EPSILON20,n=10,i=0,a=0,o=pEe,s=hEe;o.identity(),s.copy(t);for(var u=e*dEe(s);a<n&&vEe(s)>u;)mEe(s,b0),EY.copy(b0).transpose(),s.multiplyRight(b0),s.multiplyLeft(EY),o.multiplyRight(b0),++i>2&&(++a,i=0);return r.unitary=o.toTarget(r.unitary),r.diagonal=s.toTarget(r.diagonal),r}function dEe(t){for(var r=0,e=0;e<9;++e){var n=t[e];r+=n*n}return Math.sqrt(r)}var SO=[1,0,0],TO=[2,2,1];function vEe(t){for(var r=0,e=0;e<3;++e){var n=t[Ji.getElementIndex(TO[e],SO[e])];r+=2*n*n}return Math.sqrt(r)}function mEe(t,r){for(var e=Fi.EPSILON15,n=0,i=1,a=0;a<3;++a){var o=Math.abs(t[Ji.getElementIndex(TO[a],SO[a])]);o>n&&(i=a,n=o)}var s=SO[i],u=TO[i],l=1,f=0;if(Math.abs(t[Ji.getElementIndex(u,s)])>e){var c=t[Ji.getElementIndex(u,u)],p=t[Ji.getElementIndex(s,s)],d=t[Ji.getElementIndex(u,s)],v=(c-p)/2/d,m;v<0?m=-1/(-v+Math.sqrt(1+v*v)):m=1/(v+Math.sqrt(1+v*v)),l=1/Math.sqrt(1+m*m),f=m*l}return ct.IDENTITY.to(r),r[Ji.getElementIndex(s,s)]=r[Ji.getElementIndex(u,u)]=l,r[Ji.getElementIndex(u,s)]=f,r[Ji.getElementIndex(s,u)]=-f,r}function wO(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=gEe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function gEe(t,r){if(t){if(typeof t=="string")return CY(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return CY(t,r)}}function CY(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var jo=new j,yEe=new j,_Ee=new j,bEe=new j,xEe=new j,AEe=new ct,SEe={diagonal:new ct,unitary:new ct};function ad(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new su;if(!t||t.length===0)return r.halfAxes=new ct([0,0,0,0,0,0,0,0,0]),r.center=new j,r;var e=t.length,n=new j(0,0,0),i=wO(t),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;n.add(o)}}catch(Q){i.e(Q)}finally{i.f()}var s=1/e;n.multiplyByScalar(s);var u=0,l=0,f=0,c=0,p=0,d=0,v=wO(t),m;try{for(v.s();!(m=v.n()).done;){var g=m.value,y=jo.copy(g).subtract(n);u+=y.x*y.x,l+=y.x*y.y,f+=y.x*y.z,c+=y.y*y.y,p+=y.y*y.z,d+=y.z*y.z}}catch(Q){v.e(Q)}finally{v.f()}u*=s,l*=s,f*=s,c*=s,p*=s,d*=s;var _=AEe;_[0]=u,_[1]=l,_[2]=f,_[3]=l,_[4]=c,_[5]=p,_[6]=f,_[7]=p,_[8]=d;var b=x0(_,SEe),x=b.unitary,A=r.halfAxes.copy(x),S=A.getColumn(0,_Ee),P=A.getColumn(1,bEe),O=A.getColumn(2,xEe),C=-Number.MAX_VALUE,T=-Number.MAX_VALUE,I=-Number.MAX_VALUE,R=Number.MAX_VALUE,V=Number.MAX_VALUE,z=Number.MAX_VALUE,k=wO(t),G;try{for(k.s();!(G=k.n()).done;){var U=G.value;jo.copy(U),C=Math.max(jo.dot(S),C),T=Math.max(jo.dot(P),T),I=Math.max(jo.dot(O),I),R=Math.min(jo.dot(S),R),V=Math.min(jo.dot(P),V),z=Math.min(jo.dot(O),z)}}catch(Q){k.e(Q)}finally{k.f()}S=S.multiplyByScalar(.5*(R+C)),P=P.multiplyByScalar(.5*(V+T)),O=O.multiplyByScalar(.5*(z+I)),r.center.copy(S).add(P).add(O);var $=yEe.set(C-R,T-V,I-z).multiplyByScalar(.5),H=new ct([$[0],0,0,0,$[1],0,0,0,$[2]]);return r.halfAxes.multiplyRight(H),r}function PO(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=TEe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function TEe(t,r){if(t){if(typeof t=="string")return MY(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return MY(t,r)}}function MY(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var bf=512,IY=3,kY=[[.5,.5],[0,0],[0,1],[1,0],[1,1]],BY=kY.concat([[0,.5],[.5,0],[1,.5],[.5,1]]),wEe=BY.concat([[.25,.5],[.75,.5]]),PEe=function(){function t(r,e,n){(0,RY.default)(this,t),(0,uu.default)(this,"x",void 0),(0,uu.default)(this,"y",void 0),(0,uu.default)(this,"z",void 0),(0,uu.default)(this,"childVisible",void 0),(0,uu.default)(this,"selected",void 0),(0,uu.default)(this,"_children",void 0),this.x=r,this.y=e,this.z=n}return(0,LY.default)(t,[{key:"children",get:function(){if(!this._children){var e=this.x*2,n=this.y*2,i=this.z+1;this._children=[new t(e,n,i),new t(e,n+1,i),new t(e+1,n,i),new t(e+1,n+1,i)]}return this._children}},{key:"update",value:function(e){var n=e.viewport,i=e.cullingVolume,a=e.elevationBounds,o=e.minZ,s=e.maxZ,u=e.bounds,l=e.offset,f=e.project,c=this.getBoundingVolume(a,l,f);if(u&&!this.insideBounds(u))return!1;var p=i.computeVisibility(c);if(p<0)return!1;if(!this.childVisible){var d=this.z;if(d<s&&d>=o){var v=c.distanceTo(n.cameraPosition)*n.scale/n.height;d+=Math.floor(Math.log2(v))}if(d>=s)return this.selected=!0,!0}this.selected=!1,this.childVisible=!0;var m=PO(this.children),g;try{for(m.s();!(g=m.n()).done;){var y=g.value;y.update(e)}}catch(_){m.e(_)}finally{m.f()}return!0}},{key:"getSelected",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];if(this.selected&&e.push(this),this._children){var n=PO(this._children),i;try{for(n.s();!(i=n.n()).done;){var a=i.value;a.getSelected(e)}}catch(o){n.e(o)}finally{n.f()}}return e}},{key:"insideBounds",value:function(e){var n=(0,OO.default)(e,4),i=n[0],a=n[1],o=n[2],s=n[3],u=Math.pow(2,this.z),l=bf/u;return this.x*l<o&&this.y*l<s&&(this.x+1)*l>i&&(this.y+1)*l>a}},{key:"getBoundingVolume",value:function(e,n,i){if(i){var a=this.z<1?wEe:this.z<2?BY:kY,o=[],s=PO(a),u;try{for(s.s();!(u=s.n()).done;){var l=u.value,f=A0(this.x+l[0],this.y+l[1],this.z);f[2]=e[0],o.push(i(f)),e[0]!==e[1]&&(f[2]=e[1],o.push(i(f)))}}catch(m){s.e(m)}finally{s.f()}return ad(o)}var c=Math.pow(2,this.z),p=bf/c,d=this.x*p+n*bf,v=bf-(this.y+1)*p;return new m0([d,v,e[0]],[d+p,v+p,e[1]])}}]),t}();function FY(t,r,e,n){var i=t instanceof Jl&&t.resolution?t.projectPosition:null,a=Object.values(t.getFrustumPlanes()).map(function(A){var S=A.normal,P=A.distance;return new Yt(S.clone().negate(),P)}),o=new en(a),s=t.distanceScales.unitsPerMeter[2],u=e&&e[0]*s||0,l=e&&e[1]*s||0,f=t instanceof Kr&&t.pitch<=60?r:0;if(n){var c=n,p=(0,OO.default)(c,4),d=p[0],v=p[1],m=p[2],g=p[3],y=wt([d,g]),_=wt([m,v]);n=[y[0],bf-y[1],_[0],bf-_[1]]}var b=new PEe(0,0,0),x={viewport:t,project:i,cullingVolume:o,elevationBounds:[u,l],minZ:f,maxZ:r,bounds:n,offset:0};if(b.update(x),t instanceof Kr&&t.subViewports&&t.subViewports.length>1){for(x.offset=-1;b.update(x)&&!(--x.offset<-IY););for(x.offset=1;b.update(x)&&!(++x.offset>IY););}return b.getSelected()}var Da=512,OEe=[-1/0,-1/0,1/0,1/0],Uo={type:"object",value:null,validate:function(r,e){return e.optional&&r===null||typeof r=="string"||Array.isArray(r)&&r.every(function(n){return typeof n=="string"})},equal:function(r,e){if(r===e)return!0;if(!Array.isArray(r)||!Array.isArray(e))return!1;var n=r.length;if(n!==e.length)return!1;for(var i=0;i<n;i++)if(r[i]!==e[i])return!1;return!0}};function NY(t,r){var e=[r.transformAsPoint([t[0],t[1]]),r.transformAsPoint([t[2],t[1]]),r.transformAsPoint([t[0],t[3]]),r.transformAsPoint([t[2],t[3]])],n=[Math.min.apply(Math,(0,od.default)(e.map(function(i){return i[0]}))),Math.min.apply(Math,(0,od.default)(e.map(function(i){return i[1]}))),Math.max.apply(Math,(0,od.default)(e.map(function(i){return i[0]}))),Math.max.apply(Math,(0,od.default)(e.map(function(i){return i[1]})))];return n}function EEe(t){return Math.abs(t.split("").reduce(function(r,e){return(r<<5)-r+e.charCodeAt(0)|0},0))}function Qi(t,r){if(!t||!t.length)return null;var e=r.index,n=r.id;if(Array.isArray(t)){var i=EEe(n)%t.length;t=t[i]}for(var a=t,o=0,s=Object.keys(e);o<s.length;o++){var u=s[o],l=new RegExp("{".concat(u,"}"),"g");a=a.replace(l,String(e[u]))}return Number.isInteger(e.y)&&Number.isInteger(e.z)&&(a=a.replace(/\{-y\}/g,String(Math.pow(2,e.z)-e.y-1))),a}function CEe(t,r,e){var n;if(r&&r.length===2){var i=(0,lu.default)(r,2),a=i[0],o=i[1],s=t.getBounds({z:a}),u=t.getBounds({z:o});n=[Math.min(s[0],u[0]),Math.min(s[1],u[1]),Math.max(s[2],u[2]),Math.max(s[3],u[3])]}else n=t.getBounds();return t.isGeospatial?[Math.max(n[0],e[0]),Math.max(n[1],e[1]),Math.min(n[2],e[2]),Math.min(n[3],e[3])]:[Math.max(Math.min(n[0],e[2]),e[0]),Math.max(Math.min(n[1],e[3]),e[1]),Math.min(Math.max(n[2],e[0]),e[2]),Math.min(Math.max(n[3],e[1]),e[3])]}function jY(t){var r=t.viewport,e=t.z,n=e===void 0?0:e,i=t.cullRect,a=r.subViewports||[r];return a.map(function(o){return EO(o,n,i)})}function EO(t,r,e){if(!Array.isArray(r)){var n=e.x-t.x,i=e.y-t.y,a=e.width,o=e.height,s={targetZ:r},u=t.unproject([n,i],s),l=t.unproject([n+a,i],s),f=t.unproject([n,i+o],s),c=t.unproject([n+a,i+o],s);return[Math.min(u[0],l[0],f[0],c[0]),Math.min(u[1],l[1],f[1],c[1]),Math.max(u[0],l[0],f[0],c[0]),Math.max(u[1],l[1],f[1],c[1])]}var p=EO(t,r[0],e),d=EO(t,r[1],e);return[Math.min(p[0],d[0]),Math.min(p[1],d[1]),Math.max(p[2],d[2]),Math.max(p[3],d[3])]}function MEe(t,r,e){if(e){var n=NY(t,e).map(function(i){return i*r/Da});return n}return t.map(function(i){return i*r/Da})}function CO(t,r){return Math.pow(2,t)*Da/r}function A0(t,r,e){var n=CO(e,Da),i=t/n*360-180,a=Math.PI-2*Math.PI*r/n,o=180/Math.PI*Math.atan(.5*(Math.exp(a)-Math.exp(-a)));return[i,o]}function DY(t,r,e,n){var i=CO(e,n);return[t/i*Da,r/i*Da]}function MO(t,r,e,n){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Da;if(t.isGeospatial){var a=A0(r,e,n),o=(0,lu.default)(a,2),s=o[0],u=o[1],l=A0(r+1,e+1,n),f=(0,lu.default)(l,2),c=f[0],p=f[1];return{west:s,north:u,east:c,south:p}}var d=DY(r,e,n,i),v=(0,lu.default)(d,2),m=v[0],g=v[1],y=DY(r+1,e+1,n,i),_=(0,lu.default)(y,2),b=_[0],x=_[1];return{left:m,top:g,right:b,bottom:x}}function IEe(t,r,e,n,i){for(var a=CEe(t,null,n),o=CO(r,e),s=MEe(a,o,i),u=(0,lu.default)(s,4),l=u[0],f=u[1],c=u[2],p=u[3],d=[],v=Math.floor(l);v<c;v++)for(var m=Math.floor(f);m<p;m++)d.push({x:v,y:m,z:r});return d}function IO(t){var r=t.viewport,e=t.maxZoom,n=t.minZoom,i=t.zRange,a=t.extent,o=t.tileSize,s=o===void 0?Da:o,u=t.modelMatrix,l=t.modelMatrixInverse,f=t.zoomOffset,c=f===void 0?0:f,p=r.isGeospatial?Math.round(r.zoom+Math.log2(Da/s))+c:Math.ceil(r.zoom)+c;if(typeof n=="number"&&Number.isFinite(n)&&p<n){if(!a)return[];p=n}typeof e=="number"&&Number.isFinite(e)&&p>e&&(p=e);var d=a;return u&&l&&a&&!r.isGeospatial&&(d=NY(a,u)),r.isGeospatial?FY(r,p,i,a):IEe(r,p,s,d||OEe,l)}function RO(t){return/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(t)}function LO(t){return Number.isFinite(t.west)&&Number.isFinite(t.north)&&Number.isFinite(t.east)&&Number.isFinite(t.south)}function UY(t){var r={},e;return function(n){for(var i in n)if(!REe(n[i],r[i])){e=t(n),r=n;break}return e}}function REe(t,r){if(t===r)return!0;if(Array.isArray(t)){var e=t.length;if(!r||r.length!==e)return!1;for(var n=0;n<e;n++)if(t[n]!==r[n])return!1;return!0}return!1}var sd;function gr(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=LEe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function LEe(t,r){if(t){if(typeof t=="string")return GY(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return GY(t,r)}}function GY(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function zY(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function VY(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?zY(Object(e),!0).forEach(function(n){(0,Kt.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):zY(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var HY=1,S0=2,kEe="never",BEe="no-overlap",ud="best-available",FEe=5,DEe=(sd={},(0,Kt.default)(sd,ud,jEe),(0,Kt.default)(sd,BEe,UEe),(0,Kt.default)(sd,kEe,function(){}),sd),NEe={extent:null,tileSize:512,maxZoom:null,minZoom:null,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:"best-available",zRange:null,maxRequests:6,zoomOffset:0,onTileLoad:function(){},onTileUnload:function(){},onTileError:function(){}},ld=function(){function t(r){var e=this;(0,WY.default)(this,t),(0,Kt.default)(this,"opts",void 0),(0,Kt.default)(this,"_requestScheduler",void 0),(0,Kt.default)(this,"_cache",void 0),(0,Kt.default)(this,"_dirty",void 0),(0,Kt.default)(this,"_tiles",void 0),(0,Kt.default)(this,"_cacheByteSize",void 0),(0,Kt.default)(this,"_viewport",void 0),(0,Kt.default)(this,"_zRange",void 0),(0,Kt.default)(this,"_selectedTiles",void 0),(0,Kt.default)(this,"_frameNumber",void 0),(0,Kt.default)(this,"_modelMatrix",void 0),(0,Kt.default)(this,"_modelMatrixInverse",void 0),(0,Kt.default)(this,"_maxZoom",void 0),(0,Kt.default)(this,"_minZoom",void 0),(0,Kt.default)(this,"onTileLoad",void 0),(0,Kt.default)(this,"_getCullBounds",UY(jY)),this.opts=VY(VY({},NEe),r),this.onTileLoad=function(n){var i,a;(i=(a=e.opts).onTileLoad)===null||i===void 0||i.call(a,n),e.opts.maxCacheByteSize&&(e._cacheByteSize+=n.byteLength,e._resizeCache())},this._requestScheduler=new Nc({maxRequests:r.maxRequests,throttleRequests:Boolean(r.maxRequests&&r.maxRequests>0)}),this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._selectedTiles=null,this._frameNumber=0,this._modelMatrix=new pe,this._modelMatrixInverse=new pe,this.setOptions(r)}return(0,$Y.default)(t,[{key:"tiles",get:function(){return this._tiles}},{key:"selectedTiles",get:function(){return this._selectedTiles}},{key:"isLoaded",get:function(){return this._selectedTiles!==null&&this._selectedTiles.every(function(e){return e.isLoaded})}},{key:"needsReload",get:function(){return this._selectedTiles!==null&&this._selectedTiles.some(function(e){return e.needsReload})}},{key:"setOptions",value:function(e){Object.assign(this.opts,e),Number.isFinite(e.maxZoom)&&(this._maxZoom=Math.floor(e.maxZoom)),Number.isFinite(e.minZoom)&&(this._minZoom=Math.ceil(e.minZoom))}},{key:"finalize",value:function(){var e=gr(this._cache.values()),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;i.isLoading&&i.abort()}}catch(a){e.e(a)}finally{e.f()}this._cache.clear(),this._tiles=[],this._selectedTiles=null}},{key:"reloadAll",value:function(){var e=gr(this._cache.keys()),n;try{for(e.s();!(n=e.n()).done;){var i=n.value,a=this._cache.get(i);!this._selectedTiles||!this._selectedTiles.includes(a)?this._cache.delete(i):a.setNeedsReload()}}catch(o){e.e(o)}finally{e.f()}}},{key:"update",value:function(e){var n=this,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=i.zRange,o=i.modelMatrix,s=new pe(o),u=!s.equals(this._modelMatrix);if(!this._viewport||!e.equals(this._viewport)||!tt(this._zRange,a)||u){u&&(this._modelMatrixInverse=s.clone().invert(),this._modelMatrix=s),this._viewport=e,this._zRange=a;var l=this.getTileIndices({viewport:e,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:a,modelMatrix:this._modelMatrix,modelMatrixInverse:this._modelMatrixInverse});this._selectedTiles=l.map(function(c){return n._getTile(c,!0)}),this._dirty&&this._rebuildTree()}else this.needsReload&&(this._selectedTiles=this._selectedTiles.map(function(c){return n._getTile(c.index,!0)}));var f=this.updateTileStates();return this._pruneRequests(),this._dirty&&this._resizeCache(),f&&this._frameNumber++,this._frameNumber}},{key:"isTileVisible",value:function(e,n){if(!e.isVisible)return!1;if(n&&this._viewport){var i=this._getCullBounds({viewport:this._viewport,z:this._zRange,cullRect:n}),a=e.bbox,o=gr(i),s;try{for(o.s();!(s=o.n()).done;){var u=(0,kO.default)(s.value,4),l=u[0],f=u[1],c=u[2],p=u[3],d=void 0;if("west"in a)d=a.west<c&&a.east>l&&a.south<p&&a.north>f;else{var v=Math.min(a.top,a.bottom),m=Math.max(a.top,a.bottom);d=a.left<c&&a.right>l&&v<p&&m>f}if(d)return!0}}catch(g){o.e(g)}finally{o.f()}return!1}return!0}},{key:"getTileIndices",value:function(e){var n=e.viewport,i=e.maxZoom,a=e.minZoom,o=e.zRange,s=e.modelMatrix,u=e.modelMatrixInverse,l=this.opts,f=l.tileSize,c=l.extent,p=l.zoomOffset;return IO({viewport:n,maxZoom:i,minZoom:a,zRange:o,tileSize:f,extent:c,modelMatrix:s,modelMatrixInverse:u,zoomOffset:p})}},{key:"getTileId",value:function(e){return"".concat(e.x,"-").concat(e.y,"-").concat(e.z)}},{key:"getTileZoom",value:function(e){return e.z}},{key:"getTileMetadata",value:function(e){var n=this.opts.tileSize;return{bbox:MO(this._viewport,e.x,e.y,e.z,n)}}},{key:"getParentIndex",value:function(e){var n=Math.floor(e.x/2),i=Math.floor(e.y/2),a=e.z-1;return{x:n,y:i,z:a}}},{key:"updateTileStates",value:function(){var e=this.opts.refinementStrategy||ud,n=new Array(this._cache.size),i=0,a=gr(this._cache.values()),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;n[i++]=s.isVisible,s.isSelected=!1,s.isVisible=!1}}catch(v){a.e(v)}finally{a.f()}var u=gr(this._selectedTiles),l;try{for(u.s();!(l=u.n()).done;){var f=l.value;f.isSelected=!0,f.isVisible=!0}}catch(v){u.e(v)}finally{u.f()}(typeof e=="function"?e:DEe[e])(Array.from(this._cache.values())),i=0;var c=gr(this._cache.values()),p;try{for(c.s();!(p=c.n()).done;){var d=p.value;if(n[i++]!==d.isVisible)return!0}}catch(v){c.e(v)}finally{c.f()}return!1}},{key:"_pruneRequests",value:function(){var e=this.opts.maxRequests,n=e===void 0?0:e,i=[],a=0,o=gr(this._cache.values()),s;try{for(o.s();!(s=o.n()).done;){var u=s.value;u.isLoading&&(a++,!u.isSelected&&!u.isVisible&&i.push(u))}}catch(f){o.e(f)}finally{o.f()}for(;n>0&&a>n&&i.length>0;){var l=i.shift();l.abort(),a--}}},{key:"_rebuildTree",value:function(){var e=this._cache,n=gr(e.values()),i;try{for(n.s();!(i=n.n()).done;){var a=i.value;a.parent=null,a.children&&(a.children.length=0)}}catch(f){n.e(f)}finally{n.f()}var o=gr(e.values()),s;try{for(o.s();!(s=o.n()).done;){var u=s.value,l=this._getNearestAncestor(u);u.parent=l,l!=null&&l.children&&l.children.push(u)}}catch(f){o.e(f)}finally{o.f()}}},{key:"_resizeCache",value:function(){var e=this._cache,n=this.opts,i=n.maxCacheSize||(n.maxCacheByteSize?1/0:FEe*this.selectedTiles.length),a=n.maxCacheByteSize||1/0,o=e.size>i||this._cacheByteSize>a;if(o){var s=gr(e),u;try{for(s.s();!(u=s.n()).done;){var l=(0,kO.default)(u.value,2),f=l[0],c=l[1];if(!c.isVisible&&!c.isSelected){var p,d;this._cacheByteSize-=n.maxCacheByteSize?c.byteLength:0,e.delete(f),(p=(d=this.opts).onTileUnload)===null||p===void 0||p.call(d,c)}if(e.size<=i&&this._cacheByteSize<=a)break}}catch(v){s.e(v)}finally{s.f()}this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort(function(v,m){return v.zoom-m.zoom}),this._dirty=!1)}},{key:"_getTile",value:function(e,n){var i=this.getTileId(e),a=this._cache.get(i),o=!1;return!a&&n?(a=new nd(e),Object.assign(a,this.getTileMetadata(a.index)),Object.assign(a,{id:i,zoom:this.getTileZoom(a.index)}),o=!0,this._cache.set(i,a),this._dirty=!0):a&&a.needsReload&&(o=!0),a&&o&&a.loadData({getData:this.opts.getTileData,requestScheduler:this._requestScheduler,onLoad:this.onTileLoad,onError:this.opts.onTileError}),a}},{key:"_getNearestAncestor",value:function(e){for(var n=this._minZoom,i=n===void 0?0:n,a=e.index;this.getTileZoom(a)>i;){a=this.getParentIndex(a);var o=this._getTile(a);if(o)return o}return null}}]),t}();function jEe(t){var r=gr(t),e;try{for(r.s();!(e=r.n()).done;){var n=e.value;n.state=0}}catch(f){r.e(f)}finally{r.f()}var i=gr(t),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;o.isSelected&&!XY(o)&&BO(o)}}catch(f){i.e(f)}finally{i.f()}var s=gr(t),u;try{for(s.s();!(u=s.n()).done;){var l=u.value;l.isVisible=Boolean(l.state&S0)}}catch(f){s.e(f)}finally{s.f()}}function UEe(t){var r=gr(t),e;try{for(r.s();!(e=r.n()).done;){var n=e.value;n.state=0}}catch(v){r.e(v)}finally{r.f()}var i=gr(t),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;o.isSelected&&XY(o)}}catch(v){i.e(v)}finally{i.f()}var s=Array.from(t).sort(function(v,m){return v.zoom-m.zoom}),u=gr(s),l;try{for(u.s();!(l=u.n()).done;){var f=l.value;if(f.isVisible=Boolean(f.state&S0),f.children&&(f.isVisible||f.state&HY)){var c=gr(f.children),p;try{for(c.s();!(p=c.n()).done;){var d=p.value;d.state=HY}}catch(v){c.e(v)}finally{c.f()}}else f.isSelected&&BO(f)}}catch(v){u.e(v)}finally{u.f()}}function XY(t){for(var r=t;r;){if(r.isLoaded||r.content)return r.state|=S0,!0;r=r.parent}return!1}function BO(t){var r=gr(t.children),e;try{for(r.s();!(e=r.n()).done;){var n=e.value;n.isLoaded||n.content?n.state|=S0:BO(n)}}catch(i){r.e(i)}finally{r.f()}}function qY(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function FO(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?qY(Object(e),!0).forEach(function(n){(0,T0.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):qY(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function GEe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=zEe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function zEe(t,r){if(t){if(typeof t=="string")return YY(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return YY(t,r)}}function YY(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function VEe(t){var r=HEe();return function(){var n=(0,DO.default)(t),i;if(r){var a=(0,DO.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,QY.default)(this,i)}}function HEe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var WEe={TilesetClass:ld,data:{type:"data",value:[]},dataComparator:Uo.equal,renderSubLayers:{type:"function",value:function(r){return new Ra(r)}},getTileData:{type:"function",optional:!0,value:null},onViewportLoad:{type:"function",optional:!0,value:null},onTileLoad:{type:"function",value:function(r){}},onTileUnload:{type:"function",value:function(r){}},onTileError:{type:"function",value:function(r){return console.error(r)}},extent:{type:"array",optional:!0,value:null,compare:!0},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:ud,zRange:null,maxRequests:6,zoomOffset:0},Na=function(t){(0,JY.default)(e,t);var r=VEe(e);function e(){return(0,KY.default)(this,e),r.apply(this,arguments)}return(0,ZY.default)(e,[{key:"initializeState",value:function(){this.state={tileset:null,isLoaded:!1}}},{key:"finalizeState",value:function(){var i,a;(i=this.state)===null||i===void 0||(a=i.tileset)===null||a===void 0||a.finalize()}},{key:"isLoaded",get:function(){var i,a;return(i=this.state)===null||i===void 0||(a=i.tileset)===null||a===void 0?void 0:a.selectedTiles.every(function(o){return o.isLoaded&&o.layers&&o.layers.every(function(s){return s.isLoaded})})}},{key:"shouldUpdateState",value:function(i){var a=i.changeFlags;return a.somethingChanged}},{key:"updateState",value:function(i){var a=i.changeFlags,o=this.state.tileset,s=a.propsOrDataChanged||a.updateTriggersChanged,u=a.dataChanged||a.updateTriggersChanged&&(a.updateTriggersChanged.all||a.updateTriggersChanged.getTileData);o?s&&(o.setOptions(this._getTilesetOptions()),u?o.reloadAll():this.state.tileset.tiles.forEach(function(l){l.layers=null})):(o=new this.props.TilesetClass(this._getTilesetOptions()),this.setState({tileset:o})),this._updateTileset()}},{key:"_getTilesetOptions",value:function(){var i=this.props,a=i.tileSize,o=i.maxCacheSize,s=i.maxCacheByteSize,u=i.refinementStrategy,l=i.extent,f=i.maxZoom,c=i.minZoom,p=i.maxRequests,d=i.zoomOffset;return{maxCacheSize:o,maxCacheByteSize:s,maxZoom:f,minZoom:c,tileSize:a,refinementStrategy:u,extent:l,maxRequests:p,zoomOffset:d,getTileData:this.getTileData.bind(this),onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this),onTileUnload:this._onTileUnload.bind(this)}}},{key:"_updateTileset",value:function(){var i=this.state.tileset,a=this.props,o=a.zRange,s=a.modelMatrix,u=i.update(this.context.viewport,{zRange:o,modelMatrix:s}),l=i.isLoaded,f=this.state.isLoaded!==l,c=this.state.frameNumber!==u;l&&(f||c)&&this._onViewportLoad(),c&&this.setState({frameNumber:u}),this.state.isLoaded=l}},{key:"_onViewportLoad",value:function(){var i=this.state.tileset,a=this.props.onViewportLoad;a&&a(i.selectedTiles)}},{key:"_onTileLoad",value:function(i){this.props.onTileLoad(i),i.layers=null,this.setNeedsUpdate()}},{key:"_onTileError",value:function(i,a){this.props.onTileError(i),a.layers=null,this.setNeedsUpdate()}},{key:"_onTileUnload",value:function(i){this.props.onTileUnload(i)}},{key:"getTileData",value:function(i){var a=this.props,o=a.data,s=a.getTileData,u=a.fetch,l=i.signal;return i.url=typeof o=="string"||Array.isArray(o)?Qi(o,i):null,s?s(i):u&&i.url?u(i.url,{propName:"data",layer:this,signal:l}):null}},{key:"renderSubLayers",value:function(i){return this.props.renderSubLayers(i)}},{key:"getSubLayerPropsByTile",value:function(i){return null}},{key:"getPickingInfo",value:function(i){var a=i.info,o=i.sourceLayer,s=o.props.tile;return a.picked&&(a.tile=s),a.sourceTile=s,a}},{key:"_updateAutoHighlight",value:function(i){var a=i.sourceTile;if(a&&a.layers){var o=GEe(a.layers),s;try{for(o.s();!(s=o.n()).done;){var u=s.value;u.updateAutoHighlight(i)}}catch(l){o.e(l)}finally{o.f()}}}},{key:"renderLayers",value:function(){var i=this;return this.state.tileset.tiles.map(function(a){var o=i.getSubLayerPropsByTile(a);if(!(!a.isLoaded&&!a.content))if(a.layers)o&&a.layers[0]&&Object.keys(o).some(function(u){return a.layers[0].props[u]!==o[u]})&&(a.layers=a.layers.map(function(u){return u.clone(o)}));else{var s=i.renderSubLayers(FO(FO({},i.props),{},{id:"".concat(i.id,"-").concat(a.id),data:a.content,_offset:0,tile:a}));a.layers=jr(s,Boolean).map(function(u){return u.clone(FO({tile:a},o))})}return a.layers})}},{key:"filterSubLayer",value:function(i){var a=i.layer,o=i.cullRect,s=a.props.tile;return this.state.tileset.isTileVisible(s,o)}}]),e}(Ot);(0,T0.default)(Na,"defaultProps",WEe);(0,T0.default)(Na,"layerName","TileLayer");var rK=h(L()),nK=h(N()),w0=h(Ee()),iK=h(Y()),aK=h(K()),xf=h(q()),P0=h(B());function eK(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function tK(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?eK(Object(e),!0).forEach(function(n){(0,P0.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):eK(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function $Ee(t){var r=XEe();return function(){var n=(0,xf.default)(t),i;if(r){var a=(0,xf.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,aK.default)(this,i)}}function XEe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var qEe={fadeTrail:!0,trailLength:{type:"number",value:120,min:0},currentTime:{type:"number",value:0,min:0},getTimestamps:{type:"accessor",value:function(r){return r.timestamps}}},O0=function(t){(0,iK.default)(e,t);var r=$Ee(e);function e(){return(0,rK.default)(this,e),r.apply(this,arguments)}return(0,nK.default)(e,[{key:"getShaders",value:function(){var i=(0,w0.default)((0,xf.default)(e.prototype),"getShaders",this).call(this);return i.inject={"vs:#decl":`uniform float trailLength;
attribute float instanceTimestamps;
attribute float instanceNextTimestamps;
varying float vTime;
`,"vs:#main-end":`vTime = instanceTimestamps + (instanceNextTimestamps - instanceTimestamps) * vPathPosition.y / vPathLength;
`,"fs:#decl":`uniform bool fadeTrail;
uniform float trailLength;
uniform float currentTime;
varying float vTime;
`,"fs:#main-start":`if(vTime > currentTime || (fadeTrail && (vTime < currentTime - trailLength))) {
  discard;
}
`,"fs:DECKGL_FILTER_COLOR":`if(fadeTrail) {
  color.a *= 1.0 - (currentTime - vTime) / trailLength;
}
`},i}},{key:"initializeState",value:function(){(0,w0.default)((0,xf.default)(e.prototype),"initializeState",this).call(this);var i=this.getAttributeManager();i.addInstanced({timestamps:{size:1,accessor:"getTimestamps",shaderAttributes:{instanceTimestamps:{vertexOffset:0},instanceNextTimestamps:{vertexOffset:1}}}})}},{key:"draw",value:function(i){var a=this.props,o=a.fadeTrail,s=a.trailLength,u=a.currentTime;i.uniforms=tK(tK({},i.uniforms),{},{fadeTrail:o,trailLength:s,currentTime:u}),(0,w0.default)((0,xf.default)(e.prototype),"draw",this).call(this,i)}}]),e}($i);(0,P0.default)(O0,"layerName","TripsLayer");(0,P0.default)(O0,"defaultProps",qEe);var _K=h(L()),bK=h(N()),xK=h(Y()),AK=h(K()),UO=h(q()),GO=h(B()),SK=h(E0());var fK=h(L()),cK=h(N()),pK=h(be()),hK=h(Y()),dK=h(K()),NO=h(q()),Af=h(B()),vK=h(ze()),fd=h(me()),wr=h(E0());function YEe(t){var r=KEe();return function(){var n=(0,NO.default)(t),i;if(r){var a=(0,NO.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,dK.default)(this,i)}}function KEe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function sK(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function C0(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?sK(Object(e),!0).forEach(function(n){(0,Af.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):sK(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function jO(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=ZEe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function ZEe(t,r){if(t){if(typeof t=="string")return uK(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return uK(t,r)}}function uK(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var JEe=10;function mK(t,r){r=r===void 0?t[0][0]:r;var e=jO(t),n;try{for(e.s();!(n=e.n()).done;){var i=n.value,a=i[0]-r;a>180?i[0]-=360:a<-180&&(i[0]+=360)}}catch(o){e.e(o)}finally{e.f()}}function QEe(t,r,e){var n=(0,wr.h3ToGeo)(t),i=(0,fd.default)(n,2),a=i[0],o=i[1],s=r.length;mK(r,o);for(var u=r[0]===r[s-1]?s-1:s,l=0;l<u;l++)r[l][0]=sr(o,r[l][0],e),r[l][1]=sr(a,r[l][1],e)}function eCe(t,r,e){var n=t(r,e),i=(0,wr.h3ToGeo)(n),a=(0,fd.default)(i,2),o=a[0],s=a[1];return[s,o]}function lK(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,e=(0,wr.h3ToGeoBoundary)(t,!0);return r!==1?QEe(t,e,r):mK(e),e}function tCe(t){var r=new Float64Array(t.length*2),e=0,n=jO(t),i;try{for(n.s();!(i=n.n()).done;){var a=i.value;r[e++]=a[0],r[e++]=a[1]}}catch(o){n.e(o)}finally{n.f()}return r}function rCe(t,r){var e;return t==null?e=r:(0,vK.default)(t)==="object"?e=C0(C0({},t),{},{coverage:r}):e={getHexagon:t,coverage:r},e}var nCe=C0(C0({},qi.defaultProps),{},{highPrecision:"auto",coverage:{type:"number",min:0,max:1,value:1},centerHexagon:null,getHexagon:{type:"accessor",value:function(r){return r.hexagon}},extruded:!0}),ja=function(t){(0,hK.default)(e,t);var r=YEe(e);function e(){var n;(0,fK.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,Af.default)((0,pK.default)(n),"state",void 0),n}return(0,cK.default)(e,[{key:"initializeState",value:function(){e._checkH3Lib(),this.state={edgeLengthKM:0,resolution:-1}}},{key:"shouldUpdateState",value:function(i){var a=i.changeFlags;return this._shouldUseHighPrecision()?a.propsOrDataChanged:a.somethingChanged}},{key:"updateState",value:function(i){var a=i.props,o=i.changeFlags;if(a.highPrecision!==!0&&(o.dataChanged||o.updateTriggersChanged&&o.updateTriggersChanged.getHexagon)){var s=this._calculateH3DataProps();this.setState(s)}this._updateVertices(this.context.viewport)}},{key:"_calculateH3DataProps",value:function(){var i=-1,a=!1,o=!1,s=Ut(this.props.data),u=s.iterable,l=s.objectInfo,f=jO(u),c;try{for(f.s();!(c=f.n()).done;){var p=c.value;l.index++;var d=this.props.getHexagon(p,l),v=(0,wr.h3GetResolution)(d);if(i<0){if(i=v,!this.props.highPrecision)break}else if(i!==v){o=!0;break}if((0,wr.h3IsPentagon)(d)){a=!0;break}}}catch(m){f.e(m)}finally{f.f()}return{resolution:i,edgeLengthKM:i>=0?(0,wr.edgeLength)(i,"km"):0,hasMultipleRes:o,hasPentagon:a}}},{key:"_shouldUseHighPrecision",value:function(){if(this.props.highPrecision==="auto"){var i=this.state,a=i.resolution,o=i.hasPentagon,s=i.hasMultipleRes,u=this.context.viewport;return Boolean(u?.resolution)||s||o||a>=0&&a<=5}return this.props.highPrecision}},{key:"_updateVertices",value:function(i){if(!this._shouldUseHighPrecision()){var a=this.state,o=a.resolution,s=a.edgeLengthKM,u=a.centerHex;if(!(o<0)){var l=this.props.centerHexagon||(0,wr.geoToH3)(i.latitude,i.longitude,o);if(u!==l){if(u){var f=(0,wr.h3Distance)(u,l);if(f>=0&&f*s<JEe)return}var c=i.distanceScales.unitsPerMeter,p=lK(l),d=(0,wr.h3ToGeo)(l),v=(0,fd.default)(d,2),m=v[0],g=v[1],y=i.projectFlat([g,m]),_=(0,fd.default)(y,2),b=_[0],x=_[1];p=p.map(function(A){var S=i.projectFlat(A);return[(S[0]-b)/c[0],(S[1]-x)/c[1]]}),this.setState({centerHex:l,vertices:p})}}}}},{key:"renderLayers",value:function(){return this._shouldUseHighPrecision()?this._renderPolygonLayer():this._renderColumnLayer()}},{key:"_getForwardProps",value:function(){var i=this.props,a=i.elevationScale,o=i.material,s=i.coverage,u=i.extruded,l=i.wireframe,f=i.stroked,c=i.filled,p=i.lineWidthUnits,d=i.lineWidthScale,v=i.lineWidthMinPixels,m=i.lineWidthMaxPixels,g=i.getFillColor,y=i.getElevation,_=i.getLineColor,b=i.getLineWidth,x=i.transitions,A=i.updateTriggers;return{elevationScale:a,extruded:u,coverage:s,wireframe:l,stroked:f,filled:c,lineWidthUnits:p,lineWidthScale:d,lineWidthMinPixels:v,lineWidthMaxPixels:m,material:o,getElevation:y,getFillColor:g,getLineColor:_,getLineWidth:b,transitions:x,updateTriggers:{getFillColor:A.getFillColor,getElevation:A.getElevation,getLineColor:A.getLineColor,getLineWidth:A.getLineWidth}}}},{key:"_renderPolygonLayer",value:function(){var i=this.props,a=i.data,o=i.getHexagon,s=i.updateTriggers,u=i.coverage,l=this.getSubLayerClass("hexagon-cell-hifi",qi),f=this._getForwardProps();return f.updateTriggers.getPolygon=rCe(s.getHexagon,u),new l(f,this.getSubLayerProps({id:"hexagon-cell-hifi",updateTriggers:f.updateTriggers}),{data:a,_normalize:!1,_windingOrder:"CCW",positionFormat:"XY",getPolygon:function(p,d){var v=o(p,d);return tCe(lK(v,u))}})}},{key:"_renderColumnLayer",value:function(){var i=this.props,a=i.data,o=i.getHexagon,s=i.updateTriggers,u=this.getSubLayerClass("hexagon-cell",Wi),l=this._getForwardProps();return l.updateTriggers.getPosition=s.getHexagon,new u(l,this.getSubLayerProps({id:"hexagon-cell",flatShading:!0,updateTriggers:l.updateTriggers}),{data:a,diskResolution:6,radius:1,vertices:this.state.vertices,getPosition:eCe.bind(null,o)})}}]),e}(Ot);(0,Af.default)(ja,"defaultProps",nCe);(0,Af.default)(ja,"layerName","H3HexagonLayer");(0,Af.default)(ja,"_checkH3Lib",function(){});function gK(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=iCe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function iCe(t,r){if(t){if(typeof t=="string")return yK(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return yK(t,r)}}function yK(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function aCe(t){var r=oCe();return function(){var n=(0,UO.default)(t),i;if(r){var a=(0,UO.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,AK.default)(this,i)}}function oCe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var sCe={getHexagons:{type:"accessor",value:function(r){return r.hexagons}}},M0=function(t){(0,xK.default)(e,t);var r=aCe(e);function e(){return(0,_K.default)(this,e),r.apply(this,arguments)}return(0,bK.default)(e,[{key:"initializeState",value:function(){ja._checkH3Lib()}},{key:"updateState",value:function(i){var a=i.props,o=i.changeFlags;if(o.dataChanged||o.updateTriggersChanged&&o.updateTriggersChanged.getHexagons){var s=a.data,u=a.getHexagons,l=[],f=Ut(s),c=f.iterable,p=f.objectInfo,d=gK(c),v;try{for(d.s();!(v=d.n()).done;){var m=v.value;p.index++;var g=u(m,p),y=(0,SK.h3SetToMultiPolygon)(g,!0),_=gK(y),b;try{for(_.s();!(b=_.n()).done;){var x=b.value;l.push(this.getSubLayerRow({polygon:x},m,p.index))}}catch(A){_.e(A)}finally{_.f()}}}catch(A){d.e(A)}finally{d.f()}this.setState({polygons:l})}}},{key:"indexToBounds",value:function(){var i=this.props,a=i.getElevation,o=i.getFillColor,s=i.getLineColor,u=i.getLineWidth;return{data:this.state.polygons,getPolygon:function(f){return f.polygon},getElevation:this.getSubLayerAccessor(a),getFillColor:this.getSubLayerAccessor(o),getLineColor:this.getSubLayerAccessor(s),getLineWidth:this.getSubLayerAccessor(u)}}}]),e}(Dn);(0,GO.default)(M0,"layerName","H3ClusterLayer");(0,GO.default)(M0,"defaultProps",sCe);var Wre=h(ye()),$re=h(L()),Xre=h(N()),qre=h(be()),Yre=h(Y()),Kre=h(K()),JM=h(q()),Fd=h(B()),QM=h(ve());var mZ=h(L()),gZ=h(N()),yZ=h(be()),dd=h(Ee()),_Z=h(Y()),bZ=h(K()),fu=h(q()),vd=h(B());function uCe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=lCe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function lCe(t,r){if(t){if(typeof t=="string")return TK(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return TK(t,r)}}function TK(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var zO=Math.PI/180,I0=new Float32Array(16),wK=new Float32Array(12);function PK(t,r,e){var n=r[0]*zO,i=r[1]*zO,a=r[2]*zO,o=Math.sin(a),s=Math.sin(n),u=Math.sin(i),l=Math.cos(a),f=Math.cos(n),c=Math.cos(i),p=e[0],d=e[1],v=e[2];t[0]=p*c*f,t[1]=p*u*f,t[2]=p*-s,t[3]=d*(-u*l+c*s*o),t[4]=d*(c*l+u*s*o),t[5]=d*f*o,t[6]=v*(u*o+c*s*l),t[7]=v*(-c*o+u*s*l),t[8]=v*f*l}function OK(t){return t[0]=t[0],t[1]=t[1],t[2]=t[2],t[3]=t[4],t[4]=t[5],t[5]=t[6],t[6]=t[8],t[7]=t[9],t[8]=t[10],t[9]=t[12],t[10]=t[13],t[11]=t[14],t.subarray(0,12)}var R0={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrix__LOCATION_0:{size:3,elementOffset:0},instanceModelMatrix__LOCATION_1:{size:3,elementOffset:3},instanceModelMatrix__LOCATION_2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update:function(r,e){var n=e.startRow,i=e.endRow,a=this.props,o=a.data,s=a.getOrientation,u=a.getScale,l=a.getTranslation,f=a.getTransformMatrix,c=Array.isArray(f),p=c&&f.length===16,d=Array.isArray(u),v=Array.isArray(s),m=Array.isArray(l),g=p||!c&&Boolean(f(o[0]));g?r.constant=p:r.constant=v&&d&&m;var y=r.value;if(r.constant){var _;if(g)I0.set(f),_=OK(I0);else{_=wK;var b=s,x=u;PK(_,b,x),_.set(l,9)}r.value=new Float32Array(_)}else{var A=n*r.size,S=Ut(o,n,i),P=S.iterable,O=S.objectInfo,C=uCe(P),T;try{for(C.s();!(T=C.n()).done;){var I=T.value;O.index++;var R=void 0;if(g)I0.set(p?f:f(I,O)),R=OK(I0);else{R=wK;var V=v?s:s(I,O),z=d?u:u(I,O);PK(R,V,z),R.set(m?l:l(I,O),9)}y[A++]=R[0],y[A++]=R[1],y[A++]=R[2],y[A++]=R[3],y[A++]=R[4],y[A++]=R[5],y[A++]=R[6],y[A++]=R[7],y[A++]=R[8],y[A++]=R[9],y[A++]=R[10],y[A++]=R[11]}}catch(k){C.e(k)}finally{C.f()}}}};function L0(t,r){return r===ue.CARTESIAN||r===ue.METER_OFFSETS||r===ue.DEFAULT&&!t.isGeospatial}var EK=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
in vec3 instanceTranslation;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = texCoords;
  geometry.pickingColor = instancePickingColors;

  vTexCoord = texCoords;
  cameraPosition = project_uCameraPosition;
  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);

  vec3 pos = (instanceModelMatrix * positions) * sizeScale + instanceTranslation;

  if (composeModelMatrix) {
    DECKGL_FILTER_SIZE(pos, geometry);
    normals_commonspace = project_normal(instanceModelMatrix * normals);
    geometry.worldPosition += pos;
    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);
    geometry.position = position_commonspace;
  }
  else {
    pos = project_size(pos);
    DECKGL_FILTER_SIZE(pos, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);
    geometry.position = position_commonspace;
    normals_commonspace = project_normal(instanceModelMatrix * normals);
  }

  geometry.normal = normals_commonspace;
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var CK=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs

precision highp float;

uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;

in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;

out vec4 fragColor;

void main(void) {
  geometry.uv = vTexCoord;

  vec3 normal;
  if (flatShading) {
#ifdef DERIVATIVES_AVAILABLE
    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
#else
    normal = vec3(0.0, 0.0, 1.0);
#endif
  } else {
    normal = normals_commonspace;
  }

  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
  DECKGL_FILTER_COLOR(color, geometry);

  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
  fragColor = vec4(lightColor, color.a * opacity);
}
`;function Ua(t){for(var r=1/0,e=1/0,n=1/0,i=-1/0,a=-1/0,o=-1/0,s=t.POSITION?t.POSITION.value:[],u=s&&s.length,l=0;l<u;l+=3){var f=s[l],c=s[l+1],p=s[l+2];r=f<r?f:r,e=c<e?c:e,n=p<n?p:n,i=f>i?f:i,a=c>a?c:a,o=p>o?p:o}return[[r,e,n],[i,a,o]]}var VO=h(Zt()),LK=h(L()),kK=h(N());function MK(t,r){if(!t)throw new Error(r||"loader assertion failed.")}function HO(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=fCe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function fCe(t,r){if(t){if(typeof t=="string")return IK(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return IK(t,r)}}function IK(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var cd=function(){function t(r,e){(0,LK.default)(this,t),w(this,"fields",void 0),w(this,"metadata",void 0),MK(Array.isArray(r)),cCe(r),this.fields=r,this.metadata=e||new Map}return(0,kK.default)(t,[{key:"compareTo",value:function(e){if(this.metadata!==e.metadata||this.fields.length!==e.fields.length)return!1;for(var n=0;n<this.fields.length;++n)if(!this.fields[n].compareTo(e.fields[n]))return!1;return!0}},{key:"select",value:function(){for(var e=Object.create(null),n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];for(var o=0,s=i;o<s.length;o++){var u=s[o];e[u]=!0}var l=this.fields.filter(function(f){return e[f.name]});return new t(l,this.metadata)}},{key:"selectAt",value:function(){for(var e=this,n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];var o=i.map(function(s){return e.fields[s]}).filter(Boolean);return new t(o,this.metadata)}},{key:"assign",value:function(e){var n,i=this.metadata;if(e instanceof t){var a=e;n=a.fields,i=RK(RK(new Map,this.metadata),a.metadata)}else n=e;var o=Object.create(null),s=HO(this.fields),u;try{for(s.s();!(u=s.n()).done;){var l=u.value;o[l.name]=l}}catch(v){s.e(v)}finally{s.f()}var f=HO(n),c;try{for(f.s();!(c=f.n()).done;){var p=c.value;o[p.name]=p}}catch(v){f.e(v)}finally{f.f()}var d=Object.values(o);return new t(d,i)}}]),t}();function cCe(t){var r={},e=HO(t),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;r[i.name]&&console.warn("Schema: duplicated field name",i.name,i),r[i.name]=!0}}catch(a){e.e(a)}finally{e.f()}}function RK(t,r){return new Map([].concat((0,VO.default)(t||new Map),(0,VO.default)(r||new Map)))}var BK=h(L()),FK=h(N());var pd=function(){function t(r,e){(0,BK.default)(this,t);var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:new Map;w(this,"name",void 0),w(this,"type",void 0),w(this,"nullable",void 0),w(this,"metadata",void 0),this.name=r,this.type=e,this.nullable=n,this.metadata=i}return(0,FK.default)(t,[{key:"typeId",get:function(){return this.type&&this.type.typeId}},{key:"clone",value:function(){return new t(this.name,this.type,this.nullable,this.metadata)}},{key:"compareTo",value:function(e){return this.name===e.name&&this.type===e.type&&this.nullable===e.nullable&&this.metadata===e.metadata}},{key:"toString",value:function(){return"".concat(this.type).concat(this.nullable?", nullable":"").concat(this.metadata?", metadata: ".concat(this.metadata):"")}}]),t}();var vn=h(be()),Ze=h(Y()),DK=h(K()),WO=h(q()),$e=h(L()),tn=h(N());var nt=function(t){return t[t.NONE=0]="NONE",t[t.Null=1]="Null",t[t.Int=2]="Int",t[t.Float=3]="Float",t[t.Binary=4]="Binary",t[t.Utf8=5]="Utf8",t[t.Bool=6]="Bool",t[t.Decimal=7]="Decimal",t[t.Date=8]="Date",t[t.Time=9]="Time",t[t.Timestamp=10]="Timestamp",t[t.Interval=11]="Interval",t[t.List=12]="List",t[t.Struct=13]="Struct",t[t.Union=14]="Union",t[t.FixedSizeBinary=15]="FixedSizeBinary",t[t.FixedSizeList=16]="FixedSizeList",t[t.Map=17]="Map",t[t.Dictionary=-1]="Dictionary",t[t.Int8=-2]="Int8",t[t.Int16=-3]="Int16",t[t.Int32=-4]="Int32",t[t.Int64=-5]="Int64",t[t.Uint8=-6]="Uint8",t[t.Uint16=-7]="Uint16",t[t.Uint32=-8]="Uint32",t[t.Uint64=-9]="Uint64",t[t.Float16=-10]="Float16",t[t.Float32=-11]="Float32",t[t.Float64=-12]="Float64",t[t.DateDay=-13]="DateDay",t[t.DateMillisecond=-14]="DateMillisecond",t[t.TimestampSecond=-15]="TimestampSecond",t[t.TimestampMillisecond=-16]="TimestampMillisecond",t[t.TimestampMicrosecond=-17]="TimestampMicrosecond",t[t.TimestampNanosecond=-18]="TimestampNanosecond",t[t.TimeSecond=-19]="TimeSecond",t[t.TimeMillisecond=-20]="TimeMillisecond",t[t.TimeMicrosecond=-21]="TimeMicrosecond",t[t.TimeNanosecond=-22]="TimeNanosecond",t[t.DenseUnion=-23]="DenseUnion",t[t.SparseUnion=-24]="SparseUnion",t[t.IntervalDayTime=-25]="IntervalDayTime",t[t.IntervalYearMonth=-26]="IntervalYearMonth",t}({});function Qe(t){var r=pCe();return function(){var n=(0,WO.default)(t),i;if(r){var a=(0,WO.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,DK.default)(this,i)}}function pCe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var NK,jK,UK,GK,zK,VK,HK,WK,rn=function(){function t(){(0,$e.default)(this,t)}return(0,tn.default)(t,[{key:"typeId",get:function(){return nt.NONE}},{key:"compareTo",value:function(e){return this===e}}],[{key:"isNull",value:function(e){return e&&e.typeId===nt.Null}},{key:"isInt",value:function(e){return e&&e.typeId===nt.Int}},{key:"isFloat",value:function(e){return e&&e.typeId===nt.Float}},{key:"isBinary",value:function(e){return e&&e.typeId===nt.Binary}},{key:"isUtf8",value:function(e){return e&&e.typeId===nt.Utf8}},{key:"isBool",value:function(e){return e&&e.typeId===nt.Bool}},{key:"isDecimal",value:function(e){return e&&e.typeId===nt.Decimal}},{key:"isDate",value:function(e){return e&&e.typeId===nt.Date}},{key:"isTime",value:function(e){return e&&e.typeId===nt.Time}},{key:"isTimestamp",value:function(e){return e&&e.typeId===nt.Timestamp}},{key:"isInterval",value:function(e){return e&&e.typeId===nt.Interval}},{key:"isList",value:function(e){return e&&e.typeId===nt.List}},{key:"isStruct",value:function(e){return e&&e.typeId===nt.Struct}},{key:"isUnion",value:function(e){return e&&e.typeId===nt.Union}},{key:"isFixedSizeBinary",value:function(e){return e&&e.typeId===nt.FixedSizeBinary}},{key:"isFixedSizeList",value:function(e){return e&&e.typeId===nt.FixedSizeList}},{key:"isMap",value:function(e){return e&&e.typeId===nt.Map}},{key:"isDictionary",value:function(e){return e&&e.typeId===nt.Dictionary}}]),t}(),$K=function(t,r){(0,Ze.default)(n,t);var e=Qe(n);function n(){return(0,$e.default)(this,n),e.apply(this,arguments)}return(0,tn.default)(n,[{key:"typeId",get:function(){return nt.Null}},{key:r,get:function(){return"Null"}},{key:"toString",value:function(){return"Null"}}]),n}(rn,Symbol.toStringTag),XK=function(t,r){(0,Ze.default)(n,t);var e=Qe(n);function n(){return(0,$e.default)(this,n),e.apply(this,arguments)}return(0,tn.default)(n,[{key:"typeId",get:function(){return nt.Bool}},{key:r,get:function(){return"Bool"}},{key:"toString",value:function(){return"Bool"}}]),n}(rn,Symbol.toStringTag);NK=Symbol.toStringTag;var ea=function(t,r){(0,Ze.default)(n,t);var e=Qe(n);function n(i,a){var o;return(0,$e.default)(this,n),o=e.call(this),w((0,vn.default)(o),"isSigned",void 0),w((0,vn.default)(o),"bitWidth",void 0),o.isSigned=i,o.bitWidth=a,o}return(0,tn.default)(n,[{key:"typeId",get:function(){return nt.Int}},{key:r,get:function(){return"Int"}},{key:"toString",value:function(){return"".concat(this.isSigned?"I":"Ui","nt").concat(this.bitWidth)}}]),n}(rn,NK),k0=function(t){(0,Ze.default)(e,t);var r=Qe(e);function e(){return(0,$e.default)(this,e),r.call(this,!0,8)}return e}(ea),B0=function(t){(0,Ze.default)(e,t);var r=Qe(e);function e(){return(0,$e.default)(this,e),r.call(this,!0,16)}return e}(ea),F0=function(t){(0,Ze.default)(e,t);var r=Qe(e);function e(){return(0,$e.default)(this,e),r.call(this,!0,32)}return e}(ea),qK=function(t){(0,Ze.default)(e,t);var r=Qe(e);function e(){return(0,$e.default)(this,e),r.call(this,!0,64)}return e}(ea),D0=function(t){(0,Ze.default)(e,t);var r=Qe(e);function e(){return(0,$e.default)(this,e),r.call(this,!1,8)}return e}(ea),N0=function(t){(0,Ze.default)(e,t);var r=Qe(e);function e(){return(0,$e.default)(this,e),r.call(this,!1,16)}return e}(ea),j0=function(t){(0,Ze.default)(e,t);var r=Qe(e);function e(){return(0,$e.default)(this,e),r.call(this,!1,32)}return e}(ea),YK=function(t){(0,Ze.default)(e,t);var r=Qe(e);function e(){return(0,$e.default)(this,e),r.call(this,!1,64)}return e}(ea),$O={HALF:16,SINGLE:32,DOUBLE:64};jK=Symbol.toStringTag;var hd=function(t,r){(0,Ze.default)(n,t);var e=Qe(n);function n(i){var a;return(0,$e.default)(this,n),a=e.call(this),w((0,vn.default)(a),"precision",void 0),a.precision=i,a}return(0,tn.default)(n,[{key:"typeId",get:function(){return nt.Float}},{key:r,get:function(){return"Float"}},{key:"toString",value:function(){return"Float".concat(this.precision)}}]),n}(rn,jK),KK=function(t){(0,Ze.default)(e,t);var r=Qe(e);function e(){return(0,$e.default)(this,e),r.call(this,$O.HALF)}return e}(hd),U0=function(t){(0,Ze.default)(e,t);var r=Qe(e);function e(){return(0,$e.default)(this,e),r.call(this,$O.SINGLE)}return e}(hd),G0=function(t){(0,Ze.default)(e,t);var r=Qe(e);function e(){return(0,$e.default)(this,e),r.call(this,$O.DOUBLE)}return e}(hd),ZK=function(t,r){(0,Ze.default)(n,t);var e=Qe(n);function n(){return(0,$e.default)(this,n),e.call(this)}return(0,tn.default)(n,[{key:"typeId",get:function(){return nt.Binary}},{key:"toString",value:function(){return"Binary"}},{key:r,get:function(){return"Binary"}}]),n}(rn,Symbol.toStringTag),JK=function(t,r){(0,Ze.default)(n,t);var e=Qe(n);function n(){return(0,$e.default)(this,n),e.apply(this,arguments)}return(0,tn.default)(n,[{key:"typeId",get:function(){return nt.Utf8}},{key:r,get:function(){return"Utf8"}},{key:"toString",value:function(){return"Utf8"}}]),n}(rn,Symbol.toStringTag),XO={DAY:0,MILLISECOND:1};UK=Symbol.toStringTag;var z0=function(t,r){(0,Ze.default)(n,t);var e=Qe(n);function n(i){var a;return(0,$e.default)(this,n),a=e.call(this),w((0,vn.default)(a),"unit",void 0),a.unit=i,a}return(0,tn.default)(n,[{key:"typeId",get:function(){return nt.Date}},{key:r,get:function(){return"Date"}},{key:"toString",value:function(){return"Date".concat((this.unit+1)*32,"<").concat(XO[this.unit],">")}}]),n}(rn,UK),QK=function(t){(0,Ze.default)(e,t);var r=Qe(e);function e(){return(0,$e.default)(this,e),r.call(this,XO.DAY)}return e}(z0),eZ=function(t){(0,Ze.default)(e,t);var r=Qe(e);function e(){return(0,$e.default)(this,e),r.call(this,XO.MILLISECOND)}return e}(z0),Go={SECOND:1,MILLISECOND:1e3,MICROSECOND:1e6,NANOSECOND:1e9};GK=Symbol.toStringTag;var V0=function(t,r){(0,Ze.default)(n,t);var e=Qe(n);function n(i,a){var o;return(0,$e.default)(this,n),o=e.call(this),w((0,vn.default)(o),"unit",void 0),w((0,vn.default)(o),"bitWidth",void 0),o.unit=i,o.bitWidth=a,o}return(0,tn.default)(n,[{key:"typeId",get:function(){return nt.Time}},{key:"toString",value:function(){return"Time".concat(this.bitWidth,"<").concat(Go[this.unit],">")}},{key:r,get:function(){return"Time"}}]),n}(rn,GK),tZ=function(t){(0,Ze.default)(e,t);var r=Qe(e);function e(){return(0,$e.default)(this,e),r.call(this,Go.SECOND,32)}return e}(V0),rZ=function(t){(0,Ze.default)(e,t);var r=Qe(e);function e(){return(0,$e.default)(this,e),r.call(this,Go.MILLISECOND,32)}return e}(V0);zK=Symbol.toStringTag;var Sf=function(t,r){(0,Ze.default)(n,t);var e=Qe(n);function n(i){var a;(0,$e.default)(this,n);var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return a=e.call(this),w((0,vn.default)(a),"unit",void 0),w((0,vn.default)(a),"timezone",void 0),a.unit=i,a.timezone=o,a}return(0,tn.default)(n,[{key:"typeId",get:function(){return nt.Timestamp}},{key:r,get:function(){return"Timestamp"}},{key:"toString",value:function(){return"Timestamp<".concat(Go[this.unit]).concat(this.timezone?", ".concat(this.timezone):"",">")}}]),n}(rn,zK),nZ=function(t){(0,Ze.default)(e,t);var r=Qe(e);function e(){(0,$e.default)(this,e);var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return r.call(this,Go.SECOND,n)}return e}(Sf),iZ=function(t){(0,Ze.default)(e,t);var r=Qe(e);function e(){(0,$e.default)(this,e);var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return r.call(this,Go.MILLISECOND,n)}return e}(Sf),aZ=function(t){(0,Ze.default)(e,t);var r=Qe(e);function e(){(0,$e.default)(this,e);var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return r.call(this,Go.MICROSECOND,n)}return e}(Sf),oZ=function(t){(0,Ze.default)(e,t);var r=Qe(e);function e(){(0,$e.default)(this,e);var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return r.call(this,Go.NANOSECOND,n)}return e}(Sf),qO={DAY_TIME:0,YEAR_MONTH:1};VK=Symbol.toStringTag;var H0=function(t,r){(0,Ze.default)(n,t);var e=Qe(n);function n(i){var a;return(0,$e.default)(this,n),a=e.call(this),w((0,vn.default)(a),"unit",void 0),a.unit=i,a}return(0,tn.default)(n,[{key:"typeId",get:function(){return nt.Interval}},{key:r,get:function(){return"Interval"}},{key:"toString",value:function(){return"Interval<".concat(qO[this.unit],">")}}]),n}(rn,VK),sZ=function(t){(0,Ze.default)(e,t);var r=Qe(e);function e(){return(0,$e.default)(this,e),r.call(this,qO.DAY_TIME)}return e}(H0),uZ=function(t){(0,Ze.default)(e,t);var r=Qe(e);function e(){return(0,$e.default)(this,e),r.call(this,qO.YEAR_MONTH)}return e}(H0);HK=Symbol.toStringTag;var W0=function(t,r){(0,Ze.default)(n,t);var e=Qe(n);function n(i,a){var o;return(0,$e.default)(this,n),o=e.call(this),w((0,vn.default)(o),"listSize",void 0),w((0,vn.default)(o),"children",void 0),o.listSize=i,o.children=[a],o}return(0,tn.default)(n,[{key:"typeId",get:function(){return nt.FixedSizeList}},{key:"valueType",get:function(){return this.children[0].type}},{key:"valueField",get:function(){return this.children[0]}},{key:r,get:function(){return"FixedSizeList"}},{key:"toString",value:function(){return"FixedSizeList[".concat(this.listSize,"]<").concat(this.valueType,">")}}]),n}(rn,HK);WK=Symbol.toStringTag;var lZ=function(t,r){(0,Ze.default)(n,t);var e=Qe(n);function n(i){var a;return(0,$e.default)(this,n),a=e.call(this),w((0,vn.default)(a),"children",void 0),a.children=i,a}return(0,tn.default)(n,[{key:"typeId",get:function(){return nt.Struct}},{key:"toString",value:function(){return"Struct<{".concat(this.children.map(function(a){return"".concat(a.name,":").concat(a.type)}).join(", "),"}>")}},{key:r,get:function(){return"Struct"}}]),n}(rn,WK);function fZ(t){switch(t.constructor){case Int8Array:return new k0;case Uint8Array:return new D0;case Int16Array:return new B0;case Uint16Array:return new N0;case Int32Array:return new F0;case Uint32Array:return new j0;case Float32Array:return new U0;case Float64Array:return new G0;default:throw new Error("array type not supported")}}function YO(t,r,e){var n=fZ(r.value),i=e||cZ(r),a=new pd(t,new W0(r.size,new pd("value",n)),!1,i);return a}function cZ(t){var r=new Map;return"byteOffset"in t&&r.set("byteOffset",t.byteOffset.toString(10)),"byteStride"in t&&r.set("byteStride",t.byteStride.toString(10)),"normalized"in t&&r.set("normalized",t.normalized.toString()),r}function pZ(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function hZ(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?pZ(Object(e),!0).forEach(function(n){(0,vd.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):pZ(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function hCe(t){var r=dCe();return function(){var n=(0,fu.default)(t),i;if(r){var a=(0,fu.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,bZ.default)(this,i)}}function dCe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function dZ(t,r){var e=t.COLOR_0||t.colors,n=e&&r;n||(t.colors={constant:!0,value:new Float32Array([1,1,1])}),J.assert(t.positions||t.POSITION,'no "postions" or "POSITION" attribute in mesh')}function vZ(t,r){if(t.attributes)return dZ(t.attributes,r),t instanceof Me?t:new Me(t);if(t.positions||t.POSITION)return dZ(t,r),new Me({attributes:t});throw Error("Invalid mesh")}var vCe=[0,0,0,255],mCe={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_useMeshColors:{type:"boolean",value:!1},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:function(r){return r.position}},getColor:{type:"accessor",value:vCe},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0}},Ga=function(t){(0,_Z.default)(e,t);var r=hCe(e);function e(){var n;(0,mZ.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,vd.default)((0,yZ.default)(n),"state",void 0),n}return(0,gZ.default)(e,[{key:"getShaders",value:function(){var i=!ce(this.context.gl),a={};return ti(this.context.gl,Se.GLSL_DERIVATIVES)&&(a.DERIVATIVES_AVAILABLE=1),(0,dd.default)((0,fu.default)(e.prototype),"getShaders",this).call(this,{vs:EK,fs:CK,modules:[Je,ya,st],transpileToGLSL100:i,defines:a})}},{key:"getBounds",value:function(){var i;if(this.props._instanced)return(0,dd.default)((0,fu.default)(e.prototype),"getBounds",this).call(this);var a=this.state.positionBounds;if(a)return a;var o=this.props.mesh;if(!o)return null;if(a=(i=o.header)===null||i===void 0?void 0:i.boundingBox,!a){var s=vZ(o,this.props._useMeshColors),u=s.attributes;u.POSITION=u.POSITION||u.positions,a=Ua(u)}return this.state.positionBounds=a,a}},{key:"initializeState",value:function(){var i=this.getAttributeManager();i.addInstanced({instancePositions:{transition:!0,type:5130,fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:5121,transition:!0,size:this.props.colorFormat.length,normalized:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:R0}),this.setState({emptyTexture:new we(this.context.gl,{data:new Uint8Array(4),width:1,height:1})})}},{key:"updateState",value:function(i){(0,dd.default)((0,fu.default)(e.prototype),"updateState",this).call(this,i);var a=i.props,o=i.oldProps,s=i.changeFlags;if(a.mesh!==o.mesh||s.extensionsChanged){var u;if(this.state.positionBounds=null,(u=this.state.model)===null||u===void 0||u.delete(),a.mesh){this.state.model=this.getModel(a.mesh);var l=a.mesh.attributes||a.mesh;this.setState({hasNormals:Boolean(l.NORMAL||l.normals)})}this.getAttributeManager().invalidateAll()}a.texture!==o.texture&&this.setTexture(a.texture),this.state.model&&this.state.model.setDrawMode(this.props.wireframe?3:4)}},{key:"finalizeState",value:function(i){(0,dd.default)((0,fu.default)(e.prototype),"finalizeState",this).call(this,i),this.state.emptyTexture.delete()}},{key:"draw",value:function(i){var a=i.uniforms;if(this.state.model){var o=this.context.viewport,s=this.props,u=s.sizeScale,l=s.coordinateSystem,f=s._instanced;this.state.model.setUniforms(a).setUniforms({sizeScale:u,composeModelMatrix:!f||L0(o,l),flatShading:!this.state.hasNormals}).draw()}}},{key:"getModel",value:function(i){var a=new Ce(this.context.gl,hZ(hZ({},this.getShaders()),{},{id:this.props.id,geometry:vZ(i,this.props._useMeshColors),isInstanced:!0})),o=this.props.texture,s=this.state.emptyTexture;return a.setUniforms({sampler:o||s,hasTexture:Boolean(o)}),a}},{key:"setTexture",value:function(i){var a=this.state,o=a.emptyTexture,s=a.model;s&&s.setUniforms({sampler:i||o,hasTexture:Boolean(i)})}}]),e}(He);(0,vd.default)(Ga,"defaultProps",mCe);(0,vd.default)(Ga,"layerName","SimpleMeshLayer");var KQ=h(L()),ZQ=h(N()),JQ=h(be()),AC=h(Ee()),QQ=h(Y()),eee=h(K()),Md=h(q()),Id=h(B()),tee=h(ze());var VZ=h(L()),HZ=h(N());var TZ=h(me()),wZ=h(Zt()),PZ=h(L()),OZ=h(N()),EZ=h(Ee()),CZ=h(Y()),MZ=h(K()),$0=h(q());var xZ=h(L()),AZ=h(N());var ta=function(){function t(){(0,xZ.default)(this,t);var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=r.id;this.id=e||Ye(this.constructor.name),this.display=!0,this.position=new j,this.rotation=new j,this.scale=new j(1,1,1),this.matrix=new pe,this.userData={},this.props={},this._setScenegraphNodeProps(r)}return(0,AZ.default)(t,[{key:"delete",value:function(){}},{key:"setProps",value:function(e){return this._setScenegraphNodeProps(e),this}},{key:"toString",value:function(){return"{type: ScenegraphNode, id: ".concat(this.id,")}")}},{key:"getBounds",value:function(){return null}},{key:"setPosition",value:function(e){return Z(e.length===3,"setPosition requires vector argument"),this.position=e,this}},{key:"setRotation",value:function(e){return Z(e.length===3,"setRotation requires vector argument"),this.rotation=e,this}},{key:"setScale",value:function(e){return Z(e.length===3,"setScale requires vector argument"),this.scale=e,this}},{key:"setMatrix",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;n?this.matrix.copy(e):this.matrix=e}},{key:"setMatrixComponents",value:function(e){var n=e.position,i=e.rotation,a=e.scale,o=e.update,s=o===void 0?!0:o;return n&&this.setPosition(n),i&&this.setRotation(i),a&&this.setScale(a),s&&this.updateMatrix(),this}},{key:"updateMatrix",value:function(){var e=this.position,n=this.rotation,i=this.scale;return this.matrix.identity(),this.matrix.translate(e),this.matrix.rotateXYZ(n),this.matrix.scale(i),this}},{key:"update",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.position,i=e.rotation,a=e.scale;return n&&this.setPosition(n),i&&this.setRotation(i),a&&this.setScale(a),this.updateMatrix(),this}},{key:"getCoordinateUniforms",value:function(e,n){Z(e),n=n||this.matrix;var i=new pe(e).multiplyRight(n),a=i.invert(),o=a.transpose();return{viewMatrix:e,modelMatrix:n,objectMatrix:n,worldMatrix:i,worldInverseMatrix:a,worldInverseTransposeMatrix:o}}},{key:"_setScenegraphNodeProps",value:function(e){"display"in e&&(this.display=e.display),"position"in e&&this.setPosition(e.position),"rotation"in e&&this.setRotation(e.rotation),"scale"in e&&this.setScale(e.scale),"matrix"in e&&this.setMatrix(e.matrix),Object.assign(this.props,e)}}]),t}();function gCe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=yCe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function yCe(t,r){if(t){if(typeof t=="string")return SZ(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return SZ(t,r)}}function SZ(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function _Ce(t){var r=bCe();return function(){var n=(0,$0.default)(t),i;if(r){var a=(0,$0.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,MZ.default)(this,i)}}function bCe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var X0=function(t){(0,CZ.default)(e,t);var r=_Ce(e);function e(){var n;(0,PZ.default)(this,e);var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};i=Array.isArray(i)?{children:i}:i;var a=i,o=a.children,s=o===void 0?[]:o;return ne.assert(s.every(function(u){return u instanceof ta}),"every child must an instance of ScenegraphNode"),n=r.call(this,i),n.children=s,n}return(0,OZ.default)(e,[{key:"add",value:function(){for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];for(var s=0,u=a;s<u.length;s++){var l=u[s];Array.isArray(l)?this.add.apply(this,(0,wZ.default)(l)):this.children.push(l)}return this}},{key:"remove",value:function(i){var a=this.children,o=a.indexOf(i);return o>-1&&a.splice(o,1),this}},{key:"removeAll",value:function(){return this.children=[],this}},{key:"delete",value:function(){this.children.forEach(function(i){return i.delete()}),this.removeAll(),(0,EZ.default)((0,$0.default)(e.prototype),"delete",this).call(this)}},{key:"getBounds",value:function(){var i=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];return this.traverse(function(a,o){var s=o.worldMatrix,u=a.getBounds();if(u){var l=(0,TZ.default)(u,2),f=l[0],c=l[1],p=new j(f).add(c).divide([2,2,2]);s.transformAsPoint(p,p);var d=new j(c).subtract(f).divide([2,2,2]);s.transformAsVector(d,d);for(var v=0;v<8;v++)for(var m=new j(v&1?-1:1,v&2?-1:1,v&4?-1:1).multiply(d).add(p),g=0;g<3;g++)i[0][g]=Math.min(i[0][g],m[g]),i[1][g]=Math.max(i[1][g],m[g])}}),Number.isFinite(i[0][0])?i:null}},{key:"traverse",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=a.worldMatrix,s=o===void 0?new pe:o,u=new pe(s).multiplyRight(this.matrix),l=gCe(this.children),f;try{for(l.s();!(f=l.n()).done;){var c=f.value;c instanceof e?c.traverse(i,{worldMatrix:u}):i(c,{worldMatrix:u})}}catch(p){l.e(p)}finally{l.f()}}}]),e}(ta);var ZO=h(L()),JO=h(N());var xCe={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ACe={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function IZ(t){if(!t._animation){var r=ACe[t.componentType],e=xCe[t.type],n=e*t.count,i=t.bufferView.data,a=i.buffer,o=i.byteOffset,s=new r(a,o+(t.byteOffset||0),n);if(e===1)t._animation=Array.from(s);else{for(var u=[],l=0;l<s.length;l+=e)u.push(Array.from(s.slice(l,l+e)));t._animation=u}}return t._animation}var SCe=new pe;function TCe(t,r){if(r.matrix.identity(),t.translation&&r.matrix.translate(t.translation),t.rotation){var e=SCe.fromQuaternion(t.rotation);r.matrix.multiplyRight(e)}t.scale&&r.matrix.scale(t.scale)}var KO=new Bi;function wCe(t,r,e,n,i){if(r==="rotation"){KO.slerp({start:e,target:n,ratio:i});for(var a=0;a<KO.length;a++)t[r][a]=KO[a]}else for(var o=0;o<e.length;o++)t[r][o]=i*n[o]+(1-i)*e[o]}function PCe(t,r,e){for(var n=e.p0,i=e.outTangent0,a=e.inTangent1,o=e.p1,s=e.tDiff,u=e.ratio,l=0;l<t[r].length;l++){var f=i[l]*s,c=a[l]*s;t[r][l]=(2*Math.pow(u,3)-3*Math.pow(u,2)+1)*n[l]+(Math.pow(u,3)-2*Math.pow(u,2)+u)*f+(-2*Math.pow(u,3)+3*Math.pow(u,2))*o[l]+(Math.pow(u,3)-Math.pow(u,2))*c}}function OCe(t,r,e){for(var n=0;n<e.length;n++)t[r][n]=e[n]}function ECe(t,r,e,n){var i=r.input,a=r.interpolation,o=r.output,s=i[i.length-1],u=t%s,l=i.findIndex(function(x){return x>=u}),f=Math.max(0,l-1);if(!Array.isArray(e[n]))switch(n){case"translation":e[n]=[0,0,0];break;case"rotation":e[n]=[0,0,0,1];break;case"scale":e[n]=[1,1,1];break;default:ne.warn("Bad animation path ".concat(n))()}Z(e[n].length===o[f].length);var c=i[f],p=i[l];switch(a){case"STEP":OCe(e,n,o[f]);break;case"LINEAR":if(p>c){var d=(u-c)/(p-c);wCe(e,n,o[f],o[l],d)}break;case"CUBICSPLINE":if(p>c){var v=(u-c)/(p-c),m=p-c,g=o[3*f+1],y=o[3*f+2],_=o[3*l+0],b=o[3*l+1];PCe(e,n,{p0:g,outTangent0:y,inTangent1:_,p1:b,tDiff:m,ratio:v})}break;default:ne.warn("Interpolation ".concat(a," not supported"))();break}}var CCe=function(){function t(r){(0,ZO.default)(this,t),this.startTime=0,this.playing=!0,this.speed=1,this.channels=[],Object.assign(this,r)}return(0,JO.default)(t,[{key:"animate",value:function(e){if(this.playing){var n=e/1e3,i=(n-this.startTime)*this.speed;this.channels.forEach(function(a){var o=a.sampler,s=a.target,u=a.path;ECe(i,o,s,u),TCe(s,s._node)})}}}]),t}(),RZ=function(){function t(r){(0,ZO.default)(this,t),this.animations=r.animations.map(function(e,n){var i=e.name||"Animation-".concat(n),a=e.samplers.map(function(s){var u=s.input,l=s.interpolation,f=l===void 0?"LINEAR":l,c=s.output;return{input:IZ(r.accessors[u]),interpolation:f,output:IZ(r.accessors[c])}}),o=e.channels.map(function(s){var u=s.sampler,l=s.target;return{sampler:a[u],target:r.nodes[l.node],path:l.path}});return new CCe({name:i,channels:o})})}return(0,JO.default)(t,[{key:"animate",value:function(e){this.setTime(e)}},{key:"setTime",value:function(e){this.animations.forEach(function(n){return n.animate(e)})}},{key:"getAnimations",value:function(){return this.animations}}]),t}();var eE=h(Zt());var LZ=h(L()),kZ=h(N()),BZ=h(Ee()),FZ=h(Y()),DZ=h(K()),q0=h(q());function MCe(t){var r=ICe();return function(){var n=(0,q0.default)(t),i;if(r){var a=(0,q0.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,DZ.default)(this,i)}}function ICe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var NZ=function(t){(0,FZ.default)(e,t);var r=MCe(e);function e(n){var i;(0,LZ.default)(this,e);var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return i=r.call(this,a),i.onBeforeRender=null,i.AfterRender=null,n instanceof Ce?(i.model=n,i._setModelNodeProps(a)):i.model=new Ce(n,a),i.bounds=null,i.managedResources=a.managedResources||[],i}return(0,kZ.default)(e,[{key:"setProps",value:function(i){return(0,BZ.default)((0,q0.default)(e.prototype),"setProps",this).call(this,i),this._setModelNodeProps(i),this}},{key:"getBounds",value:function(){return this.bounds}},{key:"delete",value:function(){this.model&&(this.model.delete(),this.model=null),this.managedResources.forEach(function(i){return i.delete()}),this.managedResources=[]}},{key:"draw",value:function(){var i;return(i=this.model).draw.apply(i,arguments)}},{key:"setUniforms",value:function(){var i;return(i=this.model).setUniforms.apply(i,arguments),this}},{key:"setAttributes",value:function(){var i;return(i=this.model).setAttributes.apply(i,arguments),this}},{key:"updateModuleSettings",value:function(){var i;return(i=this.model).updateModuleSettings.apply(i,arguments),this}},{key:"_setModelNodeProps",value:function(i){this.model.setProps(i)}}]),e}(ta);var Y0=h(B()),UZ=h(L()),GZ=h(N());function jZ(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function QO(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?jZ(Object(e),!0).forEach(function(n){(0,Y0.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):jZ(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var md=function(){function t(r,e){(0,UZ.default)(this,t);var n=e.attributes,i=e.material,a=e.pbrDebug,o=e.imageBasedLightingEnvironment,s=e.lights,u=e.useTangents;this.gl=r,this.defines={MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},ti(r,Se.GLSL_TEXTURE_LOD)&&(this.defines.USE_TEX_LOD=1),this.uniforms={u_Camera:[0,0,0],u_MetallicRoughnessValues:[1,1]},this.parameters={},this.generatedTextures=[],o&&(this.uniforms.u_DiffuseEnvSampler=o.getDiffuseEnvSampler(),this.uniforms.u_SpecularEnvSampler=o.getSpecularEnvSampler(),this.uniforms.u_brdfLUT=o.getBrdfTexture(),this.uniforms.u_ScaleIBLAmbient=[1,1]),a&&(this.uniforms.u_ScaleDiffBaseMR=[0,0,0,0],this.uniforms.u_ScaleFGDSpec=[0,0,0,0]),this.defineIfPresent(n.NORMAL,"HAS_NORMALS"),this.defineIfPresent(n.TANGENT&&u,"HAS_TANGENTS"),this.defineIfPresent(n.TEXCOORD_0,"HAS_UV"),this.defineIfPresent(o,"USE_IBL"),this.defineIfPresent(s,"USE_LIGHTS"),this.defineIfPresent(a,"PBR_DEBUG"),i&&this.parseMaterial(i)}return(0,GZ.default)(t,[{key:"defineIfPresent",value:function(e,n){e&&(this.defines[n]=1)}},{key:"parseTexture",value:function(e,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,a=e.texture&&e.texture.sampler&&e.texture.sampler.parameters||{},o=e.texture.source.image,s,u={};o.compressed?(s=o,u=(0,Y0.default)({},this.gl.TEXTURE_MIN_FILTER,o.data.length>1?this.gl.LINEAR_MIPMAP_NEAREST:this.gl.LINEAR)):s={data:o};var l=new we(this.gl,QO({id:e.name||e.id,parameters:QO(QO({},a),u),pixelStore:(0,Y0.default)({},this.gl.UNPACK_FLIP_Y_WEBGL,!1)},s));this.uniforms[n]=l,this.defineIfPresent(i,i),this.generatedTextures.push(l)}},{key:"parsePbrMetallicRoughness",value:function(e){e.baseColorTexture&&this.parseTexture(e.baseColorTexture,"u_BaseColorSampler","HAS_BASECOLORMAP"),this.uniforms.u_BaseColorFactor=e.baseColorFactor||[1,1,1,1],e.metallicRoughnessTexture&&this.parseTexture(e.metallicRoughnessTexture,"u_MetallicRoughnessSampler","HAS_METALROUGHNESSMAP");var n=e.metallicFactor,i=n===void 0?1:n,a=e.roughnessFactor,o=a===void 0?1:a;this.uniforms.u_MetallicRoughnessValues=[i,o]}},{key:"parseMaterial",value:function(e){if(this.uniforms.pbr_uUnlit=Boolean(e.unlit),e.pbrMetallicRoughness&&this.parsePbrMetallicRoughness(e.pbrMetallicRoughness),e.normalTexture){this.parseTexture(e.normalTexture,"u_NormalSampler","HAS_NORMALMAP");var n=e.normalTexture.scale,i=n===void 0?1:n;this.uniforms.u_NormalScale=i}if(e.occlusionTexture){this.parseTexture(e.occlusionTexture,"u_OcclusionSampler","HAS_OCCLUSIONMAP");var a=e.occlusionTexture.strength,o=a===void 0?1:a;this.uniforms.u_OcclusionStrength=o}if(e.emissiveTexture&&(this.parseTexture(e.emissiveTexture,"u_EmissiveSampler","HAS_EMISSIVEMAP"),this.uniforms.u_EmissiveFactor=e.emissiveFactor||[0,0,0]),e.alphaMode==="MASK"){var s=e.alphaCutoff,u=s===void 0?.5:s;this.defines.ALPHA_CUTOFF=1,this.uniforms.u_AlphaCutoff=u}else e.alphaMode==="BLEND"&&(ne.warn("BLEND alphaMode might not work well because it requires mesh sorting")(),Object.assign(this.parameters,{blend:!0,blendEquation:this.gl.FUNC_ADD,blendFunc:[this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA]}))}},{key:"delete",value:function(){this.generatedTextures.forEach(function(e){return e.delete()})}}]),t}();var RCe=`
#if (__VERSION__ < 300)
  #define _attr attribute
#else
  #define _attr in
#endif

  _attr vec4 POSITION;

  #ifdef HAS_NORMALS
    _attr vec4 NORMAL;
  #endif

  #ifdef HAS_TANGENTS
    _attr vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    _attr vec2 TEXCOORD_0;
  #endif

  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = NORMAL;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = TEXCOORD_0;
    #endif

    pbr_setPositionNormalTangentUV(POSITION, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = u_MVPMatrix * POSITION;
  }
`,LCe=`
#if (__VERSION__ < 300)
  #define fragmentColor gl_FragColor
#else
  out vec4 fragmentColor;
#endif

  void main(void) {
    fragmentColor = pbr_filterColor(vec4(0));
  }
`;function zZ(t,r){return ce(t)?`#version 300 es
`.concat(r):r}function tE(t,r){var e=r.id,n=r.drawMode,i=r.vertexCount,a=r.attributes,o=r.modelOptions,s=new md(t,r);ne.info(4,"createGLTFModel defines: ",s.defines)();var u=[];u.push.apply(u,(0,eE.default)(s.generatedTextures)),u.push.apply(u,(0,eE.default)(Object.values(a).map(function(f){return f.buffer})));var l=new NZ(t,Object.assign({id:e,drawMode:n,vertexCount:i,modules:[go],defines:s.defines,parameters:s.parameters,vs:zZ(t,RCe),fs:zZ(t,LCe),managedResources:u},o));return l.setProps({attributes:a}),l.setUniforms(s.uniforms),l}var kCe={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},BCe={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1},WZ=function(){function t(r){(0,VZ.default)(this,t);var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=r,this.options=Object.assign({},BCe,e)}return(0,HZ.default)(t,[{key:"instantiate",value:function(e){var n=this;this.gltf=e;var i=(e.scenes||[]).map(function(a){return n.createScene(a)});return i}},{key:"createAnimator",value:function(){return Array.isArray(this.gltf.animations)?new RZ(this.gltf):null}},{key:"createScene",value:function(e){var n=this,i=e.nodes||[],a=i.map(function(s){return n.createNode(s)}),o=new X0({id:e.name||e.id,children:a});return o}},{key:"createNode",value:function(e){var n=this;if(!e._node){var i=e.children||[],a=i.map(function(u){return n.createNode(u)});e.mesh&&a.push(this.createMesh(e.mesh));var o=new X0({id:e.name||e.id,children:a});if(e.matrix)o.setMatrix(e.matrix);else{if(o.matrix.identity(),e.translation&&o.matrix.translate(e.translation),e.rotation){var s=new pe().fromQuaternion(e.rotation);o.matrix.multiplyRight(s)}e.scale&&o.matrix.scale(e.scale)}e._node=o}return e._node}},{key:"createMesh",value:function(e){var n=this;if(!e._mesh){var i=e.primitives||[],a=i.map(function(s,u){return n.createPrimitive(s,u,e)}),o=new X0({id:e.name||e.id,children:a});e._mesh=o}return e._mesh}},{key:"getVertexCount",value:function(e){ne.warn("getVertexCount() not found")()}},{key:"createPrimitive",value:function(e,n,i){var a=tE(this.gl,Object.assign({id:e.name||"".concat(i.name||i.id,"-primitive-").concat(n),drawMode:e.mode||4,vertexCount:e.indices?e.indices.count:this.getVertexCount(e.attributes),attributes:this.createAttributes(e.attributes,e.indices),material:e.material},this.options));return a.bounds=[e.attributes.POSITION.min,e.attributes.POSITION.max],a}},{key:"createAttributes",value:function(e,n){var i=this,a={};return Object.keys(e).forEach(function(o){a[o]=i.createAccessor(e[o],i.createBuffer(e[o],i.gl.ARRAY_BUFFER))}),n&&(a.indices=this.createAccessor(n,this.createBuffer(n,this.gl.ELEMENT_ARRAY_BUFFER))),ne.info(4,"glTF Attributes",{attributes:e,indices:n,generated:a})(),a}},{key:"createBuffer",value:function(e,n){e.bufferView||(e.bufferView={});var i=e.bufferView;return i.lumaBuffers||(i.lumaBuffers={}),i.lumaBuffers[n]||(i.lumaBuffers[n]=new xe(this.gl,{id:"from-".concat(i.id),data:i.data||e.value,target:n})),i.lumaBuffers[n]}},{key:"createAccessor",value:function(e,n){return new kr({buffer:n,offset:e.byteOffset||0,stride:e.bufferView.byteStride||0,type:e.componentType,size:kCe[e.type]})}},{key:"createSampler",value:function(e){return e}},{key:"needsPOT",value:function(){return!1}}]),t}();function K0(t,r,e){var n=new WZ(t,e),i=n.instantiate(r),a=n.createAnimator();return{scenes:i,animator:a}}var VQ=h(B()),HQ=h(ye()),gC=h(ve());var $Z="3.4.2";var Ed=h(ye()),Ha=h(ve());var XZ="3.4.2";var hJ=h(B());var uJ=h(ze()),lJ=h(ye()),pE=h(ve());var uE=h(me()),gd=h(ye()),za=h(ve());var qZ="3.4.2",FCe="https://unpkg.com/@loaders.gl/textures@".concat(qZ,"/dist/libs/basis_encoder.wasm"),DCe="https://unpkg.com/@loaders.gl/textures@".concat(qZ,"/dist/libs/basis_encoder.js"),rE;function lE(t){return iE.apply(this,arguments)}function iE(){return iE=(0,gd.default)(za.default.mark(function t(r){var e;return za.default.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(e=r.modules||{},!e.basis){i.next=3;break}return i.abrupt("return",e.basis);case 3:return rE=rE||NCe(r),i.next=6,rE;case 6:return i.abrupt("return",i.sent);case 7:case"end":return i.stop()}},t)})),iE.apply(this,arguments)}function NCe(t){return aE.apply(this,arguments)}function aE(){return aE=(0,gd.default)(za.default.mark(function t(r){var e,n,i,a;return za.default.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return e=null,n=null,s.t0=Promise,s.next=5,Ei("basis_transcoder.js","textures",r);case 5:return s.t1=s.sent,s.next=8,Ei("basis_transcoder.wasm","textures",r);case 8:return s.t2=s.sent,s.t3=[s.t1,s.t2],s.next=12,s.t0.all.call(s.t0,s.t3);case 12:return i=s.sent,a=(0,uE.default)(i,2),e=a[0],n=a[1],e=e||globalThis.BASIS,s.next=19,jCe(e,n);case 19:return s.abrupt("return",s.sent);case 20:case"end":return s.stop()}},t)})),aE.apply(this,arguments)}function jCe(t,r){var e={};return r&&(e.wasmBinary=r),new Promise(function(n){t(e).then(function(i){var a=i.BasisFile,o=i.initializeBasis;o(),n({BasisFile:a})})})}var nE;function fE(t){return oE.apply(this,arguments)}function oE(){return oE=(0,gd.default)(za.default.mark(function t(r){var e;return za.default.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(e=r.modules||{},!e.basisEncoder){i.next=3;break}return i.abrupt("return",e.basisEncoder);case 3:return nE=nE||UCe(r),i.next=6,nE;case 6:return i.abrupt("return",i.sent);case 7:case"end":return i.stop()}},t)})),oE.apply(this,arguments)}function UCe(t){return sE.apply(this,arguments)}function sE(){return sE=(0,gd.default)(za.default.mark(function t(r){var e,n,i,a;return za.default.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return e=null,n=null,s.t0=Promise,s.next=5,Ei(DCe,"textures",r);case 5:return s.t1=s.sent,s.next=8,Ei(FCe,"textures",r);case 8:return s.t2=s.sent,s.t3=[s.t1,s.t2],s.next=12,s.t0.all.call(s.t0,s.t3);case 12:return i=s.sent,a=(0,uE.default)(i,2),e=a[0],n=a[1],e=e||globalThis.BASIS,s.next=19,GCe(e,n);case 19:return s.abrupt("return",s.sent);case 20:case"end":return s.stop()}},t)})),sE.apply(this,arguments)}function GCe(t,r){var e={};return r&&(e.wasmBinary=r),new Promise(function(n){t(e).then(function(i){var a=i.BasisFile,o=i.KTX2File,s=i.initializeBasis,u=i.BasisEncoder;s(),n({BasisFile:a,KTX2File:o,BasisEncoder:u})})})}var cu={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35987,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,COMPRESSED_RGBA_ASTC_4X4_KHR:37808,COMPRESSED_RGBA_ASTC_5X4_KHR:37809,COMPRESSED_RGBA_ASTC_5X5_KHR:37810,COMPRESSED_RGBA_ASTC_6X5_KHR:37811,COMPRESSED_RGBA_ASTC_6X6_KHR:37812,COMPRESSED_RGBA_ASTC_8X5_KHR:37813,COMPRESSED_RGBA_ASTC_8X6_KHR:37814,COMPRESSED_RGBA_ASTC_8X8_KHR:37815,COMPRESSED_RGBA_ASTC_10X5_KHR:37816,COMPRESSED_RGBA_ASTC_10X6_KHR:37817,COMPRESSED_RGBA_ASTC_10X8_KHR:37818,COMPRESSED_RGBA_ASTC_10X10_KHR:37819,COMPRESSED_RGBA_ASTC_12X10_KHR:37820,COMPRESSED_RGBA_ASTC_12X12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR:37853,COMPRESSED_RED_RGTC1_EXT:36283,COMPRESSED_SIGNED_RED_RGTC1_EXT:36284,COMPRESSED_RED_GREEN_RGTC2_EXT:36285,COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT:36286,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919};function zCe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=VCe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function VCe(t,r){if(t){if(typeof t=="string")return YZ(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return YZ(t,r)}}function YZ(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var HCe=["","WEBKIT_","MOZ_"],KZ={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"},Z0=null;function ZZ(t){if(!Z0){t=t||WCe()||void 0,Z0=new Set;var r=zCe(HCe),e;try{for(r.s();!(e=r.n()).done;){var n=e.value;for(var i in KZ)if(t&&t.getExtension("".concat(n).concat(i))){var a=KZ[i];Z0.add(a)}}}catch(o){r.e(o)}finally{r.f()}}return Z0}function WCe(){try{var t=document.createElement("canvas");return t.getContext("webgl")}catch{return null}}var Hpt=new Uint8Array([0]);var JZ,QZ,eJ,tJ,rJ,nJ,iJ,aJ;(function(t){t[t.NONE=0]="NONE",t[t.BASISLZ=1]="BASISLZ",t[t.ZSTD=2]="ZSTD",t[t.ZLIB=3]="ZLIB"})(JZ||(JZ={})),function(t){t[t.BASICFORMAT=0]="BASICFORMAT"}(QZ||(QZ={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.ETC1S=163]="ETC1S",t[t.UASTC=166]="UASTC"}(eJ||(eJ={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.SRGB=1]="SRGB"}(tJ||(tJ={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.LINEAR=1]="LINEAR",t[t.SRGB=2]="SRGB",t[t.ITU=3]="ITU",t[t.NTSC=4]="NTSC",t[t.SLOG=5]="SLOG",t[t.SLOG2=6]="SLOG2"}(rJ||(rJ={})),function(t){t[t.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",t[t.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(nJ||(nJ={})),function(t){t[t.RGB=0]="RGB",t[t.RRR=3]="RRR",t[t.GGG=4]="GGG",t[t.AAA=15]="AAA"}(iJ||(iJ={})),function(t){t[t.RGB=0]="RGB",t[t.RGBA=3]="RGBA",t[t.RRR=4]="RRR",t[t.RRRG=5]="RRRG"}(aJ||(aJ={}));var mn=[171,75,84,88,32,50,48,187,13,10,26,10];function oJ(t){var r=new Uint8Array(t),e=r.byteLength<mn.length||r[0]!==mn[0]||r[1]!==mn[1]||r[2]!==mn[2]||r[3]!==mn[3]||r[4]!==mn[4]||r[5]!==mn[5]||r[6]!==mn[6]||r[7]!==mn[7]||r[8]!==mn[8]||r[9]!==mn[9]||r[10]!==mn[10]||r[11]!==mn[11];return!e}var $Ce={etc1:{basisFormat:0,compressed:!0,format:cu.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:cu.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:cu.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:cu.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:cu.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:cu.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};function dE(t,r){return hE.apply(this,arguments)}function hE(){return hE=(0,lJ.default)(pE.default.mark(function t(r,e){var n,i,a,o,s,u;return pE.default.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(e.basis.containerFormat!=="auto"){f.next=11;break}if(!oJ(r)){f.next=6;break}return f.next=4,fE(e);case 4:return n=f.sent,f.abrupt("return",sJ(n.KTX2File,r,e));case 6:return f.next=8,lE(e);case 8:return i=f.sent,a=i.BasisFile,f.abrupt("return",cE(a,r,e));case 11:f.t0=e.basis.module,f.next=f.t0==="encoder"?14:(f.t0==="transcoder",22);break;case 14:return f.next=16,fE(e);case 16:o=f.sent,f.t1=e.basis.containerFormat,f.next=f.t1==="ktx2"?20:(f.t1==="basis",21);break;case 20:return f.abrupt("return",sJ(o.KTX2File,r,e));case 21:return f.abrupt("return",cE(o.BasisFile,r,e));case 22:return f.next=24,lE(e);case 24:return s=f.sent,u=s.BasisFile,f.abrupt("return",cE(u,r,e));case 27:case"end":return f.stop()}},t)})),hE.apply(this,arguments)}function cE(t,r,e){var n=new t(new Uint8Array(r));try{if(!n.startTranscoding())throw new Error("Failed to start basis transcoding");for(var i=n.getNumImages(),a=[],o=0;o<i;o++){for(var s=n.getNumLevels(o),u=[],l=0;l<s;l++)u.push(XCe(n,o,l,e));a.push(u)}return a}finally{n.close(),n.delete()}}function XCe(t,r,e,n){var i=t.getImageWidth(r,e),a=t.getImageHeight(r,e),o=t.getHasAlpha(),s=fJ(n,o),u=s.compressed,l=s.format,f=s.basisFormat,c=t.getImageTranscodedSizeInBytes(r,e,f),p=new Uint8Array(c);if(!t.transcodeImage(p,r,e,f,0,0))throw new Error("failed to start Basis transcoding");return{width:i,height:a,data:p,compressed:u,format:l,hasAlpha:o}}function sJ(t,r,e){var n=new t(new Uint8Array(r));try{if(!n.startTranscoding())throw new Error("failed to start KTX2 transcoding");for(var i=n.getLevels(),a=[],o=0;o<i;o++){a.push(qCe(n,o,e));break}return[a]}finally{n.close(),n.delete()}}function qCe(t,r,e){var n=t.getImageLevelInfo(r,0,0),i=n.alphaFlag,a=n.height,o=n.width,s=fJ(e,i),u=s.compressed,l=s.format,f=s.basisFormat,c=t.getImageTranscodedSizeInBytes(r,0,0,f),p=new Uint8Array(c);if(!t.transcodeImage(p,r,0,0,f,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:o,height:a,data:p,compressed:u,levelSize:c,hasAlpha:i,format:l}}function fJ(t,r){var e=t&&t.basis&&t.basis.format;return e==="auto"&&(e=J0()),(0,uJ.default)(e)==="object"&&(e=r?e.alpha:e.noAlpha),e=e.toLowerCase(),$Ce[e]}function J0(){var t=ZZ();return t.has("astc")?"astc-4x4":t.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:t.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:t.has("etc1")?"etc1":t.has("etc2")?"etc2":"rgb565"}function cJ(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function pJ(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?cJ(Object(e),!0).forEach(function(n){(0,hJ.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):cJ(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var dJ={name:"Basis",id:Lr?"basis":"basis-nodejs",module:"textures",version:XZ,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},vE=pJ(pJ({},dJ),{},{parse:dE});function lr(t,r){if(!t)throw new Error(r||"assert failed: gltf")}function mE(t,r){var e=t.startsWith("data:")||t.startsWith("http:")||t.startsWith("https:");if(e)return t;var n=r.baseUri||r.uri;if(!n)throw new Error("'baseUri' must be provided to resolve relative url ".concat(t));return n.substr(0,n.lastIndexOf("/")+1)+t}function vJ(t,r,e){var n=t.bufferViews[e];lr(n);var i=n.buffer,a=r[i];lr(a);var o=(n.byteOffset||0)+a.byteOffset;return new Uint8Array(a.arrayBuffer,o,n.byteLength)}var _Q=h(ye()),oC=h(ve());var wE={};un(wE,{decode:()=>mMe,name:()=>vMe});var SE=h(ye()),_d=h(ve());var bJ=h(ze()),xJ=h(B()),AJ=h(L()),SJ=h(N());var mJ=["SCALAR","VEC2","VEC3","VEC4"],YCe=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],KCe=new Map(YCe),ZCe={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},JCe={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},QCe={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function Q0(t){var r=mJ[t-1];return r||mJ[0]}function e_(t){var r=KCe.get(t.constructor);if(!r)throw new Error("Illegal typed array");return r}function Tf(t,r){var e=QCe[t.componentType],n=ZCe[t.type],i=JCe[t.componentType],a=t.count*n,o=t.count*n*i;return lr(o>=0&&o<=r.byteLength),{ArrayType:e,length:a,byteLength:o}}function yd(t){var r=t.images,e=t.bufferViews;r=r||[],e=e||[];var n=r.map(function(o){return o.bufferView});e=e.filter(function(o){return!n.includes(o)});var i=e.reduce(function(o,s){return o+s.byteLength},0),a=r.reduce(function(o,s){var u=s.image,l=u.width,f=u.height;return o+l*f},0);return i+Math.ceil(4*a*1.33)}function gJ(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=eMe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function eMe(t,r){if(t){if(typeof t=="string")return yJ(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return yJ(t,r)}}function yJ(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function _J(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function tMe(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?_J(Object(e),!0).forEach(function(n){(0,xJ.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):_J(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var rMe={asset:{version:"2.0",generator:"loaders.gl"},buffers:[]},It=function(){function t(r){(0,AJ.default)(this,t),w(this,"gltf",void 0),w(this,"sourceBuffers",void 0),w(this,"byteLength",void 0),this.gltf=r||{json:tMe({},rMe),buffers:[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}return(0,SJ.default)(t,[{key:"json",get:function(){return this.gltf.json}},{key:"getApplicationData",value:function(e){var n=this.json[e];return n}},{key:"getExtraData",value:function(e){var n=this.json.extras||{};return n[e]}},{key:"getExtension",value:function(e){var n=this.getUsedExtensions().find(function(a){return a===e}),i=this.json.extensions||{};return n?i[e]||!0:null}},{key:"getRequiredExtension",value:function(e){var n=this.getRequiredExtensions().find(function(i){return i===e});return n?this.getExtension(e):null}},{key:"getRequiredExtensions",value:function(){return this.json.extensionsRequired||[]}},{key:"getUsedExtensions",value:function(){return this.json.extensionsUsed||[]}},{key:"getRemovedExtensions",value:function(){return this.json.extensionsRemoved||[]}},{key:"getObjectExtension",value:function(e,n){var i=e.extensions||{};return i[n]}},{key:"getScene",value:function(e){return this.getObject("scenes",e)}},{key:"getNode",value:function(e){return this.getObject("nodes",e)}},{key:"getSkin",value:function(e){return this.getObject("skins",e)}},{key:"getMesh",value:function(e){return this.getObject("meshes",e)}},{key:"getMaterial",value:function(e){return this.getObject("materials",e)}},{key:"getAccessor",value:function(e){return this.getObject("accessors",e)}},{key:"getTexture",value:function(e){return this.getObject("textures",e)}},{key:"getSampler",value:function(e){return this.getObject("samplers",e)}},{key:"getImage",value:function(e){return this.getObject("images",e)}},{key:"getBufferView",value:function(e){return this.getObject("bufferViews",e)}},{key:"getBuffer",value:function(e){return this.getObject("buffers",e)}},{key:"getObject",value:function(e,n){if((0,bJ.default)(n)==="object")return n;var i=this.json[e]&&this.json[e][n];if(!i)throw new Error("glTF file error: Could not find ".concat(e,"[").concat(n,"]"));return i}},{key:"getTypedArrayForBufferView",value:function(e){e=this.getBufferView(e);var n=e.buffer,i=this.gltf.buffers[n];lr(i);var a=(e.byteOffset||0)+i.byteOffset;return new Uint8Array(i.arrayBuffer,a,e.byteLength)}},{key:"getTypedArrayForAccessor",value:function(e){e=this.getAccessor(e);var n=this.getBufferView(e.bufferView),i=this.getBuffer(n.buffer),a=i.data,o=Tf(e,n),s=o.ArrayType,u=o.length,l=n.byteOffset+e.byteOffset;return new s(a,l,u)}},{key:"getTypedArrayForImageData",value:function(e){e=this.getAccessor(e);var n=this.getBufferView(e.bufferView),i=this.getBuffer(n.buffer),a=i.data,o=n.byteOffset||0;return new Uint8Array(a,o,n.byteLength)}},{key:"addApplicationData",value:function(e,n){return this.json[e]=n,this}},{key:"addExtraData",value:function(e,n){return this.json.extras=this.json.extras||{},this.json.extras[e]=n,this}},{key:"addObjectExtension",value:function(e,n,i){return e.extensions=e.extensions||{},e.extensions[n]=i,this.registerUsedExtension(n),this}},{key:"setObjectExtension",value:function(e,n,i){var a=e.extensions||{};a[n]=i}},{key:"removeObjectExtension",value:function(e,n){var i=e.extensions||{},a=i[n];return delete i[n],a}},{key:"addExtension",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return lr(n),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=n,this.registerUsedExtension(e),n}},{key:"addRequiredExtension",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return lr(n),this.addExtension(e,n),this.registerRequiredExtension(e),n}},{key:"registerUsedExtension",value:function(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(function(n){return n===e})||this.json.extensionsUsed.push(e)}},{key:"registerRequiredExtension",value:function(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(function(n){return n===e})||this.json.extensionsRequired.push(e)}},{key:"removeExtension",value:function(e){if(this.getExtension(e)){this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e),this.json.extensions&&delete this.json.extensions[e],Array.isArray(this.json.extensionsRemoved)||(this.json.extensionsRemoved=[]);var n=this.json.extensionsRemoved;n.includes(e)||n.push(e)}}},{key:"setDefaultScene",value:function(e){this.json.scene=e}},{key:"addScene",value:function(e){var n=e.nodeIndices;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:n}),this.json.scenes.length-1}},{key:"addNode",value:function(e){var n=e.meshIndex,i=e.matrix;this.json.nodes=this.json.nodes||[];var a={mesh:n};return i&&(a.matrix=i),this.json.nodes.push(a),this.json.nodes.length-1}},{key:"addMesh",value:function(e){var n=e.attributes,i=e.indices,a=e.material,o=e.mode,s=o===void 0?4:o,u=this._addAttributes(n),l={primitives:[{attributes:u,mode:s}]};if(i){var f=this._addIndices(i);l.primitives[0].indices=f}return Number.isFinite(a)&&(l.primitives[0].material=a),this.json.meshes=this.json.meshes||[],this.json.meshes.push(l),this.json.meshes.length-1}},{key:"addPointCloud",value:function(e){var n=this._addAttributes(e),i={primitives:[{attributes:n,mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(i),this.json.meshes.length-1}},{key:"addImage",value:function(e,n){var i=ds(e),a=n||i?.mimeType,o=this.addBufferView(e),s={bufferView:o,mimeType:a};return this.json.images=this.json.images||[],this.json.images.push(s),this.json.images.length-1}},{key:"addBufferView",value:function(e){var n=e.byteLength;lr(Number.isFinite(n)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);var i={buffer:0,byteOffset:this.byteLength,byteLength:n};return this.byteLength+=ao(n,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(i),this.json.bufferViews.length-1}},{key:"addAccessor",value:function(e,n){var i={bufferView:e,type:Q0(n.size),componentType:n.componentType,count:n.count,max:n.max,min:n.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(i),this.json.accessors.length-1}},{key:"addBinaryBuffer",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{size:3},i=this.addBufferView(e),a={min:n.min,max:n.max};(!a.min||!a.max)&&(a=this._getAccessorMinMax(e,n.size));var o={size:n.size,componentType:e_(e),count:Math.round(e.length/n.size),min:a.min,max:a.max};return this.addAccessor(i,Object.assign(o,n))}},{key:"addTexture",value:function(e){var n=e.imageIndex,i={source:n};return this.json.textures=this.json.textures||[],this.json.textures.push(i),this.json.textures.length-1}},{key:"addMaterial",value:function(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}},{key:"createBinaryChunk",value:function(){var e,n;this.gltf.buffers=[];var i=this.byteLength,a=new ArrayBuffer(i),o=new Uint8Array(a),s=0,u=gJ(this.sourceBuffers||[]),l;try{for(u.s();!(l=u.n()).done;){var f=l.value;s=j1(f,o,s)}}catch(c){u.e(c)}finally{u.f()}(e=this.json)!==null&&e!==void 0&&(n=e.buffers)!==null&&n!==void 0&&n[0]?this.json.buffers[0].byteLength=i:this.json.buffers=[{byteLength:i}],this.gltf.binary=a,this.sourceBuffers=[a]}},{key:"_removeStringFromArray",value:function(e,n){for(var i=!0;i;){var a=e.indexOf(n);a>-1?e.splice(a,1):i=!1}}},{key:"_addAttributes",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n={};for(var i in e){var a=e[i],o=this._getGltfAttributeName(i),s=this.addBinaryBuffer(a.value,a);n[o]=s}return n}},{key:"_addIndices",value:function(e){return this.addBinaryBuffer(e,{size:1})}},{key:"_getGltfAttributeName",value:function(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}},{key:"_getAccessorMinMax",value:function(e,n){var i={min:null,max:null};if(e.length<n)return i;i.min=[],i.max=[];var a=e.subarray(0,n),o=gJ(a),s;try{for(o.s();!(s=o.n()).done;){var u=s.value;i.min.push(u),i.max.push(u)}}catch(c){o.e(c)}finally{o.f()}for(var l=n;l<e.length;l+=n)for(var f=0;f<n;f++)i.min[0+f]=Math.min(i.min[0+f],e[l+f]),i.max[0+f]=Math.max(i.max[0+f],e[l+f]);return i}}]),t}();var t_=h(ye()),TJ=h(ze()),pu=h(ve()),_ht=(typeof WebAssembly>"u"?"undefined":(0,TJ.default)(WebAssembly))!=="object",nMe="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",iMe="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",aMe=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),oMe=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),sMe={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},uMe={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};function wJ(t,r,e,n,i){return yE.apply(this,arguments)}function yE(){return yE=(0,t_.default)(pu.default.mark(function t(r,e,n,i,a){var o,s,u=arguments;return pu.default.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return o=u.length>5&&u[5]!==void 0?u[5]:"NONE",f.next=3,lMe();case 3:s=f.sent,pMe(s,s.exports[uMe[a]],r,e,n,i,s.exports[sMe[o||"NONE"]]);case 5:case"end":return f.stop()}},t)})),yE.apply(this,arguments)}var gE;function lMe(){return _E.apply(this,arguments)}function _E(){return _E=(0,t_.default)(pu.default.mark(function t(){return pu.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return gE||(gE=fMe()),e.abrupt("return",gE);case 2:case"end":return e.stop()}},t)})),_E.apply(this,arguments)}function fMe(){return bE.apply(this,arguments)}function bE(){return bE=(0,t_.default)(pu.default.mark(function t(){var r,e;return pu.default.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return r=nMe,WebAssembly.validate(aMe)&&(r=iMe,console.log("Warning: meshopt_decoder is using experimental SIMD support")),i.next=4,WebAssembly.instantiate(cMe(r),{});case 4:return e=i.sent,i.next=7,e.instance.exports.__wasm_call_ctors();case 7:return i.abrupt("return",e.instance);case 8:case"end":return i.stop()}},t)})),bE.apply(this,arguments)}function cMe(t){for(var r=new Uint8Array(t.length),e=0;e<t.length;++e){var n=t.charCodeAt(e);r[e]=n>96?n-71:n>64?n-65:n>47?n+4:n>46?63:62}for(var i=0,a=0;a<t.length;++a)r[i++]=r[a]<60?oMe[r[a]]:(r[a]-60)*64+r[++a];return r.buffer.slice(0,i)}function pMe(t,r,e,n,i,a,o){var s=t.exports.sbrk,u=n+3&-4,l=s(u*i),f=s(a.length),c=new Uint8Array(t.exports.memory.buffer);c.set(a,f);var p=r(l,n,i,f,a.length);if(p===0&&o&&o(l,u,i),e.set(c.subarray(l,l+n*i)),s(l-s(0)),p!==0)throw new Error("Malformed buffer data: ".concat(p))}function hMe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=dMe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function dMe(t,r){if(t){if(typeof t=="string")return PJ(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return PJ(t,r)}}function PJ(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var TE="EXT_meshopt_compression",vMe=TE;function mMe(t,r){return xE.apply(this,arguments)}function xE(){return xE=(0,SE.default)(_d.default.mark(function t(r,e){var n,i,a,o,s,u;return _d.default.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(i=new It(r),e!=null&&(n=e.gltf)!==null&&n!==void 0&&n.decompressMeshes){f.next=3;break}return f.abrupt("return");case 3:a=[],o=hMe(r.json.bufferViews||[]);try{for(o.s();!(s=o.n()).done;)u=s.value,a.push(gMe(i,u))}catch(c){o.e(c)}finally{o.f()}return f.next=8,Promise.all(a);case 8:i.removeExtension(TE);case 9:case"end":return f.stop()}},t)})),xE.apply(this,arguments)}function gMe(t,r){return AE.apply(this,arguments)}function AE(){return AE=(0,SE.default)(_d.default.mark(function t(r,e){var n,i,a,o,s,u,l,f,c,p,d,v,m,g;return _d.default.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(n=r.getObjectExtension(e,TE),!n){_.next=9;break}return i=n.byteOffset,a=i===void 0?0:i,o=n.byteLength,s=o===void 0?0:o,u=n.byteStride,l=n.count,f=n.mode,c=n.filter,p=c===void 0?"NONE":c,d=n.buffer,v=r.gltf.buffers[d],m=new Uint8Array(v.arrayBuffer,v.byteOffset+a,s),g=new Uint8Array(r.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength),_.next=8,wJ(g,l,u,m,f,p);case 8:return _.abrupt("return",g);case 9:return _.abrupt("return",null);case 10:case"end":return _.stop()}},t)})),AE.apply(this,arguments)}var PE={};un(PE,{name:()=>bMe,preprocess:()=>xMe});function yMe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=_Me(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function _Me(t,r){if(t){if(typeof t=="string")return OJ(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return OJ(t,r)}}function OJ(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var wf="EXT_texture_webp",bMe=wf;function xMe(t,r){var e=new It(t);if(!Zx("image/webp")){if(e.getRequiredExtensions().includes(wf))throw new Error("gltf: Required extension ".concat(wf," not supported by browser"));return}var n=e.json,i=yMe(n.textures||[]),a;try{for(i.s();!(a=i.n()).done;){var o=a.value,s=e.getObjectExtension(o,wf);s&&(o.source=s.source),e.removeObjectExtension(o,wf)}}catch(u){i.e(u)}finally{i.f()}e.removeExtension(wf)}var OE={};un(OE,{name:()=>TMe,preprocess:()=>wMe});function AMe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=SMe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function SMe(t,r){if(t){if(typeof t=="string")return EJ(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return EJ(t,r)}}function EJ(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var r_="KHR_texture_basisu",TMe=r_;function wMe(t,r){var e=new It(t),n=e.json,i=AMe(n.textures||[]),a;try{for(i.s();!(a=i.n()).done;){var o=a.value,s=e.getObjectExtension(o,r_);s&&(o.source=s.source),e.removeObjectExtension(o,r_)}}catch(u){i.e(u)}finally{i.f()}e.removeExtension(r_)}var GE={};un(GE,{decode:()=>KMe,encode:()=>ZMe,name:()=>qMe,preprocess:()=>YMe});var rQ=h(me()),NE=h(B()),jE=h(ye()),hu=h(ve());var ZJ=h(ye()),JJ=h(B()),LE=h(ve());var MJ=h(ze());var CJ="3.4.2";var PMe={draco:{decoderType:(typeof WebAssembly>"u"?"undefined":(0,MJ.default)(WebAssembly))==="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}},IJ={name:"Draco",id:Lr?"draco":"draco-nodejs",module:"draco",shapes:["mesh"],version:CJ,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:PMe};var EE=h(Zt()),jJ=h(me()),UJ=h(B()),GJ=h(L()),zJ=h(N());function LJ(t,r,e){var n=kJ(r.metadata),i=[],a=OMe(r.attributes);for(var o in t){var s=t[o],u=RJ(o,s,a[o]);i.push(u)}if(e){var l=RJ("indices",e);i.push(l)}return new cd(i,n)}function OMe(t){var r={};for(var e in t){var n=t[e];r[n.name||"undefined"]=n}return r}function RJ(t,r,e){var n=e?kJ(e.metadata):void 0,i=YO(t,r,n);return i}function kJ(t){var r=new Map;for(var e in t)r.set("".concat(e,".string"),JSON.stringify(t[e]));return r}function EMe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=CMe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function CMe(t,r){if(t){if(typeof t=="string")return BJ(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return BJ(t,r)}}function BJ(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function FJ(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function DJ(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?FJ(Object(e),!0).forEach(function(n){(0,UJ.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):FJ(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var NJ={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},MMe={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},IMe=4,VJ=function(){function t(r){(0,GJ.default)(this,t),w(this,"draco",void 0),w(this,"decoder",void 0),w(this,"metadataQuerier",void 0),this.draco=r,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}return(0,zJ.default)(t,[{key:"destroy",value:function(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}},{key:"parseSync",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=new this.draco.DecoderBuffer;i.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(n);var a=this.decoder.GetEncodedGeometryType(i),o=a===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{var s;switch(a){case this.draco.TRIANGULAR_MESH:s=this.decoder.DecodeBufferToMesh(i,o);break;case this.draco.POINT_CLOUD:s=this.decoder.DecodeBufferToPointCloud(i,o);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!s.ok()||!o.ptr){var u="DRACO decompression failed: ".concat(s.error_msg());throw new Error(u)}var l=this._getDracoLoaderData(o,a,n),f=this._getMeshData(o,l,n),c=Ua(f.attributes),p=LJ(f.attributes,l,f.indices),d=DJ(DJ({loader:"draco",loaderData:l,header:{vertexCount:o.num_points(),boundingBox:c}},f),{},{schema:p});return d}finally{this.draco.destroy(i),o&&this.draco.destroy(o)}}},{key:"_getDracoLoaderData",value:function(e,n,i){var a=this._getTopLevelMetadata(e),o=this._getDracoAttributes(e,i);return{geometry_type:n,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:a,attributes:o}}},{key:"_getDracoAttributes",value:function(e,n){for(var i={},a=0;a<e.num_attributes();a++){var o=this.decoder.GetAttribute(e,a),s=this._getAttributeMetadata(e,a);i[o.unique_id()]={unique_id:o.unique_id(),attribute_type:o.attribute_type(),data_type:o.data_type(),num_components:o.num_components(),byte_offset:o.byte_offset(),byte_stride:o.byte_stride(),normalized:o.normalized(),attribute_index:a,metadata:s};var u=this._getQuantizationTransform(o,n);u&&(i[o.unique_id()].quantization_transform=u);var l=this._getOctahedronTransform(o,n);l&&(i[o.unique_id()].octahedron_transform=l)}return i}},{key:"_getMeshData",value:function(e,n,i){var a=this._getMeshAttributes(n,e,i),o=a.POSITION;if(!o)throw new Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)switch(i.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:a,indices:{value:this._getTriangleStripIndices(e),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:a,indices:{value:this._getTriangleListIndices(e),size:1}}}return{topology:"point-list",mode:0,attributes:a}}},{key:"_getMeshAttributes",value:function(e,n,i){for(var a={},o=0,s=Object.values(e.attributes);o<s.length;o++){var u=s[o],l=this._deduceAttributeName(u,i);u.name=l;var f=this._getAttributeValues(n,u),c=f.value,p=f.size;a[l]={value:c,size:p,byteOffset:u.byte_offset,byteStride:u.byte_stride,normalized:u.normalized}}return a}},{key:"_getTriangleListIndices",value:function(e){var n=e.num_faces(),i=n*3,a=i*IMe,o=this.draco._malloc(a);try{return this.decoder.GetTrianglesUInt32Array(e,a,o),new Uint32Array(this.draco.HEAPF32.buffer,o,i).slice()}finally{this.draco._free(o)}}},{key:"_getTriangleStripIndices",value:function(e){var n=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,n),kMe(n)}finally{this.draco.destroy(n)}}},{key:"_getAttributeValues",value:function(e,n){var i=MMe[n.data_type],a=n.num_components,o=e.num_points(),s=o*a,u=s*i.BYTES_PER_ELEMENT,l=RMe(this.draco,i),f,c=this.draco._malloc(u);try{var p=this.decoder.GetAttribute(e,n.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,p,l,u,c),f=new i(this.draco.HEAPF32.buffer,c,s).slice()}finally{this.draco._free(c)}return{value:f,size:a}}},{key:"_deduceAttributeName",value:function(e,n){for(var i=e.unique_id,a=0,o=Object.entries(n.extraAttributes||{});a<o.length;a++){var s=(0,jJ.default)(o[a],2),u=s[0],l=s[1];if(l===i)return u}var f=e.attribute_type;for(var c in NJ){var p=this.draco[c];if(p===f)return NJ[c]}var d=n.attributeNameEntry||"name";return e.metadata[d]?e.metadata[d].string:"CUSTOM_ATTRIBUTE_".concat(i)}},{key:"_getTopLevelMetadata",value:function(e){var n=this.decoder.GetMetadata(e);return this._getDracoMetadata(n)}},{key:"_getAttributeMetadata",value:function(e,n){var i=this.decoder.GetAttributeMetadata(e,n);return this._getDracoMetadata(i)}},{key:"_getDracoMetadata",value:function(e){if(!e||!e.ptr)return{};for(var n={},i=this.metadataQuerier.NumEntries(e),a=0;a<i;a++){var o=this.metadataQuerier.GetEntryName(e,a);n[o]=this._getDracoMetadataField(e,o)}return n}},{key:"_getDracoMetadataField",value:function(e,n){var i=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,n,i);var a=LMe(i);return{int:this.metadataQuerier.GetIntEntry(e,n),string:this.metadataQuerier.GetStringEntry(e,n),double:this.metadataQuerier.GetDoubleEntry(e,n),intArray:a}}finally{this.draco.destroy(i)}}},{key:"_disableAttributeTransforms",value:function(e){var n=e.quantizedAttributes,i=n===void 0?[]:n,a=e.octahedronAttributes,o=a===void 0?[]:a,s=[].concat((0,EE.default)(i),(0,EE.default)(o)),u=EMe(s),l;try{for(u.s();!(l=u.n()).done;){var f=l.value;this.decoder.SkipAttributeTransform(this.draco[f])}}catch(c){u.e(c)}finally{u.f()}}},{key:"_getQuantizationTransform",value:function(e,n){var i=this,a=n.quantizedAttributes,o=a===void 0?[]:a,s=e.attribute_type(),u=o.map(function(f){return i.decoder[f]}).includes(s);if(u){var l=new this.draco.AttributeQuantizationTransform;try{if(l.InitFromAttribute(e))return{quantization_bits:l.quantization_bits(),range:l.range(),min_values:new Float32Array([1,2,3]).map(function(f){return l.min_value(f)})}}finally{this.draco.destroy(l)}}return null}},{key:"_getOctahedronTransform",value:function(e,n){var i=this,a=n.octahedronAttributes,o=a===void 0?[]:a,s=e.attribute_type(),u=o.map(function(f){return i.decoder[f]}).includes(s);if(u){var l=new this.draco.AttributeQuantizationTransform;try{if(l.InitFromAttribute(e))return{quantization_bits:l.quantization_bits()}}finally{this.draco.destroy(l)}}return null}}]),t}();function RMe(t,r){switch(r){case Float32Array:return t.DT_FLOAT32;case Int8Array:return t.DT_INT8;case Int16Array:return t.DT_INT16;case Int32Array:return t.DT_INT32;case Uint8Array:return t.DT_UINT8;case Uint16Array:return t.DT_UINT16;case Uint32Array:return t.DT_UINT32;default:return t.DT_INVALID}}function LMe(t){for(var r=t.size(),e=new Int32Array(r),n=0;n<r;n++)e[n]=t.GetValue(n);return e}function kMe(t){for(var r=t.size(),e=new Int32Array(r),n=0;n<r;n++)e[n]=t.GetValue(n);return e}var $J=h(me()),XJ=h(B()),IE=h(ye()),xd=h(ve());function HJ(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function WJ(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?HJ(Object(e),!0).forEach(function(n){(0,XJ.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):HJ(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var BMe="1.5.5",FMe="1.4.1",RE="https://www.gstatic.com/draco/versioned/decoders/".concat(BMe),DMe="".concat(RE,"/draco_decoder.js"),NMe="".concat(RE,"/draco_wasm_wrapper.js"),jMe="".concat(RE,"/draco_decoder.wasm"),Nht="https://raw.githubusercontent.com/google/draco/".concat(FMe,"/javascript/draco_encoder.js"),bd;function qJ(t){return CE.apply(this,arguments)}function CE(){return CE=(0,IE.default)(xd.default.mark(function t(r){var e;return xd.default.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return e=r.modules||{},e.draco3d?bd=bd||e.draco3d.createDecoderModule({}).then(function(a){return{draco:a}}):bd=bd||UMe(r),i.next=4,bd;case 4:return i.abrupt("return",i.sent);case 5:case"end":return i.stop()}},t)})),CE.apply(this,arguments)}function UMe(t){return ME.apply(this,arguments)}function ME(){return ME=(0,IE.default)(xd.default.mark(function t(r){var e,n,i,a;return xd.default.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:s.t0=r.draco&&r.draco.decoderType,s.next=s.t0==="js"?3:(s.t0==="wasm",7);break;case 3:return s.next=5,Ei(DMe,"draco",r);case 5:return e=s.sent,s.abrupt("break",21);case 7:return s.t1=Promise,s.next=10,Ei(NMe,"draco",r);case 10:return s.t2=s.sent,s.next=13,Ei(jMe,"draco",r);case 13:return s.t3=s.sent,s.t4=[s.t2,s.t3],s.next=17,s.t1.all.call(s.t1,s.t4);case 17:i=s.sent,a=(0,$J.default)(i,2),e=a[0],n=a[1];case 21:return e=e||globalThis.DracoDecoderModule,s.next=24,GMe(e,n);case 24:return s.abrupt("return",s.sent);case 25:case"end":return s.stop()}},t)})),ME.apply(this,arguments)}function GMe(t,r){var e={};return r&&(e.wasmBinary=r),new Promise(function(n){t(WJ(WJ({},e),{},{onModuleLoaded:function(a){return n({draco:a})}}))})}function YJ(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function KJ(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?YJ(Object(e),!0).forEach(function(n){(0,JJ.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):YJ(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var n_=KJ(KJ({},IJ),{},{parse:zMe});function zMe(t,r){return kE.apply(this,arguments)}function kE(){return kE=(0,ZJ.default)(LE.default.mark(function t(r,e){var n,i,a;return LE.default.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,qJ(e);case 2:return n=s.sent,i=n.draco,a=new VJ(i),s.prev=5,s.abrupt("return",a.parseSync(r,e?.draco));case 7:return s.prev=7,a.destroy(),s.finish(7);case 10:case"end":return s.stop()}},t,null,[[5,,7,10]])})),kE.apply(this,arguments)}function QJ(t){var r={};for(var e in t){var n=t[e];if(e!=="indices"){var i=BE(n);r[e]=i}}return r}function BE(t){var r=VMe(t),e=r.buffer,n=r.size,i=r.count,a={value:e,size:n,byteOffset:0,count:i,type:Q0(n),componentType:e_(e)};return a}function VMe(t){var r=t,e=1,n=0;return t&&t.value&&(r=t.value,e=t.size||1),r&&(ArrayBuffer.isView(r)||(r=HMe(r,Float32Array)),n=r.length/e),{buffer:r,size:e,count:n}}function HMe(t,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return t?Array.isArray(t)?new r(t):e&&!(t instanceof r)?new r(t):t:null}function eQ(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function WMe(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?eQ(Object(e),!0).forEach(function(n){(0,NE.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):eQ(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var $Me=hu.default.mark(UE);function Ad(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=XMe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function XMe(t,r){if(t){if(typeof t=="string")return tQ(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return tQ(t,r)}}function tQ(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var du="KHR_draco_mesh_compression",qMe=du;function YMe(t,r,e){var n=new It(t),i=Ad(UE(n)),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;n.getObjectExtension(o,du)}}catch(s){i.e(s)}finally{i.f()}}function KMe(t,r,e){return FE.apply(this,arguments)}function FE(){return FE=(0,jE.default)(hu.default.mark(function t(r,e,n){var i,a,o,s,u,l;return hu.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(e!=null&&(i=e.gltf)!==null&&i!==void 0&&i.decompressMeshes){c.next=2;break}return c.abrupt("return");case 2:a=new It(r),o=[],s=Ad(UE(a));try{for(s.s();!(u=s.n()).done;)l=u.value,a.getObjectExtension(l,du)&&o.push(JMe(a,l,e,n))}catch(p){s.e(p)}finally{s.f()}return c.next=8,Promise.all(o);case 8:a.removeExtension(du);case 9:case"end":return c.stop()}},t)})),FE.apply(this,arguments)}function ZMe(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=new It(t),n=Ad(e.json.meshes||[]),i;try{for(n.s();!(i=n.n()).done;){var a=i.value;QMe(a,r),e.addRequiredExtension(du)}}catch(o){n.e(o)}finally{n.f()}}function JMe(t,r,e,n){return DE.apply(this,arguments)}function DE(){return DE=(0,jE.default)(hu.default.mark(function t(r,e,n,i){var a,o,s,u,l,f,c,p,d,v,m,g,y,_;return hu.default.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(a=r.getObjectExtension(e,du),a){x.next=3;break}return x.abrupt("return");case 3:return o=r.getTypedArrayForBufferView(a.bufferView),s=ss(o.buffer,o.byteOffset),u=i.parse,l=WMe({},n),delete l["3d-tiles"],x.next=10,u(s,n_,l,i);case 10:for(f=x.sent,c=QJ(f.attributes),p=0,d=Object.entries(c);p<d.length;p++)v=(0,rQ.default)(d[p],2),m=v[0],g=v[1],m in e.attributes&&(y=e.attributes[m],_=r.getAccessor(y),_!=null&&_.min&&_!==null&&_!==void 0&&_.max&&(g.min=_.min,g.max=_.max));e.attributes=c,f.indices&&(e.indices=BE(f.indices)),e2e(e);case 16:case"end":return x.stop()}},t)})),DE.apply(this,arguments)}function QMe(t,r){var e,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:4,i=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;if(!i.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");var o=i.DracoWriter.encodeSync({attributes:t}),s=a==null||(e=a.parseSync)===null||e===void 0?void 0:e.call(a,{attributes:t}),u=i._addFauxAttributes(s.attributes),l=i.addBufferView(o),f={primitives:[{attributes:u,mode:n,extensions:(0,NE.default)({},du,{bufferView:l,attributes:u})}]};return f}function e2e(t){if(!t.attributes&&Object.keys(t.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function UE(t){var r,e,n,i,a,o;return hu.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:r=Ad(t.json.meshes||[]),u.prev=1,r.s();case 3:if((e=r.n()).done){u.next=24;break}n=e.value,i=Ad(n.primitives),u.prev=6,i.s();case 8:if((a=i.n()).done){u.next=14;break}return o=a.value,u.next=12,o;case 12:u.next=8;break;case 14:u.next=19;break;case 16:u.prev=16,u.t0=u.catch(6),i.e(u.t0);case 19:return u.prev=19,i.f(),u.finish(19);case 22:u.next=3;break;case 24:u.next=29;break;case 26:u.prev=26,u.t1=u.catch(1),r.e(u.t1);case 29:return u.prev=29,r.f(),u.finish(29);case 32:case"end":return u.stop()}},$Me,null,[[1,26,29,32],[6,16,19,22]])}var WE={};un(WE,{decode:()=>a2e,name:()=>r2e});var sQ=h(me()),uQ=h(ye()),zE=h(ve());var nQ={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},iQ={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4};function aQ(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=t2e(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function t2e(t,r){if(t){if(typeof t=="string")return oQ(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return oQ(t,r)}}function oQ(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var HE="KHR_texture_transform",r2e=HE,i_=new j,n2e=new ct,i2e=new ct;function a2e(t,r){return VE.apply(this,arguments)}function VE(){return VE=(0,uQ.default)(zE.default.mark(function t(r,e){var n,i,a,o;return zE.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(n=new It(r),i=n.getExtension(HE),i){u.next=4;break}return u.abrupt("return");case 4:for(a=r.json.materials||[],o=0;o<a.length;o++)o2e(o,r);case 6:case"end":return u.stop()}},t)})),VE.apply(this,arguments)}function o2e(t,r){var e,n,i,a=[],o=(e=r.json.materials)===null||e===void 0?void 0:e[t],s=o==null||(n=o.pbrMetallicRoughness)===null||n===void 0?void 0:n.baseColorTexture;s&&Sd(r,t,s,a);var u=o?.emissiveTexture;u&&Sd(r,t,u,a);var l=o?.normalTexture;l&&Sd(r,t,l,a);var f=o?.occlusionTexture;f&&Sd(r,t,f,a);var c=o==null||(i=o.pbrMetallicRoughness)===null||i===void 0?void 0:i.metallicRoughnessTexture;c&&Sd(r,t,c,a)}function Sd(t,r,e,n){var i=s2e(e,n);if(i){var a=t.json.meshes||[],o=aQ(a),s;try{for(o.s();!(s=o.n()).done;){var u=s.value,l=aQ(u.primitives),f;try{for(l.s();!(f=l.n()).done;){var c=f.value,p=c.material;Number.isFinite(p)&&r===p&&u2e(t,c,i)}}catch(d){l.e(d)}finally{l.f()}}}catch(d){o.e(d)}finally{o.f()}}}function s2e(t,r){var e,n=(e=t.extensions)===null||e===void 0?void 0:e[HE],i=t.texCoord,a=i===void 0?0:i,o=n.texCoord,s=o===void 0?a:o,u=r.findIndex(function(f){var c=(0,sQ.default)(f,2),p=c[0],d=c[1];return p===a&&d===s})!==-1;if(!u){var l=c2e(n);return a!==s&&(t.texCoord=s),r.push([a,s]),{originalTexCoord:a,texCoord:s,matrix:l}}return null}function u2e(t,r,e){var n=e.originalTexCoord,i=e.texCoord,a=e.matrix,o=r.attributes["TEXCOORD_".concat(n)];if(Number.isFinite(o)){var s,u=(s=t.json.accessors)===null||s===void 0?void 0:s[o];if(u&&u.bufferView){var l,f=(l=t.json.bufferViews)===null||l===void 0?void 0:l[u.bufferView];if(f){for(var c=t.buffers[f.buffer],p=c.arrayBuffer,d=c.byteOffset,v=(d||0)+(u.byteOffset||0)+(f.byteOffset||0),m=Tf(u,f),g=m.ArrayType,y=m.length,_=iQ[u.componentType],b=nQ[u.type],x=f.byteStride||_*b,A=new Float32Array(y),S=0;S<u.count;S++){var P=new g(p,v+S*x,2);i_.set(P[0],P[1],1),i_.transformByMatrix3(a),A.set([i_[0],i_[1]],S*b)}n===i?l2e(u,f,t.buffers,A):f2e(i,u,r,t,A)}}}}function l2e(t,r,e,n){t.componentType=5126,e.push({arrayBuffer:n.buffer,byteOffset:0,byteLength:n.buffer.byteLength}),r.buffer=e.length-1,r.byteLength=n.buffer.byteLength,r.byteOffset=0,delete r.byteStride}function f2e(t,r,e,n,i){n.buffers.push({arrayBuffer:i.buffer,byteOffset:0,byteLength:i.buffer.byteLength});var a=n.json.bufferViews;if(a){a.push({buffer:n.buffers.length-1,byteLength:i.buffer.byteLength,byteOffset:0});var o=n.json.accessors;o&&(o.push({bufferView:a?.length-1,byteOffset:0,componentType:5126,count:r.count,type:"VEC2"}),e.attributes["TEXCOORD_".concat(t)]=o.length-1)}}function c2e(t){var r=t.offset,e=r===void 0?[0,0]:r,n=t.rotation,i=n===void 0?0:n,a=t.scale,o=a===void 0?[1,1]:a,s=new ct().set(1,0,0,0,1,0,e[0],e[1],1),u=n2e.set(Math.cos(i),Math.sin(i),0,-Math.sin(i),Math.cos(i),0,0,0,1),l=i2e.set(o[0],0,0,0,o[1],0,0,0,1);return s.multiplyRight(u).multiplyRight(l)}var YE={};un(YE,{decode:()=>d2e,encode:()=>v2e,name:()=>h2e});var qE=h(ye()),Td=h(ve());function fQ(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=p2e(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function p2e(t,r){if(t){if(typeof t=="string")return lQ(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return lQ(t,r)}}function lQ(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var vu="KHR_lights_punctual",h2e=vu;function d2e(t){return $E.apply(this,arguments)}function $E(){return $E=(0,qE.default)(Td.default.mark(function t(r){var e,n,i,a,o,s,u;return Td.default.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:e=new It(r),n=e.json,i=e.getExtension(vu),i&&(e.json.lights=i.lights,e.removeExtension(vu)),a=fQ(n.nodes||[]);try{for(a.s();!(o=a.n()).done;)s=o.value,u=e.getObjectExtension(s,vu),u&&(s.light=u.light),e.removeObjectExtension(s,vu)}catch(c){a.e(c)}finally{a.f()}case 6:case"end":return f.stop()}},t)})),$E.apply(this,arguments)}function v2e(t){return XE.apply(this,arguments)}function XE(){return XE=(0,qE.default)(Td.default.mark(function t(r){var e,n,i,a,o,s,u;return Td.default.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(e=new It(r),n=e.json,n.lights&&(i=e.addExtension(vu),lr(!i.lights),i.lights=n.lights,delete n.lights),e.json.lights){a=fQ(e.json.lights);try{for(a.s();!(o=a.n()).done;)s=o.value,u=s.node,e.addObjectExtension(u,vu,s)}catch(c){a.e(c)}finally{a.f()}delete e.json.lights}case 4:case"end":return f.stop()}},t)})),XE.apply(this,arguments)}var JE={};un(JE,{decode:()=>y2e,encode:()=>_2e,name:()=>g2e});var pQ=h(ye()),KE=h(ve());function hQ(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=m2e(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function m2e(t,r){if(t){if(typeof t=="string")return cQ(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return cQ(t,r)}}function cQ(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var wd="KHR_materials_unlit",g2e=wd;function y2e(t){return ZE.apply(this,arguments)}function ZE(){return ZE=(0,pQ.default)(KE.default.mark(function t(r){var e,n,i,a,o,s;return KE.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:e=new It(r),n=e.json,i=hQ(n.materials||[]);try{for(i.s();!(a=i.n()).done;)o=a.value,s=o.extensions&&o.extensions.KHR_materials_unlit,s&&(o.unlit=!0),e.removeObjectExtension(o,wd)}catch(f){i.e(f)}finally{i.f()}e.removeExtension(wd);case 5:case"end":return l.stop()}},t)})),ZE.apply(this,arguments)}function _2e(t){var r=new It(t),e=r.json;if(r.materials){var n=hQ(e.materials||[]),i;try{for(n.s();!(i=n.n()).done;){var a=i.value;a.unlit&&(delete a.unlit,r.addObjectExtension(a,wd,{}),r.addExtension(wd))}}catch(o){n.e(o)}finally{n.f()}}}var rC={};un(rC,{decode:()=>S2e,encode:()=>T2e,name:()=>A2e});var vQ=h(ze()),tC=h(ye()),Od=h(ve());function b2e(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=x2e(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function x2e(t,r){if(t){if(typeof t=="string")return dQ(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return dQ(t,r)}}function dQ(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var Pd="KHR_techniques_webgl",A2e=Pd;function S2e(t){return QE.apply(this,arguments)}function QE(){return QE=(0,tC.default)(Od.default.mark(function t(r){var e,n,i,a,o,s,u,l;return Od.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(e=new It(r),n=e.json,i=e.getExtension(Pd),i){a=w2e(i,e),o=b2e(n.materials||[]);try{for(o.s();!(s=o.n()).done;)u=s.value,l=e.getObjectExtension(u,Pd),l&&(u.technique=Object.assign({},l,a[l.technique]),u.technique.values=P2e(u.technique,e)),e.removeObjectExtension(u,Pd)}catch(p){o.e(p)}finally{o.f()}e.removeExtension(Pd)}case 4:case"end":return c.stop()}},t)})),QE.apply(this,arguments)}function T2e(t,r){return eC.apply(this,arguments)}function eC(){return eC=(0,tC.default)(Od.default.mark(function t(r,e){return Od.default.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:case"end":return i.stop()}},t)})),eC.apply(this,arguments)}function w2e(t,r){var e=t.programs,n=e===void 0?[]:e,i=t.shaders,a=i===void 0?[]:i,o=t.techniques,s=o===void 0?[]:o,u=new TextDecoder;return a.forEach(function(l){if(Number.isFinite(l.bufferView))l.code=u.decode(r.getTypedArrayForBufferView(l.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),n.forEach(function(l){l.fragmentShader=a[l.fragmentShader],l.vertexShader=a[l.vertexShader]}),s.forEach(function(l){l.program=n[l.program]}),s}function P2e(t,r){var e=Object.assign({},t.values);return Object.keys(t.uniforms||{}).forEach(function(n){t.uniforms[n].value&&!(n in e)&&(e[n]=t.uniforms[n].value)}),Object.keys(e).forEach(function(n){(0,vQ.default)(e[n])==="object"&&e[n].index!==void 0&&(e[n].texture=r.getTexture(e[n].index))}),e}var aC={};un(aC,{decode:()=>E2e,name:()=>O2e});var mQ=h(ye()),nC=h(ve());var gQ="EXT_feature_metadata",O2e=gQ;function E2e(t){return iC.apply(this,arguments)}function iC(){return iC=(0,mQ.default)(nC.default.mark(function t(r){var e;return nC.default.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:e=new It(r),C2e(e);case 2:case"end":return i.stop()}},t)})),iC.apply(this,arguments)}function C2e(t){var r,e=t.getExtension(gQ),n=e==null||(r=e.schema)===null||r===void 0?void 0:r.classes,i=e?.featureTables,a=e?.featureTextures;if(a&&console.warn('featureTextures is not yet supported in the "EXT_feature_metadata" extension.'),n&&i)for(var o in n){var s=n[o],u=R2e(i,o);u&&M2e(t,u,s)}}function M2e(t,r,e){for(var n in e.properties){var i,a=e.properties[n],o=r==null||(i=r.properties)===null||i===void 0?void 0:i[n],s=r.count;if(o){var u=I2e(t,a,s,o);o.data=u}}}function I2e(t,r,e,n){var i=n.bufferView,a=t.getTypedArrayForBufferView(i);switch(r.type){case"STRING":{var o=n.stringOffsetBufferView,s=t.getTypedArrayForBufferView(o);a=L2e(a,s,e);break}default:}return a}function R2e(t,r){for(var e in t){var n=t[e];if(n.class===r)return n}return null}function L2e(t,r,e){for(var n=[],i=new TextDecoder("utf8"),a=0,o=4,s=0;s<e;s++){var u=r[(s+1)*o]-r[s*o],l=t.subarray(a,u+a),f=i.decode(l);n.push(f),a+=u}return n}function bQ(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=k2e(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function k2e(t,r){if(t){if(typeof t=="string")return yQ(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return yQ(t,r)}}function yQ(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var xQ=[wE,PE,OE,GE,YE,JE,rC,WE,aC];function AQ(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=arguments.length>2?arguments[2]:void 0,n=xQ.filter(function(u){return TQ(u.name,r)}),i=bQ(n),a;try{for(i.s();!(a=i.n()).done;){var o=a.value,s;(s=o.preprocess)===null||s===void 0||s.call(o,t,r,e)}}catch(u){i.e(u)}finally{i.f()}}function SQ(t){return sC.apply(this,arguments)}function sC(){return sC=(0,_Q.default)(oC.default.mark(function t(r){var e,n,i,a,o,s,u,l=arguments;return oC.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:e=l.length>1&&l[1]!==void 0?l[1]:{},n=l.length>2?l[2]:void 0,i=xQ.filter(function(p){return TQ(p.name,e)}),a=bQ(i),c.prev=4,a.s();case 6:if((o=a.n()).done){c.next=12;break}return s=o.value,c.next=10,(u=s.decode)===null||u===void 0?void 0:u.call(s,r,e,n);case 10:c.next=6;break;case 12:c.next=17;break;case 14:c.prev=14,c.t0=c.catch(4),a.e(c.t0);case 17:return c.prev=17,a.f(),c.finish(17);case 20:case"end":return c.stop()}},t,null,[[4,14,17,20]])})),sC.apply(this,arguments)}function TQ(t,r){var e,n=(r==null||(e=r.gltf)===null||e===void 0?void 0:e.excludeExtensions)||{},i=t in n&&!n[t];return!i}var CQ=h(L()),MQ=h(N());function B2e(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=F2e(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function F2e(t,r){if(t){if(typeof t=="string")return wQ(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return wQ(t,r)}}function wQ(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var uC="KHR_binary_glTF";function PQ(t){var r=new It(t),e=r.json,n=B2e(e.images||[]),i;try{for(n.s();!(i=n.n()).done;){var a=i.value,o=r.getObjectExtension(a,uC);o&&Object.assign(a,o),r.removeObjectExtension(a,uC)}}catch(s){n.e(s)}finally{n.f()}e.buffers&&e.buffers[0]&&delete e.buffers[0].uri,r.removeExtension(uC)}function zo(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=N2e(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function N2e(t,r){if(t){if(typeof t=="string")return OQ(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return OQ(t,r)}}function OQ(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var EQ={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},j2e={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"},U2e=function(){function t(){(0,CQ.default)(this,t),w(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}}),w(this,"json",void 0)}return(0,MQ.default)(t,[{key:"normalize",value:function(e,n){this.json=e.json;var i=e.json;switch(i.asset&&i.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn("glTF: Unknown version ".concat(i.asset.version));return}if(!n.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(i),this._convertTopLevelObjectsToArrays(i),PQ(e),this._convertObjectIdsToArrayIndices(i),this._updateObjects(i),this._updateMaterial(i)}},{key:"_addAsset",value:function(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}},{key:"_convertTopLevelObjectsToArrays",value:function(e){for(var n in EQ)this._convertTopLevelObjectToArray(e,n)}},{key:"_convertTopLevelObjectToArray",value:function(e,n){var i=e[n];if(!(!i||Array.isArray(i))){e[n]=[];for(var a in i){var o=i[a];o.id=o.id||a;var s=e[n].length;e[n].push(o),this.idToIndexMap[n][a]=s}}}},{key:"_convertObjectIdsToArrayIndices",value:function(e){for(var n in EQ)this._convertIdsToIndices(e,n);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));var i=zo(e.textures),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;this._convertTextureIds(o)}}catch(g){i.e(g)}finally{i.f()}var s=zo(e.meshes),u;try{for(s.s();!(u=s.n()).done;){var l=u.value;this._convertMeshIds(l)}}catch(g){s.e(g)}finally{s.f()}var f=zo(e.nodes),c;try{for(f.s();!(c=f.n()).done;){var p=c.value;this._convertNodeIds(p)}}catch(g){f.e(g)}finally{f.f()}var d=zo(e.scenes),v;try{for(d.s();!(v=d.n()).done;){var m=v.value;this._convertSceneIds(m)}}catch(g){d.e(g)}finally{d.f()}}},{key:"_convertTextureIds",value:function(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}},{key:"_convertMeshIds",value:function(e){var n=zo(e.primitives),i;try{for(n.s();!(i=n.n()).done;){var a=i.value,o=a.attributes,s=a.indices,u=a.material;for(var l in o)o[l]=this._convertIdToIndex(o[l],"accessor");s&&(a.indices=this._convertIdToIndex(s,"accessor")),u&&(a.material=this._convertIdToIndex(u,"material"))}}catch(f){n.e(f)}finally{n.f()}}},{key:"_convertNodeIds",value:function(e){var n=this;e.children&&(e.children=e.children.map(function(i){return n._convertIdToIndex(i,"node")})),e.meshes&&(e.meshes=e.meshes.map(function(i){return n._convertIdToIndex(i,"mesh")}))}},{key:"_convertSceneIds",value:function(e){var n=this;e.nodes&&(e.nodes=e.nodes.map(function(i){return n._convertIdToIndex(i,"node")}))}},{key:"_convertIdsToIndices",value:function(e,n){e[n]||(console.warn("gltf v1: json doesn't contain attribute ".concat(n)),e[n]=[]);var i=zo(e[n]),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;for(var s in o){var u=o[s],l=this._convertIdToIndex(u,s);o[s]=l}}}catch(f){i.e(f)}finally{i.f()}}},{key:"_convertIdToIndex",value:function(e,n){var i=j2e[n];if(i in this.idToIndexMap){var a=this.idToIndexMap[i][e];if(!Number.isFinite(a))throw new Error("gltf v1: failed to resolve ".concat(n," with id ").concat(e));return a}return e}},{key:"_updateObjects",value:function(e){var n=zo(this.json.buffers),i;try{for(n.s();!(i=n.n()).done;){var a=i.value;delete a.type}}catch(o){n.e(o)}finally{n.f()}}},{key:"_updateMaterial",value:function(e){var n=zo(e.materials),i;try{var a=function(){var f=i.value;f.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};var c=((o=f.values)===null||o===void 0?void 0:o.tex)||((s=f.values)===null||s===void 0?void 0:s.texture2d_0)||((u=f.values)===null||u===void 0?void 0:u.diffuseTex),p=e.textures.findIndex(function(d){return d.id===c});p!==-1&&(f.pbrMetallicRoughness.baseColorTexture={index:p})};for(n.s();!(i=n.n()).done;){var o,s,u;a()}}catch(l){n.e(l)}finally{n.f()}}}]),t}();function IQ(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new U2e().normalize(t,r)}var LQ=h(ze()),kQ=h(L()),BQ=h(N()),Of=h(B());var Pf;function RQ(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Va(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?RQ(Object(e),!0).forEach(function(n){(0,Of.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):RQ(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var G2e={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},z2e={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Nn={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},V2e={magFilter:Nn.TEXTURE_MAG_FILTER,minFilter:Nn.TEXTURE_MIN_FILTER,wrapS:Nn.TEXTURE_WRAP_S,wrapT:Nn.TEXTURE_WRAP_T},H2e=(Pf={},(0,Of.default)(Pf,Nn.TEXTURE_MAG_FILTER,Nn.LINEAR),(0,Of.default)(Pf,Nn.TEXTURE_MIN_FILTER,Nn.NEAREST_MIPMAP_LINEAR),(0,Of.default)(Pf,Nn.TEXTURE_WRAP_S,Nn.REPEAT),(0,Of.default)(Pf,Nn.TEXTURE_WRAP_T,Nn.REPEAT),Pf);function W2e(t){return z2e[t]}function $2e(t){return G2e[t]}var X2e=function(){function t(){(0,kQ.default)(this,t),w(this,"baseUri",""),w(this,"json",{}),w(this,"buffers",[]),w(this,"images",[])}return(0,BQ.default)(t,[{key:"postProcess",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=e.json,a=e.buffers,o=a===void 0?[]:a,s=e.images,u=s===void 0?[]:s,l=e.baseUri,f=l===void 0?"":l;return lr(i),this.baseUri=f,this.json=i,this.buffers=o,this.images=u,this._resolveTree(this.json,n),this.json}},{key:"_resolveTree",value:function(e){var n=this,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e.bufferViews&&(e.bufferViews=e.bufferViews.map(function(a,o){return n._resolveBufferView(a,o)})),e.images&&(e.images=e.images.map(function(a,o){return n._resolveImage(a,o)})),e.samplers&&(e.samplers=e.samplers.map(function(a,o){return n._resolveSampler(a,o)})),e.textures&&(e.textures=e.textures.map(function(a,o){return n._resolveTexture(a,o)})),e.accessors&&(e.accessors=e.accessors.map(function(a,o){return n._resolveAccessor(a,o)})),e.materials&&(e.materials=e.materials.map(function(a,o){return n._resolveMaterial(a,o)})),e.meshes&&(e.meshes=e.meshes.map(function(a,o){return n._resolveMesh(a,o)})),e.nodes&&(e.nodes=e.nodes.map(function(a,o){return n._resolveNode(a,o)})),e.skins&&(e.skins=e.skins.map(function(a,o){return n._resolveSkin(a,o)})),e.scenes&&(e.scenes=e.scenes.map(function(a,o){return n._resolveScene(a,o)})),e.scene!==void 0&&(e.scene=e.scenes[this.json.scene])}},{key:"getScene",value:function(e){return this._get("scenes",e)}},{key:"getNode",value:function(e){return this._get("nodes",e)}},{key:"getSkin",value:function(e){return this._get("skins",e)}},{key:"getMesh",value:function(e){return this._get("meshes",e)}},{key:"getMaterial",value:function(e){return this._get("materials",e)}},{key:"getAccessor",value:function(e){return this._get("accessors",e)}},{key:"getCamera",value:function(e){return null}},{key:"getTexture",value:function(e){return this._get("textures",e)}},{key:"getSampler",value:function(e){return this._get("samplers",e)}},{key:"getImage",value:function(e){return this._get("images",e)}},{key:"getBufferView",value:function(e){return this._get("bufferViews",e)}},{key:"getBuffer",value:function(e){return this._get("buffers",e)}},{key:"_get",value:function(e,n){if((0,LQ.default)(n)==="object")return n;var i=this.json[e]&&this.json[e][n];return i||console.warn("glTF file error: Could not find ".concat(e,"[").concat(n,"]")),i}},{key:"_resolveScene",value:function(e,n){var i=this;return e.id=e.id||"scene-".concat(n),e.nodes=(e.nodes||[]).map(function(a){return i.getNode(a)}),e}},{key:"_resolveNode",value:function(e,n){var i=this;return e.id=e.id||"node-".concat(n),e.children&&(e.children=e.children.map(function(a){return i.getNode(a)})),e.mesh!==void 0?e.mesh=this.getMesh(e.mesh):e.meshes!==void 0&&e.meshes.length&&(e.mesh=e.meshes.reduce(function(a,o){var s=i.getMesh(o);return a.id=s.id,a.primitives=a.primitives.concat(s.primitives),a},{primitives:[]})),e.camera!==void 0&&(e.camera=this.getCamera(e.camera)),e.skin!==void 0&&(e.skin=this.getSkin(e.skin)),e}},{key:"_resolveSkin",value:function(e,n){return e.id=e.id||"skin-".concat(n),e.inverseBindMatrices=this.getAccessor(e.inverseBindMatrices),e}},{key:"_resolveMesh",value:function(e,n){var i=this;return e.id=e.id||"mesh-".concat(n),e.primitives&&(e.primitives=e.primitives.map(function(a){a=Va({},a);var o=a.attributes;a.attributes={};for(var s in o)a.attributes[s]=i.getAccessor(o[s]);return a.indices!==void 0&&(a.indices=i.getAccessor(a.indices)),a.material!==void 0&&(a.material=i.getMaterial(a.material)),a})),e}},{key:"_resolveMaterial",value:function(e,n){if(e.id=e.id||"material-".concat(n),e.normalTexture&&(e.normalTexture=Va({},e.normalTexture),e.normalTexture.texture=this.getTexture(e.normalTexture.index)),e.occlusionTexture&&(e.occlustionTexture=Va({},e.occlustionTexture),e.occlusionTexture.texture=this.getTexture(e.occlusionTexture.index)),e.emissiveTexture&&(e.emmisiveTexture=Va({},e.emmisiveTexture),e.emissiveTexture.texture=this.getTexture(e.emissiveTexture.index)),e.emissiveFactor||(e.emissiveFactor=e.emmisiveTexture?[1,1,1]:[0,0,0]),e.pbrMetallicRoughness){e.pbrMetallicRoughness=Va({},e.pbrMetallicRoughness);var i=e.pbrMetallicRoughness;i.baseColorTexture&&(i.baseColorTexture=Va({},i.baseColorTexture),i.baseColorTexture.texture=this.getTexture(i.baseColorTexture.index)),i.metallicRoughnessTexture&&(i.metallicRoughnessTexture=Va({},i.metallicRoughnessTexture),i.metallicRoughnessTexture.texture=this.getTexture(i.metallicRoughnessTexture.index))}return e}},{key:"_resolveAccessor",value:function(e,n){if(e.id=e.id||"accessor-".concat(n),e.bufferView!==void 0&&(e.bufferView=this.getBufferView(e.bufferView)),e.bytesPerComponent=W2e(e.componentType),e.components=$2e(e.type),e.bytesPerElement=e.bytesPerComponent*e.components,e.bufferView){var i=e.bufferView.buffer,a=Tf(e,e.bufferView),o=a.ArrayType,s=a.byteLength,u=(e.bufferView.byteOffset||0)+(e.byteOffset||0)+i.byteOffset,l=i.arrayBuffer.slice(u,u+s);e.bufferView.byteStride&&(l=this._getValueFromInterleavedBuffer(i,u,e.bufferView.byteStride,e.bytesPerElement,e.count)),e.value=new o(l)}return e}},{key:"_getValueFromInterleavedBuffer",value:function(e,n,i,a,o){for(var s=new Uint8Array(o*a),u=0;u<o;u++){var l=n+u*i;s.set(new Uint8Array(e.arrayBuffer.slice(l,l+a)),u*a)}return s.buffer}},{key:"_resolveTexture",value:function(e,n){return e.id=e.id||"texture-".concat(n),e.sampler="sampler"in e?this.getSampler(e.sampler):H2e,e.source=this.getImage(e.source),e}},{key:"_resolveSampler",value:function(e,n){e.id=e.id||"sampler-".concat(n),e.parameters={};for(var i in e){var a=this._enumSamplerParameter(i);a!==void 0&&(e.parameters[a]=e[i])}return e}},{key:"_enumSamplerParameter",value:function(e){return V2e[e]}},{key:"_resolveImage",value:function(e,n){e.id=e.id||"image-".concat(n),e.bufferView!==void 0&&(e.bufferView=this.getBufferView(e.bufferView));var i=this.images[n];return i&&(e.image=i),e}},{key:"_resolveBufferView",value:function(e,n){var i=e.buffer,a=Va(Va({id:"bufferView-".concat(n)},e),{},{buffer:this.buffers[i]}),o=this.buffers[i].arrayBuffer,s=this.buffers[i].byteOffset||0;return"byteOffset"in e&&(s+=e.byteOffset),a.data=new Uint8Array(o,s,e.byteLength),a}},{key:"_resolveCamera",value:function(e,n){return e.id=e.id||"camera-".concat(n),e.perspective,e.orthographic,e}}]),t}();function FQ(t,r){return new X2e().postProcess(t,r)}var DQ=1735152710,cC=12,a_=8,q2e=1313821514,Y2e=5130562,K2e=0,Z2e=1,J2e=0,Ef=!0;function Q2e(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return"".concat(String.fromCharCode(t.getUint8(r+0))).concat(String.fromCharCode(t.getUint8(r+1))).concat(String.fromCharCode(t.getUint8(r+2))).concat(String.fromCharCode(t.getUint8(r+3)))}function NQ(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=new DataView(t),i=e.magic,a=i===void 0?DQ:i,o=n.getUint32(r,!1);return o===a||o===DQ}function pC(t,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},i=new DataView(r),a=Q2e(i,e+0),o=i.getUint32(e+4,Ef),s=i.getUint32(e+8,Ef);switch(Object.assign(t,{header:{byteOffset:e,byteLength:s,hasBinChunk:!1},type:a,version:o,json:{},binChunks:[]}),e+=cC,t.version){case 1:return eIe(t,i,e);case 2:return tIe(t,i,e,n={});default:throw new Error("Invalid GLB version ".concat(t.version,". Only supports v1 and v2."))}}function eIe(t,r,e){Ne(t.header.byteLength>cC+a_);var n=r.getUint32(e+0,Ef),i=r.getUint32(e+4,Ef);return e+=a_,Ne(i===J2e),lC(t,r,e,n),e+=n,e+=fC(t,r,e,t.header.byteLength),e}function tIe(t,r,e,n){return Ne(t.header.byteLength>cC+a_),rIe(t,r,e,n),e+t.header.byteLength}function rIe(t,r,e,n){for(;e+8<=t.header.byteLength;){var i=r.getUint32(e+0,Ef),a=r.getUint32(e+4,Ef);switch(e+=a_,a){case q2e:lC(t,r,e,i);break;case Y2e:fC(t,r,e,i);break;case K2e:n.strict||lC(t,r,e,i);break;case Z2e:n.strict||fC(t,r,e,i);break;default:break}e+=ao(i,4)}return e}function lC(t,r,e,n){var i=new Uint8Array(r.buffer,e,n),a=new TextDecoder("utf8"),o=a.decode(i);return t.json=JSON.parse(o),ao(n,4)}function fC(t,r,e,n){return t.header.hasBinChunk=!0,t.binChunks.push({byteOffset:e,byteLength:n,arrayBuffer:r.buffer}),ao(n,4)}function UQ(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=nIe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function nIe(t,r){if(t){if(typeof t=="string")return jQ(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return jQ(t,r)}}function jQ(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function GQ(t,r){return hC.apply(this,arguments)}function hC(){return hC=(0,Ed.default)(Ha.default.mark(function t(r,e){var n,i,a,o,s,u,l,f,c,p,d=arguments;return Ha.default.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(s=d.length>2&&d[2]!==void 0?d[2]:0,u=d.length>3?d[3]:void 0,l=d.length>4?d[4]:void 0,iIe(r,e,s,u),IQ(r,{normalize:u==null||(n=u.gltf)===null||n===void 0?void 0:n.normalize}),AQ(r,u,l),f=[],!(u!=null&&(i=u.gltf)!==null&&i!==void 0&&i.loadBuffers&&r.json.buffers)){m.next=10;break}return m.next=10,aIe(r,u,l);case 10:return u!=null&&(a=u.gltf)!==null&&a!==void 0&&a.loadImages&&(c=oIe(r,u,l),f.push(c)),p=SQ(r,u,l),f.push(p),m.next=15,Promise.all(f);case 15:return m.abrupt("return",u!=null&&(o=u.gltf)!==null&&o!==void 0&&o.postProcess?FQ(r,u):r);case 16:case"end":return m.stop()}},t)})),hC.apply(this,arguments)}function iIe(t,r,e,n){if(n.uri&&(t.baseUri=n.uri),r instanceof ArrayBuffer&&!NQ(r,e,n)){var i=new TextDecoder;r=i.decode(r)}if(typeof r=="string")t.json=F1(r);else if(r instanceof ArrayBuffer){var a={};e=pC(a,r,e,n.glb),lr(a.type==="glTF","Invalid GLB magic string ".concat(a.type)),t._glb=a,t.json=a.json}else lr(!1,"GLTF: must be ArrayBuffer or string");var o=t.json.buffers||[];if(t.buffers=new Array(o.length).fill(null),t._glb&&t._glb.header.hasBinChunk){var s=t._glb.binChunks;t.buffers[0]={arrayBuffer:s[0].arrayBuffer,byteOffset:s[0].byteOffset,byteLength:s[0].byteLength}}var u=t.json.images||[];t.images=new Array(u.length).fill({})}function aIe(t,r,e){return dC.apply(this,arguments)}function dC(){return dC=(0,Ed.default)(Ha.default.mark(function t(r,e,n){var i,a,o,s,u,l,f,c,p;return Ha.default.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:i=r.json.buffers||[],a=0;case 2:if(!(a<i.length)){v.next=22;break}if(o=i[a],!o.uri){v.next=18;break}return l=n.fetch,lr(l),f=mE(o.uri,e),v.next=10,n==null||(s=n.fetch)===null||s===void 0?void 0:s.call(n,f);case 10:return c=v.sent,v.next=13,c==null||(u=c.arrayBuffer)===null||u===void 0?void 0:u.call(c);case 13:p=v.sent,r.buffers[a]={arrayBuffer:p,byteOffset:0,byteLength:p.byteLength},delete o.uri,v.next=19;break;case 18:r.buffers[a]===null&&(r.buffers[a]={arrayBuffer:new ArrayBuffer(o.byteLength),byteOffset:0,byteLength:o.byteLength});case 19:++a,v.next=2;break;case 22:case"end":return v.stop()}},t)})),dC.apply(this,arguments)}function oIe(t,r,e){return vC.apply(this,arguments)}function vC(){return vC=(0,Ed.default)(Ha.default.mark(function t(r,e,n){var i,a,o,s,u,l;return Ha.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:i=sIe(r),a=r.json.images||[],o=[],s=UQ(i);try{for(s.s();!(u=s.n()).done;)l=u.value,o.push(uIe(r,a[l],l,e,n))}catch(p){s.e(p)}finally{s.f()}return c.next=7,Promise.all(o);case 7:return c.abrupt("return",c.sent);case 8:case"end":return c.stop()}},t)})),vC.apply(this,arguments)}function sIe(t){var r=new Set,e=t.json.textures||[],n=UQ(e),i;try{for(n.s();!(i=n.n()).done;){var a=i.value;a.source!==void 0&&r.add(a.source)}}catch(o){n.e(o)}finally{n.f()}return Array.from(r).sort()}function uIe(t,r,e,n,i){return mC.apply(this,arguments)}function mC(){return mC=(0,Ed.default)(Ha.default.mark(function t(r,e,n,i,a){var o,s,u,l,f,c,p;return Ha.default.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(o=a.fetch,s=a.parse,!(e.uri&&!e.hasOwnProperty("bufferView"))){v.next=10;break}return l=mE(e.uri,i),v.next=5,o(l);case 5:return f=v.sent,v.next=8,f.arrayBuffer();case 8:u=v.sent,e.bufferView={data:u};case 10:return Number.isFinite(e.bufferView)&&(c=vJ(r.json,r.buffers,e.bufferView),u=ss(c.buffer,c.byteOffset,c.byteLength)),lr(u,"glTF image has no data"),v.next=14,s(u,[Jn,vE],{mimeType:e.mimeType,basis:i.basis||{format:J0()}},a);case 14:p=v.sent,p&&p[0]&&(p={compressed:!0,mipmaps:!1,width:p[0].width,height:p[0].height,data:p[0]}),r.images=r.images||[],r.images[n]=p;case 18:case"end":return v.stop()}},t)})),mC.apply(this,arguments)}function zQ(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function o_(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?zQ(Object(e),!0).forEach(function(n){(0,VQ.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):zQ(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var Wa={name:"glTF",id:"gltf",module:"gltf",version:$Z,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:lIe,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0,postProcess:!0},log:console},deprecatedOptions:{fetchImages:"gltf.loadImages",createImages:"gltf.loadImages",decompress:"gltf.decompressMeshes",postProcess:"gltf.postProcess",gltf:{decompress:"gltf.decompressMeshes"}}};function lIe(t){return yC.apply(this,arguments)}function yC(){return yC=(0,HQ.default)(gC.default.mark(function t(r){var e,n,i,a,o,s,u=arguments;return gC.default.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return e=u.length>1&&u[1]!==void 0?u[1]:{},n=u.length>2?u[2]:void 0,e=o_(o_({},Wa.options),e),e.gltf=o_(o_({},Wa.options.gltf),e.gltf),i=e,a=i.byteOffset,o=a===void 0?0:a,s={},f.next=8,GQ(s,r,o,e,n);case 8:return f.abrupt("return",f.sent);case 9:case"end":return f.stop()}},t)})),yC.apply(this,arguments)}var xC=h(ye()),Cd=h(ve());function WQ(t){return _C.apply(this,arguments)}function _C(){return _C=(0,xC.default)(Cd.default.mark(function t(r){var e;return Cd.default.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return e=[],r.scenes.forEach(function(a){a.traverse(function(o){Object.values(o.model.getUniforms()).forEach(function(s){s.loaded===!1&&e.push(s)})})}),i.next=4,fIe(function(){return e.some(function(a){return!a.loaded})});case 4:return i.abrupt("return",i.sent);case 5:case"end":return i.stop()}},t)})),_C.apply(this,arguments)}function fIe(t){return bC.apply(this,arguments)}function bC(){return bC=(0,xC.default)(Cd.default.mark(function t(r){return Cd.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!r()){n.next=5;break}return n.next=3,new Promise(function(i){return requestAnimationFrame(i)});case 3:n.next=0;break;case 5:case"end":return n.stop()}},t)})),bC.apply(this,arguments)}var $Q=`#version 300 es
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
in vec3 instanceTranslation;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform mat4 sceneModelMatrix;
uniform bool composeModelMatrix;
in vec4 POSITION;

#ifdef HAS_UV
  in vec2 TEXCOORD_0;
#endif

#ifdef MODULE_PBR
  #ifdef HAS_NORMALS
    in vec4 NORMAL;
  #endif
#endif
out vec4 vColor;
#ifndef MODULE_PBR
  #ifdef HAS_UV
    out vec2 vTEXCOORD_0;
  #endif
#endif
void main(void) {
  #if defined(HAS_UV) && !defined(MODULE_PBR)
    vTEXCOORD_0 = TEXCOORD_0;
    geometry.uv = vTEXCOORD_0;
  #endif

  geometry.worldPosition = instancePositions;
  geometry.pickingColor = instancePickingColors;

  vec3 normal = vec3(0.0, 0.0, 1.0);
  #ifdef MODULE_PBR
    #ifdef HAS_NORMALS
      normal = instanceModelMatrix * (sceneModelMatrix * vec4(NORMAL.xyz, 0.0)).xyz;
    #endif
  #endif

  float originalSize = project_size_to_pixel(sizeScale);
  float clampedSize = clamp(originalSize, sizeMinPixels, sizeMaxPixels);

  vec3 pos = (instanceModelMatrix * (sceneModelMatrix * POSITION).xyz) * sizeScale * (clampedSize / originalSize) + instanceTranslation;
  if(composeModelMatrix) {
    DECKGL_FILTER_SIZE(pos, geometry);
    geometry.normal = project_normal(normal);
    geometry.worldPosition += pos;
    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
  }
  else {
    pos = project_size(pos);
    DECKGL_FILTER_SIZE(pos, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);
    geometry.normal = project_normal(normal);
  }
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  #ifdef MODULE_PBR
    pbr_vPosition = geometry.position.xyz;
    #ifdef HAS_NORMALS
      pbr_vNormal = geometry.normal;
    #endif

    #ifdef HAS_UV
      pbr_vUV = TEXCOORD_0;
    #else
      pbr_vUV = vec2(0., 0.);
    #endif
    geometry.uv = pbr_vUV;
  #endif

  vColor = instanceColors;
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var XQ=`#version 300 es
uniform float opacity;
in vec4 vColor;

out vec4 fragmentColor;
#ifndef MODULE_PBR
  #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
    in vec2 vTEXCOORD_0;
    uniform sampler2D u_BaseColorSampler;
  #endif
#endif

void main(void) {
  #ifdef MODULE_PBR
    fragmentColor = vColor * pbr_filterColor(vec4(0));
    geometry.uv = pbr_vUV;
  #else
    #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
      fragmentColor = vColor * texture2D(u_BaseColorSampler, vTEXCOORD_0);
      geometry.uv = vTEXCOORD_0;
    #else
      fragmentColor = vColor;
    #endif
  #endif

  fragmentColor.a *= opacity;
  DECKGL_FILTER_COLOR(fragmentColor, geometry);
}
`;function qQ(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function YQ(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?qQ(Object(e),!0).forEach(function(n){(0,Id.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):qQ(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function cIe(t){var r=pIe();return function(){var n=(0,Md.default)(t),i;if(r){var a=(0,Md.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,eee.default)(this,i)}}function pIe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ree=[255,255,255,255],hIe={scenegraph:{type:"object",value:null,async:!0},getScene:function(r){return r&&r.scenes?(0,tee.default)(r.scene)==="object"?r.scene:r.scenes[r.scene||0]:r},getAnimator:function(r){return r&&r.animator},_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:function(r){return r.position}},getColor:{type:"accessor",value:ree},_lighting:"flat",_imageBasedLightingEnvironment:null,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[Wa]},Cf=function(t){(0,QQ.default)(e,t);var r=cIe(e);function e(){var n;(0,KQ.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,Id.default)((0,JQ.default)(n),"state",void 0),n}return(0,ZQ.default)(e,[{key:"getShaders",value:function(){var i=[Je,st];return this.props._lighting==="pbr"&&i.push(go),{vs:$Q,fs:XQ,modules:i}}},{key:"initializeState",value:function(){var i=this.getAttributeManager();i.addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:5121,size:this.props.colorFormat.length,accessor:"getColor",normalized:!0,defaultValue:ree,transition:!0},instanceModelMatrix:R0})}},{key:"updateState",value:function(i){(0,AC.default)((0,Md.default)(e.prototype),"updateState",this).call(this,i);var a=i.props,o=i.oldProps;a.scenegraph!==o.scenegraph?this._updateScenegraph():a._animations!==o._animations&&this._applyAnimationsProp(this.state.scenegraph,this.state.animator,a._animations)}},{key:"finalizeState",value:function(i){(0,AC.default)((0,Md.default)(e.prototype),"finalizeState",this).call(this,i),this._deleteScenegraph()}},{key:"_updateScenegraph",value:function(){var i=this,a=this.props,o=this.context.gl,s=null;if(a.scenegraph instanceof ta)s={scenes:[a.scenegraph]};else if(a.scenegraph&&!a.scenegraph.gltf){var u=a.scenegraph,l=K0(o,u,this._getModelOptions());s=YQ({gltf:u},l),WQ(l).then(function(){return i.setNeedsRedraw()})}else a.scenegraph&&(J.deprecated("ScenegraphLayer.props.scenegraph","Use GLTFLoader instead of GLTFScenegraphLoader")(),s=a.scenegraph);var f={layer:this,gl:o},c=a.getScene(s,f),p=a.getAnimator(s,f);c instanceof ta?(this._deleteScenegraph(),this._applyAllAttributes(c),this._applyAnimationsProp(c,p,a._animations),this.setState({scenegraph:c,animator:p})):c!==null&&J.warn("invalid scenegraph:",c)()}},{key:"_applyAllAttributes",value:function(i){var a=this;if(this.state.attributesAvailable){var o=this.getAttributeManager().getAttributes();i.traverse(function(s){a._setModelAttributes(s.model,o)})}}},{key:"_applyAnimationsProp",value:function(i,a,o){if(!(!i||!a||!o)){var s=a.getAnimations();Object.keys(o).sort().forEach(function(u){var l=o[u];if(u==="*")s.forEach(function(p){Object.assign(p,l)});else if(Number.isFinite(Number(u))){var f=Number(u);f>=0&&f<s.length?Object.assign(s[f],l):J.warn("animation ".concat(u," not found"))()}else{var c=s.find(function(p){var d=p.name;return d===u});c?Object.assign(c,l):J.warn("animation ".concat(u," not found"))()}})}}},{key:"_deleteScenegraph",value:function(){var i=this.state.scenegraph;i instanceof ta&&i.delete()}},{key:"_getModelOptions",value:function(){var i=this.props._imageBasedLightingEnvironment,a=null;return i&&(typeof i=="function"?a=i({gl:this.context.gl,layer:this}):a=i),{gl:this.context.gl,waitForFullLoad:!0,imageBasedLightingEnvironment:a,modelOptions:YQ({isInstanced:!0,transpileToGLSL100:!ce(this.context.gl)},this.getShaders()),useTangents:!1}}},{key:"updateAttributes",value:function(i){var a=this;this.setState({attributesAvailable:!0}),this.state.scenegraph&&this.state.scenegraph.traverse(function(o){a._setModelAttributes(o.model,i)})}},{key:"draw",value:function(i){var a=i.moduleParameters,o=a===void 0?null:a,s=i.parameters,u=s===void 0?{}:s,l=i.context;if(this.state.scenegraph){this.props._animations&&this.state.animator&&(this.state.animator.animate(l.timeline.getTime()),this.setNeedsRedraw());var f=this.context.viewport,c=this.props,p=c.sizeScale,d=c.sizeMinPixels,v=c.sizeMaxPixels,m=c.opacity,g=c.coordinateSystem,y=this.getNumInstances();this.state.scenegraph.traverse(function(_,b){var x=b.worldMatrix;_.model.setInstanceCount(y),_.updateModuleSettings(o),_.draw({parameters:u,uniforms:{sizeScale:p,opacity:m,sizeMinPixels:d,sizeMaxPixels:v,composeModelMatrix:L0(f,g),sceneModelMatrix:x,u_Camera:_.model.getUniforms().project_uCameraPosition}})})}}}]),e}(He);(0,Id.default)(Cf,"defaultProps",hIe);(0,Id.default)(Cf,"layerName","ScenegraphLayer");var oee=h(L()),see=h(N()),Mf=h(Ee()),uee=h(Y()),lee=h(K()),Ho=h(q()),s_=h(B());var nee=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
uniform bool pickFeatureIds;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec4 uvRegions;
in vec3 featureIdsPickingColors;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;

vec2 applyUVRegion(vec2 uv) {
  #ifdef HAS_UV_REGIONS
    return fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;
  #else
    return uv;
  #endif
}

void main(void) {
  vec2 uv = applyUVRegion(texCoords);
  geometry.uv = uv;

  if (pickFeatureIds) {
    geometry.pickingColor = featureIdsPickingColors;
  } else {
    geometry.pickingColor = instancePickingColors;
  }

  vTexCoord = uv;
  cameraPosition = project_uCameraPosition;
  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);

  vec3 pos = (instanceModelMatrix * positions) * sizeScale;
  vec3 projectedPosition = project_position(positions);
  position_commonspace = vec4(projectedPosition, 1.0);
  gl_Position = project_common_position_to_clipspace(position_commonspace);

  geometry.position = position_commonspace;
  normals_commonspace = project_normal(instanceModelMatrix * normals);
  geometry.normal = normals_commonspace;

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  #ifdef MODULE_PBR
    pbr_vPosition = geometry.position.xyz;
    #ifdef HAS_NORMALS
      pbr_vNormal = geometry.normal;
    #endif

    #ifdef HAS_UV
      pbr_vUV = uv;
    #else
      pbr_vUV = vec2(0., 0.);
    #endif
    geometry.uv = pbr_vUV;
  #endif

  DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var iee=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs

precision highp float;

uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;

in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;

out vec4 fragColor;

void main(void) {
  
#ifdef MODULE_PBR

  fragColor = vColor * pbr_filterColor(vec4(0));
  geometry.uv = pbr_vUV;
  fragColor.a *= opacity;

#else

  geometry.uv = vTexCoord;

  vec3 normal;
  if (flatShading) {
#ifdef DERIVATIVES_AVAILABLE
    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
#else
    normal = vec3(0.0, 0.0, 1.0);
#endif
  } else {
    normal = normals_commonspace;
  }

  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
  fragColor = vec4(lightColor, color.a * opacity);

#endif

  DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function aee(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Vo(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?aee(Object(e),!0).forEach(function(n){(0,s_.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):aee(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function dIe(t){var r=vIe();return function(){var n=(0,Ho.default)(t),i;if(r){var a=(0,Ho.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lee.default)(this,i)}}function vIe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function mIe(t){var r=t.COLOR_0||t.colors;r||(t.colors={constant:!0,value:new Float32Array([1,1,1])})}var gIe={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}},u_=function(t){(0,uee.default)(e,t);var r=dIe(e);function e(){return(0,oee.default)(this,e),r.apply(this,arguments)}return(0,see.default)(e,[{key:"getShaders",value:function(){var i=(0,Mf.default)((0,Ho.default)(e.prototype),"getShaders",this).call(this),a=i.modules;return a.push(go),Vo(Vo({},i),{},{vs:nee,fs:iee})}},{key:"initializeState",value:function(){var i=this.props.featureIds;(0,Mf.default)((0,Ho.default)(e.prototype),"initializeState",this).call(this);var a=this.getAttributeManager();i&&a.add({featureIdsPickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}},{key:"updateState",value:function(i){(0,Mf.default)((0,Ho.default)(e.prototype),"updateState",this).call(this,i);var a=i.props,o=i.oldProps;a.pbrMaterial!==o.pbrMaterial&&this.updatePbrMaterialUniforms(a.pbrMaterial)}},{key:"draw",value:function(i){var a=this.props.featureIds;this.state.model&&(this.state.model.setUniforms({u_Camera:this.state.model.getUniforms().project_uCameraPosition,pickFeatureIds:Boolean(a)}),(0,Mf.default)((0,Ho.default)(e.prototype),"draw",this).call(this,i))}},{key:"getModel",value:function(i){var a=this.props,o=a.id,s=a.pbrMaterial,u=this.parseMaterial(s,i);this.setState({materialParser:u});var l=this.getShaders();mIe(i.attributes);var f=new Ce(this.context.gl,Vo(Vo({},this.getShaders()),{},{id:o,geometry:i,defines:Vo(Vo(Vo({},l.defines),u?.defines),{},{HAS_UV_REGIONS:i.attributes.uvRegions}),parameters:u?.parameters,isInstanced:!0}));return f}},{key:"updatePbrMaterialUniforms",value:function(i){var a=this.state.model;if(a){var o=this.props.mesh,s=this.parseMaterial(i,o);this.setState({materialParser:s}),a.setUniforms(s.uniforms)}}},{key:"parseMaterial",value:function(i,a){var o,s=Boolean(i.pbrMetallicRoughness&&i.pbrMetallicRoughness.baseColorTexture);return(o=this.state.materialParser)===null||o===void 0||o.delete(),new md(this.context.gl,{attributes:{NORMAL:a.attributes.normals,TEXCOORD_0:a.attributes.texCoords},material:Vo({unlit:s},i),pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1})}},{key:"calculateFeatureIdsPickingColors",value:function(i){for(var a=this.props.featureIds,o=new Uint8ClampedArray(a.length*i.size),s=[],u=0;u<a.length;u++)this.encodePickingColor(a[u],s),o[u*3]=s[0],o[u*3+1]=s[1],o[u*3+2]=s[2];i.value=o}},{key:"finalizeState",value:function(i){var a;(0,Mf.default)((0,Ho.default)(e.prototype),"finalizeState",this).call(this,i),(a=this.state.materialParser)===null||a===void 0||a.delete(),this.setState({materialParser:null})}}]),e}(Ga);(0,s_.default)(u_,"layerName","MeshLayer");(0,s_.default)(u_,"defaultProps",gIe);var KC=h(me()),A_=h(ye()),Bte=h(B()),Fte=h(L()),Dte=h(N()),_u=h(ve());function SC(t){if(Array.isArray(t))return t}function TC(t,r){var e=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(e!=null){var n=[],i=!0,a=!1,o,s;try{for(e=e.call(t);!(i=(o=e.next()).done)&&(n.push(o.value),!(r&&n.length===r));i=!0);}catch(u){a=!0,s=u}finally{try{!i&&e.return!=null&&e.return()}finally{if(a)throw s}}return n}}function l_(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function wC(t,r){if(t){if(typeof t=="string")return l_(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return l_(t,r)}}function PC(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function OC(t,r){return SC(t)||TC(t,r)||wC(t,r)||PC()}function EC(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function fee(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function CC(t,r,e){return r&&fee(t.prototype,r),e&&fee(t,e),t}function jn(t,r,e){return r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e,t}var $a=6378137,Xa=6378137,qa=6356752314245179e-9,yIe={radii:[$a,Xa,qa],radiiSquared:[$a*$a,Xa*Xa,qa*qa],oneOverRadii:[1/$a,1/Xa,1/qa],oneOverRadiiSquared:[1/($a*$a),1/(Xa*Xa),1/(qa*qa)],maximumRadius:Math.max($a,Xa,qa),centerToleranceSquared:.1};function f_(t){return t}var bvt=new j;function _Ie(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:f_;return"longitude"in t?(r[0]=e(t.longitude),r[1]=e(t.latitude),r[2]=t.height):"x"in t?(r[0]=e(t.x),r[1]=e(t.y),r[2]=t.z):(r[0]=e(t[0]),r[1]=e(t[1]),r[2]=t[2]),r}function cee(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return _Ie(t,r,ft._cartographicRadians?f_:uS)}function bIe(t,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:f_;return"longitude"in r?(r.longitude=e(t[0]),r.latitude=e(t[1]),r.height=t[2]):"x"in r?(r.x=e(t[0]),r.y=e(t[1]),r.z=t[2]):(r[0]=e(t[0]),r[1]=e(t[1]),r[2]=t[2]),r}function pee(t,r){return bIe(t,r,ft._cartographicRadians?f_:lS)}var If=new j,xIe=new j,AIe=new j;function MC(t,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],n=r.oneOverRadii,i=r.oneOverRadiiSquared,a=r.centerToleranceSquared;If.from(t);var o=If.x,s=If.y,u=If.z,l=n.x,f=n.y,c=n.z,p=o*o*l*l,d=s*s*f*f,v=u*u*c*c,m=p+d+v,g=Math.sqrt(1/m);if(Number.isFinite(g)){var y=xIe;if(y.copy(t).scale(g),m<a)return y.to(e);var _=i.x,b=i.y,x=i.z,A=AIe;A.set(y.x*_*2,y.y*b*2,y.z*x*2);var S=(1-g)*If.len()/(.5*A.len()),P=0,O,C,T,I;do{S-=P,O=1/(1+S*_),C=1/(1+S*b),T=1/(1+S*x);var R=O*O,V=C*C,z=T*T,k=R*O,G=V*C,U=z*T;I=p*R+d*V+v*z-1;var $=p*k*_+d*G*b+v*U*x,H=-2*$;P=I/H}while(Math.abs(I)>Fi.EPSILON12);return If.scale([O,C,T]).to(e)}}var hee=1e-14,SIe=new j,dee={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},IC={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},Ya={east:new j,north:new j,up:new j,west:new j,south:new j,down:new j},TIe=new j,wIe=new j,PIe=new j;function c_(t,r,e,n,i,a){var o=dee[r]&&dee[r][e];Ke(o&&(!n||n===o));var s,u,l,f=SIe.copy(i),c=tt(f.x,0,hee)&&tt(f.y,0,hee);if(c){var p=Math.sign(f.z);s=TIe.fromArray(IC[r]),r!=="east"&&r!=="west"&&s.scale(p),u=wIe.fromArray(IC[e]),e!=="east"&&e!=="west"&&u.scale(p),l=PIe.fromArray(IC[n]),n!=="east"&&n!=="west"&&l.scale(p)}else{var d=Ya.up,v=Ya.east,m=Ya.north;v.set(-f.y,f.x,0).normalize(),t.geodeticSurfaceNormal(f,d),m.copy(d).cross(v);var g=Ya.down,y=Ya.west,_=Ya.south;g.copy(d).scale(-1),y.copy(v).scale(-1),_.copy(m).scale(-1),s=Ya[r],u=Ya[e],l=Ya[n]}return a[0]=s.x,a[1]=s.y,a[2]=s.z,a[3]=0,a[4]=u.x,a[5]=u.y,a[6]=u.z,a[7]=0,a[8]=l.x,a[9]=l.y,a[10]=l.z,a[11]=0,a[12]=f.x,a[13]=f.y,a[14]=f.z,a[15]=1,a}var p_=new j,vee=new j,OIe=new j,mi=new j,EIe=new j,h_=new j;var it=function(){function t(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;EC(this,t),jn(this,"radii",void 0),jn(this,"radiiSquared",void 0),jn(this,"radiiToTheFourth",void 0),jn(this,"oneOverRadii",void 0),jn(this,"oneOverRadiiSquared",void 0),jn(this,"minimumRadius",void 0),jn(this,"maximumRadius",void 0),jn(this,"centerToleranceSquared",Fi.EPSILON1),jn(this,"squaredXOverSquaredZ",void 0),Ke(r>=0),Ke(e>=0),Ke(n>=0),this.radii=new j(r,e,n),this.radiiSquared=new j(r*r,e*e,n*n),this.radiiToTheFourth=new j(r*r*r*r,e*e*e*e,n*n*n*n),this.oneOverRadii=new j(r===0?0:1/r,e===0?0:1/e,n===0?0:1/n),this.oneOverRadiiSquared=new j(r===0?0:1/(r*r),e===0?0:1/(e*e),n===0?0:1/(n*n)),this.minimumRadius=Math.min(r,e,n),this.maximumRadius=Math.max(r,e,n),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}return CC(t,[{key:"equals",value:function(e){return this===e||Boolean(e&&this.radii.equals(e.radii))}},{key:"toString",value:function(){return this.radii.toString()}},{key:"cartographicToCartesian",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0],i=vee,a=OIe,o=OC(e,3),s=o[2];this.geodeticSurfaceNormalCartographic(e,i),a.copy(this.radiiSquared).scale(i);var u=Math.sqrt(i.dot(a));return a.scale(1/u),i.scale(s),a.add(i),a.to(n)}},{key:"cartesianToCartographic",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];h_.from(e);var i=this.scaleToGeodeticSurface(h_,mi);if(i){var a=this.geodeticSurfaceNormal(i,vee),o=EIe;o.copy(h_).subtract(i);var s=Math.atan2(a.y,a.x),u=Math.asin(a.z),l=Math.sign(Tp(o,h_))*Sp(o);return pee([s,u,l],n)}}},{key:"eastNorthUpToFixedFrame",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new pe;return c_(this,"east","north","up",e,n)}},{key:"localFrameToFixedFrame",value:function(e,n,i,a){var o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:new pe;return c_(this,e,n,i,a,o)}},{key:"geocentricSurfaceNormal",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return p_.from(e).normalize().to(n)}},{key:"geodeticSurfaceNormalCartographic",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0],i=cee(e),a=i[0],o=i[1],s=Math.cos(o);return p_.set(s*Math.cos(a),s*Math.sin(a),Math.sin(o)).normalize(),p_.to(n)}},{key:"geodeticSurfaceNormal",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return p_.from(e).scale(this.oneOverRadiiSquared).normalize().to(n)}},{key:"scaleToGeodeticSurface",value:function(e,n){return MC(e,this,n)}},{key:"scaleToGeocentricSurface",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];mi.from(e);var i=mi.x,a=mi.y,o=mi.z,s=this.oneOverRadiiSquared,u=1/Math.sqrt(i*i*s.x+a*a*s.y+o*o*s.z);return mi.multiplyScalar(u).to(n)}},{key:"transformPositionToScaledSpace",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return mi.from(e).scale(this.oneOverRadii).to(n)}},{key:"transformPositionFromScaledSpace",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return mi.from(e).scale(this.radii).to(n)}},{key:"getSurfaceNormalIntersectionWithZAxis",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[0,0,0];Ke(tt(this.radii.x,this.radii.y,Fi.EPSILON15)),Ke(this.radii.z>0),mi.from(e);var a=mi.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(a)>=this.radii.z-n))return mi.set(0,0,a).to(i)}}]),t}();jn(it,"WGS84",new it($a,Xa,qa));function Rd(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){let r=process.hrtime();t=r[0]*1e3+r[1]/1e6}else t=Date.now();return t}var mu=class{constructor(r,e){w(this,"name",void 0),w(this,"type",void 0),w(this,"sampleSize",1),w(this,"time",0),w(this,"count",0),w(this,"samples",0),w(this,"lastTiming",0),w(this,"lastSampleTime",0),w(this,"lastSampleCount",0),w(this,"_count",0),w(this,"_time",0),w(this,"_samples",0),w(this,"_startTime",0),w(this,"_timerPending",!1),this.name=r,this.type=e,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(r){return this.sampleSize=r,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(r){return this._count+=r,this._samples++,this._checkSampling(),this}subtractCount(r){return this._count-=r,this._samples++,this._checkSampling(),this}addTime(r){return this._time+=r,this.lastTiming=r,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=Rd(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(Rd()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}};var Rf=class{constructor(r){w(this,"id",void 0),w(this,"stats",{}),this.id=r.id,this.stats={},this._initializeStats(r.stats),Object.seal(this)}get(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:r,type:e})}get size(){return Object.keys(this.stats).length}reset(){for(let r of Object.values(this.stats))r.reset();return this}forEach(r){for(let e of Object.values(this.stats))r(e)}getTable(){let r={};return this.forEach(e=>{r[e.name]={time:e.time||0,count:e.count||0,average:e.getAverageTime()||0,hz:e.getHz()||0}}),r}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(e=>this._getOrCreate(e))}_getOrCreate(r){let{name:e,type:n}=r,i=this.stats[e];return i||(r instanceof mu?i=r:i=new mu(e,n),this.stats[e]=i),i}};var xee=h(L()),Aee=h(N());var yee=h(L()),_ee=h(N());var mee=h(L());var gee=function t(r,e,n){(0,mee.default)(this,t),w(this,"item",void 0),w(this,"previous",void 0),w(this,"next",void 0),this.item=r,this.previous=e,this.next=n};var bee=function(){function t(){(0,yee.default)(this,t),w(this,"head",null),w(this,"tail",null),w(this,"_length",0)}return(0,_ee.default)(t,[{key:"length",get:function(){return this._length}},{key:"add",value:function(e){var n=new gee(e,this.tail,null);return this.tail?(this.tail.next=n,this.tail=n):(this.head=n,this.tail=n),++this._length,n}},{key:"remove",value:function(e){e&&(e.previous&&e.next?(e.previous.next=e.next,e.next.previous=e.previous):e.previous?(e.previous.next=null,this.tail=e.previous):e.next?(e.next.previous=null,this.head=e.next):(this.head=null,this.tail=null),e.next=null,e.previous=null,--this._length)}},{key:"splice",value:function(e,n){e!==n&&(this.remove(n),this._insert(e,n))}},{key:"_insert",value:function(e,n){var i=e.next;e.next=n,this.tail===e?this.tail=n:i.previous=n,n.next=i,n.previous=e,++this._length}}]),t}();var See=function(){function t(){(0,xee.default)(this,t),w(this,"_list",void 0),w(this,"_sentinel",void 0),w(this,"_trimTiles",void 0),this._list=new bee,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}return(0,Aee.default)(t,[{key:"reset",value:function(){this._list.splice(this._list.tail,this._sentinel)}},{key:"touch",value:function(e){var n=e._cacheNode;n&&this._list.splice(this._sentinel,n)}},{key:"add",value:function(e,n,i){n._cacheNode||(n._cacheNode=this._list.add(n),i&&i(e,n))}},{key:"unloadTile",value:function(e,n,i){var a=n._cacheNode;a&&(this._list.remove(a),n._cacheNode=null,i&&i(e,n))}},{key:"unloadTiles",value:function(e,n){var i=this._trimTiles;this._trimTiles=!1;for(var a=this._list,o=e.maximumMemoryUsage*1024*1024,s=this._sentinel,u=a.head;u!==s&&(e.gpuMemoryUsageInBytes>o||i);){var l=u.item;u=u.next,this.unloadTile(e,l,n)}}},{key:"trim",value:function(){this._trimTiles=!0}}]),t}();function Tee(t,r){Ne(t),Ne(r);var e=r.rtcCenter,n=r.gltfUpAxis,i=t.computedTransform,a=t.boundingVolume.center,o=new pe(i);switch(e&&o.translate(e),n){case"Z":break;case"Y":var s=new pe().rotateX(Math.PI/2);o=o.multiplyRight(s);break;case"X":var u=new pe().rotateY(-Math.PI/2);o=o.multiplyRight(u);break;default:break}r.isQuantized&&o.translate(r.quantizedVolumeOffset).scale(r.quantizedVolumeScale);var l=new j(a);r.cartesianModelMatrix=o,r.cartesianOrigin=l;var f=it.WGS84.cartesianToCartographic(l,new j),c=it.WGS84.eastNorthUpToFixedFrame(l),p=c.invert();r.cartographicModelMatrix=p.multiplyRight(o),r.cartographicOrigin=f,r.coordinateSystem||(r.modelMatrix=r.cartographicModelMatrix)}var LC=h(me());function CIe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=MIe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function MIe(t,r){if(t){if(typeof t=="string")return wee(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return wee(t,r)}}function wee(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var Pee=new j,RC=new j,kC=new en([new Yt,new Yt,new Yt,new Yt,new Yt,new Yt]);function Eee(t,r){var e=t.cameraDirection,n=t.cameraUp,i=t.height,a=t.distanceScales.metersPerUnit,o=d_(t,t.center),s=it.WGS84.eastNorthUpToFixedFrame(o),u=t.unprojectPosition(t.cameraPosition),l=it.WGS84.cartographicToCartesian(u,new j),f=new j(s.transformAsVector(new j(e).scale(a))).normalize(),c=new j(s.transformAsVector(new j(n).scale(a))).normalize();IIe(t);var p=t.constructor,d=t.longitude,v=t.latitude,m=t.width,g=t.bearing,y=t.zoom,_=new p({longitude:d,latitude:v,height:i,width:m,bearing:g,zoom:y,pitch:0});return{camera:{position:l,direction:f,up:c},viewport:t,topDownViewport:_,height:i,cullingVolume:kC,frameNumber:r,sseDenominator:1.15}}function Cee(t,r,e){if(e===0||t.length<=e)return[t,[]];var n=[],i=r.viewport,a=i.longitude,o=i.latitude,s=CIe(t.entries()),u;try{for(s.s();!(u=s.n()).done;){var l=(0,LC.default)(u.value,2),f=l[0],c=l[1],p=(0,LC.default)(c.header.mbs,2),d=p[0],v=p[1],m=Math.abs(a-d),g=Math.abs(o-v),y=Math.sqrt(g*g+m*m);n.push([f,y])}}catch(P){s.e(P)}finally{s.f()}for(var _=n.sort(function(P,O){return P[1]-O[1]}),b=[],x=0;x<e;x++)b.push(t[_[x][0]]);for(var A=[],S=e;S<_.length;S++)A.push(t[_[S][0]]);return[b,A]}function IIe(t){var r=t.getFrustumPlanes(),e=Oee(r.near,t.cameraPosition),n=d_(t,e),i=d_(t,t.cameraPosition,RC),a=0;kC.planes[a++].fromPointNormal(n,Pee.copy(n).subtract(i));for(var o in r)if(o!=="near"){var s=r[o],u=Oee(s,e,RC),l=d_(t,u,RC);kC.planes[a++].fromPointNormal(l,Pee.copy(n).subtract(l))}}function Oee(t,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new j,n=t.normal.dot(r);return e.copy(t.normal).scale(t.distance-n).add(r),e}function d_(t,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new j,n=t.unprojectPosition(r);return it.WGS84.cartographicToCartesian(n,e)}var Iee=h(me());var RIe=6378137,LIe=6378137,BC=6356752314245179e-9,Mee=new j;function Ree(t,r){if(t instanceof su){var e=t.halfAxes,n=kIe(e);return Math.log2(BC/(n+r[2]))}else if(t instanceof Do){var i=t.radius;return Math.log2(BC/(i+r[2]))}else if(t.width&&t.height){var a=t.width,o=t.height,s=Math.log2(RIe/a),u=Math.log2(LIe/o);return(s+u)/2}return 1}function FC(t,r,e){var n=it.WGS84.cartographicToCartesian([t.xmax,t.ymax,t.zmax],new j),i=Math.sqrt(Math.pow(n[0]-e[0],2)+Math.pow(n[1]-e[1],2)+Math.pow(n[2]-e[2],2));return Math.log2(BC/(i+r[2]))}function Lee(t,r,e){var n=(0,Iee.default)(t,4),i=n[0],a=n[1],o=n[2],s=n[3];return FC({xmin:i,xmax:o,ymin:a,ymax:s,zmin:0,zmax:0},r,e)}function kIe(t){t.getColumn(0,Mee);var r=t.getColumn(1),e=t.getColumn(2),n=Mee.add(r).add(e),i=n.len();return i}var VC=h(B()),rte=h(ye()),nte=h(L()),ite=h(N()),zC=h(ve());var Wr={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5},nn={ADD:1,REPLACE:2},Ka={EMPTY:"empty",SCENEGRAPH:"scenegraph",POINTCLOUD:"pointcloud",MESH:"mesh"},Pr={I3S:"I3S",TILES3D:"TILES3D"},gu={GEOMETRIC_ERROR:"geometricError",MAX_SCREEN_THRESHOLD:"maxScreenThreshold"},kee={NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0};var yu=h(Zt()),DC=h(me());function Fee(t){return t!=null}var Or=new j,v_=new j,BIe=new j,FIe=new j;function m_(t,r,e){if(Ne(t,"3D Tile: boundingVolume must be defined"),t.box)return DIe(t.box,r,e);if(t.region){var n=(0,DC.default)(t.region,6),i=n[0],a=n[1],o=n[2],s=n[3],u=n[4],l=n[5],f=it.WGS84.cartographicToCartesian([vr(i),vr(s),u],BIe),c=it.WGS84.cartographicToCartesian([vr(o),vr(a),l],FIe),p=new j().addVectors(f,c).multiplyScalar(.5),d=new j().subVectors(f,c).len()/2;return Bee([p[0],p[1],p[2],d],new pe)}if(t.sphere)return Bee(t.sphere,r,e);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function Dee(t,r){if(t.box)return NIe(r);if(t.region){var e=(0,DC.default)(t.region,6),n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5];return[[vr(n),vr(i),s],[vr(a),vr(o),u]]}if(t.sphere)return jIe(r);throw new Error("Unkown boundingVolume type")}function DIe(t,r,e){var n=new j(t[0],t[1],t[2]);r.transform(n,n);var i=[];if(t.length===10){var a=t.slice(3,6),o=new Bi;o.fromArray(t,6);var s=new j([1,0,0]),u=new j([0,1,0]),l=new j([0,0,1]);s.transformByQuaternion(o),s.scale(a[0]),u.transformByQuaternion(o),u.scale(a[1]),l.transformByQuaternion(o),l.scale(a[2]),i=[].concat((0,yu.default)(s.toArray()),(0,yu.default)(u.toArray()),(0,yu.default)(l.toArray()))}else i=[].concat((0,yu.default)(t.slice(3,6)),(0,yu.default)(t.slice(6,9)),(0,yu.default)(t.slice(9,12)));var f=r.transformAsVector(i.slice(0,3)),c=r.transformAsVector(i.slice(3,6)),p=r.transformAsVector(i.slice(6,9)),d=new ct([f[0],f[1],f[2],c[0],c[1],c[2],p[0],p[1],p[2]]);return Fee(e)?(e.center=n,e.halfAxes=d,e):new su(n,d)}function Bee(t,r,e){var n=new j(t[0],t[1],t[2]);r.transform(n,n);var i=r.getScale(v_),a=Math.max(Math.max(i[0],i[1]),i[2]),o=t[3]*a;return Fee(e)?(e.center=n,e.radius=o,e):new Do(n,o)}function NIe(t){for(var r=Nee(),e=t.halfAxes,n=new j(e.getColumn(0)),i=new j(e.getColumn(1)),a=new j(e.getColumn(2)),o=0;o<2;o++){for(var s=0;s<2;s++){for(var u=0;u<2;u++)Or.copy(t.center),Or.add(n),Or.add(i),Or.add(a),jee(r,Or),a.negate();i.negate()}n.negate()}return r}function jIe(t){var r=Nee(),e=t.center,n=t.radius,i=it.WGS84.scaleToGeodeticSurface(e,Or),a;i?a=it.WGS84.geodeticSurfaceNormal(i):a=new j(0,0,1);var o=new j(a[2],-a[1],0);o.len()>0?o.normalize():o=new j(0,1,0);for(var s=o.clone().cross(a),u=0,l=[o,s,a];u<l.length;u++){var f=l[u];v_.copy(f).scale(n);for(var c=0;c<2;c++)Or.copy(e),Or.add(v_),jee(r,Or),v_.negate()}return r}function Nee(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function jee(t,r){it.WGS84.cartesianToCartographic(r,Or),t[0][0]=Math.min(t[0][0],Or[0]),t[0][1]=Math.min(t[0][1],Or[1]),t[0][2]=Math.min(t[0][2],Or[2]),t[1][0]=Math.max(t[1][0],Or[0]),t[1][1]=Math.max(t[1][1],Or[1]),t[1][2]=Math.max(t[1][2],Or[2])}var Tmt=new j,wmt=new j,Pmt=new pe,Omt=new j,Emt=new j,Cmt=new j;function UIe(t,r){var e=t*r;return 1-Math.exp(-(e*e))}function GIe(t,r){if(t.dynamicScreenSpaceError&&t.dynamicScreenSpaceErrorComputedDensity){var e=t.dynamicScreenSpaceErrorComputedDensity,n=t.dynamicScreenSpaceErrorFactor,i=UIe(r,e)*n;return i}return 0}function Uee(t,r,e){var n=t.tileset,i=t.parent&&t.parent.lodMetricValue||t.lodMetricValue,a=e?i:t.lodMetricValue;if(a===0)return 0;var o=Math.max(t._distanceToCamera,1e-7),s=r.height,u=r.sseDenominator,l=n.options.viewDistanceScale,f=a*s*(l||1)/(o*u);return f-=GIe(n,o),f}var Hee=h(Zt());var NC=new j,Gee=new j,Wo=new j,zee=new j,zIe=new j,jC=new pe,Vee=new pe;function Wee(t,r){if(t.lodMetricValue===0||isNaN(t.lodMetricValue))return"DIG";var e=2*UC(t,r);return e<2?"OUT":!t.header.children||e<=t.lodMetricValue?"DRAW":t.header.children?"DIG":"OUT"}function UC(t,r){var e=r.topDownViewport,n=t.header.mbs[1],i=t.header.mbs[0],a=t.header.mbs[2],o=t.header.mbs[3],s=(0,Hee.default)(t.boundingVolume.center),u=e.unprojectPosition(e.cameraPosition);it.WGS84.cartographicToCartesian(u,NC),Gee.copy(NC).subtract(s).normalize(),it.WGS84.eastNorthUpToFixedFrame(s,jC),Vee.copy(jC).invert(),Wo.copy(NC).transform(Vee);var l=Math.sqrt(Wo[0]*Wo[0]+Wo[1]*Wo[1]),f=l*l/Wo[2];zee.copy([Wo[0],Wo[1],f]);var c=zee.transform(jC),p=c.subtract(s).normalize(),d=Gee.cross(p).normalize().scale(o),v=d.add(s),m=it.WGS84.cartesianToCartographic(v),g=e.project([i,n,a]),y=e.project(m),_=zIe.copy(g).subtract(y).magnitude();return _}function $ee(t){return{assetGltfUpAxis:t.asset&&t.asset.gltfUpAxis||"Y"}}var Zee=h(B()),Jee=h(L()),Qee=h(N());var Xee=h(L()),qee=h(N());var GC=function(){function t(){(0,Xee.default)(this,t);var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;w(this,"_map",new Map),w(this,"_array",void 0),w(this,"_length",void 0),this._array=new Array(r),this._length=r}return(0,qee.default)(t,[{key:"length",get:function(){return this._length},set:function(e){this._length=e,e>this._array.length&&(this._array.length=e)}},{key:"values",get:function(){return this._array}},{key:"get",value:function(e){return Ne(e<this._array.length),this._array[e]}},{key:"set",value:function(e,n){Ne(e>=0),e>=this.length&&(this.length=e+1),this._map.has(this._array[e])&&this._map.delete(this._array[e]),this._array[e]=n,this._map.set(n,e)}},{key:"delete",value:function(e){var n=this._map.get(e);n>=0&&(this._array.splice(n,1),this._map.delete(e),this.length--)}},{key:"peek",value:function(){return this._array[this._length-1]}},{key:"push",value:function(e){if(!this._map.has(e)){var n=this.length++;this._array[n]=e,this._map.set(e,n)}}},{key:"pop",value:function(){var e=this._array[--this.length];return this._map.delete(e),e}},{key:"reserve",value:function(e){Ne(e>=0),e>this._array.length&&(this._array.length=e)}},{key:"resize",value:function(e){Ne(e>=0),this.length=e}},{key:"trim",value:function(e){e==null&&(e=this.length),this._array.length=e}},{key:"reset",value:function(){this._array=[],this._map=new Map,this._length=0}},{key:"find",value:function(e){return this._map.has(e)}}]),t}();function g_(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=VIe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function VIe(t,r){if(t){if(typeof t=="string")return Yee(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Yee(t,r)}}function Yee(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function Kee(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function y_(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Kee(Object(e),!0).forEach(function(n){(0,Zee.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Kee(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var HIe={loadSiblings:!1,skipLevelOfDetail:!1,maximumScreenSpaceError:2,updateTransforms:!0,onTraversalEnd:function(){},viewportTraversersMap:{},basePath:""},$o=function(){function t(r){(0,Jee.default)(this,t),w(this,"options",void 0),w(this,"root",null),w(this,"selectedTiles",{}),w(this,"requestedTiles",{}),w(this,"emptyTiles",{}),w(this,"lastUpdate",new Date().getTime()),w(this,"updateDebounceTime",1e3),w(this,"_traversalStack",new GC),w(this,"_emptyTraversalStack",new GC),w(this,"_frameNumber",null),this.options=y_(y_({},HIe),r)}return(0,Qee.default)(t,[{key:"traversalFinished",value:function(e){return!0}},{key:"traverse",value:function(e,n,i){this.root=e,this.options=y_(y_({},this.options),i),this.reset(),this.updateTile(e,n),this._frameNumber=n.frameNumber,this.executeTraversal(e,n)}},{key:"reset",value:function(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}},{key:"executeTraversal",value:function(e,n){var i=this._traversalStack;for(e._selectionDepth=1,i.push(e);i.length>0;){var a=i.pop(),o=!1;this.canTraverse(a,n)&&(this.updateChildTiles(a,n),o=this.updateAndPushChildren(a,n,i,a.hasRenderContent?a._selectionDepth+1:a._selectionDepth));var s=a.parent,u=Boolean(!s||s._shouldRefine),l=!o;a.hasRenderContent?a.refine===nn.ADD?(this.loadTile(a,n),this.selectTile(a,n)):a.refine===nn.REPLACE&&(this.loadTile(a,n),l&&this.selectTile(a,n)):(this.emptyTiles[a.id]=a,this.loadTile(a,n),l&&this.selectTile(a,n)),this.touchTile(a,n),a._shouldRefine=o&&u}var f=new Date().getTime();(this.traversalFinished(n)||f-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=f,this.options.onTraversalEnd(n))}},{key:"updateChildTiles",value:function(e,n){var i=e.children,a=g_(i),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;this.updateTile(s,n)}}catch(u){a.e(u)}finally{a.f()}}},{key:"updateAndPushChildren",value:function(e,n,i,a){var o=this.options,s=o.loadSiblings,u=o.skipLevelOfDetail,l=e.children;l.sort(this.compareDistanceToCamera.bind(this));var f=e.refine===nn.REPLACE&&e.hasRenderContent&&!u,c=!1,p=!0,d=g_(l),v;try{for(d.s();!(v=d.n()).done;){var m=v.value;if(m._selectionDepth=a,m.isVisibleAndInRequestVolume?(i.find(m)&&i.delete(m),i.push(m),c=!0):(f||s)&&(this.loadTile(m,n),this.touchTile(m,n)),f){var g=void 0;if(m._inRequestVolume?m.hasRenderContent?g=m.contentAvailable:g=this.executeEmptyTraversal(m,n):g=!1,p=p&&g,!p)return!1}}}catch(y){d.e(y)}finally{d.f()}return c||(p=!1),p}},{key:"updateTile",value:function(e,n){this.updateTileVisibility(e,n)}},{key:"selectTile",value:function(e,n){this.shouldSelectTile(e)&&(e._selectedFrame=n.frameNumber,this.selectedTiles[e.id]=e)}},{key:"loadTile",value:function(e,n){this.shouldLoadTile(e)&&(e._requestedFrame=n.frameNumber,e._priority=e._getPriority(),this.requestedTiles[e.id]=e)}},{key:"touchTile",value:function(e,n){e.tileset._cache.touch(e),e._touchedFrame=n.frameNumber}},{key:"canTraverse",value:function(e,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return e.hasChildren?e.hasTilesetContent?!e.contentExpired:!a&&!e.isVisibleAndInRequestVolume?!1:this.shouldRefine(e,n,i):!1}},{key:"shouldLoadTile",value:function(e){return e.hasUnloadedContent||e.contentExpired}},{key:"shouldSelectTile",value:function(e){return e.contentAvailable&&!this.options.skipLevelOfDetail}},{key:"shouldRefine",value:function(e,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,a=e._screenSpaceError;return i&&(a=e.getScreenSpaceError(n,!0)),a>this.options.maximumScreenSpaceError}},{key:"updateTileVisibility",value:function(e,n){var i=[];if(this.options.viewportTraversersMap)for(var a in this.options.viewportTraversersMap){var o=this.options.viewportTraversersMap[a];o===n.viewport.id&&i.push(a)}else i.push(n.viewport.id);e.updateVisibility(n,i)}},{key:"compareDistanceToCamera",value:function(e,n){return e._distanceToCamera-n._distanceToCamera}},{key:"anyChildrenVisible",value:function(e,n){var i=!1,a=g_(e.children),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;s.updateVisibility(n),i=i||s.isVisibleAndInRequestVolume}}catch(u){a.e(u)}finally{a.f()}return i}},{key:"executeEmptyTraversal",value:function(e,n){var i=!0,a=this._emptyTraversalStack;for(a.push(e);a.length>0&&i;){var o=a.pop();this.updateTile(o,n),o.isVisibleAndInRequestVolume||this.loadTile(o,n),this.touchTile(o,n);var s=!o.hasRenderContent&&this.canTraverse(o,n,!1,!0);if(s){var u=o.children,l=g_(u),f;try{for(l.s();!(f=l.n()).done;){var c=f.value;a.find(c)&&a.delete(c),a.push(c)}}catch(p){l.e(p)}finally{l.f()}}else o.contentAvailable||(i=!1)}return i}}]),t}();function ete(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Lf(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?ete(Object(e),!0).forEach(function(n){(0,VC.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):ete(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var tte=new j;function WIe(t){return t!=null}var Ld=function(){function t(r,e,n){(0,nte.default)(this,t);var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"";w(this,"tileset",void 0),w(this,"header",void 0),w(this,"id",void 0),w(this,"url",void 0),w(this,"parent",void 0),w(this,"refine",void 0),w(this,"type",void 0),w(this,"contentUrl",void 0),w(this,"lodMetricType","geometricError"),w(this,"lodMetricValue",0),w(this,"boundingVolume",null),w(this,"content",null),w(this,"contentState",Wr.UNLOADED),w(this,"gpuMemoryUsageInBytes",0),w(this,"children",[]),w(this,"depth",0),w(this,"viewportIds",[]),w(this,"transform",new pe),w(this,"extensions",null),w(this,"implicitTiling",null),w(this,"userData",{}),w(this,"computedTransform",void 0),w(this,"hasEmptyContent",!1),w(this,"hasTilesetContent",!1),w(this,"traverser",new $o({})),w(this,"_cacheNode",null),w(this,"_frameNumber",null),w(this,"_expireDate",null),w(this,"_expiredContent",null),w(this,"_boundingBox",void 0),w(this,"_distanceToCamera",0),w(this,"_screenSpaceError",0),w(this,"_visibilityPlaneMask",void 0),w(this,"_visible",void 0),w(this,"_contentBoundingVolume",void 0),w(this,"_viewerRequestVolume",void 0),w(this,"_initialTransform",new pe),w(this,"_priority",0),w(this,"_selectedFrame",0),w(this,"_requestedFrame",0),w(this,"_selectionDepth",0),w(this,"_touchedFrame",0),w(this,"_centerZDepth",0),w(this,"_shouldRefine",!1),w(this,"_stackLength",0),w(this,"_visitedFrame",0),w(this,"_inRequestVolume",!1),w(this,"_lodJudge",null),this.header=e,this.tileset=r,this.id=i||e.id,this.url=e.url,this.parent=n,this.refine=this._getRefine(e.refine),this.type=e.type,this.contentUrl=e.contentUrl,this._initializeLodMetric(e),this._initializeTransforms(e),this._initializeBoundingVolumes(e),this._initializeContent(e),this._initializeRenderingState(e),Object.seal(this)}return(0,ite.default)(t,[{key:"destroy",value:function(){this.header=null}},{key:"isDestroyed",value:function(){return this.header===null}},{key:"selected",get:function(){return this._selectedFrame===this.tileset._frameNumber}},{key:"isVisible",get:function(){return this._visible}},{key:"isVisibleAndInRequestVolume",get:function(){return this._visible&&this._inRequestVolume}},{key:"hasRenderContent",get:function(){return!this.hasEmptyContent&&!this.hasTilesetContent}},{key:"hasChildren",get:function(){return this.children.length>0||this.header.children&&this.header.children.length>0}},{key:"contentReady",get:function(){return this.contentState===Wr.READY||this.hasEmptyContent}},{key:"contentAvailable",get:function(){return Boolean(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}},{key:"hasUnloadedContent",get:function(){return this.hasRenderContent&&this.contentUnloaded}},{key:"contentUnloaded",get:function(){return this.contentState===Wr.UNLOADED}},{key:"contentExpired",get:function(){return this.contentState===Wr.EXPIRED}},{key:"contentFailed",get:function(){return this.contentState===Wr.FAILED}},{key:"distanceToCamera",get:function(){return this._distanceToCamera}},{key:"screenSpaceError",get:function(){return this._screenSpaceError}},{key:"boundingBox",get:function(){return this._boundingBox||(this._boundingBox=Dee(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}},{key:"getScreenSpaceError",value:function(e,n){switch(this.tileset.type){case Pr.I3S:return UC(this,e);case Pr.TILES3D:return Uee(this,e,n);default:throw new Error("Unsupported tileset type")}}},{key:"unselect",value:function(){this._selectedFrame=0}},{key:"_getGpuMemoryUsageInBytes",value:function(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}},{key:"_getPriority",value:function(){var e=this.tileset._traverser,n=e.options.skipLevelOfDetail,i=this.refine===nn.ADD||n;if(i&&!this.isVisible&&this._visible!==void 0||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===Wr.UNLOADED)return-1;var a=this.parent,o=a&&(!i||this._screenSpaceError===0||a.hasTilesetContent),s=o?a._screenSpaceError:this._screenSpaceError,u=e.root?e.root._screenSpaceError:0;return Math.max(u-s,0)}},{key:"loadContent",value:function(){var r=(0,rte.default)(zC.default.mark(function n(){var i,a,o,s,u;return zC.default.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(!this.hasEmptyContent){f.next=2;break}return f.abrupt("return",!1);case 2:if(!this.content){f.next=4;break}return f.abrupt("return",!0);case 4:return i=this.contentExpired,i&&(this._expireDate=null),this.contentState=Wr.LOADING,f.next=9,this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));case 9:if(a=f.sent,a){f.next=13;break}return this.contentState=Wr.UNLOADED,f.abrupt("return",!1);case 13:return f.prev=13,o=this.tileset.getTileUrl(this.contentUrl),s=this.tileset.loader,u=Lf(Lf({},this.tileset.loadOptions),{},(0,VC.default)({},s.id,Lf(Lf({},this.tileset.loadOptions[s.id]),{},{isTileset:this.type==="json"},this._getLoaderSpecificOptions(s.id)))),f.next=19,Jt(o,s,u);case 19:if(this.content=f.sent,!this.tileset.options.contentLoader){f.next=23;break}return f.next=23,this.tileset.options.contentLoader(this);case 23:return this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=Wr.READY,this._onContentLoaded(),f.abrupt("return",!0);case 29:throw f.prev=29,f.t0=f.catch(13),this.contentState=Wr.FAILED,f.t0;case 33:return f.prev=33,a.done(),f.finish(33);case 36:case"end":return f.stop()}},n,this,[[13,29,33,36]])}));function e(){return r.apply(this,arguments)}return e}()},{key:"unloadContent",value:function(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=Wr.UNLOADED,!0}},{key:"updateVisibility",value:function(e,n){if(this._frameNumber!==e.frameNumber){var i=this.parent,a=i?i._visibilityPlaneMask:en.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){var o=i?i.computedTransform:this.tileset.modelMatrix;this._updateTransform(o)}this._distanceToCamera=this.distanceToTile(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._visibilityPlaneMask=this.visibility(e,a),this._visible=this._visibilityPlaneMask!==en.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._frameNumber=e.frameNumber,this.viewportIds=n}}},{key:"visibility",value:function(e,n){var i=e.cullingVolume,a=this.boundingVolume;return i.computeVisibilityWithPlaneMask(a,n)}},{key:"contentVisibility",value:function(){return!0}},{key:"distanceToTile",value:function(e){var n=this.boundingVolume;return Math.sqrt(Math.max(n.distanceSquaredTo(e.camera.position),0))}},{key:"cameraSpaceZDepth",value:function(e){var n=e.camera,i=this.boundingVolume;return tte.subVectors(i.center,n.position),n.direction.dot(tte)}},{key:"insideViewerRequestVolume",value:function(e){var n=this._viewerRequestVolume;return!n||n.distanceSquaredTo(e.camera.position)<=0}},{key:"updateExpiration",value:function(){if(WIe(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){var e=Date.now();Date.lessThan(this._expireDate,e)&&(this.contentState=Wr.EXPIRED,this._expiredContent=this.content)}}},{key:"extras",get:function(){return this.header.extras}},{key:"_initializeLodMetric",value:function(e){"lodMetricType"in e?this.lodMetricType=e.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in e?this.lodMetricValue=e.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}},{key:"_initializeTransforms",value:function(e){this.transform=e.transform?new pe(e.transform):new pe;var n=this.parent,i=this.tileset,a=n&&n.computedTransform?n.computedTransform.clone():i.modelMatrix.clone();this.computedTransform=new pe(a).multiplyRight(this.transform);var o=n&&n._initialTransform?n._initialTransform.clone():new pe;this._initialTransform=new pe(o).multiplyRight(this.transform)}},{key:"_initializeBoundingVolumes",value:function(e){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(e)}},{key:"_initializeContent",value:function(e){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=Wr.UNLOADED,this.hasTilesetContent=!1,e.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}},{key:"_initializeRenderingState",value:function(e){this.depth=e.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=en.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}},{key:"_getRefine",value:function(e){return e||this.parent&&this.parent.refine||nn.REPLACE}},{key:"_isTileset",value:function(){return this.contentUrl.indexOf(".json")!==-1}},{key:"_onContentLoaded",value:function(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0;break;default:}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}},{key:"_updateBoundingVolume",value:function(e){this.boundingVolume=m_(e.boundingVolume,this.computedTransform,this.boundingVolume);var n=e.content;n&&(n.boundingVolume&&(this._contentBoundingVolume=m_(n.boundingVolume,this.computedTransform,this._contentBoundingVolume)),e.viewerRequestVolume&&(this._viewerRequestVolume=m_(e.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}},{key:"_updateTransform",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:new pe,n=e.clone().multiplyRight(this.transform),i=!n.equals(this.computedTransform);i&&(this.computedTransform=n,this._updateBoundingVolume(this.header))}},{key:"_getLoaderSpecificOptions",value:function(e){switch(e){case"i3s":return Lf(Lf({},this.tileset.options.i3s),{},{_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1});case"3d-tiles":case"cesium-ion":default:return $ee(this.tileset.tileset)}}}]),t}();var ate=h(L()),ote=h(N()),ste=h(Ee()),ute=h(Y()),lte=h(K()),__=h(q());function $Ie(t){var r=XIe();return function(){var n=(0,__.default)(t),i;if(r){var a=(0,__.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lte.default)(this,i)}}function XIe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var fte=function(t){(0,ute.default)(e,t);var r=$Ie(e);function e(){return(0,ate.default)(this,e),r.apply(this,arguments)}return(0,ote.default)(e,[{key:"compareDistanceToCamera",value:function(i,a){return a._distanceToCamera===0&&i._distanceToCamera===0?a._centerZDepth-i._centerZDepth:a._distanceToCamera-i._distanceToCamera}},{key:"updateTileVisibility",value:function(i,a){if((0,ste.default)((0,__.default)(e.prototype),"updateTileVisibility",this).call(this,i,a),!!i.isVisibleAndInRequestVolume){var o=i.children.length>0;if(i.hasTilesetContent&&o){var s=i.children[0];this.updateTileVisibility(s,a),i._visible=s._visible;return}if(this.meetsScreenSpaceErrorEarly(i,a)){i._visible=!1;return}var u=i.refine===nn.REPLACE,l=i._optimChildrenWithinParent===kee.USE_OPTIMIZATION;if(u&&l&&o&&!this.anyChildrenVisible(i,a)){i._visible=!1;return}}}},{key:"meetsScreenSpaceErrorEarly",value:function(i,a){var o=i.parent;return!o||o.hasTilesetContent||o.refine!==nn.ADD?!1:!this.shouldRefine(i,a,!0)}}]),e}($o);var _te=h(B()),bte=h(ye()),xte=h(L()),Ate=h(N()),Ste=h(be()),Tte=h(Y()),wte=h(K()),WC=h(q()),$C=h(ve());var dte=h(L()),vte=h(N());var cte=h(L()),pte=h(N());var hte=function(){function t(){(0,cte.default)(this,t),w(this,"frameNumberMap",new Map)}return(0,pte.default)(t,[{key:"register",value:function(e,n){var i=this.frameNumberMap.get(e)||new Map,a=i.get(n)||0;i.set(n,a+1),this.frameNumberMap.set(e,i)}},{key:"deregister",value:function(e,n){var i=this.frameNumberMap.get(e);if(i){var a=i.get(n)||1;i.set(n,a-1)}}},{key:"isZero",value:function(e,n){var i,a=((i=this.frameNumberMap.get(e))===null||i===void 0?void 0:i.get(n))||0;return a===0}}]),t}();var HC={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"},mte=function(){function t(){(0,dte.default)(this,t),w(this,"_statusMap",void 0),w(this,"pendingTilesRegister",new hte),this._statusMap={}}return(0,vte.default)(t,[{key:"add",value:function(e,n,i,a){var o=this;if(!this._statusMap[n]){var s=a.frameNumber,u=a.viewport.id;this._statusMap[n]={request:e,callback:i,key:n,frameState:a,status:HC.REQUESTED},this.pendingTilesRegister.register(u,s),e().then(function(l){o._statusMap[n].status=HC.COMPLETED;var f=o._statusMap[n].frameState,c=f.frameNumber,p=f.viewport.id;o.pendingTilesRegister.deregister(p,c),o._statusMap[n].callback(l,a)}).catch(function(l){o._statusMap[n].status=HC.ERROR;var f=o._statusMap[n].frameState,c=f.frameNumber,p=f.viewport.id;o.pendingTilesRegister.deregister(p,c),i(l)})}}},{key:"update",value:function(e,n){if(this._statusMap[e]){var i=this._statusMap[e].frameState,a=i.frameNumber,o=i.viewport.id;this.pendingTilesRegister.deregister(o,a);var s=n.frameNumber,u=n.viewport.id;this.pendingTilesRegister.register(u,s),this._statusMap[e].frameState=n}}},{key:"find",value:function(e){return this._statusMap[e]}},{key:"hasPendingTiles",value:function(e,n){return!this.pendingTilesRegister.isZero(e,n)}}]),t}();function gte(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function b_(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?gte(Object(e),!0).forEach(function(n){(0,_te.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):gte(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function qIe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=YIe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function YIe(t,r){if(t){if(typeof t=="string")return yte(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return yte(t,r)}}function yte(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function KIe(t){var r=ZIe();return function(){var n=(0,WC.default)(t),i;if(r){var a=(0,WC.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,wte.default)(this,i)}}function ZIe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Pte=function(t){(0,Tte.default)(e,t);var r=KIe(e);function e(n){var i;return(0,xte.default)(this,e),i=r.call(this,n),w((0,Ste.default)(i),"_tileManager",void 0),i._tileManager=new mte,i}return(0,Ate.default)(e,[{key:"traversalFinished",value:function(i){return!this._tileManager.hasPendingTiles(i.viewport.id,this._frameNumber||0)}},{key:"shouldRefine",value:function(i,a){return i._lodJudge=Wee(i,a),i._lodJudge==="DIG"}},{key:"updateChildTiles",value:function(i,a){var o=this,s=i.header.children||[],u=i.children,l=i.tileset,f=qIe(s),c;try{var p=function(){var v=c.value,m="".concat(v.id,"-").concat(a.viewport.id),g=u&&u.find(function(b){return b.id===m});if(g)g&&o.updateTile(g,a);else{var y=function(){return o._loadTile(v.id,l)},_=o._tileManager.find(m);_?o._tileManager.update(m,a):(l.tileset.nodePages&&(y=function(){return l.tileset.nodePagesTile.formTileFromNodePages(v.id)}),o._tileManager.add(y,m,function(b){return o._onTileLoad(b,i,m)},a))}};for(f.s();!(c=f.n()).done;)p()}catch(d){f.e(d)}finally{f.f()}return!1}},{key:"_loadTile",value:function(){var n=(0,bte.default)($C.default.mark(function a(o,s){var u,l,f;return $C.default.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=s.loader,l=s.getTileUrl("".concat(s.url,"/nodes/").concat(o)),f=b_(b_({},s.loadOptions),{},{i3s:b_(b_({},s.loadOptions.i3s),{},{isTileHeader:!0})}),p.next=5,Jt(l,u,f);case 5:return p.abrupt("return",p.sent);case 6:case"end":return p.stop()}},a)}));function i(a,o){return n.apply(this,arguments)}return i}()},{key:"_onTileLoad",value:function(i,a,o){var s=new Ld(a.tileset,i,a,o);a.children.push(s);var u=this._tileManager.find(s.id).frameState;this.updateTile(s,u),this._frameNumber===u.frameNumber&&(this.traversalFinished(u)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(s,u)}}]),e}($o);function Za(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=JIe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function JIe(t,r){if(t){if(typeof t=="string")return Ote(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Ote(t,r)}}function Ote(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function Ete(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Xo(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Ete(Object(e),!0).forEach(function(n){(0,Bte.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Ete(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var QIe={description:"",ellipsoid:it.WGS84,modelMatrix:new pe,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,maximumTilesSelected:0,debounceTime:0,onTileLoad:function(){},onTileUnload:function(){},onTileError:function(){},onTraversalComplete:function(r){return r},contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},x_="Tiles In Tileset(s)",XC="Tiles In Memory",Cte="Tiles In View",Mte="Tiles To Render",Ite="Tiles Loaded",qC="Tiles Loading",Rte="Tiles Unloaded",Lte="Failed Tile Loads",kte="Points/Vertices",YC="Tile Memory Use",ZC=function(){function t(r,e){(0,Fte.default)(this,t),w(this,"options",void 0),w(this,"loadOptions",void 0),w(this,"type",void 0),w(this,"tileset",void 0),w(this,"loader",void 0),w(this,"url",void 0),w(this,"basePath",void 0),w(this,"modelMatrix",void 0),w(this,"ellipsoid",void 0),w(this,"lodMetricType",void 0),w(this,"lodMetricValue",void 0),w(this,"refine",void 0),w(this,"root",null),w(this,"roots",{}),w(this,"asset",{}),w(this,"description",""),w(this,"properties",void 0),w(this,"extras",null),w(this,"attributions",{}),w(this,"credits",{}),w(this,"stats",void 0),w(this,"contentFormats",{draco:!1,meshopt:!1,dds:!1,ktx2:!1}),w(this,"cartographicCenter",null),w(this,"cartesianCenter",null),w(this,"zoom",1),w(this,"boundingVolume",null),w(this,"dynamicScreenSpaceErrorComputedDensity",0),w(this,"maximumMemoryUsage",32),w(this,"gpuMemoryUsageInBytes",0),w(this,"_frameNumber",0),w(this,"_queryParams",{}),w(this,"_extensionsUsed",[]),w(this,"_tiles",{}),w(this,"_pendingCount",0),w(this,"selectedTiles",[]),w(this,"traverseCounter",0),w(this,"geometricError",0),w(this,"lastUpdatedVieports",null),w(this,"_requestedTiles",[]),w(this,"_emptyTiles",[]),w(this,"frameStateData",{}),w(this,"_traverser",void 0),w(this,"_cache",new See),w(this,"_requestScheduler",void 0),w(this,"updatePromise",null),w(this,"tilesetInitializationPromise",void 0),this.options=Xo(Xo({},QIe),e),this.tileset=r,this.loader=r.loader,this.type=r.type,this.url=r.url,this.basePath=r.basePath||Kn.dirname(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=r.lodMetricType,this.lodMetricValue=r.lodMetricValue,this.refine=r.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new Nc({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.stats=new Rf({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(r)}return(0,Dte.default)(t,[{key:"destroy",value:function(){this._destroy()}},{key:"isLoaded",value:function(){return this._pendingCount===0&&this._frameNumber!==0&&this._requestedTiles.length===0}},{key:"tiles",get:function(){return Object.values(this._tiles)}},{key:"frameNumber",get:function(){return this._frameNumber}},{key:"queryParams",get:function(){return new URLSearchParams(this._queryParams).toString()}},{key:"setProps",value:function(e){this.options=Xo(Xo({},this.options),e)}},{key:"setOptions",value:function(e){this.options=Xo(Xo({},this.options),e)}},{key:"getTileUrl",value:function(e){var n=e.startsWith("data:");return n?e:"".concat(e).concat(e.includes("?")?"&":"?").concat(this.queryParams)}},{key:"hasExtension",value:function(e){return Boolean(this._extensionsUsed.indexOf(e)>-1)}},{key:"update",value:function(){var e=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;this.tilesetInitializationPromise.then(function(){!n&&e.lastUpdatedVieports?n=e.lastUpdatedVieports:e.lastUpdatedVieports=n,n&&e.doUpdate(n)})}},{key:"selectTiles",value:function(){var r=(0,A_.default)(_u.default.mark(function n(){var i=this,a,o=arguments;return _u.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return a=o.length>0&&o[0]!==void 0?o[0]:null,u.next=3,this.tilesetInitializationPromise;case 3:return a&&(this.lastUpdatedVieports=a),this.updatePromise||(this.updatePromise=new Promise(function(l){setTimeout(function(){i.lastUpdatedVieports&&i.doUpdate(i.lastUpdatedVieports),l(i._frameNumber),i.updatePromise=null},i.options.debounceTime)})),u.abrupt("return",this.updatePromise);case 6:case"end":return u.stop()}},n,this)}));function e(){return r.apply(this,arguments)}return e}()},{key:"doUpdate",value:function(e){if(!("loadTiles"in this.options&&!this.options.loadTiles)&&!(this.traverseCounter>0)){var n=e instanceof Array?e:[e];this._cache.reset(),this._frameNumber++,this.traverseCounter=n.length;var i=[],a=Za(n),o;try{for(a.s();!(o=a.n()).done;){var s=o.value,u=s.id;this._needTraverse(u)?i.push(u):this.traverseCounter--}}catch(v){a.e(v)}finally{a.f()}var l=Za(n),f;try{for(l.s();!(f=l.n()).done;){var c=f.value,p=c.id;if(this.roots[p]||(this.roots[p]=this._initializeTileHeaders(this.tileset,null)),!!i.includes(p)){var d=Eee(c,this._frameNumber);this._traverser.traverse(this.roots[p],d,this.options)}}}catch(v){l.e(v)}finally{l.f()}}}},{key:"_needTraverse",value:function(e){var n=e;return this.options.viewportTraversersMap&&(n=this.options.viewportTraversersMap[e]),n===e}},{key:"_onTraversalEnd",value:function(e){var n=e.viewport.id;this.frameStateData[n]||(this.frameStateData[n]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});var i=this.frameStateData[n],a=Object.values(this._traverser.selectedTiles),o=Cee(a,e,this.options.maximumTilesSelected),s=(0,KC.default)(o,2),u=s[0],l=s[1];i.selectedTiles=u;var f=Za(l),c;try{for(f.s();!(c=f.n()).done;){var p=c.value;p.unselect()}}catch(d){f.e(d)}finally{f.f()}i._requestedTiles=Object.values(this._traverser.requestedTiles),i._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}},{key:"_updateTiles",value:function(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(var e in this.frameStateData){var n=this.frameStateData[e];this.selectedTiles=this.selectedTiles.concat(n.selectedTiles),this._requestedTiles=this._requestedTiles.concat(n._requestedTiles),this._emptyTiles=this._emptyTiles.concat(n._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);var i=Za(this.selectedTiles),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;this._tiles[o.id]=o}}catch(s){i.e(s)}finally{i.f()}this._loadTiles(),this._unloadTiles(),this._updateStats()}},{key:"_tilesChanged",value:function(e,n){if(e.length!==n.length)return!0;var i=new Set(e.map(function(s){return s.id})),a=new Set(n.map(function(s){return s.id})),o=e.filter(function(s){return!a.has(s.id)}).length>0;return o=o||n.filter(function(s){return!i.has(s.id)}).length>0,o}},{key:"_loadTiles",value:function(){var e=Za(this._requestedTiles),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;i.contentUnloaded&&this._loadTile(i)}}catch(a){e.e(a)}finally{e.f()}}},{key:"_unloadTiles",value:function(){this._cache.unloadTiles(this,function(e,n){return e._unloadTile(n)})}},{key:"_updateStats",value:function(){var e=0,n=0,i=Za(this.selectedTiles),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;o.contentAvailable&&o.content&&(e++,o.content.pointCount?n+=o.content.pointCount:n+=o.content.vertexCount)}}catch(s){i.e(s)}finally{i.f()}this.stats.get(Cte).count=this.selectedTiles.length,this.stats.get(Mte).count=e,this.stats.get(kte).count=n}},{key:"_initializeTileSet",value:function(){var r=(0,A_.default)(_u.default.mark(function n(i){return _u.default.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(this.type!==Pr.I3S){o.next=5;break}return this.calculateViewPropsI3S(),o.next=4,i.root;case 4:i.root=o.sent;case 5:this.root=this._initializeTileHeaders(i,null),this.type===Pr.TILES3D&&(this._initializeTiles3DTileset(i),this.calculateViewPropsTiles3D()),this.type===Pr.I3S&&this._initializeI3STileset();case 8:case"end":return o.stop()}},n,this)}));function e(n){return r.apply(this,arguments)}return e}()},{key:"calculateViewPropsI3S",value:function(){var e,n=this.tileset.fullExtent;if(n){var i=n.xmin,a=n.xmax,o=n.ymin,s=n.ymax,u=n.zmin,l=n.zmax;this.cartographicCenter=new j(i+(a-i)/2,o+(s-o)/2,u+(l-u)/2),this.cartesianCenter=it.WGS84.cartographicToCartesian(this.cartographicCenter,new j),this.zoom=FC(n,this.cartographicCenter,this.cartesianCenter);return}var f=(e=this.tileset.store)===null||e===void 0?void 0:e.extent;if(f){var c=(0,KC.default)(f,4),p=c[0],d=c[1],v=c[2],m=c[3];this.cartographicCenter=new j(p+(v-p)/2,d+(m-d)/2,0),this.cartesianCenter=it.WGS84.cartographicToCartesian(this.cartographicCenter,new j),this.zoom=Lee(f,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new j,this.zoom=1}},{key:"calculateViewPropsTiles3D",value:function(){var e=this.root,n=e.boundingVolume.center;if(!n){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new j,this.zoom=1;return}n[0]!==0||n[1]!==0||n[2]!==0?this.cartographicCenter=it.WGS84.cartesianToCartographic(n,new j):this.cartographicCenter=new j(0,0,-it.WGS84.radii[0]),this.cartesianCenter=n,this.zoom=Ree(e.boundingVolume,this.cartographicCenter)}},{key:"_initializeStats",value:function(){this.stats.get(x_),this.stats.get(qC),this.stats.get(XC),this.stats.get(Cte),this.stats.get(Mte),this.stats.get(Ite),this.stats.get(Rte),this.stats.get(Lte),this.stats.get(kte),this.stats.get(YC,"memory")}},{key:"_initializeTileHeaders",value:function(e,n){var i=new Ld(this,e.root,n);if(n&&(n.children.push(i),i.depth=n.depth+1),this.type===Pr.TILES3D){var a=[];for(a.push(i);a.length>0;){var o=a.pop();this.stats.get(x_).incrementCount();var s=o.header.children||[],u=Za(s),l;try{for(u.s();!(l=u.n()).done;){var f=l.value,c,p=new Ld(this,f,o);if((c=p.contentUrl)!==null&&c!==void 0&&c.includes("?session=")){var d=new URL(p.contentUrl),v=d.searchParams.get("session");v&&(this._queryParams.session=v)}o.children.push(p),p.depth=o.depth+1,a.push(p)}}catch(m){u.e(m)}finally{u.f()}}}return i}},{key:"_initializeTraverser",value:function(){var e,n=this.type;switch(n){case Pr.TILES3D:e=fte;break;case Pr.I3S:e=Pte;break;default:e=$o}return new e({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}},{key:"_destroyTileHeaders",value:function(e){this._destroySubtree(e)}},{key:"_loadTile",value:function(){var r=(0,A_.default)(_u.default.mark(function n(i){var a;return _u.default.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,this._onStartTileLoading(),s.next=4,i.loadContent();case 4:a=s.sent,s.next=10;break;case 7:s.prev=7,s.t0=s.catch(0),this._onTileLoadError(i,s.t0 instanceof Error?s.t0:new Error("load failed"));case 10:return s.prev=10,this._onEndTileLoading(),this._onTileLoad(i,a),s.finish(10);case 14:case"end":return s.stop()}},n,this,[[0,7,10,14]])}));function e(n){return r.apply(this,arguments)}return e}()},{key:"_onTileLoadError",value:function(e,n){this.stats.get(Lte).incrementCount();var i=n.message||n.toString(),a=e.url;console.error("A 3D tile failed to load: ".concat(e.url," ").concat(i)),this.options.onTileError(e,i,a)}},{key:"_onTileLoad",value:function(e,n){if(n){if(this.type===Pr.I3S){var i,a,o=((i=this.tileset)===null||i===void 0||(a=i.nodePagesTile)===null||a===void 0?void 0:a.nodesInNodePages)||0;this.stats.get(x_).reset(),this.stats.get(x_).addCount(o)}e&&e.content&&Tee(e,e.content),this.updateContentTypes(e),this._addTileToCache(e),this.options.onTileLoad(e)}}},{key:"updateContentTypes",value:function(e){if(this.type===Pr.I3S)switch(e.header.isDracoGeometry&&(this.contentFormats.draco=!0),e.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0;break;default:}else if(this.type===Pr.TILES3D){var n,i=((n=e.content)===null||n===void 0?void 0:n.gltf)||{},a=i.extensionsRemoved,o=a===void 0?[]:a;o.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),o.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),o.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}},{key:"_onStartTileLoading",value:function(){this._pendingCount++,this.stats.get(qC).incrementCount()}},{key:"_onEndTileLoading",value:function(){this._pendingCount--,this.stats.get(qC).decrementCount()}},{key:"_addTileToCache",value:function(e){this._cache.add(this,e,function(n){return n._updateCacheStats(e)})}},{key:"_updateCacheStats",value:function(e){this.stats.get(Ite).incrementCount(),this.stats.get(XC).incrementCount(),this.gpuMemoryUsageInBytes+=e.gpuMemoryUsageInBytes||0,this.stats.get(YC).count=this.gpuMemoryUsageInBytes}},{key:"_unloadTile",value:function(e){this.gpuMemoryUsageInBytes-=e.gpuMemoryUsageInBytes||0,this.stats.get(XC).decrementCount(),this.stats.get(Rte).incrementCount(),this.stats.get(YC).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(e),e.unloadContent()}},{key:"_destroy",value:function(){var e=[];for(this.root&&e.push(this.root);e.length>0;){var n=e.pop(),i=Za(n.children),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;e.push(o)}}catch(s){i.e(s)}finally{i.f()}this._destroyTile(n)}this.root=null}},{key:"_destroySubtree",value:function(e){var n=e,i=[];for(i.push(n);i.length>0;){e=i.pop();var a=Za(e.children),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;i.push(s)}}catch(u){a.e(u)}finally{a.f()}e!==n&&this._destroyTile(e)}n.children=[]}},{key:"_destroyTile",value:function(e){this._cache.unloadTile(this,e),this._unloadTile(e),e.destroy()}},{key:"_initializeTiles3DTileset",value:function(e){if(e.queryString){var n=new URLSearchParams(e.queryString),i=Object.fromEntries(n.entries());this._queryParams=Xo(Xo({},this._queryParams),i)}if(this.asset=e.asset,!this.asset)throw new Error("Tileset must have an asset property.");if(this.asset.version!=="0.0"&&this.asset.version!=="1.0")throw new Error("The tileset must be 3D Tiles version 0.0 or 1.0.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=e.properties,this.geometricError=e.geometricError,this._extensionsUsed=e.extensionsUsed||[],this.extras=e.extras}},{key:"_initializeI3STileset",value:function(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}]),t}();var B_=h(ye()),Pu=h(ve());var S_="3.4.2";var vre=h(ye()),yM=h(ve());var bu={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect",GLTF:"glTF"},Lgt=Object.keys(bu);function JC(t,r,e){Ne(t instanceof ArrayBuffer);var n=new TextDecoder("utf8"),i=new Uint8Array(t,r,e),a=n.decode(i);return a}function Nte(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=new DataView(t);return"".concat(String.fromCharCode(e.getUint8(r+0))).concat(String.fromCharCode(e.getUint8(r+1))).concat(String.fromCharCode(e.getUint8(r+2))).concat(String.fromCharCode(e.getUint8(r+3)))}var ire=h(B()),P_=h(ye()),Au=h(ve());var jte=h(L()),Ute=h(N()),Ja=h(B());var ra,QC=(ra={},(0,Ja.default)(ra,5130,Float64Array),(0,Ja.default)(ra,5126,Float32Array),(0,Ja.default)(ra,5123,Uint16Array),(0,Ja.default)(ra,5125,Uint32Array),(0,Ja.default)(ra,5121,Uint8Array),(0,Ja.default)(ra,5120,Int8Array),(0,Ja.default)(ra,5122,Int16Array),(0,Ja.default)(ra,5124,Int32Array),ra),eRe={DOUBLE:5130,FLOAT:5126,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,UNSIGNED_BYTE:5121,BYTE:5120,SHORT:5122,INT:5124},eM="Failed to convert GL type",qo=function(){function t(){(0,jte.default)(this,t)}return(0,Ute.default)(t,null,[{key:"fromTypedArray",value:function(e){e=ArrayBuffer.isView(e)?e.constructor:e;for(var n in QC){var i=QC[n];if(i===e)return n}throw new Error(eM)}},{key:"fromName",value:function(e){var n=eRe[e];if(!n)throw new Error(eM);return n}},{key:"getArrayType",value:function(e){switch(e){case 33635:case 32819:case 32820:return Uint16Array;default:var n=QC[e];if(!n)throw new Error(eM);return n}}},{key:"getByteSize",value:function(e){var n=t.getArrayType(e);return n.BYTES_PER_ELEMENT}},{key:"validate",value:function(e){return Boolean(t.getArrayType(e))}},{key:"createTypedArray",value:function(e,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,a=arguments.length>3?arguments[3]:void 0;a===void 0&&(a=(n.byteLength-i)/t.getByteSize(e));var o=t.getArrayType(e);return new o(n,i,a)}}]),t}();function Gte(t,r){if(!t)throw new Error("math.gl assertion failed. ".concat(r))}function tM(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0],e=t>>11&31,n=t>>5&63,i=t&31;return r[0]=e<<3,r[1]=n<<2,r[2]=i<<3,r}var zgt=1/256;var Vgt=new ri,Hgt=new j,Wgt=new ri,$gt=new ri,Xgt=new Uint8Array(1);function zte(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:255;return We(t,0,r)/r*2-1}function Vte(t){return t<0?-1:1}function Hte(t,r,e,n){if(Gte(n),t<0||t>e||r<0||r>e)throw new Error("x and y must be unsigned normalized integers between 0 and ".concat(e));if(n.x=zte(t,e),n.y=zte(r,e),n.z=1-(Math.abs(n.x)+Math.abs(n.y)),n.z<0){var i=n.x;n.x=(1-Math.abs(n.y))*Vte(i),n.y=(1-Math.abs(i))*Vte(n.y)}return n.normalize()}function rM(t,r,e){return Hte(t,r,255,e)}var Wte=h(L()),$te=h(N());var kf=function(){function t(r,e){(0,Wte.default)(this,t),w(this,"json",void 0),w(this,"buffer",void 0),w(this,"featuresLength",0),w(this,"_cachedTypedArrays",{}),this.json=r,this.buffer=e}return(0,$te.default)(t,[{key:"getExtension",value:function(e){return this.json.extensions&&this.json.extensions[e]}},{key:"hasProperty",value:function(e){return Boolean(this.json[e])}},{key:"getGlobalProperty",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5125,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,a=this.json[e];return a&&Number.isFinite(a.byteOffset)?this._getTypedArrayFromBinary(e,n,i,1,a.byteOffset):a}},{key:"getPropertyArray",value:function(e,n,i){var a=this.json[e];return a&&Number.isFinite(a.byteOffset)?("componentType"in a&&(n=qo.fromName(a.componentType)),this._getTypedArrayFromBinary(e,n,i,this.featuresLength,a.byteOffset)):this._getTypedArrayFromArray(e,n,a)}},{key:"getProperty",value:function(e,n,i,a,o){var s=this.json[e];if(!s)return s;var u=this.getPropertyArray(e,n,i);if(i===1)return u[a];for(var l=0;l<i;++l)o[l]=u[i*a+l];return o}},{key:"_getTypedArrayFromBinary",value:function(e,n,i,a,o){var s=this._cachedTypedArrays,u=s[e];return u||(u=qo.createTypedArray(n,this.buffer.buffer,this.buffer.byteOffset+o,a*i),s[e]=u),u}},{key:"_getTypedArrayFromArray",value:function(e,n,i){var a=this._cachedTypedArrays,o=a[e];return o||(o=qo.createTypedArray(n,i),a[e]=o),o}}]),t}();var Kte=h(Zt()),Zte=h(L()),Jte=h(N());var tRe={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},rRe={SCALAR:function(r,e){return r[e]},VEC2:function(r,e){return[r[2*e+0],r[2*e+1]]},VEC3:function(r,e){return[r[3*e+0],r[3*e+1],r[3*e+2]]},VEC4:function(r,e){return[r[4*e+0],r[4*e+1],r[4*e+2],r[4*e+3]]},MAT2:function(r,e){return[r[4*e+0],r[4*e+1],r[4*e+2],r[4*e+3]]},MAT3:function(r,e){return[r[9*e+0],r[9*e+1],r[9*e+2],r[9*e+3],r[9*e+4],r[9*e+5],r[9*e+6],r[9*e+7],r[9*e+8]]},MAT4:function(r,e){return[r[16*e+0],r[16*e+1],r[16*e+2],r[16*e+3],r[16*e+4],r[16*e+5],r[16*e+6],r[16*e+7],r[16*e+8],r[16*e+9],r[16*e+10],r[16*e+11],r[16*e+12],r[16*e+13],r[16*e+14],r[16*e+15]]}},nRe={SCALAR:function(r,e,n){e[n]=r},VEC2:function(r,e,n){e[2*n+0]=r[0],e[2*n+1]=r[1]},VEC3:function(r,e,n){e[3*n+0]=r[0],e[3*n+1]=r[1],e[3*n+2]=r[2]},VEC4:function(r,e,n){e[4*n+0]=r[0],e[4*n+1]=r[1],e[4*n+2]=r[2],e[4*n+3]=r[3]},MAT2:function(r,e,n){e[4*n+0]=r[0],e[4*n+1]=r[1],e[4*n+2]=r[2],e[4*n+3]=r[3]},MAT3:function(r,e,n){e[9*n+0]=r[0],e[9*n+1]=r[1],e[9*n+2]=r[2],e[9*n+3]=r[3],e[9*n+4]=r[4],e[9*n+5]=r[5],e[9*n+6]=r[6],e[9*n+7]=r[7],e[9*n+8]=r[8],e[9*n+9]=r[9]},MAT4:function(r,e,n){e[16*n+0]=r[0],e[16*n+1]=r[1],e[16*n+2]=r[2],e[16*n+3]=r[3],e[16*n+4]=r[4],e[16*n+5]=r[5],e[16*n+6]=r[6],e[16*n+7]=r[7],e[16*n+8]=r[8],e[16*n+9]=r[9],e[16*n+10]=r[10],e[16*n+11]=r[11],e[16*n+12]=r[12],e[16*n+13]=r[13],e[16*n+14]=r[14],e[16*n+15]=r[15]}};function Xte(t,r,e,n){var i=t.componentType;Ne(t.componentType);var a=typeof i=="string"?qo.fromName(i):i,o=tRe[t.type],s=rRe[t.type],u=nRe[t.type];e+=t.byteOffset;var l=qo.createTypedArray(a,r,e,o*n);return{values:l,type:a,size:o,unpacker:s,packer:u}}var na=function(r){return r!==void 0};function qte(t,r,e){if(!r)return null;var n=t.getExtension("3DTILES_batch_table_hierarchy"),i=r.HIERARCHY;return i&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),r.extensions=r.extensions||{},r.extensions["3DTILES_batch_table_hierarchy"]=i,n=i),n?iRe(n,e):null}function iRe(t,r){var e,n,i,a=t.instancesLength,o=t.classes,s=t.classIds,u=t.parentCounts,l=t.parentIds,f=a;na(s.byteOffset)&&(s.componentType=defaultValue(s.componentType,5123),s.type=AttributeType.SCALAR,i=getBinaryAccessor(s),s=i.createArrayBufferView(r.buffer,r.byteOffset+s.byteOffset,a));var c;if(na(u))for(na(u.byteOffset)&&(u.componentType=defaultValue(u.componentType,5123),u.type=AttributeType.SCALAR,i=getBinaryAccessor(u),u=i.createArrayBufferView(r.buffer,r.byteOffset+u.byteOffset,a)),c=new Uint16Array(a),f=0,e=0;e<a;++e)c[e]=f,f+=u[e];na(l)&&na(l.byteOffset)&&(l.componentType=defaultValue(l.componentType,5123),l.type=AttributeType.SCALAR,i=getBinaryAccessor(l),l=i.createArrayBufferView(r.buffer,r.byteOffset+l.byteOffset,f));var p=o.length;for(e=0;e<p;++e){var d=o[e].length,v=o[e].instances,m=getBinaryProperties(d,v,r);o[e].instances=combine(m,v)}var g=new Array(p).fill(0),y=new Uint16Array(a);for(e=0;e<a;++e)n=s[e],y[e]=g[n],++g[n];var _={classes:o,classIds:s,classIndexes:y,parentCounts:u,parentIndexes:c,parentIds:l};return sRe(_),_}function Bf(t,r,e){if(t){var n=t.parentCounts,i=t.parentIds;return i?e(t,r):n>0?aRe(t,r,e):oRe(t,r,e)}}function aRe(t,r,e){var n=t.classIds,i=t.parentCounts,a=t.parentIds,o=t.parentIndexes,s=n.length,u=scratchVisited;u.length=Math.max(u.length,s);var l=++marker,f=scratchStack;for(f.length=0,f.push(r);f.length>0;)if(r=f.pop(),u[r]!==l){u[r]=l;var c=e(t,r);if(na(c))return c;for(var p=i[r],d=o[r],v=0;v<p;++v){var m=a[d+v];m!==r&&f.push(m)}}return null}function oRe(t,r,e){for(var n=!0;n;){var i=e(t,r);if(na(i))return i;var a=t.parentIds[r];n=a!==r,r=a}throw new Error("traverseHierarchySingleParent")}function sRe(t){for(var r=[],e=t.classIds,n=e.length,i=0;i<n;++i)Yte(t,i,stack)}function Yte(t,r,e){var n=t.parentCounts,i=t.parentIds,a=t.parentIndexes,o=t.classIds,s=o.length;if(na(i)){assert(r<s,"Parent index ".concat(r," exceeds the total number of instances: ").concat(s)),assert(e.indexOf(r)===-1,"Circular dependency detected in the batch table hierarchy."),e.push(r);for(var u=na(n)?n[r]:1,l=na(n)?a[r]:r,f=0;f<u;++f){var c=i[l+f];c!==r&&Yte(t,c,e)}e.pop(r)}}function an(t){return t!=null}var T_=function(r,e){return r},uRe={HIERARCHY:!0,extensions:!0,extras:!0},w_=function(){function t(r,e,n){(0,Zte.default)(this,t);var i,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};w(this,"json",void 0),w(this,"binary",void 0),w(this,"featureCount",void 0),w(this,"_extensions",void 0),w(this,"_properties",void 0),w(this,"_binaryProperties",void 0),w(this,"_hierarchy",void 0),Ne(n>=0),this.json=r||{},this.binary=e,this.featureCount=n,this._extensions=((i=this.json)===null||i===void 0?void 0:i.extensions)||{},this._properties={};for(var o in this.json)uRe[o]||(this._properties[o]=this.json[o]);this._binaryProperties=this._initializeBinaryProperties(),a["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=qte(this,this.json,this.binary))}return(0,Jte.default)(t,[{key:"getExtension",value:function(e){return this.json&&this.json.extensions&&this.json.extensions[e]}},{key:"memorySizeInBytes",value:function(){return 0}},{key:"isClass",value:function(e,n){if(this._checkBatchId(e),Ne(typeof n=="string",n),this._hierarchy){var i=Bf(this._hierarchy,e,function(a,o){var s=a.classIds[o],u=a.classes[s];return u.name===n});return an(i)}return!1}},{key:"isExactClass",value:function(e,n){return Ne(typeof n=="string",n),this.getExactClassName(e)===n}},{key:"getExactClassName",value:function(e){if(this._checkBatchId(e),this._hierarchy){var n=this._hierarchy.classIds[e],i=this._hierarchy.classes[n];return i.name}}},{key:"hasProperty",value:function(e,n){return this._checkBatchId(e),Ne(typeof n=="string",n),an(this._properties[n])||this._hasPropertyInHierarchy(e,n)}},{key:"getPropertyNames",value:function(e,n){var i;this._checkBatchId(e),n=an(n)?n:[],n.length=0;var a=Object.keys(this._properties);return(i=n).push.apply(i,(0,Kte.default)(a)),this._hierarchy&&this._getPropertyNamesInHierarchy(e,n),n}},{key:"getProperty",value:function(e,n){if(this._checkBatchId(e),Ne(typeof n=="string",n),this._binaryProperties){var i=this._binaryProperties[n];if(an(i))return this._getBinaryProperty(i,e)}var a=this._properties[n];if(an(a))return T_(a[e],!0);if(this._hierarchy){var o=this._getHierarchyProperty(e,n);if(an(o))return o}}},{key:"setProperty",value:function(e,n,i){var a=this.featureCount;if(this._checkBatchId(e),Ne(typeof n=="string",n),this._binaryProperties){var o=this._binaryProperties[n];if(o){this._setBinaryProperty(o,e,i);return}}if(!(this._hierarchy&&this._setHierarchyProperty(this,e,n,i))){var s=this._properties[n];an(s)||(this._properties[n]=new Array(a),s=this._properties[n]),s[e]=T_(i,!0)}}},{key:"_checkBatchId",value:function(e){var n=e>=0&&e<this.featureCount;if(!n)throw new Error("batchId not in range [0, featureCount - 1].")}},{key:"_getBinaryProperty",value:function(e,n){return e.unpack(e.typedArray,n)}},{key:"_setBinaryProperty",value:function(e,n,i){e.pack(i,e.typedArray,n)}},{key:"_initializeBinaryProperties",value:function(){var e=null;for(var n in this._properties){var i=this._properties[n],a=this._initializeBinaryProperty(n,i);a&&(e=e||{},e[n]=a)}return e}},{key:"_initializeBinaryProperty",value:function(e,n){if("byteOffset"in n){var i=n;Ne(this.binary,"Property ".concat(e," requires a batch table binary.")),Ne(i.type,"Property ".concat(e," requires a type."));var a=Xte(i,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:a.values,componentCount:a.size,unpack:a.unpacker,pack:a.packer}}return null}},{key:"_hasPropertyInHierarchy",value:function(e,n){if(!this._hierarchy)return!1;var i=Bf(this._hierarchy,e,function(a,o){var s=a.classIds[o],u=a.classes[s].instances;return an(u[n])});return an(i)}},{key:"_getPropertyNamesInHierarchy",value:function(e,n){Bf(this._hierarchy,e,function(i,a){var o=i.classIds[a],s=i.classes[o].instances;for(var u in s)s.hasOwnProperty(u)&&n.indexOf(u)===-1&&n.push(u)})}},{key:"_getHierarchyProperty",value:function(e,n){var i=this;return Bf(this._hierarchy,e,function(a,o){var s=a.classIds[o],u=a.classes[s],l=a.classIndexes[o],f=u.instances[n];return an(f)?an(f.typedArray)?i._getBinaryProperty(f,l):T_(f[l],!0):null})}},{key:"_setHierarchyProperty",value:function(e,n,i,a){var o=this,s=Bf(this._hierarchy,n,function(u,l){var f=u.classIds[l],c=u.classes[f],p=u.classIndexes[l],d=c.instances[i];return an(d)?(Ne(l===n,'Inherited property "'.concat(i,'" is read-only.')),an(d.typedArray)?o._setBinaryProperty(d,p,a):d[p]=T_(a,!0),!0):!1});return an(s)}}]),t}();var nM=4;function Yo(t,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=new DataView(r);if(t.magic=n.getUint32(e,!0),e+=nM,t.version=n.getUint32(e,!0),e+=nM,t.byteLength=n.getUint32(e,!0),e+=nM,t.version!==1)throw new Error("3D Tile Version ".concat(t.version," not supported"));return e}var Ff=4,Qte="b3dm tile in legacy format.";function Df(t,r,e){var n=new DataView(r),i;t.header=t.header||{};var a=n.getUint32(e,!0);e+=Ff;var o=n.getUint32(e,!0);e+=Ff;var s=n.getUint32(e,!0);e+=Ff;var u=n.getUint32(e,!0);return e+=Ff,s>=570425344?(e-=Ff*2,i=a,s=o,u=0,a=0,o=0,console.warn(Qte)):u>=570425344&&(e-=Ff,i=s,s=a,u=o,a=0,o=0,console.warn(Qte)),t.header.featureTableJsonByteLength=a,t.header.featureTableBinaryByteLength=o,t.header.batchTableJsonByteLength=s,t.header.batchTableBinaryByteLength=u,t.header.batchLength=i,e}function Nf(t,r,e,n){return e=lRe(t,r,e,n),e=fRe(t,r,e,n),e}function lRe(t,r,e,n){var i=t.header,a=i.featureTableJsonByteLength,o=i.featureTableBinaryByteLength,s=i.batchLength;if(t.featureTableJson={BATCH_LENGTH:s||0},a>0){var u=JC(r,e,a);t.featureTableJson=JSON.parse(u)}return e+=a,t.featureTableBinary=new Uint8Array(r,e,o),e+=o,e}function fRe(t,r,e,n){var i=t.header,a=i.batchTableJsonByteLength,o=i.batchTableBinaryByteLength;if(a>0){var s=JC(r,e,a);t.batchTableJson=JSON.parse(s),e+=a,o>0&&(t.batchTableBinary=new Uint8Array(r,e,o),t.batchTableBinary=new Uint8Array(t.batchTableBinary),e+=o)}return e}function iM(t,r,e){if(!r&&(!t||!t.batchIds||!e))return null;var n=t.batchIds,i=t.isRGB565,a=t.pointCount;if(n&&e){for(var o=new Uint8ClampedArray(a*3),s=0;s<a;s++){var u=n[s],l=e.getProperty(u,"dimensions"),f=l.map(function(v){return v*255});o[s*3]=f[0],o[s*3+1]=f[1],o[s*3+2]=f[2]}return{type:5121,value:o,size:3,normalized:!0}}if(i){for(var c=new Uint8ClampedArray(a*3),p=0;p<a;p++){var d=tM(r[p]);c[p*3]=d[0],c[p*3+1]=d[1],c[p*3+2]=d[2]}return{type:5121,value:c,size:3,normalized:!0}}return r&&r.length===a*3?{type:5121,value:r,size:3,normalized:!0}:{type:5121,value:r,size:4,normalized:!0}}var ere=new j;function tre(t,r){if(!r)return null;if(t.isOctEncoded16P){for(var e=new Float32Array(t.pointsLength*3),n=0;n<t.pointsLength;n++)rM(r[n*2],r[n*2+1],ere),ere.toArray(e,n*3);return{type:5126,size:2,value:e}}return{type:5126,size:2,value:r}}function rre(t,r,e){return t.isQuantized?e["3d-tiles"]&&e["3d-tiles"].decodeQuantizedPositions?(t.isQuantized=!1,cRe(t,r)):{type:5123,value:r,size:3,normalized:!0}:r}function cRe(t,r){for(var e=new j,n=new Float32Array(t.pointCount*3),i=0;i<t.pointCount;i++)e.set(r[i*3],r[i*3+1],r[i*3+2]).scale(1/t.quantizedRange).multiply(t.quantizedVolumeScale).add(t.quantizedVolumeOffset).toArray(n,i*3);return n}function nre(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function xu(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?nre(Object(e),!0).forEach(function(n){(0,ire.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):nre(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function are(t,r,e,n,i){return aM.apply(this,arguments)}function aM(){return aM=(0,P_.default)(Au.default.mark(function t(r,e,n,i,a){var o,s,u;return Au.default.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return n=Yo(r,e,n),n=Df(r,e,n),n=Nf(r,e,n,i),pRe(r),o=hRe(r),s=o.featureTable,u=o.batchTable,f.next=7,yRe(r,s,u,i,a);case 7:return dRe(r,s,i),vRe(r,s,u),mRe(r,s),f.abrupt("return",n);case 11:case"end":return f.stop()}},t)})),aM.apply(this,arguments)}function pRe(t){t.attributes={positions:null,colors:null,normals:null,batchIds:null},t.isQuantized=!1,t.isTranslucent=!1,t.isRGB565=!1,t.isOctEncoded16P=!1}function hRe(t){var r=new kf(t.featureTableJson,t.featureTableBinary),e=r.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(e))throw new Error("POINTS_LENGTH must be defined");r.featuresLength=e,t.featuresLength=e,t.pointsLength=e,t.pointCount=e,t.rtcCenter=r.getGlobalProperty("RTC_CENTER",5126,3);var n=gRe(t,r);return{featureTable:r,batchTable:n}}function dRe(t,r,e){if(!t.attributes.positions){if(r.hasProperty("POSITION"))t.attributes.positions=r.getPropertyArray("POSITION",5126,3);else if(r.hasProperty("POSITION_QUANTIZED")){var n=r.getPropertyArray("POSITION_QUANTIZED",5123,3);if(t.isQuantized=!0,t.quantizedRange=(1<<16)-1,t.quantizedVolumeScale=r.getGlobalProperty("QUANTIZED_VOLUME_SCALE",5126,3),!t.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(t.quantizedVolumeOffset=r.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",5126,3),!t.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");t.attributes.positions=rre(t,n,e)}}if(!t.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function vRe(t,r,e){if(!t.attributes.colors){var n=null;r.hasProperty("RGBA")?(n=r.getPropertyArray("RGBA",5121,4),t.isTranslucent=!0):r.hasProperty("RGB")?n=r.getPropertyArray("RGB",5121,3):r.hasProperty("RGB565")&&(n=r.getPropertyArray("RGB565",5123,1),t.isRGB565=!0),t.attributes.colors=iM(t,n,e)}r.hasProperty("CONSTANT_RGBA")&&(t.constantRGBA=r.getGlobalProperty("CONSTANT_RGBA",5121,4))}function mRe(t,r){if(!t.attributes.normals){var e=null;r.hasProperty("NORMAL")?e=r.getPropertyArray("NORMAL",5126,3):r.hasProperty("NORMAL_OCT16P")&&(e=r.getPropertyArray("NORMAL_OCT16P",5121,2),t.isOctEncoded16P=!0),t.attributes.normals=tre(t,e)}}function gRe(t,r){var e=null;if(!t.batchIds&&r.hasProperty("BATCH_ID")&&(t.batchIds=r.getPropertyArray("BATCH_ID",5123,1),t.batchIds)){var n=r.getGlobalProperty("BATCH_LENGTH");if(!n)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");var i=t.batchTableJson,a=t.batchTableBinary;e=new w_(i,a,n)}return e}function yRe(t,r,e,n,i){return oM.apply(this,arguments)}function oM(){return oM=(0,P_.default)(Au.default.mark(function t(r,e,n,i,a){var o,s,u,l,f,c,p,d;return Au.default.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(l=r.batchTableJson&&r.batchTableJson.extensions&&r.batchTableJson.extensions["3DTILES_draco_point_compression"],l&&(u=l.properties),f=e.getExtension("3DTILES_draco_point_compression"),!f){m.next=15;break}if(s=f.properties,c=f.byteOffset,p=f.byteLength,!(!s||!Number.isFinite(c)||!p)){m.next=9;break}throw new Error("Draco properties, byteOffset, and byteLength must be defined");case 9:o=r.featureTableBinary.slice(c,c+p),r.hasPositions=Number.isFinite(s.POSITION),r.hasColors=Number.isFinite(s.RGB)||Number.isFinite(s.RGBA),r.hasNormals=Number.isFinite(s.NORMAL),r.hasBatchIds=Number.isFinite(s.BATCH_ID),r.isTranslucent=Number.isFinite(s.RGBA);case 15:if(o){m.next=17;break}return m.abrupt("return",!0);case 17:return d={buffer:o,properties:xu(xu({},s),u),featureTableProperties:s,batchTableProperties:u,dequantizeInShader:!1},m.next=20,_Re(r,d,i,a);case 20:return m.abrupt("return",m.sent);case 21:case"end":return m.stop()}},t)})),oM.apply(this,arguments)}function _Re(t,r,e,n){return sM.apply(this,arguments)}function sM(){return sM=(0,P_.default)(Au.default.mark(function t(r,e,n,i){var a,o,s,u,l,f,c,p,d,v,m,g,y,_,b;return Au.default.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return a=i.parse,o=xu(xu({},n),{},{draco:xu(xu({},n.draco),{},{extraAttributes:e.batchTableProperties||{}})}),delete o["3d-tiles"],A.next=5,a(e.buffer,n_,o);case 5:if(s=A.sent,u=s.attributes.POSITION&&s.attributes.POSITION.value,l=s.attributes.COLOR_0&&s.attributes.COLOR_0.value,f=s.attributes.NORMAL&&s.attributes.NORMAL.value,c=s.attributes.BATCH_ID&&s.attributes.BATCH_ID.value,p=u&&s.attributes.POSITION.value.quantization,d=f&&s.attributes.NORMAL.value.quantization,p&&(v=s.POSITION.data.quantization,m=v.range,r.quantizedVolumeScale=new j(m,m,m),r.quantizedVolumeOffset=new j(v.minValues),r.quantizedRange=(1<<v.quantizationBits)-1,r.isQuantizedDraco=!0),d&&(r.octEncodedRange=(1<<s.NORMAL.data.quantization.quantizationBits)-1,r.isOctEncodedDraco=!0),g={},e.batchTableProperties)for(y=0,_=Object.keys(e.batchTableProperties);y<_.length;y++)b=_[y],s.attributes[b]&&s.attributes[b].value&&(g[b.toLowerCase()]=s.attributes[b].value);r.attributes=xu({positions:u,colors:iM(r,l,void 0),normals:f,batchIds:c},g);case 17:case"end":return A.stop()}},t)})),sM.apply(this,arguments)}var sre=h(ye()),fM=h(ve());var ore=h(ye()),uM=h(ve());var O_={URI:0,EMBEDDED:1};function E_(t,r,e,n){t.rotateYtoZ=!0;var i=t.byteOffset+t.byteLength-e;if(i===0)throw new Error("glTF byte length must be greater than 0.");return t.gltfUpAxis=n["3d-tiles"]&&n["3d-tiles"].assetGltfUpAxis?n["3d-tiles"].assetGltfUpAxis:"Y",t.gltfArrayBuffer=ss(r,e,i),t.gltfByteOffset=0,t.gltfByteLength=i,e%4===0||console.warn("".concat(t.type,": embedded glb is not aligned to a 4-byte boundary.")),t.byteOffset+t.byteLength}function C_(t,r,e,n){return lM.apply(this,arguments)}function lM(){return lM=(0,ore.default)(uM.default.mark(function t(r,e,n,i){var a,o,s;return uM.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(a=n["3d-tiles"]||{},bRe(r,e,n),!a.loadGLTF){l.next=17;break}if(o=i.parse,s=i.fetch,!r.gltfUrl){l.next=9;break}return l.next=7,s(r.gltfUrl,n);case 7:r.gltfArrayBuffer=l.sent,r.gltfByteOffset=0;case 9:if(!r.gltfArrayBuffer){l.next=17;break}return l.next=12,o(r.gltfArrayBuffer,Wa,n,i);case 12:r.gltf=l.sent,r.gpuMemoryUsageInBytes=yd(r.gltf),delete r.gltfArrayBuffer,delete r.gltfByteOffset,delete r.gltfByteLength;case 17:case"end":return l.stop()}},t)})),lM.apply(this,arguments)}function bRe(t,r,e){switch(r){case O_.URI:var n=new Uint8Array(t.gltfArrayBuffer,t.gltfByteOffset),i=new TextDecoder,a=i.decode(n);t.gltfUrl=a.replace(/[\s\0]+$/,""),delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength;break;case O_.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}function ure(t,r,e,n,i){return cM.apply(this,arguments)}function cM(){return cM=(0,sre.default)(fM.default.mark(function t(r,e,n,i,a){var o,s;return fM.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return n=xRe(r,e,n,i,a),l.next=3,C_(r,O_.EMBEDDED,i,a);case 3:return s=r==null||(o=r.gltf)===null||o===void 0?void 0:o.extensions,s&&s.CESIUM_RTC&&(r.rtcCenter=s.CESIUM_RTC.center),l.abrupt("return",n);case 6:case"end":return l.stop()}},t)})),cM.apply(this,arguments)}function xRe(t,r,e,n,i){e=Yo(t,r,e),e=Df(t,r,e),e=Nf(t,r,e,n),e=E_(t,r,e,n);var a=new kf(t.featureTableJson,t.featureTableBinary);return t.rtcCenter=a.getGlobalProperty("RTC_CENTER",5126,3),e}var lre=h(ye()),pM=h(ve());function fre(t,r,e,n,i){return hM.apply(this,arguments)}function hM(){return hM=(0,lre.default)(pM.default.mark(function t(r,e,n,i,a){return pM.default.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return n=ARe(r,e,n,i,a),s.next=3,C_(r,r.gltfFormat,i,a);case 3:return s.abrupt("return",n);case 4:case"end":return s.stop()}},t)})),hM.apply(this,arguments)}function ARe(t,r,e,n,i){if(e=Yo(t,r,e),t.version!==1)throw new Error("Instanced 3D Model version ".concat(t.version," is not supported"));e=Df(t,r,e);var a=new DataView(r);if(t.gltfFormat=a.getUint32(e,!0),e+=4,e=Nf(t,r,e,n),e=E_(t,r,e,n),t.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");var o=new kf(t.featureTableJson,t.featureTableBinary),s=o.getGlobalProperty("INSTANCES_LENGTH");if(o.featuresLength=s,!Number.isFinite(s))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");t.eastNorthUp=o.getGlobalProperty("EAST_NORTH_UP"),t.rtcCenter=o.getGlobalProperty("RTC_CENTER",5126,3);var u=new w_(t.batchTableJson,t.batchTableBinary,s);return SRe(t,o,u,s),e}function SRe(t,r,e,n){for(var i={instances:new Array(n),batchTable:t._batchTable,cull:!1,url:void 0,gltf:void 0,basePath:void 0,incrementallyLoadTextures:!1,forwardAxis:[1,0,0]},a=i.instances,o=new j,s=new j,u=new j,l=new j,f=new ct,c=new Bi,p=new j,d={},v=new pe,m=[],g=[],y=new j,_=new j,b=0;b<n;b++){var x=void 0;if(r.hasProperty("POSITION"))x=r.getProperty("POSITION",5126,3,b,o);else if(r.hasProperty("POSITION_QUANTIZED")){x=r.getProperty("POSITION_QUANTIZED",5123,3,b,o);var A=r.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",5126,3,y);if(!A)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");var S=r.getGlobalProperty("QUANTIZED_VOLUME_SCALE",5126,3,_);if(!S)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");for(var P=65535,O=0;O<3;O++)x[O]=x[O]/P*S[O]+A[O]}if(!x)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");o.copy(x),d.translation=o,t.normalUp=r.getProperty("NORMAL_UP",5126,3,b,m),t.normalRight=r.getProperty("NORMAL_RIGHT",5126,3,b,g);var C=!1;if(t.normalUp){if(!t.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");t.hasCustomOrientation=!0}else{if(t.octNormalUp=r.getProperty("NORMAL_UP_OCT32P",5123,2,m),t.octNormalRight=r.getProperty("NORMAL_RIGHT_OCT32P",5123,2,g),t.octNormalUp)throw t.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");t.eastNorthUp?(it.WGS84.eastNorthUpToFixedFrame(o,v),v.getRotationMatrix3(f)):f.identity()}C&&(l.copy(s).cross(u).normalize(),f.setColumn(0,s),f.setColumn(1,u),f.setColumn(2,l)),c.fromMatrix3(f),d.rotation=c,p.set(1,1,1);var T=r.getProperty("SCALE",5126,1,b);Number.isFinite(T)&&p.multiplyByScalar(T);var I=r.getProperty("SCALE_NON_UNIFORM",5126,3,b,m);I&&p.scale(I),d.scale=p;var R=r.getProperty("BATCH_ID",5123,1,b);R===void 0&&(R=b);var V=new pe().fromQuaternion(d.rotation);v.identity(),v.translate(d.translation),v.multiplyRight(V),v.scale(d.scale);var z=v.clone();a[b]={modelMatrix:z,batchId:R}}t.instances=a}var cre=h(ye()),dM=h(ve());function pre(t,r,e,n,i,a){return vM.apply(this,arguments)}function vM(){return vM=(0,cre.default)(dM.default.mark(function t(r,e,n,i,a,o){var s,u;return dM.default.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:n=Yo(r,e,n),s=new DataView(e),r.tilesLength=s.getUint32(n,!0),n+=4,r.tiles=[];case 5:if(!(r.tiles.length<r.tilesLength&&r.byteLength-n>12)){f.next=13;break}return u={},r.tiles.push(u),f.next=10,o(e,n,i,a,u);case 10:n=f.sent,f.next=5;break;case 13:return f.abrupt("return",n);case 14:case"end":return f.stop()}},t)})),vM.apply(this,arguments)}var hre=h(ye()),mM=h(ve());function dre(t,r,e,n){return gM.apply(this,arguments)}function gM(){return gM=(0,hre.default)(mM.default.mark(function t(r,e,n,i){var a;return mM.default.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return r.rotateYtoZ=!0,r.gltfUpAxis=n["3d-tiles"]&&n["3d-tiles"].assetGltfUpAxis?n["3d-tiles"].assetGltfUpAxis:"Y",a=i.parse,s.next=5,a(e,Wa,n,i);case 5:r.gltf=s.sent,r.gpuMemoryUsageInBytes=yd(r.gltf);case 7:case"end":return s.stop()}},t)})),gM.apply(this,arguments)}function bM(t){return _M.apply(this,arguments)}function _M(){return _M=(0,vre.default)(yM.default.mark(function t(r){var e,n,i,a,o=arguments;return yM.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:e=o.length>1&&o[1]!==void 0?o[1]:0,n=o.length>2?o[2]:void 0,i=o.length>3?o[3]:void 0,a=o.length>4&&o[4]!==void 0?o[4]:{},a.byteOffset=e,a.type=Nte(r,e),u.t0=a.type,u.next=u.t0===bu.COMPOSITE?9:u.t0===bu.BATCHED_3D_MODEL?12:u.t0===bu.GLTF?15:u.t0===bu.INSTANCED_3D_MODEL?18:u.t0===bu.POINT_CLOUD?21:24;break;case 9:return u.next=11,pre(a,r,e,n,i,bM);case 11:return u.abrupt("return",u.sent);case 12:return u.next=14,ure(a,r,e,n,i);case 14:return u.abrupt("return",u.sent);case 15:return u.next=17,dre(a,r,n,i);case 17:return u.abrupt("return",u.sent);case 18:return u.next=20,fre(a,r,e,n,i);case 20:return u.abrupt("return",u.sent);case 21:return u.next=23,are(a,r,e,n,i);case 23:return u.abrupt("return",u.sent);case 24:throw new Error("3DTileLoader: unknown type ".concat(a.type));case 25:case"end":return u.stop()}},t)})),_M.apply(this,arguments)}var k_=h(ye()),wu=h(ve());var TM=h(ye()),kd=h(ve()),TRe=1952609651,wRe=1;function wM(t,r,e){return AM.apply(this,arguments)}function AM(){return AM=(0,TM.default)(kd.default.mark(function t(r,e,n){var i,a,o,s,u,l,f,c,p;return kd.default.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(i=new Uint32Array(r.slice(0,4)),i[0]===TRe){v.next=3;break}throw new Error("Wrong subtree file magic number");case 3:if(a=new Uint32Array(r.slice(4,8)),a[0]===wRe){v.next=6;break}throw new Error("Wrong subtree file verson, must be 1");case 6:if(o=mre(r.slice(8,16)),s=new Uint8Array(r,24,o),u=new TextDecoder("utf8"),l=u.decode(s),f=JSON.parse(l),c=mre(r.slice(16,24)),p=new ArrayBuffer(0),c&&(p=r.slice(24+o)),!("bufferView"in f.tileAvailability)){v.next=18;break}return v.next=17,xM(f,"tileAvailability",p,n);case 17:f.tileAvailability.explicitBitstream=v.sent;case 18:if(!("bufferView"in f.contentAvailability)){v.next=22;break}return v.next=21,xM(f,"contentAvailability",p,n);case 21:f.contentAvailability.explicitBitstream=v.sent;case 22:if(!("bufferView"in f.childSubtreeAvailability)){v.next=26;break}return v.next=25,xM(f,"childSubtreeAvailability",p,n);case 25:f.childSubtreeAvailability.explicitBitstream=v.sent;case 26:return v.abrupt("return",f);case 27:case"end":return v.stop()}},t)})),AM.apply(this,arguments)}function PRe(t,r){var e=r.startsWith("http");if(e){var n=new URL(t,r);return decodeURI(n.toString())}var i="http://".concat(r),a=new URL(t,i);return"/".concat(a.host).concat(a.pathname)}function xM(t,r,e,n){return SM.apply(this,arguments)}function SM(){return SM=(0,TM.default)(kd.default.mark(function t(r,e,n,i){var a,o,s,u,l,f;return kd.default.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(a=r[e].bufferView,o=r.bufferViews[a],s=r.buffers[o.buffer],!(!(i!=null&&i.url)||!i.fetch)){p.next=5;break}throw new Error("Url is not provided");case 5:if(i.fetch){p.next=7;break}throw new Error("fetch is not provided");case 7:if(!s.uri){p.next=16;break}return u=PRe(s.uri,i?.url),p.next=11,i.fetch(u);case 11:return l=p.sent,p.next=14,l.arrayBuffer();case 14:return f=p.sent,p.abrupt("return",new Uint8Array(f,o.byteOffset,o.byteLength));case 16:return p.abrupt("return",new Uint8Array(n,o.byteOffset,o.byteLength));case 17:case"end":return p.stop()}},t)})),SM.apply(this,arguments)}function mre(t){var r=new DataView(t),e=r.getUint32(0,!0),n=r.getUint32(4,!0);return e+Math.pow(2,32)*n}var M_={id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:S_,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:wM,options:{}};var Bre=h(me()),Fre=h(ye()),Dre=h(B()),UM=h(ve());var Un=null;try{Un=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function At(t,r,e){this.low=t|0,this.high=r|0,this.unsigned=!!e}At.prototype.__isLong__;Object.defineProperty(At.prototype,"__isLong__",{value:!0});function Er(t){return(t&&t.__isLong__)===!0}function gre(t){var r=Math.clz32(t&-t);return t?31-r:r}At.isLong=Er;var yre={},_re={};function Su(t,r){var e,n,i;return r?(t>>>=0,(i=0<=t&&t<256)&&(n=_re[t],n)?n:(e=at(t,0,!0),i&&(_re[t]=e),e)):(t|=0,(i=-128<=t&&t<128)&&(n=yre[t],n)?n:(e=at(t,t<0?-1:0,!1),i&&(yre[t]=e),e))}At.fromInt=Su;function Gn(t,r){if(isNaN(t))return r?Qa:gi;if(r){if(t<0)return Qa;if(t>=Sre)return Pre}else{if(t<=-xre)return on;if(t+1>=xre)return wre}return t<0?Gn(-t,r).neg():at(t%Uf|0,t/Uf|0,r)}At.fromNumber=Gn;function at(t,r,e){return new At(t,r,e)}At.fromBits=at;var I_=Math.pow;function OM(t,r,e){if(t.length===0)throw Error("empty string");if(typeof r=="number"?(e=r,r=!1):r=!!r,t==="NaN"||t==="Infinity"||t==="+Infinity"||t==="-Infinity")return r?Qa:gi;if(e=e||10,e<2||36<e)throw RangeError("radix");var n;if((n=t.indexOf("-"))>0)throw Error("interior hyphen");if(n===0)return OM(t.substring(1),r,e).neg();for(var i=Gn(I_(e,8)),a=gi,o=0;o<t.length;o+=8){var s=Math.min(8,t.length-o),u=parseInt(t.substring(o,o+s),e);if(s<8){var l=Gn(I_(e,s));a=a.mul(l).add(Gn(u))}else a=a.mul(i),a=a.add(Gn(u))}return a.unsigned=r,a}At.fromString=OM;function yi(t,r){return typeof t=="number"?Gn(t,r):typeof t=="string"?OM(t,r):at(t.low,t.high,typeof r=="boolean"?r:t.unsigned)}At.fromValue=yi;var bre=1<<16,ORe=1<<24,Uf=bre*bre,Sre=Uf*Uf,xre=Sre/2,Are=Su(ORe),gi=Su(0);At.ZERO=gi;var Qa=Su(0,!0);At.UZERO=Qa;var jf=Su(1);At.ONE=jf;var Tre=Su(1,!0);At.UONE=Tre;var PM=Su(-1);At.NEG_ONE=PM;var wre=at(-1,2147483647,!1);At.MAX_VALUE=wre;var Pre=at(-1,-1,!0);At.MAX_UNSIGNED_VALUE=Pre;var on=at(0,-2147483648,!1);At.MIN_VALUE=on;var re=At.prototype;re.toInt=function(){return this.unsigned?this.low>>>0:this.low};re.toNumber=function(){return this.unsigned?(this.high>>>0)*Uf+(this.low>>>0):this.high*Uf+(this.low>>>0)};re.toString=function(r){if(r=r||10,r<2||36<r)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(on)){var e=Gn(r),n=this.div(e),i=n.mul(e).sub(this);return n.toString(r)+i.toInt().toString(r)}else return"-"+this.neg().toString(r);for(var a=Gn(I_(r,6),this.unsigned),o=this,s="";;){var u=o.div(a),l=o.sub(u.mul(a)).toInt()>>>0,f=l.toString(r);if(o=u,o.isZero())return f+s;for(;f.length<6;)f="0"+f;s=""+f+s}};re.getHighBits=function(){return this.high};re.getHighBitsUnsigned=function(){return this.high>>>0};re.getLowBits=function(){return this.low};re.getLowBitsUnsigned=function(){return this.low>>>0};re.getNumBitsAbs=function(){if(this.isNegative())return this.eq(on)?64:this.neg().getNumBitsAbs();for(var r=this.high!=0?this.high:this.low,e=31;e>0&&!(r&1<<e);e--);return this.high!=0?e+33:e+1};re.isZero=function(){return this.high===0&&this.low===0};re.eqz=re.isZero;re.isNegative=function(){return!this.unsigned&&this.high<0};re.isPositive=function(){return this.unsigned||this.high>=0};re.isOdd=function(){return(this.low&1)===1};re.isEven=function(){return(this.low&1)===0};re.equals=function(r){return Er(r)||(r=yi(r)),this.unsigned!==r.unsigned&&this.high>>>31===1&&r.high>>>31===1?!1:this.high===r.high&&this.low===r.low};re.eq=re.equals;re.notEquals=function(r){return!this.eq(r)};re.neq=re.notEquals;re.ne=re.notEquals;re.lessThan=function(r){return this.comp(r)<0};re.lt=re.lessThan;re.lessThanOrEqual=function(r){return this.comp(r)<=0};re.lte=re.lessThanOrEqual;re.le=re.lessThanOrEqual;re.greaterThan=function(r){return this.comp(r)>0};re.gt=re.greaterThan;re.greaterThanOrEqual=function(r){return this.comp(r)>=0};re.gte=re.greaterThanOrEqual;re.ge=re.greaterThanOrEqual;re.compare=function(r){if(Er(r)||(r=yi(r)),this.eq(r))return 0;var e=this.isNegative(),n=r.isNegative();return e&&!n?-1:!e&&n?1:this.unsigned?r.high>>>0>this.high>>>0||r.high===this.high&&r.low>>>0>this.low>>>0?-1:1:this.sub(r).isNegative()?-1:1};re.comp=re.compare;re.negate=function(){return!this.unsigned&&this.eq(on)?on:this.not().add(jf)};re.neg=re.negate;re.add=function(r){Er(r)||(r=yi(r));var e=this.high>>>16,n=this.high&65535,i=this.low>>>16,a=this.low&65535,o=r.high>>>16,s=r.high&65535,u=r.low>>>16,l=r.low&65535,f=0,c=0,p=0,d=0;return d+=a+l,p+=d>>>16,d&=65535,p+=i+u,c+=p>>>16,p&=65535,c+=n+s,f+=c>>>16,c&=65535,f+=e+o,f&=65535,at(p<<16|d,f<<16|c,this.unsigned)};re.subtract=function(r){return Er(r)||(r=yi(r)),this.add(r.neg())};re.sub=re.subtract;re.multiply=function(r){if(this.isZero())return this;if(Er(r)||(r=yi(r)),Un){var e=Un.mul(this.low,this.high,r.low,r.high);return at(e,Un.get_high(),this.unsigned)}if(r.isZero())return this.unsigned?Qa:gi;if(this.eq(on))return r.isOdd()?on:gi;if(r.eq(on))return this.isOdd()?on:gi;if(this.isNegative())return r.isNegative()?this.neg().mul(r.neg()):this.neg().mul(r).neg();if(r.isNegative())return this.mul(r.neg()).neg();if(this.lt(Are)&&r.lt(Are))return Gn(this.toNumber()*r.toNumber(),this.unsigned);var n=this.high>>>16,i=this.high&65535,a=this.low>>>16,o=this.low&65535,s=r.high>>>16,u=r.high&65535,l=r.low>>>16,f=r.low&65535,c=0,p=0,d=0,v=0;return v+=o*f,d+=v>>>16,v&=65535,d+=a*f,p+=d>>>16,d&=65535,d+=o*l,p+=d>>>16,d&=65535,p+=i*f,c+=p>>>16,p&=65535,p+=a*l,c+=p>>>16,p&=65535,p+=o*u,c+=p>>>16,p&=65535,c+=n*f+i*l+a*u+o*s,c&=65535,at(d<<16|v,c<<16|p,this.unsigned)};re.mul=re.multiply;re.divide=function(r){if(Er(r)||(r=yi(r)),r.isZero())throw Error("division by zero");if(Un){if(!this.unsigned&&this.high===-2147483648&&r.low===-1&&r.high===-1)return this;var e=(this.unsigned?Un.div_u:Un.div_s)(this.low,this.high,r.low,r.high);return at(e,Un.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Qa:gi;var n,i,a;if(this.unsigned){if(r.unsigned||(r=r.toUnsigned()),r.gt(this))return Qa;if(r.gt(this.shru(1)))return Tre;a=Qa}else{if(this.eq(on)){if(r.eq(jf)||r.eq(PM))return on;if(r.eq(on))return jf;var o=this.shr(1);return n=o.div(r).shl(1),n.eq(gi)?r.isNegative()?jf:PM:(i=this.sub(r.mul(n)),a=n.add(i.div(r)),a)}else if(r.eq(on))return this.unsigned?Qa:gi;if(this.isNegative())return r.isNegative()?this.neg().div(r.neg()):this.neg().div(r).neg();if(r.isNegative())return this.div(r.neg()).neg();a=gi}for(i=this;i.gte(r);){n=Math.max(1,Math.floor(i.toNumber()/r.toNumber()));for(var s=Math.ceil(Math.log(n)/Math.LN2),u=s<=48?1:I_(2,s-48),l=Gn(n),f=l.mul(r);f.isNegative()||f.gt(i);)n-=u,l=Gn(n,this.unsigned),f=l.mul(r);l.isZero()&&(l=jf),a=a.add(l),i=i.sub(f)}return a};re.div=re.divide;re.modulo=function(r){if(Er(r)||(r=yi(r)),Un){var e=(this.unsigned?Un.rem_u:Un.rem_s)(this.low,this.high,r.low,r.high);return at(e,Un.get_high(),this.unsigned)}return this.sub(this.div(r).mul(r))};re.mod=re.modulo;re.rem=re.modulo;re.not=function(){return at(~this.low,~this.high,this.unsigned)};re.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32};re.clz=re.countLeadingZeros;re.countTrailingZeros=function(){return this.low?gre(this.low):gre(this.high)+32};re.ctz=re.countTrailingZeros;re.and=function(r){return Er(r)||(r=yi(r)),at(this.low&r.low,this.high&r.high,this.unsigned)};re.or=function(r){return Er(r)||(r=yi(r)),at(this.low|r.low,this.high|r.high,this.unsigned)};re.xor=function(r){return Er(r)||(r=yi(r)),at(this.low^r.low,this.high^r.high,this.unsigned)};re.shiftLeft=function(r){return Er(r)&&(r=r.toInt()),(r&=63)===0?this:r<32?at(this.low<<r,this.high<<r|this.low>>>32-r,this.unsigned):at(0,this.low<<r-32,this.unsigned)};re.shl=re.shiftLeft;re.shiftRight=function(r){return Er(r)&&(r=r.toInt()),(r&=63)===0?this:r<32?at(this.low>>>r|this.high<<32-r,this.high>>r,this.unsigned):at(this.high>>r-32,this.high>=0?0:-1,this.unsigned)};re.shr=re.shiftRight;re.shiftRightUnsigned=function(r){return Er(r)&&(r=r.toInt()),(r&=63)===0?this:r<32?at(this.low>>>r|this.high<<32-r,this.high>>>r,this.unsigned):r===32?at(this.high,0,this.unsigned):at(this.high>>>r-32,0,this.unsigned)};re.shru=re.shiftRightUnsigned;re.shr_u=re.shiftRightUnsigned;re.rotateLeft=function(r){var e;return Er(r)&&(r=r.toInt()),(r&=63)===0?this:r===32?at(this.high,this.low,this.unsigned):r<32?(e=32-r,at(this.low<<r|this.high>>>e,this.high<<r|this.low>>>e,this.unsigned)):(r-=32,e=32-r,at(this.high<<r|this.low>>>e,this.low<<r|this.high>>>e,this.unsigned))};re.rotl=re.rotateLeft;re.rotateRight=function(r){var e;return Er(r)&&(r=r.toInt()),(r&=63)===0?this:r===32?at(this.high,this.low,this.unsigned):r<32?(e=32-r,at(this.high<<e|this.low>>>r,this.low<<e|this.high>>>r,this.unsigned)):(r-=32,e=32-r,at(this.low<<e|this.high>>>r,this.high<<e|this.low>>>r,this.unsigned))};re.rotr=re.rotateRight;re.toSigned=function(){return this.unsigned?at(this.low,this.high,!1):this};re.toUnsigned=function(){return this.unsigned?this:at(this.low,this.high,!0)};re.toBytes=function(r){return r?this.toBytesLE():this.toBytesBE()};re.toBytesLE=function(){var r=this.high,e=this.low;return[e&255,e>>>8&255,e>>>16&255,e>>>24,r&255,r>>>8&255,r>>>16&255,r>>>24]};re.toBytesBE=function(){var r=this.high,e=this.low;return[r>>>24,r>>>16&255,r>>>8&255,r&255,e>>>24,e>>>16&255,e>>>8&255,e&255]};At.fromBytes=function(r,e,n){return n?At.fromBytesLE(r,e):At.fromBytesBE(r,e)};At.fromBytesLE=function(r,e){return new At(r[0]|r[1]<<8|r[2]<<16|r[3]<<24,r[4]|r[5]<<8|r[6]<<16|r[7]<<24,e)};At.fromBytesBE=function(r,e){return new At(r[4]<<24|r[5]<<16|r[6]<<8|r[7],r[0]<<24|r[1]<<16|r[2]<<8|r[3],e)};var Gf=At;var ERe=16;function Bd(t){t==="X"&&(t="");var r=t.padEnd(ERe,"0");return Gf.fromString(r,!0,16)}function EM(t){if(t.isZero())return"X";var r=t.countTrailingZeros(),e=r%4;r=(r-e)/4;var n=r;r*=4;var i=t.shiftRightUnsigned(r),a=i.toString(16).replace(/0+$/,""),o=Array(17-n-a.length).join("0");return o+a}function CM(t,r){var e=CRe(t).shiftRightUnsigned(2),n=t.add(Gf.fromNumber(2*r+1-4).multiply(e));return n}function CRe(t){return t.and(t.not().add(1))}var MM=h(me());var MRe=3,IRe=30,RRe=2*IRe+1,Ore=180/Math.PI;function Cre(t){if(t.length===0)throw new Error("Invalid Hilbert quad key ".concat(t));for(var r=t.split("/"),e=parseInt(r[0],10),n=r[1],i=n.length,a=0,o=[0,0],s=i-1;s>=0;s--){a=i-s;var u=n[s],l=0,f=0;u==="1"?f=1:u==="2"?(l=1,f=1):u==="3"&&(l=1);var c=Math.pow(2,a-1);LRe(c,o,l,f),o[0]+=c*l,o[1]+=c*f}if(e%2===1){var p=o[0];o[0]=o[1],o[1]=p}return{face:e,ij:o,level:a}}function Mre(t){if(t.isZero())return"";for(var r=t.toString(2);r.length<MRe+RRe;)r="0"+r;var e=r.lastIndexOf("1"),n=r.substring(0,3),i=r.substring(3,e),a=i.length/2,o=Gf.fromString(n,!0,2).toString(10),s="";if(a!==0)for(s=Gf.fromString(i,!0,2).toString(4);s.length<a;)s="0"+s;return"".concat(o,"/").concat(s)}function IM(t,r,e){var n=1<<r;return[(t[0]+e[0])/n,(t[1]+e[1])/n]}function Ere(t){return t>=.5?1/3*(4*t*t-1):1/3*(1-4*(1-t)*(1-t))}function RM(t){return[Ere(t[0]),Ere(t[1])]}function LM(t,r){var e=(0,MM.default)(r,2),n=e[0],i=e[1];switch(t){case 0:return[1,n,i];case 1:return[-n,1,i];case 2:return[-n,-i,1];case 3:return[-1,-i,-n];case 4:return[i,-1,-n];case 5:return[i,n,-1];default:throw new Error("Invalid face")}}function kM(t){var r=(0,MM.default)(t,3),e=r[0],n=r[1],i=r[2],a=Math.atan2(i,Math.sqrt(e*e+n*n)),o=Math.atan2(n,e);return[o*Ore,a*Ore]}function LRe(t,r,e,n){if(n===0){e===1&&(r[0]=t-1-r[0],r[1]=t-1-r[1]);var i=r[0];r[0]=r[1],r[1]=i}}function Ire(t){var r=IM(t.ij,t.level,[.5,.5]),e=RM(r),n=LM(t.face,e);return kM(n)}var kRe=100;function BM(t){for(var r=t.face,e=t.ij,n=t.level,i=[[0,0],[0,1],[1,1],[1,0],[0,0]],a=Math.max(1,Math.ceil(kRe*Math.pow(2,-n))),o=new Float64Array(4*a*2+2),s=0,u=0,l=0;l<4;l++)for(var f=i[l].slice(0),c=i[l+1],p=(c[0]-f[0])/a,d=(c[1]-f[1])/a,v=0;v<a;v++){f[0]+=p,f[1]+=d;var m=IM(e,n,f),g=RM(m),y=LM(r,g),_=kM(y);Math.abs(_[1])>89.999&&(_[0]=u);var b=_[0]-u;_[0]+=b>180?-360:b<-180?360:0,o[s++]=_[0],o[s++]=_[1],u=_[0]}return o[s++]=o[0],o[s++]=o[1],o}function zf(t){var r=BRe(t),e=Cre(r);return e}function BRe(t){if(t.indexOf("/")>0)return t;var r=Bd(t);return Mre(r)}function FM(t){var r=zf(t);return Ire(r)}function Lre(t){var r;if(t.face===2||t.face===5){for(var e=null,n=0,i=0;i<4;i++){var a="".concat(t.face,"/").concat(i),o=zf(a),s=BM(o);(typeof e>"u"||e===null)&&(e=new Float64Array(4*s.length)),e.set(s,n),n+=s.length}r=Rre(e)}else{var u=BM(t);r=Rre(u)}return r}function Rre(t){if(t.length%2!==0)throw new Error("Invalid corners");for(var r=[],e=[],n=0;n<t.length;n+=2)r.push(t[n]),e.push(t[n+1]);return r.sort(function(i,a){return i-a}),e.sort(function(i,a){return i-a}),{west:r[0],east:r[r.length-1],north:e[e.length-1],south:e[0]}}function DM(t,r){var e=r?.minimumHeight||0,n=r?.maximumHeight||0,i=zf(t),a=Lre(i),o=a.west,s=a.south,u=a.east,l=a.north,f=[];return f.push(new j(o,l,e)),f.push(new j(u,l,e)),f.push(new j(u,s,e)),f.push(new j(o,s,e)),f.push(new j(o,l,n)),f.push(new j(u,l,n)),f.push(new j(u,s,n)),f.push(new j(o,s,n)),f}var NM=h(Zt());function R_(t){var r=t.token,e={minimumHeight:t.minimumHeight,maximumHeight:t.maximumHeight},n=DM(r,e),i=FM(r),a=i[0],o=i[1],s=it.WGS84.cartographicToCartesian([a,o,e.maximumHeight]),u=new j(s[0],s[1],s[2]);n.push(u);var l=ad(n),f=[].concat((0,NM.default)(l.center),(0,NM.default)(l.halfAxes));return f}function kre(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function FRe(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?kre(Object(e),!0).forEach(function(n){(0,Dre.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):kre(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var DRe=4,NRe=8,jRe={QUADTREE:DRe,OCTREE:NRe};function URe(t,r,e){if(t!=null&&t.box){var n=Bd(t.s2VolumeInfo.token),i=CM(n,r),a=EM(i),o=FRe({},t.s2VolumeInfo);switch(o.token=a,e){case"OCTREE":var s=t.s2VolumeInfo,u=s.maximumHeight-s.minimumHeight,l=u/2,f=s.minimumHeight+u/2;s.minimumHeight=f-l,s.maximumHeight=f+l;break;default:break}var c=R_(o),p={box:c,s2VolumeInfo:o};return p}}function zM(t){return GM.apply(this,arguments)}function GM(){return GM=(0,Fre.default)(UM.default.mark(function t(r){var e,n,i,a,o,s,u,l,f,c,p,d,v,m,g,y,_,b,x,A,S,P,O,C,T,I,R,V,z,k,G,U,$,H,Q,ie,fe,Ae,Oe,Xe,ge,qe,Ie,Et,Wn,sn;return UM.default.wrap(function(zt){for(;;)switch(zt.prev=zt.next){case 0:if(e=r.options,n=r.parentData,i=n===void 0?{mortonIndex:0,x:0,y:0,z:0}:n,a=r.childIndex,o=a===void 0?0:a,s=r.globalData,u=s===void 0?{level:0,mortonIndex:0,x:0,y:0,z:0}:s,l=r.s2VolumeBox,f=r.subtree,c=r.level,p=c===void 0?0:c,d=e.subdivisionScheme,v=e.subtreeLevels,m=e.maximumLevel,g=e.contentUrlTemplate,y=e.subtreesUriTemplate,_=e.basePath,b={children:[],lodMetricValue:0,contentUrl:""},x=jRe[d],A=o&1,S=o>>1&1,P=o>>2&1,O=(Math.pow(x,p)-1)/(x-1),C=Tu(i.mortonIndex,o),T=O+C,I=Tu(i.x,A),R=Tu(i.y,S),V=Tu(i.z,P),z=!1,p+1>v&&(z=jM(f.childSubtreeAvailability,C)),k=Tu(u.x,I),G=Tu(u.y,R),U=Tu(u.z,V),$=p+u.level,!z){zt.next=38;break}return H="".concat(_,"/").concat(y),Q=L_(H,$,k,G,U),zt.next=25,Jt(Q,M_);case 25:ie=zt.sent,f=ie,u.mortonIndex=C,u.x=I,u.y=R,u.z=V,u.level=p,C=0,T=0,I=0,R=0,V=0,p=0;case 38:if(fe=jM(f.tileAvailability,T),!(!fe||p>m)){zt.next=41;break}return zt.abrupt("return",b);case 41:Ae=jM(f.contentAvailability,T),Ae&&(b.contentUrl=L_(g,$,k,G,U)),Oe=p+1,Xe={mortonIndex:C,x:I,y:R,z:V},ge=0;case 46:if(!(ge<x)){zt.next=55;break}return qe=URe(l,ge,d),zt.next=50,zM({subtree:f,options:e,parentData:Xe,childIndex:ge,level:Oe,globalData:u,s2VolumeBox:qe});case 50:Ie=zt.sent,(Ie.contentUrl||Ie.children.length)&&(Et=$+1,Wn={childTileX:I,childTileY:R,childTileZ:V},sn=GRe(Ie,Et,Wn,e,l),b.children.push(sn));case 52:ge++,zt.next=46;break;case 55:return zt.abrupt("return",b);case 56:case"end":return zt.stop()}},t)})),GM.apply(this,arguments)}function jM(t,r){return"constant"in t?Boolean(t.constant):t.explicitBitstream?HRe(r,t.explicitBitstream):!1}function GRe(t,r,e,n,i){var a=n.basePath,o=n.refine,s=n.getRefine,u=n.lodMetricType,l=n.getTileType,f=n.rootLodMetricValue,c=n.rootBoundingVolume,p=t.contentUrl&&t.contentUrl.replace("".concat(a,"/"),""),d=f/Math.pow(2,r),v=i!=null&&i.box?{box:i.box}:c,m=zRe(r,v,e);return{children:t.children,contentUrl:t.contentUrl,content:{uri:p},id:t.contentUrl,refine:s(o),type:l(t),lodMetricType:u,lodMetricValue:d,geometricError:d,transform:t.transform,boundingVolume:m}}function zRe(t,r,e){if(r.region){var n=e.childTileX,i=e.childTileY,a=e.childTileZ,o=(0,Bre.default)(r.region,6),s=o[0],u=o[1],l=o[2],f=o[3],c=o[4],p=o[5],d=Math.pow(2,t),v=(l-s)/d,m=(f-u)/d,g=(p-c)/d,y=s+v*n,_=s+v*(n+1),b=u+m*i,x=u+m*(i+1),A=c+g*a,S=c+g*(a+1);return{region:[y,b,_,x,A,S]}}if(r.box)return r;throw new Error("Unsupported bounding volume type ".concat(r))}function Tu(t,r){return parseInt(t.toString(2)+r.toString(2),2)}function L_(t,r,e,n,i){var a=VRe({level:r,x:e,y:n,z:i});return t.replace(/{level}|{x}|{y}|{z}/gi,function(o){return a[o]})}function VRe(t){var r={};for(var e in t)r["{".concat(e,"}")]=t[e];return r}function HRe(t,r){var e=Math.floor(t/8),n=t%8,i=r[e]>>n&1;return i===1}function WRe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=$Re(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function $Re(t,r){if(t){if(typeof t=="string")return Nre(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Nre(t,r)}}function Nre(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function XM(t){if(!t.contentUrl)return Ka.EMPTY;var r=t.contentUrl.split("?")[0],e=r.split(".").pop();switch(e){case"pnts":return Ka.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return Ka.SCENEGRAPH;default:return e}}function qM(t){switch(t){case"REPLACE":case"replace":return nn.REPLACE;case"ADD":case"add":return nn.ADD;default:return t}}function VM(t,r){var e=/^[a-z][0-9a-z+.-]*:/i;if(e.test(r)){var n=new URL(t,"".concat(r,"/"));return decodeURI(n.toString())}else if(t.startsWith("/"))return t;return"".concat(r,"/").concat(t)}function jre(t,r){if(!t)return null;if(t.content){var e=t.content.uri||t.content.url;t.contentUrl=VM(e,r.basePath)}return t.id=t.contentUrl,t.lodMetricType=gu.GEOMETRIC_ERROR,t.lodMetricValue=t.geometricError,t.transformMatrix=t.transform,t.type=XM(t),t.refine=qM(t.refine),t}function zre(t,r){return HM.apply(this,arguments)}function HM(){return HM=(0,k_.default)(wu.default.mark(function t(r,e){var n,i,a,o,s,u,l,f,c,p;return wu.default.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(n=r.basePath,a=Gre(r?.root),!(a&&r.root)){v.next=8;break}return v.next=5,Ure(r.root,r,a,e);case 5:i=v.sent,v.next=9;break;case 8:i=jre(r.root,r);case 9:o=[],o.push(i);case 11:if(!(o.length>0)){v.next=40;break}s=o.pop()||{},u=s.children||[],l=WRe(u),v.prev=15,l.s();case 17:if((f=l.n()).done){v.next=30;break}if(c=f.value,p=Gre(c),!p){v.next=26;break}return v.next=23,Ure(c,r,p,e);case 23:c=v.sent,v.next=27;break;case 26:jre(c,{basePath:n});case 27:o.push(c);case 28:v.next=17;break;case 30:v.next=35;break;case 32:v.prev=32,v.t0=v.catch(15),l.e(v.t0);case 35:return v.prev=35,l.f(),v.finish(35);case 38:v.next=11;break;case 40:return v.abrupt("return",i);case 41:case"end":return v.stop()}},t,null,[[15,32,35,38]])})),HM.apply(this,arguments)}function Ure(t,r,e,n){return WM.apply(this,arguments)}function WM(){return WM=(0,k_.default)(wu.default.mark(function t(r,e,n,i){var a,o,s,u,l,f,c,p,d,v,m,g,y,_,b,x,A,S;return wu.default.wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return s=e.basePath,u=n.subdivisionScheme,l=n.maximumLevel,f=n.subtreeLevels,c=n.subtrees.uri,p=L_(c,0,0,0,0),d=VM(p,s),O.next=6,Jt(d,M_,i);case 6:return v=O.sent,m=VM(r.content.uri,s),g=e==null||(a=e.root)===null||a===void 0?void 0:a.refine,y=r.geometricError,_=(o=r.boundingVolume.extensions)===null||o===void 0?void 0:o["3DTILES_bounding_volume_S2"],_&&(b=R_(_),x={box:b,s2VolumeInfo:_},r.boundingVolume=x),A=r.boundingVolume,S={contentUrlTemplate:m,subtreesUriTemplate:c,subdivisionScheme:u,subtreeLevels:f,maximumLevel:l,refine:g,basePath:s,lodMetricType:gu.GEOMETRIC_ERROR,rootLodMetricValue:y,rootBoundingVolume:A,getTileType:XM,getRefine:qM},O.next=16,XRe(r,v,S);case 16:return O.abrupt("return",O.sent);case 17:case"end":return O.stop()}},t)})),WM.apply(this,arguments)}function XRe(t,r,e){return $M.apply(this,arguments)}function $M(){return $M=(0,k_.default)(wu.default.mark(function t(r,e,n){var i,a,o;return wu.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(r){u.next=2;break}return u.abrupt("return",null);case 2:return r.lodMetricType=gu.GEOMETRIC_ERROR,r.lodMetricValue=r.geometricError,r.transformMatrix=r.transform,u.next=7,zM({subtree:e,options:n,s2VolumeBox:r});case 7:return i=u.sent,a=i.children,o=i.contentUrl,o&&(r.contentUrl=o,r.content={uri:o.replace("".concat(n.basePath,"/"),"")}),r.refine=qM(r.refine),r.type=XM(r),r.children=a,r.id=r.contentUrl,u.abrupt("return",r);case 16:case"end":return u.stop()}},t)})),$M.apply(this,arguments)}function Gre(t){var r;return(t==null||(r=t.extensions)===null||r===void 0?void 0:r["3DTILES_implicit_tiling"])||t?.implicitTiling}var F_={id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:S_,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:ZRe,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};function qRe(t){return Kn.dirname(t.url)}function YRe(t,r,e){return YM.apply(this,arguments)}function YM(){return YM=(0,B_.default)(Pu.default.mark(function t(r,e,n){var i,a;return Pu.default.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return i={content:{featureIds:null}},a=0,s.next=4,bM(r,a,e,n,i.content);case 4:return s.abrupt("return",i.content);case 5:case"end":return s.stop()}},t)})),YM.apply(this,arguments)}function KRe(t,r,e){return KM.apply(this,arguments)}function KM(){return KM=(0,B_.default)(Pu.default.mark(function t(r,e,n){var i,a;return Pu.default.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return a=JSON.parse(new TextDecoder().decode(r)),a.loader=e.loader||F_,a.url=n.url,a.queryString=n.queryString,a.basePath=qRe(a),s.next=7,zre(a,e);case 7:return a.root=s.sent,a.type=Pr.TILES3D,a.lodMetricType=gu.GEOMETRIC_ERROR,a.lodMetricValue=((i=a.root)===null||i===void 0?void 0:i.lodMetricValue)||0,s.abrupt("return",a);case 12:case"end":return s.stop()}},t)})),KM.apply(this,arguments)}function ZRe(t,r,e){return ZM.apply(this,arguments)}function ZM(){return ZM=(0,B_.default)(Pu.default.mark(function t(r,e,n){var i,a;return Pu.default.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(i=e["3d-tiles"]||{},i.isTileset==="auto"?a=n.url&&n.url.indexOf(".json")!==-1:a=i.isTileset,!a){s.next=8;break}return s.next=5,KRe(r,e,n);case 5:r=s.sent,s.next=11;break;case 8:return s.next=10,YRe(r,e,n);case 10:r=s.sent;case 11:return s.abrupt("return",r);case 12:case"end":return s.stop()}},t)})),ZM.apply(this,arguments)}function Vre(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Vf(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Vre(Object(e),!0).forEach(function(n){(0,Fd.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Vre(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function JRe(t){var r=QRe();return function(){var n=(0,JM.default)(t),i;if(r){var a=(0,JM.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Kre.default)(this,i)}}function QRe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Hre=[0],eLe={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:"",loader:F_,onTilesetLoad:{type:"function",value:function(r){}},onTileLoad:{type:"function",value:function(r){}},onTileUnload:{type:"function",value:function(r){}},onTileError:{type:"function",value:function(r,e,n){}},_getMeshColor:{type:"function",value:function(r){return[255,255,255]}}},D_=function(t){(0,Yre.default)(e,t);var r=JRe(e);function e(){var n;(0,$re.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,Fd.default)((0,qre.default)(n),"state",void 0),n}return(0,Xre.default)(e,[{key:"initializeState",value:function(){"onTileLoadFail"in this.props&&J.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}},{key:"isLoaded",get:function(){var i=this.state.tileset3d;return i!==null&&i.isLoaded()}},{key:"shouldUpdateState",value:function(i){var a=i.changeFlags;return a.somethingChanged}},{key:"updateState",value:function(i){var a=i.props,o=i.oldProps,s=i.changeFlags;if(a.data&&a.data!==o.data&&this._loadTileset(a.data),s.viewportChanged){var u=this.state.activeViewports,l=Object.keys(u).length;l&&(this._updateTileset(u),this.state.lastUpdatedViewports=u,this.state.activeViewports={})}if(s.propsChanged){var f=this.state.layerMap;for(var c in f)f[c].needsUpdate=!0}}},{key:"activateViewport",value:function(i){var a=this.state,o=a.activeViewports,s=a.lastUpdatedViewports;this.internalState.viewport=i,o[i.id]=i;var u=s?.[i.id];(!u||!i.equals(u))&&(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}},{key:"getPickingInfo",value:function(i){var a=i.info,o=i.sourceLayer,s=o&&o.props.tile;return a.picked&&(a.object=s),a.sourceTile=s,a}},{key:"filterSubLayer",value:function(i){var a=i.layer,o=i.viewport,s=a.props,u=s.tile,l=o.id;return u.selected&&u.viewportIds.includes(l)}},{key:"_updateAutoHighlight",value:function(i){var a=i.sourceTile,o=this.state.layerMap[a?.id];o&&o.layer&&o.layer.updateAutoHighlight(i)}},{key:"_loadTileset",value:function(){var n=(0,Wre.default)(QM.default.mark(function a(o){var s,u,l,f,c,p,d;return QM.default.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(s=this.props.loadOptions,u=s===void 0?{}:s,l=this.props.loader||this.props.loaders,Array.isArray(l)&&(l=l[0]),f={loadOptions:Vf({},u)},!l.preload){m.next=10;break}return m.next=7,l.preload(o,u);case 7:c=m.sent,c.headers&&(f.loadOptions.fetch=Vf(Vf({},f.loadOptions.fetch),{},{headers:c.headers})),Object.assign(f,c);case 10:return m.next=12,Jt(o,l,f.loadOptions);case 12:p=m.sent,d=new ZC(p,Vf({onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError},f)),this.setState({tileset3d:d,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(d);case 17:case"end":return m.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"_onTileLoad",value:function(i){var a=this.state.lastUpdatedViewports;this.props.onTileLoad(i),this._updateTileset(a),this.setNeedsUpdate()}},{key:"_onTileUnload",value:function(i){delete this.state.layerMap[i.id],this.props.onTileUnload(i)}},{key:"_updateTileset",value:function(i){var a=this;if(i){var o=this.state.tileset3d,s=this.context.timeline,u=Object.keys(i).length;!s||!u||!o||o.selectTiles(Object.values(i)).then(function(l){var f=a.state.frameNumber!==l;f&&a.setState({frameNumber:l})})}}},{key:"_getSubLayer",value:function(i,a){if(!i.content)return null;switch(i.type){case Ka.POINTCLOUD:return this._makePointCloudLayer(i,a);case Ka.SCENEGRAPH:return this._make3DModelLayer(i);case Ka.MESH:return this._makeSimpleMeshLayer(i,a);default:throw new Error("Tile3DLayer: Failed to render layer of type ".concat(i.content.type))}}},{key:"_makePointCloudLayer",value:function(i,a){var o=i.content,s=o.attributes,u=o.pointCount,l=o.constantRGBA,f=o.cartographicOrigin,c=o.modelMatrix,p=s.positions,d=s.normals,v=s.colors;if(!p)return null;var m=a&&a.props.data||{header:{vertexCount:u},attributes:{POSITION:p,NORMAL:d,COLOR_0:v}},g=this.props,y=g.pointSize,_=g.getPointColor,b=this.getSubLayerClass("pointcloud",of);return new b({pointSize:y},this.getSubLayerProps({id:"pointcloud"}),{id:"".concat(this.id,"-pointcloud-").concat(i.id),tile:i,data:m,coordinateSystem:ue.METER_OFFSETS,coordinateOrigin:f,modelMatrix:c,getColor:l||_,_offset:0})}},{key:"_make3DModelLayer",value:function(i){var a=i.content,o=a.gltf,s=a.instances,u=a.cartographicOrigin,l=a.modelMatrix,f=this.getSubLayerClass("scenegraph",Cf);return new f({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:"".concat(this.id,"-scenegraph-").concat(i.id),tile:i,data:s||Hre,scenegraph:o,coordinateSystem:ue.METER_OFFSETS,coordinateOrigin:u,modelMatrix:l,getTransformMatrix:function(p){return p.modelMatrix},getPosition:[0,0,0],_offset:0})}},{key:"_makeSimpleMeshLayer",value:function(i,a){var o=i.content,s=o.attributes,u=o.indices,l=o.modelMatrix,f=o.cartographicOrigin,c=o.coordinateSystem,p=c===void 0?ue.METER_OFFSETS:c,d=o.material,v=o.featureIds,m=this.props._getMeshColor,g=a&&a.props.mesh||new Me({drawMode:4,attributes:tLe(s),indices:u}),y=this.getSubLayerClass("mesh",u_);return new y(this.getSubLayerProps({id:"mesh"}),{id:"".concat(this.id,"-mesh-").concat(i.id),tile:i,mesh:g,data:Hre,getColor:m(i),pbrMaterial:d,modelMatrix:l,coordinateOrigin:f,coordinateSystem:p,featureIds:v,_offset:0})}},{key:"renderLayers",value:function(){var i=this,a=this.state,o=a.tileset3d,s=a.layerMap;return o?o.tiles.map(function(u){var l=s[u.id]=s[u.id]||{tile:u},f=l.layer;return u.selected&&(f?l.needsUpdate&&(f=i._getSubLayer(u,f),l.needsUpdate=!1):f=i._getSubLayer(u)),l.layer=f,f}).filter(Boolean):null}}]),e}(Ot);(0,Fd.default)(D_,"defaultProps",eLe);(0,Fd.default)(D_,"layerName","Tile3DLayer");function tLe(t){var r={};return r.positions=Vf(Vf({},t.positions),{},{value:new Float32Array(t.positions.value)}),t.normals&&(r.normals=t.normals),t.texCoords&&(r.texCoords=t.texCoords),t.colors&&(r.colors=t.colors),t.uvRegions&&(r.uvRegions=t.uvRegions),r}var s2=h(Zt()),mne=h(me()),gne=h(L()),yne=h(N()),_ne=h(be()),bne=h(Y()),xne=h(K()),u2=h(q()),Ud=h(B());var cne=h(ye()),pne=h(B()),o2=h(ve());var Qre=h(me());var Jre=h(me());function rLe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=nLe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function nLe(t,r){if(t){if(typeof t=="string")return Zre(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Zre(t,r)}}function Zre(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var iLe=new Map([["centerX",Float64Array.BYTES_PER_ELEMENT],["centerY",Float64Array.BYTES_PER_ELEMENT],["centerZ",Float64Array.BYTES_PER_ELEMENT],["minHeight",Float32Array.BYTES_PER_ELEMENT],["maxHeight",Float32Array.BYTES_PER_ELEMENT],["boundingSphereCenterX",Float64Array.BYTES_PER_ELEMENT],["boundingSphereCenterY",Float64Array.BYTES_PER_ELEMENT],["boundingSphereCenterZ",Float64Array.BYTES_PER_ELEMENT],["boundingSphereRadius",Float64Array.BYTES_PER_ELEMENT],["horizonOcclusionPointX",Float64Array.BYTES_PER_ELEMENT],["horizonOcclusionPointY",Float64Array.BYTES_PER_ELEMENT],["horizonOcclusionPointZ",Float64Array.BYTES_PER_ELEMENT]]);function e2(t){return t>>1^-(t&1)}function aLe(t){var r=0,e={},n=rLe(iLe),i;try{for(n.s();!(i=n.n()).done;){var a=(0,Jre.default)(i.value,2),o=a[0],s=a[1],u=s===8?t.getFloat64:t.getFloat32;e[o]=u.call(t,r,!0),r+=s}}catch(l){n.e(l)}finally{n.f()}return{header:e,headerEndPosition:r}}function oLe(t,r){var e=r,n=3,i=t.getUint32(e,!0),a=new Uint16Array(i*n);e+=Uint32Array.BYTES_PER_ELEMENT;for(var o=Uint16Array.BYTES_PER_ELEMENT,s=i*o,u=e,l=u+s,f=l+s,c=0,p=0,d=0,v=0;v<i;v++)c+=e2(t.getUint16(u+o*v,!0)),p+=e2(t.getUint16(l+o*v,!0)),d+=e2(t.getUint16(f+o*v,!0)),a[v]=c,a[v+i]=p,a[v+i*2]=d;return e+=s*3,{vertexData:a,vertexDataEndPosition:e}}function Dd(t,r,e,n){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,a;if(n===2?a=new Uint16Array(t,r,e):a=new Uint32Array(t,r,e),!i)return a;for(var o=0,s=0;s<a.length;++s){var u=a[s];a[s]=o-u,u===0&&++o}return a}function sLe(t,r,e){var n=e,i=3,a=r.length/i,o=a>65536?Uint32Array.BYTES_PER_ELEMENT:Uint16Array.BYTES_PER_ELEMENT;n%o!==0&&(n+=o-n%o);var s=t.getUint32(n,!0);n+=Uint32Array.BYTES_PER_ELEMENT;var u=s*3,l=Dd(t.buffer,n,u,o);return n+=u*o,{triangleIndicesEndPosition:n,triangleIndices:l}}function uLe(t,r,e){var n=e,i=3,a=r.length/i,o=a>65536?Uint32Array.BYTES_PER_ELEMENT:Uint16Array.BYTES_PER_ELEMENT,s=t.getUint32(n,!0);n+=Uint32Array.BYTES_PER_ELEMENT;var u=Dd(t.buffer,n,s,o,!1);n+=s*o;var l=t.getUint32(n,!0);n+=Uint32Array.BYTES_PER_ELEMENT;var f=Dd(t.buffer,n,l,o,!1);n+=l*o;var c=t.getUint32(n,!0);n+=Uint32Array.BYTES_PER_ELEMENT;var p=Dd(t.buffer,n,c,o,!1);n+=c*o;var d=t.getUint32(n,!0);n+=Uint32Array.BYTES_PER_ELEMENT;var v=Dd(t.buffer,n,d,o,!1);return n+=d*o,{edgeIndicesEndPosition:n,westIndices:u,southIndices:f,eastIndices:p,northIndices:v}}function lLe(t){return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}function fLe(t){return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}function cLe(t,r){var e={};if(t.byteLength<=r)return{extensions:e,extensionsEndPosition:r};for(var n=r;n<t.byteLength;){var i=t.getUint8(n,!0);n+=Uint8Array.BYTES_PER_ELEMENT;var a=t.getUint32(n,!0);n+=Uint32Array.BYTES_PER_ELEMENT;var o=new DataView(t.buffer,n,a);switch(i){case 1:{e.vertexNormals=lLe(o);break}case 2:{e.waterMask=fLe(o);break}default:}n+=a}return{extensions:e,extensionsEndPosition:n}}var Ou={header:0,vertices:1,triangleIndices:2,edgeIndices:3,extensions:4},pLe={maxDecodingStep:Ou.extensions};function t2(t,r){var e=Object.assign({},pLe,r),n=new DataView(t),i=aLe(n),a=i.header,o=i.headerEndPosition;if(e.maxDecodingStep<Ou.vertices)return{header:a};var s=oLe(n,o),u=s.vertexData,l=s.vertexDataEndPosition;if(e.maxDecodingStep<Ou.triangleIndices)return{header:a,vertexData:u};var f=sLe(n,u,l),c=f.triangleIndices,p=f.triangleIndicesEndPosition;if(e.maxDecodingStep<Ou.edgeIndices)return{header:a,vertexData:u,triangleIndices:c};var d=uLe(n,u,p),v=d.westIndices,m=d.southIndices,g=d.eastIndices,y=d.northIndices,_=d.edgeIndicesEndPosition;if(e.maxDecodingStep<Ou.extensions)return{header:a,vertexData:u,triangleIndices:c,westIndices:v,northIndices:y,eastIndices:g,southIndices:m};var b=cLe(n,_),x=b.extensions;return{header:a,vertexData:u,triangleIndices:c,westIndices:v,northIndices:y,eastIndices:g,southIndices:m,extensions:x}}var Nd=h(Zt());function N_(t,r,e,n){for(var i=n?dLe(n,t.POSITION.value):hLe(r),a=new t.POSITION.value.constructor(i.length*6),o=new t.TEXCOORD_0.value.constructor(i.length*4),s=new r.constructor(i.length*6),u=0;u<i.length;u++){var l=i[u];vLe({edge:l,edgeIndex:u,attributes:t,skirtHeight:e,newPosition:a,newTexcoord0:o,newTriangles:s})}t.POSITION.value=Bc(t.POSITION.value,a),t.TEXCOORD_0.value=Bc(t.TEXCOORD_0.value,o);var f=r instanceof Array?r.concat(s):Bc(r,s);return{attributes:t,triangles:f}}function hLe(t){for(var r=[],e=0;e<t.length;e+=3)r.push([t[e],t[e+1]]),r.push([t[e+1],t[e+2]]),r.push([t[e+2],t[e]]);r.sort(function(s,u){return Math.min.apply(Math,(0,Nd.default)(s))-Math.min.apply(Math,(0,Nd.default)(u))||Math.max.apply(Math,(0,Nd.default)(s))-Math.max.apply(Math,(0,Nd.default)(u))});for(var n=[],i=0;i<r.length;){var a,o;r[i][0]===((a=r[i+1])===null||a===void 0?void 0:a[1])&&r[i][1]===((o=r[i+1])===null||o===void 0?void 0:o[0])?i+=2:(n.push(r[i]),i++)}return n}function dLe(t,r){t.westIndices.sort(function(o,s){return r[3*o+1]-r[3*s+1]}),t.eastIndices.sort(function(o,s){return r[3*s+1]-r[3*o+1]}),t.southIndices.sort(function(o,s){return r[3*s]-r[3*o]}),t.northIndices.sort(function(o,s){return r[3*o]-r[3*s]});var e=[];for(var n in t)for(var i=t[n],a=0;a<i.length-1;a++)e.push([i[a],i[a+1]]);return e}function vLe(t){var r=t.edge,e=t.edgeIndex,n=t.attributes,i=t.skirtHeight,a=t.newPosition,o=t.newTexcoord0,s=t.newTriangles,u=n.POSITION.value.length,l=e*2,f=e*2+1;a.set(n.POSITION.value.subarray(r[0]*3,r[0]*3+3),l*3),a[l*3+2]=a[l*3+2]-i,a.set(n.POSITION.value.subarray(r[1]*3,r[1]*3+3),f*3),a[f*3+2]=a[f*3+2]-i,o.set(n.TEXCOORD_0.value.subarray(r[0]*2,r[0]*2+2),l*2),o.set(n.TEXCOORD_0.value.subarray(r[1]*2,r[1]*2+2),f*2);var c=e*2*3;s[c]=r[0],s[c+1]=u/3+f,s[c+2]=r[1],s[c+3]=u/3+f,s[c+4]=r[0],s[c+5]=u/3+l}function mLe(t,r,e){for(var n=r.minHeight,i=r.maxHeight,a=e||[0,0,1,1],o=(0,Qre.default)(a,4),s=o[0],u=o[1],l=o[2],f=o[3],c=l-s,p=f-u,d=i-n,v=t.length/3,m=new Float32Array(v*3),g=new Float32Array(v*2),y=0;y<v;y++){var _=t[y]/32767,b=t[y+v]/32767,x=t[y+v*2]/32767;m[3*y+0]=_*c+s,m[3*y+1]=b*p+u,m[3*y+2]=x*d+n,g[2*y+0]=_,g[2*y+1]=b}return{POSITION:{value:m,size:3},TEXCOORD_0:{value:g,size:2}}}function gLe(t,r){if(!t)return null;var e=r.bounds,n=t2(t,Ou.triangleIndices),i=n.header,a=n.vertexData,o=n.triangleIndices,s=n.westIndices,u=n.northIndices,l=n.eastIndices,f=n.southIndices,c=o,p=mLe(a,i,e),d=Ua(p);if(r.skirtHeight){var v=N_(p,c,r.skirtHeight,{westIndices:s,northIndices:u,eastIndices:l,southIndices:f}),m=v.attributes,g=v.triangles;p=m,c=g}return{loaderData:{header:{}},header:{vertexCount:c.length,boundingBox:d},mode:4,indices:{value:c,size:1},attributes:p}}function j_(t,r){return gLe(t,r["quantized-mesh"])}var one=h(B()),sne=h(ye()),une=h(me()),n2=h(ve());var jd=class{constructor(r=257){this.gridSize=r;let e=r-1;if(e&e-1)throw new Error(`Expected grid size to be 2^n+1, got ${r}.`);this.numTriangles=e*e*2-2,this.numParentTriangles=this.numTriangles-e*e,this.indices=new Uint32Array(this.gridSize*this.gridSize),this.coords=new Uint16Array(this.numTriangles*4);for(let n=0;n<this.numTriangles;n++){let i=n+2,a=0,o=0,s=0,u=0,l=0,f=0;for(i&1?s=u=l=e:a=o=f=e;(i>>=1)>1;){let p=a+s>>1,d=o+u>>1;i&1?(s=a,u=o,a=l,o=f):(a=s,o=u,s=l,u=f),l=p,f=d}let c=n*4;this.coords[c+0]=a,this.coords[c+1]=o,this.coords[c+2]=s,this.coords[c+3]=u}}createTile(r){return new r2(r,this)}},r2=class{constructor(r,e){let n=e.gridSize;if(r.length!==n*n)throw new Error(`Expected terrain data of length ${n*n} (${n} x ${n}), got ${r.length}.`);this.terrain=r,this.martini=e,this.errors=new Float32Array(r.length),this.update()}update(){let{numTriangles:r,numParentTriangles:e,coords:n,gridSize:i}=this.martini,{terrain:a,errors:o}=this;for(let s=r-1;s>=0;s--){let u=s*4,l=n[u+0],f=n[u+1],c=n[u+2],p=n[u+3],d=l+c>>1,v=f+p>>1,m=d+v-f,g=v+l-d,y=(a[f*i+l]+a[p*i+c])/2,_=v*i+d,b=Math.abs(y-a[_]);if(o[_]=Math.max(o[_],b),s<e){let x=(f+g>>1)*i+(l+m>>1),A=(p+g>>1)*i+(c+m>>1);o[_]=Math.max(o[_],o[x],o[A])}}}getMesh(r=0){let{gridSize:e,indices:n}=this.martini,{errors:i}=this,a=0,o=0,s=e-1;n.fill(0);function u(d,v,m,g,y,_){let b=d+m>>1,x=v+g>>1;Math.abs(d-y)+Math.abs(v-_)>1&&i[x*e+b]>r?(u(y,_,d,v,b,x),u(m,g,y,_,b,x)):(n[v*e+d]=n[v*e+d]||++a,n[g*e+m]=n[g*e+m]||++a,n[_*e+y]=n[_*e+y]||++a,o++)}u(0,0,s,s,s,0),u(s,s,0,0,0,s);let l=new Uint16Array(a*2),f=new Uint32Array(o*3),c=0;function p(d,v,m,g,y,_){let b=d+m>>1,x=v+g>>1;if(Math.abs(d-y)+Math.abs(v-_)>1&&i[x*e+b]>r)p(y,_,d,v,b,x),p(m,g,y,_,b,x);else{let A=n[v*e+d]-1,S=n[g*e+m]-1,P=n[_*e+y]-1;l[2*A]=d,l[2*A+1]=v,l[2*S]=m,l[2*S+1]=g,l[2*P]=y,l[2*P+1]=_,f[c++]=A,f[c++]=S,f[c++]=P}}return p(0,0,s,s,s,0),p(s,s,0,0,0,s),{vertices:l,triangles:f}}};var ene=h(L()),tne=h(N()),rne=function(){function t(r,e){(0,ene.default)(this,t);var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e;this.data=r,this.width=e,this.height=n,this.coords=[],this.triangles=[],this._halfedges=[],this._candidates=[],this._queueIndices=[],this._queue=[],this._errors=[],this._rms=[],this._pending=[],this._pendingLen=0,this._rmsSum=0;var i=e-1,a=n-1,o=this._addPoint(0,0),s=this._addPoint(i,0),u=this._addPoint(0,a),l=this._addPoint(i,a),f=this._addTriangle(l,o,u,-1,-1,-1);this._addTriangle(o,l,s,f,-1,-1),this._flush()}return(0,tne.default)(t,[{key:"run",value:function(){for(var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1;this.getMaxError()>e;)this.refine()}},{key:"refine",value:function(){this._step(),this._flush()}},{key:"getMaxError",value:function(){return this._errors[0]}},{key:"getRMSD",value:function(){return this._rmsSum>0?Math.sqrt(this._rmsSum/(this.width*this.height)):0}},{key:"heightAt",value:function(e,n){return this.data[this.width*n+e]}},{key:"_flush",value:function(){for(var e=this.coords,n=0;n<this._pendingLen;n++){var i=this._pending[n],a=2*this.triangles[i*3+0],o=2*this.triangles[i*3+1],s=2*this.triangles[i*3+2];this._findCandidate(e[a],e[a+1],e[o],e[o+1],e[s],e[s+1],i)}this._pendingLen=0}},{key:"_findCandidate",value:function(e,n,i,a,o,s,u){for(var l=Math.min(e,i,o),f=Math.min(n,a,s),c=Math.max(e,i,o),p=Math.max(n,a,s),d=Eu(i,a,o,s,l,f),v=Eu(o,s,e,n,l,f),m=Eu(e,n,i,a,l,f),g=a-n,y=e-i,_=s-a,b=i-o,x=n-s,A=o-e,S=Eu(e,n,i,a,o,s),P=this.heightAt(e,n)/S,O=this.heightAt(i,a)/S,C=this.heightAt(o,s)/S,T=0,I=0,R=0,V=0,z=f;z<=p;z++){var k=0;d<0&&_!==0&&(k=Math.max(k,Math.floor(-d/_))),v<0&&x!==0&&(k=Math.max(k,Math.floor(-v/x))),m<0&&g!==0&&(k=Math.max(k,Math.floor(-m/g)));for(var G=d+_*k,U=v+x*k,$=m+g*k,H=!1,Q=l+k;Q<=c;Q++){if(G>=0&&U>=0&&$>=0){H=!0;var ie=P*G+O*U+C*$,fe=Math.abs(ie-this.heightAt(Q,z));V+=fe*fe,fe>T&&(T=fe,I=Q,R=z)}else if(H)break;G+=_,U+=x,$+=g}d+=b,v+=A,m+=y}(I===e&&R===n||I===i&&R===a||I===o&&R===s)&&(T=0),this._candidates[2*u]=I,this._candidates[2*u+1]=R,this._rms[u]=V,this._queuePush(u,T,V)}},{key:"_step",value:function(){var e=this._queuePop(),n=e*3+0,i=e*3+1,a=e*3+2,o=this.triangles[n],s=this.triangles[i],u=this.triangles[a],l=this.coords[2*o],f=this.coords[2*o+1],c=this.coords[2*s],p=this.coords[2*s+1],d=this.coords[2*u],v=this.coords[2*u+1],m=this._candidates[2*e],g=this._candidates[2*e+1],y=this._addPoint(m,g);if(Eu(l,f,c,p,m,g)===0)this._handleCollinear(y,n);else if(Eu(c,p,d,v,m,g)===0)this._handleCollinear(y,i);else if(Eu(d,v,l,f,m,g)===0)this._handleCollinear(y,a);else{var _=this._halfedges[n],b=this._halfedges[i],x=this._halfedges[a],A=this._addTriangle(o,s,y,_,-1,-1,n),S=this._addTriangle(s,u,y,b,-1,A+1),P=this._addTriangle(u,o,y,x,A+2,S+1);this._legalize(A),this._legalize(S),this._legalize(P)}}},{key:"_addPoint",value:function(e,n){var i=this.coords.length>>1;return this.coords.push(e,n),i}},{key:"_addTriangle",value:function(e,n,i,a,o,s){var u=arguments.length>6&&arguments[6]!==void 0?arguments[6]:this.triangles.length,l=u/3;return this.triangles[u+0]=e,this.triangles[u+1]=n,this.triangles[u+2]=i,this._halfedges[u+0]=a,this._halfedges[u+1]=o,this._halfedges[u+2]=s,a>=0&&(this._halfedges[a]=u+0),o>=0&&(this._halfedges[o]=u+1),s>=0&&(this._halfedges[s]=u+2),this._candidates[2*l+0]=0,this._candidates[2*l+1]=0,this._queueIndices[l]=-1,this._rms[l]=0,this._pending[this._pendingLen++]=l,u}},{key:"_legalize",value:function(e){var n=this._halfedges[e];if(!(n<0)){var i=e-e%3,a=n-n%3,o=i+(e+1)%3,s=i+(e+2)%3,u=a+(n+2)%3,l=a+(n+1)%3,f=this.triangles[s],c=this.triangles[e],p=this.triangles[o],d=this.triangles[u],v=this.coords;if(yLe(v[2*f],v[2*f+1],v[2*c],v[2*c+1],v[2*p],v[2*p+1],v[2*d],v[2*d+1])){var m=this._halfedges[o],g=this._halfedges[s],y=this._halfedges[u],_=this._halfedges[l];this._queueRemove(i/3),this._queueRemove(a/3);var b=this._addTriangle(f,d,p,-1,y,m,i),x=this._addTriangle(d,f,c,b,g,_,a);this._legalize(b+1),this._legalize(x+2)}}}},{key:"_handleCollinear",value:function(e,n){var i=n-n%3,a=i+(n+1)%3,o=i+(n+2)%3,s=this.triangles[o],u=this.triangles[n],l=this.triangles[a],f=this._halfedges[a],c=this._halfedges[o],p=this._halfedges[n];if(p<0){var d=this._addTriangle(e,s,u,-1,c,-1,i),v=this._addTriangle(s,e,l,d,-1,f);this._legalize(d+1),this._legalize(v+2);return}var m=p-p%3,g=m+(p+2)%3,y=m+(p+1)%3,_=this.triangles[g],b=this._halfedges[g],x=this._halfedges[y];this._queueRemove(m/3);var A=this._addTriangle(s,u,e,c,-1,-1,i),S=this._addTriangle(u,_,e,x,-1,A+1,m),P=this._addTriangle(_,l,e,b,-1,S+1),O=this._addTriangle(l,s,e,f,A+2,P+1);this._legalize(A),this._legalize(S),this._legalize(P),this._legalize(O)}},{key:"_queuePush",value:function(e,n,i){var a=this._queue.length;this._queueIndices[e]=a,this._queue.push(e),this._errors.push(n),this._rmsSum+=i,this._queueUp(a)}},{key:"_queuePop",value:function(){var e=this._queue.length-1;return this._queueSwap(0,e),this._queueDown(0,e),this._queuePopBack()}},{key:"_queuePopBack",value:function(){var e=this._queue.pop();return this._errors.pop(),this._rmsSum-=this._rms[e],this._queueIndices[e]=-1,e}},{key:"_queueRemove",value:function(e){var n=this._queueIndices[e];if(n<0){var i=this._pending.indexOf(e);if(i!==-1)this._pending[i]=this._pending[--this._pendingLen];else throw new Error("Broken triangulation (something went wrong).");return}var a=this._queue.length-1;a!==n&&(this._queueSwap(n,a),this._queueDown(n,a)||this._queueUp(n)),this._queuePopBack()}},{key:"_queueLess",value:function(e,n){return this._errors[e]>this._errors[n]}},{key:"_queueSwap",value:function(e,n){var i=this._queue[e],a=this._queue[n];this._queue[e]=a,this._queue[n]=i,this._queueIndices[i]=n,this._queueIndices[a]=e;var o=this._errors[e];this._errors[e]=this._errors[n],this._errors[n]=o}},{key:"_queueUp",value:function(e){for(var n=e;;){var i=n-1>>1;if(i===n||!this._queueLess(n,i))break;this._queueSwap(i,n),n=i}}},{key:"_queueDown",value:function(e,n){for(var i=e;;){var a=2*i+1;if(a>=n||a<0)break;var o=a+1,s=a;if(o<n&&this._queueLess(o,a)&&(s=o),!this._queueLess(s,i))break;this._queueSwap(i,s),i=s}return i>e}}]),t}();function Eu(t,r,e,n,i,a){return(e-i)*(r-a)-(n-a)*(t-i)}function yLe(t,r,e,n,i,a,o,s){var u=t-o,l=r-s,f=e-o,c=n-s,p=i-o,d=a-s,v=u*u+l*l,m=f*f+c*c,g=p*p+d*d;return u*(c*g-m*d)-l*(f*g-m*p)+v*(f*d-c*p)<0}function nne(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function U_(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?nne(Object(e),!0).forEach(function(n){(0,one.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):nne(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function G_(t,r,e,n,i){for(var a=n.rScaler,o=n.bScaler,s=n.gScaler,u=n.offset,l=new Float32Array((r+1)*(e+1)),f=0,c=0;c<e;c++)for(var p=0;p<r;p++,f++){var d=f*4,v=t[d+0],m=t[d+1],g=t[d+2];l[f+c]=v*a+m*s+g*o+u}if(i==="martini"){for(var y=(r+1)*r,_=0;_<r;_++,y++)l[y]=l[y-r-1];for(var b=e,x=0;x<e+1;x++,b+=e+1)l[b]=l[b-1]}return l}function _Le(t,r,e,n,i){for(var a=e+1,o=t.length/2,s=new Float32Array(o*3),u=new Float32Array(o*2),l=i||[0,0,e,n],f=(0,une.default)(l,4),c=f[0],p=f[1],d=f[2],v=f[3],m=(d-c)/e,g=(v-p)/n,y=0;y<o;y++){var _=t[y*2],b=t[y*2+1],x=b*a+_;s[3*y+0]=_*m+c,s[3*y+1]=-b*g+v,s[3*y+2]=r[x],u[2*y+0]=_/e,u[2*y+1]=b/n}return{POSITION:{value:s,size:3},TEXCOORD_0:{value:u,size:2}}}function bLe(t,r){if(t===null)return null;var e=r.meshMaxError,n=r.bounds,i=r.elevationDecoder,a=t.data,o=t.width,s=t.height,u,l;switch(r.tesselator){case"martini":u=G_(a,o,s,i,r.tesselator),l=ine(e,o,u);break;case"delatin":u=G_(a,o,s,i,r.tesselator),l=ane(e,o,s,u);break;default:o===s&&!(s&o-1)?(u=G_(a,o,s,i,"martini"),l=ine(e,o,u)):(u=G_(a,o,s,i,"delatin"),l=ane(e,o,s,u));break}var f=l,c=f.vertices,p=l,d=p.triangles,v=_Le(c,u,o,s,n),m=Ua(v);if(r.skirtHeight){var g=N_(v,d,r.skirtHeight),y=g.attributes,_=g.triangles;v=y,d=_}return{loaderData:{header:{}},header:{vertexCount:d.length,boundingBox:m},mode:4,indices:{value:Uint32Array.from(d),size:1},attributes:v}}function ine(t,r,e){var n=r+1,i=new jd(n),a=i.createTile(e),o=a.getMesh(t),s=o.vertices,u=o.triangles;return{vertices:s,triangles:u}}function ane(t,r,e,n){var i=new rne(n,r+1,e+1);i.run(t);var a=i.coords,o=i.triangles,s=a;return{vertices:s,triangles:o}}function a2(t,r,e){return i2.apply(this,arguments)}function i2(){return i2=(0,sne.default)(n2.default.mark(function t(r,e,n){var i,a;return n2.default.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return i=U_(U_({},e),{},{mimeType:"application/x.image",image:U_(U_({},e.image),{},{type:"data"})}),s.next=3,n.parse(r,i);case 3:return a=s.sent,s.abrupt("return",bLe(a,e.terrain));case 5:case"end":return s.stop()}},t)})),i2.apply(this,arguments)}var z_="3.4.2";var V_={name:"Terrain",id:"terrain",module:"terrain",version:z_,worker:!0,extensions:["png","pngraw","jpg","jpeg","gif","webp","bmp"],mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/bmp"],options:{terrain:{tesselator:"auto",bounds:null,meshMaxError:10,elevationDecoder:{rScaler:1,gScaler:0,bScaler:0,offset:0},skirtHeight:null}}};var lne={name:"Quantized Mesh",id:"quantized-mesh",module:"terrain",version:z_,worker:!0,extensions:["terrain"],mimeTypes:["application/vnd.quantized-mesh"],options:{"quantized-mesh":{bounds:[0,0,1,1],skirtHeight:null}}};function fne(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function H_(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?fne(Object(e),!0).forEach(function(n){(0,pne.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):fne(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var Q_t=H_(H_({},V_),{},{parse:a2});var ebt=H_(H_({},lne),{},{parseSync:j_,parse:function(){var t=(0,cne.default)(o2.default.mark(function e(n,i){return o2.default.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",j_(n,i));case 1:case"end":return o.stop()}},e)}));function r(e,n){return t.apply(this,arguments)}return r}()});function xLe(t){var r=ALe();return function(){var n=(0,u2.default)(t),i;if(r){var a=(0,u2.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,xne.default)(this,i)}}function ALe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function hne(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Ko(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?hne(Object(e),!0).forEach(function(n){(0,Ud.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):hne(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var dne=[1],SLe=Ko(Ko({},Na.defaultProps),{},{elevationData:Uo,texture:Ko(Ko({},Uo),{},{optional:!0}),meshMaxError:{type:"number",value:4},bounds:{type:"array",value:null,optional:!0,compare:!0},color:{type:"color",value:[255,255,255]},elevationDecoder:{type:"object",value:{rScaler:1,gScaler:0,bScaler:0,offset:0}},workerUrl:"",wireframe:!1,material:!0,loaders:[V_]});function vne(t){return Array.isArray(t)?t.join(";"):t||""}var W_=function(t){(0,bne.default)(e,t);var r=xLe(e);function e(){var n;(0,gne.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,Ud.default)((0,_ne.default)(n),"state",void 0),n}return(0,yne.default)(e,[{key:"updateState",value:function(i){var a=i.props,o=i.oldProps,s=a.elevationData!==o.elevationData;if(s){var u=a.elevationData,l=u&&(Array.isArray(u)||u.includes("{x}")&&u.includes("{y}"));this.setState({isTiled:l})}var f=s||a.meshMaxError!==o.meshMaxError||a.elevationDecoder!==o.elevationDecoder||a.bounds!==o.bounds;if(!this.state.isTiled&&f){var c=this.loadTerrain(a);this.setState({terrain:c})}a.workerUrl&&J.removed("workerUrl","loadOptions.terrain.workerUrl")()}},{key:"loadTerrain",value:function(i){var a,o=i.elevationData,s=i.bounds,u=i.elevationDecoder,l=i.meshMaxError,f=i.signal;if(!o)return null;var c=this.getLoadOptions();c=Ko(Ko({},c),{},{terrain:Ko(Ko({skirtHeight:this.state.isTiled?l*2:0},(a=c)===null||a===void 0?void 0:a.terrain),{},{bounds:s,meshMaxError:l,elevationDecoder:u})});var p=this.props.fetch;return p(o,{propName:"elevationData",layer:this,loadOptions:c,signal:f})}},{key:"getTiledTerrainData",value:function(i){var a=this.props,o=a.elevationData,s=a.fetch,u=a.texture,l=a.elevationDecoder,f=a.meshMaxError,c=this.context.viewport,p=Qi(o,i),d=u&&Qi(u,i),v=i.signal,m=[0,0],g=[0,0];if(c.isGeospatial){var y=i.bbox;m=c.projectFlat([y.west,y.south]),g=c.projectFlat([y.east,y.north])}else{var _=i.bbox;m=[_.left,_.bottom],g=[_.right,_.top]}var b=[m[0],m[1],g[0],g[1]],x=this.loadTerrain({elevationData:p,bounds:b,elevationDecoder:l,meshMaxError:f,signal:v}),A=d?s(d,{propName:"texture",layer:this,loaders:[],signal:v}).catch(function(S){return null}):Promise.resolve(null);return Promise.all([x,A])}},{key:"renderSubLayers",value:function(i){var a=this.getSubLayerClass("mesh",Ga),o=this.props,s=o.color,u=o.wireframe,l=o.material,f=i.data;if(!f)return null;var c=(0,mne.default)(f,2),p=c[0],d=c[1];return new a(i,{data:dne,mesh:p,texture:d,_instanced:!1,coordinateSystem:ue.CARTESIAN,getPosition:function(m){return[0,0,0]},getColor:s,wireframe:u,material:l})}},{key:"onViewportLoad",value:function(i){if(i){var a=this.state.zRange,o=i.map(function(l){return l.content}).filter(Boolean).map(function(l){var f=l[0].header.boundingBox;return f.map(function(c){return c[2]})});if(o.length!==0){var s=Math.min.apply(Math,(0,s2.default)(o.map(function(l){return l[0]}))),u=Math.max.apply(Math,(0,s2.default)(o.map(function(l){return l[1]})));(!a||s<a[0]||u>a[1])&&this.setState({zRange:[s,u]})}}}},{key:"renderLayers",value:function(){var i=this.props,a=i.color,o=i.material,s=i.elevationData,u=i.texture,l=i.wireframe,f=i.meshMaxError,c=i.elevationDecoder,p=i.tileSize,d=i.maxZoom,v=i.minZoom,m=i.extent,g=i.maxRequests,y=i.onTileLoad,_=i.onTileUnload,b=i.onTileError,x=i.maxCacheSize,A=i.maxCacheByteSize,S=i.refinementStrategy;if(this.state.isTiled)return new Na(this.getSubLayerProps({id:"tiles"}),{getTileData:this.getTiledTerrainData.bind(this),renderSubLayers:this.renderSubLayers.bind(this),updateTriggers:{getTileData:{elevationData:vne(s),texture:vne(u),meshMaxError:f,elevationDecoder:c}},onViewportLoad:this.onViewportLoad.bind(this),zRange:this.state.zRange||null,tileSize:p,maxZoom:d,minZoom:v,extent:m,maxRequests:g,onTileLoad:y,onTileUnload:_,onTileError:b,maxCacheSize:x,maxCacheByteSize:A,refinementStrategy:S});var P=this.getSubLayerClass("mesh",Ga);return new P(this.getSubLayerProps({id:"mesh"}),{data:dne,mesh:this.state.terrain,texture:u,_instanced:!1,getPosition:function(C){return[0,0,0]},getColor:a,material:o,wireframe:l})}}]),e}(Ot);(0,Ud.default)(W_,"defaultProps",SLe);(0,Ud.default)(W_,"layerName","TerrainLayer");var zoe=h(Zt()),Voe=h(ye()),Hoe=h(L()),Woe=h(N()),Zo=h(Ee()),$oe=h(Y()),Xoe=h(K()),aa=h(q()),gb=h(B()),K2=h(ve());var Sne=h(L()),Tne=h(N()),wne=h(Y()),Pne=h(K()),l2=h(q()),f2=h(B());var TLe=`
  uniform bool brushing_enabled;
  uniform int brushing_target;
  uniform vec2 brushing_mousePos;
  uniform float brushing_radius;

  #ifdef NON_INSTANCED_MODEL
  attribute vec2 brushingTargets;
  #else
  attribute vec2 instanceBrushingTargets;
  #endif

  varying float brushing_isVisible;

  bool brushing_isPointInRange(vec2 position) {
    if (!brushing_enabled) {
      return true;
    }
    vec2 source_commonspace = project_position(position);
    vec2 target_commonspace = project_position(brushing_mousePos);
    float distance = length((target_commonspace - source_commonspace) / project_uCommonUnitsPerMeter.xy);

    return distance <= brushing_radius;
  }

  bool brushing_arePointsInRange(vec2 sourcePos, vec2 targetPos) {
    return brushing_isPointInRange(sourcePos) || brushing_isPointInRange(targetPos);
  }

  void brushing_setVisible(bool visible) {
    brushing_isVisible = float(visible);
  }
`,wLe=`
  uniform bool brushing_enabled;
  varying float brushing_isVisible;
`,PLe={source:0,target:1,custom:2,source_target:3},OLe={"vs:DECKGL_FILTER_GL_POSITION":`
    vec2 brushingTarget;
    vec2 brushingSource;
    if (brushing_target == 3) {
      brushingTarget = geometry.worldPositionAlt.xy;
      brushingSource = geometry.worldPosition.xy;
    } else if (brushing_target == 0) {
      brushingTarget = geometry.worldPosition.xy;
    } else if (brushing_target == 1) {
      brushingTarget = geometry.worldPositionAlt.xy;
    } else {
      #ifdef NON_INSTANCED_MODEL
      brushingTarget = brushingTargets;
      #else
      brushingTarget = instanceBrushingTargets;
      #endif
    }
    bool visible;
    if (brushing_target == 3) {
      visible = brushing_arePointsInRange(brushingSource, brushingTarget);
    } else {
      visible = brushing_isPointInRange(brushingTarget);
    }
    brushing_setVisible(visible);
  `,"fs:DECKGL_FILTER_COLOR":`
    if (brushing_enabled && brushing_isVisible < 0.5) {
      discard;
    }
  `},Ane={name:"brushing",dependencies:[Qt],vs:TLe,fs:wLe,inject:OLe,getUniforms:function(r){if(!r||!("viewport"in r))return{};var e=r.brushingEnabled,n=e===void 0?!0:e,i=r.brushingRadius,a=i===void 0?1e4:i,o=r.brushingTarget,s=o===void 0?"source":o,u=r.mousePosition,l=r.viewport;return{brushing_enabled:Boolean(n&&u&&l.containsPixel(u)),brushing_radius:a,brushing_target:PLe[s]||0,brushing_mousePos:u?l.unproject([u.x-l.x,u.y-l.y]):[0,0]}}};function ELe(t){var r=CLe();return function(){var n=(0,l2.default)(t),i;if(r){var a=(0,l2.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Pne.default)(this,i)}}function CLe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var MLe={getBrushingTarget:{type:"accessor",value:[0,0]},brushingTarget:"source",brushingEnabled:!0,brushingRadius:1e4},$_=function(t){(0,wne.default)(e,t);var r=ELe(e);function e(){return(0,Sne.default)(this,e),r.apply(this,arguments)}return(0,Tne.default)(e,[{key:"getShaders",value:function(){return{modules:[Ane]}}},{key:"initializeState",value:function(i,a){var o=this,s=this.getAttributeManager();s&&s.add({brushingTargets:{size:2,accessor:"getBrushingTarget",shaderAttributes:{brushingTargets:{divisor:0},instanceBrushingTargets:{divisor:1}}}}),this.state.onMouseMove=function(){var u;(u=o.getCurrentLayer())===null||u===void 0||u.setNeedsRedraw()},i.deck&&i.deck.eventManager.on({pointermove:this.state.onMouseMove,pointerleave:this.state.onMouseMove})}},{key:"finalizeState",value:function(i,a){i.deck&&i.deck.eventManager.off({pointermove:this.state.onMouseMove,pointerleave:this.state.onMouseMove})}}]),e}(Gt);(0,f2.default)($_,"defaultProps",MLe);(0,f2.default)($_,"extensionName","BrushingExtension");var Vne=h(L()),Hne=h(N()),Wne=h(Y()),$ne=h(K()),p2=h(q()),q_=h(B());var Cne=h(B());function One(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Ene(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?One(Object(e),!0).forEach(function(n){(0,Cne.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):One(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var Mne=`
uniform DATAFILTER_TYPE filter_min;
uniform DATAFILTER_TYPE filter_softMin;
uniform DATAFILTER_TYPE filter_softMax;
uniform DATAFILTER_TYPE filter_max;
uniform bool filter_useSoftMargin;
uniform bool filter_enabled;
uniform bool filter_transformSize;

#ifdef NON_INSTANCED_MODEL
  #define DATAFILTER_ATTRIB filterValues
  #define DATAFILTER_ATTRIB_64LOW filterValues64Low
#else
  #define DATAFILTER_ATTRIB instanceFilterValues
  #define DATAFILTER_ATTRIB_64LOW instanceFilterValues64Low
#endif

attribute DATAFILTER_TYPE DATAFILTER_ATTRIB;
#ifdef DATAFILTER_DOUBLE
  attribute DATAFILTER_TYPE DATAFILTER_ATTRIB_64LOW;

  uniform DATAFILTER_TYPE filter_min64High;
  uniform DATAFILTER_TYPE filter_max64High;
#endif

varying float dataFilter_value;

float dataFilter_reduceValue(float value) {
  return value;
}
float dataFilter_reduceValue(vec2 value) {
  return min(value.x, value.y);
}
float dataFilter_reduceValue(vec3 value) {
  return min(min(value.x, value.y), value.z);
}
float dataFilter_reduceValue(vec4 value) {
  return min(min(value.x, value.y), min(value.z, value.w));
}
void dataFilter_setValue(DATAFILTER_TYPE valueFromMin, DATAFILTER_TYPE valueFromMax) {
  if (filter_enabled) {
    if (filter_useSoftMargin) {
      dataFilter_value = dataFilter_reduceValue(
        smoothstep(filter_min, filter_softMin, valueFromMin) *
        (1.0 - smoothstep(filter_softMax, filter_max, valueFromMax))
      );
    } else {
      dataFilter_value = dataFilter_reduceValue(
        step(filter_min, valueFromMin) * step(valueFromMax, filter_max)
      );
    }
  } else {
    dataFilter_value = 1.0;
  }
}
`,Ine=`
uniform bool filter_transformColor;
varying float dataFilter_value;
`;function Rne(t){if(!t||!("extensions"in t))return{};var r=t.filterRange,e=r===void 0?[-1,1]:r,n=t.filterEnabled,i=n===void 0?!0:n,a=t.filterTransformSize,o=a===void 0?!0:a,s=t.filterTransformColor,u=s===void 0?!0:s,l=t.filterSoftRange||e;return Ene(Ene({},Number.isFinite(e[0])?{filter_min:e[0],filter_softMin:l[0],filter_softMax:l[1],filter_max:e[1]}:{filter_min:e.map(function(f){return f[0]}),filter_softMin:l.map(function(f){return f[0]}),filter_softMax:l.map(function(f){return f[1]}),filter_max:e.map(function(f){return f[1]})}),{},{filter_enabled:i,filter_useSoftMargin:Boolean(t.filterSoftRange),filter_transformSize:i&&o,filter_transformColor:i&&u})}function ILe(t){if(!t||!("extensions"in t))return{};var r=Rne(t);if(Number.isFinite(r.filter_min)){var e=Math.fround(r.filter_min);r.filter_min-=e,r.filter_softMin-=e,r.filter_min64High=e;var n=Math.fround(r.filter_max);r.filter_max-=n,r.filter_softMax-=n,r.filter_max64High=n}else{var i=r.filter_min.map(Math.fround);r.filter_min=r.filter_min.map(function(o,s){return o-i[s]}),r.filter_softMin=r.filter_softMin.map(function(o,s){return o-i[s]}),r.filter_min64High=i;var a=r.filter_max.map(Math.fround);r.filter_max=r.filter_max.map(function(o,s){return o-a[s]}),r.filter_softMax=r.filter_softMax.map(function(o,s){return o-a[s]}),r.filter_max64High=a}return r}var Lne={"vs:#main-start":`
    #ifdef DATAFILTER_DOUBLE
      dataFilter_setValue(
        DATAFILTER_ATTRIB - filter_min64High + DATAFILTER_ATTRIB_64LOW,
        DATAFILTER_ATTRIB - filter_max64High + DATAFILTER_ATTRIB_64LOW
      );
    #else
      dataFilter_setValue(DATAFILTER_ATTRIB, DATAFILTER_ATTRIB);
    #endif
  `,"vs:#main-end":`
    if (dataFilter_value == 0.0) {
      gl_Position = vec4(0.);
    }
  `,"vs:DECKGL_FILTER_SIZE":`
    if (filter_transformSize) {
      size = size * dataFilter_value;
    }
  `,"fs:DECKGL_FILTER_COLOR":`
    if (dataFilter_value == 0.0) discard;
    if (filter_transformColor) {
      color.a *= dataFilter_value;
    }
  `},kne={name:"data-filter",vs:Mne,fs:Ine,inject:Lne,getUniforms:Rne},Bne={name:"data-filter-fp64",vs:Mne,fs:Ine,inject:Lne,getUniforms:ILe};var c2=h(B());function Fne(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function RLe(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Fne(Object(e),!0).forEach(function(n){(0,c2.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Fne(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var LLe=`#define SHADER_NAME data-filter-vertex-shader

#ifdef FLOAT_TARGET
  attribute float filterIndices;
  attribute float filterPrevIndices;
#else
  attribute vec2 filterIndices;
  attribute vec2 filterPrevIndices;
#endif

varying vec4 vColor;
const float component = 1.0 / 255.0;

void main() {
  #ifdef FLOAT_TARGET
    dataFilter_value *= float(filterIndices != filterPrevIndices);
    gl_Position = vec4(0.0, 0.0, 0.0, 1.0);
    vColor = vec4(0.0, 0.0, 0.0, 1.0);
  #else
    // Float texture is not supported: pack result into 4 channels x 256 px x 64px
    dataFilter_value *= float(filterIndices.x != filterPrevIndices.x);
    float col = filterIndices.x;
    float row = filterIndices.y * 4.0;
    float channel = floor(row);
    row = fract(row);
    vColor = component * vec4(bvec4(channel == 0.0, channel == 1.0, channel == 2.0, channel == 3.0));
    gl_Position = vec4(col * 2.0 - 1.0, row * 2.0 - 1.0, 0.0, 1.0);
  #endif
  gl_PointSize = 1.0;
}
`,kLe=`#define SHADER_NAME data-filter-fragment-shader
precision highp float;

varying vec4 vColor;

void main() {
  if (dataFilter_value < 0.5) {
    discard;
  }
  gl_FragColor = vColor;
}
`;function Dne(t){return Boolean(t.getExtension("EXT_float_blend")&&(t.getExtension("EXT_color_buffer_float")||t.getExtension("WEBGL_color_buffer_float")))}function Nne(t,r){return r?new Re(t,{width:1,height:1,attachments:(0,c2.default)({},36064,new we(t,{format:ce(t)?34836:6408,type:5126,mipmaps:!1}))}):new Re(t,{width:256,height:64,depth:!1})}function jne(t,r,e){return r.defines.NON_INSTANCED_MODEL=1,e&&(r.defines.FLOAT_TARGET=1),new Ce(t,RLe({id:"data-filter-aggregation-model",vertexCount:1,isInstanced:!1,drawMode:0,vs:LLe,fs:kLe},r))}var Une={blend:!0,blendFunc:[1,1,1,1],blendEquation:[32774,32774],depthTest:!1};function Gne(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function X_(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Gne(Object(e),!0).forEach(function(n){(0,q_.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Gne(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function FLe(t){var r=DLe();return function(){var n=(0,p2.default)(t),i;if(r){var a=(0,p2.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,$ne.default)(this,i)}}function DLe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var NLe={getFilterValue:{type:"accessor",value:0},onFilteredItemsChange:{type:"function",value:null,optional:!0},filterEnabled:!0,filterRange:[-1,1],filterSoftRange:null,filterTransformSize:!0,filterTransformColor:!0},zne={1:"float",2:"vec2",3:"vec3",4:"vec4"},Y_=function(t){(0,Wne.default)(e,t);var r=FLe(e);function e(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.filterSize,a=i===void 0?1:i,o=n.fp64,s=o===void 0?!1:o,u=n.countItems,l=u===void 0?!1:u;if((0,Vne.default)(this,e),!zne[a])throw new Error("filterSize out of range");return r.call(this,{filterSize:a,fp64:s,countItems:l})}return(0,Hne.default)(e,[{key:"getShaders",value:function(i){var a=i.opts,o=a.filterSize,s=a.fp64;return{modules:[s?Bne:kne],defines:{DATAFILTER_TYPE:zne[o],DATAFILTER_DOUBLE:Boolean(s)}}}},{key:"initializeState",value:function(i,a){var o=this.getAttributeManager();o&&o.add({filterValues:{size:a.opts.filterSize,type:a.opts.fp64?5130:5126,accessor:"getFilterValue",shaderAttributes:{filterValues:{divisor:0},instanceFilterValues:{divisor:1}}}});var s=this.context.gl;if(o&&a.opts.countItems){var u=Dne(s);o.add({filterIndices:{size:u?1:2,vertexOffset:1,type:5121,normalized:!0,accessor:function(p,d){var v=d.index,m=p&&p.__source?p.__source.index:v;return u?(m+1)%255:[(m+1)%255,Math.floor(m/255)%255]},shaderAttributes:{filterPrevIndices:{vertexOffset:0},filterIndices:{vertexOffset:1}}}});var l=Nne(s,u),f=jne(s,a.getShaders.call(this,a),u);this.setState({filterFBO:l,filterModel:f})}}},{key:"updateState",value:function(i){var a=i.props,o=i.oldProps;if(this.state.filterModel){var s=this.getAttributeManager(),u=s.attributes.filterValues.needsUpdate()||a.filterEnabled!==o.filterEnabled||a.filterRange!==o.filterRange||a.filterSoftRange!==o.filterSoftRange;u&&this.setState({filterNeedsUpdate:u})}}},{key:"draw",value:function(i,a){var o=this.state,s=o.filterFBO,u=o.filterModel,l=o.filterNeedsUpdate,f=this.props.onFilteredItemsChange;if(l&&f&&u){var c=this.getAttributeManager(),p=c.attributes,d=p.filterValues,v=p.filterIndices;u.setVertexCount(this.getNumInstances());var m=this.context.gl;wn(m,{framebuffer:s,color:[0,0,0,0]}),u.updateModuleSettings(i.moduleParameters).setAttributes(X_(X_({},d.getShaderAttributes()),v&&v.getShaderAttributes())).draw({framebuffer:s,parameters:X_(X_({},Une),{},{viewport:[0,0,s.width,s.height]})});for(var g=ei(s),y=0,_=0;_<g.length;_++)y+=g[_];f({id:this.id,count:y}),this.state.filterNeedsUpdate=!1}}},{key:"finalizeState",value:function(){var i=this.state,a=i.filterFBO,o=i.filterModel;a&&(a.color.delete(),a.delete(),o.delete())}}]),e}(Gt);(0,q_.default)(Y_,"defaultProps",NLe);(0,q_.default)(Y_,"extensionName","DataFilterExtension");var qne=h(L()),Yne=h(N()),Kne=h(Y()),Zne=h(K()),h2=h(q()),Jne=h(B());var Xne=`
const vec2 WORLD_SCALE_FP64 = vec2(81.4873275756836, 0.0000032873668232014097);

uniform vec2 project_uViewProjectionMatrixFP64[16];
void mercatorProject_fp64(vec4 lnglat_fp64, out vec2 out_val[2]) {

#if defined(NVIDIA_FP64_WORKAROUND)
  out_val[0] = sum_fp64(radians_fp64(lnglat_fp64.xy), PI_FP64 * ONE);
#else
  out_val[0] = sum_fp64(radians_fp64(lnglat_fp64.xy), PI_FP64);
#endif
  out_val[1] = sum_fp64(PI_FP64,
    log_fp64(tan_fp64(sum_fp64(PI_4_FP64, radians_fp64(lnglat_fp64.zw) / 2.0))));
  return;
}

void project_position_fp64(vec4 position_fp64, out vec2 out_val[2]) {
  vec2 pos_fp64[2];
  mercatorProject_fp64(position_fp64, pos_fp64);
  out_val[0] = mul_fp64(pos_fp64[0], WORLD_SCALE_FP64);
  out_val[1] = mul_fp64(pos_fp64[1], WORLD_SCALE_FP64);

  return;
}

void project_position_fp64(vec2 position, vec2 position64xyLow, out vec2 out_val[2]) {
  vec4 position64xy = vec4(
    position.x, position64xyLow.x,
    position.y, position64xyLow.y);

  project_position_fp64(position64xy, out_val);
}

vec4 project_common_position_to_clipspace_fp64(vec2 vertex_pos_modelspace[4]) {
  vec2 vertex_pos_clipspace[4];
  mat4_vec4_mul_fp64(project_uViewProjectionMatrixFP64, vertex_pos_modelspace,
    vertex_pos_clipspace);
  return vec4(
    vertex_pos_clipspace[0].x,
    vertex_pos_clipspace[1].x,
    vertex_pos_clipspace[2].x,
    vertex_pos_clipspace[3].x
    );
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64xyLow, vec3 offset, out vec4 commonPosition
) {
  vec2 offset64[4];
  vec4_fp64(vec4(offset, 0.0), offset64);

  float z = project_size(position.z);
  vec2 projectedPosition64xy[2];
  project_position_fp64(position.xy, position64xyLow.xy, projectedPosition64xy);

  vec2 commonPosition64[4];
  commonPosition64[0] = sum_fp64(offset64[0], projectedPosition64xy[0]);
  commonPosition64[1] = sum_fp64(offset64[1], projectedPosition64xy[1]);
  commonPosition64[2] = sum_fp64(offset64[2], vec2(z, 0.0));
  commonPosition64[3] = vec2(1.0, 0.0);

  commonPosition = vec4(projectedPosition64xy[0].x, projectedPosition64xy[1].x, z, 1.0);

  return project_common_position_to_clipspace_fp64(commonPosition64);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64xyLow, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(
    position, position64xyLow, offset, commonPosition
  );
}
`;var jLe=pl.fp64ify,ULe=pl.fp64ifyMatrix4,K_={name:"project64",dependencies:[Qt,pl],vs:Xne,getUniforms:zLe},GLe=qr(VLe);function zLe(t){if(t&&"viewport"in t){var r=t.viewport,e=r.viewProjectionMatrix,n=r.scale;return GLe({viewProjectionMatrix:e,scale:n})}return{}}function VLe(t){var r=t.viewProjectionMatrix,e=t.scale,n=ULe(r),i=jLe(e);return{project_uViewProjectionMatrixFP64:n,project64_uViewProjectionMatrix:n,project64_uScale:i}}function HLe(t){var r=WLe();return function(){var n=(0,h2.default)(t),i;if(r){var a=(0,h2.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Zne.default)(this,i)}}function WLe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var d2=function(t){(0,Kne.default)(e,t);var r=HLe(e);function e(){return(0,qne.default)(this,e),r.apply(this,arguments)}return(0,Yne.default)(e,[{key:"getShaders",value:function(){var i=this.props.coordinateSystem;if(i!==ue.LNGLAT&&i!==ue.DEFAULT)throw new Error("fp64: coordinateSystem must be LNGLAT");return{modules:[K_]}}}]),e}(Gt);(0,Jne.default)(d2,"extensionName","Fp64Extension");var tie=h(L()),rie=h(N()),nie=h(Y()),iie=h(K()),v2=h(q()),m2=h(B());var Qne={inject:{"vs:#decl":`
attribute vec2 instanceDashArrays;
attribute float instanceDashOffsets;
varying vec2 vDashArray;
varying float vDashOffset;
`,"vs:#main-end":`
vDashArray = instanceDashArrays;
vDashOffset = instanceDashOffsets / width.x;
`,"fs:#decl":`
uniform float dashAlignMode;
uniform float capType;
uniform bool dashGapPickable;
varying vec2 vDashArray;
varying float vDashOffset;

float round(float x) {
  return floor(x + 0.5);
}
`,"fs:#main-start":`
  float solidLength = vDashArray.x;
  float gapLength = vDashArray.y;
  float unitLength = solidLength + gapLength;

  float offset;

  if (unitLength > 0.0) {
    if (dashAlignMode == 0.0) {
      offset = vDashOffset;
    } else {
      unitLength = vPathLength / round(vPathLength / unitLength);
      offset = solidLength / 2.0;
    }

    float unitOffset = mod(clamp(vPathPosition.y, 0.0, vPathLength) + offset, unitLength);

    if (gapLength > 0.0 && unitOffset > solidLength) {
      if (capType <= 0.5) {
        if (!(dashGapPickable && picking_uActive)) {
          discard;
        }
      } else {
        float distToEnd = length(vec2(
          min(unitOffset - solidLength, unitLength - unitOffset),
          vPathPosition.x
        ));
        if (distToEnd > 1.0) {
          if (!(dashGapPickable && picking_uActive)) {
            discard;
          }
        }
      }
    }
  }
`}},eie={inject:{"vs:#decl":`
attribute float instanceOffsets;
`,"vs:DECKGL_FILTER_SIZE":`
  float offsetWidth = abs(instanceOffsets * 2.0) + 1.0;
  size *= offsetWidth;
`,"vCornerOffset = offsetVec;":`
  float offsetWidth = abs(instanceOffsets * 2.0) + 1.0;
  vec2 offsetCenter = -instanceOffsets * (isCap ? perp : miterVec * miterSize) * 2.0;
  vCornerOffset = vCornerOffset * offsetWidth - offsetCenter;
`,"fs:#main-start":`
  float isInside;
  isInside = step(-1.0, vPathPosition.x) * step(vPathPosition.x, 1.0);
  if (isInside == 0.0) {
    discard;
  }
`}};function $Le(t){var r=XLe();return function(){var n=(0,v2.default)(t),i;if(r){var a=(0,v2.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,iie.default)(this,i)}}function XLe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var qLe={getDashArray:{type:"accessor",value:[0,0]},getOffset:{type:"accessor",value:0},dashJustified:!1,dashGapPickable:!1},Z_=function(t){(0,nie.default)(e,t);var r=$Le(e);function e(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.dash,a=i===void 0?!1:i,o=n.offset,s=o===void 0?!1:o,u=n.highPrecisionDash,l=u===void 0?!1:u;return(0,tie.default)(this,e),r.call(this,{dash:a||l,offset:s,highPrecisionDash:l})}return(0,rie.default)(e,[{key:"isEnabled",value:function(i){return"pathTesselator"in i.state}},{key:"getShaders",value:function(i){if(!i.isEnabled(this))return null;var a={};return i.opts.dash&&(a=Ea(a,Qne)),i.opts.offset&&(a=Ea(a,eie)),a}},{key:"initializeState",value:function(i,a){var o=this.getAttributeManager();!o||!a.isEnabled(this)||(a.opts.dash&&o.addInstanced({instanceDashArrays:{size:2,accessor:"getDashArray"}}),a.opts.highPrecisionDash&&o.addInstanced({instanceDashOffsets:{size:1,accessor:"getPath",transform:a.getDashOffsets.bind(this)}}),a.opts.offset&&o.addInstanced({instanceOffsets:{size:1,accessor:"getOffset"}}))}},{key:"updateState",value:function(i,a){if(a.isEnabled(this)){var o={};a.opts.dash&&(o.dashAlignMode=this.props.dashJustified?1:0,o.dashGapPickable=Boolean(this.props.dashGapPickable)),this.state.model.setUniforms(o)}}},{key:"getDashOffsets",value:function(i){for(var a=[0],o=this.props.positionFormat==="XY"?2:3,s=Array.isArray(i[0]),u=s?i.length:i.length/o,l,f,c=0;c<u-1;c++)l=s?i[c]:i.slice(c*o,c*o+o),l=this.projectPosition(l),c>0&&(a[c]=a[c-1]+KD(f,l)),f=l;return a}}]),e}(Gt);(0,m2.default)(Z_,"defaultProps",qLe);(0,m2.default)(Z_,"extensionName","PathStyleExtension");var oie=h(L()),sie=h(N()),uie=h(Y()),lie=h(K()),g2=h(q()),J_=h(B());var YLe=`
#ifdef NON_INSTANCED_MODEL
  #define FILL_PATTERN_FRAME_ATTRIB fillPatternFrames
  #define FILL_PATTERN_SCALE_ATTRIB fillPatternScales
  #define FILL_PATTERN_OFFSET_ATTRIB fillPatternOffsets
#else
  #define FILL_PATTERN_FRAME_ATTRIB instanceFillPatternFrames
  #define FILL_PATTERN_SCALE_ATTRIB instanceFillPatternScales
  #define FILL_PATTERN_OFFSET_ATTRIB instanceFillPatternOffsets
#endif

attribute vec4 FILL_PATTERN_FRAME_ATTRIB;
attribute float FILL_PATTERN_SCALE_ATTRIB;
attribute vec2 FILL_PATTERN_OFFSET_ATTRIB;

uniform bool fill_patternEnabled;
uniform vec2 fill_patternTextureSize;

varying vec2 fill_uv;
varying vec4 fill_patternBounds;
varying vec4 fill_patternPlacement;
`,KLe=`
uniform bool fill_patternEnabled;
uniform bool fill_patternMask;
uniform sampler2D fill_patternTexture;
uniform vec2 fill_uvCoordinateOrigin;
uniform vec2 fill_uvCoordinateOrigin64Low;

varying vec4 fill_patternBounds;
varying vec4 fill_patternPlacement;
varying vec2 fill_uv;

const float FILL_UV_SCALE = 512.0 / 40000000.0;
`,ZLe={"vs:DECKGL_FILTER_GL_POSITION":`
    fill_uv = geometry.position.xy;
  `,"vs:DECKGL_FILTER_COLOR":`
    if (fill_patternEnabled) {
      fill_patternBounds = FILL_PATTERN_FRAME_ATTRIB / vec4(fill_patternTextureSize, fill_patternTextureSize);
      fill_patternPlacement.xy = FILL_PATTERN_OFFSET_ATTRIB;
      fill_patternPlacement.zw = FILL_PATTERN_SCALE_ATTRIB * FILL_PATTERN_FRAME_ATTRIB.zw;
    }
  `,"fs:DECKGL_FILTER_COLOR":`
    if (fill_patternEnabled) {
      vec2 scale = FILL_UV_SCALE * fill_patternPlacement.zw;
      vec2 patternUV = mod(mod(fill_uvCoordinateOrigin, scale) + fill_uvCoordinateOrigin64Low + fill_uv, scale) / scale;
      patternUV = mod(fill_patternPlacement.xy + patternUV, 1.0);

      vec2 texCoords = fill_patternBounds.xy + fill_patternBounds.zw * patternUV;

      vec4 patternColor = texture2D(fill_patternTexture, texCoords);
      color.a *= patternColor.a;
      if (!fill_patternMask) {
        color.rgb = patternColor.rgb;
      }
    }
  `};function JLe(t,r){if(!t)return{};if("fillPatternTexture"in t){var e=t.fillPatternTexture;return{fill_patternTexture:e,fill_patternTextureSize:[e.width,e.height]}}if("viewport"in t){var n=t.fillPatternMask,i=n===void 0?!0:n,a=t.fillPatternEnabled,o=a===void 0?!0:a,s=r,u=s.project_uCommonOrigin,l=[oi(u[0]),oi(u[1])];return{fill_uvCoordinateOrigin:u.slice(0,2),fill_uvCoordinateOrigin64Low:l,fill_patternMask:i,fill_patternEnabled:o}}return{}}var aie={name:"fill-pattern",vs:YLe,fs:KLe,inject:ZLe,dependencies:[Qt],getUniforms:JLe};function QLe(t){var r=eke();return function(){var n=(0,g2.default)(t),i;if(r){var a=(0,g2.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lie.default)(this,i)}}function eke(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var tke={fillPatternEnabled:!0,fillPatternAtlas:{type:"image",value:null,async:!0,parameters:(0,J_.default)({},10241,9729)},fillPatternMapping:{type:"object",value:{},async:!0},fillPatternMask:!0,getFillPattern:{type:"accessor",value:function(r){return r.pattern}},getFillPatternScale:{type:"accessor",value:1},getFillPatternOffset:{type:"accessor",value:[0,0]}},Q_=function(t){(0,uie.default)(e,t);var r=QLe(e);function e(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.pattern,a=i===void 0?!1:i;return(0,oie.default)(this,e),r.call(this,{pattern:a})}return(0,sie.default)(e,[{key:"isEnabled",value:function(i){return i.getAttributeManager()!==null&&!("pathTesselator"in i.state)}},{key:"getShaders",value:function(i){return i.isEnabled(this)?{modules:[i.opts.pattern&&aie].filter(Boolean)}:null}},{key:"initializeState",value:function(i,a){if(a.isEnabled(this)){var o=this.getAttributeManager();a.opts.pattern&&o.add({fillPatternFrames:{size:4,accessor:"getFillPattern",transform:a.getPatternFrame.bind(this),shaderAttributes:{fillPatternFrames:{divisor:0},instanceFillPatternFrames:{divisor:1}}},fillPatternScales:{size:1,accessor:"getFillPatternScale",defaultValue:1,shaderAttributes:{fillPatternScales:{divisor:0},instanceFillPatternScales:{divisor:1}}},fillPatternOffsets:{size:2,accessor:"getFillPatternOffset",shaderAttributes:{fillPatternOffsets:{divisor:0},instanceFillPatternOffsets:{divisor:1}}}}),this.setState({emptyTexture:new we(this.context.gl,{data:new Uint8Array(4),width:1,height:1})})}}},{key:"updateState",value:function(i,a){var o=i.props,s=i.oldProps;a.isEnabled(this)&&o.fillPatternMapping&&o.fillPatternMapping!==s.fillPatternMapping&&this.getAttributeManager().invalidate("getFillPattern")}},{key:"draw",value:function(i,a){if(a.isEnabled(this)){var o=this.props.fillPatternAtlas;this.setModuleParameters({fillPatternTexture:o||this.state.emptyTexture})}}},{key:"finalizeState",value:function(){var i=this.state.emptyTexture;i?.delete()}},{key:"getPatternFrame",value:function(i){var a=this.getCurrentLayer().props.fillPatternMapping,o=a&&a[i];return o?[o.x,o.y,o.width,o.height]:[0,0,0,0]}}]),e}(Gt);(0,J_.default)(Q_,"defaultProps",tke);(0,J_.default)(Q_,"extensionName","FillStyleExtension");var fie=h(L()),cie=h(N()),pie=h(Y()),hie=h(K()),y2=h(q()),_2=h(B());function rke(t){var r=nke();return function(){var n=(0,y2.default)(t),i;if(r){var a=(0,y2.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,hie.default)(this,i)}}function nke(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ike={clipBounds:[0,0,1,1],clipByInstance:void 0},die=`
uniform vec4 clip_bounds;

bool clip_isInBounds(vec2 position) {
  return position.x >= clip_bounds[0] && position.y >= clip_bounds[1] && position.x < clip_bounds[2] && position.y < clip_bounds[3];
}
`,ake={name:"clip-vs",vs:die},oke={"vs:#decl":`
varying float clip_isVisible;
`,"vs:DECKGL_FILTER_GL_POSITION":`
  clip_isVisible = float(clip_isInBounds(geometry.worldPosition.xy));
`,"fs:#decl":`
varying float clip_isVisible;
`,"fs:DECKGL_FILTER_COLOR":`
  if (clip_isVisible < 0.5) discard;
`},ske={name:"clip-fs",fs:die},uke={"vs:#decl":`
varying vec2 clip_commonPosition;
`,"vs:DECKGL_FILTER_GL_POSITION":`
  clip_commonPosition = geometry.position.xy;
`,"fs:#decl":`
varying vec2 clip_commonPosition;
`,"fs:DECKGL_FILTER_COLOR":`
  if (!clip_isInBounds(clip_commonPosition)) discard;
`},Hf=function(t){(0,pie.default)(e,t);var r=rke(e);function e(){return(0,fie.default)(this,e),r.apply(this,arguments)}return(0,cie.default)(e,[{key:"getShaders",value:function(){var i="instancePositions"in this.getAttributeManager().attributes;return this.props.clipByInstance!==void 0&&(i=Boolean(this.props.clipByInstance)),this.state.clipByInstance=i,i?{modules:[ake],inject:oke}:{modules:[ske],inject:uke}}},{key:"draw",value:function(i){var a=i.uniforms,o=this.props.clipBounds;if(this.state.clipByInstance)a.clip_bounds=o;else{var s=this.projectPosition([o[0],o[1],0]),u=this.projectPosition([o[2],o[3],0]);a.clip_bounds=[Math.min(s[0],u[0]),Math.min(s[1],u[1]),Math.max(s[0],u[0]),Math.max(s[1],u[1])]}}}]),e}(Gt);(0,_2.default)(Hf,"defaultProps",ike);(0,_2.default)(Hf,"extensionName","ClipExtension");var Gie=h(L()),zie=h(N()),Vie=h(Y()),Hie=h(K()),S2=h(q()),T2=h(B());var lke=`
#ifdef NON_INSTANCED_MODEL
attribute float collisionPriorities;
#else
attribute float instanceCollisionPriorities;
#endif

uniform sampler2D collision_texture;
uniform bool collision_sort;
uniform bool collision_enabled;

vec2 collision_getCoords(vec4 position) {
  vec4 collision_clipspace = project_common_position_to_clipspace(position);
  return (1.0 + collision_clipspace.xy / collision_clipspace.w) / 2.0;
}

float collision_match(vec2 tex, vec3 pickingColor) {
  vec4 collision_pickingColor = texture2D(collision_texture, tex);
  float delta = dot(abs(collision_pickingColor.rgb - pickingColor), vec3(1.0));
  float e = 0.001;
  return step(delta, e);
}

float collision_isVisible(vec2 texCoords, vec3 pickingColor) {
  if (!collision_enabled) {
    return 1.0;
  }

  // Visibility test, sample area of 5x5 pixels in order to fade in/out.
  // Due to the locality, the lookups will be cached
  // This reduces the flicker present when objects are shown/hidden
  const int N = 2;
  float accumulator = 0.0;
  vec2 step = vec2(1.0 / project_uViewportSize);

  const float floatN = float(N);
  vec2 delta = -floatN * step;
  for(int i = -N; i <= N; i++) {
    delta.x = -step.x * floatN;
    for(int j = -N; j <= N; j++) {
      accumulator += collision_match(texCoords + delta, pickingColor);
      delta.x += step.x;
    }
    delta.y += step.y;
  }

  float W = 2.0 * floatN + 1.0;
  return pow(accumulator / (W * W), 2.2);
}
`,fke={"vs:#decl":`
  float collision_fade = 1.0;
`,"vs:DECKGL_FILTER_GL_POSITION":`
  if (collision_sort) {
    #ifdef NON_INSTANCED_MODEL
    float collisionPriority = collisionPriorities;
    #else
    float collisionPriority = instanceCollisionPriorities;
    #endif
    position.z = -0.001 * collisionPriority * position.w; // Support range -1000 -> 1000
  }

  if (collision_enabled) {
    vec4 collision_common_position = project_position(vec4(geometry.worldPosition, 1.0));
    vec2 collision_texCoords = collision_getCoords(collision_common_position);
    collision_fade = collision_isVisible(collision_texCoords, geometry.pickingColor / 255.0);
    if (collision_fade < 0.0001) {
      // Position outside clip space bounds to discard
      position = vec4(0.0, 0.0, 2.0, 1.0);
    }
  }
  `,"vs:DECKGL_FILTER_COLOR":`
  color.a *= collision_fade;
  `},cke=function(r,e){if(!r||!("dummyCollisionMap"in r))return{};var n=r.collisionFBO,i=r.drawToCollisionMap,a=r.dummyCollisionMap;return{collision_sort:Boolean(i),collision_texture:!i&&n?n:a}},vie={name:"collision",dependencies:[Qt],vs:lke,inject:fke,getUniforms:cke};var Nie=h(L()),jie=h(N()),Cr=h(B());var yie=h(B()),_ie=h(L()),bie=h(N()),xie=h(Y()),Aie=h(K()),b2=h(q());function mie(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function gie(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?mie(Object(e),!0).forEach(function(n){(0,yie.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):mie(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function pke(t){var r=hke();return function(){var n=(0,b2.default)(t),i;if(r){var a=(0,b2.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Aie.default)(this,i)}}function hke(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Sie=function(t){(0,xie.default)(e,t);var r=pke(e);function e(){return(0,_ie.default)(this,e),r.apply(this,arguments)}return(0,bie.default)(e,[{key:"renderCollisionMap",value:function(i,a){var o=this,s=this.gl,u=1;return Le(s,{scissorTest:!0,scissor:[u,u,i.width-2*u,i.height-2*u],clearColor:[0,0,0,0],blend:!1,depthTest:!0,depthRange:[0,1]},function(){return o.render(gie(gie({},a),{},{target:i,pass:"collision"}))})}},{key:"getModuleParameters",value:function(){return{drawToCollisionMap:!0,pickingActive:1,pickingAttribute:!1,lightSources:{}}}}]),e}(Xr);var Bie=h(L()),Fie=h(N()),_i=h(B());var Pie=h(L()),Oie=h(N()),x2=h(be()),Eie=h(Ee()),Cie=h(Y()),Mie=h(K()),eb=h(q()),eo=h(B());function Tie(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function wie(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Tie(Object(e),!0).forEach(function(n){(0,eo.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Tie(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function dke(t){var r=vke();return function(){var n=(0,eb.default)(t),i;if(r){var a=(0,eb.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Mie.default)(this,i)}}function vke(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Iie=function(t){(0,Cie.default)(e,t);var r=dke(e);function e(n,i){var a,o;(0,Pie.default)(this,e),o=r.call(this,n,i),(0,eo.default)((0,x2.default)(o),"maskMap",void 0),(0,eo.default)((0,x2.default)(o),"fbo",void 0);var s=i.mapSize,u=s===void 0?2048:s;return o.maskMap=new we(n,{width:u,height:u,parameters:(a={},(0,eo.default)(a,10241,9729),(0,eo.default)(a,10240,9729),(0,eo.default)(a,10242,33071),(0,eo.default)(a,10243,33071),a)}),o.fbo=new Re(n,{id:"maskmap",width:u,height:u,attachments:(0,eo.default)({},36064,o.maskMap)}),o}return(0,Oie.default)(e,[{key:"render",value:function(i){var a=this,o=this.gl,s=[!1,!1,!1,!1];return s[i.channel]=!0,Le(o,{clearColor:[255,255,255,255],blend:!0,blendFunc:[0,1],blendEquation:32778,colorMask:s,depthTest:!1},function(){return(0,Eie.default)((0,eb.default)(e.prototype),"render",a).call(a,wie(wie({},i),{},{target:a.fbo,pass:"mask"}))})}},{key:"shouldDrawLayer",value:function(i){return i.props.operation.includes("mask")}},{key:"delete",value:function(){this.fbo.delete(),this.maskMap.delete()}}]),e}(Xr);var Lie=h(me());function mke(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=gke(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function gke(t,r){if(t){if(typeof t=="string")return Rie(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Rie(t,r)}}function Rie(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function Wf(t,r){var e=[1/0,1/0,-1/0,-1/0],n=mke(t),i;try{for(n.s();!(i=n.n()).done;){var a=i.value,o=a.getBounds();if(o){var s=a.projectPosition(o[0],{viewport:r,autoOffset:!1}),u=a.projectPosition(o[1],{viewport:r,autoOffset:!1});e[0]=Math.min(e[0],s[0]),e[1]=Math.min(e[1],s[1]),e[2]=Math.max(e[2],u[0]),e[3]=Math.max(e[3],u[1])}}}catch(l){n.e(l)}finally{n.f()}return Number.isFinite(e[0])?e:null}var yke=2048;function $f(t){var r=t.bounds,e=t.viewport,n=t.border,i=n===void 0?0:n,a=e.isGeospatial;if(r[2]<=r[0]||r[3]<=r[1])return null;var o=e.unprojectPosition([(r[0]+r[2])/2,(r[1]+r[3])/2,0]),s=t.width,u=t.height,l=t.zoom;if(l===void 0){s=s-i*2,u=u-i*2;var f=Math.min(s/(r[2]-r[0]),u/(r[3]-r[1]));l=Math.min(Math.log2(f),20)}else if(!s||!u){var c=Math.pow(2,l);s=Math.round(Math.abs(r[2]-r[0])*c),u=Math.round(Math.abs(r[3]-r[1])*c);var p=yke-i*2;if(s>p||u>p){var d=p/Math.max(s,u);s=Math.round(s*d),u=Math.round(u*d),l+=Math.log2(d)}}return a?new Kr({id:e.id,x:i,y:i,width:s,height:u,longitude:o[0],latitude:o[1],zoom:l,orthographic:!0}):new Ql({id:e.id,x:i,y:i,width:s,height:u,target:o,zoom:l,flipY:!1})}function _ke(t,r){var e;if(r&&r.length===2){var n=(0,Lie.default)(r,2),i=n[0],a=n[1],o=t.getBounds({z:i}),s=t.getBounds({z:a});e=[Math.min(o[0],s[0]),Math.min(o[1],s[1]),Math.max(o[2],s[2]),Math.max(o[3],s[3])]}else e=t.getBounds();var u=t.projectPosition(e.slice(0,2)),l=t.projectPosition(e.slice(2,4));return[u[0],u[1],l[0],l[1]]}function Xf(t,r,e){if(!t)return[0,0,1,1];var n=_ke(r,e),i=bke(n);return t[2]-t[0]<=i[2]-i[0]&&t[3]-t[1]<=i[3]-i[1]?t:[Math.max(t[0],i[0]),Math.max(t[1],i[1]),Math.min(t[2],i[2]),Math.min(t[3],i[3])]}function bke(t){var r=t[2]-t[0],e=t[3]-t[1],n=(t[0]+t[2])/2,i=(t[1]+t[3])/2;return[n-r,i-e,n+r,i+e]}function xke(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=Ake(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function Ake(t,r){if(t){if(typeof t=="string")return kie(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return kie(t,r)}}function kie(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var tb=function(){function t(){(0,Bie.default)(this,t),(0,_i.default)(this,"id","mask-effect"),(0,_i.default)(this,"props",null),(0,_i.default)(this,"useInPicking",!0),(0,_i.default)(this,"order",0),(0,_i.default)(this,"dummyMaskMap",void 0),(0,_i.default)(this,"channels",[]),(0,_i.default)(this,"masks",null),(0,_i.default)(this,"maskPass",void 0),(0,_i.default)(this,"maskMap",void 0),(0,_i.default)(this,"lastViewport",void 0)}return(0,Fie.default)(t,[{key:"preRender",value:function(e,n){var i=n.layers,a=n.layerFilter,o=n.viewports,s=n.onViewportActive,u=n.views,l=n.isPicking,f=!1;if(this.dummyMaskMap||(this.dummyMaskMap=new we(e,{width:1,height:1})),l)return{didRender:f};var c=i.filter(function(y){return y.props.visible&&y.props.operation.includes("mask")});if(c.length===0)return this.masks=null,this.channels.length=0,{didRender:f};this.masks={},this.maskPass||(this.maskPass=new Iie(e,{id:"default-mask"}),this.maskMap=this.maskPass.maskMap);var p=this._sortMaskChannels(c),d=o[0],v=!this.lastViewport||!this.lastViewport.equals(d);if(d.resolution!==void 0)return J.warn("MaskExtension is not supported in GlobeView")(),{didRender:f};for(var m in p){var g=this._renderChannel(p[m],{layerFilter:a,onViewportActive:s,views:u,viewport:d,viewportChanged:v});f||(f=g)}return{didRender:f}}},{key:"_renderChannel",value:function(e,n){var i=n.layerFilter,a=n.onViewportActive,o=n.views,s=n.viewport,u=n.viewportChanged,l=!1,f=this.channels[e.index];if(!f)return l;var c=e===f||e.layers.length!==f.layers.length||e.layers.some(function(g,y){return g!==f.layers[y]||g.props.transitions})||e.layerBounds.some(function(g,y){return g!==f.layerBounds[y]});if(e.bounds=f.bounds,e.maskBounds=f.maskBounds,this.channels[e.index]=e,c||u){this.lastViewport=s;var p=Wf(e.layers,s);if(e.bounds=p&&Xf(p,s),c||!tt(e.bounds,f.bounds)){var d=this.maskPass,v=this.maskMap,m=p&&$f({bounds:e.bounds,viewport:s,width:v.width,height:v.height,border:1});e.maskBounds=m?m.getBounds():[0,0,1,1],d.render({pass:"mask",channel:e.index,layers:e.layers,layerFilter:i,viewports:m?[m]:[],onViewportActive:a,views:o,moduleParameters:{devicePixelRatio:1}}),l=!0}}return this.masks[e.id]={index:e.index,bounds:e.maskBounds,coordinateOrigin:e.coordinateOrigin,coordinateSystem:e.coordinateSystem},l}},{key:"_sortMaskChannels",value:function(e){var n=this,i={},a=0,o=xke(e),s;try{var u=function(){var m=s.value,g=m.root.id,y=i[g];if(!y){if(++a>4)return J.warn("Too many mask layers. The max supported is 4")(),"continue";y={id:g,index:n.channels.findIndex(function(_){return _?.id===g}),layers:[],layerBounds:[],coordinateOrigin:m.root.props.coordinateOrigin,coordinateSystem:m.root.props.coordinateSystem},i[g]=y}y.layers.push(m),y.layerBounds.push(m.getBounds())};for(o.s();!(s=o.n()).done;)var l=u()}catch(v){o.e(v)}finally{o.f()}for(var f=0;f<4;f++){var c=this.channels[f];(!c||!(c.id in i))&&(this.channels[f]=null)}for(var p in i){var d=i[p];d.index<0&&(d.index=this.channels.findIndex(function(v){return!v}),this.channels[d.index]=d)}return i}},{key:"getModuleParameters",value:function(){return{maskMap:this.masks?this.maskMap:this.dummyMaskMap,maskChannels:this.masks}}},{key:"cleanup",value:function(){this.dummyMaskMap&&(this.dummyMaskMap.delete(),this.dummyMaskMap=void 0),this.maskPass&&(this.maskPass.delete(),this.maskPass=void 0,this.maskMap=void 0),this.lastViewport=void 0,this.masks=null,this.channels.length=0}}]),t}();function Ske(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=Tke(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function Tke(t,r){if(t){if(typeof t=="string")return Die(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Die(t,r)}}function Die(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var A2=2,Uie=function(){function t(){(0,Nie.default)(this,t),(0,Cr.default)(this,"id","collision-filter-effect"),(0,Cr.default)(this,"props",null),(0,Cr.default)(this,"useInPicking",!0),(0,Cr.default)(this,"order",1),(0,Cr.default)(this,"channels",{}),(0,Cr.default)(this,"collisionFilterPass",void 0),(0,Cr.default)(this,"collisionFBOs",{}),(0,Cr.default)(this,"dummyCollisionMap",void 0),(0,Cr.default)(this,"lastViewport",void 0)}return(0,jie.default)(t,[{key:"preRender",value:function(e,n){var i,a=n.effects,o=n.layers,s=n.layerFilter,u=n.viewports,l=n.onViewportActive,f=n.views,c=n.isPicking,p=n.preRenderStats,d=p===void 0?{}:p;if(this.dummyCollisionMap||(this.dummyCollisionMap=new we(e,{width:1,height:1})),!c){var v=o.filter(function(P){var O=P.props,C=O.visible,T=O.collisionEnabled;return C&&T});if(v.length===0){this.channels={};return}this.collisionFilterPass||(this.collisionFilterPass=new Sie(e,{id:"default-collision-filter"}));var m=a?.filter(function(P){return P.constructor===tb}),g=(i=d["mask-effect"])===null||i===void 0?void 0:i.didRender,y=this._groupByCollisionGroup(e,v),_=u[0],b=!this.lastViewport||!this.lastViewport.equals(_)||g;for(var x in y){var A=this.collisionFBOs[x],S=y[x];A.resize({width:e.canvas.width/A2,height:e.canvas.height/A2}),this._render(S,{effects:m,layerFilter:s,onViewportActive:l,views:f,viewport:_,viewportChanged:b})}}}},{key:"_render",value:function(e,n){var i=n.effects,a=n.layerFilter,o=n.onViewportActive,s=n.views,u=n.viewport,l=n.viewportChanged,f=e.collisionGroup,c=this.channels[f];if(c){var p=l||e===c||!Lt(c.layers,e.layers,1)||e.layerBounds.some(function(v,m){return!tt(v,c.layerBounds[m])})||e.allLayersLoaded!==c.allLayersLoaded||e.layers.some(function(v){return v.props.transitions});if(this.channels[f]=e,p){this.lastViewport=u;var d=this.collisionFBOs[f];this.collisionFilterPass.renderCollisionMap(d,{pass:"collision-filter",isPicking:!0,layers:e.layers,effects:i,layerFilter:a,viewports:u?[u]:[],onViewportActive:o,views:s,moduleParameters:{dummyCollisionMap:this.dummyCollisionMap,devicePixelRatio:_r(d.gl)/A2}})}}}},{key:"_groupByCollisionGroup",value:function(e,n){var i={},a=Ske(n),o;try{for(a.s();!(o=a.n()).done;){var s=o.value,u=s.props.collisionGroup,l=i[u];l||(l={collisionGroup:u,layers:[],layerBounds:[],allLayersLoaded:!0},i[u]=l),l.layers.push(s),l.layerBounds.push(s.getBounds()),s.isLoaded||(l.allLayersLoaded=!1)}}catch(g){a.e(g)}finally{a.f()}for(var f=0,c=Object.keys(i);f<c.length;f++){var p=c[f];this.collisionFBOs[p]||this.createFBO(e,p),this.channels[p]||(this.channels[p]=i[p])}for(var d=0,v=Object.keys(this.collisionFBOs);d<v.length;d++){var m=v[d];i[m]||this.destroyFBO(m)}return i}},{key:"getModuleParameters",value:function(e){var n=e.props.collisionGroup,i=this.collisionFBOs,a=this.dummyCollisionMap;return{collisionFBO:i[n],dummyCollisionMap:a}}},{key:"cleanup",value:function(){this.dummyCollisionMap&&(this.dummyCollisionMap.delete(),this.dummyCollisionMap=void 0),this.channels={};for(var e=0,n=Object.keys(this.collisionFBOs);e<n.length;e++){var i=n[e];this.destroyFBO(i)}this.collisionFBOs={},this.lastViewport=void 0}},{key:"createFBO",value:function(e,n){var i,a,o=e.canvas,s=o.width,u=o.height,l=new we(e,{width:s,height:u,parameters:(i={},(0,Cr.default)(i,10241,9728),(0,Cr.default)(i,10240,9728),(0,Cr.default)(i,10242,33071),(0,Cr.default)(i,10243,33071),i)}),f=new Fr(e,{format:33189,width:s,height:u});this.collisionFBOs[n]=new Re(e,{id:"Collision-".concat(n),width:s,height:u,attachments:(a={},(0,Cr.default)(a,36064,l),(0,Cr.default)(a,36096,f),a)})}},{key:"destroyFBO",value:function(e){for(var n=this.collisionFBOs[e],i=0,a=Object.values(n.attachments);i<a.length;i++){var o=a[i];o.delete()}n.delete(),delete this.collisionFBOs[e]}}]),t}();function wke(t){var r=Pke();return function(){var n=(0,S2.default)(t),i;if(r){var a=(0,S2.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Hie.default)(this,i)}}function Pke(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Oke={getCollisionPriority:{type:"accessor",value:0},collisionEnabled:!0,collisionGroup:{type:"string",value:"default"},collisionTestProps:{}},rb=function(t){(0,Vie.default)(e,t);var r=wke(e);function e(){return(0,Gie.default)(this,e),r.apply(this,arguments)}return(0,zie.default)(e,[{key:"getShaders",value:function(){return{modules:[vie]}}},{key:"draw",value:function(i){var a=i.uniforms,o=i.context,s=i.moduleParameters,u=this.props.collisionEnabled,l=s.collisionFBO,f=s.drawToCollisionMap,c=u&&Boolean(l);a.collision_enabled=c,f&&(this.props=this.clone(this.props.collisionTestProps).props)}},{key:"initializeState",value:function(i,a){var o;if(this.getAttributeManager()!==null){(o=this.context.deck)===null||o===void 0||o._addDefaultEffect(new Uie);var s=this.getAttributeManager();s.add({collisionPriorities:{size:1,accessor:"getCollisionPriority",shaderAttributes:{collisionPriorities:{divisor:0},instanceCollisionPriorities:{divisor:1}}}})}}},{key:"getNeedsPickingBuffer",value:function(){return this.props.collisionEnabled}}]),e}(Gt);(0,T2.default)(rb,"defaultProps",Oke);(0,T2.default)(rb,"extensionName","CollisionFilterExtension");var $ie=h(L()),Xie=h(N()),qie=h(Y()),Yie=h(K()),w2=h(q()),P2=h(B());var Eke=`
uniform vec4 mask_bounds;
uniform bool mask_maskByInstance;
vec2 mask_getCoords(vec4 position) {
  return (position.xy - mask_bounds.xy) / (mask_bounds.zw - mask_bounds.xy);
}
`,Cke=`
uniform sampler2D mask_texture;
uniform int mask_channel;
uniform bool mask_enabled;
uniform bool mask_inverted;
bool mask_isInBounds(vec2 texCoords) {
  if (!mask_enabled) {
    return true;
  }
  vec4 maskColor = texture2D(mask_texture, texCoords);
  float maskValue = 1.0;
  if (mask_channel == 0) {
    maskValue = maskColor.r;
  } else if (mask_channel == 1) {
    maskValue = maskColor.g;
  } else if (mask_channel == 2) {
    maskValue = maskColor.b;
  } else if (mask_channel == 3) {
    maskValue = maskColor.a;
  }

  if (mask_inverted) {
    return maskValue >= 0.5;
  } else {
    return maskValue < 0.5;
  }
}
`,Mke={"vs:#decl":`
varying vec2 mask_texCoords;
`,"vs:#main-end":`
   vec4 mask_common_position;
   if (mask_maskByInstance) {
     mask_common_position = project_position(vec4(geometry.worldPosition, 1.0));
   } else {
     mask_common_position = geometry.position;
   }
   mask_texCoords = mask_getCoords(mask_common_position);
`,"fs:#decl":`
varying vec2 mask_texCoords;
`,"fs:#main-start":`
  if (mask_enabled) {
    bool mask = mask_isInBounds(mask_texCoords);

    // Debug: show extent of render target
    // gl_FragColor = vec4(mask_texCoords, 0.0, 1.0);
    gl_FragColor = texture2D(mask_texture, mask_texCoords);

    if (!mask) discard;
  }
`},Ike=function(r){return r&&"maskMap"in r?{mask_texture:r.maskMap}:{}},Wie={name:"mask",dependencies:[Qt],vs:Eke,fs:Cke,inject:Mke,getUniforms:Ike};function Rke(t){var r=Lke();return function(){var n=(0,w2.default)(t),i;if(r){var a=(0,w2.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Yie.default)(this,i)}}function Lke(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var kke={maskId:"",maskByInstance:void 0,maskInverted:!1},nb=function(t){(0,qie.default)(e,t);var r=Rke(e);function e(){return(0,$ie.default)(this,e),r.apply(this,arguments)}return(0,Xie.default)(e,[{key:"initializeState",value:function(){var i;(i=this.context.deck)===null||i===void 0||i._addDefaultEffect(new tb)}},{key:"getShaders",value:function(){var i="instancePositions"in this.getAttributeManager().attributes;return this.props.maskByInstance!==void 0&&(i=Boolean(this.props.maskByInstance)),this.state.maskByInstance=i,{modules:[Wie]}}},{key:"draw",value:function(i){var a=i.uniforms,o=i.context,s=i.moduleParameters;a.mask_maskByInstance=this.state.maskByInstance;var u=this.props,l=u.maskId,f=u.maskInverted,c=s.maskChannels,p=o.viewport;if(c&&c[l]){var d=c[l],v=d.index,m=d.bounds,g=d.coordinateOrigin,y=c[l].coordinateSystem;a.mask_enabled=!0,a.mask_channel=v,a.mask_inverted=f,y===ue.DEFAULT&&(y=p.isGeospatial?ue.LNGLAT:ue.CARTESIAN);var _={modelMatrix:null,fromCoordinateOrigin:g,fromCoordinateSystem:y},b=this.projectPosition([m[0],m[1],0],_),x=this.projectPosition([m[2],m[3],0],_);a.mask_bounds=[b[0],b[1],x[0],x[1]]}else l&&J.warn("Could not find a mask layer with id: ".concat(l))(),a.mask_enabled=!1}}]),e}(Gt);(0,P2.default)(nb,"defaultProps",kke);(0,P2.default)(nb,"extensionName","MaskExtension");var Cae=h(L()),Mae=h(N()),Iae=h(Y()),Rae=h(K()),M2=h(q()),I2=h(B());var wae=h(me()),Pae=h(L()),Oae=h(N()),zn=h(B());var ia={NONE:0,WRITE_HEIGHT_MAP:1,USE_HEIGHT_MAP:2,USE_COVER:3,USE_COVER_ONLY:4,SKIP:5},Kie=Object.keys(ia).map(function(t){return"const float TERRAIN_MODE_".concat(t," = ").concat(ia[t],".0;")}).join(`
`),ib={name:"terrain",dependencies:[Qt],inject:{"vs:#decl":`
uniform float terrain_mode;
uniform sampler2D terrain_map;
uniform vec4 terrain_bounds;
varying vec3 commonPos;
`.concat(Kie,`
    `),"vs:#main-start":`
if (terrain_mode == TERRAIN_MODE_SKIP) {
  gl_Position = vec4(0.0);
  return;
}
`,"vs:DECKGL_FILTER_GL_POSITION":`
commonPos = geometry.position.xyz;
if (terrain_mode == TERRAIN_MODE_WRITE_HEIGHT_MAP) {
  vec2 texCoords = (commonPos.xy - terrain_bounds.xy) / terrain_bounds.zw;
  position = vec4(texCoords * 2.0 - 1.0, 0.0, 1.0);
  commonPos.z += project_uCommonOrigin.z;
}
if (terrain_mode == TERRAIN_MODE_USE_HEIGHT_MAP) {
  vec3 anchor = geometry.worldPosition;
  anchor.z = 0.0;
  vec3 anchorCommon = project_position(anchor);
  vec2 texCoords = (anchorCommon.xy - terrain_bounds.xy) / terrain_bounds.zw;
  if (texCoords.x >= 0.0 && texCoords.y >= 0.0 && texCoords.x <= 1.0 && texCoords.y <= 1.0) {
    float terrainZ = texture2D(terrain_map, texCoords).r;
    geometry.position.z += terrainZ;
    position = project_common_position_to_clipspace(geometry.position);
  }
}
    `,"fs:#decl":`
uniform float terrain_mode;
uniform sampler2D terrain_map;
uniform vec4 terrain_bounds;
varying vec3 commonPos;
`.concat(Kie,`
    `),"fs:#main-start":`
if (terrain_mode == TERRAIN_MODE_WRITE_HEIGHT_MAP) {
  gl_FragColor = vec4(commonPos.z, 0.0, 0.0, 1.0);
  return;
}
    `,"fs:DECKGL_FILTER_COLOR":`
if ((terrain_mode == TERRAIN_MODE_USE_COVER) || (terrain_mode == TERRAIN_MODE_USE_COVER_ONLY)) {
  vec2 texCoords = (commonPos.xy - terrain_bounds.xy) / terrain_bounds.zw;
  vec4 pixel = texture2D(terrain_map, texCoords);
  if (terrain_mode == TERRAIN_MODE_USE_COVER_ONLY) {
    color = pixel;
  } else {
    // pixel is premultiplied
    color = pixel + color * (1.0 - pixel.a);
  }
  return;
}
    `},getUniforms:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;if("dummyHeightMap"in r){var n=r.drawToTerrainHeightMap,i=r.heightMap,a=r.heightMapBounds,o=r.dummyHeightMap,s=r.terrainCover,u=r.useTerrainHeightMap,l=r.terrainSkipRender,f=e.project_uCommonOrigin,c=l?ia.SKIP:ia.NONE,p=o,d=null;if(n)c=ia.WRITE_HEIGHT_MAP,d=a;else if(u&&i)c=ia.USE_HEIGHT_MAP,p=i,d=a;else if(s){var v=r.pickingActive;p=v?s.getPickingFramebuffer():s.getRenderFramebuffer(),v&&(c=ia.SKIP),p?(c=c===ia.SKIP?ia.USE_COVER_ONLY:ia.USE_COVER,d=s.bounds):p=o}return{terrain_mode:c,terrain_map:p,terrain_bounds:d?[d[0]-f[0],d[1]-f[1],d[2]-d[0],d[3]-d[1]]:[0,0,0,0]}}return null}};var eae=h(L()),tae=h(N()),bi=h(B());var Cu=h(B());function Zie(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Jie(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Zie(Object(e),!0).forEach(function(n){(0,Cu.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Zie(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function Gd(t,r){var e;return new Re(t,{id:r.id,attachments:(0,Cu.default)({},36064,new we(t,Jie(Jie({},r.float&&{format:ce(t)?34836:6408,type:5126}),{},{mipmaps:!1,parameters:(e={},(0,Cu.default)(e,10241,9729),(0,Cu.default)(e,10240,9729),(0,Cu.default)(e,10242,33071),(0,Cu.default)(e,10243,33071),e)})))})}function Bke(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=Fke(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function Fke(t,r){if(t){if(typeof t=="string")return Qie(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Qie(t,r)}}function Qie(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var rae=function(){function t(r){(0,eae.default)(this,t),(0,bi.default)(this,"isDirty",!0),(0,bi.default)(this,"targetLayer",void 0),(0,bi.default)(this,"renderViewport",null),(0,bi.default)(this,"bounds",null),(0,bi.default)(this,"fbo",void 0),(0,bi.default)(this,"pickingFbo",void 0),(0,bi.default)(this,"layers",[]),(0,bi.default)(this,"tile",void 0),(0,bi.default)(this,"targetBounds",null),(0,bi.default)(this,"targetBoundsCommon",null),this.targetLayer=r,this.tile=nae(r)}return(0,tae.default)(t,[{key:"id",get:function(){return this.targetLayer.id}},{key:"isActive",get:function(){return Boolean(this.targetLayer.getCurrentLayer())}},{key:"shouldUpdate",value:function(e){var n=e.targetLayer,i=e.viewport,a=e.layers,o=e.layerNeedsRedraw;n&&(this.targetLayer=n);var s=i?this._updateViewport(i):!1,u=a?this._updateLayers(a):!1;if(o){var l=Bke(this.layers),f;try{for(l.s();!(f=l.n()).done;){var c=f.value;if(o[c]){u=!0;break}}}catch(p){l.e(p)}finally{l.f()}}return u||s}},{key:"_updateLayers",value:function(e){var n=!1;if(e=this.tile?Dke(this.tile,e):e,e.length!==this.layers.length)n=!0;else for(var i=0;i<e.length;i++){var a=e[i].id;if(a!==this.layers[i]){n=!0;break}}return n&&(this.layers=e.map(function(o){return o.id})),n}},{key:"_updateViewport",value:function(e){var n=this.targetLayer,i=!1;if(this.tile&&"boundingBox"in this.tile){if(!this.targetBounds){i=!0,this.targetBounds=this.tile.boundingBox;var a=e.projectPosition(this.targetBounds[0]),o=e.projectPosition(this.targetBounds[1]);this.targetBoundsCommon=[a[0],a[1],o[0],o[1]]}}else this.targetBounds!==n.getBounds()&&(i=!0,this.targetBounds=n.getBounds(),this.targetBoundsCommon=Wf([n],e));if(!this.targetBoundsCommon)return!1;var s=Math.ceil(e.zoom+.5);if(this.tile)this.bounds=this.targetBoundsCommon;else{var u,l=(u=this.renderViewport)===null||u===void 0?void 0:u.zoom;i=i||s!==l;var f=Xf(this.targetBoundsCommon,e),c=this.bounds;i=i||!c||f.some(function(p,d){return p!==c[d]}),this.bounds=f}return i&&(this.renderViewport=$f({bounds:this.bounds,zoom:s,viewport:e})),i}},{key:"getRenderFramebuffer",value:function(){return!this.renderViewport||this.layers.length===0?null:(this.fbo||(this.fbo=Gd(this.targetLayer.context.gl,{id:this.id})),this.fbo)}},{key:"getPickingFramebuffer",value:function(){return!this.renderViewport||this.layers.length===0&&!this.targetLayer.props.pickable?null:(this.pickingFbo||(this.pickingFbo=Gd(this.targetLayer.context.gl,{id:"".concat(this.id,"-picking")})),this.pickingFbo)}},{key:"filterLayers",value:function(e){var n=this;return e.filter(function(i){var a=i.id;return n.layers.includes(a)})}},{key:"delete",value:function(){var e=this.fbo,n=this.pickingFbo;e&&(e.texture.delete(),e.delete()),n&&(n.texture.delete(),n.delete())}}]),t}();function Dke(t,r){return r.filter(function(e){var n=nae(e);return n?Nke(t.boundingBox,n.boundingBox):!0})}function nae(t){for(;t;){var r=t.props.tile;if(r)return r;t=t.parent}return null}function Nke(t,r){return t&&r?t[0][0]<r[1][0]&&r[0][0]<t[1][0]&&t[0][1]<r[1][1]&&r[0][1]<t[1][1]:!1}var aae=h(B()),oae=h(L()),sae=h(N()),uae=h(Y()),lae=h(K()),O2=h(q());function iae(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function ab(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?iae(Object(e),!0).forEach(function(n){(0,aae.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):iae(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function jke(t){var r=Uke();return function(){var n=(0,O2.default)(t),i;if(r){var a=(0,O2.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lae.default)(this,i)}}function Uke(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var fae=function(t){(0,uae.default)(e,t);var r=jke(e);function e(){return(0,oae.default)(this,e),r.apply(this,arguments)}return(0,sae.default)(e,[{key:"getRenderableLayers",value:function(i,a){for(var o=a.layers,s=[],u=this._getDrawLayerParams(i,a,!0),l=0;l<o.length;l++){var f=o[l];!f.isComposite&&u[l].shouldDrawLayer&&s.push(f)}return s}},{key:"renderHeightMap",value:function(i,a){var o=this,s=i.getRenderFramebuffer(),u=i.renderViewport;!s||!u||(s.resize(u),Le(this.gl,{clearColor:[0,0,0,0],blend:!0,blendFunc:[1,1],blendEquation:32776,depthTest:!1},function(){return o.render(ab(ab({},a),{},{target:s,pass:"terrain-height-map",layers:a.layers,viewports:[u],effects:[]}))}))}},{key:"renderTerrainCover",value:function(i,a){var o=this,s=i.getRenderFramebuffer(),u=i.renderViewport;if(!(!s||!u)){var l=i.filterLayers(a.layers);s.resize(u),Le(this.gl,{depthTest:!1},function(){return o.render(ab(ab({},a),{},{target:s,pass:"terrain-cover-".concat(i.id),layers:l,effects:[],viewports:[u]}))})}}}]),e}(Xr);var hae=h(L()),dae=h(N()),vae=h(be()),mae=h(Ee()),gae=h(Y()),yae=h(K()),ob=h(q()),E2=h(B());function cae(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function pae(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?cae(Object(e),!0).forEach(function(n){(0,E2.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):cae(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function Gke(t){var r=zke();return function(){var n=(0,ob.default)(t),i;if(r){var a=(0,ob.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,yae.default)(this,i)}}function zke(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var _ae=function(t){(0,gae.default)(e,t);var r=Gke(e);function e(){var n;(0,hae.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,E2.default)((0,vae.default)(n),"drawParameters",{}),n}return(0,dae.default)(e,[{key:"getRenderableLayers",value:function(i,a){var o=a.layers,s=[];this.drawParameters={},this._resetColorEncoder(a.pickZ);for(var u=this._getDrawLayerParams(i,a),l=0;l<o.length;l++){var f=o[l];!f.isComposite&&u[l].shouldDrawLayer&&(s.push(f),this.drawParameters[f.id]=u[l].layerParameters)}return s}},{key:"renderTerrainCover",value:function(i,a){var o=this,s=i.getPickingFramebuffer(),u=i.renderViewport;if(!(!s||!u)){var l=i.filterLayers(a.layers),f=i.targetLayer;f.props.pickable&&l.unshift(f),s.resize(u),Le(this.gl,{depthTest:!1},function(){return o.render(pae(pae({},a),{},{pickingFBO:s,pass:"terrain-cover-picking-".concat(i.id),layers:l,effects:[],viewports:[u],cullRect:void 0,deviceRect:u,pickZ:!1}))})}}},{key:"getLayerParameters",value:function(i,a,o){if(this.drawParameters[i.id])return this.drawParameters[i.id];var s=(0,mae.default)((0,ob.default)(e.prototype),"getLayerParameters",this).call(this,i,a,o);return s.blend=!0,s}}]),e}(So);var xae=h(L()),Aae=h(N()),to=h(B());var bae=2048,C2=function(){function t(r){(0,xae.default)(this,t),(0,to.default)(this,"renderViewport",null),(0,to.default)(this,"bounds",null),(0,to.default)(this,"fbo",void 0),(0,to.default)(this,"gl",void 0),(0,to.default)(this,"layers",[]),(0,to.default)(this,"layersBounds",[]),(0,to.default)(this,"layersBoundsCommon",null),(0,to.default)(this,"lastViewport",null),this.gl=r}return(0,Aae.default)(t,[{key:"getRenderFramebuffer",value:function(){return this.renderViewport?(this.fbo||(this.fbo=Gd(this.gl,{id:"height-map",float:!0})),this.fbo):null}},{key:"shouldUpdate",value:function(e){var n=this,i=e.layers,a=e.viewport,o=i.length!==this.layers.length||i.some(function(p,d){return p!==n.layers[d]||p.props.transitions||p.getBounds()!==n.layersBounds[d]});o&&(this.layers=i,this.layersBounds=i.map(function(p){return p.getBounds()}),this.layersBoundsCommon=Wf(i,a));var s=!this.lastViewport||!a.equals(this.lastViewport);if(!this.layersBoundsCommon)this.renderViewport=null;else if(o||s){var u=Xf(this.layersBoundsCommon,a);if(u[2]<=u[0]||u[3]<=u[1])return this.renderViewport=null,!1;this.bounds=u,this.lastViewport=a;var l=a.scale,f=(u[2]-u[0])*l,c=(u[3]-u[1])*l;return this.renderViewport=f>0||c>0?$f({bounds:[a.center[0]-1,a.center[1]-1,a.center[0]+1,a.center[1]+1],zoom:a.zoom,width:Math.min(f,bae),height:Math.min(c,bae),viewport:a}):null,!0}return!1}},{key:"delete",value:function(){this.fbo&&(this.fbo.color.delete(),this.fbo.delete())}}],[{key:"isSupported",value:function(e){return Re.isSupported(e,{colorBufferFloat:!0})}}]),t}();function Sae(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function sb(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Sae(Object(e),!0).forEach(function(n){(0,zn.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Sae(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function qf(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=Vke(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function Vke(t,r){if(t){if(typeof t=="string")return Tae(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Tae(t,r)}}function Tae(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var Eae=function(){function t(){(0,Pae.default)(this,t),(0,zn.default)(this,"id","terrain-effect"),(0,zn.default)(this,"props",null),(0,zn.default)(this,"useInPicking",!0),(0,zn.default)(this,"isPicking",!1),(0,zn.default)(this,"isDrapingEnabled",!1),(0,zn.default)(this,"dummyHeightMap",void 0),(0,zn.default)(this,"heightMap",void 0),(0,zn.default)(this,"terrainPass",void 0),(0,zn.default)(this,"terrainPickingPass",void 0),(0,zn.default)(this,"terrainCovers",new Map)}return(0,Oae.default)(t,[{key:"initialize",value:function(e){this.dummyHeightMap=new we(e,{width:1,height:1,data:new Uint8Array([0,0,0,0])}),this.terrainPass=new fae(e,{id:"terrain"}),this.terrainPickingPass=new _ae(e,{id:"terrain-picking"}),C2.isSupported(e)?this.heightMap=new C2(e):J.warn("Terrain offset mode is not supported by this browser")(),Pn.getDefaultProgramManager(e).addDefaultModule(ib)}},{key:"preRender",value:function(e,n){if(!this.dummyHeightMap){this.initialize(e);var i=qf(n.layers),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;o.props.operation.includes("terrain")&&o.setChangeFlags({extensionsChanged:!0})}}catch(m){i.e(m)}finally{i.f()}}if(n.pickZ){this.isDrapingEnabled=!1;return}var s=n.viewports,u=n.isPicking,l=u===void 0?!1:u;this.isPicking=l,this.isDrapingEnabled=!0;var f=s[0],c=(l?this.terrainPickingPass:this.terrainPass).getRenderableLayers(f,n),p=c.filter(function(m){return m.props.operation.includes("terrain")});if(p.length!==0){if(!l){var d=c.filter(function(m){return m.state.terrainDrawMode==="offset"});d.length>0&&this._updateHeightMap(p,f,n)}var v=c.filter(function(m){return m.state.terrainDrawMode==="drape"});this._updateTerrainCovers(p,v,f,n)}}},{key:"getModuleParameters",value:function(e){var n,i,a=e.state.terrainDrawMode;return{heightMap:(n=this.heightMap)===null||n===void 0?void 0:n.getRenderFramebuffer(),heightMapBounds:(i=this.heightMap)===null||i===void 0?void 0:i.bounds,dummyHeightMap:this.dummyHeightMap,terrainCover:this.isDrapingEnabled?this.terrainCovers.get(e.id):null,useTerrainHeightMap:a==="offset",terrainSkipRender:a==="drape"||!e.props.operation.includes("draw")}}},{key:"cleanup",value:function(){this.dummyHeightMap&&(this.dummyHeightMap.delete(),this.dummyHeightMap=void 0),this.heightMap&&(this.heightMap.delete(),this.heightMap=void 0);var e=qf(this.terrainCovers.values()),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;i.delete()}}catch(a){e.e(a)}finally{e.f()}this.terrainCovers.clear()}},{key:"_updateHeightMap",value:function(e,n,i){if(this.heightMap){var a=this.heightMap.shouldUpdate({layers:e,viewport:n});a&&this.terrainPass.renderHeightMap(this.heightMap,sb(sb({},i),{},{layers:e,moduleParameters:{heightMapBounds:this.heightMap.bounds,dummyHeightMap:this.dummyHeightMap,devicePixelRatio:1,drawToTerrainHeightMap:!0}}))}}},{key:"_updateTerrainCovers",value:function(e,n,i,a){var o={},s=qf(n),u;try{for(s.s();!(u=s.n()).done;){var l=u.value;l.state.terrainCoverNeedsRedraw&&(o[l.id]=!0,l.state.terrainCoverNeedsRedraw=!1)}}catch(g){s.e(g)}finally{s.f()}var f=qf(this.terrainCovers.values()),c;try{for(f.s();!(c=f.n()).done;){var p=c.value;p.isDirty=p.isDirty||p.shouldUpdate({layerNeedsRedraw:o})}}catch(g){f.e(g)}finally{f.f()}var d=qf(e),v;try{for(d.s();!(v=d.n()).done;){var m=v.value;this._updateTerrainCover(m,n,i,a)}}catch(g){d.e(g)}finally{d.f()}this.isPicking||this._pruneTerrainCovers()}},{key:"_updateTerrainCover",value:function(e,n,i,a){var o=this.isPicking?this.terrainPickingPass:this.terrainPass,s=this.terrainCovers.get(e.id);s||(s=new rae(e),this.terrainCovers.set(e.id,s));try{var u=s.shouldUpdate({targetLayer:e,viewport:i,layers:n});(this.isPicking||s.isDirty||u)&&(o.renderTerrainCover(s,sb(sb({},a),{},{layers:n,moduleParameters:{dummyHeightMap:this.dummyHeightMap,terrainSkipRender:!1,devicePixelRatio:1}})),s.isDirty=!1)}catch(l){e.raiseError(l,"Error rendering terrain cover ".concat(s.id))}}},{key:"_pruneTerrainCovers",value:function(){var e=[],n=qf(this.terrainCovers),i;try{for(n.s();!(i=n.n()).done;){var a=(0,wae.default)(i.value,2),o=a[0],s=a[1];s.isActive||e.push(o)}}catch(c){n.e(c)}finally{n.f()}for(var u=0,l=e;u<l.length;u++){var f=l[u];this.terrainCovers.delete(f)}}}]),t}();function Hke(t){var r=Wke();return function(){var n=(0,M2.default)(t),i;if(r){var a=(0,M2.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Rae.default)(this,i)}}function Wke(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var $ke={terrainDrawMode:void 0},ub=function(t){(0,Iae.default)(e,t);var r=Hke(e);function e(){return(0,Cae.default)(this,e),r.apply(this,arguments)}return(0,Mae.default)(e,[{key:"getShaders",value:function(){return{modules:[ib]}}},{key:"initializeState",value:function(){var i;(i=this.context.deck)===null||i===void 0||i._addDefaultEffect(new Eae)}},{key:"updateState",value:function(i){var a=i.props,o=i.oldProps;if(!(this.state.terrainDrawMode&&a.terrainDrawMode===o.terrainDrawMode&&a.extruded===o.extruded)){var s=a.terrainDrawMode;if(!s){var u,l=this.props.extruded,f=(u=this.getAttributeManager())===null||u===void 0?void 0:u.attributes,c=f&&"instancePositions"in f;s=l||c?"offset":"drape"}this.setState({terrainDrawMode:s})}}},{key:"onNeedsRedraw",value:function(){var i=this.state;i.terrainDrawMode==="drape"&&(i.terrainCoverNeedsRedraw=!0)}}]),e}(Gt);(0,I2.default)(ub,"defaultProps",$ke);(0,I2.default)(ub,"extensionName","TerrainExtension");var Poe=h(ye()),Ooe=h(B()),H2=h(ve());var Soe=h(me());var Bae=h(B());function k2(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=Xke(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function Xke(t,r){if(t){if(typeof t=="string")return Lae(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Lae(t,r)}}function Lae(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function kae(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Mu(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?kae(Object(e),!0).forEach(function(n){(0,Bae.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):kae(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function B2(t,r,e){var n=qke(t),i=Object.keys(n).filter(function(a){return n[a]!==Array});return Yke(t,Mu({propArrayTypes:n},r),{numericPropKeys:e&&e.numericPropKeys||i,PositionDataType:e?e.PositionDataType:Float32Array})}function qke(t){var r={},e=k2(t),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;if(i.properties)for(var a in i.properties){var o=i.properties[a];r[a]=tBe(o,r[a])}}}catch(s){e.e(s)}finally{e.f()}return r}function Yke(t,r,e){for(var n=r.pointPositionsCount,i=r.pointFeaturesCount,a=r.linePositionsCount,o=r.linePathsCount,s=r.lineFeaturesCount,u=r.polygonPositionsCount,l=r.polygonObjectsCount,f=r.polygonRingsCount,c=r.polygonFeaturesCount,p=r.propArrayTypes,d=r.coordLength,v=e.numericPropKeys,m=v===void 0?[]:v,g=e.PositionDataType,y=g===void 0?Float32Array:g,_=t[0]&&("id"in t[0]),b=t.length>65535?Uint32Array:Uint16Array,x={type:"Point",positions:new y(n*d),globalFeatureIds:new b(n),featureIds:i>65535?new Uint32Array(n):new Uint16Array(n),numericProps:{},properties:[],fields:[]},A={type:"LineString",pathIndices:a>65535?new Uint32Array(o+1):new Uint16Array(o+1),positions:new y(a*d),globalFeatureIds:new b(a),featureIds:s>65535?new Uint32Array(a):new Uint16Array(a),numericProps:{},properties:[],fields:[]},S={type:"Polygon",polygonIndices:u>65535?new Uint32Array(l+1):new Uint16Array(l+1),primitivePolygonIndices:u>65535?new Uint32Array(f+1):new Uint16Array(f+1),positions:new y(u*d),triangles:[],globalFeatureIds:new b(u),featureIds:c>65535?new Uint32Array(u):new Uint16Array(u),numericProps:{},properties:[],fields:[]},P=0,O=[x,A,S];P<O.length;P++){var C=O[P],T=k2(m),I;try{for(T.s();!(I=T.n()).done;){var R=I.value,V=p[R];C.numericProps[R]=new V(C.positions.length/d)}}catch(Q){T.e(Q)}finally{T.f()}}A.pathIndices[o]=a,S.polygonIndices[l]=u,S.primitivePolygonIndices[f]=u;var z={pointPosition:0,pointFeature:0,linePosition:0,linePath:0,lineFeature:0,polygonPosition:0,polygonObject:0,polygonRing:0,polygonFeature:0,feature:0},k=k2(t),G;try{for(k.s();!(G=k.n()).done;){var U=G.value,$=U.geometry,H=U.properties||{};switch($.type){case"Point":Kke($,x,z,d,H),x.properties.push(L2(H,m)),_&&x.fields.push({id:U.id}),z.pointFeature++;break;case"LineString":Zke($,A,z,d,H),A.properties.push(L2(H,m)),_&&A.fields.push({id:U.id}),z.lineFeature++;break;case"Polygon":Jke($,S,z,d,H),S.properties.push(L2(H,m)),_&&S.fields.push({id:U.id}),z.polygonFeature++;break;default:throw new Error("Invalid geometry type")}z.feature++}}catch(Q){k.e(Q)}finally{k.f()}return eBe(x,A,S,d)}function Kke(t,r,e,n,i){r.positions.set(t.data,e.pointPosition*n);var a=t.data.length/n;F2(r,i,e.pointPosition,a),r.globalFeatureIds.fill(e.feature,e.pointPosition,e.pointPosition+a),r.featureIds.fill(e.pointFeature,e.pointPosition,e.pointPosition+a),e.pointPosition+=a}function Zke(t,r,e,n,i){r.positions.set(t.data,e.linePosition*n);var a=t.data.length/n;F2(r,i,e.linePosition,a),r.globalFeatureIds.fill(e.feature,e.linePosition,e.linePosition+a),r.featureIds.fill(e.lineFeature,e.linePosition,e.linePosition+a);for(var o=0,s=t.indices.length;o<s;++o){var u=t.indices[o],l=o===s-1?t.data.length:t.indices[o+1];r.pathIndices[e.linePath++]=e.linePosition,e.linePosition+=(l-u)/n}}function Jke(t,r,e,n,i){r.positions.set(t.data,e.polygonPosition*n);var a=t.data.length/n;F2(r,i,e.polygonPosition,a),r.globalFeatureIds.fill(e.feature,e.polygonPosition,e.polygonPosition+a),r.featureIds.fill(e.polygonFeature,e.polygonPosition,e.polygonPosition+a);for(var o=0,s=t.indices.length;o<s;++o){var u=e.polygonPosition;r.polygonIndices[e.polygonObject++]=u;for(var l=t.areas[o],f=t.indices[o],c=t.indices[o+1],p=0,d=f.length;p<d;++p){var v=f[p],m=p===d-1?c===void 0?t.data.length:c[0]:f[p+1];r.primitivePolygonIndices[e.polygonRing++]=e.polygonPosition,e.polygonPosition+=(m-v)/n}var g=e.polygonPosition;Qke(r,l,f,{startPosition:u,endPosition:g,coordLength:n})}}function Qke(t,r,e,n){for(var i=n.startPosition,a=n.endPosition,o=n.coordLength,s=i*o,u=a*o,l=t.positions.subarray(s,u),f=e[0],c=e.slice(1).map(function(m){return(m-f)/o}),p=iP(l,c,o,r),d=0,v=p.length;d<v;++d)t.triangles.push(i+p[d])}function R2(t,r){var e={};for(var n in t)e[n]={value:t[n],size:r};return e}function eBe(t,r,e,n){return{points:Mu(Mu({},t),{},{positions:{value:t.positions,size:n},globalFeatureIds:{value:t.globalFeatureIds,size:1},featureIds:{value:t.featureIds,size:1},numericProps:R2(t.numericProps,1)}),lines:Mu(Mu({},r),{},{positions:{value:r.positions,size:n},pathIndices:{value:r.pathIndices,size:1},globalFeatureIds:{value:r.globalFeatureIds,size:1},featureIds:{value:r.featureIds,size:1},numericProps:R2(r.numericProps,1)}),polygons:Mu(Mu({},e),{},{positions:{value:e.positions,size:n},polygonIndices:{value:e.polygonIndices,size:1},primitivePolygonIndices:{value:e.primitivePolygonIndices,size:1},triangles:{value:new Uint32Array(e.triangles),size:1},globalFeatureIds:{value:e.globalFeatureIds,size:1},featureIds:{value:e.featureIds,size:1},numericProps:R2(e.numericProps,1)})}}function F2(t,r,e,n){for(var i in t.numericProps)if(i in r){var a=r[i];t.numericProps[i].fill(a,e,e+n)}}function L2(t,r){var e={};for(var n in t)r.includes(n)||(e[n]=t[n]);return e}function tBe(t,r){return r===Array||!Number.isFinite(t)?Array:r===Float64Array||Math.fround(t)!==t?Float64Array:Float32Array}var Nae=h(B());function Fae(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function rBe(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Fae(Object(e),!0).forEach(function(n){(0,Nae.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Fae(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function jae(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=nBe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function nBe(t,r){if(t){if(typeof t=="string")return Dae(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Dae(t,r)}}function Dae(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function cb(t,r){var e=r?.globalFeatureId;return e!==void 0?iBe(t,e):aBe(t,r?.type)}function iBe(t,r){var e=Gae(t),n=jae(e),i;try{for(n.s();!(i=n.n()).done;){for(var a=i.value,o=0,s=a.featureIds.value[0],u=0;u<a.featureIds.value.length;u++){var l=a.featureIds.value[u];if(l!==s){if(r===a.globalFeatureIds.value[o])return lb(a,o,u);o=u,s=l}}if(r===a.globalFeatureIds.value[o])return lb(a,o,a.featureIds.value.length)}}catch(f){n.e(f)}finally{n.f()}throw new Error("featureId:".concat(r," not found"))}function aBe(t,r){var e=Gae(t,r);return oBe(e)}function Uae(t,r,e){switch(t.type){case"Point":return fBe(t,r,e);case"LineString":return lBe(t,r,e);case"Polygon":return zae(t,r,e);default:var n=t;throw new Error("Unsupported geometry type: ".concat(n?.type))}}function Gae(t,r){var e=Boolean(t.points||t.lines||t.polygons);if(!e)return t.type=r||cBe(t),[t];var n=[];return t.points&&(t.points.type="Point",n.push(t.points)),t.lines&&(t.lines.type="LineString",n.push(t.lines)),t.polygons&&(t.polygons.type="Polygon",n.push(t.polygons)),n}function oBe(t){var r=[],e=jae(t),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;if(i.featureIds.value.length!==0){for(var a=0,o=i.featureIds.value[0],s=0;s<i.featureIds.value.length;s++){var u=i.featureIds.value[s];u!==o&&(r.push(lb(i,a,s)),a=s,o=u)}r.push(lb(i,a,i.featureIds.value.length))}}}catch(l){e.e(l)}finally{e.f()}return r}function lb(t,r,e){var n=Uae(t,r,e),i=uBe(t,r,e),a=sBe(t,r,e);return rBe({type:"Feature",geometry:n,properties:i},a)}function sBe(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=arguments.length>2?arguments[2]:void 0;return t.fields&&t.fields[t.featureIds.value[r]]}function uBe(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=arguments.length>2?arguments[2]:void 0,n=Object.assign({},t.properties[t.featureIds.value[r]]);for(var i in t.numericProps)n[i]=t.numericProps[i].value[r];return n}function zae(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:-1/0,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1/0,n=t.positions,i=t.polygonIndices.value.filter(function(y){return y>=r&&y<=e}),a=t.primitivePolygonIndices.value.filter(function(y){return y>=r&&y<=e}),o=i.length>2;if(!o){for(var s=[],u=0;u<a.length-1;u++){var l=a[u],f=a[u+1],c=fb(n,l,f);s.push(c)}return{type:"Polygon",coordinates:s}}for(var p=[],d=0;d<i.length-1;d++){var v=i[d],m=i[d+1],g=zae(t,v,m).coordinates;p.push(g)}return{type:"MultiPolygon",coordinates:p}}function lBe(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:-1/0,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1/0,n=t.positions,i=t.pathIndices.value.filter(function(f){return f>=r&&f<=e}),a=i.length>2;if(!a){var o=fb(n,i[0],i[1]);return{type:"LineString",coordinates:o}}for(var s=[],u=0;u<i.length-1;u++){var l=fb(n,i[u],i[u+1]);s.push(l)}return{type:"MultiLineString",coordinates:s}}function fBe(t,r,e){var n=t.positions,i=fb(n,r,e),a=i.length>1;return a?{type:"MultiPoint",coordinates:i}:{type:"Point",coordinates:i[0]}}function fb(t,r,e){r=r||0,e=e||t.value.length/t.size;for(var n=[],i=r;i<e;i++){for(var a=Array(),o=i*t.size;o<(i+1)*t.size;o++)a.push(Number(t.value[o]));n.push(a)}return n}function cBe(t){return t.pathIndices?"LineString":t.polygonIndices?"Polygon":"Point"}var V2=h(Yae());var ioe=h(L());var toe=h(L()),roe=h(N());var Jae=h(L()),Qae=h(N());function Kae(t){var r=t.length;if(r<=1)return[t];for(var e=[],n,i,a=0;a<r;a++){var o=CBe(t[a]);o!==0&&(i===void 0&&(i=o<0),i===o<0?(n&&e.push(n),n=[t[a]]):n&&n.push(t[a]))}return n&&e.push(n),e}function CBe(t){for(var r=0,e=0,n=t.length-1,i,a;e<t.length;n=e++)i=t[e],a=t[n],r+=(a[0]-i[0])*(i[1]+a[1]);return r}function Zae(t,r,e){r&&e&&(t===1?r.id=e.readVarint():t===2?MBe(e,r):t===3?r.type=e.readVarint():t===4&&(r._geometry=e.pos))}function MBe(t,r){for(var e=t.readVarint()+t.pos;t.pos<e;){var n=r._keys[t.readVarint()],i=r._values[t.readVarint()];r.properties[n]=i}}var eoe=function(){function t(r,e,n,i,a){(0,Jae.default)(this,t),w(this,"properties",void 0),w(this,"extent",void 0),w(this,"type",void 0),w(this,"id",void 0),w(this,"_pbf",void 0),w(this,"_geometry",void 0),w(this,"_keys",void 0),w(this,"_values",void 0),this.properties={},this.extent=n,this.type=0,this.id=null,this._pbf=r,this._geometry=-1,this._keys=i,this._values=a,r.readFields(Zae,this,e)}return(0,Qae.default)(t,[{key:"loadGeometry",value:function(){var e=this._pbf;e.pos=this._geometry;for(var n=e.readVarint()+e.pos,i=1,a=0,o=0,s=0,u=[],l;e.pos<n;){if(a<=0){var f=e.readVarint();i=f&7,a=f>>3}if(a--,i===1||i===2)o+=e.readSVarint(),s+=e.readSVarint(),i===1&&(l&&u.push(l),l=[]),l&&l.push([o,s]);else if(i===7)l&&l.push(l[0].slice());else throw new Error("unknown command ".concat(i))}return l&&u.push(l),u}},{key:"bbox",value:function(){var e=this._pbf;e.pos=this._geometry;for(var n=e.readVarint()+e.pos,i=1,a=0,o=0,s=0,u=1/0,l=-1/0,f=1/0,c=-1/0;e.pos<n;){if(a<=0){var p=e.readVarint();i=p&7,a=p>>3}if(a--,i===1||i===2)o+=e.readSVarint(),s+=e.readSVarint(),o<u&&(u=o),o>l&&(l=o),s<f&&(f=s),s>c&&(c=s);else if(i!==7)throw new Error("unknown command ".concat(i))}return[u,f,l,c]}},{key:"_toGeoJSON",value:function(e){var n=this.loadGeometry(),i=t.types[this.type],a,o;switch(this.type){case 1:var s=[];for(a=0;a<n.length;a++)s[a]=n[a][0];n=s,e(n,this);break;case 2:for(a=0;a<n.length;a++)e(n[a],this);break;case 3:for(n=Kae(n),a=0;a<n.length;a++)for(o=0;o<n[a].length;o++)e(n[a][o],this);break}n.length===1?n=n[0]:i="Multi".concat(i);var u={type:"Feature",geometry:{type:i,coordinates:n},properties:this.properties};return this.id!==null&&(u.id=this.id),u}},{key:"toGeoJSON",value:function(e){if(typeof e=="function")return this._toGeoJSON(e);var n=e.x,i=e.y,a=e.z,o=this.extent*Math.pow(2,a),s=this.extent*n,u=this.extent*i;function l(f){for(var c=0;c<f.length;c++){var p=f[c];p[0]=(p[0]+s)*360/o-180;var d=180-(p[1]+u)*360/o;p[1]=360/Math.PI*Math.atan(Math.exp(d*Math.PI/180))-90}}return this._toGeoJSON(l)}}],[{key:"types",get:function(){return["Unknown","Point","LineString","Polygon"]}}]),t}();var noe=function(){function t(r,e){(0,toe.default)(this,t),w(this,"version",void 0),w(this,"name",void 0),w(this,"extent",void 0),w(this,"length",void 0),w(this,"_pbf",void 0),w(this,"_keys",void 0),w(this,"_values",void 0),w(this,"_features",void 0),this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(IBe,this,e),this.length=this._features.length}return(0,roe.default)(t,[{key:"feature",value:function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var n=this._pbf.readVarint()+this._pbf.pos;return new eoe(this._pbf,n,this.extent,this._keys,this._values)}}]),t}();function IBe(t,r,e){r&&e&&(t===15?r.version=e.readVarint():t===1?r.name=e.readString():t===5?r.extent=e.readVarint():t===2?r._features.push(e.pos):t===3?r._keys.push(e.readString()):t===4&&r._values.push(RBe(e)))}function RBe(t){for(var r=null,e=t.readVarint()+t.pos;t.pos<e;){var n=t.readVarint()>>3;r=n===1?t.readString():n===2?t.readFloat():n===3?t.readDouble():n===4?t.readVarint64():n===5?t.readVarint():n===6?t.readSVarint():n===7?t.readBoolean():null}return r}var aoe=function t(r,e){(0,ioe.default)(this,t),w(this,"layers",void 0),this.layers=r.readFields(LBe,{},e)};function LBe(t,r,e){if(t===3&&e){var n=new noe(e,e.readVarint()+e.pos);n.length&&r&&(r[n.name]=n)}}var boe=h(L());var goe=h(L()),yoe=h(N());var hoe=h(B()),doe=h(L()),voe=h(N());function ooe(t){var r=t.indices.length,e="Polygon";if(r<=1)return{type:e,data:t.data,areas:[[Ma(t.data)]],indices:[t.indices]};for(var n=[],i=[],a=[],o=[],s,u=0,l,f=0,c;f<r;f++){c=t.indices[f]-u,l=t.indices[f+1]-u||t.data.length;var p=t.data.slice(c,l),d=Ma(p);if(d===0){var v=t.data.slice(0,c),m=t.data.slice(l);t.data=v.concat(m),u+=l-c;continue}s===void 0&&(s=d<0),s===d<0?(o.length&&(n.push(a),i.push(o)),o=[c],a=[d]):(a.push(d),o.push(c))}return a&&n.push(a),o.length&&i.push(o),{type:e,areas:n,indices:i,data:t.data}}function soe(t,r,e,n){for(var i=0,a=t.length;i<a;i+=2){t[i]=(t[i]+r)*360/n-180;var o=180-(t[i+1]+e)*360/n;t[i+1]=360/Math.PI*Math.atan(Math.exp(o*Math.PI/180))-90}}function uoe(t,r,e){r&&e&&(t===1?r.id=e.readVarint():t===2?kBe(e,r):t===3?r.type=e.readVarint():t===4&&(r._geometry=e.pos))}function kBe(t,r){for(var e=t.readVarint()+t.pos;t.pos<e;){var n=r._keys[t.readVarint()],i=r._values[t.readVarint()];r.properties[n]=i}}function BBe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=FBe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function FBe(t,r){if(t){if(typeof t=="string")return loe(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return loe(t,r)}}function loe(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function foe(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function coe(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?foe(Object(e),!0).forEach(function(n){(0,hoe.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):foe(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var poe,Iu,j2,db,U2,G2,zd;var moe=function(){function t(r,e,n,i,a,o){(0,doe.default)(this,t),w(this,"properties",void 0),w(this,"extent",void 0),w(this,"type",void 0),w(this,"id",void 0),w(this,"_pbf",void 0),w(this,"_geometry",void 0),w(this,"_keys",void 0),w(this,"_values",void 0),w(this,"_geometryInfo",void 0),this.properties={},this.extent=n,this.type=0,this.id=null,this._pbf=r,this._geometry=-1,this._keys=i,this._values=a,this._geometryInfo=o,r.readFields(uoe,this,e)}return(0,voe.default)(t,[{key:"loadGeometry",value:function(){var e=this._pbf;e.pos=this._geometry,poe=e.readVarint()+e.pos,Iu=1,db=0,U2=0,G2=0,zd=0;for(var n=[],i=[];e.pos<poe;)if(db<=0&&(j2=e.readVarint(),Iu=j2&7,db=j2>>3),db--,Iu===1||Iu===2)U2+=e.readSVarint(),G2+=e.readSVarint(),Iu===1&&n.push(zd),i.push(U2,G2),zd+=2;else if(Iu===7){if(zd>0){var a=n[n.length-1];i.push(i[a],i[a+1]),zd+=2}}else throw new Error("unknown command ".concat(Iu));return{data:i,indices:n}}},{key:"_toBinaryCoordinates",value:function(e){var n=this.loadGeometry(),i;e(n.data,this);var a=2;switch(this.type){case 1:this._geometryInfo.pointFeaturesCount++,this._geometryInfo.pointPositionsCount+=n.indices.length,i=coe({type:"Point"},n);break;case 2:this._geometryInfo.lineFeaturesCount++,this._geometryInfo.linePathsCount+=n.indices.length,this._geometryInfo.linePositionsCount+=n.data.length/a,i=coe({type:"LineString"},n);break;case 3:i=ooe(n),this._geometryInfo.polygonFeaturesCount++,this._geometryInfo.polygonObjectsCount+=i.indices.length;var o=BBe(i.indices),s;try{for(o.s();!(s=o.n()).done;){var u=s.value;this._geometryInfo.polygonRingsCount+=u.length}}catch(f){o.e(f)}finally{o.f()}this._geometryInfo.polygonPositionsCount+=i.data.length/a;break;default:throw new Error("Invalid geometry type: ".concat(this.type))}var l={type:"Feature",geometry:i,properties:this.properties};return this.id!==null&&(l.id=this.id),l}},{key:"toBinaryCoordinates",value:function(e){if(typeof e=="function")return this._toBinaryCoordinates(e);var n=e.x,i=e.y,a=e.z,o=this.extent*Math.pow(2,a),s=this.extent*n,u=this.extent*i;return this._toBinaryCoordinates(function(l){return soe(l,s,u,o)})}}]),t}();var _oe=function(){function t(r,e){(0,goe.default)(this,t),w(this,"version",void 0),w(this,"name",void 0),w(this,"extent",void 0),w(this,"length",void 0),w(this,"_pbf",void 0),w(this,"_keys",void 0),w(this,"_values",void 0),w(this,"_features",void 0),this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(DBe,this,e),this.length=this._features.length}return(0,yoe.default)(t,[{key:"feature",value:function(e,n){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var i=this._pbf.readVarint()+this._pbf.pos;return new moe(this._pbf,i,this.extent,this._keys,this._values,n)}}]),t}();function DBe(t,r,e){r&&e&&(t===15?r.version=e.readVarint():t===1?r.name=e.readString():t===5?r.extent=e.readVarint():t===2?r._features.push(e.pos):t===3?r._keys.push(e.readString()):t===4&&r._values.push(NBe(e)))}function NBe(t){for(var r=null,e=t.readVarint()+t.pos;t.pos<e;){var n=t.readVarint()>>3;r=n===1?t.readString():n===2?t.readFloat():n===3?t.readDouble():n===4?t.readVarint64():n===5?t.readVarint():n===6?t.readSVarint():n===7?t.readBoolean():null}return r}var xoe=function t(r,e){(0,boe.default)(this,t),w(this,"layers",void 0),this.layers=r.readFields(jBe,{},e)};function jBe(t,r,e){if(t===3&&e){var n=new _oe(e,e.readVarint()+e.pos);n.length&&r&&(r[n.name]=n)}}function vb(t,r){var e,n,i=GBe(r),a=(r==null||(e=r.gis)===null||e===void 0?void 0:e.format)||(r==null||(n=r.mvt)===null||n===void 0?void 0:n.shape);switch(a){case"columnar-table":return{shape:"columnar-table",data:z2(t,i)};case"geojson-row-table":{var o={shape:"geojson-row-table",data:Aoe(t,i)};return o}case"geojson":return Aoe(t,i);case"binary-geometry":return z2(t,i);case"binary":return z2(t,i);default:throw new Error(a)}}function z2(t,r){var e=UBe(t,r),n=(0,Soe.default)(e,2),i=n[0],a=n[1],o=B2(i,a);return o.byteLength=t.byteLength,o}function UBe(t,r){var e=[],n={coordLength:2,pointPositionsCount:0,pointFeaturesCount:0,linePositionsCount:0,linePathsCount:0,lineFeaturesCount:0,polygonPositionsCount:0,polygonObjectsCount:0,polygonRingsCount:0,polygonFeaturesCount:0};if(t.byteLength<=0)return[e,n];var i=new xoe(new V2.default(t)),a=r&&Array.isArray(r.layers)?r.layers:Object.keys(i.layers);return a.forEach(function(o){var s=i.layers[o];if(s)for(var u=0;u<s.length;u++){var l=s.feature(u,n),f=VBe(l,r,o);e.push(f)}}),[e,n]}function Aoe(t,r){if(t.byteLength<=0)return[];var e=[],n=new aoe(new V2.default(t)),i=Array.isArray(r.layers)?r.layers:Object.keys(n.layers);return i.forEach(function(a){var o=n.layers[a];if(o)for(var s=0;s<o.length;s++){var u=o.feature(s),l=zBe(u,r,a);e.push(l)}}),e}function GBe(t){var r;if(!(t!=null&&t.mvt))throw new Error("mvt options required");var e=((r=t.mvt)===null||r===void 0?void 0:r.coordinates)==="wgs84",n=t.mvt.tileIndex,i=n&&Number.isFinite(n.x)&&Number.isFinite(n.y)&&Number.isFinite(n.z);if(e&&!i)throw new Error("MVT Loader: WGS84 coordinates need tileIndex property");return t.mvt}function zBe(t,r,e){var n=t.toGeoJSON(r.coordinates==="wgs84"?r.tileIndex:HBe);return r.layerProperty&&(n.properties[r.layerProperty]=e),n}function VBe(t,r,e){var n=t.toBinaryCoordinates(r.coordinates==="wgs84"?r.tileIndex:WBe);return r.layerProperty&&n.properties&&(n.properties[r.layerProperty]=e),n}function HBe(t,r){for(var e=r.extent,n=0;n<t.length;n++){var i=t[n];i[0]/=e,i[1]/=e}}function WBe(t,r){for(var e=r.extent,n=0,i=t.length;n<i;++n)t[n]/=e}function Toe(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function woe(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Toe(Object(e),!0).forEach(function(n){(0,Ooe.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Toe(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var $Be="3.4.2",XBe={mvt:{shape:"geojson",coordinates:"local",layerProperty:"layerName",layers:void 0,tileIndex:null}},mb={name:"Mapbox Vector Tile",id:"mvt",module:"mvt",version:$Be,extensions:["mvt","pbf"],mimeTypes:["application/vnd.mapbox-vector-tile","application/x-protobuf"],worker:!0,category:"geometry",options:XBe},qBe=woe(woe({},mb),{},{parse:function(){var t=(0,Poe.default)(H2.default.mark(function e(n,i){return H2.default.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",vb(n,i));case 1:case"end":return o.stop()}},e)}));function r(e,n){return t.apply(this,arguments)}return r}(),parseSync:vb,binary:!0});var Moe=h(B()),W2=h(me());function Eoe(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Coe(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Eoe(Object(e),!0).forEach(function(n){(0,Moe.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Eoe(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var YBe={Point:Ioe,MultiPoint:KBe,LineString:Roe,MultiLineString:ZBe,Polygon:Loe,MultiPolygon:JBe};function Ioe(t,r,e){var n=(0,W2.default)(t,2),i=n[0],a=n[1],o=(0,W2.default)(r,2),s=o[0],u=o[1],l=sr(s[0],u[0],i),f=sr(s[1],u[1],a);return e.unprojectFlat([l,f])}function $2(t,r,e){return t.map(function(n){return Ioe(n,r,e)})}function KBe(t,r,e){return $2(t,r,e)}function Roe(t,r,e){return $2(t,r,e)}function ZBe(t,r,e){return t.map(function(n){return Roe(n,r,e)})}function Loe(t,r,e){return t.map(function(n){return $2(n,r,e)})}function JBe(t,r,e){return t.map(function(n){return Loe(n,r,e)})}function koe(t,r,e){var n=e.projectFlat([r.west,r.north]),i=e.projectFlat([r.east,r.south]),a=[n,i];return Coe(Coe({},t),{},{coordinates:YBe[t.type](t.coordinates,a,e)})}function QBe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=e3e(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function e3e(t,r){if(t){if(typeof t=="string")return Boe(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Boe(t,r)}}function Boe(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var t3e=["points","lines","polygons"];function X2(t,r,e,n){var i=QBe(t3e),a;try{for(i.s();!(a=i.n()).done;){var o=a.value,s=t[o]&&r3e(t[o],r,e,n);if(s>=0)return s}}catch(u){i.e(u)}finally{i.f()}return-1}function r3e(t,r,e,n){var i=t.featureIds.value;if(!i.length)return-1;var a=0,o=i[i.length-1]+1;if(n){var s=n3e(t,n);if(s)a=s[0],o=s[1]+1;else return-1}var u=-1;if(r in t.numericProps){var l=t.numericProps[r].value.findIndex(function(f,c){return f===e&&i[c]>=a&&i[c]<o});return l>=0?t.globalFeatureIds.value[l]:-1}else r?u=Foe(t.properties,function(f){return f[r]===e},a,o):t.fields&&(u=Foe(t.fields,function(f){return f.id===e},a,o));return u>=0?i3e(t,u):-1}function n3e(t,r){if(!t.__layers){for(var e={},n=t.properties,i=0;i<n.length;i++){var a=n[i],o=a.layerName;o&&(e[o]?e[o][1]=i:e[o]=[i,i])}t.__layers=e}return t.__layers[r]}function i3e(t,r){if(!t.__ids){for(var e=[],n=t.featureIds.value,i=t.globalFeatureIds.value,a=0;a<n.length;a++)e[n[a]]=i[a];t.__ids=e}return t.__ids[r]}function Foe(t,r,e,n){for(var i=e;i<n;i++)if(r(t[i],i))return i;return-1}function a3e(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=o3e(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function o3e(t,r){if(t){if(typeof t=="string")return Doe(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Doe(t,r)}}function Doe(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function s3e(t){var r=u3e();return function(){var n=(0,aa.default)(t),i;if(r){var a=(0,aa.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Xoe.default)(this,i)}}function u3e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Noe(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Jo(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Noe(Object(e),!0).forEach(function(n){(0,gb.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Noe(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var q2=512,l3e=Jo(Jo({},Ra.defaultProps),{},{data:Uo,onDataLoad:{type:"function",value:null,optional:!0,compare:!1},uniqueIdProperty:"",highlightedFeatureId:null,loaders:[mb],binary:!0}),yb=function(t){(0,$oe.default)(e,t);var r=s3e(e);function e(){return(0,Hoe.default)(this,e),r.apply(this,arguments)}return(0,Woe.default)(e,[{key:"initializeState",value:function(){(0,Zo.default)((0,aa.default)(e.prototype),"initializeState",this).call(this);var i=this.context.viewport.resolution!==void 0?!1:this.props.binary;this.setState({binary:i,data:null,tileJSON:null})}},{key:"isLoaded",get:function(){return this.state&&this.state.data&&this.state.tileset&&(0,Zo.default)((0,aa.default)(e.prototype),"isLoaded",this)}},{key:"updateState",value:function(i){var a,o=i.props,s=i.oldProps,u=i.context,l=i.changeFlags;l.dataChanged&&this._updateTileData(),(a=this.state)!==null&&a!==void 0&&a.data&&((0,Zo.default)((0,aa.default)(e.prototype),"updateState",this).call(this,{props:o,oldProps:s,context:u,changeFlags:l}),this._setWGS84PropertyForTiles());var f=o.highlightColor;f!==s.highlightColor&&Array.isArray(f)&&this.setState({highlightColor:f})}},{key:"_updateTileData",value:function(){var n=(0,Voe.default)(K2.default.mark(function a(){var o,s,u,l,f;return K2.default.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(o=this.props.data,s=null,!(typeof o=="string"&&!RO(o))){p.next=18;break}return u=this.props,l=u.onDataLoad,f=u.fetch,this.setState({data:null,tileJSON:null}),p.prev=5,p.next=8,f(o,{propName:"data",layer:this,loaders:[]});case 8:s=p.sent,p.next=15;break;case 11:p.prev=11,p.t0=p.catch(5),this.raiseError(p.t0,"loading TileJSON"),o=null;case 15:l&&l(s,{propName:"data",layer:this}),p.next=19;break;case 18:o.tilejson&&(s=o);case 19:s&&(o=s.tiles),this.setState({data:o,tileJSON:s});case 21:case"end":return p.stop()}},a,this,[[5,11]])}));function i(){return n.apply(this,arguments)}return i}()},{key:"_getTilesetOptions",value:function(){var i=(0,Zo.default)((0,aa.default)(e.prototype),"_getTilesetOptions",this).call(this),a=this.state.tileJSON,o=this.props,s=o.minZoom,u=o.maxZoom;return a&&(Number.isFinite(a.minzoom)&&a.minzoom>s&&(i.minZoom=a.minzoom),Number.isFinite(a.maxzoom)&&(!Number.isFinite(u)||a.maxzoom<u)&&(i.maxZoom=a.maxzoom)),i}},{key:"renderLayers",value:function(){var i;return(i=this.state)!==null&&i!==void 0&&i.data?(0,Zo.default)((0,aa.default)(e.prototype),"renderLayers",this).call(this):null}},{key:"getTileData",value:function(i){var a,o=this.state,s=o.data,u=o.binary,l=i.index,f=i.signal,c=Qi(s,i);if(!c)return Promise.reject("Invalid URL");var p=this.getLoadOptions(),d=this.props.fetch;return p=Jo(Jo({},p),{},{mimeType:"application/x-protobuf",mvt:Jo(Jo({},(a=p)===null||a===void 0?void 0:a.mvt),{},{coordinates:this.context.viewport.resolution?"wgs84":"local",tileIndex:l}),gis:u?{format:"binary"}:{}}),d(c,{propName:"data",layer:this,loadOptions:p,signal:f})}},{key:"renderSubLayers",value:function(i){var a=i.tile.index,o=a.x,s=a.y,u=a.z,l=Math.pow(2,u),f=q2/l,c=-f,p=q2*o/l,d=q2*(1-s/l),v=new pe().scale([f,c,1]);i.autoHighlight=!1,this.context.viewport.resolution||(i.modelMatrix=v,i.coordinateOrigin=[p,d,0],i.coordinateSystem=ue.CARTESIAN,i.extensions=[].concat((0,zoe.default)(i.extensions||[]),[new Hf]));var m=(0,Zo.default)((0,aa.default)(e.prototype),"renderSubLayers",this).call(this,i);return this.state.binary&&!(m instanceof Ra)&&J.warn("renderSubLayers() must return GeoJsonLayer when using binary:true")(),m}},{key:"_updateAutoHighlight",value:function(i){var a=this.props.uniqueIdProperty,o=this.state,s=o.hoveredFeatureId,u=o.hoveredFeatureLayerName,l=i.object,f,c;l&&(f=Y2(l,a),c=joe(l));var p=this.props.highlightColor;typeof p=="function"&&(p=p(i)),(s!==f||u!==c)&&this.setState({highlightColor:p,hoveredFeatureId:f,hoveredFeatureLayerName:c})}},{key:"getPickingInfo",value:function(i){var a=(0,Zo.default)((0,aa.default)(e.prototype),"getPickingInfo",this).call(this,i),o=Boolean(this.context.viewport.resolution);if(this.state.binary&&a.index!==-1){var s=i.sourceLayer.props.data;a.object=cb(s,{globalFeatureId:a.index})}return a.object&&!o&&(a.object=Goe(a.object,a.tile.bbox,this.context.viewport)),a}},{key:"getSubLayerPropsByTile",value:function(i){return{highlightedObjectIndex:this.getHighlightedObjectIndex(i),highlightColor:this.state.highlightColor}}},{key:"getHighlightedObjectIndex",value:function(i){var a=this.state,o=a.hoveredFeatureId,s=a.hoveredFeatureLayerName,u=a.binary,l=this.props,f=l.uniqueIdProperty,c=l.highlightedFeatureId,p=i.content,d=Uoe(c),v=Uoe(o)||d;if(!v)return-1;var m=d?c:o;return Array.isArray(p)?p.findIndex(function(g){var y=Y2(g,f)===m,_=d||joe(g)===s;return y&&_}):p&&u?X2(p,f,m,d?"":s):-1}},{key:"_pickObjects",value:function(i){var a=this.context,o=a.deck,s=a.viewport,u=s.width,l=s.height,f=s.x,c=s.y,p=[this.id];return o.pickObjects({x:f,y:c,width:u,height:l,layerIds:p,maxObjects:i})}},{key:"getRenderedFeatures",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,a=this._pickObjects(i),o=new Set,s=[],u=a3e(a),l;try{for(u.s();!(l=u.n()).done;){var f=l.value,c=Y2(f.object,this.props.uniqueIdProperty);c===void 0?s.push(f.object):o.has(c)||(o.add(c),s.push(f.object))}}catch(p){u.e(p)}finally{u.f()}return s}},{key:"_setWGS84PropertyForTiles",value:function(){var i=this,a="dataInWGS84",o=this.state.tileset;o.selectedTiles.forEach(function(s){s.hasOwnProperty(a)||Object.defineProperty(s,a,{get:function(){if(!s.content)return null;if(i.state.binary&&Array.isArray(s.content)&&!s.content.length)return[];var l=s.bbox;if(s._contentWGS84===void 0&&LO(l)){var f=i.state.binary?cb(s.content):s.content;s._contentWGS84=f.map(function(c){return Goe(c,l,i.context.viewport)})}return s._contentWGS84}})})}}]),e}(Na);(0,gb.default)(yb,"layerName","MVTLayer");(0,gb.default)(yb,"defaultProps",l3e);function Y2(t,r){if(t.properties&&r)return t.properties[r];if("id"in t)return t.id}function joe(t){var r;return((r=t.properties)===null||r===void 0?void 0:r.layerName)||null}function Uoe(t){return t!=null&&t!==""}function Goe(t,r,e){var n=Jo(Jo({},t),{},{geometry:{type:t.geometry.type}});return Object.defineProperty(n.geometry,"coordinates",{get:function(){var a=koe(t.geometry,r,e);return a.coordinates}}),n}var Joe=h(L()),Qoe=h(N()),ese=h(Y()),tse=h(K()),Z2=h(q()),J2=h(B());var Yoe=h(me()),qoe="0123456789bcdefghjkmnpqrstuvwxyz",Koe={};for(Vd=0;Vd<qoe.length;Vd++)Koe[qoe.charAt(Vd)]=Vd;var Vd,f3e=-90,c3e=90,p3e=-180,h3e=180;function d3e(t){for(var r=!0,e=c3e,n=f3e,i=h3e,a=p3e,o,s=0,u=0,l=t.length;u<l;u++){var f=t[u].toLowerCase();s=Koe[f];for(var c=4;c>=0;c--){var p=s>>c&1;r?(o=(i+a)/2,p===1?a=o:i=o):(o=(e+n)/2,p===1?n=o:e=o),r=!r}}return[n,a,e,i]}function Zoe(t){var r=d3e(t),e=(0,Yoe.default)(r,4),n=e[0],i=e[1],a=e[2],o=e[3];return[o,a,o,n,i,n,i,a,o,a]}function v3e(t){var r=m3e();return function(){var n=(0,Z2.default)(t),i;if(r){var a=(0,Z2.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,tse.default)(this,i)}}function m3e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var g3e={getGeohash:{type:"accessor",value:function(r){return r.geohash}}},_b=function(t){(0,ese.default)(e,t);var r=v3e(e);function e(){return(0,Joe.default)(this,e),r.apply(this,arguments)}return(0,Qoe.default)(e,[{key:"indexToBounds",value:function(){var i=this.props,a=i.data,o=i.getGeohash;return{data:a,_normalize:!1,positionFormat:"XY",getPolygon:function(u,l){return Zoe(o(u,l))}}}}]),e}(Dn);(0,J2.default)(_b,"layerName","GeohashLayer");(0,J2.default)(_b,"defaultProps",g3e);var Q2={};un(Q2,{Buffer:()=>xe,ConeGeometry:()=>qm,CubeGeometry:()=>_o,CylinderGeometry:()=>Km,FEATURES:()=>Se,Framebuffer:()=>Re,Geometry:()=>Me,IcoSphereGeometry:()=>Jm,Model:()=>Ce,PlaneGeometry:()=>eg,Program:()=>po,ProgramManager:()=>Pn,Renderbuffer:()=>Fr,SphereGeometry:()=>rg,Texture2D:()=>we,Texture3D:()=>ol,TextureCube:()=>_s,Timeline:()=>bo,Transform:()=>Nr,TransformFeedback:()=>ho,TruncatedConeGeometry:()=>yo,cloneTextureFrom:()=>ul,copyToTexture:()=>sl,cssToDeviceRatio:()=>_r,getParameters:()=>Ri,hasFeatures:()=>dr,instrumentGLContext:()=>da,isWebGL2:()=>ce,readPixelsToBuffer:()=>va,setParameters:()=>Ht,withParameters:()=>Le});var eI={};un(eI,{fetchFile:()=>qu,load:()=>Jt,parse:()=>hs,registerLoaders:()=>Wc});var vse=h(L()),mse=h(N()),gse=h(be()),xb=h(Ee()),yse=h(Y()),_se=h(K()),Jf=h(q()),iI=h(B());function tI(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function rse(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function rI(t,r,e){return r&&rse(t.prototype,r),e&&rse(t,e),t}var mt=h(fse());var LAt=typeof window<"u"?window:global;var Ru=typeof document<"u"?document:{};function b3e(){}function x3e(t){t&&console.error(t.error)}var pse={container:mt.default.object,gl:mt.default.object,mapboxApiAccessToken:mt.default.string,mapboxApiUrl:mt.default.string,attributionControl:mt.default.bool,preserveDrawingBuffer:mt.default.bool,reuseMaps:mt.default.bool,transformRequest:mt.default.func,mapOptions:mt.default.object,mapStyle:mt.default.oneOfType([mt.default.string,mt.default.object]),visible:mt.default.bool,asyncRender:mt.default.bool,onLoad:mt.default.func,onError:mt.default.func,width:mt.default.number,height:mt.default.number,viewState:mt.default.object,longitude:mt.default.number,latitude:mt.default.number,zoom:mt.default.number,bearing:mt.default.number,pitch:mt.default.number,altitude:mt.default.number},bb={container:Ru.body,mapboxApiAccessToken:A3e(),mapboxApiUrl:"https://api.mapbox.com",preserveDrawingBuffer:!1,attributionControl:!0,reuseMaps:!1,mapOptions:{},mapStyle:"mapbox://styles/mapbox/light-v8",visible:!0,asyncRender:!1,onLoad:b3e,onError:x3e,width:0,height:0,longitude:0,latitude:0,zoom:0,bearing:0,pitch:0,altitude:1.5};function A3e(){var t=null;if(typeof window<"u"&&window.location){var r=window.location.search.match(/access_token=([^&\/]*)/);t=r&&r[1]}return!t&&typeof process<"u"&&(t=t||process.env.MapboxAccessToken||process.env.REACT_APP_MAPBOX_ACCESS_TOKEN),t||"no-token"}function cse(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"component";t.debug&&mt.default.checkPropTypes(pse,t,"prop",r)}var Zf=function(){function t(r){var e=this;if(tI(this,t),w(this,"mapboxgl",void 0),w(this,"props",bb),w(this,"_map",null),w(this,"width",0),w(this,"height",0),w(this,"_fireLoadEvent",function(){e.props.onLoad({type:"load",target:e._map})}),!r.mapboxgl)throw new Error("Mapbox not available");this.mapboxgl=r.mapboxgl,t.initialized||(t.initialized=!0,this._checkStyleSheet(this.mapboxgl.version)),this._initialize(r)}return rI(t,[{key:"finalize",value:function(){return this._destroy(),this}},{key:"setProps",value:function(e){return this._update(this.props,e),this}},{key:"resize",value:function(){return this._map.resize(),this}},{key:"redraw",value:function(){var e=this._map;e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}},{key:"getMap",value:function(){return this._map}},{key:"_reuse",value:function(e){this._map=t.savedMap;var n=this._map.getContainer(),i=e.container;for(i.classList.add("mapboxgl-map");n.childNodes.length>0;)i.appendChild(n.childNodes[0]);this._map._container=i,t.savedMap=null,e.mapStyle&&this._map.setStyle(e.mapStyle,{diff:!1}),this._map.isStyleLoaded()?this._fireLoadEvent():this._map.once("styledata",this._fireLoadEvent)}},{key:"_create",value:function(e){if(e.reuseMaps&&t.savedMap)this._reuse(e);else{if(e.gl){var n=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=function(){return HTMLCanvasElement.prototype.getContext=n,e.gl}}var i={container:e.container,center:[0,0],zoom:8,pitch:0,bearing:0,maxZoom:24,style:e.mapStyle,interactive:!1,trackResize:!1,attributionControl:e.attributionControl,preserveDrawingBuffer:e.preserveDrawingBuffer};e.transformRequest&&(i.transformRequest=e.transformRequest),this._map=new this.mapboxgl.Map(Object.assign({},i,e.mapOptions)),this._map.once("load",e.onLoad),this._map.on("error",e.onError)}return this}},{key:"_destroy",value:function(){this._map&&(t.savedMap?this._map.remove():(t.savedMap=this._map,this._map.off("load",this.props.onLoad),this._map.off("error",this.props.onError),this._map.off("styledata",this._fireLoadEvent)),this._map=null)}},{key:"_initialize",value:function(e){var n=this;e=Object.assign({},bb,e),cse(e,"Mapbox"),this.mapboxgl.accessToken=e.mapboxApiAccessToken||bb.mapboxApiAccessToken,this.mapboxgl.baseApiUrl=e.mapboxApiUrl,this._create(e);var i=e,a=i.container;Object.defineProperty(a,"offsetWidth",{get:function(){return n.width}}),Object.defineProperty(a,"clientWidth",{get:function(){return n.width}}),Object.defineProperty(a,"offsetHeight",{get:function(){return n.height}}),Object.defineProperty(a,"clientHeight",{get:function(){return n.height}});var o=this._map.getCanvas();o&&(o.style.outline="none"),this._updateMapViewport({},e),this._updateMapSize({},e),this.props=e}},{key:"_update",value:function(e,n){if(this._map){n=Object.assign({},this.props,n),cse(n,"Mapbox");var i=this._updateMapViewport(e,n),a=this._updateMapSize(e,n);!n.asyncRender&&(i||a)&&this.redraw(),this.props=n}}},{key:"_updateMapSize",value:function(e,n){var i=e.width!==n.width||e.height!==n.height;return i&&(this.width=n.width,this.height=n.height,this.resize()),i}},{key:"_updateMapViewport",value:function(e,n){var i=this._getViewState(e),a=this._getViewState(n),o=a.latitude!==i.latitude||a.longitude!==i.longitude||a.zoom!==i.zoom||a.pitch!==i.pitch||a.bearing!==i.bearing||a.altitude!==i.altitude;return o&&(this._map.jumpTo(this._viewStateToMapboxProps(a)),a.altitude!==i.altitude&&(this._map.transform.altitude=a.altitude)),o}},{key:"_getViewState",value:function(e){var n=e.viewState||e,i=n.longitude,a=n.latitude,o=n.zoom,s=n.pitch,u=s===void 0?0:s,l=n.bearing,f=l===void 0?0:l,c=n.altitude,p=c===void 0?1.5:c;return{longitude:i,latitude:a,zoom:o,pitch:u,bearing:f,altitude:p}}},{key:"_checkStyleSheet",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"0.47.0";if(!(typeof Ru>"u"))try{var n=Ru.createElement("div");n.className="mapboxgl-map",n.style.display="none",Ru.body.append(n);var i=window.getComputedStyle(n).position!=="static";if(!i){var a=Ru.createElement("link");a.setAttribute("rel","stylesheet"),a.setAttribute("type","text/css"),a.setAttribute("href","https://api.tiles.mapbox.com/mapbox-gl-js/v".concat(e,"/mapbox-gl.css")),Ru.head.append(a)}}catch{}}},{key:"_viewStateToMapboxProps",value:function(e){return{center:[e.longitude,e.latitude],zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}}}]),t}();w(Zf,"initialized",!1);w(Zf,"propTypes",pse);w(Zf,"defaultProps",bb);w(Zf,"savedMap",null);function hse(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function nI(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?hse(Object(e),!0).forEach(function(n){(0,iI.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):hse(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function S3e(t){var r=T3e();return function(){var n=(0,Jf.default)(t),i;if(r){var a=(0,Jf.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_se.default)(this,i)}}function T3e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var dse={position:"absolute",left:0,top:0,width:"100%",height:"100%"};function w3e(t){var r=t.container,e=r===void 0?document.body:r;if(typeof e=="string"&&(e=document.getElementById(e)),!e)throw Error("Deck: container not found");var n=window.getComputedStyle(e);n.position==="static"&&(e.style.position="relative");var i=document.createElement("div");e.appendChild(i),Object.assign(i.style,dse);var a=document.createElement("canvas");return e.appendChild(a),Object.assign(a.style,dse),{container:e,mapCanvas:i,deckCanvas:a}}var bse=function(t){(0,yse.default)(e,t);var r=S3e(e);function e(n){var i;if((0,vse.default)(this,e),typeof document>"u")throw Error("Deck can only be used in the browser");var a=w3e(n),o=a.mapCanvas,s=a.deckCanvas,u=n.viewState||n.initialViewState,l=Number.isFinite(u&&u.latitude),f=n.map,c=f===void 0?globalThis.mapboxgl||globalThis.maplibregl:f;return i=r.call(this,nI({canvas:s},n)),(0,iI.default)((0,gse.default)(i),"_map",void 0),c&&c.Map?i._map=l&&new Zf(nI(nI({},n),{},{viewState:u,container:o,mapboxgl:c})):i._map=c,i}return(0,mse.default)(e,[{key:"getMapboxMap",value:function(){return this._map&&this._map.getMap()}},{key:"finalize",value:function(){this._map&&this._map.finalize(),(0,xb.default)((0,Jf.default)(e.prototype),"finalize",this).call(this)}},{key:"setProps",value:function(i){"mapStyle"in i&&this._map&&this._map._map.setStyle(i.mapStyle),(0,xb.default)((0,Jf.default)(e.prototype),"setProps",this).call(this,i)}},{key:"_drawLayers",value:function(i,a){if(this._map){var o=this.getViewports()[0];this._map.setProps({width:o.width,height:o.height,viewState:o})}(0,xb.default)((0,Jf.default)(e.prototype),"_drawLayers",this).call(this,i,a)}}]),e}(dn);globalThis.luma=globalThis.luma||{};globalThis.loaders=globalThis.loaders||{};Object.assign(globalThis.luma,Q2);Object.assign(globalThis.loaders,eI);var Iue=h(L()),Rue=h(N()),Lue=h(be()),Lb=h(Ee()),kue=h(Y()),Bue=h(K()),oc=h(q()),Bu=h(B());var wb=h(B()),Bse=h(L()),Fse=h(N());var Lu=h(B());var gt={SUM:1,MEAN:2,MIN:3,MAX:4};function xse(t,r){return t+r}function P3e(t,r){return r>t?r:t}function O3e(t,r){return r<t?r:t}function E3e(t,r){if(Number.isFinite(r))return t.length?r:null;var e=t.map(r).filter(Number.isFinite);return e.length?e.reduce(xse,0)/e.length:null}function C3e(t,r){if(Number.isFinite(r))return t.length?t.length*r:null;var e=t.map(r).filter(Number.isFinite);return e.length?e.reduce(xse,0):null}function M3e(t,r){if(Number.isFinite(r))return t.length?r:null;var e=t.map(r).filter(Number.isFinite);return e.length?e.reduce(P3e,-1/0):null}function I3e(t,r){if(Number.isFinite(r))return t.length?r:null;var e=t.map(r).filter(Number.isFinite);return e.length?e.reduce(O3e,1/0):null}function Qf(t,r,e){var n=gt[t]||gt.SUM;switch(r=R3e(r,e),n){case gt.MIN:return function(i){return I3e(i,r)};case gt.SUM:return function(i){return C3e(i,r)};case gt.MEAN:return function(i){return E3e(i,r)};case gt.MAX:return function(i){return M3e(i,r)};default:return null}}function R3e(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Number.isFinite(t)?t:function(e){return r.index=e.index,t(e.source,r)}}function Ase(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function(e){return r.indices=e.map(function(n){return n.index}),t(e.map(function(n){return n.source}),r)}}var ec,Ab,Sse={projectPoints:!1,viewport:null,createBufferObjects:!0,moduleSettings:{}},Qo=3402823466e29,aI=[32775,32774],oI=[32776,32774],Tse=[32776,32775],sI=(ec={},(0,Lu.default)(ec,gt.SUM,32774),(0,Lu.default)(ec,gt.MEAN,32774),(0,Lu.default)(ec,gt.MIN,aI),(0,Lu.default)(ec,gt.MAX,oI),ec);var wse={size:1,operation:gt.SUM,needMin:!1,needMax:!1,combineMaxMin:!1},Pse=4;var YAt={format:34836,type:5126,border:0,mipmaps:!1,parameters:(Ab={},(0,Lu.default)(Ab,10240,9728),(0,Lu.default)(Ab,10241,9728),Ab),dataFormat:6408,width:1,height:1};var Ose=`#define SHADER_NAME gpu-aggregation-to-grid-vs

attribute vec3 positions;
attribute vec3 positions64Low;
attribute vec3 weights;
uniform vec2 cellSize;
uniform vec2 gridSize;
uniform bool projectPoints;
uniform vec2 translation;
uniform vec3 scaling;

varying vec3 vWeights;

vec2 project_to_pixel(vec4 pos) {
  vec4 result;
  pos.xy = pos.xy/pos.w;
  result = pos + vec4(translation, 0., 0.);
  result.xy = scaling.z > 0. ? result.xy * scaling.xy : result.xy;
  return result.xy;
}

void main(void) {

  vWeights = weights;

  vec4 windowPos = vec4(positions, 1.);
  if (projectPoints) {
    windowPos = project_position_to_clipspace(positions, positions64Low, vec3(0));
  }

  vec2 pos = project_to_pixel(windowPos);

  vec2 pixelXY64[2];
  pixelXY64[0] = vec2(pos.x, 0.);
  pixelXY64[1] = vec2(pos.y, 0.);
  vec2 gridXY64[2];
  gridXY64[0] = div_fp64(pixelXY64[0], vec2(cellSize.x, 0));
  gridXY64[1] = div_fp64(pixelXY64[1], vec2(cellSize.y, 0));
  float x = floor(gridXY64[0].x);
  float y = floor(gridXY64[1].x);
  pos = vec2(x, y);
  pos = (pos * (2., 2.) / (gridSize)) - (1., 1.);
  vec2 offset = 1.0 / gridSize;
  pos = pos + offset;

  gl_Position = vec4(pos, 0.0, 1.0);
  gl_PointSize = 1.0;
}
`;var Ese=`#define SHADER_NAME gpu-aggregation-to-grid-fs

precision highp float;

varying vec3 vWeights;

void main(void) {
  gl_FragColor = vec4(vWeights, 1.0);
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;var Cse=`#version 300 es
#define SHADER_NAME gpu-aggregation-all-vs-64

in vec2 position;
uniform ivec2 gridSize;
out vec2 vTextureCoord;

void main(void) {
  vec2 pos = vec2(-1.0, -1.0);
  vec2 offset = 1.0 / vec2(gridSize);
  pos = pos + offset;

  gl_Position = vec4(pos, 0.0, 1.0);

  int yIndex = gl_InstanceID / gridSize[0];
  int xIndex = gl_InstanceID - (yIndex * gridSize[0]);

  vec2 yIndexFP64 = vec2(float(yIndex), 0.);
  vec2 xIndexFP64 = vec2(float(xIndex), 0.);
  vec2 gridSizeYFP64 = vec2(gridSize[1], 0.);
  vec2 gridSizeXFP64 = vec2(gridSize[0], 0.);

  vec2 texCoordXFP64 = div_fp64(yIndexFP64, gridSizeYFP64);
  vec2 texCoordYFP64 = div_fp64(xIndexFP64, gridSizeXFP64);

  vTextureCoord = vec2(texCoordYFP64.x, texCoordXFP64.x);
  gl_PointSize = 1.0;
}
`;var Mse=`#version 300 es
#define SHADER_NAME gpu-aggregation-all-fs

precision highp float;

in vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform bool combineMaxMin;
out vec4 fragColor;
void main(void) {
  vec4 textureColor = texture(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));
  if (textureColor.a == 0.) {
    discard;
  }
  fragColor.rgb = textureColor.rgb;
  fragColor.a = combineMaxMin ? textureColor.r : textureColor.a;
}
`;var Ise=`#define SHADER_NAME gpu-aggregation-transform-mean-vs
attribute vec4 aggregationValues;
varying vec4 meanValues;

void main()
{
  bool isCellValid = bool(aggregationValues.w > 0.);
  meanValues.xyz = isCellValid ? aggregationValues.xyz/aggregationValues.w : vec3(0, 0, 0);
  meanValues.w = aggregationValues.w;
  gl_PointSize = 1.0;
}
`;var Tb=h(B());var Sb,L3e=(Sb={},(0,Tb.default)(Sb,10240,9728),(0,Tb.default)(Sb,10241,9728),Sb);function tc(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=r.width,n=e===void 0?1:e,i=r.height,a=i===void 0?1:i,o=r.data,s=o===void 0?null:o,u=r.unpackFlipY,l=u===void 0?!0:u,f=r.parameters,c=f===void 0?L3e:f,p=new we(t,{data:s,format:ce(t)?34836:6408,type:5126,border:0,mipmaps:!1,parameters:c,dataFormat:6408,width:n,height:a,unpackFlipY:l});return p}function Hd(t,r){var e=r.id,n=r.width,i=n===void 0?1:n,a=r.height,o=a===void 0?1:a,s=r.texture,u=new Re(t,{id:e,width:i,height:o,attachments:(0,Tb.default)({},36064,s)});return u}function k3e(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=B3e(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function B3e(t,r){if(t){if(typeof t=="string")return Rse(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Rse(t,r)}}function Rse(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function Lse(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Mr(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Lse(Object(e),!0).forEach(function(n){(0,wb.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Lse(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var F3e=["aggregationBuffer","maxMinBuffer","minBuffer","maxBuffer"],kse={maxData:"maxBuffer",minData:"minBuffer",maxMinData:"maxMinBuffer"},D3e=[Se.WEBGL2,Se.COLOR_ATTACHMENT_RGBA32F,Se.BLEND_EQUATION_MINMAX,Se.FLOAT_BLEND,Se.TEXTURE_FLOAT],Ir=function(){function t(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};(0,Bse.default)(this,t),this.id=e.id||"gpu-grid-aggregator",this.gl=r,this.state={weightAttributes:{},textures:{},meanTextures:{},buffers:{},framebuffers:{},maxMinFramebuffers:{},minFramebuffers:{},maxFramebuffers:{},equations:{},resources:{},results:{}},this._hasGPUSupport=ce(r)&&dr(this.gl,Se.BLEND_EQUATION_MINMAX,Se.COLOR_ATTACHMENT_RGBA32F,Se.TEXTURE_FLOAT),this._hasGPUSupport&&this._setupModels()}return(0,Fse.default)(t,[{key:"delete",value:function(){var e=this.gridAggregationModel,n=this.allAggregationModel,i=this.meanTransform,a=this.state,o=a.textures,s=a.framebuffers,u=a.maxMinFramebuffers,l=a.minFramebuffers,f=a.maxFramebuffers,c=a.meanTextures,p=a.resources;e?.delete(),n?.delete(),i?.delete(),j3e([s,o,u,l,f,c,p])}},{key:"run",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.setState({results:{}});var n=this._normalizeAggregationParams(e);return this._hasGPUSupport||J.log(1,"GPUGridAggregator: not supported")(),this._runAggregation(n)}},{key:"getData",value:function(e){var n={},i=this.state.results;i[e].aggregationData||(i[e].aggregationData=i[e].aggregationBuffer.getData()),n.aggregationData=i[e].aggregationData;for(var a in kse){var o=kse[a];(i[e][a]||i[e][o])&&(i[e][a]=i[e][a]||i[e][o].getData(),n[a]=i[e][a])}return n}},{key:"updateShaders",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.setState({shaderOptions:e,modelDirty:!0})}},{key:"_normalizeAggregationParams",value:function(e){var n=Mr(Mr({},Sse),e),i=n.weights;return i&&(n.weights=N3e(i)),n}},{key:"setState",value:function(e){Object.assign(this.state,e)}},{key:"_getAggregateData",value:function(e){var n={},i=this.state,a=i.textures,o=i.framebuffers,s=i.maxMinFramebuffers,u=i.minFramebuffers,l=i.maxFramebuffers,f=i.resources,c=e.weights;for(var p in c){n[p]={};var d=c[p],v=d.needMin,m=d.needMax,g=d.combineMaxMin;n[p].aggregationTexture=a[p],n[p].aggregationBuffer=va(o[p],{target:c[p].aggregationBuffer,sourceType:5126}),v&&m&&g?(n[p].maxMinBuffer=va(s[p],{target:c[p].maxMinBuffer,sourceType:5126}),n[p].maxMinTexture=f["".concat(p,"-maxMinTexture")]):(v&&(n[p].minBuffer=va(u[p],{target:c[p].minBuffer,sourceType:5126}),n[p].minTexture=f["".concat(p,"-minTexture")]),m&&(n[p].maxBuffer=va(l[p],{target:c[p].maxBuffer,sourceType:5126}),n[p].maxTexture=f["".concat(p,"-maxTexture")]))}return this._trackGPUResultBuffers(n,c),n}},{key:"_renderAggregateData",value:function(e){var n=e.cellSize,i=e.projectPoints,a=e.attributes,o=e.moduleSettings,s=e.numCol,u=e.numRow,l=e.weights,f=e.translation,c=e.scaling,p=this.state,d=p.maxMinFramebuffers,v=p.minFramebuffers,m=p.maxFramebuffers,g=[s,u],y={blend:!0,depthTest:!1,blendFunc:[1,1]},_={cellSize:n,gridSize:g,projectPoints:i,translation:f,scaling:c};for(var b in l){var x=l[b],A=x.needMin,S=x.needMax,P=A&&S&&l[b].combineMaxMin;this._renderToWeightsTexture({id:b,parameters:y,moduleSettings:o,uniforms:_,gridSize:g,attributes:a,weights:l}),P?this._renderToMaxMinTexture({id:b,parameters:Mr(Mr({},y),{},{blendEquation:Tse}),gridSize:g,minOrMaxFb:d[b],clearParams:{clearColor:[0,0,0,Qo]},combineMaxMin:P}):(A&&this._renderToMaxMinTexture({id:b,parameters:Mr(Mr({},y),{},{blendEquation:aI}),gridSize:g,minOrMaxFb:v[b],clearParams:{clearColor:[Qo,Qo,Qo,0]},combineMaxMin:P}),S&&this._renderToMaxMinTexture({id:b,parameters:Mr(Mr({},y),{},{blendEquation:oI}),gridSize:g,minOrMaxFb:m[b],clearParams:{clearColor:[0,0,0,0]},combineMaxMin:P}))}}},{key:"_renderToMaxMinTexture",value:function(e){var n=e.id,i=e.parameters,a=e.gridSize,o=e.minOrMaxFb,s=e.combineMaxMin,u=e.clearParams,l=u===void 0?{}:u,f=this.state.framebuffers,c=this.gl,p=this.allAggregationModel;Le(c,Mr(Mr({},l),{},{framebuffer:o,viewport:[0,0,a[0],a[1]]}),function(){c.clear(16384),p.draw({parameters:i,uniforms:{uSampler:f[n].texture,gridSize:a,combineMaxMin:s}})})}},{key:"_renderToWeightsTexture",value:function(e){var n=e.id,i=e.parameters,a=e.moduleSettings,o=e.uniforms,s=e.gridSize,u=e.weights,l=this.state,f=l.framebuffers,c=l.equations,p=l.weightAttributes,d=this.gl,v=this.gridAggregationModel,m=u[n].operation,g=m===gt.MIN?[Qo,Qo,Qo,0]:[0,0,0,0];if(Le(d,{framebuffer:f[n],viewport:[0,0,s[0],s[1]],clearColor:g},function(){d.clear(16384);var A={weights:p[n]};v.draw({parameters:Mr(Mr({},i),{},{blendEquation:c[n]}),moduleSettings:a,uniforms:o,attributes:A})}),m===gt.MEAN){var y=this.state,_=y.meanTextures,b=y.textures,x={_sourceTextures:{aggregationValues:_[n]},_targetTexture:b[n],elementCount:b[n].width*b[n].height};this.meanTransform?this.meanTransform.update(x):this.meanTransform=z3e(d,x),this.meanTransform.run({parameters:{blend:!1,depthTest:!1}}),f[n].attach((0,wb.default)({},36064,b[n]))}}},{key:"_runAggregation",value:function(e){this._updateModels(e),this._setupFramebuffers(e),this._renderAggregateData(e);var n=this._getAggregateData(e);return this.setState({results:n}),n}},{key:"_setupFramebuffers",value:function(e){var n=this.state,i=n.textures,a=n.framebuffers,o=n.maxMinFramebuffers,s=n.minFramebuffers,u=n.maxFramebuffers,l=n.meanTextures,f=n.equations,c=e.weights,p=e.numCol,d=e.numRow,v={width:p,height:d};for(var m in c){var g=c[m],y=g.needMin,_=g.needMax,b=g.combineMaxMin,x=g.operation;i[m]=c[m].aggregationTexture||i[m]||tc(this.gl,{id:"".concat(m,"-texture"),width:p,height:d}),i[m].resize(v);var A=i[m];x===gt.MEAN&&(l[m]=l[m]||tc(this.gl,{id:"".concat(m,"-mean-texture"),width:p,height:d}),l[m].resize(v),A=l[m]),a[m]?a[m].attach((0,wb.default)({},36064,A)):a[m]=Hd(this.gl,{id:"".concat(m,"-fb"),width:p,height:d,texture:A}),a[m].resize(v),f[m]=sI[x]||sI.SUM,(y||_)&&(y&&_&&b?o[m]||(A=c[m].maxMinTexture||this._getMinMaxTexture("".concat(m,"-maxMinTexture")),o[m]=Hd(this.gl,{id:"".concat(m,"-maxMinFb"),texture:A})):(y&&(s[m]||(A=c[m].minTexture||this._getMinMaxTexture("".concat(m,"-minTexture")),s[m]=Hd(this.gl,{id:"".concat(m,"-minFb"),texture:A}))),_&&(u[m]||(A=c[m].maxTexture||this._getMinMaxTexture("".concat(m,"-maxTexture")),u[m]=Hd(this.gl,{id:"".concat(m,"-maxFb"),texture:A})))))}}},{key:"_getMinMaxTexture",value:function(e){var n=this.state.resources;return n[e]||(n[e]=tc(this.gl,{id:"resourceName"})),n[e]}},{key:"_setupModels",value:function(){var e,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.numCol,a=i===void 0?0:i,o=n.numRow,s=o===void 0?0:o,u=this.gl,l=this.state.shaderOptions;if((e=this.gridAggregationModel)===null||e===void 0||e.delete(),this.gridAggregationModel=U3e(u,l),!this.allAggregationModel){var f=a*s;this.allAggregationModel=G3e(u,f)}}},{key:"_setupWeightAttributes",value:function(e){var n=this.state.weightAttributes,i=e.weights;for(var a in i)n[a]=e.attributes[a]}},{key:"_trackGPUResultBuffers",value:function(e,n){var i=this.state.resources;for(var a in e)if(e[a]){var o=k3e(F3e),s;try{for(o.s();!(s=o.n()).done;){var u=s.value;if(e[a][u]&&n[a][u]!==e[a][u]){var l="gpu-result-".concat(a,"-").concat(u);i[l]&&i[l].delete(),i[l]=e[a][u]}}}catch(f){o.e(f)}finally{o.f()}}}},{key:"_updateModels",value:function(e){var n=e.vertexCount,i=e.attributes,a=e.numCol,o=e.numRow,s=this.state.modelDirty;s&&(this._setupModels(e),this.setState({modelDirty:!1})),this._setupWeightAttributes(e),this.gridAggregationModel.setVertexCount(n),this.gridAggregationModel.setAttributes(i),this.allAggregationModel.setInstanceCount(a*o)}}],[{key:"getAggregationData",value:function(e){var n=e.aggregationData,i=e.maxData,a=e.minData,o=e.maxMinData,s=e.pixelIndex,u=s*Pse,l={};return n&&(l.cellCount=n[u+3],l.cellWeight=n[u]),o?(l.maxCellWieght=o[0],l.minCellWeight=o[3]):(i&&(l.maxCellWieght=i[0],l.totalCount=i[3]),a&&(l.minCellWeight=a[0],l.totalCount=i[3])),l}},{key:"getCellData",value:function(e){for(var n=e.countsData,i=e.size,a=i===void 0?1:i,o=n.length/4,s=new Float32Array(o*a),u=new Uint32Array(o),l=0;l<o;l++){for(var f=0;f<a;f++)s[l*a+f]=n[l*4+f];u[l]=n[l*4+3]}return{cellCounts:u,cellWeights:s}}},{key:"isSupported",value:function(e){return dr(e,D3e)}}]),t}();function N3e(t){var r={};for(var e in t)r[e]=Mr(Mr({},wse),t[e]);return r}function j3e(t){t=Array.isArray(t)?t:[t],t.forEach(function(r){for(var e in r)r[e].delete()})}function U3e(t,r){var e=Ea({vs:Ose,fs:Ese,modules:[Ts,Je]},r);return new Ce(t,Mr({id:"Gird-Aggregation-Model",vertexCount:1,drawMode:0},e))}function G3e(t,r){return new Ce(t,{id:"All-Aggregation-Model",vs:Cse,fs:Mse,modules:[Ts],vertexCount:1,drawMode:0,isInstanced:!0,instanceCount:r,attributes:{position:[0,0]}})}function z3e(t,r){return new Nr(t,Mr({vs:Ise,_targetTextureVarying:"meanValues"},r))}var Use=h(L()),Gse=h(N()),zse=h(be()),Vse=h(Ee()),Hse=h(Y()),Wse=h(K()),Pb=h(q()),Wd=h(B());var Vn=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]];function es(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Float32Array,n;if(Number.isFinite(t[0]))n=new e(t);else{n=new e(t.length*4);for(var i=0,a=0;a<t.length;a++){var o=t[a];n[i++]=o[0],n[i++]=o[1],n[i++]=o[2],n[i++]=Number.isFinite(o[3])?o[3]:255}}if(r)for(var s=0;s<n.length;s++)n[s]/=255;return n}var Dse=`#define SHADER_NAME screen-grid-layer-vertex-shader
#define RANGE_COUNT 6

attribute vec3 positions;
attribute vec3 instancePositions;
attribute vec4 instanceCounts;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform vec3 cellScale;
uniform vec4 minColor;
uniform vec4 maxColor;
uniform vec4 colorRange[RANGE_COUNT];
uniform vec2 colorDomain;
uniform bool shouldUseMinMax;
uniform sampler2D maxTexture;

varying vec4 vColor;
varying float vSampleCount;

vec4 quantizeScale(vec2 domain, vec4 range[RANGE_COUNT], float value) {
  vec4 outColor = vec4(0., 0., 0., 0.);
  if (value >= domain.x && value <= domain.y) {
    float domainRange = domain.y - domain.x;
    if (domainRange <= 0.) {
      outColor = colorRange[0];
    } else {
      float rangeCount = float(RANGE_COUNT);
      float rangeStep = domainRange / rangeCount;
      float idx = floor((value - domain.x) / rangeStep);
      idx = clamp(idx, 0., rangeCount - 1.);
      int intIdx = int(idx);
      outColor = colorRange[intIdx];
    }
  }
  outColor = outColor / 255.;
  return outColor;
}

void main(void) {
  vSampleCount = instanceCounts.a;

  float weight = instanceCounts.r;
  float maxWeight = texture2D(maxTexture, vec2(0.5)).r;

  float step = weight / maxWeight;
  vec4 minMaxColor = mix(minColor, maxColor, step) / 255.;

  vec2 domain = colorDomain;
  float domainMaxValid = float(colorDomain.y != 0.);
  domain.y = mix(maxWeight, colorDomain.y, domainMaxValid);
  vec4 rangeColor = quantizeScale(domain, colorRange, weight);

  float rangeMinMax = float(shouldUseMinMax);
  vec4 color = mix(rangeColor, minMaxColor, rangeMinMax);
  vColor = vec4(color.rgb, color.a * opacity);
  picking_setPickingColor(instancePickingColors);

  gl_Position = vec4(instancePositions + positions * cellScale, 1.);
}
`;var Nse=`#define SHADER_NAME screen-grid-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying float vSampleCount;

void main(void) {
  if (vSampleCount <= 0.0) {
    discard;
  }
  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;function jse(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function uI(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?jse(Object(e),!0).forEach(function(n){(0,Wd.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):jse(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function V3e(t){var r=H3e();return function(){var n=(0,Pb.default)(t),i;if(r){var a=(0,Pb.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Wse.default)(this,i)}}function H3e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var W3e=[0,0,0,0],$3e=[0,255,0,255],X3e=["minColor","maxColor","colorRange","colorDomain"],q3e={cellSizePixels:{value:100,min:1},cellMarginPixels:{value:2,min:0,max:5},colorDomain:null,colorRange:Vn},rc=function(t){(0,Hse.default)(e,t);var r=V3e(e);function e(){var n;(0,Use.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,Wd.default)((0,zse.default)(n),"state",void 0),n}return(0,Gse.default)(e,[{key:"getShaders",value:function(){return{vs:Dse,fs:Nse,modules:[st]}}},{key:"initializeState",value:function(){var i=this.context.gl,a=this.getAttributeManager();a.addInstanced({instancePositions:{size:3,update:this.calculateInstancePositions},instanceCounts:{size:4,noAlloc:!0}}),this.setState({model:this._getModel(i)})}},{key:"shouldUpdateState",value:function(i){var a=i.changeFlags;return a.somethingChanged}},{key:"updateState",value:function(i){(0,Vse.default)((0,Pb.default)(e.prototype),"updateState",this).call(this,i);var a=i.oldProps,o=i.props,s=i.changeFlags,u=this.getAttributeManager();o.numInstances!==a.numInstances?u.invalidateAll():a.cellSizePixels!==o.cellSizePixels&&u.invalidate("instancePositions"),this._updateUniforms(a,o,s)}},{key:"draw",value:function(i){var a=i.uniforms,o=this.props,s=o.parameters,u=o.maxTexture,l=this.props.minColor||W3e,f=this.props.maxColor||$3e,c=this.props.colorDomain||[1,0],p=this.state.model;p.setUniforms(a).setUniforms({minColor:l,maxColor:f,maxTexture:u,colorDomain:c}).draw({parameters:uI({depthTest:!1,depthMask:!1},s)})}},{key:"calculateInstancePositions",value:function(i,a){for(var o=a.numInstances,s=this.context.viewport,u=s.width,l=s.height,f=this.props.cellSizePixels,c=Math.ceil(u/f),p=i.value,d=i.size,v=0;v<o;v++){var m=v%c,g=Math.floor(v/c);p[v*d+0]=m*f/u*2-1,p[v*d+1]=1-g*f/l*2,p[v*d+2]=0}}},{key:"_getModel",value:function(i){return new Ce(i,uI(uI({},this.getShaders()),{},{id:this.props.id,geometry:new Me({drawMode:6,attributes:{positions:new Float32Array([0,0,0,1,0,0,1,1,0,0,1,0])}}),isInstanced:!0}))}},{key:"_shouldUseMinMax",value:function(){var i=this.props,a=i.minColor,o=i.maxColor,s=i.colorDomain,u=i.colorRange;return a||o?(J.deprecated("ScreenGridLayer props: minColor and maxColor","colorRange, colorDomain")(),!0):!(s||u)}},{key:"_updateUniforms",value:function(i,a,o){var s=this.state.model;if(X3e.some(function(g){return i[g]!==a[g]})&&s.setUniforms({shouldUseMinMax:this._shouldUseMinMax()}),i.colorRange!==a.colorRange&&s.setUniforms({colorRange:es(a.colorRange)}),i.cellMarginPixels!==a.cellMarginPixels||i.cellSizePixels!==a.cellSizePixels||o.viewportChanged){var u=this.context.viewport,l=u.width,f=u.height,c=this.props,p=c.cellSizePixels,d=c.cellMarginPixels,v=p>d?d:0,m=new Float32Array([(p-v)/l*2,-(p-v)/f*2,1]);s.setUniforms({cellScale:m})}}}],[{key:"isSupported",value:function(i){return dr(i,[Se.TEXTURE_FLOAT])}}]),e}(He);(0,Wd.default)(rc,"layerName","ScreenGridCellLayer");(0,Wd.default)(rc,"defaultProps",q3e);var Tue=h(L()),wue=h(N()),Pue=h(be()),Rb=h(Ee()),Oue=h(Y()),Eue=h(K()),ac=h(q()),pI=h(B());var Yse=h(L()),Kse=h(N()),Zse=h(be()),lI=h(Ee()),Jse=h(Y()),Qse=h(K()),$d=h(q()),fI=h(B());function $se(t,r){var e={};for(var n in t)r.includes(n)||(e[n]=t[n]);return e}function Xse(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=Y3e(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function Y3e(t,r){if(t){if(typeof t=="string")return qse(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return qse(t,r)}}function qse(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function K3e(t){var r=Z3e();return function(){var n=(0,$d.default)(t),i;if(r){var a=(0,$d.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Qse.default)(this,i)}}function Z3e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var xi=function(t){(0,Jse.default)(e,t);var r=K3e(e);function e(){var n;(0,Yse.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,fI.default)((0,Zse.default)(n),"state",void 0),n}return(0,Kse.default)(e,[{key:"initializeAggregationLayer",value:function(i){(0,lI.default)((0,$d.default)(e.prototype),"initializeState",this).call(this,this.context),this.setState({ignoreProps:$se(this.constructor._propTypes,i.data.props),dimensions:i})}},{key:"updateState",value:function(i){(0,lI.default)((0,$d.default)(e.prototype),"updateState",this).call(this,i);var a=i.changeFlags;if(a.extensionsChanged){var o=this.getShaders({});o&&o.defines&&(o.defines.NON_INSTANCED_MODEL=1),this.updateShaders(o)}this._updateAttributes()}},{key:"updateAttributes",value:function(i){this.setState({changedAttributes:i})}},{key:"getAttributes",value:function(){return this.getAttributeManager().getShaderAttributes()}},{key:"getModuleSettings",value:function(){var i=this.context,a=i.viewport,o=i.mousePosition,s=i.gl,u=Object.assign(Object.create(this.props),{viewport:a,mousePosition:o,pickingActive:0,devicePixelRatio:_r(s)});return u}},{key:"updateShaders",value:function(i){}},{key:"isAggregationDirty",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=i.props,s=i.oldProps,u=i.changeFlags,l=a.compareAll,f=l===void 0?!1:l,c=a.dimension,p=this.state.ignoreProps,d=c.props,v=c.accessors,m=v===void 0?[]:v,g=u.updateTriggersChanged;if(u.dataChanged)return!0;if(g){if(g.all)return!0;var y=Xse(m),_;try{for(y.s();!(_=y.n()).done;){var b=_.value;if(g[b])return!0}}catch(P){y.e(P)}finally{y.f()}}if(f)return u.extensionsChanged?!0:Xl({oldProps:s,newProps:o,ignoreProps:p,propTypes:this.constructor._propTypes});var x=Xse(d),A;try{for(x.s();!(A=x.n()).done;){var S=A.value;if(o[S]!==s[S])return!0}}catch(P){x.e(P)}finally{x.f()}return!1}},{key:"isAttributeChanged",value:function(i){var a=this.state.changedAttributes;return i?a&&a[i]!==void 0:!J3e(a)}},{key:"_getAttributeManager",value:function(){return new Eo(this.context.gl,{id:this.props.id,stats:this.context.stats})}}]),e}(Ot);(0,fI.default)(xi,"layerName","AggregationLayer");function J3e(t){var r=!0;for(var e in t){r=!1;break}return r}var Eb=h(me()),pue=h(L()),hue=h(N()),ts=h(B());function Q3e(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=eFe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function eFe(t,r){if(t){if(typeof t=="string")return eue(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return eue(t,r)}}function eue(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function Ob(t,r,e){var n=e;return n.domain=function(){return t},n.range=function(){return r},n}function tue(t,r){var e=function(i){return uFe(t,r,i)};return Ob(t,r,e)}function tFe(t,r){var e=function(i){return lFe(t,r,i)};return Ob(t,r,e)}function rFe(t,r){for(var e=t.sort(rue),n=0,i=Math.max(1,r.length),a=new Array(i-1);++n<i;)a[n-1]=nFe(e,n/i);var o=function(u){return aFe(a,r,u)};return o.thresholds=function(){return a},Ob(t,r,o)}function rue(t,r){return t-r}function nFe(t,r){var e=t.length;if(r<=0||e<2)return t[0];if(r>=1)return t[e-1];var n=(e-1)*r,i=Math.floor(n),a=t[i],o=t[i+1];return a+(o-a)*(n-i)}function iFe(t,r){for(var e=0,n=t.length;e<n;){var i=e+n>>>1;rue(t[i],r)>0?n=i:e=i+1}return e}function aFe(t,r,e){return r[iFe(t,e)]}function oFe(t,r,e,n){var i="".concat(n),a=r.get(i);return a===void 0&&(a=t.push(n),r.set(i,a)),e[(a-1)%e.length]}function sFe(t,r){var e=new Map,n=[],i=Q3e(t),a;try{for(i.s();!(a=i.n()).done;){var o=a.value,s="".concat(o);e.has(s)||e.set(s,n.push(o))}}catch(l){i.e(l)}finally{i.f()}var u=function(f){return oFe(n,e,r,f)};return Ob(t,r,u)}function uFe(t,r,e){var n=t[1]-t[0];if(n<=0)return J.warn("quantizeScale: invalid domain, returning range[0]")(),r[0];var i=n/r.length,a=Math.floor((e-t[0])/i),o=Math.max(Math.min(a,r.length-1),0);return r[o]}function lFe(t,r,e){return(e-t[0])/(t[1]-t[0])*(r[1]-r[0])+r[0]}function nue(t){return t!=null}function fFe(t){var r=[];return t.forEach(function(e){!r.includes(e)&&nue(e)&&r.push(e)}),r}function iue(t,r){var e=typeof r=="function"?t.map(r):t;return e.filter(nue)}function aue(t,r){return iue(t,r)}function oue(t,r){return fFe(iue(t,r))}function sue(t,r,e){return Math.max(r,Math.min(e,t))}function uue(t){switch(t){case"quantize":return tue;case"linear":return tFe;case"quantile":return rFe;case"ordinal":return sFe;default:return tue}}function lue(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=cFe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function cFe(t,r){if(t){if(typeof t=="string")return fue(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return fue(t,r)}}function fue(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var due=function(r){return r.length},pFe=3402823466e29,vue=function(r){return r.points},mue=function(r){return r.index},cue=function(r,e){return r<e?-1:r>e?1:r>=e?0:NaN},hFe={getValue:due,getPoints:vue,getIndex:mue,filterData:null},nc=function(){function t(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:hFe;(0,pue.default)(this,t),(0,ts.default)(this,"maxCount",void 0),(0,ts.default)(this,"maxValue",void 0),(0,ts.default)(this,"minValue",void 0),(0,ts.default)(this,"totalCount",void 0),(0,ts.default)(this,"aggregatedBins",void 0),(0,ts.default)(this,"sortedBins",void 0),(0,ts.default)(this,"binMap",void 0),this.aggregatedBins=this.getAggregatedBins(r,e),this._updateMinMaxValues(),this.binMap=this.getBinMap()}return(0,hue.default)(t,[{key:"getAggregatedBins",value:function(e,n){for(var i=n.getValue,a=i===void 0?due:i,o=n.getPoints,s=o===void 0?vue:o,u=n.getIndex,l=u===void 0?mue:u,f=n.filterData,c=typeof f=="function",p=e.length,d=[],v=0,m=0;m<p;m++){var g=e[m],y=s(g),_=l(g),b=c?y.filter(f):y;g.filteredPoints=c?b:null;var x=b.length?a(b):null;x!=null&&(d[v]={i:Number.isFinite(_)?_:m,value:x,counts:b.length},v++)}return d}},{key:"_percentileToIndex",value:function(e){var n=this.sortedBins.length;if(n<2)return[0,0];var i=e.map(function(f){return sue(f,0,100)}),a=(0,Eb.default)(i,2),o=a[0],s=a[1],u=Math.ceil(o/100*(n-1)),l=Math.floor(s/100*(n-1));return[u,l]}},{key:"getBinMap",value:function(){var e={},n=lue(this.aggregatedBins),i;try{for(n.s();!(i=n.n()).done;){var a=i.value;e[a.i]=a}}catch(o){n.e(o)}finally{n.f()}return e}},{key:"_updateMinMaxValues",value:function(){var e=0,n=0,i=pFe,a=0,o=lue(this.aggregatedBins),s;try{for(o.s();!(s=o.n()).done;){var u=s.value;e=e>u.counts?e:u.counts,n=n>u.value?n:u.value,i=i<u.value?i:u.value,a+=u.counts}}catch(l){o.e(l)}finally{o.f()}this.maxCount=e,this.maxValue=n,this.minValue=i,this.totalCount=a}},{key:"getValueRange",value:function(e){if(this.sortedBins||(this.sortedBins=this.aggregatedBins.sort(function(o,s){return cue(o.value,s.value)})),!this.sortedBins.length)return[];var n=0,i=this.sortedBins.length-1;if(Array.isArray(e)){var a=this._percentileToIndex(e);n=a[0],i=a[1]}return[this.sortedBins[n].value,this.sortedBins[i].value]}},{key:"getValueDomainByScale",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],i=(0,Eb.default)(n,2),a=i[0],o=a===void 0?0:a,s=i[1],u=s===void 0?100:s;if(this.sortedBins||(this.sortedBins=this.aggregatedBins.sort(function(f,c){return cue(f.value,c.value)})),!this.sortedBins.length)return[];var l=this._percentileToIndex([o,u]);return this._getScaleDomain(e,l)}},{key:"_getScaleDomain",value:function(e,n){var i=(0,Eb.default)(n,2),a=i[0],o=i[1],s=this.sortedBins;switch(e){case"quantize":case"linear":return[s[a].value,s[o].value];case"quantile":return aue(s.slice(a,o+1),function(u){return u.value});case"ordinal":return oue(s,function(u){return u.value});default:return[s[a].value,s[o].value]}}}]),t}();var xue=h(B()),Aue=h(me());var yue=6378e3;function Cb(t){return Number.isFinite(t)?t:0}function Mb(t,r){for(var e=t.positions.value,n=1/0,i=-1/0,a=1/0,o=-1/0,s,u,l=0;l<r;l++)u=e[l*3],s=e[l*3+1],n=s<n?s:n,i=s>i?s:i,a=u<a?u:a,o=u>o?u:o;var f={xMin:Cb(a),xMax:Cb(o),yMin:Cb(n),yMax:Cb(i)};return f}function dFe(t,r,e,n){var i=n.width,a=n.height,o=e===ue.CARTESIAN?[-i/2,-a/2]:[-180,-90];J.assert(e===ue.CARTESIAN||e===ue.LNGLAT||e===ue.DEFAULT);var s=t.xMin,u=t.yMin;return[-1*(gue(s-o[0],r.xOffset)+o[0]),-1*(gue(u-o[1],r.yOffset)+o[1])]}function gue(t,r){var e=t<0?-1:1,n=e<0?Math.abs(t)+r:Math.abs(t);return n=Math.floor(n/r)*r,n*e}function cI(t,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!e)return{xOffset:r,yOffset:r};var n=t.yMin,i=t.yMax,a=(n+i)/2;return vFe(r,a)}function Ib(t,r,e,n){var i=cI(t,r,n!==ue.CARTESIAN),a=dFe(t,i,n,e),o=t.xMin,s=t.yMin,u=t.xMax,l=t.yMax,f=u-o+i.xOffset,c=l-s+i.yOffset,p=Math.ceil(f/i.xOffset),d=Math.ceil(c/i.yOffset);return{gridOffset:i,translation:a,width:f,height:c,numCol:p,numRow:d}}function vFe(t,r){var e=mFe(t),n=gFe(r,t);return{yOffset:e,xOffset:n}}function mFe(t){return t/yue*(180/Math.PI)}function gFe(t,r){return r/yue*(180/Math.PI)/Math.cos(t*Math.PI/180)}function _ue(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function yFe(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?_ue(Object(e),!0).forEach(function(n){(0,xue.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):_ue(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function _Fe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=bFe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function bFe(t,r){if(t){if(typeof t=="string")return bue(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return bue(t,r)}}function bue(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function ic(t,r){var e=xFe(t,r),n=AFe(e);return{gridHash:e.gridHash,gridOffset:e.gridOffset,data:n}}function xFe(t,r){var e=t.data,n=e===void 0?[]:e,i=t.cellSize,a=r.attributes,o=r.viewport,s=r.projectPoints,u=r.numInstances,l=a.positions.value,f=a.positions.getAccessor(),c=f.size,p=r.boundingBox||SFe(a.positions,u),d=r.posOffset||[180,90],v=r.gridOffset||cI(p,i);if(v.xOffset<=0||v.yOffset<=0)return{gridHash:{},gridOffset:v};var m=o.width,g=o.height,y=Math.ceil(m/v.xOffset),_=Math.ceil(g/v.yOffset),b={},x=Ut(n),A=x.iterable,S=x.objectInfo,P=new Array(3),O=_Fe(A),C;try{for(O.s();!(C=O.n()).done;){var T=C.value;S.index++,P[0]=l[S.index*c],P[1]=l[S.index*c+1],P[2]=c>=3?l[S.index*c+2]:0;var I=s?o.project(P):P,R=(0,Aue.default)(I,2),V=R[0],z=R[1];if(Number.isFinite(V)&&Number.isFinite(z)){var k=Math.floor((z+d[1])/v.yOffset),G=Math.floor((V+d[0])/v.xOffset);if(!s||G>=0&&G<y&&k>=0&&k<_){var U="".concat(k,"-").concat(G);b[U]=b[U]||{count:0,points:[],lonIdx:G,latIdx:k},b[U].count+=1,b[U].points.push({source:T,index:S.index})}}}}catch($){O.e($)}finally{O.f()}return{gridHash:b,gridOffset:v,offsets:[d[0]*-1,d[1]*-1]}}function AFe(t){var r=t.gridHash,e=t.gridOffset,n=t.offsets,i=new Array(Object.keys(r).length),a=0;for(var o in r){var s=o.split("-"),u=parseInt(s[0],10),l=parseInt(s[1],10),f=a++;i[f]=yFe({index:f,position:[n[0]+e.xOffset*l,n[1]+e.yOffset*u]},r[o])}return i}function SFe(t,r){for(var e=t.value,n=t.getAccessor(),i=n.size,a=1/0,o=-1/0,s=1/0,u=-1/0,l,f,c=0;c<r;c++)f=e[c*i],l=e[c*i+1],Number.isFinite(f)&&Number.isFinite(l)&&(a=l<a?l:a,o=l>o?l:o,s=f<s?f:s,u=f>u?f:u);return{xMin:s,xMax:u,yMin:a,yMax:o}}function TFe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=wFe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function wFe(t,r){if(t){if(typeof t=="string")return Sue(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Sue(t,r)}}function Sue(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function PFe(t){var r=OFe();return function(){var n=(0,ac.default)(t),i;if(r){var a=(0,ac.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Eue.default)(this,i)}}function OFe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ku=function(t){(0,Oue.default)(e,t);var r=PFe(e);function e(){var n;(0,Tue.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,pI.default)((0,Pue.default)(n),"state",void 0),n}return(0,wue.default)(e,[{key:"initializeAggregationLayer",value:function(i){var a=i.dimensions,o=this.context.gl;(0,Rb.default)((0,ac.default)(e.prototype),"initializeAggregationLayer",this).call(this,a),this.setState({layerData:{},gpuGridAggregator:new Ir(o,{id:"".concat(this.id,"-gpu-aggregator")}),cpuGridAggregator:ic})}},{key:"updateState",value:function(i){(0,Rb.default)((0,ac.default)(e.prototype),"updateState",this).call(this,i),this.updateAggregationState(i);var a=this.state,o=a.aggregationDataDirty,s=a.aggregationWeightsDirty,u=a.gpuAggregation;if(!(this.getNumInstances()<=0)){var l=!1;(o||u&&s)&&(this._updateAggregation(i),l=!0),!u&&(o||s)&&(this._updateWeightBins(),this._uploadAggregationResults(),l=!0),this.setState({aggregationDirty:l})}}},{key:"finalizeState",value:function(i){var a,o=this.state.weights.count;o&&o.aggregationBuffer&&o.aggregationBuffer.delete(),(a=this.state.gpuGridAggregator)===null||a===void 0||a.delete(),(0,Rb.default)((0,ac.default)(e.prototype),"finalizeState",this).call(this,i)}},{key:"updateShaders",value:function(i){this.state.gpuAggregation&&this.state.gpuGridAggregator.updateShaders(i)}},{key:"updateAggregationState",value:function(i){J.assert(!1)}},{key:"allocateResources",value:function(i,a){if(this.state.numRow!==i||this.state.numCol!==a){var o=a*i*4*4,s=this.context.gl,u=this.state.weights;for(var l in u){var f=u[l];f.aggregationBuffer&&f.aggregationBuffer.delete(),f.aggregationBuffer=new xe(s,{byteLength:o,accessor:{size:4,type:5126,divisor:1}})}}}},{key:"updateResults",value:function(i){var a=i.aggregationData,o=i.maxMinData,s=i.maxData,u=i.minData,l=this.state.weights.count;l&&(l.aggregationData=a,l.maxMinData=o,l.maxData=s,l.minData=u)}},{key:"_updateAggregation",value:function(i){var a=this.state,o=a.cpuGridAggregator,s=a.gpuGridAggregator,u=a.gridOffset,l=a.posOffset,f=a.translation,c=f===void 0?[0,0]:f,p=a.scaling,d=p===void 0?[0,0,0]:p,v=a.boundingBox,m=a.projectPoints,g=a.gpuAggregation,y=a.numCol,_=a.numRow,b=i.props,x=this.context.viewport,A=this.getAttributes(),S=this.getNumInstances();if(g){var O=this.state.weights;s.run({weights:O,cellSize:[u.xOffset,u.yOffset],numCol:y,numRow:_,translation:c,scaling:d,vertexCount:S,projectPoints:m,attributes:A,moduleSettings:this.getModuleSettings()})}else{var P=o(b,{gridOffset:u,projectPoints:m,attributes:A,viewport:x,posOffset:l,boundingBox:v});this.setState({layerData:P})}}},{key:"_updateWeightBins",value:function(){var i=this.state.getValue,a=new nc(this.state.layerData.data||[],{getValue:i});this.setState({sortedBins:a})}},{key:"_uploadAggregationResults",value:function(){var i=this.state,a=i.numCol,o=i.numRow,s=this.state.layerData.data,u=this.state.sortedBins,l=u.aggregatedBins,f=u.minValue,c=u.maxValue,p=u.totalCount,d=4,v=a*o*d,m=new Float32Array(v).fill(0),g=TFe(l),y;try{for(g.s();!(y=g.n()).done;){var _=y.value,b=s[_.i],x=b.lonIdx,A=b.latIdx,S=_.value,P=_.counts,O=(x+A*a)*d;m[O]=S,m[O+d-1]=P}}catch(R){g.e(R)}finally{g.f()}var C=new Float32Array([c,0,0,f]),T=new Float32Array([c,0,0,p]),I=new Float32Array([f,0,0,p]);this.updateResults({aggregationData:m,maxMinData:C,maxData:T,minData:I})}}]),e}(xi);(0,pI.default)(ku,"layerName","GridAggregationLayer");function EFe(t){var r=CFe();return function(){var n=(0,oc.default)(t),i;if(r){var a=(0,oc.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Bue.default)(this,i)}}function CFe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Cue(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function hI(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Cue(Object(e),!0).forEach(function(n){(0,Bu.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Cue(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var MFe=hI(hI({},rc.defaultProps),{},{getPosition:{type:"accessor",value:function(r){return r.position}},getWeight:{type:"accessor",value:1},gpuAggregation:!0,aggregation:"SUM"}),Mue="positions",IFe={data:{props:["cellSizePixels"]},weights:{props:["aggregation"],accessors:["getWeight"]}},kb=function(t){(0,kue.default)(e,t);var r=EFe(e);function e(){var n;(0,Iue.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,Bu.default)((0,Lue.default)(n),"state",void 0),n}return(0,Rue.default)(e,[{key:"initializeState",value:function(){var i,a=this.context.gl;if(!rc.isSupported(a)){this.setState({supported:!1}),J.error("ScreenGridLayer: ".concat(this.id," is not supported on this browser"))();return}(0,Lb.default)((0,oc.default)(e.prototype),"initializeAggregationLayer",this).call(this,{dimensions:IFe,getCellSize:function(l){return l.cellSizePixels}});var o={count:{size:1,operation:gt.SUM,needMax:!0,maxTexture:tc(a,{id:"".concat(this.id,"-max-texture")})}};this.setState({supported:!0,projectPoints:!0,weights:o,subLayerData:{attributes:{}},maxTexture:o.count.maxTexture,positionAttributeName:"positions",posOffset:[0,0],translation:[1,-1]});var s=this.getAttributeManager();s.add((i={},(0,Bu.default)(i,Mue,{size:3,accessor:"getPosition",type:5130,fp64:this.use64bitPositions()}),(0,Bu.default)(i,"count",{size:3,accessor:"getWeight"}),i))}},{key:"shouldUpdateState",value:function(i){var a=i.changeFlags;return this.state.supported&&a.somethingChanged}},{key:"updateState",value:function(i){(0,Lb.default)((0,oc.default)(e.prototype),"updateState",this).call(this,i)}},{key:"renderLayers",value:function(){if(!this.state.supported)return[];var i=this.state,a=i.maxTexture,o=i.numRow,s=i.numCol,u=i.weights,l=this.props.updateTriggers,f=u.count.aggregationBuffer,c=this.getSubLayerClass("cells",rc);return new c(this.props,this.getSubLayerProps({id:"cell-layer",updateTriggers:l}),{data:{attributes:{instanceCounts:f}},maxTexture:a,numInstances:o*s})}},{key:"finalizeState",value:function(i){(0,Lb.default)((0,oc.default)(e.prototype),"finalizeState",this).call(this,i);var a=this.state,o=a.aggregationBuffer,s=a.maxBuffer,u=a.maxTexture;o?.delete(),s?.delete(),u?.delete()}},{key:"getPickingInfo",value:function(i){var a=i.info,o=a.index;if(o>=0){var s=this.state,u=s.gpuGridAggregator,l=s.gpuAggregation,f=s.weights,c=l?u.getData("count"):f.count;a.object=Ir.getAggregationData(hI({pixelIndex:o},c))}return a}},{key:"updateResults",value:function(i){var a=i.aggregationData,o=i.maxData,s=this.state.weights.count;s.aggregationData=a,s.aggregationBuffer.setData({data:a}),s.maxData=o,s.maxTexture.setImageData({data:o})}},{key:"updateAggregationState",value:function(i){var a=i.props.cellSizePixels,o=i.oldProps.cellSizePixels!==a,s=i.changeFlags.viewportChanged,u=i.props.gpuAggregation;this.state.gpuAggregation!==i.props.gpuAggregation&&u&&!Ir.isSupported(this.context.gl)&&(J.warn("GPU Grid Aggregation not supported, falling back to CPU")(),u=!1);var l=u!==this.state.gpuAggregation;this.setState({gpuAggregation:u});var f=this.isAttributeChanged(Mue),c=this.state.dimensions,p=c.data,d=c.weights,v=f||l||s||this.isAggregationDirty(i,{compareAll:u,dimension:p}),m=this.isAggregationDirty(i,{dimension:d});this.setState({aggregationDataDirty:v,aggregationWeightsDirty:m});var g=this.context.viewport;if(s||o){var y=g.width,_=g.height,b=Math.ceil(y/a),x=Math.ceil(_/a);this.allocateResources(x,b),this.setState({scaling:[y/2,-_/2,1],gridOffset:{xOffset:a,yOffset:a},width:y,height:_,numCol:b,numRow:x})}m&&this._updateAccessors(i),(v||m)&&this._resetResults()}},{key:"_updateAccessors",value:function(i){var a=i.props,o=a.getWeight,s=a.aggregation,u=a.data,l=this.state.weights.count;l&&(l.getWeight=o,l.operation=gt[s]),this.setState({getValue:Qf(s,o,{data:u})})}},{key:"_resetResults",value:function(){var i=this.state.weights.count;i&&(i.aggregationData=null)}}]),e}(ku);(0,Bu.default)(kb,"layerName","ScreenGridLayer");(0,Bu.default)(kb,"defaultProps",MFe);var Vue=h(L()),Hue=h(N()),Wue=h(Ee()),$ue=h(Y()),Xue=h(K()),Bb=h(q()),mI=h(B());var dI=h(ze()),vI=h(B()),Uue=h(L()),Gue=h(N());function Fue(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Ai(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Fue(Object(e),!0).forEach(function(n){(0,vI.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Fue(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function Due(){}var Nue=["getBins","getDomain","getScaleFunc"],jue=[{key:"fillColor",accessor:"getFillColor",pickingInfo:"colorValue",getBins:{triggers:{value:{prop:"getColorValue",updateTrigger:"getColorValue"},weight:{prop:"getColorWeight",updateTrigger:"getColorWeight"},aggregation:{prop:"colorAggregation"},filterData:{prop:"_filterData",updateTrigger:"_filterData"}}},getDomain:{triggers:{lowerPercentile:{prop:"lowerPercentile"},upperPercentile:{prop:"upperPercentile"},scaleType:{prop:"colorScaleType"}}},getScaleFunc:{triggers:{domain:{prop:"colorDomain"},range:{prop:"colorRange"}},onSet:{props:"onSetColorDomain"}},nullValue:[0,0,0,0]},{key:"elevation",accessor:"getElevation",pickingInfo:"elevationValue",getBins:{triggers:{value:{prop:"getElevationValue",updateTrigger:"getElevationValue"},weight:{prop:"getElevationWeight",updateTrigger:"getElevationWeight"},aggregation:{prop:"elevationAggregation"},filterData:{prop:"_filterData",updateTrigger:"_filterData"}}},getDomain:{triggers:{lowerPercentile:{prop:"elevationLowerPercentile"},upperPercentile:{prop:"elevationUpperPercentile"},scaleType:{prop:"elevationScaleType"}}},getScaleFunc:{triggers:{domain:{prop:"elevationDomain"},range:{prop:"elevationRange"}},onSet:{props:"onSetElevationDomain"}},nullValue:-1}],RFe=function(r){return r.cellSize},sc=function(){function t(r){(0,Uue.default)(this,t),this.state={layerData:{},dimensions:{}},this.changeFlags={},this.dimensionUpdaters={},this._getCellSize=r.getCellSize||RFe,this._getAggregator=r.getAggregator,this._addDimension(r.dimensions||jue)}return(0,Gue.default)(t,[{key:"updateState",value:function(e,n){var i=e.oldProps,a=e.props,o=e.changeFlags;this.updateGetValueFuncs(i,a,o);var s=this.needsReProjectPoints(i,a,o),u=!1;if(o.dataChanged||s)this.getAggregatedData(a,n),u=!0;else{var l=this.getDimensionChanges(i,a,o)||[];l.forEach(function(f){return typeof f=="function"&&f()}),u=!0}return this.setState({aggregationDirty:u}),this.state}},{key:"setState",value:function(e){this.state=Ai(Ai({},this.state),e)}},{key:"setDimensionState",value:function(e,n){this.setState({dimensions:Ai(Ai({},this.state.dimensions),{},(0,vI.default)({},e,Ai(Ai({},this.state.dimensions[e]),n)))})}},{key:"normalizeResult",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e.hexagons?Ai({data:e.hexagons},e):e.layerData?Ai({data:e.layerData},e):e}},{key:"getAggregatedData",value:function(e,n){var i=this._getAggregator(e),a=i(e,n);this.setState({layerData:this.normalizeResult(a)}),this.changeFlags={layerData:!0},this.getSortedBins(e)}},{key:"updateGetValueFuncs",value:function(e,n,i){for(var a in this.dimensionUpdaters){var o=this.dimensionUpdaters[a].getBins.triggers,s=o.value,u=o.weight,l=o.aggregation,f=n[s.prop],c=this.needUpdateDimensionStep(this.dimensionUpdaters[a].getBins,e,n,i);c&&(f?f=Ase(f,{data:n.data}):f=Qf(n[l.prop],n[u.prop],{data:n.data})),f&&this.setDimensionState(a,{getValue:f})}}},{key:"needsReProjectPoints",value:function(e,n,i){return this._getCellSize(e)!==this._getCellSize(n)||this._getAggregator(e)!==this._getAggregator(n)||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPosition)}},{key:"addDimension",value:function(e){this._addDimension(e)}},{key:"_addDimension",value:function(){var e=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];n.forEach(function(i){var a=i.key;e.dimensionUpdaters[a]=e.getDimensionUpdaters(i),e.state.dimensions[a]={getValue:null,domain:null,sortedBins:null,scaleFunc:Due}})}},{key:"getDimensionUpdaters",value:function(e){var n=e.key,i=e.accessor,a=e.pickingInfo,o=e.getBins,s=e.getDomain,u=e.getScaleFunc,l=e.nullValue;return{key:n,accessor:i,pickingInfo:a,getBins:Ai({updater:this.getDimensionSortedBins},o),getDomain:Ai({updater:this.getDimensionValueDomain},s),getScaleFunc:Ai({updater:this.getDimensionScale},u),attributeAccessor:this.getSubLayerDimensionAttribute(n,l)}}},{key:"needUpdateDimensionStep",value:function(e,n,i,a){return Object.values(e.triggers).some(function(o){return o.updateTrigger?a.dataChanged||a.updateTriggersChanged&&(a.updateTriggersChanged.all||a.updateTriggersChanged[o.updateTrigger]):n[o.prop]!==i[o.prop]})}},{key:"getDimensionChanges",value:function(e,n,i){var a=this,o=[],s=function(f){var c=Nue.find(function(p){return a.needUpdateDimensionStep(a.dimensionUpdaters[f][p],e,n,i)});c&&o.push(a.dimensionUpdaters[f][c].updater.bind(a,n,a.dimensionUpdaters[f]))};for(var u in this.dimensionUpdaters)s(u);return o.length?o:null}},{key:"getUpdateTriggers",value:function(e){var n=this,i=e.updateTriggers||{},a={},o=function(l){var f=n.dimensionUpdaters[l].accessor;a[f]={},Nue.forEach(function(c){Object.values(n.dimensionUpdaters[l][c].triggers).forEach(function(p){var d=p.prop,v=p.updateTrigger;if(v){var m=i[v];(0,dI.default)(m)==="object"&&!Array.isArray(m)?Object.assign(a[f],m):m!==void 0&&(a[f][d]=m)}else a[f][d]=e[d]})})};for(var s in this.dimensionUpdaters)o(s);return a}},{key:"getSortedBins",value:function(e){for(var n in this.dimensionUpdaters)this.getDimensionSortedBins(e,this.dimensionUpdaters[n])}},{key:"getDimensionSortedBins",value:function(e,n){var i=n.key,a=this.state.dimensions[i].getValue,o=new nc(this.state.layerData.data||[],{getValue:a,filterData:e._filterData});this.setDimensionState(i,{sortedBins:o}),this.getDimensionValueDomain(e,n)}},{key:"getDimensionValueDomain",value:function(e,n){var i=n.getDomain,a=n.key,o=i.triggers,s=o.lowerPercentile,u=o.upperPercentile,l=o.scaleType,f=this.state.dimensions[a].sortedBins.getValueDomainByScale(e[l.prop],[e[s.prop],e[u.prop]]);this.setDimensionState(a,{valueDomain:f}),this.getDimensionScale(e,n)}},{key:"getDimensionScale",value:function(e,n){var i=n.key,a=n.getScaleFunc,o=n.getDomain,s=a.triggers,u=s.domain,l=s.range,f=o.triggers.scaleType,c=a.onSet,p=e[l.prop],d=e[u.prop]||this.state.dimensions[i].valueDomain,v=uue(f&&e[f.prop]),m=v(d,p);(0,dI.default)(c)==="object"&&typeof e[c.props]=="function"&&e[c.props](m.domain()),this.setDimensionState(i,{scaleFunc:m})}},{key:"getSubLayerDimensionAttribute",value:function(e,n){var i=this;return function(a){var o=i.state.dimensions[e],s=o.sortedBins,u=o.scaleFunc,l=s.binMap[a.index];if(l&&l.counts===0)return n;var f=l&&l.value,c=u.domain(),p=f>=c[0]&&f<=c[c.length-1];return p?u(f):n}}},{key:"getSubLayerAccessors",value:function(e){var n={};for(var i in this.dimensionUpdaters){var a=this.dimensionUpdaters[i].accessor;n[a]=this.getSubLayerDimensionAttribute(e,i)}return n}},{key:"getPickingInfo",value:function(e){var n=e.info,i=n.picked&&n.index>-1,a=null;if(i){var o=this.state.layerData.data[n.index],s={};for(var u in this.dimensionUpdaters){var l=this.dimensionUpdaters[u].pickingInfo,f=this.state.dimensions[u].sortedBins,c=f.binMap[o.index]&&f.binMap[o.index].value;s[l]=c}a=Object.assign(s,o,{points:o.filteredPoints||o.points})}return n.picked=Boolean(a),n.object=a,n}},{key:"getAccessor",value:function(e){return this.dimensionUpdaters.hasOwnProperty(e)?this.dimensionUpdaters[e].attributeAccessor:Due}}],[{key:"defaultDimensions",value:function(){return jue}}]),t}();function LFe(t){var r=kFe();return function(){var n=(0,Bb.default)(t),i;if(r){var a=(0,Bb.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Xue.default)(this,i)}}function kFe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function zue(){}var BFe={colorDomain:null,colorRange:Vn,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",min:0,max:100,value:0},upperPercentile:{type:"number",min:0,max:100,value:100},colorScaleType:"quantize",onSetColorDomain:zue,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationLowerPercentile:{type:"number",min:0,max:100,value:0},elevationUpperPercentile:{type:"number",min:0,max:100,value:100},elevationScale:{type:"number",min:0,value:1},elevationScaleType:"linear",onSetElevationDomain:zue,gridAggregator:ic,cellSize:{type:"number",min:0,max:1e3,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:function(r){return r.position}},extruded:!1,material:!0,_filterData:{type:"function",value:null,optional:!0}},Fu=function(t){(0,$ue.default)(e,t);var r=LFe(e);function e(){return(0,Vue.default)(this,e),r.apply(this,arguments)}return(0,Hue.default)(e,[{key:"initializeState",value:function(){var i=new sc({getAggregator:function(s){return s.gridAggregator},getCellSize:function(s){return s.cellSize}});this.state={cpuAggregator:i,aggregatorState:i.state};var a=this.getAttributeManager();a.add({positions:{size:3,type:5130,accessor:"getPosition"}})}},{key:"updateState",value:function(i){(0,Wue.default)((0,Bb.default)(e.prototype),"updateState",this).call(this,i),this.setState({aggregatorState:this.state.cpuAggregator.updateState(i,{viewport:this.context.viewport,attributes:this.getAttributes(),numInstances:this.getNumInstances()})})}},{key:"getPickingInfo",value:function(i){var a=i.info;return this.state.cpuAggregator.getPickingInfo({info:a})}},{key:"_onGetSublayerColor",value:function(i){return this.state.cpuAggregator.getAccessor("fillColor")(i)}},{key:"_onGetSublayerElevation",value:function(i){return this.state.cpuAggregator.getAccessor("elevation")(i)}},{key:"_getSublayerUpdateTriggers",value:function(){return this.state.cpuAggregator.getUpdateTriggers(this.props)}},{key:"renderLayers",value:function(){var i=this.props,a=i.elevationScale,o=i.extruded,s=i.cellSize,u=i.coverage,l=i.material,f=i.transitions,c=this.state.cpuAggregator,p=this.getSubLayerClass("grid-cell",ff),d=this._getSublayerUpdateTriggers();return new p({cellSize:s,coverage:u,material:l,elevationScale:a,extruded:o,getFillColor:this._onGetSublayerColor.bind(this),getElevation:this._onGetSublayerElevation.bind(this),transitions:f&&{getFillColor:f.getColorValue||f.getColorWeight,getElevation:f.getElevationValue||f.getElevationWeight}},this.getSubLayerProps({id:"grid-cell",updateTriggers:d}),{data:c.state.layerData.data})}}]),e}(xi);(0,mI.default)(Fu,"layerName","CPUGridLayer");(0,mI.default)(Fu,"defaultProps",BFe);var Que=h(L()),ele=h(N()),tle=h(be()),rle=h(Ee()),nle=h(Y()),ile=h(K()),Fb=h(q()),Xd=h(B());var uc=Math.PI/3,FFe=[0,uc,2*uc,3*uc,4*uc,5*uc];function DFe(t){return t[0]}function NFe(t){return t[1]}function gI(){var t=0,r=0,e=1,n=1,i=DFe,a=NFe,o,s,u;function l(c){var p={},d=[],v,m=c.length;for(v=0;v<m;++v)if(!(isNaN(y=+i.call(null,g=c[v],v,c))||isNaN(_=+a.call(null,g,v,c)))){var g,y,_,b=Math.round(_=_/u),x=Math.round(y=y/s-(b&1)/2),A=_-b;if(Math.abs(A)*3>1){var S=y-x,P=x+(y<x?-1:1)/2,O=b+(_<b?-1:1),C=y-P,T=_-O;S*S+A*A>C*C+T*T&&(x=P+(b&1?1:-1)/2,b=O)}var I=x+"-"+b,R=p[I];R?R.push(g):(d.push(R=p[I]=[g]),R.x=(x+(b&1)/2)*s,R.y=b*u)}return d}function f(c){var p=0,d=0;return FFe.map(function(v){var m=Math.sin(v)*c,g=-Math.cos(v)*c,y=m-p,_=g-d;return p=m,d=g,[y,_]})}return l.hexagon=function(c){return"m"+f(c==null?o:+c).join("l")+"z"},l.centers=function(){for(var c=[],p=Math.round(r/u),d=Math.round(t/s),v=p*u;v<n+o;v+=u,++p)for(var m=d*s+(p&1)*s/2;m<e+s/2;m+=s)c.push([m,v]);return c},l.mesh=function(){var c=f(o).slice(0,4).join("l");return l.centers().map(function(p){return"M"+p+"m"+c}).join("")},l.x=function(c){return arguments.length?(i=c,l):i},l.y=function(c){return arguments.length?(a=c,l):a},l.radius=function(c){return arguments.length?(o=+c,s=o*2*Math.sin(uc),u=o*1.5,l):o},l.size=function(c){return arguments.length?(t=r=0,e=+c[0],n=+c[1],l):[e-t,n-r]},l.extent=function(c){return arguments.length?(t=+c[0][0],r=+c[0][1],e=+c[1][0],n=+c[1][1],l):[[t,r],[e,n]]},l.radius(1)}function jFe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=UFe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function UFe(t,r){if(t){if(typeof t=="string")return que(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return que(t,r)}}function que(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function Yue(t,r){var e=t.data,n=t.radius,i=r.viewport,a=r.attributes,o=e.length?GFe(e,r):null,s=zFe(n,i,o),u=[],l=Ut(e),f=l.iterable,c=l.objectInfo,p=a.positions.value,d=a.positions.getAccessor(),v=d.size,m=jFe(f),g;try{for(m.s();!(g=m.n()).done;){var y=g.value;c.index++;var _=c.index*v,b=[p[_],p[_+1]],x=Number.isFinite(b[0])&&Number.isFinite(b[1]);x?u.push({screenCoord:i.projectFlat(b),source:y,index:c.index}):J.warn("HexagonLayer: invalid position")()}}catch(P){m.e(P)}finally{m.f()}var A=gI().radius(s).x(function(P){return P.screenCoord[0]}).y(function(P){return P.screenCoord[1]}),S=A(u);return{hexagons:S.map(function(P,O){return{position:i.unprojectFlat([P.x,P.y]),points:P,index:O}}),radiusCommon:s}}function GFe(t,r){var e=r.attributes,n=e.positions.value,i=e.positions.getAccessor(),a=i.size,o=1/0,s=1/0,u=-1/0,l=-1/0,f;for(f=0;f<a*t.length;f+=a){var c=n[f],p=n[f+1],d=Number.isFinite(c)&&Number.isFinite(p);d&&(o=Math.min(c,o),u=Math.max(c,u),s=Math.min(p,s),l=Math.max(p,l))}return[o,s,u,l].every(Number.isFinite)?[(o+u)/2,(s+l)/2]:null}function zFe(t,r,e){var n=r.getDistanceScales(e),i=n.unitsPerMeter;return t*i[0]}function Kue(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Zue(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Kue(Object(e),!0).forEach(function(n){(0,Xd.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Kue(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function VFe(t){var r=HFe();return function(){var n=(0,Fb.default)(t),i;if(r){var a=(0,Fb.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,ile.default)(this,i)}}function HFe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Jue(){}var WFe={colorDomain:null,colorRange:Vn,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",value:0,min:0,max:100},upperPercentile:{type:"number",value:100,min:0,max:100},colorScaleType:"quantize",onSetColorDomain:Jue,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationLowerPercentile:{type:"number",value:0,min:0,max:100},elevationUpperPercentile:{type:"number",value:100,min:0,max:100},elevationScale:{type:"number",min:0,value:1},elevationScaleType:"linear",onSetElevationDomain:Jue,radius:{type:"number",value:1e3,min:1},coverage:{type:"number",min:0,max:1,value:1},extruded:!1,hexagonAggregator:Yue,getPosition:{type:"accessor",value:function(r){return r.position}},material:!0,_filterData:{type:"function",value:null,optional:!0}},Db=function(t){(0,nle.default)(e,t);var r=VFe(e);function e(){var n;(0,Que.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,Xd.default)((0,tle.default)(n),"state",void 0),n}return(0,ele.default)(e,[{key:"initializeState",value:function(){var i=new sc({getAggregator:function(s){return s.hexagonAggregator},getCellSize:function(s){return s.radius}});this.state={cpuAggregator:i,aggregatorState:i.state,vertices:null};var a=this.getAttributeManager();a.add({positions:{size:3,type:5130,accessor:"getPosition"}})}},{key:"updateState",value:function(i){if((0,rle.default)((0,Fb.default)(e.prototype),"updateState",this).call(this,i),i.changeFlags.propsOrDataChanged){var a=this.state.cpuAggregator.updateState(i,{viewport:this.context.viewport,attributes:this.getAttributes()});if(this.state.aggregatorState.layerData!==a.layerData){var o=a.layerData||{},s=o.hexagonVertices;this.setState({vertices:s&&this.convertLatLngToMeterOffset(s)})}this.setState({aggregatorState:a})}}},{key:"convertLatLngToMeterOffset",value:function(i){var a=this.context.viewport;if(Array.isArray(i)&&i.length===6){var o=i[0],s=i[3],u=[(o[0]+s[0])/2,(o[1]+s[1])/2],l=a.projectFlat(u),f=a.getDistanceScales(u),c=f.metersPerUnit,p=i.map(function(d){var v=a.projectFlat(d);return[(v[0]-l[0])*c[0],(v[1]-l[1])*c[1]]});return p}return J.error("HexagonLayer: hexagonVertices needs to be an array of 6 points")(),null}},{key:"getPickingInfo",value:function(i){var a=i.info;return this.state.cpuAggregator.getPickingInfo({info:a})}},{key:"_onGetSublayerColor",value:function(i){return this.state.cpuAggregator.getAccessor("fillColor")(i)}},{key:"_onGetSublayerElevation",value:function(i){return this.state.cpuAggregator.getAccessor("elevation")(i)}},{key:"_getSublayerUpdateTriggers",value:function(){return this.state.cpuAggregator.getUpdateTriggers(this.props)}},{key:"renderLayers",value:function(){var i=this.props,a=i.elevationScale,o=i.extruded,s=i.coverage,u=i.material,l=i.transitions,f=this.state,c=f.aggregatorState,p=f.vertices,d=this.getSubLayerClass("hexagon-cell",Wi),v=this._getSublayerUpdateTriggers(),m=p?{vertices:p,radius:1}:{radius:c.layerData.radiusCommon||1,radiusUnits:"common",angle:90};return new d(Zue(Zue({},m),{},{diskResolution:6,elevationScale:a,extruded:o,coverage:s,material:u,getFillColor:this._onGetSublayerColor.bind(this),getElevation:this._onGetSublayerElevation.bind(this),transitions:l&&{getFillColor:l.getColorValue||l.getColorWeight,getElevation:l.getElevationValue||l.getElevationWeight}}),this.getSubLayerProps({id:"hexagon-cell",updateTriggers:v}),{data:c.layerData.data})}}]),e}(xi);(0,Xd.default)(Db,"layerName","HexagonLayer");(0,Xd.default)(Db,"defaultProps",WFe);var jle=h(L()),Ule=h(N()),_I=h(Ee()),Gle=h(Y()),zle=h(K()),Yd=h(q()),Kd=h(B());var Rle=h(B());var se=h(B()),oe,ae=.5,he=1/6,W={N:[0,ae],E:[ae,0],S:[0,-ae],W:[-ae,0],NE:[ae,ae],NW:[-ae,ae],SE:[ae,-ae],SW:[-ae,-ae]},lc=[W.W,W.SW,W.S],fc=[W.S,W.SE,W.E],cc=[W.E,W.NE,W.N],pc=[W.NW,W.W,W.N],hc=[[-ae,he],[-ae,-he],[-he,-ae],[he,-ae]],dc=[[-he,-ae],[he,-ae],[ae,-he],[ae,he]],vc=[[ae,-he],[ae,he],[he,ae],[-he,ae]],mc=[[-ae,he],[-ae,-he],[he,ae],[-he,ae]],ale=[W.W,W.SW,W.SE,W.E],ole=[W.S,W.SE,W.NE,W.N],sle=[W.NW,W.W,W.E,W.NE],ule=[W.NW,W.SW,W.S,W.N],lle=[[-ae,he],[-ae,-he],[ae,-he],[ae,he]],fle=[[-he,-ae],[he,-ae],[he,ae],[-he,ae]],$Fe=[W.NW,W.SW,W.SE,W.NE],cle=[W.NW,W.SW,W.SE,W.E,W.N],ple=[W.W,W.SW,W.SE,W.NE,W.N],hle=[W.NW,W.W,W.S,W.SE,W.NE],dle=[W.NW,W.SW,W.S,W.E,W.NE],vle=[W.NW,W.W,[ae,-he],[ae,he],W.N],mle=[[-he,-ae],[he,-ae],W.E,W.NE,W.N],gle=[[-ae,he],[-ae,-he],W.S,W.SE,W.E],yle=[W.W,W.SW,W.S,[he,ae],[-he,ae]],_le=[W.NW,W.W,[-he,-ae],[he,-ae],W.N],ble=[[-ae,he],[-ae,-he],W.E,W.NE,W.N],xle=[W.S,W.SE,W.E,[he,ae],[-he,ae]],Ale=[W.W,W.SW,W.S,[ae,-he],[ae,he]],Sle=[W.W,W.SW,W.SE,W.E,[he,ae],[-he,ae]],Tle=[[-ae,he],[-ae,-he],W.S,W.SE,W.NE,W.N],wle=[W.NW,W.W,[-he,-ae],[he,-ae],W.E,W.NE],Ple=[W.NW,W.SW,W.S,[ae,-he],[ae,he],W.N],gc=[W.W,W.SW,W.S,W.E,W.NE,W.N],yc=[W.NW,W.W,W.S,W.SE,W.E,W.N],Nb=[[-ae,he],[-ae,-he],[-he,-ae],[he,-ae],W.E,W.NE,W.N],jb=[W.W,W.SW,W.S,[ae,-he],[ae,he],[he,ae],[-he,ae]],Ub=[W.NW,W.W,[-he,-ae],[he,-ae],[ae,-he],[ae,he],W.N],Gb=[[-ae,he],[-ae,-he],W.S,W.SE,W.E,[he,ae],[-he,ae]],Ole=[[-ae,he],[-ae,-he],[-he,-ae],[he,-ae],[ae,-he],[ae,he],[he,ae],[-he,ae]],Ele={0:[],1:[[W.W,W.S]],2:[[W.S,W.E]],3:[[W.W,W.E]],4:[[W.N,W.E]],5:{0:[[W.W,W.S],[W.N,W.E]],1:[[W.W,W.N],[W.S,W.E]]},6:[[W.N,W.S]],7:[[W.W,W.N]],8:[[W.W,W.N]],9:[[W.N,W.S]],10:{0:[[W.W,W.N],[W.S,W.E]],1:[[W.W,W.S],[W.N,W.E]]},11:[[W.N,W.E]],12:[[W.W,W.E]],13:[[W.S,W.E]],14:[[W.W,W.S]],15:[]};function le(t){return parseInt(t,4)}var Cle=(oe={},(0,se.default)(oe,le("0000"),[]),(0,se.default)(oe,le("2222"),[]),(0,se.default)(oe,le("2221"),[lc]),(0,se.default)(oe,le("2212"),[fc]),(0,se.default)(oe,le("2122"),[cc]),(0,se.default)(oe,le("1222"),[pc]),(0,se.default)(oe,le("0001"),[lc]),(0,se.default)(oe,le("0010"),[fc]),(0,se.default)(oe,le("0100"),[cc]),(0,se.default)(oe,le("1000"),[pc]),(0,se.default)(oe,le("2220"),[hc]),(0,se.default)(oe,le("2202"),[dc]),(0,se.default)(oe,le("2022"),[vc]),(0,se.default)(oe,le("0222"),[mc]),(0,se.default)(oe,le("0002"),[hc]),(0,se.default)(oe,le("0020"),[dc]),(0,se.default)(oe,le("0200"),[vc]),(0,se.default)(oe,le("2000"),[mc]),(0,se.default)(oe,le("0011"),[ale]),(0,se.default)(oe,le("0110"),[ole]),(0,se.default)(oe,le("1100"),[sle]),(0,se.default)(oe,le("1001"),[ule]),(0,se.default)(oe,le("2211"),[ale]),(0,se.default)(oe,le("2112"),[ole]),(0,se.default)(oe,le("1122"),[sle]),(0,se.default)(oe,le("1221"),[ule]),(0,se.default)(oe,le("2200"),[lle]),(0,se.default)(oe,le("2002"),[fle]),(0,se.default)(oe,le("0022"),[lle]),(0,se.default)(oe,le("0220"),[fle]),(0,se.default)(oe,le("1111"),[$Fe]),(0,se.default)(oe,le("1211"),[cle]),(0,se.default)(oe,le("2111"),[ple]),(0,se.default)(oe,le("1112"),[hle]),(0,se.default)(oe,le("1121"),[dle]),(0,se.default)(oe,le("1011"),[cle]),(0,se.default)(oe,le("0111"),[ple]),(0,se.default)(oe,le("1110"),[hle]),(0,se.default)(oe,le("1101"),[dle]),(0,se.default)(oe,le("1200"),[vle]),(0,se.default)(oe,le("0120"),[mle]),(0,se.default)(oe,le("0012"),[gle]),(0,se.default)(oe,le("2001"),[yle]),(0,se.default)(oe,le("1022"),[vle]),(0,se.default)(oe,le("2102"),[mle]),(0,se.default)(oe,le("2210"),[gle]),(0,se.default)(oe,le("0221"),[yle]),(0,se.default)(oe,le("1002"),[_le]),(0,se.default)(oe,le("2100"),[ble]),(0,se.default)(oe,le("0210"),[xle]),(0,se.default)(oe,le("0021"),[Ale]),(0,se.default)(oe,le("1220"),[_le]),(0,se.default)(oe,le("0122"),[ble]),(0,se.default)(oe,le("2012"),[xle]),(0,se.default)(oe,le("2201"),[Ale]),(0,se.default)(oe,le("0211"),[Sle]),(0,se.default)(oe,le("2110"),[Tle]),(0,se.default)(oe,le("1102"),[wle]),(0,se.default)(oe,le("1021"),[Ple]),(0,se.default)(oe,le("2011"),[Sle]),(0,se.default)(oe,le("0112"),[Tle]),(0,se.default)(oe,le("1120"),[wle]),(0,se.default)(oe,le("1201"),[Ple]),(0,se.default)(oe,le("2101"),[gc]),(0,se.default)(oe,le("0121"),[gc]),(0,se.default)(oe,le("1012"),[yc]),(0,se.default)(oe,le("1210"),[yc]),(0,se.default)(oe,le("0101"),{0:[lc,cc],1:[gc],2:[gc]}),(0,se.default)(oe,le("1010"),{0:[pc,fc],1:[yc],2:[yc]}),(0,se.default)(oe,le("2121"),{0:[gc],1:[gc],2:[lc,cc]}),(0,se.default)(oe,le("1212"),{0:[yc],1:[yc],2:[pc,fc]}),(0,se.default)(oe,le("2120"),{0:[Nb],1:[Nb],2:[hc,cc]}),(0,se.default)(oe,le("2021"),{0:[jb],1:[jb],2:[lc,vc]}),(0,se.default)(oe,le("1202"),{0:[Ub],1:[Ub],2:[pc,dc]}),(0,se.default)(oe,le("0212"),{0:[Gb],1:[Gb],2:[fc,mc]}),(0,se.default)(oe,le("0102"),{0:[hc,cc],1:[Nb],2:[Nb]}),(0,se.default)(oe,le("0201"),{0:[lc,vc],1:[jb],2:[jb]}),(0,se.default)(oe,le("1020"),{0:[pc,dc],1:[Ub],2:[Ub]}),(0,se.default)(oe,le("2010"),{0:[fc,mc],1:[Gb],2:[Gb]}),(0,se.default)(oe,le("2020"),{0:[mc,dc],1:[Ole],2:[hc,vc]}),(0,se.default)(oe,le("0202"),{0:[vc,hc],1:[Ole],2:[mc,dc]}),oe);function Mle(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Ile(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Mle(Object(e),!0).forEach(function(n){(0,Rle.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Mle(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var Du={ISO_LINES:1,ISO_BANDS:2},XFe={zIndex:0,zOffset:.005};function qd(t,r){return Array.isArray(r)?t<r[0]?0:t<r[1]?1:2:t>=r?1:0}function Lle(t){var r=t.cellWeights,e=t.x,n=t.y,i=t.width,a=t.height,o=t.threshold;t.thresholdValue&&(J.deprecated("thresholdValue","threshold")(),o=t.thresholdValue);var s=e<0,u=e>=i-1,l=n<0,f=n>=a-1,c=s||u||l||f,p={},d={};s||f?d.top=0:(p.top=r[(n+1)*i+e],d.top=qd(p.top,o)),u||f?d.topRight=0:(p.topRight=r[(n+1)*i+e+1],d.topRight=qd(p.topRight,o)),u||l?d.right=0:(p.right=r[n*i+e+1],d.right=qd(p.right,o)),s||l?d.current=0:(p.current=r[n*i+e],d.current=qd(p.current,o));var v=d.top,m=d.topRight,g=d.right,y=d.current,_=-1;Number.isFinite(o)&&(_=v<<3|m<<2|g<<1|y),Array.isArray(o)&&(_=v<<6|m<<4|g<<2|y);var b=0;return c||(b=qd((p.top+p.topRight+p.right+p.current)/4,o)),{code:_,meanCode:b}}function yI(t){var r=t.gridOrigin,e=t.cellSize,n=t.x,i=t.y,a=t.code,o=t.meanCode,s=t.type,u=s===void 0?Du.ISO_LINES:s,l=Ile(Ile({},XFe),t.thresholdData),f=u===Du.ISO_BANDS?Cle[a]:Ele[a];Array.isArray(f)||(f=f[o]);var c=l.zIndex*l.zOffset,p=(n+1)*e[0],d=(i+1)*e[1],v=r[0]+p,m=r[1]+d;if(u===Du.ISO_BANDS){var g=[];return f.forEach(function(_){var b=[];_.forEach(function(x){var A=v+x[0]*e[0],S=m+x[1]*e[1];b.push([A,S,c])}),g.push(b)}),g}var y=[];return f.forEach(function(_){_.forEach(function(b){var x=v+b[0]*e[0],A=m+b[1]*e[1];y.push([x,A,c])})}),y}function kle(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=qFe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function qFe(t,r){if(t){if(typeof t=="string")return Ble(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Ble(t,r)}}function Ble(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function Fle(t){var r=t.thresholdData,e=t.cellWeights,n=t.gridSize,i=t.gridOrigin,a=t.cellSize,o=[],s=[],u=n[0],l=n[1],f=0,c=0,p=kle(r),d;try{for(p.s();!(d=p.n()).done;)for(var v=d.value,m=v.contour,g=m.threshold,y=-1;y<u;y++)for(var _=-1;_<l;_++){var b=Lle({cellWeights:e,threshold:g,x:y,y:_,width:u,height:l}),x=b.code,A=b.meanCode,S={type:Du.ISO_BANDS,gridOrigin:i,cellSize:a,x:y,y:_,width:u,height:l,code:x,meanCode:A,thresholdData:v};if(Array.isArray(g)){S.type=Du.ISO_BANDS;var P=yI(S),O=kle(P),C;try{for(O.s();!(C=O.n()).done;){var T=C.value;s[c++]={vertices:T,contour:m}}}catch(V){O.e(V)}finally{O.f()}}else{S.type=Du.ISO_LINES;for(var I=yI(S),R=0;R<I.length;R+=2)o[f++]={start:I[R],end:I[R+1],contour:m}}}}catch(V){p.e(V)}finally{p.f()}return{contourSegments:o,contourPolygons:s}}function YFe(t){var r=KFe();return function(){var n=(0,Yd.default)(t),i;if(r){var a=(0,Yd.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,zle.default)(this,i)}}function KFe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Dle=[255,255,255,255],ZFe=1,JFe=1,QFe={cellSize:{type:"number",min:1,max:1e3,value:1e3},getPosition:{type:"accessor",value:function(r){return r.position}},getWeight:{type:"accessor",value:1},gpuAggregation:!0,aggregation:"SUM",contours:{type:"object",value:[{threshold:JFe}],optional:!0,compare:3},zOffset:.005},Nle="positions",eDe={data:{props:["cellSize"]},weights:{props:["aggregation"],accessors:["getWeight"]}},zb=function(t){(0,Gle.default)(e,t);var r=YFe(e);function e(){return(0,jle.default)(this,e),r.apply(this,arguments)}return(0,Ule.default)(e,[{key:"initializeState",value:function(){var i;(0,_I.default)((0,Yd.default)(e.prototype),"initializeAggregationLayer",this).call(this,{dimensions:eDe}),this.setState({contourData:{},projectPoints:!1,weights:{count:{size:1,operation:gt.SUM}}});var a=this.getAttributeManager();a.add((i={},(0,Kd.default)(i,Nle,{size:3,accessor:"getPosition",type:5130,fp64:this.use64bitPositions()}),(0,Kd.default)(i,"count",{size:3,accessor:"getWeight"}),i))}},{key:"updateState",value:function(i){(0,_I.default)((0,Yd.default)(e.prototype),"updateState",this).call(this,i);var a=!1,o=i.oldProps,s=i.props,u=this.state.aggregationDirty;(o.contours!==s.contours||o.zOffset!==s.zOffset)&&(a=!0,this._updateThresholdData(i.props)),this.getNumInstances()>0&&(u||a)&&this._generateContours()}},{key:"renderLayers",value:function(){var i=this.state.contourData,a=i.contourSegments,o=i.contourPolygons,s=this.getSubLayerClass("lines",af),u=this.getSubLayerClass("bands",Xi),l=a&&a.length>0&&new s(this.getSubLayerProps({id:"lines"}),{data:this.state.contourData.contourSegments,getSourcePosition:function(p){return p.start},getTargetPosition:function(p){return p.end},getColor:function(p){return p.contour.color||Dle},getWidth:function(p){return p.contour.strokeWidth||ZFe}}),f=o&&o.length>0&&new u(this.getSubLayerProps({id:"bands"}),{data:this.state.contourData.contourPolygons,getPolygon:function(p){return p.vertices},getFillColor:function(p){return p.contour.color||Dle}});return[l,f]}},{key:"updateAggregationState",value:function(i){var a=i.props,o=i.oldProps,s=a.cellSize,u=a.coordinateSystem,l=this.context.viewport,f=o.cellSize!==s,c=a.gpuAggregation;this.state.gpuAggregation!==a.gpuAggregation&&c&&!Ir.isSupported(this.context.gl)&&(J.warn("GPU Grid Aggregation not supported, falling back to CPU")(),c=!1);var p=c!==this.state.gpuAggregation;this.setState({gpuAggregation:c});var d=this.state.dimensions,v=this.isAttributeChanged(Nle),m=d.data,g=d.weights,y=this.state.boundingBox;if(v&&(y=Mb(this.getAttributes(),this.getNumInstances()),this.setState({boundingBox:y})),v||f){var _=Ib(y,s,l,u),b=_.gridOffset,x=_.translation,A=_.width,S=_.height,P=_.numCol,O=_.numRow;this.allocateResources(O,P),this.setState({gridOffset:b,boundingBox:y,translation:x,posOffset:x.slice(),gridOrigin:[-1*x[0],-1*x[1]],width:A,height:S,numCol:P,numRow:O})}var C=v||p||this.isAggregationDirty(i,{dimension:m,compareAll:c}),T=this.isAggregationDirty(i,{dimension:g});T&&this._updateAccessors(i),(C||T)&&this._resetResults(),this.setState({aggregationDataDirty:C,aggregationWeightsDirty:T})}},{key:"_updateAccessors",value:function(i){var a=i.props,o=a.getWeight,s=a.aggregation,u=a.data,l=this.state.weights.count;l&&(l.getWeight=o,l.operation=gt[s]),this.setState({getValue:Qf(s,o,{data:u})})}},{key:"_resetResults",value:function(){var i=this.state.weights.count;i&&(i.aggregationData=null)}},{key:"_generateContours",value:function(){var i=this.state,a=i.numCol,o=i.numRow,s=i.gridOrigin,u=i.gridOffset,l=i.thresholdData,f=this.state.weights.count,c=f.aggregationData;c||(c=f.aggregationBuffer.getData(),f.aggregationData=c);var p=Ir.getCellData({countsData:c}),d=p.cellWeights,v=Fle({thresholdData:l,cellWeights:d,gridSize:[a,o],gridOrigin:s,cellSize:[u.xOffset,u.yOffset]});this.setState({contourData:v})}},{key:"_updateThresholdData",value:function(i){for(var a=i.contours,o=i.zOffset,s=a.length,u=new Array(s),l=0;l<s;l++){var f=a[l];u[l]={contour:f,zIndex:f.zIndex||l,zOffset:o}}this.setState({thresholdData:u})}}]),e}(ku);(0,Kd.default)(zb,"layerName","ContourLayer");(0,Kd.default)(zb,"defaultProps",QFe);var ofe=h(L()),sfe=h(N()),ufe=h(be()),lfe=h(Y()),ffe=h(K()),SI=h(q()),Zd=h(B());var tfe=h(L()),rfe=h(N()),$b=h(Ee()),nfe=h(Y()),ife=h(K()),_c=h(q()),Nu=h(B());var Xle=h(L()),qle=h(N()),Yle=h(Ee()),Kle=h(Y()),Zle=h(K()),Vb=h(q()),Hb=h(B());var Vle=`#version 300 es
#define SHADER_NAME gpu-grid-cell-layer-vertex-shader
#define RANGE_COUNT 6

in vec3 positions;
in vec3 normals;

in vec4 colors;
in vec4 elevations;
in vec3 instancePickingColors;
uniform vec2 offset;
uniform bool extruded;
uniform float cellSize;
uniform float coverage;
uniform float opacity;
uniform float elevationScale;

uniform ivec2 gridSize;
uniform vec2 gridOrigin;
uniform vec2 gridOriginLow;
uniform vec2 gridOffset;
uniform vec2 gridOffsetLow;
uniform vec4 colorRange[RANGE_COUNT];
uniform vec2 elevationRange;
uniform vec2 colorDomain;
uniform bool colorDomainValid;
uniform vec2 elevationDomain;
uniform bool elevationDomainValid;

layout(std140) uniform;
uniform ColorData
{
  vec4 maxMinCount;
} colorData;
uniform ElevationData
{
  vec4 maxMinCount;
} elevationData;

#define EPSILON 0.00001
out vec4 vColor;

vec4 quantizeScale(vec2 domain, vec4 range[RANGE_COUNT], float value) {
  vec4 outColor = vec4(0., 0., 0., 0.);
  if (value >= (domain.x - EPSILON) && value <= (domain.y + EPSILON)) {
    float domainRange = domain.y - domain.x;
    if (domainRange <= 0.) {
      outColor = colorRange[0];
    } else {
      float rangeCount = float(RANGE_COUNT);
      float rangeStep = domainRange / rangeCount;
      float idx = floor((value - domain.x) / rangeStep);
      idx = clamp(idx, 0., rangeCount - 1.);
      int intIdx = int(idx);
      outColor = colorRange[intIdx];
    }
  }
  return outColor;
}

float linearScale(vec2 domain, vec2 range, float value) {
  if (value >= (domain.x - EPSILON) && value <= (domain.y + EPSILON)) {
    return ((value - domain.x) / (domain.y - domain.x)) * (range.y - range.x) + range.x;
  }
  return -1.;
}

void main(void) {
  vec2 clrDomain = colorDomainValid ? colorDomain : vec2(colorData.maxMinCount.a, colorData.maxMinCount.r);
  vec4 color = quantizeScale(clrDomain, colorRange, colors.r);

  float elevation = 0.0;

  if (extruded) {
    vec2 elvDomain = elevationDomainValid ? elevationDomain : vec2(elevationData.maxMinCount.a, elevationData.maxMinCount.r);
    elevation = linearScale(elvDomain, elevationRange, elevations.r);
    elevation = elevation  * (positions.z + 1.0) / 2.0 * elevationScale;
  }
  float shouldRender = float(color.r > 0.0 && elevations.r >= 0.0);
  float dotRadius = cellSize / 2. * coverage * shouldRender;

  int yIndex = (gl_InstanceID / gridSize[0]);
  int xIndex = gl_InstanceID - (yIndex * gridSize[0]);

  vec2 instancePositionXFP64 = mul_fp64(vec2(gridOffset[0], gridOffsetLow[0]), vec2(float(xIndex), 0.));
  instancePositionXFP64 = sum_fp64(instancePositionXFP64, vec2(gridOrigin[0], gridOriginLow[0]));
  vec2 instancePositionYFP64 = mul_fp64(vec2(gridOffset[1], gridOffsetLow[1]), vec2(float(yIndex), 0.));
  instancePositionYFP64 = sum_fp64(instancePositionYFP64, vec2(gridOrigin[1], gridOriginLow[1]));

  vec3 centroidPosition = vec3(instancePositionXFP64[0], instancePositionYFP64[0], elevation);
  vec3 centroidPosition64Low = vec3(instancePositionXFP64[1], instancePositionYFP64[1], 0.0);
  geometry.worldPosition = centroidPosition;
  vec3 pos = vec3(project_size(positions.xy + offset) * dotRadius, 0.);
  picking_setPickingColor(instancePickingColors);

  gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);

  vec3 normals_commonspace = project_normal(normals);

   if (extruded) {
    vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, geometry.position.xyz, normals_commonspace);
    vColor = vec4(lightColor, color.a * opacity) / 255.;
  } else {
    vColor = vec4(color.rgb, color.a * opacity) / 255.;
  }
}
`;var Hle=`#version 300 es
#define SHADER_NAME gpu-grid-cell-layer-fragment-shader

precision highp float;

in vec4 vColor;

out vec4 fragColor;

void main(void) {
  fragColor = vColor;
  fragColor = picking_filterColor(fragColor);
}
`;function Wle(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function $le(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Wle(Object(e),!0).forEach(function(n){(0,Hb.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Wle(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function tDe(t){var r=rDe();return function(){var n=(0,Vb.default)(t),i;if(r){var a=(0,Vb.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Zle.default)(this,i)}}function rDe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var bI=0,xI=1,nDe={colorDomain:null,colorRange:Vn,elevationDomain:null,elevationRange:[0,1e3],elevationScale:{type:"number",min:0,value:1},gridSize:{type:"array",value:[1,1]},gridOrigin:{type:"array",value:[0,0]},gridOffset:{type:"array",value:[0,0]},cellSize:{type:"number",min:0,max:1e3,value:1e3},offset:{type:"array",value:[1,1]},coverage:{type:"number",min:0,max:1,value:1},extruded:!0,material:!0},Wb=function(t){(0,Kle.default)(e,t);var r=tDe(e);function e(){return(0,Xle.default)(this,e),r.apply(this,arguments)}return(0,qle.default)(e,[{key:"getShaders",value:function(){return(0,Yle.default)((0,Vb.default)(e.prototype),"getShaders",this).call(this,{vs:Vle,fs:Hle,modules:[Je,pn,st,Ts]})}},{key:"initializeState",value:function(i){var a=i.gl,o=this.getAttributeManager();o.addInstanced({colors:{size:4,noAlloc:!0},elevations:{size:4,noAlloc:!0}});var s=this._getModel(a);this._setupUniformBuffer(s),this.setState({model:s})}},{key:"_getModel",value:function(i){return new Ce(i,$le($le({},this.getShaders()),{},{id:this.props.id,geometry:new _o,isInstanced:!0}))}},{key:"draw",value:function(i){var a=i.uniforms,o=this.props,s=o.cellSize,u=o.offset,l=o.extruded,f=o.elevationScale,c=o.coverage,p=o.gridSize,d=o.gridOrigin,v=o.gridOffset,m=o.elevationRange,g=o.colorMaxMinBuffer,y=o.elevationMaxMinBuffer,_=[oi(d[0]),oi(d[1])],b=[oi(v[0]),oi(v[1])],x=this.getDomainUniforms(),A=es(this.props.colorRange);this.bindUniformBuffers(g,y),this.state.model.setUniforms(a).setUniforms(x).setUniforms({cellSize:s,offset:u,extruded:l,elevationScale:f,coverage:c,gridSize:p,gridOrigin:d,gridOriginLow:_,gridOffset:v,gridOffsetLow:b,colorRange:A,elevationRange:m}).draw(),this.unbindUniformBuffers(g,y)}},{key:"bindUniformBuffers",value:function(i,a){i.bind({target:35345,index:bI}),a.bind({target:35345,index:xI})}},{key:"unbindUniformBuffers",value:function(i,a){i.unbind({target:35345,index:bI}),a.unbind({target:35345,index:xI})}},{key:"getDomainUniforms",value:function(){var i=this.props,a=i.colorDomain,o=i.elevationDomain,s={};return a!==null?(s.colorDomainValid=!0,s.colorDomain=a):s.colorDomainValid=!1,o!==null?(s.elevationDomainValid=!0,s.elevationDomain=o):s.elevationDomainValid=!1,s}},{key:"_setupUniformBuffer",value:function(i){var a=this.context.gl,o=i.program.handle,s=a.getUniformBlockIndex(o,"ColorData"),u=a.getUniformBlockIndex(o,"ElevationData");a.uniformBlockBinding(o,s,bI),a.uniformBlockBinding(o,u,xI)}}]),e}(He);(0,Hb.default)(Wb,"layerName","GPUGridCellLayer");(0,Hb.default)(Wb,"defaultProps",nDe);function Jle(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Qle(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Jle(Object(e),!0).forEach(function(n){(0,Nu.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Jle(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function iDe(t){var r=aDe();return function(){var n=(0,_c.default)(t),i;if(r){var a=(0,_c.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,ife.default)(this,i)}}function aDe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var oDe={colorDomain:null,colorRange:Vn,getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",elevationDomain:null,elevationRange:[0,1e3],getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationScale:{type:"number",min:0,value:1},cellSize:{type:"number",min:1,max:1e3,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:function(r){return r.position}},extruded:!1,material:!0},sDe={data:{props:["cellSize","colorAggregation","elevationAggregation"]}},efe="positions",ju=function(t){(0,nfe.default)(e,t);var r=iDe(e);function e(){return(0,tfe.default)(this,e),r.apply(this,arguments)}return(0,rfe.default)(e,[{key:"initializeState",value:function(i){var a,o=i.gl,s=Ir.isSupported(o);s||J.error("GPUGridLayer is not supported on this browser, use GridLayer instead")(),(0,$b.default)((0,_c.default)(e.prototype),"initializeAggregationLayer",this).call(this,{dimensions:sDe}),this.setState({gpuAggregation:!0,projectPoints:!1,isSupported:s,weights:{color:{needMin:!0,needMax:!0,combineMaxMin:!0,maxMinBuffer:new xe(o,{byteLength:4*4,accessor:{size:4,type:5126,divisor:1}})},elevation:{needMin:!0,needMax:!0,combineMaxMin:!0,maxMinBuffer:new xe(o,{byteLength:4*4,accessor:{size:4,type:5126,divisor:1}})}},positionAttributeName:"positions"});var u=this.getAttributeManager();u.add((a={},(0,Nu.default)(a,efe,{size:3,accessor:"getPosition",type:5130,fp64:this.use64bitPositions()}),(0,Nu.default)(a,"color",{size:3,accessor:"getColorWeight"}),(0,Nu.default)(a,"elevation",{size:3,accessor:"getElevationWeight"}),a))}},{key:"updateState",value:function(i){if(this.state.isSupported!==!1){(0,$b.default)((0,_c.default)(e.prototype),"updateState",this).call(this,i);var a=this.state.aggregationDirty;a&&this.setState({gridHash:null})}}},{key:"getHashKeyForIndex",value:function(i){var a=this.state,o=a.numRow,s=a.numCol,u=a.boundingBox,l=a.gridOffset,f=[s,o],c=[u.xMin,u.yMin],p=[l.xOffset,l.yOffset],d=Math.floor(i/f[0]),v=i-d*f[0],m=Math.floor((d*p[1]+c[1]+90+p[1]/2)/p[1]),g=Math.floor((v*p[0]+c[0]+180+p[0]/2)/p[0]);return"".concat(m,"-").concat(g)}},{key:"getPositionForIndex",value:function(i){var a=this.state,o=a.numRow,s=a.numCol,u=a.boundingBox,l=a.gridOffset,f=[s,o],c=[u.xMin,u.yMin],p=[l.xOffset,l.yOffset],d=Math.floor(i/f[0]),v=i-d*f[0],m=d*p[1]+c[1],g=v*p[0]+c[0];return[g,m]}},{key:"getPickingInfo",value:function(i){var a=i.info,o=i.mode,s=a.index,u=null;if(s>=0){var l=this.state.gpuGridAggregator,f=this.getPositionForIndex(s),c=Ir.getAggregationData(Qle({pixelIndex:s},l.getData("color"))),p=Ir.getAggregationData(Qle({pixelIndex:s},l.getData("elevation")));if(u={colorValue:c.cellWeight,elevationValue:p.cellWeight,count:c.cellCount||p.cellCount,position:f,totalCount:c.totalCount||p.totalCount},o!=="hover"){var d=this.props,v=this.state.gridHash;if(!v){var m=this.state,g=m.gridOffset,y=m.translation,_=m.boundingBox,b=this.context.viewport,x=this.getAttributes(),A=ic(d,{gridOffset:g,attributes:x,viewport:b,translation:y,boundingBox:_});v=A.gridHash,this.setState({gridHash:v})}var S=this.getHashKeyForIndex(s),P=v[S];Object.assign(u,P)}}return a.picked=Boolean(u),a.object=u,a}},{key:"renderLayers",value:function(){if(!this.state.isSupported)return null;var i=this.props,a=i.elevationScale,o=i.extruded,s=i.cellSize,u=i.coverage,l=i.material,f=i.elevationRange,c=i.colorDomain,p=i.elevationDomain,d=this.state,v=d.weights,m=d.numRow,g=d.numCol,y=d.gridOrigin,_=d.gridOffset,b=v.color,x=v.elevation,A=es(this.props.colorRange),S=this.getSubLayerClass("gpu-grid-cell",Wb);return new S({gridSize:[g,m],gridOrigin:y,gridOffset:[_.xOffset,_.yOffset],colorRange:A,elevationRange:f,colorDomain:c,elevationDomain:p,cellSize:s,coverage:u,material:l,elevationScale:a,extruded:o},this.getSubLayerProps({id:"gpu-grid-cell"}),{data:{attributes:{colors:b.aggregationBuffer,elevations:x.aggregationBuffer}},colorMaxMinBuffer:b.maxMinBuffer,elevationMaxMinBuffer:x.maxMinBuffer,numInstances:g*m})}},{key:"finalizeState",value:function(i){var a=this.state.weights,o=a.color,s=a.elevation;[o,s].forEach(function(u){var l=u.aggregationBuffer,f=u.maxMinBuffer;f.delete(),l?.delete()}),(0,$b.default)((0,_c.default)(e.prototype),"finalizeState",this).call(this,i)}},{key:"updateAggregationState",value:function(i){var a=i.props,o=i.oldProps,s=a.cellSize,u=a.coordinateSystem,l=this.context.viewport,f=o.cellSize!==s,c=this.state.dimensions,p=this.isAttributeChanged(efe),d=p||this.isAttributeChanged(),v=this.state.boundingBox;if(p&&(v=Mb(this.getAttributes(),this.getNumInstances()),this.setState({boundingBox:v})),p||f){var m=Ib(v,s,l,u),g=m.gridOffset,y=m.translation,_=m.width,b=m.height,x=m.numCol,A=m.numRow;this.allocateResources(A,x),this.setState({gridOffset:g,translation:y,gridOrigin:[-1*y[0],-1*y[1]],width:_,height:b,numCol:x,numRow:A})}var S=d||this.isAggregationDirty(i,{dimension:c.data,compareAll:!0});S&&this._updateAccessors(i),this.setState({aggregationDataDirty:S})}},{key:"_updateAccessors",value:function(i){var a=i.props,o=a.colorAggregation,s=a.elevationAggregation,u=this.state.weights,l=u.color,f=u.elevation;l.operation=gt[o],f.operation=gt[s]}}]),e}(ku);(0,Nu.default)(ju,"layerName","GPUGridLayer");(0,Nu.default)(ju,"defaultProps",oDe);function uDe(t){var r=lDe();return function(){var n=(0,SI.default)(t),i;if(r){var a=(0,SI.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,ffe.default)(this,i)}}function lDe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function afe(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function AI(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?afe(Object(e),!0).forEach(function(n){(0,Zd.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):afe(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var fDe=AI(AI(AI({},ju.defaultProps),Fu.defaultProps),{},{gpuAggregation:!1}),Xb=function(t){(0,lfe.default)(e,t);var r=uDe(e);function e(){var n;(0,ofe.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,Zd.default)((0,ufe.default)(n),"state",void 0),n}return(0,sfe.default)(e,[{key:"initializeState",value:function(){this.state={useGPUAggregation:!0}}},{key:"updateState",value:function(i){var a=i.props;this.setState({useGPUAggregation:this.canUseGPUAggregation(a)})}},{key:"renderLayers",value:function(){var i=this.props,a=i.data,o=i.updateTriggers,s=this.state.useGPUAggregation?"GPU":"CPU",u=this.state.useGPUAggregation?this.getSubLayerClass("GPU",ju):this.getSubLayerClass("CPU",Fu);return new u(this.props,this.getSubLayerProps({id:s,updateTriggers:o}),{data:a})}},{key:"canUseGPUAggregation",value:function(i){var a=i.gpuAggregation,o=i.lowerPercentile,s=i.upperPercentile,u=i.getColorValue,l=i.getElevationValue,f=i.colorScaleType;return!(!a||!Ir.isSupported(this.context.gl)||o!==0||s!==100||u!==null||l!==null||f==="quantile"||f==="ordinal")}}]),e}(Ot);(0,Zd.default)(Xb,"layerName","GridLayer");(0,Zd.default)(Xb,"defaultProps",fDe);var MI=h(me()),Ife=h(L()),Rfe=h(N()),Lfe=h(be()),Jd=h(Ee()),kfe=h(Y()),Bfe=h(K()),Uu=h(q()),Si=h(B());var TI=h(me());function cDe(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=pDe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function pDe(t,r){if(t){if(typeof t=="string")return cfe(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return cfe(t,r)}}function cfe(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function hfe(t){var r=t.map(function(s){return s[0]}),e=t.map(function(s){return s[1]}),n=Math.min.apply(null,r),i=Math.max.apply(null,r),a=Math.min.apply(null,e),o=Math.max.apply(null,e);return[n,a,i,o]}function dfe(t,r){return r[0]>=t[0]&&r[2]<=t[2]&&r[1]>=t[1]&&r[3]<=t[3]}var pfe=new Float32Array(12);function wI(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2,e=0,n=cDe(t),i;try{for(n.s();!(i=n.n()).done;)for(var a=i.value,o=0;o<r;o++)pfe[e++]=a[o]||0}catch(s){n.e(s)}finally{n.f()}return pfe}function vfe(t,r,e){var n=(0,TI.default)(t,4),i=n[0],a=n[1],o=n[2],s=n[3],u=o-i,l=s-a,f=u,c=l;u/l<r/e?f=r/e*l:c=e/r*u,f<r&&(f=r,c=e);var p=(o+i)/2,d=(s+a)/2;return[p-f/2,d-c/2,p+f/2,d+c/2]}function mfe(t,r){var e=(0,TI.default)(r,4),n=e[0],i=e[1],a=e[2],o=e[3];return[(t[0]-n)/(a-n),(t[1]-i)/(o-i)]}function gfe(t){var r=t.gl,e=t.floatTargetSupport;return e?{format:ce(r)?34836:6408,type:5126}:{format:6408,type:5121}}var xfe=h(L()),Afe=h(N()),Sfe=h(Y()),Tfe=h(K()),PI=h(q()),OI=h(B());var yfe=`#define SHADER_NAME heatp-map-layer-vertex-shader

uniform sampler2D maxTexture;
uniform float intensity;
uniform vec2 colorDomain;
uniform float threshold;
uniform float aggregationMode;

attribute vec3 positions;
attribute vec2 texCoords;

varying vec2 vTexCoords;
varying float vIntensityMin;
varying float vIntensityMax;

void main(void) {
  gl_Position = project_position_to_clipspace(positions, vec3(0.0), vec3(0.0));
  vTexCoords = texCoords;
  vec4 maxTexture = texture2D(maxTexture, vec2(0.5));
  float maxValue = aggregationMode < 0.5 ? maxTexture.r : maxTexture.g;
  float minValue = maxValue * threshold;
  if (colorDomain[1] > 0.) {
    maxValue = colorDomain[1];
    minValue = colorDomain[0];
  }
  vIntensityMax = intensity / maxValue;
  vIntensityMin = intensity / minValue;
}
`;var _fe=`#define SHADER_NAME triangle-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D texture;
uniform sampler2D colorTexture;
uniform float aggregationMode;

varying vec2 vTexCoords;
varying float vIntensityMin;
varying float vIntensityMax;

vec4 getLinearColor(float value) {
  float factor = clamp(value * vIntensityMax, 0., 1.);
  vec4 color = texture2D(colorTexture, vec2(factor, 0.5));
  color.a *= min(value * vIntensityMin, 1.0);
  return color;
}

void main(void) {
  vec4 weights = texture2D(texture, vTexCoords);
  float weight = weights.r;

  if (aggregationMode > 0.5) {
    weight /= max(1.0, weights.a);
  }
  if (weight <= 0.) {
     discard;
  }

  vec4 linearColor = getLinearColor(weight);
  linearColor.a *= opacity;
  gl_FragColor =linearColor;
}
`;function bfe(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function qb(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?bfe(Object(e),!0).forEach(function(n){(0,OI.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):bfe(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function hDe(t){var r=dDe();return function(){var n=(0,PI.default)(t),i;if(r){var a=(0,PI.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Tfe.default)(this,i)}}function dDe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var EI=function(t){(0,Sfe.default)(e,t);var r=hDe(e);function e(){return(0,xfe.default)(this,e),r.apply(this,arguments)}return(0,Afe.default)(e,[{key:"getShaders",value:function(){return{vs:yfe,fs:_fe,modules:[Je]}}},{key:"initializeState",value:function(i){var a=i.gl,o=this.getAttributeManager();o.add({positions:{size:3,noAlloc:!0},texCoords:{size:2,noAlloc:!0}}),this.setState({model:this._getModel(a)})}},{key:"_getModel",value:function(i){var a=this.props.vertexCount;return new Ce(i,qb(qb({},this.getShaders()),{},{id:this.props.id,geometry:new Me({drawMode:6,vertexCount:a})}))}},{key:"draw",value:function(i){var a=i.uniforms,o=this.state.model,s=this.props,u=s.texture,l=s.maxTexture,f=s.colorTexture,c=s.intensity,p=s.threshold,d=s.aggregationMode,v=s.colorDomain;o.setUniforms(qb(qb({},a),{},{texture:u,maxTexture:l,colorTexture:f,intensity:c,threshold:p,aggregationMode:d,colorDomain:v})).draw()}}]),e}(He);(0,OI.default)(EI,"layerName","TriangleLayer");var wfe=`attribute vec3 positions;
attribute vec3 positions64Low;
attribute float weights;
varying vec4 weightsTexture;
uniform float radiusPixels;
uniform float textureWidth;
uniform vec4 commonBounds;
uniform float weightsScale;
void main()
{
  weightsTexture = vec4(weights * weightsScale, 0., 0., 1.);

  float radiusTexels  = project_pixel_size(radiusPixels) * textureWidth / (commonBounds.z - commonBounds.x);
  gl_PointSize = radiusTexels * 2.;

  vec3 commonPosition = project_position(positions, positions64Low);
  gl_Position.xy = (commonPosition.xy - commonBounds.xy) / (commonBounds.zw - commonBounds.xy) ;
  gl_Position.xy = (gl_Position.xy * 2.) - (1.);
}
`;var Pfe=`varying vec4 weightsTexture;
float gaussianKDE(float u){
  return pow(2.71828, -u*u/0.05555)/(1.77245385*0.166666);
}
void main()
{
  float dist = length(gl_PointCoord - vec2(0.5, 0.5));
  if (dist > 0.5) {
    discard;
  }
  gl_FragColor = weightsTexture * gaussianKDE(2. * dist);
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;var Ofe=`attribute vec4 inTexture;
varying vec4 outTexture;

void main()
{
outTexture = inTexture;
gl_Position = vec4(0, 0, 0, 1.);
gl_PointSize = 1.0;
}
`;var Efe=`varying vec4 outTexture;
void main() {
  gl_FragColor = outTexture;
  gl_FragColor.g = outTexture.r / max(1.0, outTexture.a);
}
`;var bc;function Cfe(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function xc(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Cfe(Object(e),!0).forEach(function(n){(0,Si.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Cfe(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function vDe(t){var r=mDe();return function(){var n=(0,Uu.default)(t),i;if(r){var a=(0,Uu.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Bfe.default)(this,i)}}function mDe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var gDe=2,CI={mipmaps:!1,parameters:(bc={},(0,Si.default)(bc,10240,9729),(0,Si.default)(bc,10241,9729),(0,Si.default)(bc,10242,33071),(0,Si.default)(bc,10243,33071),bc),dataFormat:6408},Mfe=[0,0],yDe={SUM:0,MEAN:1},_De={getPosition:{type:"accessor",value:function(r){return r.position}},getWeight:{type:"accessor",value:1},intensity:{type:"number",min:0,value:1},radiusPixels:{type:"number",min:1,max:100,value:50},colorRange:Vn,threshold:{type:"number",min:0,max:1,value:.05},colorDomain:{type:"array",value:null,optional:!0},aggregation:"SUM",weightsTextureSize:{type:"number",min:128,max:2048,value:2048},debounceTimeout:{type:"number",min:0,max:1e3,value:500}},bDe=[Se.BLEND_EQUATION_MINMAX,Se.TEXTURE_FLOAT],xDe=[Se.COLOR_ATTACHMENT_RGBA32F,Se.FLOAT_BLEND],ADe={data:{props:["radiusPixels"]}},Yb=function(t){(0,kfe.default)(e,t);var r=vDe(e);function e(){var n;(0,Ife.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,Si.default)((0,Lfe.default)(n),"state",void 0),n}return(0,Rfe.default)(e,[{key:"initializeState",value:function(){var i=this.context.gl;if(!dr(i,bDe)){this.setState({supported:!1}),J.error("HeatmapLayer: ".concat(this.id," is not supported on this browser"))();return}(0,Jd.default)((0,Uu.default)(e.prototype),"initializeAggregationLayer",this).call(this,ADe),this.setState({supported:!0,colorDomain:Mfe}),this._setupTextureParams(),this._setupAttributes(),this._setupResources()}},{key:"shouldUpdateState",value:function(i){var a=i.changeFlags;return a.somethingChanged}},{key:"updateState",value:function(i){this.state.supported&&((0,Jd.default)((0,Uu.default)(e.prototype),"updateState",this).call(this,i),this._updateHeatmapState(i))}},{key:"_updateHeatmapState",value:function(i){var a=i.props,o=i.oldProps,s=this._getChangeFlags(i);(s.dataChanged||s.viewportChanged)&&(s.boundsChanged=this._updateBounds(s.dataChanged),this._updateTextureRenderingBounds()),s.dataChanged||s.boundsChanged?(clearTimeout(this.state.updateTimer),this.setState({isWeightMapDirty:!0})):s.viewportZoomChanged&&this._debouncedUpdateWeightmap(),a.colorRange!==o.colorRange&&this._updateColorTexture(i),this.state.isWeightMapDirty&&this._updateWeightmap(),this.setState({zoom:i.context.viewport.zoom})}},{key:"renderLayers",value:function(){if(!this.state.supported)return[];var i=this.state,a=i.weightsTexture,o=i.triPositionBuffer,s=i.triTexCoordBuffer,u=i.maxWeightsTexture,l=i.colorTexture,f=i.colorDomain,c=this.props,p=c.updateTriggers,d=c.intensity,v=c.threshold,m=c.aggregation,g=this.getSubLayerClass("triangle",EI);return new g(this.getSubLayerProps({id:"triangle-layer",updateTriggers:p}),{coordinateSystem:ue.DEFAULT,data:{attributes:{positions:o,texCoords:s}},vertexCount:4,maxTexture:u,colorTexture:l,aggregationMode:yDe[m]||0,texture:a,intensity:d,threshold:v,colorDomain:f})}},{key:"finalizeState",value:function(i){(0,Jd.default)((0,Uu.default)(e.prototype),"finalizeState",this).call(this,i);var a=this.state,o=a.weightsTransform,s=a.weightsTexture,u=a.maxWeightTransform,l=a.maxWeightsTexture,f=a.triPositionBuffer,c=a.triTexCoordBuffer,p=a.colorTexture,d=a.updateTimer;o?.delete(),s?.delete(),u?.delete(),l?.delete(),f?.delete(),c?.delete(),p?.delete(),d&&clearTimeout(d)}},{key:"_getAttributeManager",value:function(){return new Eo(this.context.gl,{id:this.props.id,stats:this.context.stats})}},{key:"_getChangeFlags",value:function(i){var a={},o=this.state.dimensions;a.dataChanged=this.isAttributeChanged()||this.isAggregationDirty(i,{compareAll:!0,dimension:o.data}),a.viewportChanged=i.changeFlags.viewportChanged;var s=this.state.zoom;return(!i.context.viewport||i.context.viewport.zoom!==s)&&(a.viewportZoomChanged=!0),a}},{key:"_createTextures",value:function(){var i=this.context.gl,a=this.state,o=a.textureSize,s=a.format,u=a.type;this.setState({weightsTexture:new we(i,xc({width:o,height:o,format:s,type:u},CI)),maxWeightsTexture:new we(i,xc({format:s,type:u},CI))})}},{key:"_setupAttributes",value:function(){var i=this.getAttributeManager();i.add({positions:{size:3,type:5130,accessor:"getPosition"},weights:{size:1,accessor:"getWeight"}}),this.setState({positionAttributeName:"positions"})}},{key:"_setupTextureParams",value:function(){var i=this.context.gl,a=this.props.weightsTextureSize,o=Math.min(a,Ri(i,3379)),s=dr(i,xDe),u=gfe({gl:i,floatTargetSupport:s}),l=u.format,f=u.type,c=s?1:1/255;this.setState({textureSize:o,format:l,type:f,weightsScale:c}),s||J.warn("HeatmapLayer: ".concat(this.id," rendering to float texture not supported, fallingback to low precession format"))()}},{key:"getShaders",value:function(i){return(0,Jd.default)((0,Uu.default)(e.prototype),"getShaders",this).call(this,i==="max-weights-transform"?{vs:Ofe,_fs:Efe}:{vs:wfe,_fs:Pfe})}},{key:"_createWeightsTransform",value:function(){var i,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=this.context.gl,s=this.state.weightsTransform,u=this.state.weightsTexture;(i=s)===null||i===void 0||i.delete(),s=new Nr(o,xc({id:"".concat(this.id,"-weights-transform"),elementCount:1,_targetTexture:u,_targetTextureVarying:"weightsTexture"},a)),this.setState({weightsTransform:s})}},{key:"_setupResources",value:function(){var i=this.context.gl;this._createTextures();var a=this.state,o=a.textureSize,s=a.weightsTexture,u=a.maxWeightsTexture,l=this.getShaders("weights-transform");this._createWeightsTransform(l);var f=this.getShaders("max-weights-transform"),c=new Nr(i,xc(xc({id:"".concat(this.id,"-max-weights-transform"),_sourceTextures:{inTexture:s},_targetTexture:u,_targetTextureVarying:"outTexture"},f),{},{elementCount:o*o}));this.setState({weightsTexture:s,maxWeightsTexture:u,maxWeightTransform:c,zoom:null,triPositionBuffer:new xe(i,{byteLength:48,accessor:{size:3}}),triTexCoordBuffer:new xe(i,{byteLength:48,accessor:{size:2}})})}},{key:"updateShaders",value:function(i){this._createWeightsTransform(i)}},{key:"_updateMaxWeightValue",value:function(){var i=this.state.maxWeightTransform;i.run({parameters:{blend:!0,depthTest:!1,blendFunc:[1,1],blendEquation:32776}})}},{key:"_updateBounds",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,a=this.context.viewport,o=[a.unproject([0,0]),a.unproject([a.width,0]),a.unproject([a.width,a.height]),a.unproject([0,a.height])].map(function(d){return d.map(Math.fround)}),s=hfe(o),u={visibleWorldBounds:s,viewportCorners:o},l=!1;if(i||!this.state.worldBounds||!dfe(this.state.worldBounds,s)){var f=this._worldToCommonBounds(s),c=this._commonToWorldBounds(f);this.props.coordinateSystem===ue.LNGLAT&&(c[1]=Math.max(c[1],-85.051129),c[3]=Math.min(c[3],85.051129),c[0]=Math.max(c[0],-360),c[2]=Math.min(c[2],360));var p=this._worldToCommonBounds(c);u.worldBounds=c,u.normalizedCommonBounds=p,l=!0}return this.setState(u),l}},{key:"_updateTextureRenderingBounds",value:function(){var i=this.state,a=i.triPositionBuffer,o=i.triTexCoordBuffer,s=i.normalizedCommonBounds,u=i.viewportCorners,l=this.context.viewport;a.subData(wI(u,3));var f=u.map(function(c){return mfe(l.projectPosition(c),s)});o.subData(wI(f,2))}},{key:"_updateColorTexture",value:function(i){var a=i.props.colorRange,o=this.state.colorTexture,s=es(a,!1,Uint8Array);o?o.setImageData({data:s,width:a.length}):o=new we(this.context.gl,xc({data:s,width:a.length,height:1},CI)),this.setState({colorTexture:o})}},{key:"_updateWeightmap",value:function(){var i=this,a,o=this.props,s=o.radiusPixels,u=o.colorDomain,l=o.aggregation,f=this.state,c=f.weightsTransform,p=f.worldBounds,d=f.textureSize,v=f.weightsTexture,m=f.weightsScale;this.state.isWeightMapDirty=!1;var g=this._worldToCommonBounds(p,{useLayerCoordinateSystem:!0});if(u&&l==="SUM"){var y=this.context.viewport,_=y.distanceScales.metersPerUnit[2]*(g[2]-g[0])/d;this.state.colorDomain=u.map(function(x){return x*_*m})}else this.state.colorDomain=u||Mfe;var b={radiusPixels:s,commonBounds:g,textureWidth:d,weightsScale:m};c.update({elementCount:this.getNumInstances()}),Le(this.context.gl,{clearColor:[0,0,0,0]},function(){c.run({uniforms:b,parameters:{blend:!0,depthTest:!1,blendFunc:[1,1],blendEquation:32774},clearRenderTarget:!0,attributes:i.getAttributes(),moduleSettings:i.getModuleSettings()})}),this._updateMaxWeightValue(),v.setParameters((a={},(0,Si.default)(a,10240,9729),(0,Si.default)(a,10241,9729),a))}},{key:"_debouncedUpdateWeightmap",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,a=this.state.updateTimer,o=this.props.debounceTimeout;i?(a=null,this._updateBounds(!0),this._updateTextureRenderingBounds(),this.setState({isWeightMapDirty:!0})):(this.setState({isWeightMapDirty:!1}),clearTimeout(a),a=setTimeout(this._debouncedUpdateWeightmap.bind(this,!0),o)),this.setState({updateTimer:a})}},{key:"_worldToCommonBounds",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=a.useLayerCoordinateSystem,s=o===void 0?!1:o,u=(0,MI.default)(i,4),l=u[0],f=u[1],c=u[2],p=u[3],d=this.context.viewport,v=this.state.textureSize,m=this.props.coordinateSystem,g=s&&(m===ue.LNGLAT_OFFSETS||m===ue.METER_OFFSETS),y=g?d.projectPosition(this.props.coordinateOrigin):[0,0],_=v*gDe/d.scale,b,x;return s&&!g?(b=this.projectPosition([l,f,0]),x=this.projectPosition([c,p,0])):(b=d.projectPosition([l,f,0]),x=d.projectPosition([c,p,0])),vfe([b[0]-y[0],b[1]-y[1],x[0]-y[0],x[1]-y[1]],_,_)}},{key:"_commonToWorldBounds",value:function(i){var a=(0,MI.default)(i,4),o=a[0],s=a[1],u=a[2],l=a[3],f=this.context.viewport,c=f.unprojectPosition([o,s]),p=f.unprojectPosition([u,l]);return c.slice(0,2).concat(p.slice(0,2))}}]),e}(xi);(0,Si.default)(Yb,"layerName","HeatmapLayer");(0,Si.default)(Yb,"defaultProps",_De);var Vfe=h(Hy()),Hfe=h(L()),Wfe=h(N()),Ac=h(B());var Nfe=h(B());function Ffe(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Dfe(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Ffe(Object(e),!0).forEach(function(n){(0,Nfe.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Ffe(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var II=85.05113;function LI(t,r,e,n){if(e){if(e.userData._googleMap===t)return e;Kb(e)}var i={click:null,rightclick:null,dblclick:null,mousemove:null,mouseout:null},a=new dn(Dfe(Dfe({},n),{},{useDevicePixels:n.interleaved?!0:n.useDevicePixels,style:n.interleaved?null:{pointerEvents:"none"},parent:SDe(r,n.style),initialViewState:{longitude:0,latitude:0,zoom:1},controller:!1})),o=function(l){i[l]=t.addListener(l,function(f){return wDe(a,l,f)})};for(var s in i)o(s);return a.userData._googleMap=t,a.userData._eventListeners=i,a}function SDe(t,r){var e=document.createElement("div");if(e.style.position="absolute",Object.assign(e.style,r),"getPanes"in t){var n;(n=t.getPanes())===null||n===void 0||n.overlayLayer.appendChild(e)}else{var i;(i=t.getMap())===null||i===void 0||i.getDiv().appendChild(e)}return e}function Kb(t){var r=t.userData._eventListeners;for(var e in r)r[e]&&r[e].remove();t.finalize()}function jfe(t,r){var e=Ufe(t),n=e.width,i=e.height,a=r.getProjection(),o=t.getBounds();if(!o)return{width:n,height:i,left:0,top:0};var s=o.getNorthEast(),u=o.getSouthWest(),l=a.fromLatLngToDivPixel(s),f=a.fromLatLngToDivPixel(u),c=RI(a,n/2,i/2),p=new google.maps.LatLng(0,c[0]),d=a.fromLatLngToContainerPixel(p),v=a.fromLatLngToDivPixel(p);if(!l||!f||!v||!d)return{width:n,height:i,left:0,top:0};var m=Math.round(v.x-d.x),g=v.y-d.y,y=RI(a,n/2,0),_=RI(a,n/2,i),b=c[1],x=c[0];if(Math.abs(b)>II){b=b>0?II:-II;var A=new google.maps.LatLng(b,x),S=a.fromLatLngToContainerPixel(A);g+=S.y-i/2}g=Math.round(g);var P=new ri(y).sub(_),O=180*P.verticalAngle()/Math.PI;O<0&&(O+=360);var C=t.getHeading()||0,T=t.getZoom()-1,I;if(O===0)I=i?(f.y-l.y)/i:1;else if(O===C){var R=new ri([l.x,l.y]).sub([f.x,f.y]).len(),V=new ri([n,-i]).len();I=V?R/V:1}return T+=Math.log2(I||1),{width:n,height:i,left:m,top:g,zoom:T,bearing:O,pitch:t.getTilt(),latitude:b,longitude:x}}function kI(t,r){var e=Ufe(t),n=e.width,i=e.height,a=r.getCameraParams(),o=a.center,s=a.heading,u=a.tilt,l=a.zoom,f=25,c=i?n/i:1,p=.75,d=3e14,v=new pe().perspective({fovy:f*Math.PI/180,aspect:c,near:p,far:d}),m=.5*v[5];return{width:n,height:i,viewState:{altitude:m,bearing:s,latitude:o.lat(),longitude:o.lng(),pitch:u,projectionMatrix:v,repeat:!0,zoom:l-1}}}function Ufe(t){var r=t.getDiv().firstChild;return{width:r.offsetWidth,height:r.offsetHeight}}function RI(t,r,e){var n=new google.maps.Point(r,e),i=t.fromContainerPixelToLatLng(n);return[i.lng(),i.lat()]}function TDe(t,r){if(t.pixel)return t.pixel;var e=r.getViewports()[0].project([t.latLng.lng(),t.latLng.lat()]);return{x:e[0],y:e[1]}}function wDe(t,r,e){if(t.isInitialized){var n={type:r,offsetCenter:TDe(e,t),srcEvent:e};switch(r){case"click":case"rightclick":n.type="click",n.tapCount=1,t._onPointerDown(n),t._onEvent(n);break;case"dblclick":n.type="click",n.tapCount=2,t._onEvent(n);break;case"mousemove":n.type="pointermove",t._onPointerMove(n);break;case"mouseout":n.type="pointerleave",t._onPointerMove(n);break;default:return}}}var PDe=["width","height","left","top"];function Gfe(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Gu(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Gfe(Object(e),!0).forEach(function(n){(0,Ac.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Gfe(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var ODe=function(){return!1},EDe={depthMask:!0,depthTest:!0,blend:!0,blendFunc:[770,771,1,771],blendEquation:32774};function zfe(){}var CDe={interleaved:!0},$fe=function(){function t(r){(0,Hfe.default)(this,t),(0,Ac.default)(this,"props",{}),(0,Ac.default)(this,"_map",null),(0,Ac.default)(this,"_deck",null),(0,Ac.default)(this,"_overlay",null),this.setProps(Gu(Gu({},CDe),r))}return(0,Wfe.default)(t,[{key:"setMap",value:function(e){var n=this;if(e!==this._map){var i=google.maps.RenderingType,a=i.VECTOR,o=i.UNINITIALIZED;if(this._map){var s;!e&&this._map.getRenderingType()===a&&this.props.interleaved&&this._overlay.requestRedraw(),(s=this._overlay)===null||s===void 0||s.setMap(null),this._map=null}if(e){this._map=e;var u=e.getRenderingType();u!==o?this._createOverlay(e):e.addListener("renderingtype_changed",function(){n._createOverlay(e)})}}}},{key:"setProps",value:function(e){if(Object.assign(this.props,e),this._deck){if(e.style){var n=this._deck.canvas.parentElement.style;Object.assign(n,e.style),e.style=null}this._deck.setProps(e)}}},{key:"pickObject",value:function(e){return this._deck&&this._deck.pickObject(e)}},{key:"pickMultipleObjects",value:function(e){return this._deck&&this._deck.pickMultipleObjects(e)}},{key:"pickObjects",value:function(e){return this._deck&&this._deck.pickObjects(e)}},{key:"finalize",value:function(){this.setMap(null),this._deck&&(Kb(this._deck),this._deck=null)}},{key:"_createOverlay",value:function(e){var n=this.props.interleaved,i=google.maps.RenderingType,a=i.VECTOR,o=i.UNINITIALIZED,s=e.getRenderingType();if(s!==o){var u=s===a&&google.maps.WebGLOverlayView,l=u?google.maps.WebGLOverlayView:google.maps.OverlayView,f=new l;f instanceof google.maps.WebGLOverlayView?(n?(f.onAdd=zfe,f.onContextRestored=this._onContextRestored.bind(this),f.onDraw=this._onDrawVectorInterleaved.bind(this)):(f.onAdd=this._onAdd.bind(this),f.onContextRestored=zfe,f.onDraw=this._onDrawVectorOverlay.bind(this)),f.onContextLost=this._onContextLost.bind(this)):(f.onAdd=this._onAdd.bind(this),f.draw=this._onDrawRaster.bind(this)),f.onRemove=this._onRemove.bind(this),this._overlay=f,this._overlay.setMap(e)}}},{key:"_onAdd",value:function(){this._deck=LI(this._map,this._overlay,this._deck,this.props)}},{key:"_onContextRestored",value:function(e){var n=this,i=e.gl;if(!(!this._map||!this._overlay)){var a=function(){n._overlay&&n._overlay.requestRedraw()},o=LI(this._map,this._overlay,this._deck,Gu({gl:i,_customRender:a},this.props));this._deck=o;var s=o.animationLoop;s._renderFrame=function(){var u=i.getParameter(34964);Le(i,{},function(){s.onRender()}),i.bindBuffer(34962,u)}}}},{key:"_onContextLost",value:function(){this._deck&&(Kb(this._deck),this._deck=null)}},{key:"_onRemove",value:function(){var e;(e=this._deck)===null||e===void 0||e.setProps({layerFilter:ODe})}},{key:"_onDrawRaster",value:function(){if(!(!this._deck||!this._map)){var e=this._deck,n=jfe(this._map,this._overlay),i=n.width,a=n.height,o=n.left,s=n.top,u=(0,Vfe.default)(n,PDe),l=e.canvas.parentElement.style;l.left="".concat(o,"px"),l.top="".concat(s,"px");var f=1e4;e.setProps({width:i,height:a,viewState:Gu({altitude:f,repeat:!0},u)}),e.redraw()}}},{key:"_onDrawVectorInterleaved",value:function(e){var n=e.gl,i=e.transformer;if(!(!this._deck||!this._map)){var a=this._deck;if(a.setProps(Gu(Gu({},kI(this._map,i)),{},{width:null,height:null})),a.isInitialized){var o=Ri(n,36006);a.setProps({_framebuffer:o}),a.needsRedraw({clearRedrawFlags:!0}),Ht(n,{viewport:[0,0,n.canvas.width,n.canvas.height],scissor:[0,0,n.canvas.width,n.canvas.height],stencilFunc:[519,0,255,519,0,255]}),Le(n,EDe,function(){a._drawLayers("google-vector",{clearCanvas:!1})})}}}},{key:"_onDrawVectorOverlay",value:function(e){var n=e.transformer;if(!(!this._deck||!this._map)){var i=this._deck;i.setProps(Gu({},kI(this._map,n))),i.redraw()}}}]),t}();var tce=h(L()),rce=h(N()),Vu=h(B());var Yfe=h(B());function Xfe(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function zu(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Xfe(Object(e),!0).forEach(function(n){(0,Yfe.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Xfe(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var BI=512,MDe=Math.PI/180;function Zb(t){var r=t.map,e=t.gl,n=t.deck;if(r.__deck)return r.__deck;var i=n?.props._customRender,a=n?.props.onLoad,o=DI(zu(zu({},n?.props),{},{_customRender:function(){r.triggerRepaint(),i?.("")}})),s;return(!n||n.props.gl===e)&&(Object.assign(o,{gl:e,width:null,height:null,touchAction:"unset",viewState:Sc(r)}),n!=null&&n.isInitialized?qfe(n,r):o.onLoad=function(){a?.(),qfe(s,r)}),n?(s=n,n.setProps(o),n.userData.isExternal=!0):(s=new dn(o),r.on("remove",function(){FI(r)})),s.userData.mapboxLayers=new Set,r.__deck=s,r.on("render",function(){s.isInitialized&&RDe(s,r)}),s}function qfe(t,r){var e=function n(){t.isInitialized?LDe(t,r):r.off("move",n)};r.on("move",e)}function FI(t){var r;(r=t.__deck)===null||r===void 0||r.finalize(),t.__deck=null}function DI(t){var r=zu(zu({},t),{},{parameters:zu({depthMask:!0,depthTest:!0,blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthFunc:515,blendEquation:32774},t.parameters),views:t.views||[new Vs({id:"mapbox"})]});return r}function Kfe(t,r){t.userData.mapboxLayers.add(r),NI(t)}function Zfe(t,r){t.userData.mapboxLayers.delete(r),NI(t)}function Jfe(t,r){NI(t)}function Qfe(t,r,e){var n=t.userData,i=n.currentViewport,a=!1;i||(i=ece(t,r,!0),t.userData.currentViewport=i,a=!0),t.isInitialized&&t._drawLayers("mapbox-repaint",{viewports:[i],layerFilter:function(s){var u=s.layer;return e.id===u.id},clearStack:a,clearCanvas:!1})}function Sc(t){var r,e=t.getCenter(),n=e.lng,i=e.lat,a={longitude:(n+540)%360-180,latitude:i,zoom:t.getZoom(),bearing:t.getBearing(),pitch:t.getPitch(),padding:t.getPadding(),repeat:t.getRenderWorldCopies()};return(r=t.getTerrain)!==null&&r!==void 0&&r.call(t)&&IDe(t,a),a}function IDe(t,r){if(t.getFreeCameraOptions){var e=t.getFreeCameraOptions(),n=e.position;if(!n||n.z===void 0)return;var i=t.transform.height,a=r.longitude,o=r.latitude,s=r.pitch,u=n.x*BI,l=(1-n.y)*BI,f=n.z*BI,c=wt([a,o]),p=u-c[0],d=l-c[1],v=Math.sqrt(p*p+d*d),m=s*MDe,g=1.5*i,y=m<.001?g*Math.cos(m)/f:g*Math.sin(m)/v;r.zoom=Math.log2(y);var _=g*Math.cos(m)/y,b=f-_;r.position=[0,0,b/ks(o)]}else typeof t.transform.elevation=="number"&&(r.position=[0,0,t.transform.elevation])}function ece(t,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return new Kr(zu(zu({id:"mapbox",x:0,y:0,width:t.width,height:t.height},Sc(r)),{},{nearZMultiplier:e?.02:.1}))}function RDe(t,r){var e=t.userData,n=e.mapboxLayers,i=e.isExternal;if(i){var a=Array.from(n,function(c){return c.id}),o=jr(t.props.layers,Boolean),s=o.some(function(c){return c&&!a.includes(c.id)}),u=t.getViewports(),l=u.findIndex(function(c){return c.id==="mapbox"}),f=u.length>1||l<0;(s||f)&&(l>=0&&(u=u.slice(),u[l]=ece(t,r,!1)),t._drawLayers("mapbox-repaint",{viewports:u,layerFilter:function(p){return(!t.props.layerFilter||t.props.layerFilter(p))&&(p.viewport.id!=="mapbox"||!a.includes(p.layer.id))},clearCanvas:!1}))}t.userData.currentViewport=null}function LDe(t,r){t.setProps({viewState:Sc(r)}),t.needsRedraw({clearRedrawFlags:!0})}function NI(t){if(!t.userData.isExternal){var r=[];t.userData.mapboxLayers.forEach(function(e){var n=e.props.type,i=new n(e.props);r.push(i)}),t.setProps({layers:r})}}var Jb=function(){function t(r){if((0,tce.default)(this,t),(0,Vu.default)(this,"id",void 0),(0,Vu.default)(this,"type",void 0),(0,Vu.default)(this,"renderingMode",void 0),(0,Vu.default)(this,"map",void 0),(0,Vu.default)(this,"deck",void 0),(0,Vu.default)(this,"props",void 0),!r.id)throw new Error("Layer must have an unique id");this.id=r.id,this.type="custom",this.renderingMode=r.renderingMode||"3d",this.map=null,this.deck=null,this.props=r}return(0,rce.default)(t,[{key:"onAdd",value:function(e,n){this.map=e,this.deck=Zb({map:e,gl:n,deck:this.props.deck}),Kfe(this.deck,this)}},{key:"onRemove",value:function(){this.deck&&Zfe(this.deck,this)}},{key:"setProps",value:function(e){Object.assign(this.props,e,{id:this.id}),this.deck&&Jfe(this.deck,this)}},{key:"render",value:function(){Qfe(this.deck,this.map,this)}}]),t}();var ace=h(Hy()),oce=h(L()),sce=h(N()),Hn=h(B());function Qb(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=kDe(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var l=e.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function kDe(t,r){if(t){if(typeof t=="string")return nce(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return nce(t,r)}}function nce(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var jI="__UNDEFINED__";function Qd(t,r,e,n){if(!(!t||!r||!t.style||!t.style._loaded)){var i=jr(n,Boolean);if(e!==n){var a=jr(e,Boolean),o=new Set(a.map(function(z){return z.id})),s=Qb(i),u;try{for(s.s();!(u=s.n()).done;){var l=u.value;o.delete(l.id)}}catch(z){s.e(z)}finally{s.f()}var f=Qb(o),c;try{for(f.s();!(c=f.n()).done;){var p=c.value;t.getLayer(p)&&t.removeLayer(p)}}catch(z){f.e(z)}finally{f.f()}}var d=Qb(i),v;try{for(d.s();!(v=d.n()).done;){var m=v.value,g=t.getLayer(m.id);g?g.implementation.setProps(m.props):t.addLayer(new Jb({id:m.id,deck:r}),m.props.beforeId)}}catch(z){d.e(z)}finally{d.f()}var y=t.style._order,_={},b=Qb(i),x;try{for(b.s();!(x=b.n()).done;){var A=x.value,S=A.props.beforeId;(!S||!y.includes(S))&&(S=jI),_[S]=_[S]||[],_[S].push(A.id)}}catch(z){b.e(z)}finally{b.f()}for(var P in _)for(var O=_[P],C=P===jI?y.length:y.indexOf(P),T=P===jI?void 0:P,I=O.length-1;I>=0;I--){var R=O[I],V=y.indexOf(R);V!==C-1&&(t.moveLayer(R,T),V>C&&C++),C--,T=R}}}var BDe=["interleaved"];function ice(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Tc(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?ice(Object(e),!0).forEach(function(n){(0,Hn.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):ice(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var uce=function(){function t(r){var e=this;(0,oce.default)(this,t),(0,Hn.default)(this,"_props",void 0),(0,Hn.default)(this,"_deck",void 0),(0,Hn.default)(this,"_map",void 0),(0,Hn.default)(this,"_container",void 0),(0,Hn.default)(this,"_interleaved",void 0),(0,Hn.default)(this,"_lastMouseDownPoint",void 0),(0,Hn.default)(this,"_handleStyleChange",function(){Qd(e._map,e._deck,e._props.layers,e._props.layers)}),(0,Hn.default)(this,"_updateContainerSize",function(){if(e._map&&e._container){var o=e._map.getContainer(),s=o.clientWidth,u=o.clientHeight;Object.assign(e._container.style,{width:"".concat(s,"px"),height:"".concat(u,"px")})}}),(0,Hn.default)(this,"_updateViewState",function(){var o=e._deck;o&&(o.setProps({viewState:Sc(e._map)}),o.isInitialized&&o.redraw())}),(0,Hn.default)(this,"_handleMouseEvent",function(o){var s=e._deck;if(!(!s||!s.isInitialized)){var u={type:o.type,offsetCenter:o.point,srcEvent:o},l=e._lastMouseDownPoint;switch(!o.point&&l&&(u.deltaX=o.originalEvent.clientX-l.clientX,u.deltaY=o.originalEvent.clientY-l.clientY,u.offsetCenter={x:l.x+u.deltaX,y:l.y+u.deltaY}),u.type){case"mousedown":s._onPointerDown(u),e._lastMouseDownPoint=Tc(Tc({},o.point),{},{clientX:o.originalEvent.clientX,clientY:o.originalEvent.clientY});break;case"dragstart":u.type="panstart",s._onEvent(u);break;case"drag":u.type="panmove",s._onEvent(u);break;case"dragend":u.type="panend",s._onEvent(u);break;case"click":u.tapCount=1,s._onEvent(u);break;case"dblclick":u.type="click",u.tapCount=2,s._onEvent(u);break;case"mousemove":u.type="pointermove",s._onPointerMove(u);break;case"mouseout":u.type="pointerleave",s._onPointerMove(u);break;default:return}}});var n=r.interleaved,i=n===void 0?!1:n,a=(0,ace.default)(r,BDe);this._interleaved=i,this._props=a}return(0,sce.default)(t,[{key:"setProps",value:function(e){this._interleaved&&e.layers&&Qd(this._map,this._deck,this._props.layers,e.layers),Object.assign(this._props,e),this._deck&&this._deck.setProps(this._interleaved?DI(this._props):this._props)}},{key:"onAdd",value:function(e){return this._map=e,this._interleaved?this._onAddInterleaved(e):this._onAddOverlaid(e)}},{key:"_onAddOverlaid",value:function(e){var n=document.createElement("div");return Object.assign(n.style,{position:"absolute",left:0,top:0,pointerEvents:"none"}),this._container=n,this._deck=new dn(Tc(Tc({},this._props),{},{parent:n,viewState:Sc(e)})),e.on("resize",this._updateContainerSize),e.on("render",this._updateViewState),e.on("mousedown",this._handleMouseEvent),e.on("dragstart",this._handleMouseEvent),e.on("drag",this._handleMouseEvent),e.on("dragend",this._handleMouseEvent),e.on("mousemove",this._handleMouseEvent),e.on("mouseout",this._handleMouseEvent),e.on("click",this._handleMouseEvent),e.on("dblclick",this._handleMouseEvent),this._updateContainerSize(),n}},{key:"_onAddInterleaved",value:function(e){return this._deck=Zb({map:e,gl:e.painter.context.gl,deck:new dn(Tc(Tc({},this._props),{},{gl:e.painter.context.gl}))}),e.on("styledata",this._handleStyleChange),Qd(e,this._deck,[],this._props.layers),document.createElement("div")}},{key:"onRemove",value:function(){var e=this._map;e&&(this._interleaved?this._onRemoveInterleaved(e):this._onRemoveOverlaid(e)),this._deck=void 0,this._map=void 0,this._container=void 0}},{key:"_onRemoveOverlaid",value:function(e){var n;e.off("resize",this._updateContainerSize),e.off("render",this._updateViewState),e.off("mousedown",this._handleMouseEvent),e.off("dragstart",this._handleMouseEvent),e.off("drag",this._handleMouseEvent),e.off("dragend",this._handleMouseEvent),e.off("mousemove",this._handleMouseEvent),e.off("mouseout",this._handleMouseEvent),e.off("click",this._handleMouseEvent),e.off("dblclick",this._handleMouseEvent),(n=this._deck)===null||n===void 0||n.finalize()}},{key:"_onRemoveInterleaved",value:function(e){e.off("styledata",this._handleStyleChange),Qd(e,this._deck,this._props.layers,[]),FI(e)}},{key:"getDefaultPosition",value:function(){return"top-left"}},{key:"pickObject",value:function(e){return rt(this._deck),this._deck.pickObject(e)}},{key:"pickMultipleObjects",value:function(e){return rt(this._deck),this._deck.pickMultipleObjects(e)}},{key:"pickObjects",value:function(e){return rt(this._deck),this._deck.pickObjects(e)}},{key:"finalize",value:function(){this._map&&this._map.removeControl(this)}}]),t}();var ev=h(E0());ja._checkH3Lib=function(){var t='include the <script src="https://unpkg.com/h3-js@^3.0.0"><\/script> tag before the deck.gl script tag. https://deck.gl/docs/api-reference/geo-layers/h3-hexagon-layer';if(ev){if(!ev.polyfill&&ev.polygonToCells)throw new Error("Incompatible h3-js version. ".concat(t))}else throw new Error("To use H3 functionality, ".concat(t))};return Fce(FDe);})();
      return __exports__;
      });
