(function webpackUniversalModuleDefinition(root, factory) {
  if (typeof exports === 'object' && typeof module === 'object')
    module.exports = factory();
  else if (typeof define === 'function' && define.amd) define([], factory);
        else if (typeof exports === 'object') exports['deck'] = factory();
  else root['deck'] = factory();})(globalThis, function () {
"use strict";var __exports__=(()=>{var it=Object.create;var gr=Object.defineProperty;var ot=Object.getOwnPropertyDescriptor;var st=Object.getOwnPropertyNames;var vt=Object.getPrototypeOf,lt=Object.prototype.hasOwnProperty;var J=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),ft=(r,e)=>{for(var t in e)gr(r,t,{get:e[t],enumerable:!0})},mr=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of st(e))!lt.call(r,a)&&a!==t&&gr(r,a,{get:()=>e[a],enumerable:!(n=ot(e,a))||n.enumerable});return r},X=(r,e,t)=>(mr(r,e,"default"),t&&mr(t,e,"default")),D=(r,e,t)=>(t=r!=null?it(vt(r)):{},mr(e||!r||!r.__esModule?gr(t,"default",{value:r,enumerable:!0}):t,r)),ct=r=>mr(gr({},"__esModule",{value:!0}),r);var rr=J((It,le)=>{le.exports=globalThis.deck});var Rr=J((Dt,ce)=>{function ht(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}ce.exports=ht});var Nr=J((Rt,pe)=>{function he(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function pt(r,e,t){return e&&he(r.prototype,e),t&&he(r,t),r}pe.exports=pt});var yr=J((Nt,de)=>{function dt(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}de.exports=dt});var We=J((fa,Ve)=>{function zt(r,e){if(r==null)return{};var t={},n=Object.keys(r),a,v;for(v=0;v<n.length;v++)a=n[v],!(e.indexOf(a)>=0)&&(t[a]=r[a]);return t}Ve.exports=zt});var Be=J((ca,Xe)=>{var At=We();function Lt(r,e){if(r==null)return{};var t=At(r,e),n,a;if(Object.getOwnPropertySymbols){var v=Object.getOwnPropertySymbols(r);for(a=0;a<v.length;a++)n=v[a],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(r,n)&&(t[n]=r[n])}return t}Xe.exports=Lt});var xr={};ft(xr,{MapboxLayer:()=>Sr,MapboxOverlay:()=>Je});var V={},fe=D(rr());X(V,D(rr()));if(!fe.Layer)throw new Error("@deck.gl/core is not found");X(xr,V);var qe=D(Rr()),$e=D(Nr()),G=D(yr());var Re=D(yr()),U=D(rr());function er(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=r[t];return n}function Fr(r){if(Array.isArray(r))return er(r)}function Cr(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function cr(r,e){if(r){if(typeof r=="string")return er(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return er(r,e)}}function Yr(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function tr(r){return Fr(r)||Cr(r)||cr(r)||Yr()}function Zr(r){if(Array.isArray(r))return r}function qr(r,e){var t=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(t!=null){var n=[],a=!0,v=!1,o,i;try{for(t=t.call(r);!(a=(o=t.next()).done)&&(n.push(o.value),!(e&&n.length===e));a=!0);}catch(s){v=!0,i=s}finally{try{!a&&t.return!=null&&t.return()}finally{if(v)throw i}}return n}}function $r(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function j(r,e){return Zr(r)||qr(r,e)||cr(r,e)||$r()}function Vr(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function xe(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function Wr(r,e,t){return e&&xe(r.prototype,e),t&&xe(r,t),r}function b(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}var L=1e-6,W=typeof Float32Array<"u"?Float32Array:Array;var vn=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var r=0,e=arguments.length;e--;)r+=arguments[e]*arguments[e];return Math.sqrt(r)});function xt(){var r=new W(4);return W!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function me(r,e,t){return r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r[3]=e[3]*t,r}function ge(r,e,t){var n=e[0],a=e[1],v=e[2],o=e[3];return r[0]=t[0]*n+t[4]*a+t[8]*v+t[12]*o,r[1]=t[1]*n+t[5]*a+t[9]*v+t[13]*o,r[2]=t[2]*n+t[6]*a+t[10]*v+t[14]*o,r[3]=t[3]*n+t[7]*a+t[11]*v+t[15]*o,r}var ln=function(){var r=xt();return function(e,t,n,a,v,o){var i,s;for(t||(t=4),n||(n=0),a?s=Math.min(a*t+n,e.length):s=e.length,i=n;i<s;i+=t)r[0]=e[i],r[1]=e[i+1],r[2]=e[i+2],r[3]=e[i+3],v(r,r,o),e[i]=r[0],e[i+1]=r[1],e[i+2]=r[2],e[i+3]=r[3];return e}}();function nr(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function B(r,e){var t=ge([],e,r);return me(t,t,1/t[3]),t}function hr(r,e,t){return r<e?e:r>t?t:r}function Mt(r){return Math.log(r)*Math.LOG2E}var _r=Math.log2||Mt;function ye(r,e){var t=e[0],n=e[1],a=e[2],v=e[3],o=e[4],i=e[5],s=e[6],l=e[7],c=e[8],f=e[9],h=e[10],y=e[11],u=e[12],_=e[13],w=e[14],M=e[15],P=t*i-n*o,p=t*s-a*o,g=t*l-v*o,m=n*s-a*i,x=n*l-v*i,E=a*l-v*s,I=c*_-f*u,T=c*w-h*u,S=c*M-y*u,z=f*w-h*_,O=f*M-y*_,A=h*M-y*w,d=P*A-p*O+g*z+m*S-x*T+E*I;return d?(d=1/d,r[0]=(i*A-s*O+l*z)*d,r[1]=(a*O-n*A-v*z)*d,r[2]=(_*E-w*x+M*m)*d,r[3]=(h*x-f*E-y*m)*d,r[4]=(s*S-o*A-l*T)*d,r[5]=(t*A-a*S+v*T)*d,r[6]=(w*g-u*E-M*p)*d,r[7]=(c*E-h*g+y*p)*d,r[8]=(o*O-i*S+l*I)*d,r[9]=(n*S-t*O-v*I)*d,r[10]=(u*x-_*g+M*P)*d,r[11]=(f*g-c*x-y*P)*d,r[12]=(i*T-o*z-s*I)*d,r[13]=(t*z-n*T+a*I)*d,r[14]=(_*p-u*m-w*P)*d,r[15]=(c*m-f*p+h*P)*d,r):null}function wr(r,e,t){var n=e[0],a=e[1],v=e[2],o=e[3],i=e[4],s=e[5],l=e[6],c=e[7],f=e[8],h=e[9],y=e[10],u=e[11],_=e[12],w=e[13],M=e[14],P=e[15],p=t[0],g=t[1],m=t[2],x=t[3];return r[0]=p*n+g*i+m*f+x*_,r[1]=p*a+g*s+m*h+x*w,r[2]=p*v+g*l+m*y+x*M,r[3]=p*o+g*c+m*u+x*P,p=t[4],g=t[5],m=t[6],x=t[7],r[4]=p*n+g*i+m*f+x*_,r[5]=p*a+g*s+m*h+x*w,r[6]=p*v+g*l+m*y+x*M,r[7]=p*o+g*c+m*u+x*P,p=t[8],g=t[9],m=t[10],x=t[11],r[8]=p*n+g*i+m*f+x*_,r[9]=p*a+g*s+m*h+x*w,r[10]=p*v+g*l+m*y+x*M,r[11]=p*o+g*c+m*u+x*P,p=t[12],g=t[13],m=t[14],x=t[15],r[12]=p*n+g*i+m*f+x*_,r[13]=p*a+g*s+m*h+x*w,r[14]=p*v+g*l+m*y+x*M,r[15]=p*o+g*c+m*u+x*P,r}function pr(r,e,t){var n=t[0],a=t[1],v=t[2],o,i,s,l,c,f,h,y,u,_,w,M;return e===r?(r[12]=e[0]*n+e[4]*a+e[8]*v+e[12],r[13]=e[1]*n+e[5]*a+e[9]*v+e[13],r[14]=e[2]*n+e[6]*a+e[10]*v+e[14],r[15]=e[3]*n+e[7]*a+e[11]*v+e[15]):(o=e[0],i=e[1],s=e[2],l=e[3],c=e[4],f=e[5],h=e[6],y=e[7],u=e[8],_=e[9],w=e[10],M=e[11],r[0]=o,r[1]=i,r[2]=s,r[3]=l,r[4]=c,r[5]=f,r[6]=h,r[7]=y,r[8]=u,r[9]=_,r[10]=w,r[11]=M,r[12]=o*n+c*a+u*v+e[12],r[13]=i*n+f*a+_*v+e[13],r[14]=s*n+h*a+w*v+e[14],r[15]=l*n+y*a+M*v+e[15]),r}function Pr(r,e,t){var n=t[0],a=t[1],v=t[2];return r[0]=e[0]*n,r[1]=e[1]*n,r[2]=e[2]*n,r[3]=e[3]*n,r[4]=e[4]*a,r[5]=e[5]*a,r[6]=e[6]*a,r[7]=e[7]*a,r[8]=e[8]*v,r[9]=e[9]*v,r[10]=e[10]*v,r[11]=e[11]*v,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function ue(r,e,t){var n=Math.sin(t),a=Math.cos(t),v=e[4],o=e[5],i=e[6],s=e[7],l=e[8],c=e[9],f=e[10],h=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=v*a+l*n,r[5]=o*a+c*n,r[6]=i*a+f*n,r[7]=s*a+h*n,r[8]=l*a-v*n,r[9]=c*a-o*n,r[10]=f*a-i*n,r[11]=h*a-s*n,r}function _e(r,e,t){var n=Math.sin(t),a=Math.cos(t),v=e[0],o=e[1],i=e[2],s=e[3],l=e[4],c=e[5],f=e[6],h=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=v*a+l*n,r[1]=o*a+c*n,r[2]=i*a+f*n,r[3]=s*a+h*n,r[4]=l*a-v*n,r[5]=c*a-o*n,r[6]=f*a-i*n,r[7]=h*a-s*n,r}function mt(r,e,t,n,a){var v=1/Math.tan(e/2),o;return r[0]=v/t,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=v,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,a!=null&&a!==1/0?(o=1/(n-a),r[10]=(a+n)*o,r[14]=2*a*n*o):(r[10]=-1,r[14]=-2*n),r}var we=mt;function Xr(r,e){var t=r[0],n=r[1],a=r[2],v=r[3],o=r[4],i=r[5],s=r[6],l=r[7],c=r[8],f=r[9],h=r[10],y=r[11],u=r[12],_=r[13],w=r[14],M=r[15],P=e[0],p=e[1],g=e[2],m=e[3],x=e[4],E=e[5],I=e[6],T=e[7],S=e[8],z=e[9],O=e[10],A=e[11],d=e[12],$=e[13],F=e[14],k=e[15];return Math.abs(t-P)<=L*Math.max(1,Math.abs(t),Math.abs(P))&&Math.abs(n-p)<=L*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(a-g)<=L*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(v-m)<=L*Math.max(1,Math.abs(v),Math.abs(m))&&Math.abs(o-x)<=L*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(i-E)<=L*Math.max(1,Math.abs(i),Math.abs(E))&&Math.abs(s-I)<=L*Math.max(1,Math.abs(s),Math.abs(I))&&Math.abs(l-T)<=L*Math.max(1,Math.abs(l),Math.abs(T))&&Math.abs(c-S)<=L*Math.max(1,Math.abs(c),Math.abs(S))&&Math.abs(f-z)<=L*Math.max(1,Math.abs(f),Math.abs(z))&&Math.abs(h-O)<=L*Math.max(1,Math.abs(h),Math.abs(O))&&Math.abs(y-A)<=L*Math.max(1,Math.abs(y),Math.abs(A))&&Math.abs(u-d)<=L*Math.max(1,Math.abs(u),Math.abs(d))&&Math.abs(_-$)<=L*Math.max(1,Math.abs(_),Math.abs($))&&Math.abs(w-F)<=L*Math.max(1,Math.abs(w),Math.abs(F))&&Math.abs(M-k)<=L*Math.max(1,Math.abs(M),Math.abs(k))}function gt(){var r=new W(2);return W!=Float32Array&&(r[0]=0,r[1]=0),r}function Br(r,e,t){return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r}function Oe(r,e){return r[0]=-e[0],r[1]=-e[1],r}function Or(r,e,t,n){var a=e[0],v=e[1];return r[0]=a+n*(t[0]-a),r[1]=v+n*(t[1]-v),r}var pn=function(){var r=gt();return function(e,t,n,a,v,o){var i,s;for(t||(t=2),n||(n=0),a?s=Math.min(a*t+n,e.length):s=e.length,i=n;i<s;i+=t)r[0]=e[i],r[1]=e[i+1],v(r,r,o),e[i]=r[0],e[i+1]=r[1];return e}}();function yt(){var r=new W(3);return W!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function be(r,e,t){return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r}function ut(r,e,t){return r[0]=e[0]*t[0],r[1]=e[1]*t[1],r[2]=e[2]*t[2],r}function Ee(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r}var ze=ut;var dn=function(){var r=yt();return function(e,t,n,a,v,o){var i,s;for(t||(t=3),n||(n=0),a?s=Math.min(a*t+n,e.length):s=e.length,i=n;i<s;i+=t)r[0]=e[i],r[1]=e[i+1],r[2]=e[i+2],v(r,r,o),e[i]=r[0],e[i+1]=r[1],e[i+2]=r[2];return e}}();function C(r,e){if(!r)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}var Y=Math.PI,Le=Y/4,Z=Y/180,Hr=180/Y,ar=512,Gr=4003e4,or=85.051129,Qr=1.5;function br(r){return Math.pow(2,r)}function R(r){var e=j(r,2),t=e[0],n=e[1];C(Number.isFinite(t)),C(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");var a=t*Z,v=n*Z,o=ar*(a+Y)/(2*Y),i=ar*(Y+Math.log(Math.tan(Le+v*.5)))/(2*Y);return[o,i]}function q(r){var e=j(r,2),t=e[0],n=e[1],a=t/ar*(2*Y)-Y,v=2*(Math.atan(Math.exp(n/ar*(2*Y)-Y))-Le);return[a*Hr,v*Hr]}function Kr(r){var e=Math.cos(r*Z);return ar/Gr/e}function Jr(r){var e=r.latitude,t=r.longitude,n=r.highPrecision,a=n===void 0?!1:n;C(Number.isFinite(e)&&Number.isFinite(t));var v=ar,o=Math.cos(e*Z),i=v/360,s=i/o,l=v/Gr/o,c={unitsPerMeter:[l,l,l],metersPerUnit:[1/l,1/l,1/l],unitsPerDegree:[i,s,l],degreesPerUnit:[1/i,1/s,1/l]};if(a){var f=Z*Math.tan(e*Z)/o,h=i*f/2,y=v/Gr*f,u=y/s*l;c.unitsPerDegree2=[0,h,y],c.unitsPerMeter2=[u,0,u]}return c}function re(r){var e=r.height,t=r.pitch,n=r.bearing,a=r.altitude,v=r.scale,o=r.center,i=nr();pr(i,i,[0,0,-a]),ue(i,i,-t*Z),_e(i,i,n*Z);var s=v/e;return Pr(i,i,[s,s,s]),o&&pr(i,i,Ee([],o)),i}function Te(r){var e=r.width,t=r.height,n=r.altitude,a=r.pitch,v=a===void 0?0:a,o=r.offset,i=r.center,s=r.scale,l=r.nearZMultiplier,c=l===void 0?1:l,f=r.farZMultiplier,h=f===void 0?1:f,y=r.fovy,u=y===void 0?ir(Qr):y;n!==void 0&&(u=ir(n));var _=u*Z,w=v*Z,M=Er(u),P=M;i&&(P+=i[2]*s/Math.cos(w)/t);var p=_*(.5+(o?o[1]:0)/t),g=Math.sin(p)*P/Math.sin(hr(Math.PI/2-w-p,.01,Math.PI-.01)),m=Math.sin(w)*g+P,x=P*10,E=Math.min(m*h,x);return{fov:_,aspect:e/t,focalDistance:M,near:c,far:E}}function ee(r){var e=Te(r),t=e.fov,n=e.aspect,a=e.near,v=e.far,o=we([],t,n,a,v);return o}function ir(r){return 2*Math.atan(.5/r)*Hr}function Er(r){return .5/Math.tan(.5*r*Z)}function te(r,e){var t=j(r,3),n=t[0],a=t[1],v=t[2],o=v===void 0?0:v;return C(Number.isFinite(n)&&Number.isFinite(a)&&Number.isFinite(o)),B(e,[n,a,o,1])}function zr(r,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=j(r,3),a=n[0],v=n[1],o=n[2];if(C(Number.isFinite(a)&&Number.isFinite(v),"invalid pixel coordinate"),Number.isFinite(o)){var i=B(e,[a,v,o,1]);return i}var s=B(e,[a,v,0,1]),l=B(e,[a,v,1,1]),c=s[2],f=l[2],h=c===f?0:((t||0)-c)/(f-c);return Or([],s,l,h)}function Ar(r){var e=r.width,t=r.height,n=r.bounds,a=r.minExtent,v=a===void 0?0:a,o=r.maxZoom,i=o===void 0?24:o,s=r.offset,l=s===void 0?[0,0]:s,c=j(n,2),f=j(c[0],2),h=f[0],y=f[1],u=j(c[1],2),_=u[0],w=u[1],M=_t(r.padding),P=R([h,hr(w,-or,or)]),p=R([_,hr(y,-or,or)]),g=[Math.max(Math.abs(p[0]-P[0]),v),Math.max(Math.abs(p[1]-P[1]),v)],m=[e-M.left-M.right-Math.abs(l[0])*2,t-M.top-M.bottom-Math.abs(l[1])*2];C(m[0]>0&&m[1]>0);var x=m[0]/g[0],E=m[1]/g[1],I=(M.right-M.left)/2/x,T=(M.bottom-M.top)/2/E,S=[(p[0]+P[0])/2+I,(p[1]+P[1])/2+T],z=q(S),O=Math.min(i,_r(Math.abs(Math.min(x,E))));return C(Number.isFinite(O)),{longitude:z[0],latitude:z[1],zoom:O}}function _t(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return typeof r=="number"?{top:r,bottom:r,left:r,right:r}:(C(Number.isFinite(r.top)&&Number.isFinite(r.bottom)&&Number.isFinite(r.left)&&Number.isFinite(r.right)),r)}var Se=Math.PI/180;function Lr(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=r.width,n=r.height,a=r.unproject,v={targetZ:e},o=a([0,n],v),i=a([t,n],v),s,l,c=r.fovy?.5*r.fovy*Se:Math.atan(.5/r.altitude),f=(90-r.pitch)*Se;return c>f-.01?(s=je(r,0,e),l=je(r,t,e)):(s=a([0,0],v),l=a([t,0],v)),[o,i,l,s]}function je(r,e,t){var n=r.pixelUnprojectionMatrix,a=B(n,[e,0,1,1]),v=B(n,[e,r.height,1,1]),o=t*r.distanceScales.unitsPerMeter[2],i=(o-a[2])/(v[2]-a[2]),s=Or([],a,v,i),l=q(s);return l.push(t),l}var Ie=function(){function r(){var e=this,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{width:1,height:1};Vr(this,r),b(this,"latitude",void 0),b(this,"longitude",void 0),b(this,"zoom",void 0),b(this,"pitch",void 0),b(this,"bearing",void 0),b(this,"altitude",void 0),b(this,"fovy",void 0),b(this,"meterOffset",void 0),b(this,"center",void 0),b(this,"width",void 0),b(this,"height",void 0),b(this,"scale",void 0),b(this,"distanceScales",void 0),b(this,"viewMatrix",void 0),b(this,"projectionMatrix",void 0),b(this,"viewProjectionMatrix",void 0),b(this,"pixelProjectionMatrix",void 0),b(this,"pixelUnprojectionMatrix",void 0),b(this,"equals",function(O){return O instanceof r?O.width===e.width&&O.height===e.height&&Xr(O.projectionMatrix,e.projectionMatrix)&&Xr(O.viewMatrix,e.viewMatrix):!1}),b(this,"project",function(O){var A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},d=A.topLeft,$=d===void 0?!0:d,F=e.projectPosition(O),k=te(F,e.pixelProjectionMatrix),K=j(k,2),Mr=K[0],lr=K[1],fr=$?lr:e.height-lr;return O.length===2?[Mr,fr]:[Mr,fr,k[2]]}),b(this,"unproject",function(O){var A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},d=A.topLeft,$=d===void 0?!0:d,F=A.targetZ,k=F===void 0?void 0:F,K=j(O,3),Mr=K[0],lr=K[1],fr=K[2],rt=$?lr:e.height-lr,et=k&&k*e.distanceScales.unitsPerMeter[2],tt=zr([Mr,rt,fr],e.pixelUnprojectionMatrix,et),nt=e.unprojectPosition(tt),Ir=j(nt,3),kr=Ir[0],Dr=Ir[1],at=Ir[2];return Number.isFinite(fr)?[kr,Dr,at]:Number.isFinite(k)?[kr,Dr,k]:[kr,Dr]}),b(this,"projectPosition",function(O){var A=R(O),d=j(A,2),$=d[0],F=d[1],k=(O[2]||0)*e.distanceScales.unitsPerMeter[2];return[$,F,k]}),b(this,"unprojectPosition",function(O){var A=q(O),d=j(A,2),$=d[0],F=d[1],k=(O[2]||0)*e.distanceScales.metersPerUnit[2];return[$,F,k]});var n=t.width,a=t.height,v=t.altitude,o=v===void 0?null:v,i=t.fovy,s=i===void 0?null:i,l=t.latitude,c=l===void 0?0:l,f=t.longitude,h=f===void 0?0:f,y=t.zoom,u=y===void 0?0:y,_=t.pitch,w=_===void 0?0:_,M=t.bearing,P=M===void 0?0:M,p=t.position,g=p===void 0?null:p,m=t.nearZMultiplier,x=m===void 0?.02:m,E=t.farZMultiplier,I=E===void 0?1.01:E;n=n||1,a=a||1,s===null&&o===null?(o=Qr,s=ir(o)):s===null?s=ir(o):o===null&&(o=Er(s));var T=br(u);o=Math.max(.75,o);var S=Jr({longitude:h,latitude:c}),z=R([h,c]);z.push(0),g&&be(z,z,ze([],g,S.unitsPerMeter)),this.projectionMatrix=ee({width:n,height:a,scale:T,center:z,pitch:w,fovy:s,nearZMultiplier:x,farZMultiplier:I}),this.viewMatrix=re({height:a,scale:T,center:z,pitch:w,bearing:P,altitude:o}),this.width=n,this.height=a,this.scale=T,this.latitude=c,this.longitude=h,this.zoom=u,this.pitch=w,this.bearing=P,this.altitude=o,this.fovy=s,this.center=z,this.meterOffset=g||[0,0,0],this.distanceScales=S,this._initMatrices(),Object.freeze(this)}return Wr(r,[{key:"_initMatrices",value:function(){var t=this.width,n=this.height,a=this.projectionMatrix,v=this.viewMatrix,o=nr();wr(o,o,a),wr(o,o,v),this.viewProjectionMatrix=o;var i=nr();Pr(i,i,[t/2,-n/2,1]),pr(i,i,[1,-1,0]),wr(i,i,o);var s=ye(nr(),i);if(!s)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=i,this.pixelUnprojectionMatrix=s}},{key:"projectFlat",value:function(t){return R(t)}},{key:"unprojectFlat",value:function(t){return q(t)}},{key:"getMapCenterByLngLatPosition",value:function(t){var n=t.lngLat,a=t.pos,v=zr(a,this.pixelUnprojectionMatrix),o=R(n),i=Br([],o,Oe([],v)),s=Br([],this.center,i);return q(s)}},{key:"fitBounds",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=this.width,v=this.height,o=Ar(Object.assign({width:a,height:v,bounds:t},n)),i=o.longitude,s=o.latitude,l=o.zoom;return new r({width:a,height:v,longitude:i,latitude:s,zoom:l})}},{key:"getBounds",value:function(t){var n=this.getBoundingRegion(t),a=Math.min.apply(Math,tr(n.map(function(s){return s[0]}))),v=Math.max.apply(Math,tr(n.map(function(s){return s[0]}))),o=Math.min.apply(Math,tr(n.map(function(s){return s[1]}))),i=Math.max.apply(Math,tr(n.map(function(s){return s[1]})));return[[a,o],[v,i]]}},{key:"getBoundingRegion",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Lr(this,t.z||0)}},{key:"getLocationAtPoint",value:function(t){var n=t.lngLat,a=t.pos;return this.getMapCenterByLngLatPosition({lngLat:n,pos:a})}}]),r}();function ke(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(r,a).enumerable})),t.push.apply(t,n)}return t}function H(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?ke(Object(t),!0).forEach(function(n){(0,Re.default)(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):ke(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}var ne=512,Pt=Math.PI/180;function Tr(r){var e=r.map,t=r.gl,n=r.deck;if(e.__deck)return e.__deck;var a=n?.props._customRender,v=n?.props.onLoad,o=ie(H(H({},n?.props),{},{_customRender:function(){e.triggerRepaint(),a?.("")}})),i;return(!n||n.props.gl===t)&&(Object.assign(o,{gl:t,width:null,height:null,touchAction:"unset",viewState:sr(e)}),n!=null&&n.isInitialized?De(n,e):o.onLoad=function(){v?.(),De(i,e)}),n?(i=n,n.setProps(o),n.userData.isExternal=!0):(i=new U.Deck(o),e.on("remove",function(){ae(e)})),i.userData.mapboxLayers=new Set,e.__deck=i,e.on("render",function(){i.isInitialized&&bt(i,e)}),i}function De(r,e){var t=function n(){r.isInitialized?Et(r,e):e.off("move",n)};e.on("move",t)}function ae(r){var e;(e=r.__deck)===null||e===void 0||e.finalize(),r.__deck=null}function ie(r){var e=H(H({},r),{},{parameters:H({depthMask:!0,depthTest:!0,blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthFunc:515,blendEquation:32774},r.parameters),views:r.views||[new U.MapView({id:"mapbox"})]});return e}function Ne(r,e){r.userData.mapboxLayers.add(e),oe(r)}function Fe(r,e){r.userData.mapboxLayers.delete(e),oe(r)}function Ce(r,e){oe(r)}function Ye(r,e,t){var n=r.userData,a=n.currentViewport,v=!1;a||(a=Ze(r,e,!0),r.userData.currentViewport=a,v=!0),r.isInitialized&&r._drawLayers("mapbox-repaint",{viewports:[a],layerFilter:function(i){var s=i.layer;return t.id===s.id},clearStack:v,clearCanvas:!1})}function sr(r){var e,t=r.getCenter(),n=t.lng,a=t.lat,v={longitude:(n+540)%360-180,latitude:a,zoom:r.getZoom(),bearing:r.getBearing(),pitch:r.getPitch(),padding:r.getPadding(),repeat:r.getRenderWorldCopies()};return(e=r.getTerrain)!==null&&e!==void 0&&e.call(r)&&Ot(r,v),v}function Ot(r,e){if(r.getFreeCameraOptions){var t=r.getFreeCameraOptions(),n=t.position;if(!n||n.z===void 0)return;var a=r.transform.height,v=e.longitude,o=e.latitude,i=e.pitch,s=n.x*ne,l=(1-n.y)*ne,c=n.z*ne,f=R([v,o]),h=s-f[0],y=l-f[1],u=Math.sqrt(h*h+y*y),_=i*Pt,w=1.5*a,M=_<.001?w*Math.cos(_)/c:w*Math.sin(_)/u;e.zoom=Math.log2(M);var P=w*Math.cos(_)/M,p=c-P;e.position=[0,0,p/Kr(o)]}else typeof r.transform.elevation=="number"&&(e.position=[0,0,r.transform.elevation])}function Ze(r,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return new U.WebMercatorViewport(H(H({id:"mapbox",x:0,y:0,width:r.width,height:r.height},sr(e)),{},{nearZMultiplier:t?.02:.1}))}function bt(r,e){var t=r.userData,n=t.mapboxLayers,a=t.isExternal;if(a){var v=Array.from(n,function(f){return f.id}),o=(0,U._flatten)(r.props.layers,Boolean),i=o.some(function(f){return f&&!v.includes(f.id)}),s=r.getViewports(),l=s.findIndex(function(f){return f.id==="mapbox"}),c=s.length>1||l<0;(i||c)&&(l>=0&&(s=s.slice(),s[l]=Ze(r,e,!1)),r._drawLayers("mapbox-repaint",{viewports:s,layerFilter:function(h){return(!r.props.layerFilter||r.props.layerFilter(h))&&(h.viewport.id!=="mapbox"||!v.includes(h.layer.id))},clearCanvas:!1}))}r.userData.currentViewport=null}function Et(r,e){r.setProps({viewState:sr(e)}),r.needsRedraw({clearRedrawFlags:!0})}function oe(r){if(!r.userData.isExternal){var e=[];r.userData.mapboxLayers.forEach(function(t){var n=t.props.type,a=new n(t.props);e.push(a)}),r.setProps({layers:e})}}var Sr=function(){function r(e){if((0,qe.default)(this,r),(0,G.default)(this,"id",void 0),(0,G.default)(this,"type",void 0),(0,G.default)(this,"renderingMode",void 0),(0,G.default)(this,"map",void 0),(0,G.default)(this,"deck",void 0),(0,G.default)(this,"props",void 0),!e.id)throw new Error("Layer must have an unique id");this.id=e.id,this.type="custom",this.renderingMode=e.renderingMode||"3d",this.map=null,this.deck=null,this.props=e}return(0,$e.default)(r,[{key:"onAdd",value:function(t,n){this.map=t,this.deck=Tr({map:t,gl:n,deck:this.props.deck}),Ne(this.deck,this)}},{key:"onRemove",value:function(){this.deck&&Fe(this.deck,this)}},{key:"setProps",value:function(t){Object.assign(this.props,t,{id:this.id}),this.deck&&Ce(this.deck,this)}},{key:"render",value:function(){Ye(this.deck,this.map,this)}}]),r}();var Ge=D(Be()),Qe=D(Rr()),Ke=D(Nr()),N=D(yr()),Q=D(rr());var ve=D(rr());function jr(r,e){var t=typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=Tt(r))||e&&r&&typeof r.length=="number"){t&&(r=t);var n=0,a=function(){};return{s:a,n:function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}},e:function(l){throw l},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var v=!0,o=!1,i;return{s:function(){t=t.call(r)},n:function(){var l=t.next();return v=l.done,l},e:function(l){o=!0,i=l},f:function(){try{!v&&t.return!=null&&t.return()}finally{if(o)throw i}}}}function Tt(r,e){if(r){if(typeof r=="string")return Ue(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Ue(r,e)}}function Ue(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=r[t];return n}var se="__UNDEFINED__";function dr(r,e,t,n){if(!(!r||!e||!r.style||!r.style._loaded)){var a=(0,ve._flatten)(n,Boolean);if(t!==n){var v=(0,ve._flatten)(t,Boolean),o=new Set(v.map(function(d){return d.id})),i=jr(a),s;try{for(i.s();!(s=i.n()).done;){var l=s.value;o.delete(l.id)}}catch(d){i.e(d)}finally{i.f()}var c=jr(o),f;try{for(c.s();!(f=c.n()).done;){var h=f.value;r.getLayer(h)&&r.removeLayer(h)}}catch(d){c.e(d)}finally{c.f()}}var y=jr(a),u;try{for(y.s();!(u=y.n()).done;){var _=u.value,w=r.getLayer(_.id);w?w.implementation.setProps(_.props):r.addLayer(new Sr({id:_.id,deck:e}),_.props.beforeId)}}catch(d){y.e(d)}finally{y.f()}var M=r.style._order,P={},p=jr(a),g;try{for(p.s();!(g=p.n()).done;){var m=g.value,x=m.props.beforeId;(!x||!M.includes(x))&&(x=se),P[x]=P[x]||[],P[x].push(m.id)}}catch(d){p.e(d)}finally{p.f()}for(var E in P)for(var I=P[E],T=E===se?M.length:M.indexOf(E),S=E===se?void 0:E,z=I.length-1;z>=0;z--){var O=I[z],A=M.indexOf(O);A!==T-1&&(r.moveLayer(O,S),A>T&&T++),T--,S=O}}}var St=["interleaved"];function He(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(r,a).enumerable})),t.push.apply(t,n)}return t}function vr(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?He(Object(t),!0).forEach(function(n){(0,N.default)(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):He(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}var Je=function(){function r(e){var t=this;(0,Qe.default)(this,r),(0,N.default)(this,"_props",void 0),(0,N.default)(this,"_deck",void 0),(0,N.default)(this,"_map",void 0),(0,N.default)(this,"_container",void 0),(0,N.default)(this,"_interleaved",void 0),(0,N.default)(this,"_lastMouseDownPoint",void 0),(0,N.default)(this,"_handleStyleChange",function(){dr(t._map,t._deck,t._props.layers,t._props.layers)}),(0,N.default)(this,"_updateContainerSize",function(){if(t._map&&t._container){var o=t._map.getContainer(),i=o.clientWidth,s=o.clientHeight;Object.assign(t._container.style,{width:"".concat(i,"px"),height:"".concat(s,"px")})}}),(0,N.default)(this,"_updateViewState",function(){var o=t._deck;o&&(o.setProps({viewState:sr(t._map)}),o.isInitialized&&o.redraw())}),(0,N.default)(this,"_handleMouseEvent",function(o){var i=t._deck;if(!(!i||!i.isInitialized)){var s={type:o.type,offsetCenter:o.point,srcEvent:o},l=t._lastMouseDownPoint;switch(!o.point&&l&&(s.deltaX=o.originalEvent.clientX-l.clientX,s.deltaY=o.originalEvent.clientY-l.clientY,s.offsetCenter={x:l.x+s.deltaX,y:l.y+s.deltaY}),s.type){case"mousedown":i._onPointerDown(s),t._lastMouseDownPoint=vr(vr({},o.point),{},{clientX:o.originalEvent.clientX,clientY:o.originalEvent.clientY});break;case"dragstart":s.type="panstart",i._onEvent(s);break;case"drag":s.type="panmove",i._onEvent(s);break;case"dragend":s.type="panend",i._onEvent(s);break;case"click":s.tapCount=1,i._onEvent(s);break;case"dblclick":s.type="click",s.tapCount=2,i._onEvent(s);break;case"mousemove":s.type="pointermove",i._onPointerMove(s);break;case"mouseout":s.type="pointerleave",i._onPointerMove(s);break;default:return}}});var n=e.interleaved,a=n===void 0?!1:n,v=(0,Ge.default)(e,St);this._interleaved=a,this._props=v}return(0,Ke.default)(r,[{key:"setProps",value:function(t){this._interleaved&&t.layers&&dr(this._map,this._deck,this._props.layers,t.layers),Object.assign(this._props,t),this._deck&&this._deck.setProps(this._interleaved?ie(this._props):this._props)}},{key:"onAdd",value:function(t){return this._map=t,this._interleaved?this._onAddInterleaved(t):this._onAddOverlaid(t)}},{key:"_onAddOverlaid",value:function(t){var n=document.createElement("div");return Object.assign(n.style,{position:"absolute",left:0,top:0,pointerEvents:"none"}),this._container=n,this._deck=new Q.Deck(vr(vr({},this._props),{},{parent:n,viewState:sr(t)})),t.on("resize",this._updateContainerSize),t.on("render",this._updateViewState),t.on("mousedown",this._handleMouseEvent),t.on("dragstart",this._handleMouseEvent),t.on("drag",this._handleMouseEvent),t.on("dragend",this._handleMouseEvent),t.on("mousemove",this._handleMouseEvent),t.on("mouseout",this._handleMouseEvent),t.on("click",this._handleMouseEvent),t.on("dblclick",this._handleMouseEvent),this._updateContainerSize(),n}},{key:"_onAddInterleaved",value:function(t){return this._deck=Tr({map:t,gl:t.painter.context.gl,deck:new Q.Deck(vr(vr({},this._props),{},{gl:t.painter.context.gl}))}),t.on("styledata",this._handleStyleChange),dr(t,this._deck,[],this._props.layers),document.createElement("div")}},{key:"onRemove",value:function(){var t=this._map;t&&(this._interleaved?this._onRemoveInterleaved(t):this._onRemoveOverlaid(t)),this._deck=void 0,this._map=void 0,this._container=void 0}},{key:"_onRemoveOverlaid",value:function(t){var n;t.off("resize",this._updateContainerSize),t.off("render",this._updateViewState),t.off("mousedown",this._handleMouseEvent),t.off("dragstart",this._handleMouseEvent),t.off("drag",this._handleMouseEvent),t.off("dragend",this._handleMouseEvent),t.off("mousemove",this._handleMouseEvent),t.off("mouseout",this._handleMouseEvent),t.off("click",this._handleMouseEvent),t.off("dblclick",this._handleMouseEvent),(n=this._deck)===null||n===void 0||n.finalize()}},{key:"_onRemoveInterleaved",value:function(t){t.off("styledata",this._handleStyleChange),dr(t,this._deck,this._props.layers,[]),ae(t)}},{key:"getDefaultPosition",value:function(){return"top-left"}},{key:"pickObject",value:function(t){return(0,Q.assert)(this._deck),this._deck.pickObject(t)}},{key:"pickMultipleObjects",value:function(t){return(0,Q.assert)(this._deck),this._deck.pickMultipleObjects(t)}},{key:"pickObjects",value:function(t){return(0,Q.assert)(this._deck),this._deck.pickObjects(t)}},{key:"finalize",value:function(){this._map&&this._map.removeControl(this)}}]),r}();return ct(xr);})();
      return __exports__;
      });
