{"version":3,"sources":["../../../../src/layers/schema/carto-spatial-tile.ts"],"names":["readPackedTypedArray","NumericPropKeyValueReader","PropertiesReader","IndicesReader","read","pbf","end","readFields","_readField","value","tag","obj","BigUint64Array","CellsReader","indices","properties","numericProps","readVarint","pos","push","entry","key","TileReader","scheme","cells"],"mappings":"AAAA,SAAQA,oBAAR,QAAmC,YAAnC;AAEA,SAAqBC,yBAArB,EAAgDC,gBAAhD,QAAuE,cAAvE;AAIA,OAAO,MAAMC,aAAN,CAAoB;AACd,SAAJC,IAAI,CAACC,GAAD,EAAMC,GAAN,EAA6B;AACtC,WAAOD,GAAG,CAACE,UAAJ,CAAeJ,aAAa,CAACK,UAA7B,EAAyC;AAACC,MAAAA,KAAK,EAAE;AAAR,KAAzC,EAAsDH,GAAtD,CAAP;AACD;;AACgB,SAAVE,UAAU,CAAaE,GAAb,EAA0BC,GAA1B,EAA+BN,GAA/B,EAAoC;AACnD,QAAIK,GAAG,KAAK,CAAZ,EAAeV,oBAAoB,CAACY,cAAD,EAAiBP,GAAjB,EAAsBM,GAAtB,CAApB;AAChB;;AANwB;;AAiB3B,MAAME,WAAN,CAAkB;AACL,SAAJT,IAAI,CAACC,GAAD,EAAMC,GAAN,EAA2B;AACpC,WAAOD,GAAG,CAACE,UAAJ,CACLM,WAAW,CAACL,UADP,EAEL;AAACM,MAAAA,OAAO,EAAE,IAAV;AAAgBC,MAAAA,UAAU,EAAE,EAA5B;AAAgCC,MAAAA,YAAY,EAAE;AAA9C,KAFK,EAGLV,GAHK,CAAP;AAKD;;AACgB,SAAVE,UAAU,CAAaE,GAAb,EAA0BC,GAA1B,EAAsCN,GAAtC,EAA2C;AAC1D,QAAIK,GAAG,KAAK,CAAZ,EAAeC,GAAG,CAACG,OAAJ,GAAcX,aAAa,CAACC,IAAd,CAAmBC,GAAnB,EAAwBA,GAAG,CAACY,UAAJ,KAAmBZ,GAAG,CAACa,GAA/C,CAAd,CAAf,KACK,IAAIR,GAAG,KAAK,CAAZ,EAAeC,GAAG,CAACI,UAAJ,CAAeI,IAAf,CAAoBjB,gBAAgB,CAACE,IAAjB,CAAsBC,GAAtB,EAA2BA,GAAG,CAACY,UAAJ,KAAmBZ,GAAG,CAACa,GAAlD,CAApB,EAAf,KACA,IAAIR,GAAG,KAAK,CAAZ,EAAe;AAClB,YAAMU,KAAK,GAAGnB,yBAAyB,CAACG,IAA1B,CAA+BC,GAA/B,EAAoCA,GAAG,CAACY,UAAJ,KAAmBZ,GAAG,CAACa,GAA3D,CAAd;AACAP,MAAAA,GAAG,CAACK,YAAJ,CAAiBI,KAAK,CAACC,GAAvB,IAA8BD,KAAK,CAACX,KAApC;AACD;AACF;;AAfe;;AA0BlB,OAAO,MAAMa,UAAN,CAAiB;AACX,SAAJlB,IAAI,CAACC,GAAD,EAAMC,GAAN,EAA0B;AACnC,WAAOD,GAAG,CAACE,UAAJ,CAAee,UAAU,CAACd,UAA1B,EAAsC;AAACe,MAAAA,MAAM,EAAE,CAAT;AAAYC,MAAAA,KAAK,EAAE;AAAnB,KAAtC,EAAgElB,GAAhE,CAAP;AACD;;AACgB,SAAVE,UAAU,CAAaE,GAAb,EAA0BC,GAA1B,EAAqCN,GAArC,EAA0C;AACzD,QAAIK,GAAG,KAAK,CAAZ,EAAeC,GAAG,CAACY,MAAJ,GAAalB,GAAG,CAACY,UAAJ,EAAb,CAAf,KACK,IAAIP,GAAG,KAAK,CAAZ,EAAeC,GAAG,CAACa,KAAJ,GAAYX,WAAW,CAACT,IAAZ,CAAiBC,GAAjB,EAAsBA,GAAG,CAACY,UAAJ,KAAmBZ,GAAG,CAACa,GAA7C,CAAZ;AACrB;;AAPqB","sourcesContent":["import {readPackedTypedArray} from './fast-pbf';\nimport {Indices, IndexScheme} from './spatialjson-utils';\nimport {NumericProp, NumericPropKeyValueReader, PropertiesReader} from './carto-tile';\n\n// Indices =====================================\n\nexport class IndicesReader {\n  static read(pbf, end?: number): Indices {\n    return pbf.readFields(IndicesReader._readField, {value: []}, end);\n  }\n  static _readField(this: void, tag: number, obj, pbf) {\n    if (tag === 1) readPackedTypedArray(BigUint64Array, pbf, obj);\n  }\n}\n\n// Cells =========================================\n\ninterface Cells {\n  indices: Indices;\n  properties: Record<string, string>[];\n  numericProps: Record<string, NumericProp>;\n}\n\nclass CellsReader {\n  static read(pbf, end?: number): Cells {\n    return pbf.readFields(\n      CellsReader._readField,\n      {indices: null, properties: [], numericProps: {}},\n      end\n    );\n  }\n  static _readField(this: void, tag: number, obj: Cells, pbf) {\n    if (tag === 1) obj.indices = IndicesReader.read(pbf, pbf.readVarint() + pbf.pos);\n    else if (tag === 2) obj.properties.push(PropertiesReader.read(pbf, pbf.readVarint() + pbf.pos));\n    else if (tag === 3) {\n      const entry = NumericPropKeyValueReader.read(pbf, pbf.readVarint() + pbf.pos);\n      obj.numericProps[entry.key] = entry.value;\n    }\n  }\n}\n\n// Tile ========================================\n\n// TODO this type is very similar to SpatialBinary, should align\nexport interface Tile {\n  scheme: IndexScheme;\n  cells: Cells;\n}\n\nexport class TileReader {\n  static read(pbf, end?: number): Tile {\n    return pbf.readFields(TileReader._readField, {scheme: 0, cells: null}, end);\n  }\n  static _readField(this: void, tag: number, obj: Tile, pbf) {\n    if (tag === 1) obj.scheme = pbf.readVarint();\n    else if (tag === 2) obj.cells = CellsReader.read(pbf, pbf.readVarint() + pbf.pos);\n  }\n}\n"],"file":"carto-spatial-tile.js"}